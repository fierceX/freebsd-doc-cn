Ş¾Part IV. Network Communication»ç¬¬å››éƒ¨åˆ†ï¼šç½‘ç»œé€šä¿¡µNetwork Communication¬ç½‘ç»œé€šä¿¡Ù„FreeBSD is one of the most widely deployed operating systems for high performance network servers.  The chapters in this part cover:ÙkFreeBSD æ˜¯æœ€å¹¿æ³›éƒ¨ç½²çš„é«˜æ€§èƒ½ç½‘ç»œæœåŠ¡å™¨æ“ä½œç³»ç»Ÿä¹‹ä¸€ã€‚æœ¬éƒ¨åˆ†çš„ç« èŠ‚å†…å®¹åŒ…æ‹¬ï¼š´Serial communication¬ä¸²è¡Œé€šä¿¡½`PPP` and `PPP` over EthernetºPPP å’Œä»¥å¤ªç½‘ä¸Šçš„ PPP¯Electronic Mail¬ç”µå­é‚®ä»¶·Running Network Serversµè¿è¡Œç½‘ç»œæœåŠ¡å™¨©Firewalls©é˜²ç«å¢™Ù Other Advanced Networking Topics¸å…¶ä»–é«˜çº§ç½‘ç»œä¸»é¢˜ÙÓThese chapters are designed to be read when the information is needed.  They do not need to be read in any particular order, nor is it necessary to read all of them before using FreeBSD in a network environment.Ù«è¿™äº›ç« èŠ‚çš„è®¾è®¡æ˜¯åœ¨éœ€è¦ä¿¡æ¯æ—¶é˜…è¯»ã€‚å®ƒä»¬ä¸éœ€è¦æŒ‰ç…§ç‰¹å®šçš„é¡ºåºé˜…è¯»ï¼Œä¹Ÿä¸éœ€è¦åœ¨ä½¿ç”¨ FreeBSD åœ¨ç½‘ç»œç¯å¢ƒä¸­ä¹‹å‰é˜…è¯»æ‰€æœ‰ç« èŠ‚ã€‚·Part I. Getting Started»ç¬¬ä¸€éƒ¨åˆ†ï¼šå…¥é—¨æŒ‡å—¯Getting Started¬å…¥é—¨æŒ‡å—ÙbThis part of the handbook is for users and administrators who are new to FreeBSD.  These chapters:Ùdæœ¬æ‰‹å†Œçš„è¿™éƒ¨åˆ†æ˜¯ä¸ºé‚£äº›å¯¹FreeBSDæ–°æ‰‹ç”¨æˆ·å’Œç®¡ç†å‘˜å‡†å¤‡çš„ã€‚è¿™äº›ç« èŠ‚åŒ…æ‹¬ï¼š²Introduce FreeBSD.±ä»‹ç» FreeBSDã€‚Ù/Guide readers through the installation process.Ù!å¼•å¯¼è¯»è€…å®Œæˆå®‰è£…è¿‡ç¨‹ã€‚Ù&Teach UNIX(R) basics and fundamentals.Ù0æ•™æˆ UNIX(R) çš„åŸºç¡€çŸ¥è¯†å’ŒåŸºæœ¬åŸç†ã€‚ÙQShow how to install the wealth of third party applications available for FreeBSD.ÙEå±•ç¤ºå¦‚ä½•å®‰è£…é€‚ç”¨äº FreeBSD çš„ä¸°å¯Œç¬¬ä¸‰æ–¹åº”ç”¨ç¨‹åºã€‚Ù~Introduce X, the UNIX(R) windowing system, and detail how to configure a desktop environment that makes users more productive.Ùkä»‹ç» UNIX(R) çª—å£ç³»ç»Ÿ Xï¼Œå¹¶è¯¦ç»†è¯´æ˜å¦‚ä½•é…ç½®ä¸€ä¸ªèƒ½æé«˜ç”¨æˆ·ç”Ÿäº§åŠ›çš„æ¡Œé¢ç¯å¢ƒã€‚Ù4Introduce Wayland, a new display server for UNIX(R).Ù8ä»‹ç» Waylandï¼Œä¸€ç§æ–°çš„ UNIX(R) æ˜¾ç¤ºæœåŠ¡å™¨ã€‚Ù˜The number of forward references in the text have been kept to a minimum so that this section can be read from front to back with minimal page flipping.Ù~æ–‡æœ¬ä¸­çš„æ­£å‘å¼•ç”¨æ•°é‡è¢«å°½é‡å‡å°‘ï¼Œä»¥ä¾¿è¿™ä¸€éƒ¨åˆ†å¯ä»¥ä»å¤´åˆ°å°¾åœ°é˜…è¯»ï¼Œæœ€å¤§ç¨‹åº¦åœ°å‡å°‘ç¿»é¡µã€‚Ù?A constantly evolving, comprehensive resource for FreeBSD usersÙ4ä¸€ä¸ªä¸æ–­å‘å±•çš„ã€å…¨é¢çš„FreeBSDç”¨æˆ·èµ„æº°FreeBSD Handbook­FreeBSDæ‰‹å†Œ²Part V. Appendices´ç¬¬äº”éƒ¨åˆ†. é™„å½•«Appendices ¦é™„å½•µPart II. Common Tasks»ç¬¬äºŒéƒ¨åˆ†ï¼šå¸¸è§ä»»åŠ¡¬Common Tasks¬å¸¸è§ä»»åŠ¡ÙNow that the basics have been covered, this part of the book discusses some frequently used features of FreeBSD.  These chapters:Ù{ç°åœ¨åŸºç¡€çŸ¥è¯†å·²ç»ä»‹ç»å®Œæ¯•ï¼Œæœ¬ä¹¦çš„è¿™ä¸€éƒ¨åˆ†å°†è®¨è®º FreeBSD çš„ä¸€äº›å¸¸ç”¨åŠŸèƒ½ã€‚è¿™äº›ç« èŠ‚åŒ…æ‹¬ï¼šÙlIntroduce popular and useful desktop applications: browsers, productivity tools, document viewers, and more.Ù`ä»‹ç»æµè¡Œä¸”å®ç”¨çš„æ¡Œé¢åº”ç”¨ç¨‹åºï¼šæµè§ˆå™¨ã€åŠå…¬å·¥å…·ã€æ–‡æ¡£æŸ¥çœ‹å™¨ç­‰ç­‰ã€‚Ù=Introduce a number of multimedia tools available for FreeBSD.Ù3ä»‹ç»ä¸€äº›é€‚ç”¨äº FreeBSD çš„å¤šåª’ä½“å·¥å…·ã€‚ÙZExplain the process of building a customized FreeBSD kernel to enable extra functionality.ÙEè§£é‡Šæ„å»ºè‡ªå®šä¹‰ FreeBSD å†…æ ¸ä»¥å¯ç”¨é¢å¤–åŠŸèƒ½çš„è¿‡ç¨‹ã€‚Ù[Describe the print system in detail, both for desktop and network-connected printer setups.ÙEè¯¦ç»†æè¿°æ¡Œé¢å’Œç½‘ç»œè¿æ¥æ‰“å°æœºè®¾ç½®ä¸­çš„æ‰“å°ç³»ç»Ÿã€‚Ù9Show how to run Linux applications on the FreeBSD system.Ù=å±•ç¤ºå¦‚ä½•åœ¨ FreeBSD ç³»ç»Ÿä¸Šè¿è¡Œ Linux åº”ç”¨ç¨‹åºã€‚ÙsSome of these chapters recommend prior reading, and this is noted in the synopsis at the beginning of each chapter.ÙTå…¶ä¸­ä¸€äº›ç« èŠ‚å»ºè®®å…ˆé˜…è¯»ï¼Œè¿™åœ¨æ¯ä¸ªç« èŠ‚å¼€å¤´çš„ç®€ä»‹ä¸­æœ‰æ³¨æ˜ã€‚¿Part III. System Administration»ç¬¬ä¸‰éƒ¨åˆ†ï¼šç³»ç»Ÿç®¡ç†µSystem Administration¬ç³»ç»Ÿç®¡ç†ÙùThe remaining chapters cover all aspects of FreeBSD system administration.  Each chapter starts by describing what will be learned as a result of reading the chapter, and also details what the reader is expected to know before tackling the material.ÙÉå‰©ä¸‹çš„ç« èŠ‚æ¶µç›–äº† FreeBSD ç³»ç»Ÿç®¡ç†çš„å„ä¸ªæ–¹é¢ã€‚æ¯ä¸€ç« éƒ½ä»¥æè¿°è¯»å®Œè¯¥ç« èŠ‚åå°†å­¦åˆ°çš„å†…å®¹ä¸ºå¼€å¤´ï¼Œå¹¶è¯¦ç»†è¯´æ˜è¯»è€…åœ¨å­¦ä¹ è¯¥ç« èŠ‚ä¹‹å‰åº”è¯¥å…·å¤‡çš„çŸ¥è¯†ã€‚Ù¸These chapters are designed to be read as the information is needed.  They do not need to be read in any particular order, nor must all of them be read before beginning to use FreeBSD.Ùœè¿™äº›ç« èŠ‚çš„è®¾è®¡æ˜¯æ ¹æ®éœ€è¦é˜…è¯»çš„ã€‚å®ƒä»¬ä¸éœ€è¦æŒ‰ç…§ç‰¹å®šçš„é¡ºåºé˜…è¯»ï¼Œä¹Ÿä¸éœ€è¦åœ¨å¼€å§‹ä½¿ç”¨ FreeBSD ä¹‹å‰å…¨éƒ¨é˜…è¯»å®Œæ¯•ã€‚Ù@Basic commands and functionality of the FreeBSD operating systemÙ,FreeBSD æ“ä½œç³»ç»Ÿçš„åŸºæœ¬å‘½ä»¤å’ŒåŠŸèƒ½¹Chapter 3. FreeBSD Basics¾ç¬¬ 3 ç«  FreeBSD åŸºç¡€çŸ¥è¯†®FreeBSD Basics´FreeBSD åŸºç¡€çŸ¥è¯†¨Synopsis¦ç®€ä»‹ÙíThis chapter covers the basic commands and functionality of the FreeBSD operating system.  Much of this material is relevant for any UNIX(R)-like operating system.  New FreeBSD users are encouraged to read through this chapter carefully.Ù´æœ¬ç« ä»‹ç»äº† FreeBSD æ“ä½œç³»ç»Ÿçš„åŸºæœ¬å‘½ä»¤å’ŒåŠŸèƒ½ã€‚å…¶ä¸­å¾ˆå¤šå†…å®¹å¯¹äºä»»ä½•ç±» UNIX æ“ä½œç³»ç»Ÿéƒ½æ˜¯ç›¸å…³çš„ã€‚é¼“åŠ±æ–°çš„ FreeBSD ç”¨æˆ·ä»”ç»†é˜…è¯»æœ¬ç« ã€‚Ù*After reading this chapter, you will know:Ù!é˜…è¯»æœ¬ç« åï¼Œæ‚¨å°†äº†è§£ï¼šÙ*How to use and configure virtual consoles.Ù'å¦‚ä½•ä½¿ç”¨å’Œé…ç½®è™šæ‹Ÿæ§åˆ¶å°ã€‚Ù5How to create and manage users and groups on FreeBSD.Ù3å¦‚ä½•åœ¨ FreeBSD ä¸Šåˆ›å»ºå’Œç®¡ç†ç”¨æˆ·å’Œç»„ã€‚Ù9How UNIX(R) file permissions and FreeBSD file flags work.Ù>UNIX(R) æ–‡ä»¶æƒé™å’Œ FreeBSD æ–‡ä»¶æ ‡å¿—çš„å·¥ä½œåŸç†ã€‚Ù'The default FreeBSD file system layout.Ù'é»˜è®¤çš„ FreeBSD æ–‡ä»¶ç³»ç»Ÿå¸ƒå±€ã€‚¾The FreeBSD disk organization.·FreeBSD ç£ç›˜ç»„ç»‡ã€‚Ù&How to mount and unmount file systems.Ù$å¦‚ä½•æŒ‚è½½å’Œå¸è½½æ–‡ä»¶ç³»ç»Ÿã€‚Ù)What processes, daemons, and signals are.Ù*è¿›ç¨‹ã€å®ˆæŠ¤è¿›ç¨‹å’Œä¿¡å·æ˜¯ä»€ä¹ˆã€‚ÙAWhat a shell is, and how to change the default login environment.Ù=ä»€ä¹ˆæ˜¯ shell ï¼Œä»¥åŠå¦‚ä½•æ›´æ”¹é»˜è®¤çš„ç™»å½•ç¯å¢ƒã€‚¾How to use basic text editors.Ù$å¦‚ä½•ä½¿ç”¨åŸºæœ¬æ–‡æœ¬ç¼–è¾‘å™¨ã€‚Ù"What devices and device nodes are.Ù!è®¾å¤‡å’Œè®¾å¤‡èŠ‚ç‚¹æ˜¯ä»€ä¹ˆã€‚Ù.How to read manual pages for more information.Ù-å¦‚ä½•é˜…è¯»æ‰‹å†Œé¡µä»¥è·å–æ›´å¤šä¿¡æ¯ã€‚¾Virtual Consoles and Terminals¸è™šæ‹Ÿæ§åˆ¶å°å’Œç»ˆç«¯Ù±Unless FreeBSD has been configured to automatically start a graphical environment during startup, the system will boot into a command line login prompt, as seen in this example:Ù™é™¤é FreeBSD å·²ç»é…ç½®ä¸ºåœ¨å¯åŠ¨æ—¶è‡ªåŠ¨å¯åŠ¨å›¾å½¢ç¯å¢ƒï¼Œå¦åˆ™ç³»ç»Ÿå°†å¯åŠ¨åˆ°ä¸€ä¸ªå‘½ä»¤è¡Œç™»å½•æç¤ºç¬¦ï¼Œå¦‚ä¸‹é¢çš„ç¤ºä¾‹æ‰€ç¤ºï¼šÚThe first line contains some information about the system.  The `amd64` indicates that FreeBSD is running on a 64-bit x86 system.  The hostname is `pc3.example.org`, and `ttyv0` indicates that this is the "system console".  The second line is the login prompt.Ùâç¬¬ä¸€è¡ŒåŒ…å«äº†å…³äºç³»ç»Ÿçš„ä¸€äº›ä¿¡æ¯ã€‚ `amd64` è¡¨ç¤º FreeBSD è¿è¡Œåœ¨ä¸€ä¸ª 64 ä½çš„ x86 ç³»ç»Ÿä¸Šã€‚ä¸»æœºåæ˜¯ `pc3.example.org` ï¼Œè€Œ `ttyv0` è¡¨ç¤ºè¿™æ˜¯â€œç³»ç»Ÿæ§åˆ¶å°â€ã€‚ç¬¬äºŒè¡Œæ˜¯ç™»å½•æç¤ºç¬¦ã€‚ÚSince FreeBSD is a multiuser system, it needs some way to distinguish between different users.  This is accomplished by requiring every user to log into the system before gaining access to the programs on the system.  Every user has a unique "username" and a personal "password".Ùùç”±äº FreeBSD æ˜¯ä¸€ä¸ªå¤šç”¨æˆ·ç³»ç»Ÿï¼Œå®ƒéœ€è¦ä¸€ç§åŒºåˆ†ä¸åŒç”¨æˆ·çš„æ–¹å¼ã€‚è¿™é€šè¿‡è¦æ±‚æ¯ä¸ªç”¨æˆ·åœ¨è®¿é—®ç³»ç»Ÿä¸Šçš„ç¨‹åºä¹‹å‰å…ˆç™»å½•ç³»ç»Ÿæ¥å®ç°ã€‚æ¯ä¸ªç”¨æˆ·éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„â€œç”¨æˆ·åâ€å’Œä¸ªäººçš„â€œå¯†ç â€ã€‚Ú=To log into the system console, type the username that was configured during system installation, as described in crossref:bsdinstall[bsdinstall-addusers,Add Users], and press kbd:[Enter].  Then enter the password associated with the username and press kbd:[Enter].  The password is _not echoed_ for security reasons.Ú%è¦ç™»å½•ç³»ç»Ÿæ§åˆ¶å°ï¼Œè¯·è¾“å…¥åœ¨ç³»ç»Ÿå®‰è£…è¿‡ç¨‹ä¸­é…ç½®çš„ç”¨æˆ·åï¼Œå¦‚ crossref:bsdinstall[bsdinstall-addusers , Add Users] ä¸­æ‰€è¿°ï¼Œå¹¶æŒ‰ä¸‹ kbd:[Enter] é”®ã€‚ç„¶åè¾“å…¥ä¸ç”¨æˆ·åå…³è”çš„å¯†ç å¹¶æŒ‰ä¸‹ kbd:[Enter] é”®ã€‚å‡ºäºå®‰å…¨åŸå› ï¼Œå¯†ç ä¸ä¼šæ˜¾ç¤ºå‡ºæ¥ã€‚ÚgOnce the correct password is input, the message of the day (MOTD) will be displayed followed by a command prompt.  Depending upon the shell that was selected when the user was created, this prompt will be a `+#+`, `$`, or `%` character.  The prompt indicates that the user is now logged into the FreeBSD system console and ready to try the available commands.Ú)ä¸€æ—¦è¾“å…¥æ­£ç¡®çš„å¯†ç ï¼Œå°†æ˜¾ç¤ºå½“å¤©çš„æ¶ˆæ¯ï¼ˆ MOTD ï¼‰ï¼Œç„¶åæ˜¾ç¤ºå‘½ä»¤æç¤ºç¬¦ã€‚æ ¹æ®åˆ›å»ºç”¨æˆ·æ—¶é€‰æ‹©çš„ shell ä¸åŒï¼Œè¯¥æç¤ºç¬¦å¯èƒ½æ˜¯ `+#+` ã€ `$` æˆ– `%` å­—ç¬¦ã€‚æç¤ºç¬¦è¡¨ç¤ºç”¨æˆ·å·²æˆåŠŸç™»å½•åˆ° FreeBSD ç³»ç»Ÿæ§åˆ¶å°ï¼Œå¹¶å‡†å¤‡å°è¯•å¯ç”¨çš„å‘½ä»¤ã€‚°Virtual Consoles¯è™šæ‹Ÿæ§åˆ¶å°Ú¤While the system console can be used to interact with the system, a user working from the command line at the keyboard of a FreeBSD system will typically instead log into a virtual console.  This is because system messages are configured by default to display on the system console.  These messages will appear over the command or file that the user is working on, making it difficult to concentrate on the work at hand.ÚSè™½ç„¶ç³»ç»Ÿæ§åˆ¶å°å¯ä»¥ç”¨äºä¸ç³»ç»Ÿè¿›è¡Œäº¤äº’ï¼Œä½†åœ¨ FreeBSD ç³»ç»Ÿçš„é”®ç›˜å‘½ä»¤è¡Œä¸Šå·¥ä½œçš„ç”¨æˆ·é€šå¸¸ä¼šç™»å½•åˆ°è™šæ‹Ÿæ§åˆ¶å°ã€‚è¿™æ˜¯å› ä¸ºç³»ç»Ÿæ¶ˆæ¯é»˜è®¤é…ç½®ä¸ºæ˜¾ç¤ºåœ¨ç³»ç»Ÿæ§åˆ¶å°ä¸Šã€‚è¿™äº›æ¶ˆæ¯ä¼šå‡ºç°åœ¨ç”¨æˆ·æ­£åœ¨æ“ä½œçš„å‘½ä»¤æˆ–æ–‡ä»¶ä¸Šï¼Œä½¿å¾—é›†ä¸­æ³¨æ„åŠ›äºæ‰‹å¤´çš„å·¥ä½œå˜å¾—å›°éš¾ã€‚ÚLBy default, FreeBSD is configured to provide several virtual consoles for inputting commands.  Each virtual console has its own login prompt and shell and it is easy to switch between virtual consoles.  This essentially provides the command line equivalent of having several windows open at the same time in a graphical environment.Úé»˜è®¤æƒ…å†µä¸‹ï¼ŒFreeBSD é…ç½®äº†å¤šä¸ªè™šæ‹Ÿæ§åˆ¶å°ç”¨äºè¾“å…¥å‘½ä»¤ã€‚æ¯ä¸ªè™šæ‹Ÿæ§åˆ¶å°éƒ½æœ‰è‡ªå·±çš„ç™»å½•æç¤ºç¬¦å’Œ Shell ï¼Œå¹¶ä¸”å¯ä»¥è½»æ¾åœ°åœ¨è™šæ‹Ÿæ§åˆ¶å°ä¹‹é—´åˆ‡æ¢ã€‚è¿™åŸºæœ¬ä¸Šæä¾›äº†åœ¨å›¾å½¢ç¯å¢ƒä¸­åŒæ—¶æ‰“å¼€å¤šä¸ªçª—å£çš„å‘½ä»¤è¡Œç­‰æ•ˆåŠŸèƒ½ã€‚Ú»The key combinations kbd:[Alt+F1] through kbd:[Alt+F8] have been reserved by FreeBSD for switching between virtual consoles.  Use kbd:[Alt+F1] to switch to the system console (`ttyv0`), kbd:[Alt+F2] to access the first virtual console (`ttyv1`), kbd:[Alt+F3] to access the second virtual console (`ttyv2`), and so on.  When using Xorg as a graphical console, the combination becomes kbd:[Ctrl+Alt+F1] to return to a text-based virtual console.ÚÀç»„åˆé”® kbd:[Alt + F1] åˆ° kbd:[Alt + F8] å·²è¢« FreeBSD ä¿ç•™ç”¨äºåœ¨è™šæ‹Ÿæ§åˆ¶å°ä¹‹é—´åˆ‡æ¢ã€‚ä½¿ç”¨ kbd:[Alt + F1] åˆ‡æ¢åˆ°ç³»ç»Ÿæ§åˆ¶å°ï¼ˆ `ttyv0` ï¼‰ï¼Œä½¿ç”¨ kbd:[Alt + F2] è®¿é—®ç¬¬ä¸€ä¸ªè™šæ‹Ÿæ§åˆ¶å°ï¼ˆ `ttyv1` ï¼‰ï¼Œä½¿ç”¨ kbd:[Alt + F3] è®¿é—®ç¬¬äºŒä¸ªè™šæ‹Ÿæ§åˆ¶å°ï¼ˆ `ttyv2` ï¼‰ï¼Œä¾æ­¤ç±»æ¨ã€‚å½“ä½¿ç”¨ Xorg ä½œä¸ºå›¾å½¢æ§åˆ¶å°æ—¶ï¼Œç»„åˆé”®å˜ä¸º kbd:[Ctrl + Alt + F1] ä»¥è¿”å›åˆ°åŸºäºæ–‡æœ¬çš„è™šæ‹Ÿæ§åˆ¶å°ã€‚ÚSWhen switching from one console to the next, FreeBSD manages the screen output.  The result is an illusion of having multiple virtual screens and keyboards that can be used to type commands for FreeBSD to run.  The programs that are launched in one virtual console do not stop running when the user switches to a different virtual console.Úå½“ä»ä¸€ä¸ªæ§åˆ¶å°åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªæ§åˆ¶å°æ—¶ï¼ŒFreeBSD ä¼šç®¡ç†å±å¹•è¾“å‡ºã€‚ç»“æœæ˜¯æœ‰å¤šä¸ªè™šæ‹Ÿå±å¹•å’Œé”®ç›˜å¯ä»¥ç”¨æ¥é”®å…¥å‘½ä»¤ä»¥ä¾› FreeBSD è¿è¡Œã€‚å½“ç”¨æˆ·åˆ‡æ¢åˆ°ä¸åŒçš„è™šæ‹Ÿæ§åˆ¶å°æ—¶ï¼Œåœ¨ä¸€ä¸ªè™šæ‹Ÿæ§åˆ¶å°ä¸­å¯åŠ¨çš„ç¨‹åºä¸ä¼šåœæ­¢è¿è¡ŒÙbIn FreeBSD, the number of available virtual consoles is configured in this section of `/etc/ttys`:Ùjåœ¨ FreeBSD ä¸­ï¼Œå¯ç”¨çš„è™šæ‹Ÿæ§åˆ¶å°æ•°é‡æ˜¯åœ¨ `/etc/ttys` æ–‡ä»¶çš„è¿™ä¸ªéƒ¨åˆ†è¿›è¡Œé…ç½®çš„ï¼šÚ,To disable a virtual console, put a comment symbol (`+#+`) at the beginning of the line representing that virtual console.  For example, to reduce the number of available virtual consoles from eight to four, put a `+#+` in front of the last four lines representing virtual consoles `ttyv5` through `ttyv8`.  _Do not_ comment out the line for the system console `ttyv0`.  Note that the last virtual console (`ttyv8`) is used to access the graphical environment if Xorg has been installed and configured as described in crossref:x11[x11,The X Window System].Úùè¦ç¦ç”¨è™šæ‹Ÿæ§åˆ¶å°ï¼Œè¯·åœ¨è¡¨ç¤ºè¯¥è™šæ‹Ÿæ§åˆ¶å°çš„è¡Œçš„å¼€å¤´æ”¾ç½®ä¸€ä¸ªæ³¨é‡Šç¬¦å·ï¼ˆ `+#+` ï¼‰ã€‚ä¾‹å¦‚ï¼Œè¦å°†å¯ç”¨è™šæ‹Ÿæ§åˆ¶å°çš„æ•°é‡ä»å…«ä¸ªå‡å°‘åˆ°å››ä¸ªï¼Œè¯·åœ¨è¡¨ç¤ºè™šæ‹Ÿæ§åˆ¶å° `ttyv5` åˆ° `ttyv8` çš„æœ€åå››è¡Œå‰é¢æ”¾ç½®ä¸€ä¸ª `+#+` ã€‚ **ä¸è¦** æ³¨é‡Šæ‰ç³»ç»Ÿæ§åˆ¶å° `ttyv0` çš„è¡Œã€‚è¯·æ³¨æ„ï¼Œå¦‚æœå·²ç»å®‰è£…å¹¶é…ç½®äº† Xorg ï¼ˆå¦‚ crossref:x11[x11,X Window ç³»ç»Ÿ] ä¸­æ‰€è¿°ï¼‰ï¼Œåˆ™æœ€åä¸€ä¸ªè™šæ‹Ÿæ§åˆ¶å°ï¼ˆ `ttyv8` ï¼‰ç”¨äºè®¿é—®å›¾å½¢ç¯å¢ƒã€‚ÙFor a detailed description of every column in this file and the available options for the virtual consoles, refer to man:ttys[5].Ùjæœ‰å…³æ­¤æ–‡ä»¶ä¸­æ¯ä¸ªåˆ—çš„è¯¦ç»†æè¿°ä»¥åŠè™šæ‹Ÿæ§åˆ¶å°çš„å¯ç”¨é€‰é¡¹ï¼Œè¯·å‚é˜… man:ttys[5] ã€‚°Single User Mode¯å•ç”¨æˆ·æ¨¡å¼Ú«The FreeBSD boot menu provides an option labelled as "Boot Single User".  If this option is selected, the system will boot into a special mode known as "single user mode".  This mode is typically used to repair a system that will not boot or to reset the `root` password when it is not known.  While in single user mode, networking and other virtual consoles are not available.  However, full `root` access to the system is available, and by default, the `root` password is not needed.  For these reasons, physical access to the keyboard is needed to boot into this mode and determining who has physical access to the keyboard is something to consider when securing a FreeBSD system.ÚcFreeBSD å¼•å¯¼èœå•æä¾›äº†ä¸€ä¸ªæ ‡æœ‰â€œå•ç”¨æˆ·å¯åŠ¨â€çš„é€‰é¡¹ã€‚å¦‚æœé€‰æ‹©äº†è¿™ä¸ªé€‰é¡¹ï¼Œç³»ç»Ÿå°†å¯åŠ¨åˆ°ä¸€ä¸ªç§°ä¸ºâ€œå•ç”¨æˆ·æ¨¡å¼â€çš„ç‰¹æ®Šæ¨¡å¼ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œè¿™ä¸ªæ¨¡å¼ç”¨äºä¿®å¤æ— æ³•å¯åŠ¨çš„ç³»ç»Ÿæˆ–è€…åœ¨ä¸çŸ¥é“ `root` å¯†ç æ—¶é‡ç½®å¯†ç ã€‚åœ¨å•ç”¨æˆ·æ¨¡å¼ä¸‹ï¼Œç½‘ç»œå’Œå…¶ä»–è™šæ‹Ÿæ§åˆ¶å°æ˜¯ä¸å¯ç”¨çš„ã€‚ç„¶è€Œï¼Œç³»ç»Ÿå®Œå…¨æ”¯æŒ `root` è®¿é—®ï¼Œå¹¶ä¸”é»˜è®¤æƒ…å†µä¸‹ä¸éœ€è¦ `root` å¯†ç ã€‚å› æ­¤ï¼Œéœ€è¦æœ‰å¯¹é”®ç›˜çš„ç‰©ç†è®¿é—®æƒé™æ‰èƒ½è¿›å…¥è¯¥æ¨¡å¼ï¼Œç¡®å®šè°å¯¹é”®ç›˜æœ‰ç‰©ç†è®¿é—®æƒæ˜¯ä¿æŠ¤ FreeBSD ç³»ç»Ÿå®‰å…¨æ—¶éœ€è¦è€ƒè™‘çš„é—®é¢˜ÙUThe settings which control single user mode are found in this section of `/etc/ttys`:ÙIæ§åˆ¶å•ç”¨æˆ·æ¨¡å¼çš„è®¾ç½®ä½äº `/etc/ttys` æ–‡ä»¶çš„è¿™ä¸ªéƒ¨åˆ†ã€‚ÚÆBy default, the status is set to `secure`.  This assumes that who has physical access to the keyboard is either not important or it is controlled by a physical security policy.  If this setting is changed to `insecure`, the assumption is that the environment itself is insecure because anyone can access the keyboard.  When this line is changed to `insecure`, FreeBSD will prompt for the `root` password when a user selects to boot into single user mode.Úé»˜è®¤æƒ…å†µä¸‹ï¼ŒçŠ¶æ€è¢«è®¾ç½®ä¸º `secure`ã€‚è¿™æ„å‘³ç€å¯¹é”®ç›˜å…·æœ‰ç‰©ç†è®¿é—®æƒé™çš„äººè¦ä¹ˆä¸é‡è¦ï¼Œè¦ä¹ˆå—åˆ°ç‰©ç†å®‰å…¨ç­–ç•¥çš„æ§åˆ¶ã€‚å¦‚æœå°†æ­¤è®¾ç½®æ›´æ”¹ä¸º `insecure`ï¼Œåˆ™å‡è®¾ç¯å¢ƒæœ¬èº«æ˜¯ä¸å®‰å…¨çš„ï¼Œå› ä¸ºä»»ä½•äººéƒ½å¯ä»¥è®¿é—®é”®ç›˜ã€‚å½“å°†æ­¤è¡Œæ›´æ”¹ä¸º `insecure` æ—¶ï¼Œ FreeBSD å°†åœ¨ç”¨æˆ·é€‰æ‹©è¿›å…¥å•ç”¨æˆ·æ¨¡å¼æ—¶æç¤ºè¾“å…¥ `root` å¯†ç ã€‚Ùã_Be careful when changing this setting to `insecure`!_ If the `root` password is forgotten, booting into single user mode is still possible, but may be difficult for someone who is not familiar with the FreeBSD booting process.Ù¿åœ¨æ›´æ”¹æ­¤è®¾ç½®ä¸º `insecure` æ—¶è¦å°å¿ƒï¼å¦‚æœå¿˜è®°äº† `root` å¯†ç ï¼Œä»ç„¶å¯ä»¥å¯åŠ¨åˆ°å•ç”¨æˆ·æ¨¡å¼ï¼Œä½†å¯¹äºä¸ç†Ÿæ‚‰ FreeBSD å¯åŠ¨è¿‡ç¨‹çš„äººæ¥è¯´å¯èƒ½ä¼šæœ‰å›°éš¾ã€‚¼Changing Console Video Modes»æ›´æ”¹æ§åˆ¶å°è§†é¢‘æ¨¡å¼ÙÃThe FreeBSD console default video mode may be adjusted to 1024x768, 1280x1024, or any other size supported by the graphics chip and monitor.  To use a different video mode load the `VESA` module:Ù¾FreeBSD æ§åˆ¶å°çš„é»˜è®¤è§†é¢‘æ¨¡å¼å¯ä»¥è°ƒæ•´ä¸º 1024x768 ã€ 1280x1024 æˆ–å…¶ä»–ç”±å›¾å½¢èŠ¯ç‰‡å’Œæ˜¾ç¤ºå™¨æ”¯æŒçš„å°ºå¯¸ã€‚è¦ä½¿ç”¨ä¸åŒçš„è§†é¢‘æ¨¡å¼ï¼Œè¯·åŠ è½½ `VESA` æ¨¡å—ï¼šÙ‘To determine which video modes are supported by the hardware, use man:vidcontrol[1].  To get a list of supported video modes issue the following:Ùˆè¦ç¡®å®šç¡¬ä»¶æ”¯æŒå“ªäº›è§†é¢‘æ¨¡å¼ï¼Œè¯·ä½¿ç”¨ man:vidcontrol[1] ã€‚è¦è·å–æ”¯æŒçš„è§†é¢‘æ¨¡å¼åˆ—è¡¨ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼šÙ®The output of this command lists the video modes that are supported by the hardware.  To select a new video mode, specify the mode using man:vidcontrol[1] as the `root` user:ÙŸè¯¥å‘½ä»¤çš„è¾“å‡ºåˆ—å‡ºäº†ç¡¬ä»¶æ”¯æŒçš„è§†é¢‘æ¨¡å¼ã€‚è¦é€‰æ‹©ä¸€ä¸ªæ–°çš„è§†é¢‘æ¨¡å¼ï¼Œè¯·ä½¿ç”¨ man:vidcontrol[1] ä½œä¸º `root` ç”¨æˆ·æŒ‡å®šè¯¥æ¨¡å¼ï¼šÙfIf the new video mode is acceptable, it can be permanently set on boot by adding it to `/etc/rc.conf`:Ùmå¦‚æœæ–°çš„è§†é¢‘æ¨¡å¼å¯æ¥å—ï¼Œå¯ä»¥é€šè¿‡å°†å…¶æ·»åŠ åˆ° `/etc/rc.conf` æ¥åœ¨å¯åŠ¨æ—¶æ°¸ä¹…è®¾ç½®ã€‚Ù"Users and Basic Account Management»ç”¨æˆ·å’ŒåŸºæœ¬è´¦æˆ·ç®¡ç†Ú!FreeBSD allows multiple users to use the computer at the same time.  While only one user can sit in front of the screen and use the keyboard at any one time, any number of users can log in to the system through the network.  To use the system, each user should have their own user account.ÙïFreeBSD å…è®¸å¤šä¸ªç”¨æˆ·åŒæ—¶ä½¿ç”¨è®¡ç®—æœºã€‚è™½ç„¶ä¸€æ¬¡åªèƒ½æœ‰ä¸€ä¸ªç”¨æˆ·ååœ¨å±å¹•å‰ä½¿ç”¨é”®ç›˜ï¼Œä½†ä»»æ„æ•°é‡çš„ç”¨æˆ·å¯ä»¥é€šè¿‡ç½‘ç»œç™»å½•ç³»ç»Ÿã€‚ä¸ºäº†ä½¿ç”¨ç³»ç»Ÿï¼Œæ¯ä¸ªç”¨æˆ·éƒ½åº”è¯¥æœ‰è‡ªå·±çš„ç”¨æˆ·è´¦æˆ·ã€‚·This chapter describes:²æœ¬ç« æè¿°äº†ï¼šÙ9The different types of user accounts on a FreeBSD system.Ù2FreeBSD ç³»ç»Ÿä¸Šçš„ä¸åŒç±»å‹çš„ç”¨æˆ·è´¦æˆ·ã€‚Ù-How to add, remove, and modify user accounts.Ù-å¦‚ä½•æ·»åŠ ã€åˆ é™¤å’Œä¿®æ”¹ç”¨æˆ·è´¦æˆ·ã€‚ÙWHow to set limits to control the resources that users and groups are allowed to access.Ù?å¦‚ä½•è®¾ç½®é™åˆ¶ä»¥æ§åˆ¶ç”¨æˆ·å’Œç»„å¯ä»¥è®¿é—®çš„èµ„æºã€‚Ù9How to create groups and add users as members of a group.Ù3å¦‚ä½•åˆ›å»ºç»„å¹¶å°†ç”¨æˆ·æ·»åŠ ä¸ºç»„çš„æˆå‘˜ã€‚­Account Types¬è´¦æˆ·ç±»å‹ÙSince all access to the FreeBSD system is achieved using accounts and all processes are run by users, user and account management is important.Ùœç”±äºæ‰€æœ‰å¯¹ FreeBSD ç³»ç»Ÿçš„è®¿é—®éƒ½æ˜¯é€šè¿‡è´¦æˆ·å®ç°çš„ï¼Œå¹¶ä¸”æ‰€æœ‰è¿›ç¨‹éƒ½æ˜¯ç”±ç”¨æˆ·è¿è¡Œçš„ï¼Œå› æ­¤ç”¨æˆ·å’Œè´¦æˆ·ç®¡ç†éå¸¸é‡è¦ã€‚ÙbThere are three main types of accounts: system accounts, user accounts, and the superuser account.ÙTæœ‰ä¸‰ç§ä¸»è¦ç±»å‹çš„è´¦æˆ·ï¼šç³»ç»Ÿè´¦æˆ·ã€ç”¨æˆ·è´¦æˆ·å’Œè¶…çº§ç”¨æˆ·è´¦æˆ·ã€‚¯System Accounts¬ç³»ç»Ÿè´¦æˆ·Ù¸System accounts are used to run services such as DNS, mail, and web servers.  The reason for this is security; if all services ran as the superuser, they could act without restriction.ÙÏç³»ç»Ÿè´¦æˆ·ç”¨äºè¿è¡Œè¯¸å¦‚ DNSã€é‚®ä»¶å’Œ Web æœåŠ¡å™¨ç­‰æœåŠ¡ã€‚è¿™æ ·åšçš„åŸå› æ˜¯å‡ºäºå®‰å…¨è€ƒè™‘ï¼›å¦‚æœæ‰€æœ‰æœåŠ¡éƒ½ä»¥è¶…çº§ç”¨æˆ·èº«ä»½è¿è¡Œï¼Œå®ƒä»¬å°±å¯ä»¥æ— é™åˆ¶åœ°æ‰§è¡Œæ“ä½œã€‚ÙPExamples of system accounts are `daemon`, `operator`, `bind`, `news`, and `www`.ÙPç³»ç»Ÿè´¦æˆ·çš„ä¾‹å­åŒ…æ‹¬ `daemon`ã€`operator`ã€`bind`ã€`news` å’Œ `www`ã€‚ÙØ`nobody` is the generic unprivileged system account.  However, the more services that use `nobody`, the more files and processes that user will become associated with, and hence the more privileged that user becomes.Ù»`nobody` æ˜¯ä¸€ä¸ªé€šç”¨çš„éç‰¹æƒç³»ç»Ÿè´¦æˆ·ã€‚ç„¶è€Œï¼Œä½¿ç”¨ `nobody` çš„æœåŠ¡è¶Šå¤šï¼Œä¸è¯¥ç”¨æˆ·ç›¸å…³è”çš„æ–‡ä»¶å’Œè¿›ç¨‹ä¹Ÿå°±è¶Šå¤šï¼Œå› æ­¤è¯¥ç”¨æˆ·çš„ç‰¹æƒä¹Ÿå°±è¶Šé«˜ã€‚­User Accounts¬ç”¨æˆ·è´¦æˆ·ÚUser accounts are assigned to real people and are used to log in and use the system.  Every person accessing the system should have a unique user account.  This allows the administrator to find out who is doing what and prevents users from clobbering the settings of other users.Ùäç”¨æˆ·è´¦æˆ·åˆ†é…ç»™çœŸå®çš„äººï¼Œå¹¶ç”¨äºç™»å½•å’Œä½¿ç”¨ç³»ç»Ÿã€‚æ¯ä¸ªè®¿é—®ç³»ç»Ÿçš„äººéƒ½åº”è¯¥æ‹¥æœ‰ä¸€ä¸ªå”¯ä¸€çš„ç”¨æˆ·è´¦æˆ·ã€‚è¿™ä½¿ç®¡ç†å‘˜èƒ½å¤ŸæŸ¥æ˜è°åœ¨åšä»€ä¹ˆï¼Œå¹¶é˜²æ­¢ç”¨æˆ·ç ´åå…¶ä»–ç”¨æˆ·çš„è®¾ç½®ã€‚Ù£Each user can set up their own environment to accommodate their use of the system, by configuring their default shell, editor, key bindings, and language settings.Ùšæ¯ä¸ªç”¨æˆ·éƒ½å¯ä»¥è®¾ç½®è‡ªå·±çš„ç¯å¢ƒä»¥é€‚åº”ä»–ä»¬å¯¹ç³»ç»Ÿçš„ä½¿ç”¨ï¼Œé€šè¿‡é…ç½®ä»–ä»¬çš„é»˜è®¤ shell ã€ç¼–è¾‘å™¨ã€é”®ç»‘å®šå’Œè¯­è¨€è®¾ç½®ã€‚ÙREvery user account on a FreeBSD system has certain information associated with it:ÙNåœ¨ FreeBSD ç³»ç»Ÿä¸Šï¼Œæ¯ä¸ªç”¨æˆ·è´¦æˆ·éƒ½æœ‰ä¸ä¹‹å…³è”çš„ç‰¹å®šä¿¡æ¯ï¼šÚ"The User ID (UID) is a number used to uniquely identify the user to the FreeBSD system.  Commands that allow a user name to be specified will first convert it to the UID.  It is recommended to use a UID less than 65535, since higher values may cause compatibility issues with some software.Ùöç”¨æˆ· ID (UID) æ˜¯ä¸€ä¸ªç”¨äºåœ¨ FreeBSD ç³»ç»Ÿä¸­å”¯ä¸€æ ‡è¯†ç”¨æˆ·çš„æ•°å­—ã€‚å…è®¸æŒ‡å®šç”¨æˆ·åçš„å‘½ä»¤å°†é¦–å…ˆå°†å…¶è½¬æ¢ä¸º UID ã€‚å»ºè®®ä½¿ç”¨å°äº 65535 çš„ UID ï¼Œå› ä¸ºè¾ƒé«˜çš„å€¼å¯èƒ½ä¼šå¯¼è‡´æŸäº›è½¯ä»¶çš„å…¼å®¹æ€§é—®é¢˜ã€‚Ú¢The Group ID (GID) is a number used to uniquely identify the primary group that the user belongs to.  Groups are a mechanism for controlling access to resources based on a user's GID rather than their UID.  This can significantly reduce the size of some configuration files and allows users to be members of more than one group.  It is recommended to use a GID of 65535 or lower as higher GIDs may break some software.ÚTç»„ ID (GID) æ˜¯ä¸€ä¸ªç”¨äºå”¯ä¸€æ ‡è¯†ç”¨æˆ·æ‰€å±çš„ä¸»è¦ç»„çš„æ•°å­—ã€‚ç»„æ˜¯ä¸€ç§åŸºäºç”¨æˆ·çš„ GID è€Œä¸æ˜¯ UID æ¥æ§åˆ¶å¯¹èµ„æºè®¿é—®çš„æœºåˆ¶ã€‚è¿™å¯ä»¥æ˜¾è‘—å‡å°æŸäº›é…ç½®æ–‡ä»¶çš„å¤§å°ï¼Œå¹¶å…è®¸ç”¨æˆ·æˆä¸ºå¤šä¸ªç»„çš„æˆå‘˜ã€‚å»ºè®®ä½¿ç”¨ 65535 æˆ–æ›´ä½çš„ GID ï¼Œå› ä¸ºè¾ƒé«˜çš„ GID å¯èƒ½ä¼šç ´åæŸäº›è½¯ä»¶ã€‚ÙìLogin classes are an extension to the group mechanism that provide additional flexibility when tailoring the system to different users.  Login classes are discussed further in crossref:security[users-limiting,Configuring Login Classes].ÙÊç™»å½•åˆ†çº§æ˜¯ç»„æœºåˆ¶çš„æ‰©å±•ï¼Œä¸ºå®šåˆ¶ç³»ç»Ÿä»¥é€‚åº”ä¸åŒç”¨æˆ·æä¾›äº†é¢å¤–çš„çµæ´»æ€§ã€‚æœ‰å…³ç™»å½•ç±»çš„è¯¦ç»†è®¨è®ºï¼Œè¯·å‚é˜… crossref:security[users-limiting ,é…ç½®ç™»å½•åˆ†çº§] ã€‚ÙÆBy default, passwords do not expire.  However, password expiration can be enabled on a per-user basis, forcing some or all users to change their passwords after a certain amount of time has elapsed.Ù±é»˜è®¤æƒ…å†µä¸‹ï¼Œå¯†ç ä¸ä¼šè¿‡æœŸã€‚ç„¶è€Œï¼Œå¯ä»¥æ ¹æ®æ¯ä¸ªç”¨æˆ·çš„æƒ…å†µå¯ç”¨å¯†ç è¿‡æœŸåŠŸèƒ½ï¼Œå¼ºåˆ¶ä¸€äº›æˆ–æ‰€æœ‰ç”¨æˆ·åœ¨ä¸€å®šæ—¶é—´åæ›´æ”¹ä»–ä»¬çš„å¯†ç ã€‚ÚLBy default, FreeBSD does not expire accounts.  When creating accounts that need a limited lifespan, such as student accounts in a school, specify the account expiry date using man:pw[8].  After the expiry time has elapsed, the account cannot be used to log in to the system, although the account's directories and files will remain.Ú%é»˜è®¤æƒ…å†µä¸‹ï¼Œ FreeBSD ä¸ä¼šä½¿è´¦æˆ·è¿‡æœŸã€‚å½“åˆ›å»ºéœ€è¦æœ‰é™ç”Ÿå‘½å‘¨æœŸçš„è´¦æˆ·æ—¶ï¼Œæ¯”å¦‚å­¦æ ¡çš„å­¦ç”Ÿè´¦æˆ·ï¼Œå¯ä»¥ä½¿ç”¨ man:pw[8] å‘½ä»¤æŒ‡å®šè´¦æˆ·çš„è¿‡æœŸæ—¥æœŸã€‚åœ¨è¿‡æœŸæ—¶é—´åˆ°è¾¾åï¼Œè¯¥è´¦æˆ·å°†æ— æ³•ç”¨äºç™»å½•ç³»ç»Ÿï¼Œä½†è´¦æˆ·çš„ç›®å½•å’Œæ–‡ä»¶å°†ä¿ç•™ã€‚ÙæThe user name uniquely identifies the account to FreeBSD, but does not necessarily reflect the user's real name.  Similar to a comment, this information can contain spaces, uppercase characters, and be more than 8 characters long.ÙÀç”¨æˆ·ååœ¨ FreeBSD ä¸­å”¯ä¸€æ ‡è¯†è´¦æˆ·ï¼Œä½†ä¸ä¸€å®šåæ˜ ç”¨æˆ·çš„çœŸå®å§“åã€‚ä¸æ³¨é‡Šç±»ä¼¼ï¼Œæ­¤ä¿¡æ¯å¯ä»¥åŒ…å«ç©ºæ ¼ã€å¤§å†™å­—ç¬¦ï¼Œå¹¶ä¸”å¯ä»¥è¶…è¿‡ 8 ä¸ªå­—ç¬¦çš„é•¿åº¦ã€‚ÙåThe shell provides the user's default environment for interacting with the system.  There are many different kinds of shells and experienced users will have their own preferences, which can be reflected in their account settings.ÙÍShell æä¾›äº†ç”¨æˆ·ä¸ç³»ç»Ÿè¿›è¡Œäº¤äº’çš„é»˜è®¤ç¯å¢ƒã€‚æœ‰è®¸å¤šä¸åŒç±»å‹çš„ shell ï¼Œæœ‰ç»éªŒçš„ç”¨æˆ·ä¼šæ ¹æ®è‡ªå·±çš„åå¥½è¿›è¡Œè®¾ç½®ï¼Œè¿™äº›è®¾ç½®å¯ä»¥åæ˜ åœ¨ä»–ä»¬çš„è´¦æˆ·è®¾ç½®ä¸­ã€‚µThe Superuser Account²è¶…çº§ç”¨æˆ·è´¦æˆ·³UNIX(R) Permissions®UNIX(R) æƒé™¥Value£å€¼ªPermission¦æƒé™±Directory Listing¬ç›®å½•åˆ—è¡¨½No read, no write, no executeÙ*ç¦æ­¢è¯»å–ï¼Œç¦æ­¢å†™å…¥ï¼Œç¦æ­¢æ‰§è¡ŒºNo read, no write, executeÙ'ç¦æ­¢è¯»å–ï¼Œç¦æ­¢å†™å…¥ï¼Œå¯æ‰§è¡ŒºNo read, write, no executeÙ'ç¦æ­¢è¯»å–ï¼Œå¯å†™å…¥ï¼Œç¦æ­¢æ‰§è¡Œ·No read, write, executeÙ$ç¦æ­¢è¯»å–ï¼Œå¯å†™å…¥ï¼Œå¯æ‰§è¡ŒºRead, no write, no executeÙ'å¯è¯»å–ï¼Œç¦æ­¢å†™å…¥ï¼Œç¦æ­¢æ‰§è¡Œ·Read, no write, executeÙ$å¯è¯»å–ï¼Œç¦æ­¢å†™å…¥ï¼Œå¯æ‰§è¡Œ·Read, write, no executeÙ$å¯è¯»å–ã€å¯å†™å…¥ï¼Œç¦æ­¢æ‰§è¡Œ´Read, write, executeÙ!å¯è¯»å–ï¼Œå¯å†™å…¥ï¼Œå¯æ‰§è¡ŒÙéUse the `-l` argument with man:ls[1] to view a long directory listing that includes a column of information about a file's permissions for the owner, group, and everyone else.  For example, `ls -l` in an arbitrary directory may show:ÙÇä½¿ç”¨ `-l` å‚æ•°ä¸ `man:ls[1]` ä¸€èµ·ï¼Œå¯ä»¥æŸ¥çœ‹ä¸€ä¸ªåŒ…å«æœ‰å…³æ–‡ä»¶æ‰€æœ‰è€…ã€ç»„å’Œå…¶ä»–äººæƒé™çš„åˆ—çš„é•¿ç›®å½•åˆ—è¡¨ã€‚ä¾‹å¦‚ï¼Œåœ¨ä»»æ„ç›®å½•ä¸­ä½¿ç”¨ `ls -l` å¯èƒ½ä¼šæ˜¾ç¤ºï¼šÙŸA complete description of the file system hierarchy is available in man:hier[7].  The following table provides a brief overview of the most common directories.Ùyæ–‡ä»¶ç³»ç»Ÿå±‚æ¬¡ç»“æ„çš„å®Œæ•´æè¿°å¯ä»¥åœ¨ man:hier[7] ä¸­æ‰¾åˆ°ã€‚ä¸‹è¡¨æä¾›äº†æœ€å¸¸è§ç›®å½•çš„ç®€è¦æ¦‚è¿°ã€‚©Directory¦ç›®å½•«Description¦æè¿°Ù"Root directory of the file system.»æ–‡ä»¶ç³»ç»Ÿçš„æ ¹ç›®å½•ã€‚ÙKUser utilities fundamental to both single-user and multi-user environments.Ù9å•ç”¨æˆ·å’Œå¤šç”¨æˆ·ç¯å¢ƒçš„åŸºæœ¬ç”¨æˆ·å®ç”¨ç¨‹åºã€‚ÙHPrograms and configuration files used during operating system bootstrap.Ù<æ“ä½œç³»ç»Ÿå¼•å¯¼è¿‡ç¨‹ä¸­ä½¿ç”¨çš„ç¨‹åºå’Œé…ç½®æ–‡ä»¶ã€‚ÙJDefault boot configuration files. Refer to man:loader.conf[5] for details.ÙSé»˜è®¤çš„å¯åŠ¨é…ç½®æ–‡ä»¶ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… man:loader.conf[5] ã€‚Ù,Device special files managed by man:devfs[5]Ù/ç”± man:devfs[5] ç®¡ç†çš„è®¾å¤‡ç‰¹æ®Šæ–‡ä»¶ã€‚Ù'System configuration files and scripts.¾ç³»ç»Ÿé…ç½®æ–‡ä»¶å’Œè„šæœ¬ã€‚ÙCDefault system configuration files. Refer to man:rc[8] for details.ÙGé»˜è®¤ç³»ç»Ÿé…ç½®æ–‡ä»¶ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… man:rc[8] ã€‚ÙcScripts that run daily, weekly, and monthly, via man:cron[8]. Refer to man:periodic[8] for details.Ùoé€šè¿‡ man:cron[8] æ¯å¤©ã€æ¯å‘¨å’Œæ¯æœˆè¿è¡Œçš„è„šæœ¬ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… man:periodic[8] ã€‚ÙCCritical system libraries needed for binaries in `/bin` and `/sbin`ÙI`/bin` å’Œ `/sbin` ç›®å½•ä¸­çš„äºŒè¿›åˆ¶æ–‡ä»¶æ‰€éœ€çš„å…³é”®ç³»ç»Ÿåº“ã€‚µCritical system files²å…³é”®ç³»ç»Ÿæ–‡ä»¶ÙpContains subdirectories to be used as mount points for removable media such as CDs, USB drives, and floppy disksÙ[åŒ…å«ç”¨ä½œå¯ç§»åŠ¨ä»‹è´¨ï¼ˆå¦‚ CDã€USB é©±åŠ¨å™¨å’Œè½¯ç›˜ï¼‰çš„æŒ‚è½½ç‚¹çš„å­ç›®å½•ã€‚ÙREmpty directory commonly used by system administrators as a temporary mount point.Ù9ç©ºç›®å½•é€šå¸¸è¢«ç³»ç»Ÿç®¡ç†å‘˜ç”¨ä½œä¸´æ—¶æŒ‚è½½ç‚¹ã€‚Ù.Automounted NFS shares; see man:auto_master[5]Ù=è‡ªåŠ¨æŒ‚è½½çš„ NFS å…±äº«ï¼›è¯·å‚é˜… man:auto_master[5] ã€‚ÙMProcess file system. Refer to man:procfs[5], man:mount_procfs[8] for details.Ù]è¿›ç¨‹æ–‡ä»¶ç³»ç»Ÿã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… man:procfs[5] å’Œ man:mount_procfs[8] ã€‚ÙPStatically linked programs for emergency recovery as described in man:rescue[8].ÙHç”¨äºç´§æ€¥æ¢å¤çš„é™æ€é“¾æ¥ç¨‹åºï¼Œå¦‚ man:rescue[8] ä¸­æ‰€è¿°ã€‚Ù&Home directory for the `root` account.¼`root` è´¦æˆ·çš„ä¸»ç›®å½•ã€‚ÙiSystem programs and administration utilities fundamental to both single-user and multi-user environments.ÙBå•ç”¨æˆ·å’Œå¤šç”¨æˆ·ç¯å¢ƒçš„åŸºæœ¬ç³»ç»Ÿç¨‹åºå’Œç®¡ç†å·¥å…·ã€‚ÚTemporary files which are usually _not_ preserved across a system reboot. A memory-based file system is often mounted at `/tmp`. This can be automated using the tmpmfs-related variables of man:rc.conf[5] or with an entry in `/etc/fstab`; refer to man:mdmfs[8] for details.Ú é€šå¸¸åœ¨ç³»ç»Ÿé‡æ–°å¯åŠ¨åä¸ä¼šä¿ç•™çš„ä¸´æ—¶æ–‡ä»¶ã€‚åŸºäºå†…å­˜çš„æ–‡ä»¶ç³»ç»Ÿé€šå¸¸ä¼šæŒ‚è½½åœ¨ `/tmp` ç›®å½•ä¸‹ã€‚å¯ä»¥ä½¿ç”¨ man:rc.conf[5] ä¸­ä¸ tmpmfs ç›¸å…³çš„å˜é‡æˆ–åœ¨ `/etc/fstab` ä¸­æ·»åŠ æ¡ç›®æ¥è‡ªåŠ¨åŒ–æ­¤è¿‡ç¨‹ï¼›æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… man:mdmfs[8] ã€‚Ù0The majority of user utilities and applications.Ù'å¤§å¤šæ•°ç”¨æˆ·å·¥å…·å’Œåº”ç”¨ç¨‹åºã€‚Ù6Common utilities, programming tools, and applications.Ù-å¸¸ç”¨å·¥å…·ã€ç¼–ç¨‹å·¥å…·å’Œåº”ç”¨ç¨‹åºã€‚¹Standard C include files.¸æ ‡å‡†çš„ C å¤´æ–‡ä»¶ã€‚²Archive libraries.©åº“æ–‡ä»¶Ù!Miscellaneous utility data files.»æ‚é¡¹å®ç”¨æ•°æ®æ–‡ä»¶ã€‚Ù?System daemons and system utilities executed by other programs.ÙBç³»ç»Ÿå®ˆæŠ¤è¿›ç¨‹å’Œç”±å…¶ä»–ç¨‹åºæ‰§è¡Œçš„ç³»ç»Ÿå®ç”¨å·¥å…·ã€‚ÚfLocal executables and libraries. Also used as the default destination for the FreeBSD ports framework. Within `/usr/local`, the general layout sketched out by man:hier[7] for `/usr` should be used. Exceptions are the man directory, which is directly under `/usr/local` rather than under `/usr/local/share`, and the ports documentation is in `share/doc/port`.Ú%æœ¬åœ°å¯æ‰§è¡Œæ–‡ä»¶å’Œåº“ã€‚ä¹Ÿè¢«ç”¨ä½œ FreeBSD ports æ¡†æ¶çš„é»˜è®¤ç›®çš„åœ°ã€‚åœ¨ `/usr/local` ä¸­ï¼Œåº”ä½¿ç”¨ man:hier[7] ä¸º `/usr` é¢„è®¾çš„ä¸€èˆ¬å¸ƒå±€ã€‚man ç›®å½•ä¾‹å¤–ï¼Œå®ƒç›´æ¥ä½äº `/usr/local` è€Œä¸æ˜¯ `/usr/local/share` ä¸‹ï¼Œè€Œ ports æ–‡æ¡£ä½äº `share/doc/port` ä¸­ã€‚Ù(The FreeBSD Ports Collection (optional).Ù#FreeBSD Ports é›†åˆï¼ˆå¯é€‰ï¼‰ã€‚¿Architecture-independent files.Ù!ä¸ä½“ç³»ç»“æ„æ— å…³çš„æ–‡ä»¶ã€‚¾BSD and/or local source files.¹BSD æˆ–æœ¬åœ°æºæ–‡ä»¶ã€‚Ù9Multi-purpose log, temporary, transient, and spool files.Ù3å¤šç”¨é€”æ—¥å¿—ã€ä¸´æ—¶ã€æš‚å­˜å’Œæº¢å‡ºæ–‡ä»¶ã€‚ÙCTemporary files which are usually preserved across a system reboot.Ù0é€šå¸¸åœ¨ç³»ç»Ÿé‡å¯åä¿ç•™çš„ä¸´æ—¶æ–‡ä»¶ã€‚±Disk Organization¬ç£ç›˜ç»„ç»‡±Disk Device Names²ç£ç›˜è®¾å¤‡åç§°ªDrive Type¬é©±åŠ¨ç±»å‹±Drive Device Name²é©±åŠ¨è®¾å¤‡åç§°¸SATA and IDE hard drives³SATA å’Œ IDE ç¡¬ç›˜Ù(SCSI hard drives and USB storage devices¿SCSI ç¡¬ç›˜å’Œ USB å­˜å‚¨è®¾å¤‡¬NVMe storage«NVMe å­˜å‚¨ºSATA and IDE CD-ROM drives½SATA å’Œ IDE CD-ROM é©±åŠ¨å™¨²SCSI CD-ROM drivesµSCSI CD-ROM é©±åŠ¨å™¨­Floppy drives¯è½¯ç›˜é©±åŠ¨å™¨°SCSI tape drives´SCSI ç£å¸¦é©±åŠ¨å™¨«RAID drives®RAID é©±åŠ¨å™¨Ù¨Examples include `aacd` for Adaptec(R) AdvancedRAID, `mlxd` and `mlyd` for Mylex(R), `amrd` for AMI MegaRAID(R), `idad` for Compaq Smart RAID, `twed` for 3ware(R) RAID.Ù¦ä¾‹å¦‚ï¼ŒAdaptec(R) AdvancedRAID çš„ `aacd`ã€Mylex(R) çš„ `mlxd` å’Œ `mlyd`ã€AMI MegaRAID(R) çš„ `amrd`ã€Compaq Smart RAID çš„ `idad`ã€3ware(R) RAID çš„ `twed`ã€‚Ù'Sample Disk, Slice, and Partition NamesÙ$ç¤ºä¾‹ç£ç›˜ã€Slice å’Œåˆ†åŒºåç§°¤Name¦åç§°§Meaning¦æ„ä¹‰ÙTThe first partition (`a`) on the first slice (`s1`) on the first SATA disk (`ada0`).Ù^ç¬¬ä¸€ä¸ª SATA ç£ç›˜ï¼ˆ`ada0`ï¼‰ä¸Šçš„ç¬¬ä¸€ä¸ª sliceï¼ˆ`s1`ï¼‰ä¸Šç¬¬ä¸€ä¸ªåˆ†åŒºï¼ˆ`a`ï¼‰ã€‚ÙUThe fifth partition (`e`) on the second slice (`s2`) on the second SCSI disk (`da1`).Ù]ç¬¬äºŒä¸ª SCSI ç£ç›˜ï¼ˆ`da1`ï¼‰ä¸Šç¬¬äºŒä¸ª sliceï¼ˆ`s2`ï¼‰ä¸Šçš„ç¬¬äº”ä¸ªåˆ†åŒºï¼ˆ`e`ï¼‰ã€‚ºConceptual Model of a Diskµç£ç›˜çš„æ¦‚å¿µæ¨¡å‹Ú‡This diagram shows FreeBSD's view of the first SATA disk attached to the system.  Assume that the disk is 250 GB in size, and contains an 80 GB slice and a 170 GB slice (MS-DOS(R) partitions).  The first slice contains a Windows(R) NTFS file system, `C:`, and the second slice contains a FreeBSD installation.  This example FreeBSD installation has four data partitions and a swap partition.Ú‡è¿™ä¸ªå›¾ç¤ºå±•ç¤ºäº† FreeBSD å¯¹ç³»ç»Ÿä¸Šè¿æ¥çš„ç¬¬ä¸€ä¸ª SATA ç¡¬ç›˜çš„è§†å›¾ã€‚å‡è®¾è¯¥ç¡¬ç›˜çš„å®¹é‡ä¸º 250GB ï¼ŒåŒ…å«ä¸€ä¸ª 80GB çš„åˆ†åŒºå’Œä¸€ä¸ª 170GB çš„åˆ†åŒºï¼ˆMS-DOS(R) åˆ†åŒºï¼‰ã€‚ç¬¬ä¸€ä¸ªåˆ†åŒºåŒ…å«ä¸€ä¸ª Windows(R) NTFS æ–‡ä»¶ç³»ç»Ÿï¼Œå³ `C:`ï¼Œè€Œç¬¬äºŒä¸ªåˆ†åŒºåŒ…å«ä¸€ä¸ª FreeBSD å®‰è£…ã€‚è¿™ä¸ªç¤ºä¾‹çš„ FreeBSD å®‰è£…æœ‰å››ä¸ªæ•°æ®åˆ†åŒºå’Œä¸€ä¸ªäº¤æ¢åˆ†åŒºã€‚®The fstab File¬fstab æ–‡ä»¶ÙéDuring the boot process (crossref:boot[boot,The FreeBSD Booting Process]), file systems listed in `/etc/fstab` are automatically mounted except for the entries containing `noauto`.  This file contains entries in the following format:ÙÌåœ¨å¼•å¯¼è¿‡ç¨‹ä¸­ï¼ˆcrossref:boot[boot,FreeBSD å¼•å¯¼è¿‡ç¨‹]ï¼‰ï¼Œé™¤äº†åŒ…å« `noauto` æ¡ç›®çš„æ¡ç›®å¤–ï¼Œ`/etc/fstab` ä¸­åˆ—å‡ºçš„æ–‡ä»¶ç³»ç»Ÿä¼šè‡ªåŠ¨æŒ‚è½½ã€‚è¯¥æ–‡ä»¶ä»¥ä»¥ä¸‹æ ¼å¼åŒ…å«æ¡ç›®ï¼šÙ9An existing device name as explained in <<disks-naming>>.Ù<å¦‚ <<disks-naming>> ä¸­æ‰€è§£é‡Šçš„ï¼Œç°æœ‰è®¾å¤‡åç§°ã€‚Ù8An existing directory on which to mount the file system.Ù3ä¸€ä¸ªç°æœ‰çš„ç›®å½•ï¼Œç”¨äºæŒ‚è½½æ–‡ä»¶ç³»ç»Ÿã€‚ÙXThe file system type to pass to man:mount[8].  The default FreeBSD file system is `ufs`.ÙYä¼ é€’ç»™ man:mount[8] çš„æ–‡ä»¶ç³»ç»Ÿç±»å‹ã€‚é»˜è®¤çš„ FreeBSD æ–‡ä»¶ç³»ç»Ÿæ˜¯ `ufs`ã€‚ÚEither `rw` for read-write file systems, or `ro` for read-only file systems, followed by any other options that may be needed.  A common option is `noauto` for file systems not normally mounted during the boot sequence.  Other options are listed in man:mount[8].Úå¯ä»¥é€‰æ‹© `rw` è¡¨ç¤ºè¯»å†™æ–‡ä»¶ç³»ç»Ÿï¼Œæˆ–è€… `ro` è¡¨ç¤ºåªè¯»æ–‡ä»¶ç³»ç»Ÿï¼Œåé¢å¯ä»¥æ·»åŠ å…¶ä»–å¯èƒ½éœ€è¦çš„é€‰é¡¹ã€‚å¸¸è§çš„é€‰é¡¹æ˜¯ `noauto` ï¼Œç”¨äºåœ¨å¯åŠ¨åºåˆ—æœŸé—´é€šå¸¸ä¸æŒ‚è½½çš„æ–‡ä»¶ç³»ç»Ÿã€‚å…¶ä»–é€‰é¡¹å¯ä»¥åœ¨ man:mount[8] ä¸­æ‰¾åˆ°ã€‚ÙzUsed by man:dump[8] to determine which file systems require dumping.  If the field is missing, a value of zero is assumed.Ùxman:dump[8] ä½¿ç”¨æ­¤å­—æ®µæ¥ç¡®å®šå“ªäº›æ–‡ä»¶ç³»ç»Ÿéœ€è¦è¿›è¡Œå¤‡ä»½ã€‚å¦‚æœè¯¥å­—æ®µç¼ºå¤±ï¼Œåˆ™é»˜è®¤ä¸ºé›¶å€¼ã€‚ÚÕDetermines the order in which UFS file systems should be checked by man:fsck[8] after a reboot.  File systems that should be skipped should have their `passno` set to zero.  The root file system needs to be checked before everything else and should have its `passno` set to one.  The other file systems should be set to values greater than one.  If more than one file system has the same `passno`, man:fsck[8] will attempt to check file systems in parallel if possible.ÚÁç¡®å®šåœ¨é‡æ–°å¯åŠ¨åï¼Œman:fsck[8] åº”è¯¥æŒ‰ç…§ä»€ä¹ˆé¡ºåºæ£€æŸ¥ UFS æ–‡ä»¶ç³»ç»Ÿã€‚åº”è¯¥è·³è¿‡çš„æ–‡ä»¶ç³»ç»Ÿåº”è¯¥å°†å…¶ `passno` è®¾ç½®ä¸ºé›¶ã€‚æ ¹æ–‡ä»¶ç³»ç»Ÿéœ€è¦åœ¨å…¶ä»–æ‰€æœ‰æ–‡ä»¶ç³»ç»Ÿä¹‹å‰è¿›è¡Œæ£€æŸ¥ï¼Œå¹¶ä¸”å…¶ `passno` åº”è¯¥è®¾ç½®ä¸ºä¸€ã€‚å…¶ä»–æ–‡ä»¶ç³»ç»Ÿçš„ `passno` åº”è¯¥è®¾ç½®ä¸ºå¤§äºä¸€çš„å€¼ã€‚å¦‚æœæœ‰å¤šä¸ªæ–‡ä»¶ç³»ç»Ÿå…·æœ‰ç›¸åŒçš„ `passno`ï¼Œman:fsck[8] å°†å°è¯•åœ¨å¯èƒ½çš„æƒ…å†µä¸‹å¹¶è¡Œæ£€æŸ¥æ–‡ä»¶ç³»ç»Ÿã€‚ÙYRefer to man:fstab[5] for more information on the format of `/etc/fstab` and its options.ÙXè¯·å‚è€ƒ man:fstab[5] ä»¥è·å–æœ‰å…³ `/etc/fstab` æ ¼å¼åŠå…¶é€‰é¡¹çš„æ›´å¤šä¿¡æ¯ã€‚¼Common Environment Variablesµå¸¸è§çš„ç¯å¢ƒå˜é‡¨Variable¦å˜é‡¾Current logged in user's name.¾å½“å‰ç™»å½•ç”¨æˆ·çš„åç§°ã€‚Ù;Colon-separated list of directories to search for binaries.Ù?ä»¥å†’å·åˆ†éš”çš„ç›®å½•åˆ—è¡¨ï¼Œç”¨äºæœç´¢äºŒè¿›åˆ¶æ–‡ä»¶ã€‚Ù=Network name of the Xorg display to connect to, if available.Ù<å¦‚æœå¯ç”¨ï¼Œè¿æ¥åˆ°çš„ Xorg æ˜¾ç¤ºå™¨çš„ç½‘ç»œåç§°ã€‚²The current shell.³å½“å‰çš„ Shell ã€‚Ù\The name of the user's type of terminal. Used to determine the capabilities of the terminal.Ù<ç”¨æˆ·ç»ˆç«¯çš„ç±»å‹åç§°ã€‚ç”¨äºç¡®å®šç»ˆç«¯çš„åŠŸèƒ½ã€‚ÙRDatabase entry of the terminal escape codes to perform various terminal functions.ÙEç»ˆç«¯è½¬ä¹‰ç çš„æ•°æ®åº“æ¡ç›®ï¼Œç”¨äºæ‰§è¡Œå„ç§ç»ˆç«¯åŠŸèƒ½ã€‚¾The system's CPU architecture.·ç³»ç»Ÿçš„ CPU æ¶æ„ã€‚Ù!The user's preferred text editor.Ù!ç”¨æˆ·é¦–é€‰çš„æ–‡æœ¬ç¼–è¾‘å™¨ã€‚ÙAThe user's preferred utility for viewing text one page at a time.Ù3ç”¨æˆ·é¦–é€‰çš„é€é¡µæŸ¥çœ‹æ–‡æœ¬çš„å®ç”¨å·¥å…·ã€‚Ù?Colon-separated list of directories to search for manual pages.Ù9ä»¥å†’å·åˆ†éš”çš„ç›®å½•åˆ—è¡¨ï¼Œç”¨äºæœç´¢æ‰‹å†Œé¡µã€‚±Lists Basic Rules²åˆ—è¡¨åŸºæœ¬è§„åˆ™Ù+If text/plain does not accompany text/html:Ù(å¦‚æœ text/plain ä¸é™„å¸¦ text/htmlï¼šÙ¬Refer to man:kbdcontrol[1], man:vidcontrol[1], man:atkbd[4], man:syscons[4], and man:vt[4] for a more technical description of the FreeBSD console and its keyboard drivers.Ù¸è¯·å‚è€ƒ man:kbdcontrol[1] ã€ man:vidcontrol[1] ã€ man:atkbd[4] ã€ man:syscons[4] å’Œ man:vt[4] ï¼Œä»¥è·å–æ›´è¯¦ç»†çš„ FreeBSD æ§åˆ¶å°åŠå…¶é”®ç›˜é©±åŠ¨ç¨‹åºçš„æŠ€æœ¯æè¿°ã€‚ÚXThe user name is typed at the `login:` prompt.  Each user must have a unique user name.  There are a number of rules for creating valid user names which are documented in man:passwd[5].  It is recommended to use user names that consist of eight or fewer, all lower case characters in order to maintain backwards compatibility with applications.Ú-ç”¨æˆ·åç§°æ˜¯åœ¨ `login:` æç¤ºå¤„è¾“å…¥çš„ã€‚æ¯ä¸ªç”¨æˆ·å¿…é¡»æœ‰ä¸€ä¸ªå”¯ä¸€çš„ç”¨æˆ·åã€‚æœ‰ä¸€äº›åˆ›å»ºæœ‰æ•ˆç”¨æˆ·åçš„è§„åˆ™ï¼Œè¿™äº›è§„åˆ™åœ¨ man:passwd[5] ä¸­æœ‰è¯¦ç»†è¯´æ˜ã€‚å»ºè®®ä½¿ç”¨ç”±å…«ä¸ªæˆ–æ›´å°‘ä¸ªå°å†™å­—ç¬¦ç»„æˆçš„ç”¨æˆ·åï¼Œä»¥ä¿æŒä¸åº”ç”¨ç¨‹åºçš„å‘åå…¼å®¹æ€§ã€‚Ù(Each account has an associated password.Ù*æ¯ä¸ªè´¦æˆ·éƒ½æœ‰ä¸€ä¸ªå…³è”çš„å¯†ç ã€‚Ú?The home directory is the full path to a directory on the system.  This is the user's starting directory when the user logs in.  A common convention is to put all user home directories under `/home/username` or `/usr/home/username`.  Each user stores their personal files and subdirectories in their own home directory.Ú	ä¸»ç›®å½•æ˜¯ç³»ç»Ÿä¸Šä¸€ä¸ªç›®å½•çš„å®Œæ•´è·¯å¾„ã€‚è¿™æ˜¯ç”¨æˆ·ç™»å½•æ—¶çš„èµ·å§‹ç›®å½•ã€‚ä¸€ä¸ªå¸¸è§çš„çº¦å®šæ˜¯å°†æ‰€æœ‰ç”¨æˆ·çš„ä¸»ç›®å½•æ”¾åœ¨ `/home/username` æˆ– `/usr/home/username` ä¸‹ã€‚æ¯ä¸ªç”¨æˆ·åœ¨è‡ªå·±çš„ä¸»ç›®å½•ä¸­å­˜å‚¨ä¸ªäººæ–‡ä»¶å’Œå­ç›®å½•ã€‚ÙşThe superuser account, usually called `root`, is used to manage the system with no limitations on privileges.  For this reason, it should not be used for day-to-day tasks like sending and receiving mail, general exploration of the system, or programming.Ù³è¶…çº§ç”¨æˆ·è´¦æˆ·é€šå¸¸è¢«ç§°ä¸º `root` ï¼Œç”¨äºæ— é™åˆ¶åœ°ç®¡ç†ç³»ç»Ÿã€‚å› æ­¤ï¼Œä¸åº”å°†å…¶ç”¨äºæ—¥å¸¸ä»»åŠ¡ï¼Œå¦‚å‘é€å’Œæ¥æ”¶é‚®ä»¶ã€ç³»ç»Ÿçš„ä¸€èˆ¬æ¢ç´¢æˆ–ç¼–ç¨‹ã€‚ÚOThe superuser, unlike other user accounts, can operate without limits, and misuse of the superuser account may result in spectacular disasters.  User accounts are unable to destroy the operating system by mistake, so it is recommended to login as a user account and to only become the superuser when a command requires extra privilege.Úä¸å…¶ä»–ç”¨æˆ·è´¦æˆ·ä¸åŒï¼Œè¶…çº§ç”¨æˆ·å¯ä»¥æ— é™åˆ¶åœ°æ“ä½œï¼Œæ»¥ç”¨è¶…çº§ç”¨æˆ·è´¦æˆ·å¯èƒ½å¯¼è‡´ç¾éš¾æ€§åæœã€‚ç”¨æˆ·è´¦æˆ·æ— æ³•é€šè¿‡é”™è¯¯æ“ä½œé”€æ¯æ“ä½œç³»ç»Ÿï¼Œå› æ­¤å»ºè®®ä»¥ç”¨æˆ·è´¦æˆ·ç™»å½•ï¼Œå¹¶ä¸”åªåœ¨éœ€è¦é¢å¤–æƒé™çš„å‘½ä»¤æ—¶åˆ‡æ¢ä¸ºè¶…çº§ç”¨æˆ·ã€‚ÙAlways double and triple-check any commands issued as the superuser, since an extra space or missing character can mean irreparable data loss.Ù“ä½œä¸ºè¶…çº§ç”¨æˆ·ï¼Œå§‹ç»ˆè¦ä»”ç»†æ£€æŸ¥ä»»ä½•å‘å‡ºçš„å‘½ä»¤ï¼Œå› ä¸ºé¢å¤–çš„ç©ºæ ¼æˆ–ç¼ºå¤±çš„å­—ç¬¦å¯èƒ½å¯¼è‡´æ— æ³•ä¿®å¤çš„æ•°æ®ä¸¢å¤±ã€‚ÙpThere are several ways to gain superuser privilege.  While one can log in as `root`, this is highly discouraged.Ùtæœ‰å‡ ç§æ–¹æ³•å¯ä»¥è·å¾—è¶…çº§ç”¨æˆ·æƒé™ã€‚è™½ç„¶å¯ä»¥ä½¿ç”¨ `root` è´¦æˆ·ç™»å½•ï¼Œä½†è¿™æ˜¯æä¸æ¨èçš„ã€‚Ú5Instead, use man:su[1] to become the superuser.  If `-` is specified when running this command, the user will also inherit the root user's environment.  The user running this command must be in the `wheel` group or else the command will fail.  The user must also know the password for the `root` user account.Úç›¸åï¼Œä½¿ç”¨ man:su[1] å‘½ä»¤æˆä¸ºè¶…çº§ç”¨æˆ·ã€‚å¦‚æœåœ¨è¿è¡Œæ­¤å‘½ä»¤æ—¶æŒ‡å®šäº† `-` ï¼Œç”¨æˆ·è¿˜å°†ç»§æ‰¿ root ç”¨æˆ·çš„ç¯å¢ƒã€‚è¿è¡Œæ­¤å‘½ä»¤çš„ç”¨æˆ·å¿…é¡»å±äº `wheel` ç»„ï¼Œå¦åˆ™å‘½ä»¤å°†å¤±è´¥ã€‚ç”¨æˆ·è¿˜å¿…é¡»çŸ¥é“ `root` ç”¨æˆ·è´¦æˆ·çš„å¯†ç ã€‚ÙÿIn this example, the user only becomes superuser in order to run `make install` as this step requires superuser privilege.  Once the command completes, the user types `exit` to leave the superuser account and return to the privilege of their user account.Ùíåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œç”¨æˆ·åªæ˜¯ä¸ºäº†è¿è¡Œ `make install` è¿™ä¸ªæ­¥éª¤éœ€è¦è¶…çº§ç”¨æˆ·æƒé™ï¼Œæ‰æˆä¸ºè¶…çº§ç”¨æˆ·ã€‚ä¸€æ—¦å‘½ä»¤å®Œæˆï¼Œç”¨æˆ·è¾“å…¥ `exit` æ¥é€€å‡ºè¶…çº§ç”¨æˆ·è´¦æˆ·ï¼Œè¿”å›åˆ°ä»–ä»¬çš„ç”¨æˆ·è´¦æˆ·çš„æƒé™ã€‚Ù"Install a Program As the SuperuserÙ!ä»¥è¶…çº§ç”¨æˆ·èº«ä»½å®‰è£…ç¨‹åºÚGThe built-in man:su[1] framework works well for single systems or small networks with just one system administrator.  An alternative is to install the package:security/sudo[] package or port.  This software provides activity logging and allows the administrator to configure which users can run which commands as the superuser.Úå†…ç½®çš„ man:su[1] æ¡†æ¶é€‚ç”¨äºå•ä¸ªç³»ç»Ÿæˆ–åªæœ‰ä¸€ä¸ªç³»ç»Ÿç®¡ç†å‘˜çš„å°å‹ç½‘ç»œã€‚å¦ä¸€ç§é€‰æ‹©æ˜¯å®‰è£… package:security/sudo[] è½¯ä»¶åŒ…æˆ– portã€‚è¯¥è½¯ä»¶æä¾›æ´»åŠ¨æ—¥å¿—è®°å½•ï¼Œå¹¶å…è®¸ç®¡ç†å‘˜é…ç½®å“ªäº›ç”¨æˆ·å¯ä»¥ä»¥è¶…çº§ç”¨æˆ·èº«ä»½è¿è¡Œå“ªäº›å‘½ä»¤ã€‚±Managing Accounts¬ç®¡ç†è´¦æˆ·Ú	FreeBSD provides a variety of different commands to manage user accounts.  The most common commands are summarized in <<users-modifying-utilities>>, followed by some examples of their usage.  See the manual page for each utility for more details and usage examples.ÙÿFreeBSD æä¾›äº†å¤šç§ä¸åŒçš„å‘½ä»¤æ¥ç®¡ç†ç”¨æˆ·è´¦æˆ·ã€‚æœ€å¸¸è§çš„å‘½ä»¤åœ¨ <<users-modifying-utilities>> ä¸­è¿›è¡Œäº†æ€»ç»“ï¼Œå¹¶é™„æœ‰ä¸€äº›ä½¿ç”¨ç¤ºä¾‹ã€‚æœ‰å…³æ¯ä¸ªå®ç”¨ç¨‹åºçš„æ›´å¤šè¯¦ç»†ä¿¡æ¯å’Œä½¿ç”¨ç¤ºä¾‹ï¼Œè¯·å‚é˜…å…¶æ‰‹å†Œé¡µé¢ã€‚Ù$Utilities for Managing User AccountsÙ!ç®¡ç†ç”¨æˆ·è´¦æˆ·çš„å®ç”¨å·¥å…·§Command¦å‘½ä»¤§Summary¦æ‘˜è¦Ù>The recommended command-line application for adding new users.Ù6ç”¨äºæ·»åŠ æ–°ç”¨æˆ·çš„æ¨èå‘½ä»¤è¡Œåº”ç”¨ç¨‹åºã€‚Ù<The recommended command-line application for removing users.Ù3ç”¨äºåˆ é™¤ç”¨æˆ·çš„æ¨èå‘½ä»¤è¡Œåº”ç”¨ç¨‹åºã€‚Ù7A flexible tool for changing user database information.Ù3ç”¨äºæ›´æ”¹ç”¨æˆ·æ•°æ®åº“ä¿¡æ¯çš„çµæ´»å·¥å…·ã€‚Ù/The command-line tool to change user passwords.Ù-ç”¨äºæ›´æ”¹ç”¨æˆ·å¯†ç çš„å‘½ä»¤è¡Œå·¥å…·ã€‚ÙHA powerful and flexible tool for modifying all aspects of user accounts.ÙKåŠŸèƒ½å¼ºå¤§è€Œçµæ´»çš„å·¥å…·ï¼Œå¯å¯¹ç”¨æˆ·è´¦æˆ·è¿›è¡Œå…¨æ–¹ä½ä¿®æ”¹ã€‚Ù?A system configuration utility with account management support.Ù0å…·æœ‰è´¦æˆ·ç®¡ç†æ”¯æŒçš„ç³»ç»Ÿé…ç½®å·¥å…·ã€‚­Adding a user¬æ·»åŠ ç”¨æˆ·ÚwThe recommended program for adding new users is man:adduser[8].  When a new user is added, this program automatically updates `/etc/passwd` and `/etc/group`.  It also creates a home directory for the new user, copies in the default configuration files from `/usr/share/skel`, and can optionally mail the new user a welcome message.  This utility must be run as the superuser.ÚWæ·»åŠ æ–°ç”¨æˆ·çš„æ¨èç¨‹åºæ˜¯ man:adduser[8] ã€‚å½“æ·»åŠ æ–°ç”¨æˆ·æ—¶ï¼Œè¯¥ç¨‹åºä¼šè‡ªåŠ¨æ›´æ–° `/etc/passwd` å’Œ `/etc/group` æ–‡ä»¶ã€‚å®ƒè¿˜ä¼šä¸ºæ–°ç”¨æˆ·åˆ›å»ºä¸€ä¸ªå®¶ç›®å½•ï¼Œå¹¶ä» `/usr/share/skel` ç›®å½•ä¸­å¤åˆ¶é»˜è®¤é…ç½®æ–‡ä»¶ï¼Œå¹¶å¯é€‰æ‹©å‘æ–°ç”¨æˆ·å‘é€æ¬¢è¿æ¶ˆæ¯ã€‚æ­¤å®ç”¨ç¨‹åºå¿…é¡»ä»¥è¶…çº§ç”¨æˆ·èº«ä»½è¿è¡Œã€‚ÚÍThe man:adduser[8] utility is interactive and walks through the steps for creating a new user account.  As seen in <<users-modifying-adduser>>, either input the required information or press kbd:[Return] to accept the default value shown in square brackets.  In this example, the user has been invited into the `wheel` group, allowing them to become the superuser with man:su[1].  When finished, the utility will prompt to either create another user or to exit.Ú¤man:adduser[8] å®ç”¨ç¨‹åºæ˜¯äº¤äº’å¼çš„ï¼Œå¹¶ä¸”ä¼šå¼•å¯¼ç”¨æˆ·å®Œæˆåˆ›å»ºæ–°ç”¨æˆ·è´¦æˆ·çš„æ­¥éª¤ã€‚å¦‚åœ¨ <<users-modifying-adduser>> ä¸­æ‰€ç¤ºï¼Œå¯ä»¥è¾“å…¥æ‰€éœ€ä¿¡æ¯ï¼Œæˆ–æŒ‰ kbd:[Return] é”®æ¥å—æ–¹æ‹¬å·ä¸­æ˜¾ç¤ºçš„é»˜è®¤å€¼ã€‚åœ¨æœ¬ç¤ºä¾‹ä¸­ï¼Œç”¨æˆ·å·²è¢«é‚€è¯·åŠ å…¥ `wheel` ç»„ï¼Œå…è®¸ä»–ä»¬é€šè¿‡ man:su[1] æˆä¸ºè¶…çº§ç”¨æˆ·ã€‚å®Œæˆåï¼Œå®ç”¨ç¨‹åºå°†æç¤ºæ˜¯å¦åˆ›å»ºå¦ä¸€ä¸ªç”¨æˆ·æˆ–é€€å‡ºã€‚¸Adding a User on FreeBSD»åœ¨ FreeBSD ä¸Šæ·»åŠ ç”¨æˆ·Ù.The output should be similar to the following:Ù$è¾“å‡ºåº”è¯¥ç±»ä¼¼äºä»¥ä¸‹å†…å®¹ï¼šÙsSince the password is not echoed when typed, be careful to not mistype the password when creating the user account.Ùlç”±äºå¯†ç åœ¨è¾“å…¥æ—¶ä¸ä¼šæ˜¾ç¤ºå‡ºæ¥ï¼Œè¯·åœ¨åˆ›å»ºç”¨æˆ·è´¦æˆ·æ—¶å°å¿ƒä¸è¦è¾“å…¥é”™è¯¯çš„å¯†ç ã€‚¯Removing a user¬åˆ é™¤ç”¨æˆ·Ù|To completely remove a user from the system, run man:rmuser[8] as the superuser.  This command performs the following steps:Ùrè¦å®Œå…¨ä»ç³»ç»Ÿä¸­åˆ é™¤ç”¨æˆ·ï¼Œè¯·ä»¥è¶…çº§ç”¨æˆ·èº«ä»½è¿è¡Œ man:rmuser[8] ã€‚è¯¥å‘½ä»¤æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼šÙ7Removes the user's man:crontab[1] entry, if one exists.Ù=å¦‚æœå­˜åœ¨ç”¨æˆ·çš„ man:crontab[1] æ¡ç›®ï¼Œåˆ™åˆ é™¤å®ƒã€‚Ù1Removes any man:at[1] jobs belonging to the user.Ù/åˆ é™¤ç”¨æˆ·æ‹¥æœ‰çš„æ‰€æœ‰ man:at[1] ä½œä¸šã€‚Ù:Sends a SIGKILL signal to all processes owned by the user.Ù6å‘ç”¨æˆ·æ‹¥æœ‰çš„æ‰€æœ‰è¿›ç¨‹å‘é€ SIGKILL ä¿¡å·ã€‚Ù7Removes the user from the system's local password file.Ù0ä»ç³»ç»Ÿçš„æœ¬åœ°å¯†ç æ–‡ä»¶ä¸­åˆ é™¤ç”¨æˆ·ã€‚ÙRemoves the user's home directory (if it is owned by the user), including handling of symbolic links in the path to the actual home directory.Ùåˆ é™¤ç”¨æˆ·çš„ä¸»ç›®å½•ï¼ˆå¦‚æœè¯¥ç›®å½•å±äºè¯¥ç”¨æˆ·ï¼‰ï¼ŒåŒ…æ‹¬å¤„ç†è·¯å¾„ä¸­ç¬¦å·é“¾æ¥æŒ‡å‘å®é™…ä¸»ç›®å½•çš„æƒ…å†µã€‚ÙGRemoves the incoming mail files belonging to the user from `/var/mail`.ÙCä» `/var/mail` ç›®å½•ä¸­åˆ é™¤å±äºç”¨æˆ·çš„ä¼ å…¥é‚®ä»¶æ–‡ä»¶ã€‚ÙWRemoves all files owned by the user from `/tmp`, `/var/tmp`, and `/var/tmp/vi.recover`.ÙYä» `/tmp`ã€`/var/tmp` å’Œ `/var/tmp/vi.recover` ä¸­åˆ é™¤ç”¨æˆ·æ‰€æœ‰æ‹¥æœ‰çš„æ–‡ä»¶ã€‚ÙäRemoves the username from all groups to which it belongs in `/etc/group`. (If a group becomes empty and the group name is the same as the username, the group is removed; this complements man:adduser[8]'s per-user unique groups.)ÙÌå°†ç”¨æˆ·åä» `/etc/group` ä¸­æ‰€å±çš„æ‰€æœ‰ç»„ä¸­åˆ é™¤ã€‚ï¼ˆå¦‚æœä¸€ä¸ªç»„å˜ä¸ºç©ºï¼Œå¹¶ä¸”ç»„åä¸ç”¨æˆ·åç›¸åŒï¼Œåˆ™åˆ é™¤è¯¥ç»„ï¼›è¿™ä¸ man:adduser[8] çš„æ¯ä¸ªç”¨æˆ·å”¯ä¸€ç»„ç›¸å¯¹åº”ã€‚ï¼‰ÙTRemoves all message queues, shared memory segments and semaphores owned by the user.ÙHåˆ é™¤ç”¨æˆ·æ‹¥æœ‰çš„æ‰€æœ‰æ¶ˆæ¯é˜Ÿåˆ—ã€å…±äº«å†…å­˜æ®µå’Œä¿¡å·é‡ã€‚Ù{man:rmuser[8] cannot be used to remove superuser accounts since that is almost always an indication of massive destruction.Ùnman:rmuser[8] ä¸èƒ½ç”¨äºåˆ é™¤è¶…çº§ç”¨æˆ·è´¦æˆ·ï¼Œå› ä¸ºè¿™å‡ ä¹æ€»æ˜¯æ„å‘³ç€å¤§è§„æ¨¡ç ´åçš„è¿¹è±¡ã€‚ÙKBy default, an interactive mode is used, as shown in the following example.Ù9é»˜è®¤æƒ…å†µä¸‹ï¼Œä½¿ç”¨äº¤äº’æ¨¡å¼ï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤ºã€‚Ù$`rmuser` Interactive Account Removal¾`rmuser` äº¤äº’å¼è´¦æˆ·åˆ é™¤·Change user information²æ›´æ”¹ç”¨æˆ·ä¿¡æ¯ÙÔAny user can use man:chpass[1] to change their default shell and personal information associated with their user account.  The superuser can use this utility to change additional account information for any user.ÙÊä»»ä½•ç”¨æˆ·éƒ½å¯ä»¥ä½¿ç”¨ man:chpass[1] å‘½ä»¤æ¥æ›´æ”¹å…¶é»˜è®¤ shell å’Œä¸å…¶ç”¨æˆ·è´¦æˆ·å…³è”çš„ä¸ªäººä¿¡æ¯ã€‚è¶…çº§ç”¨æˆ·å¯ä»¥ä½¿ç”¨æ­¤å®ç”¨ç¨‹åºæ¥æ›´æ”¹ä»»ä½•ç”¨æˆ·çš„å…¶ä»–è´¦æˆ·ä¿¡æ¯ã€‚ÙÓWhen passed no options, aside from an optional username, man:chpass[1] displays an editor containing user information.  When the user exits from the editor, the user database is updated with the new information.ÙÌå½“æ²¡æœ‰ä¼ é€’ä»»ä½•é€‰é¡¹æ—¶ï¼Œé™¤äº†å¯é€‰çš„ç”¨æˆ·åå¤–ï¼Œ man:chpass[1] ä¼šæ˜¾ç¤ºä¸€ä¸ªåŒ…å«ç”¨æˆ·ä¿¡æ¯çš„ç¼–è¾‘å™¨ã€‚å½“ç”¨æˆ·ä»ç¼–è¾‘å™¨é€€å‡ºæ—¶ï¼Œç”¨æˆ·æ•°æ®åº“å°†ä¼šæ›´æ–°ä¸ºæ–°çš„ä¿¡æ¯ã€‚ÙuThis utility will prompt for the user's password when exiting the editor, unless the utility is run as the superuser.Ùuè¯¥å®ç”¨ç¨‹åºåœ¨é€€å‡ºç¼–è¾‘å™¨æ—¶ä¼šæç¤ºç”¨æˆ·è¾“å…¥å¯†ç ï¼Œé™¤éä»¥è¶…çº§ç”¨æˆ·èº«ä»½è¿è¡Œè¯¥å®ç”¨ç¨‹åºã€‚Ú#In <<users-modifying-chpass-su>>, the superuser has typed `chpass jru` and is now viewing the fields that can be changed for this user.  If `jru` runs this command instead, only the last six fields will be displayed and available for editing.  This is shown in <<users-modifying-chpass-ru>>.Úåœ¨ <<users-modifying-chpass-su>> ä¸­ï¼Œè¶…çº§ç”¨æˆ·è¾“å…¥äº† `chpass jru` ï¼Œç°åœ¨æ­£åœ¨æŸ¥çœ‹å¯ä»¥æ›´æ”¹è¯¥ç”¨æˆ·çš„å­—æ®µã€‚å¦‚æœ `jru` è¿è¡Œæ­¤å‘½ä»¤ï¼Œåªæœ‰æœ€åå…­ä¸ªå­—æ®µå°†è¢«æ˜¾ç¤ºå¹¶å¯ä¾›ç¼–è¾‘ã€‚è¿™åœ¨ <<users-modifying-chpass-ru>> ä¸­æ˜¾ç¤ºã€‚»Using `chpass` as SuperuserÙ+ä»¥è¶…çº§ç”¨æˆ·èº«ä»½ä½¿ç”¨ `chpass` å‘½ä»¤¾Using `chpass` as Regular UserÙ+ä»¥æ™®é€šç”¨æˆ·èº«ä»½ä½¿ç”¨ `chpass` å‘½ä»¤Ú7The commands man:chfn[1] and man:chsh[1] are links to man:chpass[1], as are man:ypchpass[1], man:ypchfn[1], and man:ypchsh[1].  Since NIS support is automatic, specifying the `yp` before the command is not necessary.  How to configure NIS is covered in crossref:network-servers[network-servers,Network Servers].Ú=å‘½ä»¤ man:chfn[1] å’Œ man:chsh[1] æ˜¯æŒ‡å‘ man:chpass[1] çš„é“¾æ¥ï¼ŒåŒæ · man:ypchpass[1] ã€ man:ypchfn[1] å’Œ man:ypchsh[1] ä¹Ÿæ˜¯ã€‚ç”±äº NIS æ”¯æŒæ˜¯è‡ªåŠ¨çš„ï¼Œæ‰€ä»¥åœ¨å‘½ä»¤ä¹‹å‰æŒ‡å®š `yp` æ˜¯ä¸å¿…è¦çš„ã€‚å¦‚ä½•é…ç½® NIS åœ¨ crossref:network-servers[network-servers ,ç½‘ç»œæœåŠ¡å™¨] ä¸­æœ‰ä»‹ç»ã€‚´Change user password²æ›´æ”¹ç”¨æˆ·å¯†ç ÙÊAny user can easily change their password using man:passwd[1].  To prevent accidental or unauthorized changes, this command will prompt for the user's original password before a new password can be set:Ù½ä»»ä½•ç”¨æˆ·éƒ½å¯ä»¥ä½¿ç”¨ man:passwd[1] è½»æ¾æ›´æ”¹ä»–ä»¬çš„å¯†ç ã€‚ä¸ºäº†é˜²æ­¢æ„å¤–æˆ–æœªç»æˆæƒçš„æ›´æ”¹ï¼Œåœ¨è®¾ç½®æ–°å¯†ç ä¹‹å‰ï¼Œè¯¥å‘½ä»¤ä¼šæç¤ºç”¨æˆ·è¾“å…¥åŸå§‹å¯†ç ï¼š¶Changing Your Password¬æ›´æ”¹å¯†ç ÚThe superuser can change any user's password by specifying the username when running man:passwd[1].  When this utility is run as the superuser, it will not prompt for the user's current password.  This allows the password to be changed when a user cannot remember the original password.Ùüè¶…çº§ç”¨æˆ·å¯ä»¥é€šè¿‡åœ¨è¿è¡Œ man:passwd[1] æ—¶æŒ‡å®šç”¨æˆ·åæ¥æ›´æ”¹ä»»ä½•ç”¨æˆ·çš„å¯†ç ã€‚å½“ä»¥è¶…çº§ç”¨æˆ·èº«ä»½è¿è¡Œæ­¤å®ç”¨ç¨‹åºæ—¶ï¼Œå®ƒä¸ä¼šæç¤ºç”¨æˆ·è¾“å…¥å½“å‰å¯†ç ã€‚è¿™å…è®¸åœ¨ç”¨æˆ·æ— æ³•è®°ä½åŸå§‹å¯†ç æ—¶æ›´æ”¹å¯†ç ã€‚Ù1Changing Another User's Password as the SuperuserÙ3ä»¥è¶…çº§ç”¨æˆ·èº«ä»½æ›´æ”¹å¦ä¸€ä¸ªç”¨æˆ·çš„å¯†ç ÙdAs with man:chpass[1], man:yppasswd[1] is a link to man:passwd[1], so NIS works with either command.Ùä¸ man:chpass[1] ä¸€æ ·ï¼Œ man:yppasswd[1] æ˜¯æŒ‡å‘ man:passwd[1] çš„é“¾æ¥ï¼Œå› æ­¤ NIS å¯ä»¥ä¸ä»»ä¸€å‘½ä»¤ä¸€èµ·ä½¿ç”¨ã€‚Ù:Create, remove, modify and display system users and groupsÙ3åˆ›å»ºã€åˆ é™¤ã€ä¿®æ”¹å’Œæ˜¾ç¤ºç³»ç»Ÿç”¨æˆ·å’Œç»„ÚYThe man:pw[8] utility can create, remove, modify, and display users and groups.  It functions as a front end to the system user and group files.  man:pw[8] has a very powerful set of command line options that make it suitable for use in shell scripts, but new users may find it more complicated than the other commands presented in this section.Ú-man:pw[8] å®ç”¨ç¨‹åºå¯ä»¥åˆ›å»ºã€åˆ é™¤ã€ä¿®æ”¹å’Œæ˜¾ç¤ºç”¨æˆ·å’Œç»„ã€‚å®ƒä½œä¸ºç³»ç»Ÿç”¨æˆ·å’Œç»„æ–‡ä»¶çš„å‰ç«¯å·¥å…·ã€‚ man:pw[8] å…·æœ‰ä¸€å¥—éå¸¸å¼ºå¤§çš„å‘½ä»¤è¡Œé€‰é¡¹ï¼Œä½¿å…¶é€‚ç”¨äºåœ¨ shell è„šæœ¬ä¸­ä½¿ç”¨ï¼Œä½†æ–°ç”¨æˆ·å¯èƒ½ä¼šå‘ç°å®ƒæ¯”æœ¬èŠ‚ä¸­ä»‹ç»çš„å…¶ä»–å‘½ä»¤æ›´å¤æ‚ã€‚¯Managing Groups¬ç®¡ç†ç¾¤ç»„´Symbolic Permissions¬ç¬¦å·æƒé™ÙÚSymbolic permissions use characters instead of octal values to assign permissions to files or directories.  Symbolic permissions use the syntax of (who) (action) (permissions), where the following values are available:Ù¦ç¬¦å·æƒé™ä½¿ç”¨å­—ç¬¦è€Œä¸æ˜¯å…«è¿›åˆ¶å€¼æ¥ä¸ºæ–‡ä»¶æˆ–ç›®å½•åˆ†é…æƒé™ã€‚ç¬¦å·æƒé™ä½¿ç”¨ä»¥ä¸‹è¯­æ³•ï¼š (ç”¨æˆ·) (åŠ¨ä½œ) (æƒé™) ï¼Œå¯ç”¨çš„å€¼å¦‚ä¸‹ï¼š¦Option¦é€‰é¡¹¦Letter¦å‚æ•°ªRepresents¦æ„ä¹‰¥(who)¬ï¼ˆç”¨æˆ·ï¼‰¤User¦ç”¨æˆ·«Group owner¬ç»„æ‰€æœ‰è€…¥Other¦å…¶ä»–­All ("world")´æ‰€æœ‰ï¼ˆ"å…¨éƒ¨"ï¼‰¨(action)¬ï¼ˆåŠ¨ä½œï¼‰²Adding permissions¬æ·»åŠ æƒé™´Removing permissions¬ç§»é™¤æƒé™ºExplicitly set permissions¬æŒ‡å®šæƒé™­(permissions)¬ï¼ˆæƒé™ï¼‰¤Read£è¯»¥Write£å†™§Execute¦æ‰§è¡ŒªSticky bit©ç²˜æ€§ä½®Set UID or GID¹è®¾ç½®ç”¨æˆ· ID æˆ–ç»„ IDÙtThis chapter covers various aspects of the FreeBSD Project, such as its history, goals, development model, and so onÙ`æœ¬ç« ä»‹ç»äº† FreeBSD é¡¹ç›®çš„å„ä¸ªæ–¹é¢ï¼ŒåŒ…æ‹¬å…¶å†å²ã€ç›®æ ‡ã€å¼€å‘æ¨¡å‹ç­‰ç­‰ã€‚·Chapter 1. Introduction°ç¬¬ 1 ç«  å¼•è¨€¬Introduction¦ä»‹ç»Ù¦Thank you for your interest in FreeBSD! The following chapter covers various aspects of the FreeBSD Project, such as its history, goals, development model, and so on.Ù”æ„Ÿè°¢ä½ å¯¹ FreeBSD æœ‰æ‰€å…´è¶£ï¼ ä¸‹é¢è¿™ä¸€ç« æ¶‰åŠåˆ°äº† FreeBSD é¡¹ç›®çš„å„ä¸ªæ–¹é¢ï¼Œä¾‹å¦‚å®ƒçš„å†å²ã€ç›®æ ‡ã€å¼€å‘æ¨¡å¼ç­‰ç­‰ã€‚Ù)After reading this chapter you will know:Ù!é˜…è¯»æœ¬ç« åï¼Œæ‚¨å°†äº†è§£ï¼šÙ8How FreeBSD relates to other computer operating systems.Ù2FreeBSD ä¸å…¶ä»–è®¡ç®—æœºæ“ä½œç³»ç»Ÿçš„å…³ç³»ã€‚Ù#The history of the FreeBSD Project.ºFreeBSD é¡¹ç›®çš„å†å²ã€‚Ù!The goals of the FreeBSD Project.ºFreeBSD é¡¹ç›®çš„ç›®æ ‡ã€‚Ù8The basics of the FreeBSD open-source development model.Ù,FreeBSD å¼€æºå¼€å‘æ¨¡å‹çš„åŸºç¡€çŸ¥è¯†ã€‚Ù3And of course: where the name "FreeBSD" comes from.Ù?å½“ç„¶ï¼Œè¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼š FreeBSD è¿™ä¸ªåå­—çš„ç”±æ¥ã€‚³Welcome to FreeBSD!¸æ¬¢è¿æ¥åˆ° FreeBSD ï¼ÚøFreeBSD is an Open Source, standards-compliant Unix-like operating system for x86 (both 32 and 64 bit), ARM, AArch64, RISC-V, POWER, and PowerPC computers.  It provides all the features that are nowadays taken for granted, such as preemptive multitasking, memory protection, virtual memory, multi-user facilities, SMP support, all the Open Source development tools for different languages and frameworks, and desktop features centered around X Window System, KDE, or GNOME.  Its particular strengths are:ÚºFreeBSD æ˜¯ä¸€ä¸ªå¼€æºçš„ã€ç¬¦åˆæ ‡å‡†çš„ç±» Unix æ“ä½œç³»ç»Ÿï¼Œé€‚ç”¨äº x86ï¼ˆ32 ä½å’Œ 64 ä½ï¼‰ã€ARMã€AArch64ã€RISC-Vã€POWER å’Œ PowerPC è®¡ç®—æœºã€‚å®ƒæä¾›äº†ç°åœ¨è¢«è§†ä¸ºç†æ‰€å½“ç„¶çš„æ‰€æœ‰åŠŸèƒ½ï¼Œå¦‚æŠ¢å å¼å¤šä»»åŠ¡å¤„ç†ã€å†…å­˜ä¿æŠ¤ã€è™šæ‹Ÿå†…å­˜ã€å¤šç”¨æˆ·è®¾æ–½ã€ SMP æ”¯æŒã€å„ç§è¯­è¨€å’Œæ¡†æ¶çš„å¼€æºå¼€å‘å·¥å…·ï¼Œä»¥åŠä»¥ X Window Systemã€KDE æˆ– GNOME ä¸ºä¸­å¿ƒçš„æ¡Œé¢åŠŸèƒ½ã€‚å®ƒçš„ç‰¹ç‚¹æœ‰ï¼šÚ"_Liberal Open Source license_, which grants you rights to freely modify and extend its source code and incorporate it in both Open Source projects and closed products without imposing restrictions typical to copyleft licenses, as well as avoiding potential license incompatibility problems.Ú_è‡ªç”±å¼€æºè®¸å¯è¯ï¼ˆ Liberal Open Source license ï¼‰_  èµ‹äºˆæ‚¨è‡ªç”±ä¿®æ”¹å’Œæ‰©å±•å…¶æºä»£ç çš„æƒåˆ©ï¼Œå¹¶å°†å…¶çº³å…¥å¼€æºé¡¹ç›®å’Œé—­æºäº§å“ä¸­ï¼Œè€Œä¸ä¼šæ–½åŠ å…¸å‹çš„å¼ºåˆ¶å…±äº«è®¸å¯è¯æ‰€å…·æœ‰çš„é™åˆ¶ï¼ŒåŒæ—¶é¿å…æ½œåœ¨çš„è®¸å¯è¯ä¸å…¼å®¹é—®é¢˜ã€‚Ú_Strong TCP/IP networking_ - FreeBSD implements industry standard protocols with ever increasing performance and scalability. This makes it a good match in both server, and routing/firewalling roles - and indeed many companies and vendors use it precisely for that purpose.Ú_å¼ºå¤§çš„ TCP/IP ç½‘ç»œ_ - FreeBSD é‡‡ç”¨è¡Œä¸šæ ‡å‡†åè®®ï¼Œå…·æœ‰è¶Šæ¥è¶Šé«˜çš„æ€§èƒ½å’Œå¯æ‰©å±•æ€§ã€‚è¿™ä½¿å¾—å®ƒåœ¨æœåŠ¡å™¨å’Œè·¯ç”± / é˜²ç«å¢™è§’è‰²ä¸­éƒ½èƒ½å¾ˆå¥½åœ°åŒ¹é… - å®é™…ä¸Šï¼Œè®¸å¤šå…¬å¸å’Œä¾›åº”å•†æ­£æ˜¯å‡ºäºè¿™ä¸ªç›®çš„ä½¿ç”¨å®ƒã€‚ÙÏ_Fully integrated OpenZFS support_, including root-on-ZFS, ZFS Boot Environments, fault management, administrative delegation, support for jails, FreeBSD specific documentation, and system installer support.Ù®_å®Œå…¨é›†æˆçš„ OpenZFS æ”¯æŒ_ï¼ŒåŒ…æ‹¬ root-on-ZFS ã€ ZFS å¼•å¯¼ç¯å¢ƒã€æ•…éšœç®¡ç†ã€ç®¡ç†å§”æ´¾ã€æ”¯æŒ jails ã€ FreeBSD ç‰¹å®šæ–‡æ¡£å’Œç³»ç»Ÿå®‰è£…ç¨‹åºæ”¯æŒã€‚Ùy_Extensive security features_, from the Mandatory Access Control framework to Capsicum capability and sandbox mechanisms.ÙZ_å¹¿æ³›çš„å®‰å…¨åŠŸèƒ½_ï¼Œä»å¼ºåˆ¶è®¿é—®æ§åˆ¶æ¡†æ¶åˆ° Capsicum èƒ½åŠ›å’Œæ²™ç›’æœºåˆ¶ã€‚Ù–_Over 30 thousand prebuilt packages_ for all supported architectures, and the Ports Collection which makes it easy to build your own, customized ones.ÙŠ_è¶…è¿‡30 , 000 ä¸ªé¢„æ„å»ºè½¯ä»¶åŒ…_ æ”¯æŒæ‰€æœ‰æ¶æ„ï¼Œä»¥åŠ Ports Collection ï¼Œä½¿å¾—æ„å»ºè‡ªå·±å®šåˆ¶çš„è½¯ä»¶åŒ…å˜å¾—å®¹æ˜“ã€‚ÚQ_Documentation_ - in addition to the Handbook and books from different authors that cover topics ranging from system administration to kernel internals, there are also the man:man[1] pages, not only for userspace daemons, utilities, and configuration files, but also for kernel driver APIs (section 9) and individual drivers (section 4).Ú-_æ–‡æ¡£_ - é™¤äº†æ‰‹å†Œå’Œæ¶µç›–ä»ç³»ç»Ÿç®¡ç†åˆ°å†…æ ¸å†…éƒ¨çš„å„ç§ä¸»é¢˜çš„ä¸åŒä½œè€…çš„ä¹¦ç±ä¹‹å¤–ï¼Œè¿˜æœ‰ man:man[1] é¡µé¢ï¼Œä¸ä»…é€‚ç”¨äºç”¨æˆ·ç©ºé—´çš„å®ˆæŠ¤è¿›ç¨‹ã€å®ç”¨ç¨‹åºå’Œé…ç½®æ–‡ä»¶ï¼Œè¿˜é€‚ç”¨äºå†…æ ¸é©±åŠ¨ç¨‹åº API ï¼ˆç¬¬ 9 èŠ‚ï¼‰å’Œå•ä¸ªé©±åŠ¨ç¨‹åºï¼ˆç¬¬ 4 èŠ‚ï¼‰ã€‚ÚR_Simple and consistent repository structure and build system_ - FreeBSD uses a single repository for all of its components, both kernel and userspace. This, along with a unified and easy to customize build system and a well thought-out development process makes it easy to integrate FreeBSD with build infrastructure for your own product.Ú6_ç®€å•è€Œä¸€è‡´çš„å­˜å‚¨åº“ç»“æ„å’Œæ„å»ºç³»ç»Ÿ_ - FreeBSD ä½¿ç”¨ä¸€ä¸ªå­˜å‚¨åº“æ¥ç®¡ç†æ‰€æœ‰ç»„ä»¶ï¼ŒåŒ…æ‹¬å†…æ ¸å’Œç”¨æˆ·ç©ºé—´ã€‚è¿™ä¸ªç‰¹ç‚¹ï¼ŒåŠ ä¸Šç»Ÿä¸€ä¸”æ˜“äºå®šåˆ¶çš„æ„å»ºç³»ç»Ÿä»¥åŠç»è¿‡æ·±æ€ç†Ÿè™‘çš„å¼€å‘æµç¨‹ï¼Œä½¿å¾—å°† FreeBSD ä¸è‡ªå·±äº§å“çš„æ„å»ºåŸºç¡€è®¾æ–½é›†æˆå˜å¾—å®¹æ˜“ã€‚Ù_Staying true to Unix philosophy_, preferring composability instead of monolithic "all in one" daemons with hardcoded behavior.Ùt_ç§‰æ‰¿ Unix å“²å­¦_ï¼Œæ›´å€¾å‘äºå¯ç»„åˆæ€§ï¼Œè€Œä¸æ˜¯ç¡¬ç¼–ç è¡Œä¸ºçš„å•ä½“åŒ–â€œä¸€ä½“åŒ–â€å®ˆæŠ¤ç¨‹åºã€‚Ùz_Binary compatibility_ with Linux, which makes it possible to run many Linux binaries without the need for virtualisation.Ùv_ä¸ Linux çš„äºŒè¿›åˆ¶å…¼å®¹æ€§_ï¼Œä½¿å¾—åœ¨ä¸éœ€è¦è™šæ‹ŸåŒ–çš„æƒ…å†µä¸‹å¯ä»¥è¿è¡Œè®¸å¤š Linux äºŒè¿›åˆ¶æ–‡ä»¶ã€‚Ú]FreeBSD is based on the 4.4BSD-Lite release from Computer Systems Research Group (CSRG) at the University of California at Berkeley, and carries on the distinguished tradition of BSD systems development.  In addition to the fine work provided by CSRG, the FreeBSD Project has put in many thousands of man-hours into extending the functionality and fine-tuning the system for maximum performance and reliability in real-life load situations.  FreeBSD offers performance and reliability on par with other Open Source and commercial offerings, combined with cutting-edge features not available anywhere else.ÚîFreeBSD åŸºäºåŠ åˆ©ç¦å°¼äºšå¤§å­¦ä¼¯å…‹åˆ©åˆ†æ ¡è®¡ç®—æœºç³»ç»Ÿç ”ç©¶ç»„ï¼ˆ CSRG ï¼‰çš„ 4.4BSD-Lite å‘å¸ƒç‰ˆï¼Œå¹¶å»¶ç»­äº† BSD ç³»ç»Ÿå¼€å‘çš„å“è¶Šä¼ ç»Ÿã€‚é™¤äº† CSRG æä¾›çš„å‡ºè‰²å·¥ä½œå¤–ï¼Œ FreeBSD é¡¹ç›®è¿˜æŠ•å…¥äº†æ•°åƒå°æ—¶çš„å·¥ä½œï¼Œæ‰©å±•äº†åŠŸèƒ½å¹¶å¯¹ç³»ç»Ÿè¿›è¡Œäº†ç²¾ç»†è°ƒæ•´ï¼Œä»¥åœ¨å®é™…è´Ÿè½½æƒ…å†µä¸‹å®ç°æœ€å¤§æ€§èƒ½å’Œå¯é æ€§ã€‚ FreeBSD æä¾›ä¸å…¶ä»–å¼€æºå’Œå•†ä¸šäº§å“ç›¸å½“çš„æ€§èƒ½å’Œå¯é æ€§ï¼ŒåŒæ—¶ç»“åˆäº†å…¶ä»–åœ°æ–¹æ— æ³•è·å¾—çš„å°–ç«¯åŠŸèƒ½ã€‚´What Can FreeBSD Do?ºFreeBSD å¯ä»¥åšä»€ä¹ˆï¼ŸÚ	The applications to which FreeBSD can be put are truly limited only by your own imagination.  From software development to factory automation, inventory control to azimuth correction of remote satellite antenna; if it can be done with a commercial UNIX(R) product then it is more than likely that you can do it with FreeBSD too! FreeBSD also benefits significantly from literally thousands of high quality applications developed by research centers and universities around the world, often available at little to no cost.ÚˆFreeBSD çš„åº”ç”¨èŒƒå›´å‡ ä¹åªå—ä½ çš„æƒ³è±¡åŠ›é™åˆ¶ã€‚ä»è½¯ä»¶å¼€å‘åˆ°å·¥å‚è‡ªåŠ¨åŒ–ï¼Œä»åº“å­˜æ§åˆ¶åˆ°è¿œç¨‹å«æ˜Ÿå¤©çº¿çš„æ–¹ä½æ ¡æ­£ï¼›å¦‚æœå¯ä»¥ç”¨å•†ä¸š UNIX(R) äº§å“å®Œæˆï¼Œé‚£ä¹ˆå¾ˆæœ‰å¯èƒ½ä½ ä¹Ÿå¯ä»¥ç”¨ FreeBSD æ¥å®ç°ï¼ FreeBSD è¿˜å—ç›Šäºå…¨çƒç ”ç©¶ä¸­å¿ƒå’Œå¤§å­¦å¼€å‘çš„æˆåƒä¸Šä¸‡ä¸ªé«˜è´¨é‡åº”ç”¨ç¨‹åºï¼Œé€šå¸¸å¯ä»¥ä»¥å¾ˆä½çš„æˆ–è€…é›¶æˆæœ¬è·å¾—ã€‚ÚfBecause the source code for FreeBSD itself is freely available, the system can also be customized to an almost unheard-of degree for special applications or projects, and in ways not generally possible with operating systems from most major commercial vendors.  Here is just a sampling of some of the applications in which people are currently using FreeBSD:Ú/ç”±äº FreeBSD æœ¬èº«çš„æºä»£ç æ˜¯å…è´¹æä¾›çš„ï¼Œå› æ­¤è¯¥ç³»ç»Ÿå¯ä»¥æ ¹æ®ç‰¹å®šåº”ç”¨æˆ–é¡¹ç›®çš„éœ€æ±‚è¿›è¡Œå‡ ä¹æ— ä¸ä¼¦æ¯”çš„å®šåˆ¶ï¼Œè€Œè¿™åœ¨å¤§å¤šæ•°ä¸»è¦å•†ä¸šä¾›åº”å•†çš„æ“ä½œç³»ç»Ÿä¸­é€šå¸¸æ˜¯ä¸å¯èƒ½çš„ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›äººä»¬ç›®å‰æ­£åœ¨ä½¿ç”¨ FreeBSD çš„åº”ç”¨ç¨‹åºçš„ç¤ºä¾‹ï¼šÙ‹_Internet Services:_ The robust TCP/IP networking built into FreeBSD makes it an ideal platform for a variety of Internet services such as:Ùx_äº’è”ç½‘æœåŠ¡_ï¼šFreeBSD å†…ç½®çš„å¼ºå¤§çš„ TCP/IP ç½‘ç»œä½¿å…¶æˆä¸ºå„ç§äº’è”ç½‘æœåŠ¡çš„ç†æƒ³å¹³å°ï¼Œä¾‹å¦‚ï¼š«Web servers­Web æœåŠ¡å™¨µIPv4 and IPv6 routing´IPv4 å’Œ IPv6 è·¯ç”±Ù.Firewalls and NAT ("IP masquerading") gatewaysÙ(é˜²ç«å¢™å’Œ NAT ï¼ˆ"IP ä¼ªè£…"ï¼‰ç½‘å…³«FTP servers­FTP æœåŠ¡å™¨­Email serversµç”µå­é‚®ä»¶æœåŠ¡å™¨¯Storage servers¯å­˜å‚¨æœåŠ¡å™¨¶Virtualization servers²è™šæ‹ŸåŒ–æœåŠ¡å™¨«And more...°è¿˜æœ‰æ›´å¤š ...Ú«_Education:_ Are you a student of computer science or a related engineering field? There is no better way of learning about operating systems, computer architecture and networking than the hands-on, under-the-hood experience that FreeBSD can provide. A number of freely available CAD, mathematical and graphic design packages also make it highly useful to those whose primary interest in a computer is to get _other_ work done!Ú[_æ•™è‚²ï¼š_ ä½ æ˜¯è®¡ç®—æœºç§‘å­¦æˆ–ç›¸å…³å·¥ç¨‹é¢†åŸŸçš„å­¦ç”Ÿå—ï¼Ÿæ²¡æœ‰æ¯” FreeBSD æä¾›çš„äº²èº«å®è·µã€æ·±å…¥äº†è§£æ“ä½œç³»ç»Ÿã€è®¡ç®—æœºæ¶æ„å’Œç½‘ç»œæ›´å¥½çš„å­¦ä¹ æ–¹å¼äº†ã€‚è¿˜æœ‰ä¸€äº›å…è´¹çš„ CAD ã€æ•°å­¦å’Œå›¾å½¢è®¾è®¡è½¯ä»¶åŒ…ï¼Œå¯¹äºé‚£äº›ä¸»è¦å…³æ³¨è®¡ç®—æœºç”¨äºå®Œæˆå…¶ä»–å·¥ä½œçš„äººæ¥è¯´ï¼Œå®ƒä»¬ä¹Ÿéå¸¸æœ‰ç”¨ï¼Ú›_Research:_ With source code for the entire system available, FreeBSD is an excellent platform for research in operating systems as well as other branches of computer science. FreeBSD's freely available nature also makes it possible for remote groups to collaborate on ideas or shared development without having to worry about special licensing agreements or limitations on what may be discussed in open forums.Ú,_ç ”ç©¶ï¼š_ ç”±äºæ•´ä¸ªç³»ç»Ÿçš„æºä»£ç å¯ç”¨ï¼Œ FreeBSD æ˜¯æ“ä½œç³»ç»Ÿä»¥åŠè®¡ç®—æœºç§‘å­¦å…¶ä»–é¢†åŸŸç ”ç©¶çš„ä¼˜ç§€å¹³å°ã€‚ FreeBSD çš„è‡ªç”±å¯ç”¨æ€§ä¹Ÿä½¿å¾—è¿œç¨‹å›¢é˜Ÿèƒ½å¤Ÿåœ¨æƒ³æ³•æˆ–å…±äº«å¼€å‘ä¸Šè¿›è¡Œåˆä½œï¼Œè€Œæ— éœ€æ‹…å¿ƒç‰¹æ®Šè®¸å¯åè®®æˆ–åœ¨å…¬å¼€è®ºå›ä¸Šè®¨è®ºçš„é™åˆ¶ã€‚Ùô_Networking:_ Need a new router? A name server (DNS)? A firewall to keep people out of your internal network? FreeBSD can easily turn that unused PC sitting in the corner into an advanced router with sophisticated packet-filtering capabilities.Ú_ç½‘ç»œï¼š_ éœ€è¦ä¸€ä¸ªæ–°çš„è·¯ç”±å™¨å—ï¼Ÿä¸€ä¸ªåŸŸåæœåŠ¡å™¨ï¼ˆ DNS ï¼‰ï¼Ÿä¸€ä¸ªé˜²ç«å¢™æ¥é˜»æ­¢äººä»¬è¿›å…¥æ‚¨çš„å†…éƒ¨ç½‘ç»œï¼Ÿ FreeBSD å¯ä»¥è½»æ¾åœ°å°†é—²ç½®åœ¨è§’è½çš„ä¸ªäººç”µè„‘è½¬å˜ä¸ºå…·æœ‰å¤æ‚æ•°æ®åŒ…è¿‡æ»¤åŠŸèƒ½çš„é«˜çº§è·¯ç”±å™¨ã€‚Úo_Embedded:_ FreeBSD makes an excellent platform to build embedded systems upon. With support for the ARM, AArch64 and PowerPC platforms, coupled with a robust network stack, cutting edge features, and the permissive extref:{faq}[BSD license, bsd-license-restrictions], FreeBSD makes an excellent foundation for building embedded routers, firewalls, and other devices.Ú6_åµŒå…¥å¼ï¼š_ FreeBSD æ˜¯æ„å»ºåµŒå…¥å¼ç³»ç»Ÿçš„ä¼˜ç§€å¹³å°ã€‚å®ƒæ”¯æŒ ARM ã€ AArch64 å’Œ PowerPC å¹³å°ï¼Œé…å¤‡å¼ºå¤§çš„ç½‘ç»œå †æ ˆã€å°–ç«¯åŠŸèƒ½å’Œå®½æ¾çš„ extref:{faq}[BSD è®¸å¯è¯, bsd-license-restrictions]ï¼Œä½¿ FreeBSD æˆä¸ºæ„å»ºåµŒå…¥å¼è·¯ç”±å™¨ã€é˜²ç«å¢™å’Œå…¶ä»–è®¾å¤‡çš„ç†æƒ³åŸºç¡€ã€‚Ú_Desktop:_ FreeBSD makes a fine choice for an inexpensive desktop solution using the freely available X11 server and Wayland display server. FreeBSD offers a choice from many open-source desktop environments, including the standard GNOME and KDE graphical user interfaces. FreeBSD can even boot "diskless" from a central server, making individual workstations even cheaper and easier to administer.ÚZ_æ¡Œé¢ï¼š_ FreeBSD æ˜¯ä¸€ä¸ªä½¿ç”¨å…è´¹çš„ X11 æœåŠ¡å™¨å’Œ Wayland æ˜¾ç¤ºæœåŠ¡å™¨çš„å»‰ä»·æ¡Œé¢è§£å†³æ–¹æ¡ˆçš„ä¸é”™é€‰æ‹©ã€‚ FreeBSD æä¾›äº†è®¸å¤šå¼€æºæ¡Œé¢ç¯å¢ƒçš„é€‰æ‹©ï¼ŒåŒ…æ‹¬æ ‡å‡†çš„ GNOME å’Œ KDE å›¾å½¢ç”¨æˆ·ç•Œé¢ã€‚ FreeBSD ç”šè‡³å¯ä»¥ä»ä¸­å¤®æœåŠ¡å™¨â€œæ— ç›˜å¯åŠ¨â€ï¼Œä½¿å¾—ä¸ªäººå·¥ä½œç«™æ›´åŠ ä¾¿å®œå’Œæ˜“äºç®¡ç†ã€‚Ùğ_Software Development:_ The basic FreeBSD system comes with a full suite of development tools including a full C/C++ compiler and debugger suite. Support for many other languages are also available through the ports and packages collection.ÙĞ_è½¯ä»¶å¼€å‘ï¼š_ åŸºæœ¬çš„ FreeBSD ç³»ç»Ÿé…å¤‡äº†ä¸€å¥—å®Œæ•´çš„å¼€å‘å·¥å…·ï¼ŒåŒ…æ‹¬å®Œæ•´çš„ C/C ++ç¼–è¯‘å™¨å’Œè°ƒè¯•å™¨å¥—ä»¶ã€‚é€šè¿‡ç«¯å£å’Œè½¯ä»¶åŒ…é›†åˆï¼Œè¿˜å¯ä»¥æ”¯æŒè®¸å¤šå…¶ä»–ç¼–ç¨‹è¯­è¨€ã€‚ÙÃFreeBSD is available to download free of charge, or can be obtained on either CD-ROM or DVD.  Please see crossref:mirrors[mirrors, Obtaining FreeBSD] for more information about obtaining FreeBSD.Ù§FreeBSD å¯ä»¥å…è´¹ä¸‹è½½ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ CD-ROM æˆ– DVD è·å–ã€‚æœ‰å…³è·å– FreeBSD çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜… crossref:mirrors[mirrors , Obtaining FreeBSD] ã€‚±Who Uses FreeBSD?µè°ä½¿ç”¨ FreeBSD ï¼ŸÚ}FreeBSD has been known for its web serving capabilities.  A list of link:https://freebsdfoundation.org/about-us/testimonials/[testimonials from companies basing their products and services on FreeBSD] can be found at the FreeBSD Foundation website.  Wikipedia also maintains a link:https://en.wikipedia.org/wiki/List_of_products_based_on_FreeBSD[list of products based on FreeBSD].ÚiFreeBSD ä»¥å…¶ Web æœåŠ¡å™¨åŠŸèƒ½è€Œé—»åã€‚å¯ä»¥åœ¨ FreeBSD åŸºé‡‘ä¼šçš„ç½‘ç«™ä¸Šæ‰¾åˆ°ä¸€ä»½ link:https://freebsdfoundation.org/about-us/testimonials/[åŸºäº FreeBSD çš„äº§å“å’ŒæœåŠ¡çš„å…¬å¸çš„ testimonials åˆ—è¡¨] ã€‚ç»´åŸºç™¾ç§‘è¿˜ç»´æŠ¤ç€ä¸€ä¸ª link:https://en.wikipedia.org/wiki/List_of_products_based_on_FreeBSD[åŸºäº FreeBSD çš„äº§å“åˆ—è¡¨] ã€‚¹About the FreeBSD Projectµå…³äº FreeBSD é¡¹ç›®Ù²The following section provides some background information on the project, including a brief history, project goals, and the extref:{dev-model}[development model] of the project.ÙŸä¸‹é¢çš„éƒ¨åˆ†æä¾›äº†å…³äºé¡¹ç›®çš„ä¸€äº›èƒŒæ™¯ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç®€è¦å†å²ã€é¡¹ç›®ç›®æ ‡ä»¥åŠé¡¹ç›® extref:{dev-model}[å¼€å‘æ¨¡å‹,development model]ã€‚ºA Brief History of FreeBSD·FreeBSD çš„ç®€è¦å†å²ÙÀThe FreeBSD Project had its genesis in the early part of 1993, partially as the brainchild of the Unofficial 386BSDPatchkit's last 3 coordinators: Nate Williams, Rod Grimes and Jordan Hubbard.Ù¬FreeBSD é¡¹ç›®è¯ç”Ÿäº 1993 å¹´åˆï¼Œéƒ¨åˆ†æ˜¯ç”±éå®˜æ–¹çš„ 386BSDPatchkit çš„æœ€åä¸‰ä½åè°ƒå‘˜ Nate Williams ã€ Rod Grimes å’Œ Jordan Hubbard å…±åŒæ„æ€è€Œæˆã€‚Ú
The original goal was to produce an intermediate snapshot of 386BSD in order to fix a number of problems that the patchkit mechanism was just not capable of solving.  The early working title for the project was 386BSD 0.5 or 386BSD Interim in reference to that fact.ÙÀæœ€åˆçš„ç›®æ ‡æ˜¯ç”Ÿæˆ 386BSD çš„ä¸­é—´å¿«ç…§ï¼Œä»¥è§£å†³ä¸€äº›æ— æ³•é€šè¿‡è¡¥ä¸æœºåˆ¶è§£å†³çš„é—®é¢˜ã€‚è¯¥é¡¹ç›®çš„æ—©æœŸå·¥ä½œæ ‡é¢˜æ˜¯ 386BSD 0.5 æˆ– 386BSD Interim ï¼Œä»¥æ­¤ä¸ºå‚è€ƒã€‚ÚÆ386BSD was Bill Jolitz's operating system, which had been up to that point suffering rather severely from almost a year's worth of neglect.  As the patchkit swelled ever more uncomfortably with each passing day, they decided to assist Bill by providing this interim "cleanup" snapshot.  Those plans came to a rude halt when Bill Jolitz suddenly decided to withdraw his sanction from the project without any clear indication of what would be done instead.Ú386BSD æ˜¯ Bill Jolitz çš„æ“ä½œç³»ç»Ÿï¼Œåˆ°é‚£æ—¶ä¸ºæ­¢ï¼Œå®ƒå·²ç»é­å—äº†å°†è¿‘ä¸€å¹´çš„ä¸¥é‡å¿½è§†ã€‚éšç€æ¯ä¸€å¤©è¿‡å»ï¼Œè¡¥ä¸åŒ…å˜å¾—è¶Šæ¥è¶Šä¸èˆ’æœï¼Œä»–ä»¬å†³å®šé€šè¿‡æä¾›è¿™ä¸ªä¸´æ—¶çš„â€œæ¸…ç†â€å¿«ç…§æ¥å¸®åŠ© Bill ã€‚ç„¶è€Œï¼Œå½“ Bill Jolitz çªç„¶å†³å®šæ’¤å›å¯¹è¯¥é¡¹ç›®çš„æ”¯æŒï¼Œå¹¶æ²¡æœ‰æ˜ç¡®è¡¨ç¤ºå°†é‡‡å–ä»€ä¹ˆæ›¿ä»£æªæ–½æ—¶ï¼Œè¿™äº›è®¡åˆ’è¢«ç²—æš´åœ°ä¸­æ­¢äº†ã€‚ÚlThe trio thought that the goal remained worthwhile, even without Bill's support, and so they adopted the name "FreeBSD" coined by David Greenman.  The initial objectives were set after consulting with the system's current users and, once it became clear that the project was on the road to perhaps even becoming a reality, Jordan contacted Walnut Creek CDROM with an eye toward improving FreeBSD's distribution channels for those many unfortunates without easy access to the Internet.  Walnut Creek CDROM not only supported the idea of distributing FreeBSD on CD but also went so far as to provide the project with a machine to work on and a fast Internet connection.  Without Walnut Creek CDROM's almost unprecedented degree of faith in what was, at the time, a completely unknown project, it is quite unlikely that FreeBSD would have gotten as far, as fast, as it has today.Ú¸å³ä½¿æ²¡æœ‰ Bill çš„æ”¯æŒï¼Œä¸‰äººç»„ä»ç„¶è®¤ä¸ºç›®æ ‡ä»ç„¶å€¼å¾—è¿½æ±‚ï¼Œå› æ­¤ä»–ä»¬é‡‡ç”¨äº† David Greenman æå‡ºçš„â€œ FreeBSD â€è¿™ä¸ªåå­—ã€‚åœ¨ä¸ç³»ç»Ÿå½“å‰ç”¨æˆ·å’¨è¯¢åï¼Œç¡®å®šäº†æœ€åˆçš„ç›®æ ‡ã€‚ä¸€æ—¦æ¸…æ¥šè¯¥é¡¹ç›®å¯èƒ½æˆä¸ºç°å®ï¼Œ Jordan ä¾¿è”ç³»äº† Walnut Creek CDROM ï¼Œä»¥æ”¹å–„ FreeBSD çš„å‘è¡Œæ¸ é“ï¼Œä»¥ä¾¿é‚£äº›æ²¡æœ‰ä¾¿æ·è®¿é—®äº’è”ç½‘çš„äººã€‚ Walnut Creek CDROM ä¸ä»…æ”¯æŒåœ¨å…‰ç›˜ä¸Šåˆ†å‘ FreeBSD ï¼Œè¿˜æä¾›äº†ä¸€å°ç”¨äºå¼€å‘å·¥ä½œçš„æœºå™¨å’Œå¿«é€Ÿçš„äº’è”ç½‘è¿æ¥ã€‚å¦‚æœæ²¡æœ‰ Walnut Creek CDROM å¯¹å½“æ—¶ä¸€ä¸ªå®Œå…¨æœªçŸ¥çš„é¡¹ç›®çš„å‡ ä¹å‰æ‰€æœªæœ‰çš„ä¿¡ä»»ï¼Œ FreeBSD å¾ˆå¯èƒ½ä¸ä¼šåƒä»Šå¤©è¿™æ ·è¿…é€Ÿå–å¾—å¦‚æ­¤å¤§çš„è¿›å±•ã€‚Ú†The first CD-ROM (and general net-wide) distribution was FreeBSD 1.0, released in December of 1993.  This was based on the 4.3BSD-Lite ("Net/2") tape from U.C. Berkeley, with many components also provided by 386BSD and the Free Software Foundation.  It was a fairly reasonable success for a first offering, and they followed it with the highly successful FreeBSD 1.1 release in May of 1994.Ú‡ç¬¬ä¸€å¼  CD-ROM ï¼ˆä»¥åŠæ•´ä¸ªç½‘ç»œèŒƒå›´å†…çš„ï¼‰å‘è¡Œç‰ˆæ˜¯ FreeBSD 1.0 ï¼Œäº 1993 å¹´ 12 æœˆå‘å¸ƒã€‚å®ƒåŸºäºæ¥è‡ªåŠ å·å¤§å­¦ä¼¯å…‹åˆ©åˆ†æ ¡çš„ 4.3BSD-Lite ï¼ˆâ€œNet/2â€ï¼‰ç£å¸¦ï¼ŒåŒæ—¶è¿˜å€Ÿé‰´äº† 386BSD å’Œè‡ªç”±è½¯ä»¶åŸºé‡‘ä¼šæä¾›çš„è®¸å¤šç»„ä»¶ã€‚ä½œä¸ºé¦–æ¬¡å‘å¸ƒï¼Œå®ƒå–å¾—äº†ç›¸å½“ä¸é”™çš„æˆåŠŸï¼Œå¹¶åœ¨ 1994 å¹´ 5 æœˆå‘å¸ƒäº†å¤‡å—å¥½è¯„çš„ FreeBSD 1.1 ç‰ˆæœ¬ã€‚ÚyAround this time, some rather unexpected storm clouds formed on the horizon as Novell and U.C. Berkeley settled their long-running lawsuit over the legal status of the Berkeley Net/2 tape.  A condition of that settlement was U.C. Berkeley's concession that three files of Net/2 were "encumbered" code and had to be removed as they were the property of Novell, who had in turn acquired it from AT&T some time previously.  What Berkeley got in return was Novell's "blessing" that the 4.4BSD-Lite release, when it was finally released, would be declared unencumbered and all existing Net/2 users would be strongly encouraged to switch.  This included FreeBSD, and the project was given until the end of July 1994 to stop shipping its own Net/2 based product.  Under the terms of that agreement, the project was allowed one last release before the deadline, that release being FreeBSD 1.1.5.1.Úåœ¨è¿™ä¸ªæ—¶å€™ï¼ŒNovell å’ŒåŠ å·å¤§å­¦ä¼¯å…‹åˆ©åˆ†æ ¡ï¼ˆ U.C. Berkeley ï¼‰å°±æœ‰å…³ä¼¯å…‹åˆ© Net/2 ç£å¸¦çš„æ³•å¾‹åœ°ä½çš„é•¿æœŸè¯‰è®¼è¾¾æˆäº†æ„å¤–çš„å’Œè§£ã€‚å’Œè§£çš„æ¡ä»¶æ˜¯ U.C. Berkeley æ‰¿è®¤ Net/2 çš„ä¸‰ä¸ªæ–‡ä»¶æ˜¯â€œå—é™åˆ¶â€çš„ä»£ç ï¼Œå¿…é¡»äºˆä»¥åˆ é™¤ï¼Œå› ä¸ºå®ƒä»¬æ˜¯è¯ºç»´å°”çš„è´¢äº§ï¼Œè€Œ Novell åˆ™æ˜¯ä¹‹å‰ä» AT&T æ”¶è´­çš„ã€‚ä½œä¸ºå›æŠ¥ï¼Œä¼¯å…‹åˆ©è·å¾—äº† Novell çš„â€œç¥ç¦â€ï¼Œå³å½“ 4.4BSD-Lite ç‰ˆæœ¬æœ€ç»ˆå‘å¸ƒæ—¶ï¼Œå°†è¢«å®£å¸ƒä¸ºæ— é™åˆ¶çš„ï¼Œå¹¶å¼ºçƒˆé¼“åŠ±æ‰€æœ‰ç°æœ‰çš„ Net/2 ç”¨æˆ·åˆ‡æ¢è¿‡æ¥ã€‚è¿™åŒ…æ‹¬ FreeBSD ï¼Œè¯¥é¡¹ç›®è¢«ç»™äºˆæˆªæ­¢åˆ° 1994 å¹´ 7 æœˆåº•åœæ­¢å‘å¸ƒåŸºäº Net/2 çš„äº§å“çš„æ—¶é—´ã€‚æ ¹æ®åè®®çš„æ¡æ¬¾ï¼Œè¯¥é¡¹ç›®åœ¨æœ€åæœŸé™ä¹‹å‰è¢«å…è®¸å‘å¸ƒæœ€åä¸€ä¸ªç‰ˆæœ¬ï¼Œå³ FreeBSD 1.1.5.1 ã€‚ÚÆFreeBSD then set about the arduous task of literally re-inventing itself from a completely new and rather incomplete set of 4.4BSD-Lite bits.  Although only three files having to do with System V shared memory and semaphores were removed, many other changes and bug fixes had been made to the BSD distribution, so it was a huge task to merge all the FreeBSD developments into 4.4BSD-Lite.  It took the project until November of 1994 to make this transition, and in December it released FreeBSD 2.0 to the world.  Despite being still more than a little rough around the edges, the release was a significant success and was followed by the more robust and easier to install FreeBSD 2.0.5 release in June of 1995.Ú’FreeBSD éšåå¼€å§‹äº†ä¸€é¡¹è‰°å·¨çš„ä»»åŠ¡ï¼Œä»ä¸€ä¸ªå…¨æ–°ä¸”ç›¸å½“ä¸å®Œæ•´çš„ 4.4BSD-Lite ä»£ç åº“ä¸­é‡æ–°å¡‘é€ è‡ªå·±ã€‚è™½ç„¶åªæœ‰ä¸ System V å…±äº«å†…å­˜å’Œä¿¡å·é‡ç›¸å…³çš„ä¸‰ä¸ªæ–‡ä»¶è¢«åˆ é™¤ï¼Œä½†åœ¨ BSD å‘è¡Œç‰ˆä¸­è¿›è¡Œäº†è®¸å¤šå…¶ä»–çš„æ›´æ”¹å’Œé”™è¯¯ä¿®å¤ï¼Œå› æ­¤å°†æ‰€æœ‰ FreeBSD çš„å¼€å‘å·¥ä½œåˆå¹¶åˆ° 4.4BSD-Lite ä¸­æ˜¯ä¸€é¡¹å·¨å¤§çš„ä»»åŠ¡ã€‚è¯¥é¡¹ç›®ç›´åˆ° 1994 å¹´ 11 æœˆæ‰å®Œæˆäº†è¿™ä¸€è¿‡æ¸¡ï¼Œå¹¶åœ¨ 12 æœˆå‘ä¸–ç•Œå‘å¸ƒäº† FreeBSD 2.0 ç‰ˆæœ¬ã€‚å°½ç®¡åœ¨æŸç§ç¨‹åº¦ä¸Šä»ç„¶å­˜åœ¨ä¸€äº›é—®é¢˜ï¼Œä½†è¿™ä¸ªç‰ˆæœ¬å–å¾—äº†é‡å¤§çš„æˆåŠŸï¼Œå¹¶åœ¨ 1995 å¹´ 6 æœˆå‘å¸ƒäº†æ›´ç¨³å®šã€æ›´æ˜“å®‰è£…çš„ FreeBSD 2.0.5 ç‰ˆæœ¬ã€‚Ù‰Since that time, FreeBSD has made a series of releases each time improving the stability, speed, and feature set of the previous version.Ù€ä»é‚£æ—¶èµ·ï¼ŒFreeBSD å‘å¸ƒäº†ä¸€ç³»åˆ—ç‰ˆæœ¬ï¼Œæ¯æ¬¡éƒ½ä¼šåœ¨å‰ä¸€ç‰ˆæœ¬çš„ç¨³å®šæ€§ã€é€Ÿåº¦å’ŒåŠŸèƒ½é›†ä¸Šè¿›è¡Œæ”¹è¿›ã€‚ÚFor now, long-term development projects continue to take place in the {rel-head}-CURRENT (main) branch, and snapshot releases of {rel-head} are continually made available from link:https://download.freebsd.org/snapshots/[the snapshot server] as work progresses.ÙÙç›®å‰ï¼Œé•¿æœŸå‘å±•é¡¹ç›®ä»åœ¨{rel-head}-CURRENT (main) åˆ†æ”¯ä¸­è¿›è¡Œï¼Œå¹¶ä¸”éšç€å·¥ä½œçš„è¿›è¡Œï¼Œ{rel-head} çš„å¿«ç…§ç‰ˆæœ¬å°†æŒç»­ä» link:https://download.freebsd.org/snapshots/[å¿«ç…§æœåŠ¡å™¨] å‘å¸ƒã€‚µFreeBSD Project Goals·FreeBSD é¡¹ç›®çš„ç›®æ ‡Ú{The goals of the FreeBSD Project are to provide software that may be used for any purpose and without strings attached.  Many of us have a significant investment in the code (and project) and would certainly not mind a little financial compensation now and then, but we are definitely not prepared to insist on it.  We believe that our first and foremost "mission" is to provide code to any and all comers, and for whatever purpose, so that the code gets the widest possible use and provides the widest possible benefit.  This is, we believe, one of the most fundamental goals of Free Software and one that we enthusiastically support.ÚâFreeBSD é¡¹ç›®çš„ç›®æ ‡æ˜¯æä¾›å¯ç”¨äºä»»ä½•ç›®çš„ä¸”æ— é™„åŠ æ¡ä»¶çš„è½¯ä»¶ã€‚æˆ‘ä»¬ä¸­çš„è®¸å¤šäººåœ¨ä»£ç ï¼ˆå’Œé¡¹ç›®ï¼‰ä¸ŠæŠ•å…¥äº†å¤§é‡èµ„æºï¼Œå¶å°”è·å¾—ä¸€äº›è´¢åŠ¡è¡¥å¿å¹¶ä¸ä»‹æ„ï¼Œä½†æˆ‘ä»¬ç»å¯¹ä¸ä¼šåšæŒè¦æ±‚ã€‚æˆ‘ä»¬ç›¸ä¿¡æˆ‘ä»¬çš„é¦–è¦ä»»åŠ¡æ˜¯å‘ä»»ä½•äººæä¾›ä»£ç ï¼Œæ— è®ºå‡ºäºä½•ç§ç›®çš„ï¼Œä»¥ä¾¿ä»£ç å¾—åˆ°æœ€å¹¿æ³›çš„ä½¿ç”¨å¹¶æä¾›æœ€å¹¿æ³›çš„åˆ©ç›Šã€‚æˆ‘ä»¬è®¤ä¸ºè¿™æ˜¯è‡ªç”±è½¯ä»¶çš„æœ€åŸºæœ¬ç›®æ ‡ä¹‹ä¸€ï¼Œæˆ‘ä»¬å¯¹æ­¤è¡¨ç¤ºçƒ­æƒ…æ”¯æŒã€‚ÚÆThat code in our source tree which falls under the GNU General Public License (GPL) or Library General Public License (LGPL) comes with slightly more strings attached, though at least on the side of enforced access rather than the usual opposite.  Due to the additional complexities that can evolve in the commercial use of GPL software we do, however, prefer software submitted under the more relaxed BSD license when it is a reasonable option to do so.Úvæˆ‘ä»¬æºä»£ç æ ‘ä¸­å— GNU é€šç”¨å…¬å…±è®¸å¯è¯ï¼ˆ GPL ï¼‰æˆ–åº“é€šç”¨å…¬å…±è®¸å¯è¯ï¼ˆ LGPL ï¼‰çº¦æŸçš„ä»£ç ï¼Œé™„å¸¦äº†ç¨å¾®æ›´å¤šçš„é™åˆ¶ï¼Œå°½ç®¡è‡³å°‘æ˜¯åœ¨å¼ºåˆ¶è®¿é—®æ–¹é¢ï¼Œè€Œä¸æ˜¯é€šå¸¸çš„ç›¸åæƒ…å†µã€‚ç”±äºå•†ä¸šä½¿ç”¨ GPL è½¯ä»¶å¯èƒ½å‡ºç°çš„é¢å¤–å¤æ‚æ€§ï¼Œæˆ‘ä»¬æ›´å–œæ¬¢åœ¨åˆç†çš„æƒ…å†µä¸‹é€‰æ‹©ä»¥æ›´å®½æ¾çš„ BSD è®¸å¯è¯æäº¤çš„è½¯ä»¶ã€‚½The FreeBSD Development Model´FreeBSD å¼€å‘æ¨¡å‹ÚThe development of FreeBSD is a extref:{dev-model}[very open and flexible process], being literally built from the contributions of thousands of people around the world, as can be seen from our extref:{contributors}[list of contributors].  FreeBSD's development infrastructure allows these thousands of contributors to collaborate over the Internet.  We are constantly on the lookout for new volunteers, and those interested in becoming more closely involved should consult the article on extref:{contributing}[Contributing to FreeBSD].ÚFreeBSD çš„å¼€å‘æ˜¯ä¸€ä¸ªextref:{dev-model}[éå¸¸å¼€æ”¾å’Œçµæ´»çš„è¿‡ç¨‹,very open and flexible process]ï¼Œä»ä¸–ç•Œå„åœ°æˆåƒä¸Šä¸‡çš„äººçš„è´¡çŒ®ä¸­æ„å»ºè€Œæˆï¼Œè¿™ä¸€ç‚¹å¯ä»¥ä»æˆ‘ä»¬çš„ extref:{contributors}[è´¡çŒ®è€…åˆ—è¡¨,list of contributors] ä¸­çœ‹å‡ºæ¥ã€‚ FreeBSD çš„å¼€å‘åŸºç¡€è®¾æ–½å…è®¸è¿™äº›æˆåƒä¸Šä¸‡çš„è´¡çŒ®è€…åœ¨äº’è”ç½‘ä¸Šè¿›è¡Œåˆä½œã€‚æˆ‘ä»¬ä¸€ç›´åœ¨å¯»æ‰¾æ–°çš„å¿—æ„¿è€…ï¼Œæœ‰å…´è¶£æ›´æ·±å…¥å‚ä¸çš„äººåº”è¯¥å‚è€ƒæœ‰å…³ extref:{contributing}[è´¡çŒ® FreeBSD,Contributing to FreeBSD]  çš„æ–‡ç« ã€‚ÙƒUseful things to know about the FreeBSD Project and its development process, whether working independently or in close cooperation:Ùræ— è®ºæ˜¯ç‹¬ç«‹å·¥ä½œè¿˜æ˜¯å¯†åˆ‡åˆä½œï¼Œä»¥ä¸‹æ˜¯å…³äº FreeBSD é¡¹ç›®åŠå…¶å¼€å‘è¿‡ç¨‹çš„ä¸€äº›æœ‰ç”¨ä¿¡æ¯ï¼šÙ2The Git repositories[[development-cvs-repository]]Ù)Git ä»“åº“ [[development-cvs-repository]]Ú±For several years, the central source tree for FreeBSD was maintained by link:https://www.nongnu.org/cvs/[CVS] (Concurrent Versions System), a freely available source code control tool.  In June 2008, the Project switched to using link:https://subversion.apache.org/[SVN] (Subversion).  The switch was deemed necessary, as the technical limitations imposed by CVS were becoming obvious due to the rapid expansion of the source tree and the amount of history already stored.  The Documentation Project and Ports Collection repositories also moved from CVS to SVN in May 2012 and July 2012, respectively.  In December 2020, the Project link:https://www.freebsd.org/status/report-2020-10-2020-12.html#Git-Migration-Working-Group[migrated Source and Documentation repositories] to link:https://git-scm.com/[Git], with link:https://www.freebsd.org/status/report-2021-04-2021-06/#_git_migration_working_group[Ports following suit] in April 2021.  Please refer to the crossref:cutting-edge[synching, Obtaining the Source] section for more information on obtaining the FreeBSD `src/` repository and crossref:ports[ports-using, Using the Ports Collection] for details on obtaining the FreeBSD Ports Collection.Ú¡å¤šå¹´æ¥ï¼Œ FreeBSD çš„ä¸­å¤®æºä»£ç æ ‘ç”±å…è´¹å¯ç”¨çš„æºä»£ç æ§åˆ¶å·¥å…· link:https://www.nongnu.org/cvs/[CVS] ï¼ˆ Concurrent Versions System ï¼‰ç»´æŠ¤ã€‚ 2008 å¹´ 6 æœˆï¼Œè¯¥é¡¹ç›®è½¬è€Œä½¿ç”¨ link:https://subversion.apache.org/[SVN] ï¼ˆ Subversion ï¼‰ã€‚ç”±äºæºä»£ç æ ‘çš„è¿…é€Ÿæ‰©å±•å’Œå·²å­˜å‚¨çš„å†å²è®°å½•é‡ï¼Œ CVS æ‰€æ–½åŠ çš„æŠ€æœ¯é™åˆ¶å˜å¾—æ˜æ˜¾ï¼Œå› æ­¤è¿™æ¬¡è½¬æ¢è¢«è®¤ä¸ºæ˜¯å¿…è¦çš„ã€‚æ–‡æ¡£é¡¹ç›®å’Œ Ports é›†åˆå­˜å‚¨åº“ä¹Ÿåˆ†åˆ«äº 2012 å¹´ 5 æœˆå’Œ 2012 å¹´ 7 æœˆä» CVS è¿ç§»åˆ°äº† SVN ã€‚ 2020 å¹´ 12 æœˆï¼Œè¯¥é¡¹ç›®å°†æºä»£ç å’Œæ–‡æ¡£å­˜å‚¨åº“è¿ç§»åˆ°äº† link:https://git-scm.com/[Git] ï¼Œè€Œ Ports é›†åˆåˆ™åœ¨ 2021 å¹´ 4 æœˆè·Ÿéšã€‚æœ‰å…³è·å– FreeBSD `src/` å­˜å‚¨åº“çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜… crossref:cutting-edge[synching , Obtaining the Source] éƒ¨åˆ†ï¼Œæœ‰å…³è·å– FreeBSD  Ports é›†åˆçš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… crossref:ports[ports-using , Using the Ports Collection] ã€‚Ù-The committers list[[development-committers]]Ù*è´¡çŒ®è€…åˆ—è¡¨ [[development-committers]]ÚğThe _committers_ are the people who have _push_ access to the Git repository, and are authorized to make modifications to the FreeBSD source (the term "committer" comes from `commit`, the source control command which is used to bring new changes into the repository).  Anyone can submit a bug to the link:https://bugs.FreeBSD.org/submit/[Bug Database].  Before submitting a bug report, the FreeBSD mailing lists, IRC channels, or forums can be used to help verify that an issue is actually a bug.ÚÕ_committers_ æ˜¯é‚£äº›å…·æœ‰å¯¹ Git ä»“åº“çš„ _push_ è®¿é—®æƒé™çš„äººï¼Œä»–ä»¬è¢«æˆæƒå¯¹ FreeBSD æºä»£ç è¿›è¡Œä¿®æ”¹ï¼ˆæœ¯è¯­â€œcommitterâ€æ¥è‡ªäº `commit` ï¼Œè¿™æ˜¯ç”¨äºå°†æ–°æ›´æ”¹å¼•å…¥ä»“åº“çš„æºä»£ç æ§åˆ¶å‘½ä»¤ï¼‰ã€‚ä»»ä½•äººéƒ½å¯ä»¥æäº¤ä¸€ä¸ª bug åˆ° link:https://bugs.FreeBSD.org/submit/[Bug Database] ã€‚åœ¨æäº¤ bug æŠ¥å‘Šä¹‹å‰ï¼Œå¯ä»¥ä½¿ç”¨ FreeBSD é‚®ä»¶åˆ—è¡¨ã€ IRC é¢‘é“æˆ–è®ºå›æ¥å¸®åŠ©éªŒè¯ä¸€ä¸ªé—®é¢˜æ˜¯å¦çœŸçš„æ˜¯ä¸€ä¸ª bug ã€‚Ù)The FreeBSD core team[[development-core]]Ù)FreeBSD æ ¸å¿ƒå›¢é˜Ÿ [[development-core]]Ú#The _FreeBSD core team_ would be equivalent to the board of directors if the FreeBSD Project were a company.  The primary task of the core team is to make sure the project, as a whole, is in good shape and is heading in the right directions.  Inviting dedicated and responsible developers to join our group of committers is one of the functions of the core team, as is the recruitment of new core team members as others move on.  The current core team was elected from a pool of committer candidates in May 2022.  Elections are held every 2 years.ÚÚå¦‚æœ FreeBSD é¡¹ç›®æ˜¯ä¸€å®¶å…¬å¸ï¼Œé‚£ä¹ˆ _FreeBSD æ ¸å¿ƒå›¢é˜Ÿ_ å°†ç›¸å½“äºè‘£äº‹ä¼šã€‚æ ¸å¿ƒå›¢é˜Ÿçš„ä¸»è¦ä»»åŠ¡æ˜¯ç¡®ä¿æ•´ä¸ªé¡¹ç›®å¤„äºè‰¯å¥½çŠ¶æ€å¹¶æœç€æ­£ç¡®çš„æ–¹å‘å‘å±•ã€‚é‚€è¯·ä¸“æ³¨å’Œè´Ÿè´£ä»»çš„å¼€å‘äººå‘˜åŠ å…¥æˆ‘ä»¬çš„æäº¤è€…å›¢é˜Ÿæ˜¯æ ¸å¿ƒå›¢é˜Ÿçš„èŒè´£ä¹‹ä¸€ï¼Œæ‹›å‹Ÿæ–°çš„æ ¸å¿ƒå›¢é˜Ÿæˆå‘˜ä¹Ÿæ˜¯æ ¸å¿ƒå›¢é˜Ÿçš„èŒè´£ä¹‹ä¸€ã€‚å½“å‰çš„æ ¸å¿ƒå›¢é˜Ÿæ˜¯åœ¨ 2022 å¹´ 5 æœˆä»æäº¤è€…å€™é€‰äººä¸­é€‰ä¸¾äº§ç”Ÿçš„ã€‚é€‰ä¸¾æ¯ 2 å¹´ä¸¾è¡Œä¸€æ¬¡ã€‚Ú´Like most developers, most members of the core team are also volunteers when it comes to FreeBSD development and do not benefit from the project financially, so "commitment" should also not be misconstrued as meaning "guaranteed support." The "board of directors" analogy above is not very accurate, and it may be more suitable to say that these are the people who gave up their lives in favor of FreeBSD against their better judgement!Ú†å’Œå¤§å¤šæ•°å¼€å‘è€…ä¸€æ ·ï¼Œ FreeBSD æ ¸å¿ƒå›¢é˜Ÿçš„å¤§å¤šæ•°æˆå‘˜åœ¨ FreeBSD å¼€å‘æ–¹é¢ä¹Ÿæ˜¯å¿—æ„¿è€…ï¼Œå¹¶ä¸”æ²¡æœ‰ä»é¡¹ç›®ä¸­è·å¾—ç»æµåˆ©ç›Šï¼Œæ‰€ä»¥â€œæ‰¿è¯ºâ€ä¹Ÿä¸åº”è¢«è¯¯è§£ä¸ºâ€œæœ‰ä¿è¯çš„æ”¯æŒâ€ã€‚ä¸Šé¢æåˆ°çš„â€œè‘£äº‹ä¼šâ€ç±»æ¯”å¹¶ä¸ååˆ†å‡†ç¡®ï¼Œæ›´é€‚åˆè¯´è¿™äº›äººæ˜¯åœ¨è¿èƒŒè‡ªå·±æ›´å¥½åˆ¤æ–­çš„æƒ…å†µä¸‹é€‰æ‹©äº† FreeBSD è€Œæ”¾å¼ƒäº†è‡ªå·±çš„ç”Ÿæ´»ï¼Ù0The FreeBSD Foundation[[development-foundation]]Ù%FreeBSD åŸºé‡‘ä¼š [[å¼€å‘åŸºé‡‘ä¼š]]ÚªThe link:https://freebsdfoundation.org/[FreeBSD Foundation] is a 501(c)(3), US-based, non-profit organization dedicated to supporting and promoting the FreeBSD Project and community worldwide.  The Foundation funds software development via project grants and provides staff to immediately respond to urgent problems and implement new features and functionality.  The Foundation purchases hardware to improve and maintain FreeBSD infrastructure, and funds staffing to improve test coverage, continuous integration and automation.  The Foundation advocates for FreeBSD by promoting FreeBSD at technical conferences and events around the world.  The Foundation also provides workshops, educational material, and presentations to recruit more users and contributors to FreeBSD.  The Foundation also represents the FreeBSD Project in executing contracts, license agreements, and other legal arrangements that require a recognized legal entity.ÚÔ link:https://freebsdfoundation.org/[FreeBSD åŸºé‡‘ä¼š] æ˜¯ä¸€ä¸ªä½äºç¾å›½çš„ 501(c)(3) éè¥åˆ©ç»„ç»‡ï¼Œè‡´åŠ›äºæ”¯æŒå’Œæ¨å¹¿å…¨çƒçš„ FreeBSD é¡¹ç›®å’Œç¤¾åŒºã€‚åŸºé‡‘ä¼šé€šè¿‡é¡¹ç›®æ‹¨æ¬¾èµ„åŠ©è½¯ä»¶å¼€å‘ï¼Œå¹¶æä¾›å‘˜å·¥ç«‹å³å“åº”ç´§æ€¥é—®é¢˜å¹¶å®æ–½æ–°çš„ç‰¹æ€§å’ŒåŠŸèƒ½ã€‚åŸºé‡‘ä¼šè´­ä¹°ç¡¬ä»¶ä»¥æ”¹å–„å’Œç»´æŠ¤ FreeBSD åŸºç¡€è®¾æ–½ï¼Œå¹¶èµ„åŠ©äººå‘˜æé«˜æµ‹è¯•è¦†ç›–ç‡ã€æŒç»­é›†æˆå’Œè‡ªåŠ¨åŒ–ã€‚åŸºé‡‘ä¼šé€šè¿‡åœ¨ä¸–ç•Œå„åœ°çš„æŠ€æœ¯ä¼šè®®å’Œæ´»åŠ¨ä¸Šæ¨å¹¿ FreeBSD æ¥æ”¯æŒ FreeBSD ã€‚åŸºé‡‘ä¼šè¿˜æä¾›ç ”è®¨ä¼šã€æ•™è‚²ææ–™å’Œæ¼”ç¤ºï¼Œä»¥å¸å¼•æ›´å¤šçš„ FreeBSD ç”¨æˆ·å’Œè´¡çŒ®è€…ã€‚åŸºé‡‘ä¼šè¿˜ä»£è¡¨ FreeBSD é¡¹ç›®æ‰§è¡ŒåˆåŒã€è®¸å¯åè®®å’Œå…¶ä»–éœ€è¦è®¤å¯æ³•å¾‹å®ä½“çš„æ³•å¾‹å®‰æ’ã€‚´Outside contributors¯å¤–éƒ¨è´¡çŒ®è€…Ú'Last, but definitely not least, the largest group of developers are the users themselves who provide feedback and bug fixes to us on an almost constant basis.  The primary way of keeping in touch with the development of the FreeBSD base system is to subscribe to the {freebsd-hackers} where such things are discussed.  For porting third party applications, it would be the {freebsd-ports}.  For documentation - {freebsd-doc}.  See crossref:eresources[eresources, Resources on the Internet] for more information about the various FreeBSD mailing lists.Úææœ€åï¼Œä½†ç»å¯¹ä¸æ˜¯æœ€ä¸é‡è¦çš„ï¼Œæœ€å¤§çš„å¼€å‘è€…ç¾¤ä½“æ˜¯ç”¨æˆ·è‡ªå·±ï¼Œä»–ä»¬å‡ ä¹ä¸€ç›´å‘æˆ‘ä»¬æä¾›åé¦ˆå’Œé”™è¯¯ä¿®å¤ã€‚ä¸ FreeBSD åŸºæœ¬ç³»ç»Ÿçš„å¼€å‘ä¿æŒè”ç³»çš„ä¸»è¦æ–¹å¼æ˜¯è®¢é˜… {freebsd-hackers} ï¼Œåœ¨è¿™é‡Œè®¨è®ºè¿™äº›äº‹æƒ…ã€‚å¯¹äºç§»æ¤ç¬¬ä¸‰æ–¹åº”ç”¨ç¨‹åºï¼Œå¯ä»¥ä½¿ç”¨ {freebsd-ports} ã€‚å¯¹äºæ–‡æ¡£ï¼Œå¯ä»¥ä½¿ç”¨ {freebsd-doc} ã€‚æœ‰å…³å„ç§ FreeBSD é‚®ä»¶åˆ—è¡¨çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§ crossref:eresources[eresources,äº’è”ç½‘èµ„æº]ã€‚ÙÎextref:{contributors}[The FreeBSD Contributors List] is a long and growing one, so why not join it by extref:{contributing}[contributing something back to FreeBSD] today? Providing code is not the only way!Úextref:{contributors}[The FreeBSD è´¡çŒ®è€…åˆ—è¡¨,The FreeBSD Contributors List] æ˜¯ä¸€ä¸ªé•¿æœŸè€Œä¸æ–­å¢é•¿çš„åˆ—è¡¨ï¼Œä¸ºä»€ä¹ˆä¸é€šè¿‡ extref:{contributing}[ä¸º FreeBSD åšå‡ºè´¡çŒ®,contributing something back to FreeBSD] åŠ å…¥å…¶ä¸­å‘¢ï¼Ÿæä¾›ä»£ç å¹¶ä¸æ˜¯å”¯ä¸€çš„æ–¹å¼ï¼ÚìIn summary, our development model is organized as a loose set of concentric circles.  The centralized model is designed for the convenience of the _users_ of FreeBSD, who are provided with an easy way of tracking one central code base, not to keep potential contributors out! Our desire is to present a stable operating system with a large set of coherent crossref:ports[ports,application programs] that the users can easily install and use - this model works very well in accomplishing that.Ú§æ€»ä¹‹ï¼Œæˆ‘ä»¬çš„å¼€å‘æ¨¡å‹æ˜¯ä»¥ä¸€ç»„æ¾æ•£çš„åŒå¿ƒåœ†ç»„ç»‡èµ·æ¥çš„ã€‚ä¸­å¿ƒåŒ–æ¨¡å‹æ˜¯ä¸ºäº†æ–¹ä¾¿ FreeBSD çš„ç”¨æˆ·ï¼Œä»–ä»¬å¯ä»¥é€šè¿‡è¿½è¸ªä¸€ä¸ªä¸­å¤®ä»£ç åº“æ¥è·å¾—ä¾¿åˆ©ï¼Œè€Œä¸æ˜¯ä¸ºäº†æ’æ–¥æ½œåœ¨çš„è´¡çŒ®è€…ï¼æˆ‘ä»¬çš„æ„¿æœ›æ˜¯æä¾›ä¸€ä¸ªç¨³å®šçš„æ“ä½œç³»ç»Ÿï¼Œé…å¤‡ä¸€å¥—å¤§é‡çš„ä¸€è‡´çš„åº”ç”¨ç¨‹åºï¼Œç”¨æˆ·å¯ä»¥è½»æ¾å®‰è£…å’Œä½¿ç”¨ - è¿™ä¸ªæ¨¡å‹åœ¨å®ç°è¿™ä¸€ç›®æ ‡æ–¹é¢éå¸¸æˆåŠŸã€‚ÙŒAll we ask of those who would join us as FreeBSD developers is some of the same dedication its current people have to its continued success!Ùœæˆ‘ä»¬å¯¹é‚£äº›å¸Œæœ›åŠ å…¥æˆ‘ä»¬æˆä¸º FreeBSD å¼€å‘è€…çš„äººåªæœ‰ä¸€ä¸ªè¦æ±‚ï¼Œé‚£å°±æ˜¯æ‹¥æœ‰ä¸ç°æœ‰æˆå‘˜ä¸€æ ·å¯¹å…¶æŒç»­æˆåŠŸçš„å¥‰çŒ®ç²¾ç¥ï¼´Third Party Programs¯ç¬¬ä¸‰æ–¹ç¨‹åºÚuIn addition to the base distributions, FreeBSD offers a ported software collection with thousands of commonly sought-after programs.  The list of ports ranges from HTTP servers to games, languages, editors, and almost everything in between.  There are about {numports} ports; the entire Ports Collection requires approximately {ports-size}.  To compile a port, you simply change to the directory of the program you wish to install, type `make install`, and let the system do the rest.  The full original distribution for each port you build is retrieved dynamically so you need only enough disk space to build the ports you want.ÚPé™¤äº†åŸºæœ¬å‘è¡Œç‰ˆä¹‹å¤–ï¼Œ FreeBSD è¿˜æä¾›äº†ä¸€ä¸ªå¯ç§»æ¤è½¯ä»¶é›†åˆï¼Œå…¶ä¸­åŒ…å«æ•°åƒä¸ªå¸¸è§çš„ç¨‹åºã€‚ports åˆ—è¡¨æ¶µç›–äº†ä» HTTP æœåŠ¡å™¨åˆ°æ¸¸æˆã€ç¼–ç¨‹è¯­è¨€ã€ç¼–è¾‘å™¨ç­‰å‡ ä¹æ‰€æœ‰é¢†åŸŸçš„ç¨‹åºã€‚å¤§çº¦æœ‰ {numports} ä¸ª portsï¼›æ•´ä¸ª Ports é›†åˆéœ€è¦å¤§çº¦ {ports-size} çš„ç©ºé—´ã€‚è¦ç¼–è¯‘ä¸€ä¸ª portsï¼Œåªéœ€åˆ‡æ¢åˆ°æ‚¨æƒ³è¦å®‰è£…çš„ç¨‹åºçš„ç›®å½•ï¼Œè¾“å…¥ `make install`ï¼Œç„¶åè®©ç³»ç»Ÿå®Œæˆå‰©ä¸‹çš„å·¥ä½œã€‚æ¯ä¸ªæ„å»ºçš„ ports éƒ½ä¼šåŠ¨æ€åœ°æ£€ç´¢å®Œæ•´çš„åŸå§‹å‘è¡Œç‰ˆï¼Œå› æ­¤æ‚¨åªéœ€è¦è¶³å¤Ÿçš„ç£ç›˜ç©ºé—´æ¥æ„å»ºæ‰€éœ€çš„ portsã€‚Ú8Almost every port is also provided as a pre-compiled "package", which can be installed with a simple command (`pkg install`) by those who do not wish to compile their own ports from source.  More information on packages and ports can be found in crossref:ports[ports,Installing Applications: Packages and Ports].Ú)å‡ ä¹æ¯ä¸ª ports ä¹Ÿéƒ½æä¾›äº†é¢„ç¼–è¯‘çš„â€œè½¯ä»¶åŒ…â€ï¼Œä¸å¸Œæœ›ä»æºä»£ç ç¼–è¯‘è‡ªå·±çš„ ports çš„ç”¨æˆ·å¯ä»¥ä½¿ç”¨ç®€å•çš„å‘½ä»¤ï¼ˆ `pkg install` ï¼‰è¿›è¡Œå®‰è£…ã€‚æœ‰å…³è½¯ä»¶åŒ…å’Œ ports çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜… crossref:ports[ports,å®‰è£…åº”ç”¨ç¨‹åºï¼šè½¯ä»¶åŒ…å’Œ ports] ã€‚¸Additional Documentation¬é™„åŠ æ–‡æ¡£ÙñAll supported FreeBSD versions provide an option in the installer to install additional documentation under [.filename]#/usr/local/share/doc/freebsd# during the initial system setup.  Documentation may also be installed later using packages:Ùáæ‰€æœ‰æ”¯æŒçš„ FreeBSD ç‰ˆæœ¬åœ¨å®‰è£…ç¨‹åºä¸­æä¾›äº†ä¸€ä¸ªé€‰é¡¹ï¼Œåœ¨åˆå§‹ç³»ç»Ÿè®¾ç½®æœŸé—´å¯ä»¥å®‰è£…é™„åŠ æ–‡æ¡£åˆ° [.filename]#/usr/local/share/doc/freebsd#ã€‚æ–‡æ¡£ä¹Ÿå¯ä»¥åœ¨ä¹‹åä½¿ç”¨è½¯ä»¶åŒ…è¿›è¡Œå®‰è£…ï¼šÚ,For localized versions replace the "en" with the language prefix of choice.  Be aware that some of the localised versions might be out of date and might contain information that is no longer correct or relevant.  You may view the locally installed manuals with a web browser using the following URLs:Ùùå¯¹äºæœ¬åœ°åŒ–ç‰ˆæœ¬ï¼Œè¯·å°†â€œenâ€æ›¿æ¢ä¸ºæ‰€é€‰è¯­è¨€çš„è¯­è¨€å‰ç¼€ã€‚è¯·æ³¨æ„ï¼Œä¸€äº›æœ¬åœ°åŒ–ç‰ˆæœ¬å¯èƒ½å·²è¿‡æ—¶ï¼Œå¯èƒ½åŒ…å«ä¸å†æ­£ç¡®æˆ–ç›¸å…³çš„ä¿¡æ¯ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ URL åœ¨ Web æµè§ˆå™¨ä¸­æŸ¥çœ‹æœ¬åœ°å®‰è£…çš„æ‰‹å†Œï¼š´The FreeBSD Handbook®FreeBSD æ‰‹å†Œ¯The FreeBSD FAQºFreeBSD å¸¸è§é—®é¢˜è§£ç­”ÙiYou can always find up to date documentation at link:https://docs.FreeBSD.org/[The Documentation Portal].ÙXæ‚¨å¯ä»¥éšæ—¶åœ¨ link:https://docs.FreeBSD.org/[æ–‡æ¡£é—¨æˆ·] æ‰¾åˆ°æœ€æ–°çš„æ–‡æ¡£ã€‚Ù;All trademarks are the property of their respective owners.Ù0æ‰€æœ‰å•†æ ‡å‡ä¸ºå…¶å„è‡ªæ‰€æœ‰è€…çš„è´¢äº§ã€‚Ú0A group is a list of users. A group is identified by its group name and GID.  In FreeBSD, the kernel uses the UID of a process, and the list of groups it belongs to, to determine what the process is allowed to do.  Most of the time, the GID of a user or process usually means the first group in the list.Ùùç»„æ˜¯ä¸€ä¸ªç”¨æˆ·åˆ—è¡¨ã€‚ç»„ç”±ç»„åç§°å’Œ GID æ ‡è¯†ã€‚åœ¨ FreeBSD ä¸­ï¼Œå†…æ ¸ä½¿ç”¨è¿›ç¨‹çš„ UID å’Œå…¶æ‰€å±çš„ç»„åˆ—è¡¨æ¥ç¡®å®šè¯¥è¿›ç¨‹è¢«å…è®¸åšä»€ä¹ˆã€‚å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œç”¨æˆ·æˆ–è¿›ç¨‹çš„ GID é€šå¸¸è¡¨ç¤ºåˆ—è¡¨ä¸­çš„ç¬¬ä¸€ä¸ªç»„ã€‚ÚMThe group name to GID mapping is listed in `/etc/group`.  This is a plain text file with four colon-delimited fields.  The first field is the group name, the second is the encrypted password, the third the GID, and the fourth the comma-delimited list of members.  For a more complete description of the syntax, refer to man:group[5].Ú:ç»„ååˆ° GID çš„æ˜ å°„åœ¨ `/etc/group` ä¸­åˆ—å‡ºã€‚è¿™æ˜¯ä¸€ä¸ªçº¯æ–‡æœ¬æ–‡ä»¶ï¼ŒåŒ…å«å››ä¸ªç”±å†’å·åˆ†éš”çš„å­—æ®µã€‚ç¬¬ä¸€ä¸ªå­—æ®µæ˜¯ç»„åï¼Œç¬¬äºŒä¸ªå­—æ®µæ˜¯åŠ å¯†å¯†ç ï¼Œç¬¬ä¸‰ä¸ªå­—æ®µæ˜¯ GID ï¼Œç¬¬å››ä¸ªå­—æ®µæ˜¯é€—å·åˆ†éš”çš„æˆå‘˜åˆ—è¡¨ã€‚æœ‰å…³è¯­æ³•çš„æ›´å®Œæ•´æè¿°ï¼Œè¯·å‚é˜… man:group[5] ã€‚Ú1The superuser can modify `/etc/group` using a text editor, although editing the group file using man:vigr[8] is preferred because it can catch some common mistakes.  Alternatively, man:pw[8] can be used to add and edit groups.  For example, to add a group called `teamtwo` and then confirm that it exists:Ú0è¶…çº§ç”¨æˆ·å¯ä»¥ä½¿ç”¨æ–‡æœ¬ç¼–è¾‘å™¨ä¿®æ”¹ `/etc/group` æ–‡ä»¶ï¼Œå°½ç®¡ä½¿ç”¨ man:vigr[8] ç¼–è¾‘ç»„æ–‡ä»¶æ›´ä¸ºæ¨èï¼Œå› ä¸ºå®ƒå¯ä»¥æ•æ‰ä¸€äº›å¸¸è§çš„é”™è¯¯ã€‚å¦å¤–ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ man:pw[8] æ¥æ·»åŠ å’Œç¼–è¾‘ç»„ã€‚ä¾‹å¦‚ï¼Œè¦æ·»åŠ ä¸€ä¸ªåä¸º `teamtwo` çš„ç»„ï¼Œå¹¶ç¡®è®¤å®ƒæ˜¯å¦å­˜åœ¨ï¼šÙÏCare must be taken when using the operator group, as unintended superuser-like access privileges may be granted, including but not limited to shutdown, reboot, and access to all items in `/dev` in the group.Ù¹åœ¨ä½¿ç”¨æ“ä½œå‘˜ç»„æ—¶å¿…é¡»å°å¿ƒï¼Œå› ä¸ºå¯èƒ½ä¼šæˆäºˆæ„å¤–çš„ç±»ä¼¼è¶…çº§ç”¨æˆ·çš„è®¿é—®æƒé™ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºå…³é—­ã€é‡å¯ä»¥åŠè®¿é—®ç»„ä¸­ `/dev` ä¸­çš„æ‰€æœ‰é¡¹ç›®ã€‚¾Adding a Group Using man:pw[8]Ù ä½¿ç”¨ man:pw[8] æ·»åŠ ä¸€ä¸ªç»„ÙIn this example, `1100` is the GID of `teamtwo`.  Right now, `teamtwo` has no members.  This command will add `jru` as a member of `teamtwo`.Ù“åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ`1100` æ˜¯ `teamtwo` çš„ GID ã€‚ç›®å‰ï¼Œ`teamtwo` æ²¡æœ‰æˆå‘˜ã€‚è¿™ä¸ªå‘½ä»¤å°†ä¼šæŠŠ `jru` æ·»åŠ ä¸º `teamtwo` çš„æˆå‘˜ã€‚Ù3Adding User Accounts to a New Group Using man:pw[8]Ù2ä½¿ç”¨ man:pw[8] å°†ç”¨æˆ·è´¦æˆ·æ·»åŠ åˆ°æ–°ç»„ä¸­ÚOThe argument to `-M` is a comma-delimited list of users to be added to a new (empty) group or to replace the members of an existing group.  To the user, this group membership is different from (and in addition to) the user's primary group listed in the password file.  This means that the user will not show up as a member when using `groupshow` with man:pw[8], but will show up when the information is queried via man:id[1] or a similar tool.  When man:pw[8] is used to add a user to a group, it only manipulates `/etc/group` and does not attempt to read additional data from `/etc/passwd`.ÚZ`-M` å‚æ•°åé¢æ˜¯ä¸€ä¸ªé€—å·åˆ†éš”çš„ç”¨æˆ·åˆ—è¡¨ï¼Œç”¨äºå°†è¿™äº›ç”¨æˆ·æ·»åŠ åˆ°ä¸€ä¸ªæ–°çš„ï¼ˆç©ºçš„ï¼‰ç»„ä¸­ï¼Œæˆ–è€…æ›¿æ¢ç°æœ‰ç»„çš„æˆå‘˜ã€‚å¯¹äºç”¨æˆ·æ¥è¯´ï¼Œè¿™ä¸ªç»„æˆå‘˜èº«ä»½ä¸å¯†ç æ–‡ä»¶ä¸­åˆ—å‡ºçš„ç”¨æˆ·çš„ä¸»ç»„ä¸åŒï¼Œè€Œä¸”æ˜¯é¢å¤–çš„ã€‚è¿™æ„å‘³ç€å½“ä½¿ç”¨ `groupshow` å’Œ man:pw[8] ä¸€èµ·æŸ¥çœ‹ç”¨æˆ·æ—¶ï¼Œç”¨æˆ·ä¸ä¼šæ˜¾ç¤ºä¸ºç»„æˆå‘˜ï¼Œä½†æ˜¯å½“ä½¿ç”¨ man:id[1] æˆ–ç±»ä¼¼çš„å·¥å…·æŸ¥è¯¢ä¿¡æ¯æ—¶ï¼Œç”¨æˆ·ä¼šæ˜¾ç¤ºä¸ºç»„æˆå‘˜ã€‚å½“ä½¿ç”¨ man:pw[8] å°†ç”¨æˆ·æ·»åŠ åˆ°ç»„æ—¶ï¼Œå®ƒåªæ“ä½œ `/etc/group` æ–‡ä»¶ï¼Œå¹¶ä¸å°è¯•ä» `/etc/passwd` ä¸­è¯»å–é¢å¤–çš„æ•°æ®ã€‚Ù.Adding a New Member to a Group Using man:pw[8]Ù/ä½¿ç”¨ man:pw[8] æ·»åŠ æ–°æˆå‘˜åˆ°ä¸€ä¸ªç»„ä¸­ÙŞIn this example, the argument to `-m` is a comma-delimited list of users who are to be added to the group.  Unlike the previous example, these users are appended to the group and do not replace existing users in the group.Ùçåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ `-m` å‚æ•°åé¢æ˜¯ä¸€ä¸ªé€—å·åˆ†éš”çš„ç”¨æˆ·åˆ—è¡¨ï¼Œè¿™äº›ç”¨æˆ·å°†è¢«æ·»åŠ åˆ°è¯¥ç»„ä¸­ã€‚ä¸å‰ä¸€ä¸ªä¾‹å­ä¸åŒçš„æ˜¯ï¼Œè¿™äº›ç”¨æˆ·ä¼šè¢«è¿½åŠ åˆ°è¯¥ç»„ä¸­ï¼Œè€Œä¸ä¼šæ›¿æ¢æ‰ç»„ä¸­å·²æœ‰çš„ç”¨æˆ·ã€‚Ù-Using man:id[1] to Determine Group MembershipÙ)ä½¿ç”¨ man:id[1] æ¥ç¡®å®šç»„æˆå‘˜èº«ä»½ÙEIn this example, `jru` is a member of the groups `jru` and `teamtwo`.ÙBåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ`jru` æ˜¯ `jru` å’Œ `teamtwo` ç»„çš„æˆå‘˜ã€‚ÙlFor more information about this command and the format of `/etc/group`, refer to man:pw[8] and man:group[5].Ùiæœ‰å…³æ­¤å‘½ä»¤å’Œ `/etc/group` æ–‡ä»¶çš„æ ¼å¼çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜… man:pw[8] å’Œ man:group[5] ã€‚«Permissions¦æƒé™ÚsIn FreeBSD, every file and directory has an associated set of permissions and several utilities are available for viewing and modifying these permissions.  Understanding how permissions work is necessary to make sure that users are able to access the files that they need and are unable to improperly access the files used by the operating system or owned by other users.Ú5åœ¨ FreeBSD ä¸­ï¼Œæ¯ä¸ªæ–‡ä»¶å’Œç›®å½•éƒ½æœ‰ä¸€ç»„å…³è”çš„æƒé™ï¼Œå¹¶ä¸”æœ‰å‡ ä¸ªå®ç”¨ç¨‹åºå¯ç”¨äºæŸ¥çœ‹å’Œä¿®æ”¹è¿™äº›æƒé™ã€‚è¦ç¡®ä¿ç”¨æˆ·èƒ½å¤Ÿè®¿é—®æ‰€éœ€çš„æ–‡ä»¶ï¼Œå¹¶ä¸”ä¸èƒ½ä¸æ­£å½“åœ°è®¿é—®æ“ä½œç³»ç»Ÿä½¿ç”¨çš„æ–‡ä»¶æˆ–å…¶ä»–ç”¨æˆ·æ‹¥æœ‰çš„æ–‡ä»¶ï¼Œå°±å¿…é¡»äº†è§£æƒé™çš„å·¥ä½œåŸç†ã€‚Ù³This section discusses the traditional UNIX(R) permissions used in FreeBSD.  For finer-grained file system access control, refer to crossref:security[fs-acl,Access Control Lists].Ù©æœ¬èŠ‚è®¨è®ºäº†åœ¨ FreeBSD ä¸­ä½¿ç”¨çš„ä¼ ç»Ÿ UNIX(R) æƒé™ã€‚è¦è¿›è¡Œæ›´ç²¾ç»†çš„æ–‡ä»¶ç³»ç»Ÿè®¿é—®æ§åˆ¶ï¼Œè¯·å‚è€ƒ crossref:security[fs-acl,è®¿é—®æ§åˆ¶åˆ—è¡¨] ã€‚Ú+In UNIX(R), basic permissions are assigned using three types of access: read, write, and execute.  These access types are used to determine file access to the file's owner, group, and others (everyone else).  The read, write, and execute permissions can be represented as the letters `r`, `w`, and `x`.  They can also be represented as binary numbers as each permission is either on or off (`0`).  When represented as a number, the order is always read as `rwx`, where `r` has an on value of `4`, `w` has an on value of `2` and `x` has an on value of `1`.Úåœ¨ UNIX(R) ä¸­ï¼ŒåŸºæœ¬æƒé™ä½¿ç”¨ä¸‰ç§ç±»å‹çš„è®¿é—®è¿›è¡Œåˆ†é…ï¼šè¯»å–ã€å†™å…¥å’Œæ‰§è¡Œã€‚è¿™äº›è®¿é—®ç±»å‹ç”¨äºç¡®å®šæ–‡ä»¶çš„æ‰€æœ‰è€…ã€ç»„å’Œå…¶ä»–äººï¼ˆå…¶ä»–æ‰€æœ‰äººï¼‰å¯¹æ–‡ä»¶çš„è®¿é—®ã€‚è¯»å–ã€å†™å…¥å’Œæ‰§è¡Œæƒé™å¯ä»¥ç”¨å­—æ¯ `r`ã€`w` å’Œ `x` è¡¨ç¤ºã€‚å®ƒä»¬ä¹Ÿå¯ä»¥è¡¨ç¤ºä¸ºäºŒè¿›åˆ¶æ•°å­—ï¼Œå› ä¸ºæ¯ä¸ªæƒé™éƒ½æ˜¯æ‰“å¼€æˆ–å…³é—­çš„ï¼ˆ`0`ï¼‰ã€‚å½“è¡¨ç¤ºä¸ºæ•°å­—æ—¶ï¼Œé¡ºåºæ€»æ˜¯æŒ‰ç…§ `rwx` è¯»å–ï¼Œå…¶ä¸­ `r` çš„æ‰“å¼€å€¼ä¸º `4` ï¼Œ `w` çš„æ‰“å¼€å€¼ä¸º `2` ï¼Œ `x` çš„æ‰“å¼€å€¼ä¸º `1` ã€‚Ù±Table 4.1 summarizes the possible numeric and alphabetic possibilities.  When reading the "Directory Listing" column, a `-` is used to represent a permission that is set to off.Ùvè¡¨ 4.1 æ€»ç»“äº†å¯èƒ½çš„æ•°å­—å’Œå­—æ¯ç»„åˆã€‚åœ¨é˜…è¯»â€œç›®å½•åˆ—è¡¨â€åˆ—æ—¶ï¼Œä½¿ç”¨ `-` è¡¨ç¤ºæƒé™å…³é—­ã€‚ÚƒFocusing on the line for `myfile`, the first `(leftmost)` character indicates whether this file is a regular file, a directory, a special character device, a socket, or any other special pseudo-file device.  In this example, the `-` indicates a regular file.  The next three characters, `rw-` in this example, give the permissions for the owner of the file.  The next three characters, `r--`, give the permissions for the group that the file belongs to.  The final three characters, `r--`, give the permissions for the rest of the world.  A dash means that the permission is turned off.  In this example, the permissions are set so the owner can read and write to the file, the group can read the file, and the rest of the world can only read the file.  According to the table above, the permissions for this file would be `644`, where each digit represents the three parts of the file's permission.Ú³å…³æ³¨ `myfile` è¿™ä¸€è¡Œï¼Œç¬¬ä¸€ä¸ªï¼ˆæœ€å·¦è¾¹çš„ï¼‰å­—ç¬¦è¡¨ç¤ºè¯¥æ–‡ä»¶æ˜¯æ™®é€šæ–‡ä»¶ã€ç›®å½•ã€ç‰¹æ®Šå­—ç¬¦è®¾å¤‡ã€å¥—æ¥å­—è¿˜æ˜¯å…¶ä»–ç‰¹æ®Šä¼ªæ–‡ä»¶è®¾å¤‡ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ `-` è¡¨ç¤ºæ™®é€šæ–‡ä»¶ã€‚æ¥ä¸‹æ¥çš„ä¸‰ä¸ªå­—ç¬¦ `rw-` è¡¨ç¤ºæ–‡ä»¶æ‰€æœ‰è€…çš„æƒé™ã€‚å†æ¥ä¸‹æ¥çš„ä¸‰ä¸ªå­—ç¬¦ `r--` è¡¨ç¤ºæ–‡ä»¶æ‰€å±ç»„çš„æƒé™ã€‚æœ€åä¸‰ä¸ªå­—ç¬¦ `r--` è¡¨ç¤ºå…¶ä»–ç”¨æˆ·çš„æƒé™ã€‚ç ´æŠ˜å·è¡¨ç¤ºæƒé™è¢«å…³é—­ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæƒé™è¢«è®¾ç½®ä¸ºæ–‡ä»¶æ‰€æœ‰è€…å¯ä»¥è¯»å†™æ–‡ä»¶ï¼Œæ–‡ä»¶æ‰€å±ç»„å¯ä»¥è¯»å–æ–‡ä»¶ï¼Œå…¶ä»–ç”¨æˆ·åªèƒ½è¯»å–æ–‡ä»¶ã€‚æ ¹æ®ä¸Šé¢çš„è¡¨æ ¼ï¼Œè¯¥æ–‡ä»¶çš„æƒé™å°†æ˜¯ `644` ï¼Œå…¶ä¸­æ¯ä¸ªæ•°å­—ä»£è¡¨æ–‡ä»¶æƒé™çš„ä¸‰ä¸ªéƒ¨åˆ†ã€‚ÙÆHow does the system control permissions on devices? FreeBSD treats most hardware devices as a file that programs can open, read, and write data to.  These special device files are stored in `/dev/`.Ù·ç³»ç»Ÿå¦‚ä½•æ§åˆ¶è®¾å¤‡çš„æƒé™ï¼Ÿ FreeBSD å°†å¤§å¤šæ•°ç¡¬ä»¶è®¾å¤‡è§†ä¸ºç¨‹åºå¯ä»¥æ‰“å¼€ã€è¯»å–å’Œå†™å…¥æ•°æ®çš„æ–‡ä»¶ã€‚è¿™äº›ç‰¹æ®Šè®¾å¤‡æ–‡ä»¶å­˜å‚¨åœ¨ `/dev/` ç›®å½•ä¸­ã€‚Ú£Directories are also treated as files.  They have read, write, and execute permissions.  The executable bit for a directory has a slightly different meaning than that of files.  When a directory is marked executable, it means it is possible to change into that directory using man:cd[1].  This also means that it is possible to access the files within that directory, subject to the permissions on the files themselves.Ú=ç›®å½•ä¹Ÿè¢«è§†ä¸ºæ–‡ä»¶ã€‚å®ƒä»¬å…·æœ‰è¯»å–ã€å†™å…¥å’Œæ‰§è¡Œæƒé™ã€‚ç›®å½•çš„å¯æ‰§è¡Œä½ä¸æ–‡ä»¶çš„å¯æ‰§è¡Œä½ç•¥æœ‰ä¸åŒã€‚å½“ä¸€ä¸ªç›®å½•è¢«æ ‡è®°ä¸ºå¯æ‰§è¡Œæ—¶ï¼Œæ„å‘³ç€å¯ä»¥ä½¿ç”¨ man:cd[1] å‘½ä»¤è¿›å…¥è¯¥ç›®å½•ã€‚è¿™ä¹Ÿæ„å‘³ç€å¯ä»¥è®¿é—®è¯¥ç›®å½•ä¸­çš„æ–‡ä»¶ï¼Œä½†å—æ–‡ä»¶æœ¬èº«æƒé™çš„é™åˆ¶ã€‚ÙïIn order to perform a directory listing, the read permission must be set on the directory.  In order to delete a file that one knows the name of, it is necessary to have write _and_ execute permissions to the directory containing the file.Ù®ä¸ºäº†æ‰§è¡Œç›®å½•åˆ—è¡¨ï¼Œå¿…é¡»åœ¨ç›®å½•ä¸Šè®¾ç½®è¯»å–æƒé™ã€‚ä¸ºäº†åˆ é™¤ä¸€ä¸ªå·²çŸ¥æ–‡ä»¶åçš„æ–‡ä»¶ï¼Œå¿…é¡»å¯¹åŒ…å«è¯¥æ–‡ä»¶çš„ç›®å½•å…·æœ‰å†™å…¥å’Œæ‰§è¡Œæƒé™ã€‚ÙÚThere are more permission bits, but they are primarily used in special circumstances such as setuid binaries and sticky directories.  For more information on file permissions and how to set them, refer to man:chmod[1].ÙÁè¿˜æœ‰æ›´å¤šçš„æƒé™ä½ï¼Œä½†å®ƒä»¬ä¸»è¦ç”¨äºç‰¹æ®Šæƒ…å†µï¼Œæ¯”å¦‚ setuid äºŒè¿›åˆ¶æ–‡ä»¶å’Œç²˜æ»ç›®å½•ã€‚æœ‰å…³æ–‡ä»¶æƒé™åŠå¦‚ä½•è®¾ç½®å®ƒä»¬çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è€ƒ man:chmod[1] ã€‚ÙÙThese values are used with man:chmod[1], but with letters instead of numbers.  For example, the following command would block both members of the group associated with _FILE_ and all other users from accessing _FILE_:Ù¶è¿™äº›å€¼ä¸ man:chmod[1] ä¸€èµ·ä½¿ç”¨ï¼Œä½†ä½¿ç”¨å­—æ¯è€Œä¸æ˜¯æ•°å­—ã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹å‘½ä»¤å°†é˜»æ­¢ä¸ _FILE_ å…³è”çš„ç»„çš„æ‰€æœ‰æˆå‘˜ä»¥åŠæ‰€æœ‰å…¶ä»–ç”¨æˆ·è®¿é—® _FILE_ã€‚ÙíA comma separated list can be provided when more than one set of changes to a file must be made.  For example, the following command removes the group and "world" write permission on _FILE_, and adds the execute permissions for everyone:Ù¿å½“éœ€è¦å¯¹æ–‡ä»¶è¿›è¡Œå¤šç»„æ›´æ”¹æ—¶ï¼Œå¯ä»¥æä¾›é€—å·åˆ†éš”çš„åˆ—è¡¨ã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹å‘½ä»¤ä¼šç§»é™¤æ–‡ä»¶ _FILE_ çš„ç»„å’Œ "world" çš„å†™æƒé™ï¼Œå¹¶ä¸ºæ‰€æœ‰äººæ·»åŠ æ‰§è¡Œæƒé™ï¼š²FreeBSD File Flags´FreeBSD æ–‡ä»¶æ ‡å¿—ÙøIn addition to file permissions, FreeBSD supports the use of "file flags".  These flags add an additional level of security and control over files, but not directories.  With file flags, even `root` can be prevented from removing or altering files.Ùëé™¤äº†æ–‡ä»¶æƒé™ä¹‹å¤–ï¼ŒFreeBSD è¿˜æ”¯æŒä½¿ç”¨â€œæ–‡ä»¶æ ‡å¿—â€ã€‚è¿™äº›æ ‡å¿—ä¸ºæ–‡ä»¶æä¾›äº†é¢å¤–çš„å®‰å…¨æ€§å’Œæ§åˆ¶ï¼Œä½†ä¸é€‚ç”¨äºç›®å½•ã€‚é€šè¿‡æ–‡ä»¶æ ‡å¿—ï¼Œå³ä½¿æ˜¯ `root` ä¹Ÿå¯ä»¥è¢«é˜»æ­¢åˆ é™¤æˆ–æ›´æ”¹æ–‡ä»¶ã€‚Ù“File flags are modified using man:chflags[1].  For example, to enable the system undeletable flag on the file `file1`, issue the following command:Ùä½¿ç”¨ man:chflags[1] å‘½ä»¤å¯ä»¥ä¿®æ”¹æ–‡ä»¶æ ‡å¿—ã€‚ä¾‹å¦‚ï¼Œè¦åœ¨æ–‡ä»¶ `file1` ä¸Šå¯ç”¨ç³»ç»Ÿä¸å¯åˆ é™¤æ ‡å¿—ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼šÙMTo disable the system undeletable flag, put a "no" in front of the `sunlink`:ÙJè¦ç¦ç”¨ç³»ç»Ÿä¸å¯åˆ é™¤æ ‡å¿—ï¼Œè¯·åœ¨ `sunlink` å‰é¢åŠ ä¸Š "no" ï¼šÙ6To view the flags of a file, use `-lo` with man:ls[1]:ÙKè¦æŸ¥çœ‹æ–‡ä»¶çš„æ ‡å¿—ï¼Œå¯ä»¥ä½¿ç”¨ `-lo` ä¸ man:ls[1] ä¸€èµ·ä½¿ç”¨ï¼šÙ½Several file flags may only be added or removed by the `root` user.  In other cases, the file owner may set its file flags.  Refer to man:chflags[1] and man:chflags[2] for more information.ÙÃåªæœ‰ `root` ç”¨æˆ·æ‰èƒ½æ·»åŠ æˆ–åˆ é™¤ä¸€äº›æ–‡ä»¶æ ‡å¿—ã€‚åœ¨å…¶ä»–æƒ…å†µä¸‹ï¼Œæ–‡ä»¶æ‰€æœ‰è€…å¯ä»¥è®¾ç½®å…¶æ–‡ä»¶æ ‡å¿—ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜… man:chflags[1] å’Œ man:chflags[2]ã€‚Ù*The setuid, setgid, and sticky PermissionsÙ"setuid ã€setgid å’Œ sticky æƒé™Ù¼Other than the permissions already discussed, there are three other specific settings that all administrators should know about.  They are the `setuid`, `setgid`, and `sticky` permissions.Ù é™¤äº†å·²ç»è®¨è®ºè¿‡çš„æƒé™ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸‰ä¸ªå…¶ä»–ç‰¹å®šçš„è®¾ç½®ï¼Œæ‰€æœ‰ç®¡ç†å‘˜éƒ½åº”è¯¥äº†è§£ã€‚å®ƒä»¬æ˜¯ `setuid`ã€`setgid` å’Œ `sticky` æƒé™ã€‚ÙŞThese settings are important for some UNIX(R) operations as they provide functionality not normally granted to normal users.  To understand them, the difference between the real user ID and effective user ID must be noted.ÙÅè¿™äº›è®¾ç½®å¯¹äºæŸäº› UNIX(R) æ“ä½œéå¸¸é‡è¦ï¼Œå› ä¸ºå®ƒä»¬æä¾›äº†é€šå¸¸ä¸æˆäºˆæ™®é€šç”¨æˆ·çš„åŠŸèƒ½ã€‚è¦ç†è§£å®ƒä»¬ï¼Œå¿…é¡»æ³¨æ„å®é™…ç”¨æˆ· ID å’Œæœ‰æ•ˆç”¨æˆ· ID ä¹‹é—´çš„åŒºåˆ«ã€‚Ú•The real user ID is the UID who owns or starts the process.  The effective UID is the user ID the process runs as.  As an example, man:passwd[1] runs with the real user ID when a user changes their password.  However, in order to update the password database, the command runs as the effective ID of the `root` user.  This allows users to change their passwords without seeing a `Permission Denied` error.ÚXçœŸå®ç”¨æˆ· ID æ˜¯æ‹¥æœ‰æˆ–å¯åŠ¨è¿›ç¨‹çš„ UID ã€‚æœ‰æ•ˆ UID æ˜¯è¿›ç¨‹è¿è¡Œçš„ç”¨æˆ· ID ã€‚ä¾‹å¦‚ï¼Œå½“ç”¨æˆ·æ›´æ”¹å¯†ç æ—¶ï¼Œ man:passwd[1] ä»¥çœŸå®ç”¨æˆ· ID è¿è¡Œã€‚ç„¶è€Œï¼Œä¸ºäº†æ›´æ–°å¯†ç æ•°æ®åº“ï¼Œè¯¥å‘½ä»¤ä»¥ `root` ç”¨æˆ·çš„æœ‰æ•ˆ ID è¿è¡Œã€‚è¿™ä½¿å¾—ç”¨æˆ·å¯ä»¥åœ¨ä¸çœ‹åˆ° `æƒé™è¢«æ‹’ç»` é”™è¯¯çš„æƒ…å†µä¸‹æ›´æ”¹å¯†ç ã€‚ÙvThe setuid permission may be added symbolically by adding the `s` permission for the user as in the following example:Ù^å¯ä»¥é€šè¿‡ä¸ºç”¨æˆ·æ·»åŠ  `s` æƒé™æ¥ä»¥ç¬¦å·æ–¹å¼æ·»åŠ  setuid æƒé™ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼šÙThe setuid permission may also be set by prefixing a permission set with the number four (4) as shown in the following example:Ùfåœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œä¹Ÿå¯ä»¥é€šè¿‡åœ¨æƒé™é›†å‰åŠ ä¸Šæ•°å­—å››ï¼ˆ4ï¼‰æ¥è®¾ç½® setuid æƒé™ï¼šÙ@The permissions on `suidexample.sh` now look like the following:Ù/`suidexample.sh` çš„æƒé™ç°åœ¨å¦‚ä¸‹æ‰€ç¤ºï¼šÙ½Note that a `s` is now part of the permission set designated for the file owner, replacing the executable bit.  This allows utilities which need elevated permissions, such as man:passwd[1].Ù©è¯·æ³¨æ„ï¼Œç°åœ¨æ–‡ä»¶æ‰€æœ‰è€…çš„æƒé™é›†ä¸­åŒ…å«äº†ä¸€ä¸ª `s`ï¼Œå–ä»£äº†å¯æ‰§è¡Œä½ã€‚è¿™å…è®¸ä½¿ç”¨éœ€è¦æå‡æƒé™çš„å®ç”¨ç¨‹åºï¼Œä¾‹å¦‚ man:passwd[1] ã€‚ÙÁThe `nosuid` man:mount[8] option will cause such binaries to silently fail without alerting the user.  That option is not completely reliable as a `nosuid` wrapper may be able to circumvent it.Ùå`nosuid` é€‰é¡¹æ˜¯ `mount[8]` å‘½ä»¤ä¸­çš„ä¸€ä¸ªé€‰é¡¹ï¼Œå®ƒä¼šå¯¼è‡´è¿™äº›äºŒè¿›åˆ¶æ–‡ä»¶åœ¨ä¸é€šçŸ¥ç”¨æˆ·çš„æƒ…å†µä¸‹é™é»˜å¤±è´¥ã€‚ç„¶è€Œï¼Œè¿™ä¸ªé€‰é¡¹å¹¶ä¸å®Œå…¨å¯é ï¼Œå› ä¸ºä¸€ä¸ª `nosuid` åŒ…è£…å™¨å¯èƒ½ä¼šç»•è¿‡å®ƒã€‚ÙÇTo view this in real time, open two terminals.  On one, type `passwd` as a normal user.  While it waits for a new password, check the process table and look at the user information for man:passwd[1]:ÙÇè¦å®æ—¶æŸ¥çœ‹æ­¤å†…å®¹ï¼Œè¯·æ‰“å¼€ä¸¤ä¸ªç»ˆç«¯ã€‚åœ¨å…¶ä¸­ä¸€ä¸ªç»ˆç«¯ä¸Šï¼Œä»¥æ™®é€šç”¨æˆ·èº«ä»½è¾“å…¥ `passwd` ã€‚åœ¨ç­‰å¾…æ–°å¯†ç æ—¶ï¼Œæ£€æŸ¥è¿›ç¨‹è¡¨å¹¶æŸ¥çœ‹ man:passwd[1] çš„ç”¨æˆ·ä¿¡æ¯ã€‚®In terminal A:²åœ¨ç»ˆç«¯ A ä¸­ï¼š®In terminal B:²åœ¨ç»ˆç«¯ B ä¸­ï¼šÙXAlthough man:passwd[1] is run as a normal user, it is using the effective UID of `root`.Ù^å°½ç®¡ man:passwd[1] ä»¥æ™®é€šç”¨æˆ·èº«ä»½è¿è¡Œï¼Œä½†å®ƒä½¿ç”¨çš„æ˜¯ `root` çš„æœ‰æ•ˆ UID ã€‚Ú$The `setgid` permission performs the same function as the `setuid` permission; except that it alters the group settings.  When an application or utility executes with this setting, it will be granted the permissions based on the group that owns the file, not the user who started the process.Ùè`setgid` æƒé™ä¸ `setuid` æƒé™æ‰§è¡Œç›¸åŒçš„åŠŸèƒ½ï¼Œåªæ˜¯å®ƒæ”¹å˜çš„æ˜¯ç»„çš„è®¾ç½®ã€‚å½“ä¸€ä¸ªåº”ç”¨ç¨‹åºæˆ–å®ç”¨å·¥å…·ä»¥æ­¤è®¾ç½®è¿è¡Œæ—¶ï¼Œå®ƒå°†æ ¹æ®æ‹¥æœ‰æ–‡ä»¶çš„ç»„è€Œä¸æ˜¯å¯åŠ¨è¿›ç¨‹çš„ç”¨æˆ·è¢«æˆäºˆæƒé™ã€‚ÙnTo set the `setgid` permission on a file symbolically, add the `s` permission for the group with man:chmod[1]:Ùnè¦åœ¨æ–‡ä»¶ä¸Šä»¥ç¬¦å·æ–¹å¼è®¾ç½® `setgid` æƒé™ï¼Œè¯·ä½¿ç”¨ man:chmod[1] å‘½ä»¤ä¸ºç»„æ·»åŠ  `s` æƒé™ã€‚Ù;Alternatively, provide man:chmod[1] with a leading two (2):ÙAæˆ–è€…ï¼Œç»™ man:chmod[1] å‘½ä»¤æä¾›ä¸€ä¸ªå‰ç¼€çš„æ•°å­— 2 ï¼šÙoIn the following listing, notice that the `s` is now in the field designated for the group permission settings:ÙVåœ¨ä¸‹é¢çš„æ¸…å•ä¸­ï¼Œè¯·æ³¨æ„ `s` ç°åœ¨ä½äºç”¨äºç»„æƒé™è®¾ç½®çš„å­—æ®µä¸­ï¼šÙÜIn these examples, even though the shell script in question is an executable file, it will not run with a different EUID or effective user ID.  This is because shell scripts may not access the man:setuid[2] system calls.ÙÒåœ¨è¿™äº›ç¤ºä¾‹ä¸­ï¼Œå°½ç®¡æ‰€è®¨è®ºçš„ shell è„šæœ¬æ˜¯ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œä½†å®ƒä¸ä¼šä»¥ä¸åŒçš„ EUID æˆ–æœ‰æ•ˆç”¨æˆ· ID è¿è¡Œã€‚è¿™æ˜¯å› ä¸º shell è„šæœ¬å¯èƒ½æ— æ³•è®¿é—® man:setuid[2] ç³»ç»Ÿè°ƒç”¨ã€‚ÙÄThe `setuid` and `setgid` permission bits may lower system security, by allowing for elevated permissions.  The third special permission, the `sticky bit`, can strengthen the security of a system.Ù´`setuid` å’Œ `setgid` æƒé™ä½å¯èƒ½ä¼šé™ä½ç³»ç»Ÿå®‰å…¨æ€§ï¼Œå› ä¸ºå®ƒä»¬å…è®¸æå‡æƒé™ã€‚è€Œç¬¬ä¸‰ä¸ªç‰¹æ®Šæƒé™ä½ï¼Œå³ `sticky bit` ï¼Œå¯ä»¥å¢å¼ºç³»ç»Ÿçš„å®‰å…¨æ€§ã€‚Ú	When the `sticky bit` is set on a directory, it allows file deletion only by the file owner.  This is useful to prevent file deletion in public directories, such as `/tmp`, by users who do not own the file.  To utilize this permission, add the `t` mode to the file:Ùøå½“ç›®å½•ä¸Šè®¾ç½®äº† `ç²˜ç€ä½ï¼ˆsticky bitï¼‰` æ—¶ï¼Œåªå…è®¸æ–‡ä»¶æ‰€æœ‰è€…åˆ é™¤æ–‡ä»¶ã€‚è¿™å¯¹äºé˜²æ­¢éæ–‡ä»¶æ‰€æœ‰è€…åœ¨å…¬å…±ç›®å½•ï¼ˆå¦‚ `/tmp`ï¼‰ä¸­åˆ é™¤æ–‡ä»¶éå¸¸æœ‰ç”¨ã€‚è¦ä½¿ç”¨æ­¤æƒé™ï¼Œè¯·å°† `t` æ¨¡å¼æ·»åŠ åˆ°æ–‡ä»¶ä¸­ï¼šÙ8Alternatively, prefix the permission set with a one (1):Ù0æˆ–è€…ï¼Œå°†æƒé™é›†ä»¥æ•°å­— 1 ä½œä¸ºå‰ç¼€ï¼šÙXThe `sticky bit` permission will display as a `t` at the very end of the permission set:ÙE`sticky bit` æƒé™å°†æ˜¾ç¤ºä¸ºæƒé™é›†çš„æœ€åä¸€ä¸ªå­—ç¬¦ `t` ã€‚³Directory Structure¬ç›®å½•ç»“æ„Ú²The FreeBSD directory hierarchy is fundamental to obtaining an overall understanding of the system.  The most important directory is root or, "/".  This directory is the first one mounted at boot time and it contains the base system necessary to prepare the operating system for multi-user operation.  The root directory also contains mount points for other file systems that are mounted during the transition to multi-user operation.ÚVFreeBSD ç›®å½•å±‚æ¬¡ç»“æ„å¯¹äºå…¨é¢äº†è§£ç³»ç»Ÿè‡³å…³é‡è¦ã€‚æœ€é‡è¦çš„ç›®å½•æ˜¯æ ¹ç›®å½•æˆ–è€…â€œ/â€ã€‚è¿™ä¸ªç›®å½•æ˜¯åœ¨å¯åŠ¨æ—¶é¦–å…ˆæŒ‚è½½çš„ï¼Œå®ƒåŒ…å«äº†å‡†å¤‡æ“ä½œç³»ç»Ÿè¿›è¡Œå¤šç”¨æˆ·æ“ä½œæ‰€éœ€çš„åŸºæœ¬ç³»ç»Ÿã€‚æ ¹ç›®å½•è¿˜åŒ…å«å…¶ä»–æ–‡ä»¶ç³»ç»Ÿçš„æŒ‚è½½ç‚¹ï¼Œåœ¨åˆ‡æ¢åˆ°å¤šç”¨æˆ·æ“ä½œæ—¶ä¼šæŒ‚è½½è¿™äº›æ–‡ä»¶ç³»ç»Ÿã€‚ÚeA mount point is a directory where additional file systems can be grafted onto a parent file system (usually the root file system).  This is further described in <<disk-organization>>.  Standard mount points include `/usr/`, `/var/`, `/tmp/`, `/mnt/`, and `/cdrom/`.  These directories are usually referenced to entries in `/etc/fstab`.  This file is a table of various file systems and mount points and is read by the system.  Most of the file systems in `/etc/fstab` are mounted automatically at boot time from the script man:rc[8] unless their entry includes `noauto`.  Details can be found in <<disks-fstab>>.Ú=æŒ‚è½½ç‚¹æ˜¯ä¸€ä¸ªç›®å½•ï¼Œå¯ä»¥å°†é¢å¤–çš„æ–‡ä»¶ç³»ç»ŸåµŒå…¥åˆ°çˆ¶æ–‡ä»¶ç³»ç»Ÿï¼ˆé€šå¸¸æ˜¯æ ¹æ–‡ä»¶ç³»ç»Ÿï¼‰ä¸Šã€‚è¿™åœ¨ <<disk-organization>> ä¸­æœ‰è¿›ä¸€æ­¥æè¿°ã€‚æ ‡å‡†çš„æŒ‚è½½ç‚¹åŒ…æ‹¬ `/usr/`ã€`/var/`ã€`/tmp/`ã€`/mnt/` å’Œ `/cdrom/` ã€‚è¿™äº›ç›®å½•é€šå¸¸åœ¨ `/etc/fstab` ä¸­å¼•ç”¨ã€‚è¿™ä¸ªæ–‡ä»¶æ˜¯ä¸€ä¸ªåŒ…å«å„ç§æ–‡ä»¶ç³»ç»Ÿå’ŒæŒ‚è½½ç‚¹çš„è¡¨æ ¼ï¼Œå¹¶ç”±ç³»ç»Ÿè¯»å–ã€‚é™¤éå®ƒä»¬çš„æ¡ç›®åŒ…å« `noauto`ï¼Œå¦åˆ™ `/etc/fstab` ä¸­çš„å¤§å¤šæ•°æ–‡ä»¶ç³»ç»Ÿä¼šåœ¨å¯åŠ¨æ—¶è‡ªåŠ¨ä»è„šæœ¬ man:rc[8] æŒ‚è½½ã€‚è¯¦ç»†ä¿¡æ¯å¯ä»¥åœ¨ <<disks-fstab>> ä¸­æ‰¾åˆ°ã€‚Ù6System daemons and system utilities executed by users.Ù<ç³»ç»Ÿå®ˆæŠ¤è¿›ç¨‹å’Œç”±ç”¨æˆ·æ‰§è¡Œçš„ç³»ç»Ÿå®ç”¨ç¨‹åºã€‚¿Miscellaneous system log files.»æ‚é¡¹ç³»ç»Ÿæ—¥å¿—æ–‡ä»¶ã€‚Ú8The smallest unit of organization that FreeBSD uses to find files is the filename.  Filenames are case-sensitive, which means that `readme.txt` and `README.TXT` are two separate files.  FreeBSD does not use the extension of a file to determine whether the file is a program, document, or some other form of data.ÙöFreeBSD ä½¿ç”¨çš„æœ€å°ç»„ç»‡å•ä½æ˜¯æ–‡ä»¶åã€‚æ–‡ä»¶ååŒºåˆ†å¤§å°å†™ï¼Œè¿™æ„å‘³ç€ `readme.txt` å’Œ `README.TXT` æ˜¯ä¸¤ä¸ªä¸åŒçš„æ–‡ä»¶ã€‚ FreeBSD ä¸ä½¿ç”¨æ–‡ä»¶çš„æ‰©å±•åæ¥ç¡®å®šæ–‡ä»¶æ˜¯ç¨‹åºã€æ–‡æ¡£è¿˜æ˜¯å…¶ä»–å½¢å¼çš„æ•°æ®ã€‚ÙğFiles are stored in directories.  A directory may contain no files, or it may contain many hundreds of files.  A directory can also contain other directories, allowing a hierarchy of directories within one another in order to organize data.ÙÕæ–‡ä»¶å­˜å‚¨åœ¨ç›®å½•ä¸­ã€‚ä¸€ä¸ªç›®å½•å¯ä»¥ä¸åŒ…å«ä»»ä½•æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥åŒ…å«æ•°ç™¾ä¸ªæ–‡ä»¶ã€‚ä¸€ä¸ªç›®å½•è¿˜å¯ä»¥åŒ…å«å…¶ä»–ç›®å½•ï¼Œä»è€Œå…è®¸åœ¨å½¼æ­¤ä¹‹é—´å»ºç«‹ç›®å½•å±‚æ¬¡ç»“æ„ä»¥ç»„ç»‡æ•°æ®ã€‚Ú9Files and directories are referenced by giving the file or directory name, followed by a forward slash, `/`, followed by any other directory names that are necessary.  For example, if the directory `foo` contains a directory `bar` which contains the file `readme.txt`, the full name, or _path_, to the file is `foo/bar/readme.txt`.  Note that this is different from Windows(R) which uses `\` to separate file and directory names.  FreeBSD does not use drive letters, or other drive names in the path.  For example, one would not type `c:\foo\bar\readme.txt` on FreeBSD.Ú"æ–‡ä»¶å’Œç›®å½•çš„å¼•ç”¨æ˜¯é€šè¿‡ç»™å‡ºæ–‡ä»¶æˆ–ç›®å½•åç§°ï¼Œåè·Ÿä¸€ä¸ªæ–œæ  `/` ï¼Œå†è·Ÿä¸Šå…¶ä»–å¿…è¦çš„ç›®å½•åç§°æ¥å®Œæˆçš„ã€‚ä¾‹å¦‚ï¼Œå¦‚æœç›®å½• `foo` åŒ…å«ä¸€ä¸ªç›®å½• `bar`ï¼Œè¯¥ç›®å½•åˆåŒ…å«æ–‡ä»¶ `readme.txt` ï¼Œé‚£ä¹ˆæ–‡ä»¶çš„å®Œæ•´åç§°ï¼Œæˆ–è€…è·¯å¾„ï¼Œå°±æ˜¯ `foo/bar/readme.txt`ã€‚è¯·æ³¨æ„ï¼Œè¿™ä¸ Windows(R) ä¸åŒï¼ŒWindows ä½¿ç”¨åæ–œæ  `\` æ¥åˆ†éš”æ–‡ä»¶å’Œç›®å½•åç§°ã€‚ FreeBSD åœ¨è·¯å¾„ä¸­ä¸ä½¿ç”¨é©±åŠ¨å™¨å·æˆ–å…¶ä»–é©±åŠ¨å™¨åç§°ã€‚ä¾‹å¦‚ï¼Œåœ¨ FreeBSD ä¸Šï¼Œä¸ä¼šè¾“å…¥ `c:\foo\bar\readme.txt`ã€‚¬File systems¬æ–‡ä»¶ç³»ç»ŸÚÊDirectories and files are stored in a file system.  Each file system contains exactly one directory at the very top level, called the _root directory_ for that file system.  This root directory can contain other directories.  One file system is designated the _root file system_ or `/`.  Every other file system is _mounted_ under the root file system.  No matter how many disks are on the FreeBSD system, every directory appears to be part of the same disk.Úˆç›®å½•å’Œæ–‡ä»¶å­˜å‚¨åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­ã€‚æ¯ä¸ªæ–‡ä»¶ç³»ç»Ÿåœ¨æœ€é¡¶å±‚éƒ½åŒ…å«ä¸€ä¸ªç›®å½•ï¼Œç§°ä¸ºè¯¥æ–‡ä»¶ç³»ç»Ÿçš„æ ¹ç›®å½•ã€‚è¿™ä¸ªæ ¹ç›®å½•å¯ä»¥åŒ…å«å…¶ä»–ç›®å½•ã€‚ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿè¢«æŒ‡å®šä¸ºæ ¹æ–‡ä»¶ç³»ç»Ÿæˆ– `/` ã€‚å…¶ä»–æ‰€æœ‰æ–‡ä»¶ç³»ç»Ÿéƒ½è¢«æŒ‚è½½åœ¨æ ¹æ–‡ä»¶ç³»ç»Ÿä¸‹ã€‚æ— è®º FreeBSD ç³»ç»Ÿä¸Šæœ‰å¤šå°‘ä¸ªç£ç›˜ï¼Œæ¯ä¸ªç›®å½•éƒ½çœ‹èµ·æ¥æ˜¯åŒä¸€ä¸ªç£ç›˜çš„ä¸€éƒ¨åˆ†ã€‚ÙÂConsider three file systems, called `A`, `B`, and `C`.  Each file system has one root directory, which contains two other directories, called `A1`, `A2` (and likewise `B1`, `B2` and `C1`, `C2`).ÙÑè€ƒè™‘ä¸‰ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œåˆ†åˆ«ç§°ä¸º `A`ã€`B` å’Œ `C`ã€‚æ¯ä¸ªæ–‡ä»¶ç³»ç»Ÿéƒ½æœ‰ä¸€ä¸ªæ ¹ç›®å½•ï¼Œå…¶ä¸­åŒ…å«ä¸¤ä¸ªå…¶ä»–ç›®å½•ï¼Œåˆ†åˆ«ç§°ä¸º `A1`ã€`A2` ï¼ˆåŒæ ·ä¹Ÿæœ‰ `B1`ã€`B2` å’Œ `C1`ã€`C2`ï¼‰ã€‚Ù±Call `A` the root file system.  If man:ls[1] is used to view the contents of this directory, it will show two subdirectories, `A1` and `A2`.  The directory tree looks like this:Ù›å°† `A` ç§°ä¸ºæ ¹æ–‡ä»¶ç³»ç»Ÿã€‚å¦‚æœä½¿ç”¨ man:ls[1] å‘½ä»¤æŸ¥çœ‹è¯¥ç›®å½•çš„å†…å®¹ï¼Œå°†æ˜¾ç¤ºä¸¤ä¸ªå­ç›®å½•ï¼Œ`A1` å’Œ `A2`ã€‚ç›®å½•æ ‘å¦‚ä¸‹æ‰€ç¤ºï¼šÙ=Directory tree with the root directory and two subdirectoriesÙ-å¸¦æœ‰æ ¹ç›®å½•å’Œä¸¤ä¸ªå­ç›®å½•çš„ç›®å½•æ ‘ÙØA file system must be mounted on to a directory in another file system.  When mounting file system `B` on to the directory `A1`, the root directory of `B` replaces `A1`, and the directories in `B` appear accordingly:ÙĞä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿå¿…é¡»è¢«æŒ‚è½½åˆ°å¦ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿçš„ç›®å½•ä¸Šã€‚å½“å°†æ–‡ä»¶ç³»ç»Ÿ `B` æŒ‚è½½åˆ°ç›®å½• `A1` ä¸Šæ—¶ï¼Œ`B` çš„æ ¹ç›®å½•å°†æ›¿æ¢ `A1`ï¼Œå¹¶ä¸” `B` ä¸­çš„ç›®å½•ä¼šç›¸åº”åœ°æ˜¾ç¤ºå‡ºæ¥ï¼šÙâAny files that are in the `B1` or `B2` directories can be reached with the path `/A1/B1` or `/A1/B2` as necessary.  Any files that were in `/A1` have been temporarily hidden.  They will reappear if `B` is _unmounted_ from `A`.ÙÉä»»ä½•ä½äº `B1` æˆ– `B2` ç›®å½•ä¸­çš„æ–‡ä»¶å¯ä»¥é€šè¿‡è·¯å¾„ `/A1/B1` æˆ– `/A1/B2` è®¿é—®ã€‚ä»»ä½•ä½äº `/A1` ä¸­çš„æ–‡ä»¶éƒ½è¢«ä¸´æ—¶éšè—äº†ã€‚å¦‚æœä» `A` å¸è½½ `B`ï¼Œå®ƒä»¬å°†é‡æ–°å‡ºç°ã€‚ÙFIf `B` had been mounted on `A2` then the diagram would look like this:ÙAå¦‚æœ `B` è¢«å®‰è£…åœ¨ `A2` ä¸Šï¼Œé‚£ä¹ˆå›¾è¡¨å°†å¦‚ä¸‹æ‰€ç¤ºï¼šÙ:and the paths would be `/A2/B1` and `/A2/B2` respectively.Ù(è·¯å¾„åˆ†åˆ«ä¸º `/A2/B1` å’Œ `/A2/B2`ã€‚ÙÇFile systems can be mounted on top of one another.  Continuing the last example, the `C` file system could be mounted on top of the `B1` directory in the `B` file system, leading to this arrangement:Ù¥æ–‡ä»¶ç³»ç»Ÿå¯ä»¥ç›¸äº’å åŠ æŒ‚è½½ã€‚ç»§ç»­ä¸Šä¸€ä¸ªä¾‹å­ï¼Œ`C` æ–‡ä»¶ç³»ç»Ÿå¯ä»¥è¢«æŒ‚è½½åœ¨ `B` æ–‡ä»¶ç³»ç»Ÿä¸­çš„ `B1` ç›®å½•ä¸Šæ–¹ï¼Œå½¢æˆä»¥ä¸‹çš„å®‰æ’ï¼šÙJA complex directory tree. With different subdirectories hanging from root.Ù?ä¸€ä¸ªå¤æ‚çš„ç›®å½•æ ‘ã€‚æ ¹ç›®å½•ä¸‹æœ‰ä¸åŒçš„å­ç›®å½•ã€‚ÙUOr `C` could be mounted directly on to the `A` file system, under the `A1` directory:ÙIæˆ–è€… `C` å¯ä»¥ç›´æ¥æŒ‚è½½åˆ° `A` æ–‡ä»¶ç³»ç»Ÿä¸‹çš„ `A1` ç›®å½•ä¸­ï¼šÙIt is entirely possible to have one large root file system, and not need to create any others.  There are some drawbacks to this approach, and one advantage.Ù„å®Œå…¨å¯ä»¥åªæœ‰ä¸€ä¸ªå¤§çš„æ ¹æ–‡ä»¶ç³»ç»Ÿï¼Œè€Œä¸éœ€è¦åˆ›å»ºå…¶ä»–æ–‡ä»¶ç³»ç»Ÿã€‚è¿™ç§æ–¹æ³•æœ‰ä¸€äº›ç¼ºç‚¹å’Œä¸€ä¸ªä¼˜ç‚¹ã€‚Ù!Benefits of Multiple File Systems»å¤šä¸ªæ–‡ä»¶ç³»ç»Ÿçš„å¥½å¤„ÚÀDifferent file systems can have different _mount options_. For example, the root file system can be mounted read-only, making it impossible for users to inadvertently delete or edit a critical file. Separating user-writable file systems, such as `/home`, from other file systems allows them to be mounted _nosuid_. This option prevents the _suid_/_guid_ bits on executables stored on the file system from taking effect, possibly improving security.Ú•ä¸åŒçš„æ–‡ä»¶ç³»ç»Ÿå¯ä»¥æœ‰ä¸åŒçš„æŒ‚è½½é€‰é¡¹ã€‚ä¾‹å¦‚ï¼Œæ ¹æ–‡ä»¶ç³»ç»Ÿå¯ä»¥ä»¥åªè¯»æ–¹å¼æŒ‚è½½ï¼Œè¿™æ ·ç”¨æˆ·å°±æ— æ³•æ„å¤–åˆ é™¤æˆ–ç¼–è¾‘å…³é”®æ–‡ä»¶ã€‚å°†å¯ç”±ç”¨æˆ·å†™å…¥çš„æ–‡ä»¶ç³»ç»Ÿï¼ˆå¦‚ `/home`ï¼‰ä¸å…¶ä»–æ–‡ä»¶ç³»ç»Ÿåˆ†ç¦»ï¼Œå¯ä»¥å°†å®ƒä»¬æŒ‚è½½ä¸º _nosuid_ ã€‚æ­¤é€‰é¡¹å¯ä»¥é˜²æ­¢æ–‡ä»¶ç³»ç»Ÿä¸Šå­˜å‚¨çš„å¯æ‰§è¡Œæ–‡ä»¶çš„_ suid_/_guid_ ä½ç”Ÿæ•ˆï¼Œä»è€Œå¯èƒ½æé«˜å®‰å…¨æ€§ã€‚ÚKFreeBSD automatically optimizes the layout of files on a file system, depending on how the file system is being used. So a file system that contains many small files that are written frequently will have a different optimization to one that contains fewer, larger files. By having one big file system this optimization breaks down.ÚFreeBSD ä¼šæ ¹æ®æ–‡ä»¶ç³»ç»Ÿçš„ä½¿ç”¨æƒ…å†µè‡ªåŠ¨ä¼˜åŒ–æ–‡ä»¶çš„å¸ƒå±€ã€‚å› æ­¤ï¼ŒåŒ…å«è®¸å¤šé¢‘ç¹å†™å…¥çš„å°æ–‡ä»¶çš„æ–‡ä»¶ç³»ç»Ÿå°†ä¸åŒ…å«è¾ƒå°‘ä¸”è¾ƒå¤§çš„æ–‡ä»¶çš„æ–‡ä»¶ç³»ç»Ÿæœ‰æ‰€ä¸åŒçš„ä¼˜åŒ–æ–¹å¼ã€‚å¦‚æœåªæœ‰ä¸€ä¸ªå¤§æ–‡ä»¶ç³»ç»Ÿï¼Œè¿™ç§ä¼˜åŒ–å°†å¤±æ•ˆã€‚Ú+FreeBSD's file systems are robust if power is lost. However, a power loss at a critical point could still damage the structure of the file system. By splitting data over multiple file systems it is more likely that the system will still come up, making it easier to restore from backup as necessary.Ùşå¦‚æœæ–­ç”µï¼ŒFreeBSD çš„æ–‡ä»¶ç³»ç»Ÿæ˜¯å¥å£®çš„ã€‚ç„¶è€Œï¼Œåœ¨å…³é”®æ—¶åˆ»æ–­ç”µä»ç„¶å¯èƒ½æŸåæ–‡ä»¶ç³»ç»Ÿçš„ç»“æ„ã€‚é€šè¿‡å°†æ•°æ®åˆ†æ•£åœ¨å¤šä¸ªæ–‡ä»¶ç³»ç»Ÿä¸Šï¼Œç³»ç»Ÿæ›´æœ‰å¯èƒ½é‡æ–°å¯åŠ¨ï¼Œä»è€Œæ›´å®¹æ˜“æ ¹æ®éœ€è¦è¿›è¡Œå¤‡ä»½æ¢å¤ã€‚¿Benefit of a Single File System»å•ä¸€æ–‡ä»¶ç³»ç»Ÿçš„å¥½å¤„Ú<File systems are a fixed size. If you create a file system when you install FreeBSD and give it a specific size, you may later discover that you need to make the partition bigger. This is not easily accomplished without backing up, recreating the file system with the new size, and then restoring the backed up data.Ú)æ–‡ä»¶ç³»ç»Ÿæ˜¯å›ºå®šå¤§å°çš„ã€‚å¦‚æœåœ¨å®‰è£… FreeBSD æ—¶åˆ›å»ºäº†ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿå¹¶æŒ‡å®šäº†ç‰¹å®šçš„å¤§å°ï¼Œæ‚¨å¯èƒ½ä¼šå‘ç°ä»¥åéœ€è¦æ‰©å¤§åˆ†åŒºçš„å¤§å°ã€‚è¿™ä¸å®¹æ˜“å®ç°ï¼Œéœ€è¦å…ˆå¤‡ä»½æ•°æ®ï¼Œç„¶åä½¿ç”¨æ–°çš„å¤§å°é‡æ–°åˆ›å»ºæ–‡ä»¶ç³»ç»Ÿï¼Œæœ€åæ¢å¤å¤‡ä»½çš„æ•°æ®ã€‚Ú³FreeBSD features the man:growfs[8] command, which makes it possible to increase the size of file system on the fly, removing this limitation.  A file system can only be expanded into free space in the partition in which it resides.  If there is space after the partition, the partition can be expanded with man:gpart[8].  If the partition is the last one on a virtual disk, and the disk is expanded, the partition can then be expanded.ÚiFreeBSD å…·æœ‰ man:growfs[8] å‘½ä»¤ï¼Œå¯ä»¥åœ¨è¿è¡Œæ—¶å¢åŠ æ–‡ä»¶ç³»ç»Ÿçš„å¤§å°ï¼Œä»è€Œæ¶ˆé™¤äº†è¿™ä¸€é™åˆ¶ã€‚æ–‡ä»¶ç³»ç»Ÿåªèƒ½æ‰©å±•åˆ°æ‰€åœ¨åˆ†åŒºçš„å¯ç”¨ç©ºé—´ä¸­ã€‚å¦‚æœåˆ†åŒºåé¢æœ‰ç©ºé—´ï¼Œå¯ä»¥ä½¿ç”¨ man:gpart[8] æ¥æ‰©å±•åˆ†åŒºã€‚å¦‚æœåˆ†åŒºæ˜¯è™šæ‹Ÿç£ç›˜ä¸Šçš„æœ€åä¸€ä¸ªåˆ†åŒºï¼Œå¹¶ä¸”ç£ç›˜è¢«æ‰©å±•äº†ï¼Œé‚£ä¹ˆå¯ä»¥æ‰©å±•è¯¥åˆ†åŒºã€‚¯Disk partitions¬ç£ç›˜åˆ†åŒºÚFile systems are contained in _partitions_.  Disks are divided into partitions using one of several partitioning schemes; see <<bsdinstall-part-manual>>.  The newer scheme is GPT; older BIOS-based computers use MBR.  GPT supports division of a disk into partitions with a size, offset, and type.  It supports a large number of partitions and partition types, and is recommended whenever its use is possible.  GPT partitions use the disk name with a suffix, where the suffix is `p1` for the first partition, `p2` for the second, and so on.  MBR, however, supports only a small number of partitions.  The MBR partitions are known in FreeBSD as `slices`.  Slices may be used for different operating systems.  FreeBSD slices are subdivided into partitions using BSD labels (see man:bsdlabel[8]).Ú­æ–‡ä»¶ç³»ç»ŸåŒ…å«åœ¨ _åˆ†åŒº_ ä¸­ã€‚ä½¿ç”¨å¤šç§åˆ†åŒºæ–¹æ¡ˆå°†ç£ç›˜åˆ’åˆ†ä¸ºåˆ†åŒºï¼›å‚è§ <<bsdinstall-part-manual>>ã€‚è¾ƒæ–°çš„æ–¹æ¡ˆæ˜¯ GPT ï¼›æ—§çš„åŸºäº BIOS çš„è®¡ç®—æœºä½¿ç”¨ MBRã€‚GPT æ”¯æŒå°†ç£ç›˜åˆ’åˆ†ä¸ºå…·æœ‰å¤§å°ã€åç§»å’Œç±»å‹çš„åˆ†åŒºã€‚å®ƒæ”¯æŒå¤§é‡çš„åˆ†åŒºå’Œåˆ†åŒºç±»å‹ï¼Œå¹¶ä¸”åœ¨å¯èƒ½çš„æƒ…å†µä¸‹æ¨èä½¿ç”¨ã€‚GPT åˆ†åŒºä½¿ç”¨ç£ç›˜åç§°åŠ åç¼€ï¼Œåç¼€ä¸º `p1` è¡¨ç¤ºç¬¬ä¸€ä¸ªåˆ†åŒºï¼Œ`p2` è¡¨ç¤ºç¬¬äºŒä¸ªåˆ†åŒºï¼Œä¾æ­¤ç±»æ¨ã€‚ç„¶è€Œï¼ŒMBR ä»…æ”¯æŒå°‘é‡çš„åˆ†åŒºã€‚åœ¨ FreeBSD ä¸­ï¼ŒMBR åˆ†åŒºè¢«ç§°ä¸º `slices`ã€‚ Slices å¯ä»¥ç”¨äºä¸åŒçš„æ“ä½œç³»ç»Ÿã€‚ FreeBSD slices ä½¿ç”¨ BSD æ ‡ç­¾è¿›è¡Œåˆ†åŒºç»†åˆ†ï¼ˆå‚è§ man:bsdlabel[8]ï¼‰ã€‚ÚÇSlice numbers follow the device name, prefixed with an `s`, starting at 1.  So "da0__s1__" is the first slice on the first SCSI drive.  There can only be four physical slices on a disk, but there can be logical slices inside physical slices of the appropriate type.  These extended slices are numbered starting at 5, so "ada0__s5__" is the first extended slice on the first SATA disk.  These devices are used by file systems that expect to occupy a slice.Ú¯Slice å·ç éµå¾ªè®¾å¤‡åç§°ï¼Œä»¥ `s` ä¸ºå‰ç¼€ï¼Œä» 1 å¼€å§‹ã€‚å› æ­¤ï¼Œâ€œda0__s1__â€æ˜¯ç¬¬ä¸€ä¸ª SCSI é©±åŠ¨å™¨ä¸Šçš„ç¬¬ä¸€ä¸ª sliceã€‚ä¸€ä¸ªç£ç›˜ä¸Šåªèƒ½æœ‰å››ä¸ªç‰©ç† sliceï¼Œä½†æ˜¯åœ¨é€‚å½“ç±»å‹çš„ç‰©ç†åˆ‡ç‰‡å†…å¯ä»¥æœ‰é€»è¾‘ sliceã€‚è¿™äº›æ‰©å±• slice ä» 5 å¼€å§‹ç¼–å·ï¼Œå› æ­¤â€œada0__s5__â€æ˜¯ç¬¬ä¸€ä¸ª SATA ç£ç›˜ä¸Šçš„ç¬¬ä¸€ä¸ªæ‰©å±• sliceã€‚è¿™äº›è®¾å¤‡ç”±å¸Œæœ›å ç”¨ä¸€ä¸ª slice çš„æ–‡ä»¶ç³»ç»Ÿä½¿ç”¨ã€‚ÙãEach GPT or BSD partition can contain only one file system, which means that file systems are often described by either their typical mount point in the file system hierarchy, or the name of the partition they are contained in.ÙÁæ¯ä¸ª GPT æˆ– BSD åˆ†åŒºåªèƒ½åŒ…å«ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œè¿™æ„å‘³ç€æ–‡ä»¶ç³»ç»Ÿé€šå¸¸é€šè¿‡å…¶åœ¨æ–‡ä»¶ç³»ç»Ÿå±‚æ¬¡ç»“æ„ä¸­çš„å…¸å‹æŒ‚è½½ç‚¹æˆ–å®ƒä»¬æ‰€åŒ…å«çš„åˆ†åŒºçš„åç§°æ¥æè¿°ã€‚ÚuFreeBSD also uses disk space for _swap space_ to provide _virtual memory_.  This allows your computer to behave as though it has much more memory than it actually does.  When FreeBSD runs out of memory, it moves some of the data that is not currently being used to the swap space, and moves it back in (moving something else out) when it needs it.  This is called _paging_.ÚJFreeBSD è¿˜ä½¿ç”¨ç£ç›˜ç©ºé—´ä½œä¸º _äº¤æ¢ç©ºé—´_ æ¥æä¾› _è™šæ‹Ÿå†…å­˜_ã€‚è¿™ä½¿å¾—æ‚¨çš„è®¡ç®—æœºå¯ä»¥è¡¨ç°å¾—å¥½åƒå®ƒæ‹¥æœ‰æ¯”å®é™…æ›´å¤šçš„å†…å­˜ã€‚å½“ FreeBSD å†…å­˜ä¸è¶³æ—¶ï¼Œå®ƒå°†ä¸€äº›å½“å‰æœªä½¿ç”¨çš„æ•°æ®ç§»åŠ¨åˆ°äº¤æ¢ç©ºé—´ï¼Œå¹¶åœ¨éœ€è¦æ—¶å°†å…¶ç§»å›ï¼ˆå°†å…¶ä»–æ•°æ®ç§»å‡ºï¼‰ã€‚è¿™è¢«ç§°ä¸º _åˆ†é¡µ_ã€‚ÙBSome BSD partitions have certain conventions associated with them.Ù/ä¸€äº› BSD åˆ†åŒºä¸ç‰¹å®šçš„çº¦å®šç›¸å…³è”ã€‚©Partition¦åˆ†åŒºªConvention¦æƒ¯ä¾‹Ù'Normally contains the root file system.¾é€šå¸¸åŒ…å«æ ¹æ–‡ä»¶ç³»ç»Ÿã€‚½Normally contains swap space.»é€šå¸¸åŒ…å«äº¤æ¢ç©ºé—´ã€‚ÙåNormally the same size as the enclosing slice. This allows utilities that need to work on the entire slice, such as a bad block scanner, to work on the `c` partition. A file system would not normally be created on this partition.ÙĞé€šå¸¸ä¸åŒ…å«çš„ slice å¤§å°ç›¸åŒã€‚è¿™æ ·å¯ä»¥ä½¿éœ€è¦åœ¨æ•´ä¸ª slice ä¸Šå·¥ä½œçš„å®ç”¨ç¨‹åºï¼ˆä¾‹å¦‚åå—æ‰«æå™¨ï¼‰èƒ½å¤Ÿåœ¨ `c` åˆ†åŒºä¸Šå·¥ä½œã€‚é€šå¸¸ä¸ä¼šåœ¨æ­¤åˆ†åŒºä¸Šåˆ›å»ºæ–‡ä»¶ç³»ç»Ÿã€‚Ù„Partition `d` used to have a special meaning associated with it, although that is now gone and `d` may work as any normal partition.Ùuåˆ†åŒº `d` æ›¾ç»æœ‰ä¸€ä¸ªç‰¹æ®Šçš„å«ä¹‰ï¼Œä½†ç°åœ¨å·²ç»æ¶ˆå¤±äº†ï¼Œ`d` å¯ä»¥åƒä»»ä½•æ™®é€šåˆ†åŒºä¸€æ ·å·¥ä½œã€‚Ú_Slices and "dangerously dedicated" physical drives contain BSD partitions, which are represented as letters from `a` to `h`.  This letter is appended to the device name, so "da0__a__" is the `a` partition on the first `da` drive, which is "dangerously dedicated".  "ada1s3__e__" is the fifth partition in the third slice of the second SATA disk drive.Ú\Slices å’Œâ€œå±é™©ä¸“ç”¨â€ç‰©ç†é©±åŠ¨å™¨åŒ…å« BSD åˆ†åŒºï¼Œè¿™äº›åˆ†åŒºç”¨å­—æ¯ `a` åˆ° `h` è¡¨ç¤ºã€‚è¿™ä¸ªå­—æ¯è¢«é™„åŠ åˆ°è®¾å¤‡åç§°ä¸Šï¼Œæ‰€ä»¥â€œ da0__a__â€æ˜¯ç¬¬ä¸€ä¸ª `da` é©±åŠ¨å™¨ä¸Šçš„ `a` åˆ†åŒºï¼Œè¯¥é©±åŠ¨å™¨æ˜¯â€œå±é™©ä¸“ç”¨â€çš„ã€‚â€œada1s3__e__â€æ˜¯ç¬¬äºŒä¸ª SATA ç£ç›˜é©±åŠ¨å™¨çš„ç¬¬ä¸‰ä¸ª slice ä¸­çš„ç¬¬äº”ä¸ªåˆ†åŒºã€‚Ú	Finally, each disk on the system is identified.  A disk name starts with a code that indicates the type of disk, and then a number, indicating which disk it is.  Unlike partitions and slices, disk numbering starts at 0.  Common codes are listed in <<disks-naming>>.Úæœ€åï¼Œç³»ç»Ÿä¸Šçš„æ¯ä¸ªç£ç›˜éƒ½æœ‰ä¸€ä¸ªæ ‡è¯†ã€‚ç£ç›˜åç§°ä»¥è¡¨ç¤ºç£ç›˜ç±»å‹çš„ä»£ç å¼€å¤´ï¼Œç„¶åæ˜¯ä¸€ä¸ªæ•°å­—ï¼Œè¡¨ç¤ºå®ƒæ˜¯ç¬¬å‡ ä¸ªç£ç›˜ã€‚ä¸åˆ†åŒºå’Œåˆ‡ç‰‡ä¸åŒï¼Œç£ç›˜ç¼–å·ä» 0 å¼€å§‹ã€‚å¸¸è§çš„ä»£ç åˆ—åœ¨ <<disks-naming>> ä¸­ã€‚ÙôWhen referring to a partition in a slice, include the disk name, `s`, the slice number, and then the partition letter.  Examples are shown in <<basics-disk-slice-part>>.  GPT partitions include the disk name, `p`, and then the partition number.ÙÎåœ¨å¼•ç”¨ slice ä¸­çš„åˆ†åŒºæ—¶ï¼Œè¯·åŒ…æ‹¬ç£ç›˜åç§°ã€`s` ã€åˆ‡ç‰‡ç¼–å·ï¼Œç„¶åæ˜¯åˆ†åŒºå­—æ¯ã€‚ç¤ºä¾‹è§ <<basics-disk-slice-part>> ã€‚ GPT åˆ†åŒºåŒ…æ‹¬ç£ç›˜åç§°ã€`p`ï¼Œç„¶åæ˜¯åˆ†åŒºç¼–å·ã€‚ÙY<<basics-concept-disk-model>> shows a conceptual model of a disk layout using MBR slices.ÙY<<basics-concept-disk-model>> å±•ç¤ºäº†ä½¿ç”¨ MBR åˆ†åŒºçš„ç£ç›˜å¸ƒå±€çš„æ¦‚å¿µæ¨¡å‹ã€‚ÚqWhen installing FreeBSD, configure the disk slices if using MBR, and create partitions within the slice to be used for FreeBSD.  If using GPT, configure partitions for each file system.  In either case, create a file system or swap space in each partition, and decide where each file system will be mounted.  See man:gpart[8] for information on manipulating partitions.Úkåœ¨å®‰è£… FreeBSD æ—¶ï¼Œå¦‚æœä½¿ç”¨ MBRï¼Œè¯·é…ç½®ç£ç›˜ sliceï¼Œå¹¶åœ¨ slice å†…åˆ›å»ºç”¨äº FreeBSD çš„åˆ†åŒºã€‚å¦‚æœä½¿ç”¨ GPT ï¼Œè¯·ä¸ºæ¯ä¸ªæ–‡ä»¶ç³»ç»Ÿé…ç½®åˆ†åŒºã€‚æ— è®ºå“ªç§æƒ…å†µï¼Œéƒ½è¦åœ¨æ¯ä¸ªåˆ†åŒºä¸­åˆ›å»ºæ–‡ä»¶ç³»ç»Ÿæˆ–äº¤æ¢ç©ºé—´ï¼Œå¹¶å†³å®šæ¯ä¸ªæ–‡ä»¶ç³»ç»Ÿå°†è¢«æŒ‚è½½åˆ°å“ªé‡Œã€‚æœ‰å…³æ“ä½œåˆ†åŒºçš„ä¿¡æ¯ï¼Œè¯·å‚é˜… man:gpart[8] ã€‚ÙòThe four partitions each hold a file system.  Partition `a` is used for the root file system, `d` for `/var/`, `e` for `/tmp/`, and `f` for `/usr/`.  Partition letter `c` refers to the entire slice, and so is not used for ordinary partitions.ÙÖå››ä¸ªåˆ†åŒºåˆ†åˆ«æŒæœ‰ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿã€‚åˆ†åŒº `a` ç”¨äºæ ¹æ–‡ä»¶ç³»ç»Ÿï¼Œ`d` ç”¨äº `/var/`ï¼Œ`e` ç”¨äº `/tmp/`ï¼Œ`f` ç”¨äº `/usr/`ã€‚åˆ†åŒºå­—æ¯ `c` æŒ‡çš„æ˜¯æ•´ä¸ª sliceï¼Œå› æ­¤ä¸ç”¨äºæ™®é€šåˆ†åŒºã€‚Ù4Layout of a shared drive between Windows and FreeBSDÙ2Windows å’Œ FreeBSD ä¹‹é—´å…±äº«é©±åŠ¨å™¨çš„å¸ƒå±€Ù$Mounting and Unmounting File Systems»æŒ‚è½½å’Œå¸è½½æ–‡ä»¶ç³»ç»ŸÙÛThe file system is best visualized as a tree, rooted, as it were, at `/`. `/dev`, `/usr`, and the other directories in the root directory are branches, which may have their own branches, such as `/usr/local`, and so on.Ùºæ–‡ä»¶ç³»ç»Ÿæœ€å¥½è¢«è§†ä¸ºä¸€æ£µæ ‘ï¼Œä»¥ `/` ä½œä¸ºæ ¹èŠ‚ç‚¹ã€‚æ ¹ç›®å½•ä¸­çš„ `/dev`ã€`/usr` å’Œå…¶ä»–ç›®å½•æ˜¯åˆ†æ”¯ï¼Œå®ƒä»¬å¯èƒ½æœ‰è‡ªå·±çš„åˆ†æ”¯ï¼Œæ¯”å¦‚ `/usr/local` ç­‰ç­‰ã€‚Ú5There are various reasons to house some of these directories on separate file systems.  `/var` contains the directories `log/`, `spool/`, and various types of temporary files, and as such, may get filled up.  Filling up the root file system is not a good idea, so splitting `/var` from `/` is often favorable.Ùüå°†ä¸€äº›ç›®å½•æ”¾åœ¨å•ç‹¬çš„æ–‡ä»¶ç³»ç»Ÿä¸Šæœ‰å„ç§åŸå› ã€‚`/var` åŒ…å«äº† `log/`ã€`spool/` ä»¥åŠå„ç§ç±»å‹çš„ä¸´æ—¶æ–‡ä»¶ï¼Œå› æ­¤å¯èƒ½ä¼šè¢«å¡«æ»¡ã€‚å¡«æ»¡æ ¹æ–‡ä»¶ç³»ç»Ÿæ˜¯ä¸æ˜æ™ºçš„ï¼Œæ‰€ä»¥å°† `/var` ä¸ `/` åˆ†ç¦»é€šå¸¸æ˜¯å¯å–çš„ã€‚Ú.Another common reason to contain certain directory trees on other file systems is if they are to be housed on separate physical disks, or are separate virtual disks, such as Network File System mounts, described in crossref:network-servers[network-nfs,â€œNetwork File System (NFS)â€], or CDROM drives.Ú1å°†æŸäº›ç›®å½•æ ‘åŒ…å«åœ¨å…¶ä»–æ–‡ä»¶ç³»ç»Ÿä¸­çš„å¦ä¸€ä¸ªå¸¸è§åŸå› æ˜¯å®ƒä»¬å°†è¢«æ”¾ç½®åœ¨å•ç‹¬çš„ç‰©ç†ç£ç›˜ä¸Šï¼Œæˆ–è€…æ˜¯å•ç‹¬çš„è™šæ‹Ÿç£ç›˜ï¼Œä¾‹å¦‚ç½‘ç»œæ–‡ä»¶ç³»ç»ŸæŒ‚è½½ï¼Œå¦‚  crossref:network-servers[network-nfs,â€œç½‘ç»œæ–‡ä»¶ç³»ç»Ÿï¼ˆ NFS ï¼‰â€] æè¿°çš„ï¼Œæˆ–è€… CDROM é©±åŠ¨å™¨ã€‚²Using man:mount[8]³ä½¿ç”¨ man:mount[8]ÙRFile systems are mounted using man:mount[8].  The most basic syntax is as follows:ÙJæ–‡ä»¶ç³»ç»Ÿä½¿ç”¨ man:mount[8] è¿›è¡ŒæŒ‚è½½ã€‚æœ€åŸºæœ¬çš„è¯­æ³•å¦‚ä¸‹ï¼šÙZA file system listed in `/etc/fstab` can also be mounted by providing just the mountpoint.ÙSåœ¨ `/etc/fstab` ä¸­åˆ—å‡ºçš„æ–‡ä»¶ç³»ç»Ÿä¹Ÿå¯ä»¥é€šè¿‡æä¾›æŒ‚è½½ç‚¹æ¥æŒ‚è½½ã€‚ÙpThis command provides many options which are described in man:mount[8].  The most commonly used options include:Ùhè¯¥å‘½ä»¤æä¾›äº†è®¸å¤šé€‰é¡¹ï¼Œè¿™äº›é€‰é¡¹åœ¨ man:mount[8] ä¸­æœ‰æè¿°ã€‚æœ€å¸¸ç”¨çš„é€‰é¡¹åŒ…æ‹¬ï¼š­Mount Options¬æŒ‚è½½é€‰é¡¹Ù‘Mount all the file systems listed in `/etc/fstab`, except those marked as "noauto", excluded by the `-t` flag, or those that are already mounted.Ù¤æŒ‚è½½ `/etc/fstab` ä¸­åˆ—å‡ºçš„æ‰€æœ‰æ–‡ä»¶ç³»ç»Ÿï¼Œé™¤äº†é‚£äº›æ ‡è®°ä¸ºâ€œnoautoâ€ã€è¢« `-t` æ ‡å¿—æ’é™¤çš„æ–‡ä»¶ç³»ç»Ÿï¼Œä»¥åŠå·²ç»æŒ‚è½½çš„æ–‡ä»¶ç³»ç»Ÿã€‚¤`-d`¡`Ù¨Do everything except for the actual mount system call.  This option is useful in conjunction with the `-v` flag to determine what man:mount[8] is actually trying to do.Ùªæ‰§è¡Œé™¤å®é™…æŒ‚è½½ç³»ç»Ÿè°ƒç”¨ä¹‹å¤–çš„æ‰€æœ‰æ“ä½œã€‚è¿™ä¸ªé€‰é¡¹ä¸ `-v` æ ‡å¿—ä¸€èµ·ä½¿ç”¨éå¸¸æœ‰ç”¨ï¼Œå¯ä»¥ç¡®å®š man:mount[8] å®é™…ä¸Šæ­£åœ¨å°è¯•åšä»€ä¹ˆã€‚Ù¤Force the mount of an unclean file system (dangerous), or the revocation of write access when downgrading a file system's mount status from read-write to read-only.Ù™å¼ºåˆ¶æŒ‚è½½ä¸€ä¸ªä¸å¹²å‡€çš„æ–‡ä»¶ç³»ç»Ÿï¼ˆå±é™©æ“ä½œï¼‰ï¼Œæˆ–è€…åœ¨å°†æ–‡ä»¶ç³»ç»Ÿçš„æŒ‚è½½çŠ¶æ€ä»è¯»å†™æ”¹ä¸ºåªè¯»æ—¶ï¼Œæ’¤é”€å†™è®¿é—®æƒé™ã€‚ÙMount the specified file system type or mount only file systems of the given type, if `-a` is included.  "ufs" is the default file system type.Ù“å¦‚æœåŒ…å« `-a` é€‰é¡¹ï¼Œåˆ™æŒ‚è½½æŒ‡å®šçš„æ–‡ä»¶ç³»ç»Ÿç±»å‹æˆ–ä»…æŒ‚è½½ç»™å®šç±»å‹çš„æ–‡ä»¶ç³»ç»Ÿã€‚â€œufsâ€æ˜¯é»˜è®¤çš„æ–‡ä»¶ç³»ç»Ÿç±»å‹ã€‚Ù(Update mount options on the file system.Ù$æ›´æ–°æ–‡ä»¶ç³»ç»Ÿçš„æŒ‚è½½é€‰é¡¹ã€‚«Be verbose.µæä¾›è¯¦ç»†ä¿¡æ¯ã€‚Ù!Mount the file system read-write.Ù'å°†æ–‡ä»¶ç³»ç»ŸæŒ‚è½½ä¸ºè¯»å†™æ¨¡å¼ã€‚ÙFThe following options can be passed to `-o` as a comma-separated list:ÙAå¯ä»¥å°†ä»¥ä¸‹é€‰é¡¹ä½œä¸ºé€—å·åˆ†éš”çš„åˆ—è¡¨ä¼ é€’ç»™ `-o`ï¼šÙcDo not interpret setuid or setgid flags on the file system.  This is also a useful security option.Ùeä¸è¦è¯»å–æ–‡ä»¶ç³»ç»Ÿä¸Šçš„ `setuid` æˆ– `setgid` æ ‡å¿—ã€‚è¿™ä¹Ÿæ˜¯ä¸€ä¸ªæœ‰ç”¨çš„å®‰å…¨é€‰é¡¹ã€‚³Using man:umount[8]´ä½¿ç”¨ man:umount[8]ÙƒTo unmount a file system use man:umount[8].  This command takes one parameter which can be a mountpoint, device name, `-a` or `-A`.Ù‹è¦å¸è½½æ–‡ä»¶ç³»ç»Ÿï¼Œè¯·ä½¿ç”¨ man:umount[8] å‘½ä»¤ã€‚è¯¥å‘½ä»¤æ¥å—ä¸€ä¸ªå‚æ•°ï¼Œå¯ä»¥æ˜¯æŒ‚è½½ç‚¹ã€è®¾å¤‡åç§°ã€`-a` æˆ– `-A`ã€‚Ù´All forms take `-f` to force unmounting, and `-v` for verbosity.  Be warned that `-f` is not generally a good idea as it might crash the computer or damage data on the file system.Ùàæ‰€æœ‰çš„è¡¨å•éƒ½å¯ä»¥ä½¿ç”¨ `-f` æ¥å¼ºåˆ¶å¸è½½ï¼Œå¹¶ä¸”ä½¿ç”¨ `-v` æ¥æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯ã€‚è¯·æ³¨æ„ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ä¸å»ºè®®ä½¿ç”¨ `-f`ï¼Œå› ä¸ºå®ƒå¯èƒ½ä¼šå¯¼è‡´è®¡ç®—æœºå´©æºƒæˆ–è€…æŸåæ–‡ä»¶ç³»ç»Ÿä¸Šçš„æ•°æ®ã€‚Ù©To unmount all mounted file systems, or just the file system types listed after `-t`, use `-a` or `-A`.  Note that `-A` does not attempt to unmount the root file system.ÙÂè¦å¸è½½æ‰€æœ‰å·²æŒ‚è½½çš„æ–‡ä»¶ç³»ç»Ÿï¼Œæˆ–è€…åªå¸è½½åœ¨ `-t` åé¢åˆ—å‡ºçš„æ–‡ä»¶ç³»ç»Ÿç±»å‹ï¼Œè¯·ä½¿ç”¨ `-a` æˆ– `-A` é€‰é¡¹ã€‚è¯·æ³¨æ„ï¼Œ`-A` é€‰é¡¹ä¸ä¼šå°è¯•å¸è½½æ ¹æ–‡ä»¶ç³»ç»Ÿã€‚µProcesses and Daemonsµè¿›ç¨‹å’Œå®ˆæŠ¤è¿›ç¨‹ÙŒGuide about how to install FreeBSD, the minimum hardware requirements and supported architectures, how to create the installation media, etcÙxå…³äºå¦‚ä½•å®‰è£… FreeBSD çš„æŒ‡å—ï¼ŒåŒ…æ‹¬æœ€ä½ç¡¬ä»¶è¦æ±‚å’Œæ”¯æŒçš„æ¶æ„ï¼Œä»¥åŠå¦‚ä½•åˆ›å»ºå®‰è£…ä»‹è´¨ç­‰ã€‚½Chapter 2. Installing FreeBSD¸ç¬¬ 2 ç«  å®‰è£… FreeBSD²Installing FreeBSD®å®‰è£… FreeBSDÙõFreeBSD supports different architectures including amd64, ARM(R), RISC-V(R), and PowerPC(R).  Depending on the architecture and platform, different images can be link:https://www.freebsd.org/where/[downloaded] to install or directly run FreeBSD.ÙÜFreeBSD æ”¯æŒå¤šç§æ¶æ„ï¼ŒåŒ…æ‹¬ amd64 ã€ ARM(R) ã€ RISC-V(R) å’Œ PowerPC(R) ã€‚æ ¹æ®ä¸åŒçš„æ¶æ„å’Œå¹³å°ï¼Œå¯ä»¥ link:https://www.freebsd.org/where/[ä¸‹è½½] ä¸åŒçš„é•œåƒæ¥å®‰è£…æˆ–ç›´æ¥è¿è¡Œ FreeBSD ã€‚´The image types are:²é•œåƒç±»å‹æœ‰ï¼šÚVirtual Machine disk images, such as `qcow2`, `vmdk`, `vhd`, and raw device images. These are not installation images, but images that have FreeBSD preinstalled and ready for post-installation tasks. Virtual machine images are also commonly used in cloud environments.Ùéè™šæ‹Ÿæœºç£ç›˜é•œåƒï¼Œä¾‹å¦‚ `qcow2`ã€`vmdk`ã€`vhd` å’ŒåŸå§‹è®¾å¤‡é•œåƒã€‚è¿™äº›ä¸æ˜¯å®‰è£…é•œåƒï¼Œè€Œæ˜¯å·²ç»é¢„è£…äº† FreeBSD å¹¶å‡†å¤‡å¥½è¿›è¡Œåå®‰è£…ä»»åŠ¡çš„é•œåƒã€‚è™šæ‹Ÿæœºé•œåƒåœ¨äº‘ç¯å¢ƒä¸­ä¹Ÿè¢«å¹¿æ³›ä½¿ç”¨ã€‚Ù¥SD card images, for embedded systems such as Raspberry Pi. These files must be uncompressed and written as a raw image to an SD card, from which the board will boot.Ù•SD å¡é•œåƒï¼Œç”¨äºæ ‘è“æ´¾ç­‰åµŒå…¥å¼ç³»ç»Ÿã€‚è¿™äº›æ–‡ä»¶å¿…é¡»è§£å‹ç¼©å¹¶ä»¥åŸå§‹é•œåƒçš„å½¢å¼å†™å…¥ SD å¡ï¼Œä¸»æ¿å°†ä» SD å¡å¯åŠ¨ã€‚Ù„Installation images to boot from an ISO or USB device to install FreeBSD on a drive for the usual desktop, laptop, or server system.Ùå®‰è£…é•œåƒç”¨äºä» ISO æˆ– USB è®¾å¤‡å¼•å¯¼ï¼Œä»¥åœ¨å¸¸è§çš„å°å¼æœºã€ç¬”è®°æœ¬ç”µè„‘æˆ–æœåŠ¡å™¨ç³»ç»Ÿä¸Šå®‰è£… FreeBSD åˆ°é©±åŠ¨å™¨ã€‚Ú3The rest of this chapter describes the third case, explaining how to install FreeBSD using the text-based installation program named bsdinstall.  There may be minor differences between the installer and what is shown here, so use this chapter as a general guide rather than as a set of literal instructions.Úæœ¬ç« çš„å…¶ä½™éƒ¨åˆ†æè¿°äº†ç¬¬ä¸‰ç§æƒ…å†µï¼Œè§£é‡Šäº†å¦‚ä½•ä½¿ç”¨åä¸º bsdinstall çš„åŸºäºæ–‡æœ¬çš„å®‰è£…ç¨‹åºå®‰è£… FreeBSD ã€‚å®‰è£…ç¨‹åºä¸æ­¤å¤„æ˜¾ç¤ºçš„å†…å®¹å¯èƒ½å­˜åœ¨ç»†å¾®å·®å¼‚ï¼Œå› æ­¤è¯·å°†æœ¬ç« ä½œä¸ºä¸€ä»½é€šç”¨æŒ‡å—ï¼Œè€Œä¸æ˜¯ä¸€ç»„å­—é¢æŒ‡ä»¤ã€‚ÙCHow to obtain FreeBSD images and create FreeBSD installation media.Ù<å¦‚ä½•è·å– FreeBSD é•œåƒå¹¶åˆ›å»º FreeBSD å®‰è£…ä»‹è´¨ã€‚¸How to start bsdinstall.»å¦‚ä½•å¯åŠ¨ bsdinstall ã€‚ÙJThe questions bsdinstall will ask, what they mean, and how to answer them.ÙGbsdinstall å°†ä¼šè¯¢é—®çš„é—®é¢˜ï¼Œå®ƒä»¬çš„å«ä¹‰ä»¥åŠå¦‚ä½•å›ç­”ã€‚Ù*How to troubleshoot a failed installation.Ù$å¦‚ä½•æ’é™¤å®‰è£…å¤±è´¥çš„é—®é¢˜ã€‚ÙMHow to access a live version of FreeBSD before committing to an installation.Ù?åœ¨è¿›è¡Œå®‰è£…ä¹‹å‰ï¼Œå¦‚ä½•è®¿é—® FreeBSD çš„æ´»åŠ¨ç‰ˆæœ¬ã€‚½Minimum Hardware Requirements²æœ€ä½ç¡¬ä»¶è¦æ±‚Ú‚The hardware requirements to install FreeBSD vary by architecture and version.  Hardware architectures and devices supported by a FreeBSD release are listed on the link:https://www.FreeBSD.org/releases/[FreeBSD Release Information] page.  The link:https://www.FreeBSD.org/where/[FreeBSD download page] also has recommendations for choosing the correct image for different architectures.Ú2å®‰è£… FreeBSD çš„ç¡¬ä»¶è¦æ±‚å› æ¶æ„å’Œç‰ˆæœ¬è€Œå¼‚ã€‚æ”¯æŒ FreeBSD å‘å¸ƒçš„ç¡¬ä»¶æ¶æ„å’Œè®¾å¤‡å¯ä»¥åœ¨ link:https://www.FreeBSD.org/releases/[FreeBSD å‘å¸ƒä¿¡æ¯] é¡µé¢ä¸Šæ‰¾åˆ°ã€‚link:https://www.FreeBSD.org/where/[FreeBSD ä¸‹è½½é¡µé¢] è¿˜æä¾›äº†é€‰æ‹©ä¸åŒæ¶æ„çš„æ­£ç¡®é•œåƒçš„å»ºè®®ã€‚¶Pre-Installation Tasks²å®‰è£…å‰çš„ä»»åŠ¡Ú,Once it has been determined that the system meets the minimum hardware requirements for installing FreeBSD, the installation file should be downloaded and the installation media prepared.  Before doing this, check that the system is ready for an installation by verifying the items in this checklist:ÙÒä¸€æ—¦ç¡®å®šç³»ç»Ÿæ»¡è¶³å®‰è£… FreeBSD çš„æœ€ä½ç¡¬ä»¶è¦æ±‚ï¼Œå°±åº”è¯¥ä¸‹è½½å®‰è£…æ–‡ä»¶å¹¶å‡†å¤‡å®‰è£…ä»‹è´¨ã€‚åœ¨æ­¤ä¹‹å‰ï¼Œè¯·é€šè¿‡éªŒè¯ä»¥ä¸‹æ¸…å•ä¸­çš„é¡¹ç›®ï¼Œç¡®ä¿ç³»ç»Ÿå·²å‡†å¤‡å¥½è¿›è¡Œå®‰è£…ï¼š¹*Back Up Important Data*
¶*å¤‡ä»½é‡è¦æ•°æ®* 
ÚÄBefore installing any operating system, *always* backup all important data first.  Do not store the backup on the system being installed.  Instead, save the data to a removable disk such as a USB drive, another system on the network, or an online backup service.  Test the backup before starting the installation to make sure it contains all of the needed files.  Once the installer formats the system's disk, all data stored on that disk will be lost.Úªåœ¨å®‰è£…ä»»ä½•æ“ä½œç³»ç»Ÿä¹‹å‰ï¼Œ *ä¸€å®šè¦* é¦–å…ˆå¤‡ä»½æ‰€æœ‰é‡è¦æ•°æ®ã€‚ä¸è¦å°†å¤‡ä»½å­˜å‚¨åœ¨æ­£åœ¨å®‰è£…çš„ç³»ç»Ÿä¸Šã€‚è€Œæ˜¯å°†æ•°æ®ä¿å­˜åˆ°å¯ç§»åŠ¨çš„ç£ç›˜ï¼Œå¦‚ USB é©±åŠ¨å™¨ã€ç½‘ç»œä¸Šçš„å¦ä¸€ä¸ªç³»ç»Ÿæˆ–åœ¨çº¿å¤‡ä»½æœåŠ¡ä¸­ã€‚åœ¨å¼€å§‹å®‰è£…ä¹‹å‰ï¼Œæµ‹è¯•å¤‡ä»½ä»¥ç¡®ä¿å®ƒåŒ…å«æ‰€æœ‰æ‰€éœ€çš„æ–‡ä»¶ã€‚ä¸€æ—¦å®‰è£…ç¨‹åºæ ¼å¼åŒ–äº†ç³»ç»Ÿçš„ç£ç›˜ï¼Œè¯¥ç£ç›˜ä¸Šå­˜å‚¨çš„æ‰€æœ‰æ•°æ®éƒ½å°†ä¸¢å¤±ã€‚Ù"*Decide Where to Install FreeBSD*
Ù!*å†³å®šåœ¨å“ªé‡Œå®‰è£… FreeBSD* 
ÙÍIf FreeBSD will be the only operating system installed, this step can be skipped.  But if FreeBSD will share the disk with another operating system, decide which disk or partition will be used for FreeBSD.ÙÀå¦‚æœåªå®‰è£… FreeBSD ä½œä¸ºå”¯ä¸€çš„æ“ä½œç³»ç»Ÿï¼Œå¯ä»¥è·³è¿‡è¿™ä¸€æ­¥ã€‚ä½†å¦‚æœ FreeBSD å°†ä¸å…¶ä»–æ“ä½œç³»ç»Ÿå…±äº«ç£ç›˜ï¼Œåˆ™éœ€è¦å†³å®šå“ªä¸ªç£ç›˜æˆ–åˆ†åŒºå°†ç”¨äº FreeBSD ã€‚ÚhIn the i386 and amd64 architectures, disks can be divided into multiple partitions using one of two partitioning schemes.  A traditional _Master Boot Record_ (MBR) holds a partition table defining up to four _primary partitions_.  For historical reasons, FreeBSD calls these primary partition _slices_.  One of these primary partitions can be made into an _extended partition_ containing multiple _logical partitions_.  The _GUID Partition Table_ (GPT) is a newer and simpler method of partitioning a disk.  Common GPT implementations allow up to 128 partitions per disk, eliminating the need for logical partitions.Úÿåœ¨ i386 å’Œ amd64 æ¶æ„ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ä¸¤ç§åˆ†åŒºæ–¹æ¡ˆå°†ç£ç›˜åˆ†æˆå¤šä¸ªåˆ†åŒºã€‚ä¼ ç»Ÿçš„ _ä¸»å¼•å¯¼è®°å½•ï¼ˆMBRï¼‰_ ä¿å­˜äº†ä¸€ä¸ªåŒ…å«æœ€å¤šå››ä¸ª _ä¸»åˆ†åŒº_ çš„åˆ†åŒºè¡¨ã€‚å‡ºäºå†å²åŸå› ï¼ŒFreeBSD å°†è¿™äº›ä¸»åˆ†åŒºç§°ä¸º _slices_ã€‚å…¶ä¸­ä¸€ä¸ªä¸»åˆ†åŒºå¯ä»¥æˆä¸ºåŒ…å«å¤šä¸ª _é€»è¾‘åˆ†åŒº_ çš„ _æ‰©å±•åˆ†åŒº_ã€‚ _GUID åˆ†åŒºè¡¨ï¼ˆGPTï¼‰_ æ˜¯ä¸€ç§è¾ƒæ–°ä¸”æ›´ç®€å•çš„ç£ç›˜åˆ†åŒºæ–¹æ³•ã€‚å¸¸è§çš„ GPT å®ç°å…è®¸æ¯ä¸ªç£ç›˜æœ€å¤šæœ‰ 128 ä¸ªåˆ†åŒºï¼Œæ¶ˆé™¤äº†é€»è¾‘åˆ†åŒºçš„éœ€è¦ã€‚ÚFThe FreeBSD boot loader requires either a primary or GPT partition.  If all of the primary or GPT partitions are already in use, one must be freed for FreeBSD.  To create a partition without deleting existing data, use a partition resizing tool to shrink an existing partition and create a new partition using the freed space.ÚYFreeBSD å¼•å¯¼åŠ è½½ç¨‹åºéœ€è¦ä¸€ä¸ªä¸»åˆ†åŒºæˆ– GPT åˆ†åŒºã€‚å¦‚æœæ‰€æœ‰çš„ä¸»åˆ†åŒºæˆ– GPT åˆ†åŒºå·²ç»è¢«ä½¿ç”¨ï¼Œå°±å¿…é¡»é‡Šæ”¾ä¸€ä¸ªåˆ†åŒºç»™ FreeBSD ä½¿ç”¨ã€‚ä¸ºäº†åœ¨ä¸åˆ é™¤ç°æœ‰æ•°æ®çš„æƒ…å†µä¸‹åˆ›å»ºä¸€ä¸ªåˆ†åŒºï¼Œå¯ä»¥ä½¿ç”¨åˆ†åŒºè°ƒæ•´å·¥å…·æ¥ç¼©å°ä¸€ä¸ªç°æœ‰åˆ†åŒºï¼Œå¹¶ä½¿ç”¨é‡Šæ”¾å‡ºçš„ç©ºé—´åˆ›å»ºä¸€ä¸ªæ–°çš„åˆ†åŒºã€‚Ù±The boot options menu is divided into two sections.  The first section can be used to either return to the main boot menu or to reset any toggled options back to their defaults.Ùå¯åŠ¨é€‰é¡¹èœå•åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ã€‚ç¬¬ä¸€éƒ¨åˆ†å¯ä»¥ç”¨äºè¿”å›ä¸»å¯åŠ¨èœå•æˆ–å°†ä»»ä½•åˆ‡æ¢é€‰é¡¹é‡ç½®ä¸ºé»˜è®¤å€¼ã€‚ÚThe next section is used to toggle the available options to `On` or `Off` by pressing the option's highlighted number or character.  The system will always boot using the settings for these options until they are modified.  Several options can be toggled using this menu:Ùùä¸‹ä¸€èŠ‚ç”¨äºé€šè¿‡æŒ‰ä¸‹é€‰é¡¹çš„çªå‡ºæ˜¾ç¤ºçš„æ•°å­—æˆ–å­—ç¬¦æ¥åˆ‡æ¢å¯ç”¨é€‰é¡¹çš„çŠ¶æ€ä¸º `On` æˆ– `Off`ã€‚ç³»ç»Ÿå°†å§‹ç»ˆä½¿ç”¨è¿™äº›é€‰é¡¹çš„è®¾ç½®è¿›è¡Œå¼•å¯¼ï¼Œç›´åˆ°å®ƒä»¬è¢«ä¿®æ”¹ã€‚å¯ä»¥ä½¿ç”¨æ­¤èœå•åˆ‡æ¢å¤šä¸ªé€‰é¡¹çš„çŠ¶æ€ã€‚ÙS`ACPI Support`: If the system hangs during boot, try toggling this option to `Off`.Ù~`ACPI æ”¯æŒï¼ˆACPI Supportï¼‰`: å¦‚æœç³»ç»Ÿåœ¨å¯åŠ¨è¿‡ç¨‹ä¸­å‡ºç°å¡æ­»çš„æƒ…å†µï¼Œè¯·å°è¯•å°†æ­¤é€‰é¡¹åˆ‡æ¢ä¸º `Off`ã€‚Ùz`Safe Mode`: If the system still hangs during boot even with `ACPI Support` set to `Off`, try setting this option to `On`.Ù¥`å®‰å…¨æ¨¡å¼ï¼ˆSafe Modeï¼‰`ï¼šå¦‚æœç³»ç»Ÿåœ¨å¯åŠ¨æ—¶å³ä½¿å°† `ACPI Support` è®¾ç½®ä¸º `Off` ä»ç„¶å‡ºç°å¡é¡¿çš„æƒ…å†µï¼Œè¯·å°è¯•å°†æ­¤é€‰é¡¹è®¾ç½®ä¸º `On`ã€‚ÙÉ`Single User`: Toggle this option to `On` to fix an existing FreeBSD installation as described in crossref:boot[boot-singleuser,â€œSingle-User Modeâ€]. Once the problem is fixed, set it back to `Off`.ÙÙ`å•ç”¨æˆ·æ¨¡å¼ï¼ˆSingle Userï¼‰`ï¼šå°†æ­¤é€‰é¡¹åˆ‡æ¢ä¸º `On`ï¼Œä»¥ä¿®å¤ç°æœ‰çš„ FreeBSD å®‰è£…ï¼Œå¦‚ crossref:boot[boot-singleuser ,â€œå•ç”¨æˆ·æ¨¡å¼â€] ä¸­æ‰€è¿°ã€‚ä¸€æ—¦é—®é¢˜è§£å†³ï¼Œå°†å…¶è®¾ç½®ä¸º `Off`ã€‚Ù™`Verbose`: Toggle this option to `On` to see more detailed messages during the boot process. This can be useful when troubleshooting a piece of hardware.ÙŠ`Verbose`ï¼šå°†æ­¤é€‰é¡¹åˆ‡æ¢ä¸º `On` ä»¥åœ¨å¯åŠ¨è¿‡ç¨‹ä¸­æ˜¾ç¤ºæ›´è¯¦ç»†çš„æ¶ˆæ¯ã€‚åœ¨æ’é™¤ç¡¬ä»¶é—®é¢˜æ—¶ï¼Œè¿™å¯èƒ½ä¼šå¾ˆæœ‰ç”¨ã€‚ÚAfter making the needed selections, press kbd:[1] or kbd:[Backspace] to return to the main boot menu, then press kbd:[Enter] to continue booting into FreeBSD.  A series of boot messages will appear as FreeBSD carries out its hardware device probes and loads the installation program.  Once the boot is complete, the welcome menu shown in <<bsdinstall-choose-mode>> will be displayed.ÚIåœ¨è¿›è¡Œæ‰€éœ€çš„é€‰æ‹©åï¼ŒæŒ‰ä¸‹ kbd:[1] æˆ– kbd:[Backspace] è¿”å›åˆ°ä¸»å¼•å¯¼èœå•ï¼Œç„¶åæŒ‰ä¸‹ kbd:[Enter] ç»§ç»­å¼•å¯¼è¿›å…¥ FreeBSDã€‚FreeBSD å°†æ‰§è¡Œå…¶ç¡¬ä»¶è®¾å¤‡æ¢æµ‹å’ŒåŠ è½½å®‰è£…ç¨‹åºæ—¶ï¼Œä¸€ç³»åˆ—å¼•å¯¼æ¶ˆæ¯å°†å‡ºç°ã€‚å¼•å¯¼å®Œæˆåï¼Œå°†æ˜¾ç¤ºåœ¨ <<bsdinstall-choose-mode>> ä¸­æ˜¾ç¤ºçš„æ¬¢è¿èœå•ã€‚¬Welcome Menu¬æ¬¢è¿èœå•Ù!FreeBSD installation welcome menuºFreeBSD å®‰è£…æ¬¢è¿èœå•ÚıPress kbd:[Enter] to select the default of btn:[Install] to enter the installer.  The rest of this chapter describes how to use this installer.  Otherwise, use the right or left arrows or the colorized letter to select the desired menu item.  The btn:[Shell] can be used to access a FreeBSD shell in order to use command line utilities to prepare the disks before installation.  The btn:[Live CD] option can be used to try out FreeBSD before installing it.  The live version is described in <<using-live-cd>>.ÚÊæŒ‰ä¸‹ kbd:[Enter] é”®é€‰æ‹©é»˜è®¤çš„ btn:[Install] æŒ‰é’®è¿›å…¥å®‰è£…ç¨‹åºã€‚æœ¬ç« çš„å…¶ä½™éƒ¨åˆ†å°†æè¿°å¦‚ä½•ä½¿ç”¨æ­¤å®‰è£…ç¨‹åºã€‚å¦åˆ™ï¼Œä½¿ç”¨å³ç®­å¤´ã€å·¦ç®­å¤´æˆ–å¸¦é¢œè‰²çš„å­—æ¯é€‰æ‹©æ‰€éœ€çš„èœå•é¡¹ã€‚btn:[Shell] å¯ç”¨äºè®¿é—® FreeBSD shellï¼Œä»¥ä¾¿åœ¨å®‰è£…ä¹‹å‰ä½¿ç”¨å‘½ä»¤è¡Œå®ç”¨ç¨‹åºå‡†å¤‡ç£ç›˜ã€‚btn:[Live CD] é€‰é¡¹å¯ç”¨äºåœ¨å®‰è£…ä¹‹å‰å°è¯• FreeBSDã€‚æœ‰å…³ live ç‰ˆæœ¬çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… <<using-live-cd>> ã€‚Ú7To review the boot messages, including the hardware device probe, press the upper- or lower-case kbd:[S] and then kbd:[Enter] to access a shell.  At the shell prompt, type `more /var/run/dmesg.boot` and use the space bar to scroll through the messages.  When finished, type `exit` to return to the welcome menu.Úè¦æŸ¥çœ‹å¯åŠ¨æ¶ˆæ¯ï¼ŒåŒ…æ‹¬ç¡¬ä»¶è®¾å¤‡æ¢æµ‹ï¼Œè¯·æŒ‰ä¸‹å¤§å†™æˆ–å°å†™çš„ kbd:[S]ï¼Œç„¶åæŒ‰ä¸‹ kbd:[Enter] ä»¥è®¿é—® shellã€‚åœ¨ shell æç¤ºç¬¦ä¸‹ï¼Œé”®å…¥ `more /var/run/dmesg.boot`ï¼Œä½¿ç”¨ç©ºæ ¼é”®æ»šåŠ¨æµè§ˆæ¶ˆæ¯ã€‚å®Œæˆåï¼Œé”®å…¥ `exit` è¿”å›æ¬¢è¿èœå•ã€‚°Using bsdinstall±ä½¿ç”¨ bsdinstallÚAThis section shows the order of the bsdinstall menus and the type of information that will be asked before the system is installed.  Use the arrow keys to highlight a menu option, then kbd:[Space] to select or deselect that menu item.  When finished, press kbd:[Enter] to save the selection and move onto the next screen.Úæœ¬èŠ‚å±•ç¤ºäº† bsdinstall èœå•çš„é¡ºåºä»¥åŠåœ¨ç³»ç»Ÿå®‰è£…ä¹‹å‰å°†è¦è¯¢é—®çš„ä¿¡æ¯ç±»å‹ã€‚ä½¿ç”¨ç®­å¤´é”®æ¥çªå‡ºæ˜¾ç¤ºèœå•é€‰é¡¹ï¼Œç„¶åä½¿ç”¨ kbd:[Space] æ¥é€‰æ‹©æˆ–å–æ¶ˆé€‰æ‹©è¯¥èœå•é¡¹ã€‚å®Œæˆåï¼ŒæŒ‰ä¸‹ kbd:[Enter] ä¿å­˜é€‰æ‹©å¹¶è¿›å…¥ä¸‹ä¸€ä¸ªå±å¹•ã€‚¹Selecting the Keymap Menuµé€‰æ‹©é”®æ˜ å°„èœå•ÙmBefore starting the process, bsdinstall will load the keymap files as shown in <<bsdinstall-keymap-loading>>.Ùmåœ¨å¼€å§‹è¿‡ç¨‹ä¹‹å‰ï¼Œ bsdinstall å°†åŠ è½½é”®ç›˜æ˜ å°„æ–‡ä»¶ï¼Œå¦‚ <<bsdinstall-keymap-loading>> æ‰€ç¤ºã€‚®Keymap LoadingµæŒ‰é”®æ˜ å°„åŠ è½½ä¸­®Keymap loadingµé”®ä½æ˜ å°„åŠ è½½ä¸­ÙEMount the file system read-only.  This is identical to using `-o ro`.ÙQå°†æ–‡ä»¶ç³»ç»ŸæŒ‚è½½ä¸ºåªè¯»æ¨¡å¼ã€‚è¿™ä¸ä½¿ç”¨ `-o ro` å‚æ•°å®Œå…¨ç›¸åŒã€‚ÙäFreeBSD is a multi-tasking operating system.  Each program running at any one time is called a _process_.  Every running command starts at least one new process and there are a number of system processes that are run by FreeBSD.ÙÑFreeBSD æ˜¯ä¸€ä¸ªå¤šä»»åŠ¡æ“ä½œç³»ç»Ÿã€‚æ¯ä¸ªåŒæ—¶è¿è¡Œçš„ç¨‹åºè¢«ç§°ä¸ºä¸€ä¸ª _è¿›ç¨‹_ã€‚æ¯ä¸ªæ­£åœ¨è¿è¡Œçš„å‘½ä»¤éƒ½ä¼šå¯åŠ¨è‡³å°‘ä¸€ä¸ªæ–°çš„è¿›ç¨‹ï¼Œå¹¶ä¸” FreeBSD è¿˜ä¼šè¿è¡Œä¸€äº›ç³»ç»Ÿè¿›ç¨‹ã€‚Ú@Each process is uniquely identified by a number called a _process ID_ (PID).  Similar to files, each process has one owner and group, and the owner and group permissions are used to determine which files and devices the process can open.  Most processes also have a parent process that started them.  For example, the shell is a process, and any command started in the shell is a process which has the shell as its parent process.  The exception is a special process called man:init[8] which is always the first process to start at boot time and which always has a PID of `1`.Úæ¯ä¸ªè¿›ç¨‹éƒ½ç”±ä¸€ä¸ªç§°ä¸º _è¿›ç¨‹ ID_ï¼ˆPIDï¼‰çš„æ•°å­—å”¯ä¸€æ ‡è¯†ã€‚ä¸æ–‡ä»¶ç±»ä¼¼ï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ä¸€ä¸ªæ‰€æœ‰è€…å’Œç»„ï¼Œå¹¶ä¸”æ‰€æœ‰è€…å’Œç»„æƒé™ç”¨äºç¡®å®šè¿›ç¨‹å¯ä»¥æ‰“å¼€å“ªäº›æ–‡ä»¶å’Œè®¾å¤‡ã€‚å¤§å¤šæ•°è¿›ç¨‹è¿˜æœ‰ä¸€ä¸ªå¯åŠ¨å®ƒä»¬çš„çˆ¶è¿›ç¨‹ã€‚ä¾‹å¦‚ï¼Œshell æ˜¯ä¸€ä¸ªè¿›ç¨‹ï¼Œshell ä¸­å¯åŠ¨çš„ä»»ä½•å‘½ä»¤éƒ½æ˜¯ä¸€ä¸ªè¿›ç¨‹ï¼Œå…¶çˆ¶è¿›ç¨‹æ˜¯ shell ã€‚ä¾‹å¤–æƒ…å†µæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„è¿›ç¨‹ï¼Œç§°ä¸º man:init[8]ï¼Œå®ƒå§‹ç»ˆæ˜¯åœ¨å¯åŠ¨æ—¶ç¬¬ä¸€ä¸ªå¯åŠ¨çš„è¿›ç¨‹ï¼Œå…¶ PID å§‹ç»ˆä¸º `1`ã€‚Ú$Some programs are not designed to be run with continuous user input and disconnect from the terminal at the first opportunity.  For example, a web server responds to web requests, rather than user input.  Mail servers are another example of this type of application.  These types of programs are known as _daemons_.  The term daemon comes from Greek mythology and represents an entity that is neither good nor evil, and which invisibly performs useful tasks.  This is why the BSD mascot is the cheerful-looking daemon with sneakers and a pitchfork.Úæœ‰äº›ç¨‹åºå¹¶ä¸æ˜¯è®¾è®¡æˆéœ€è¦è¿ç»­çš„ç”¨æˆ·è¾“å…¥ï¼Œä¹Ÿä¸èƒ½åœ¨ç¬¬ä¸€æ—¶é—´ä¸ç»ˆç«¯æ–­å¼€è¿æ¥ã€‚ä¾‹å¦‚ï¼ŒWeb æœåŠ¡å™¨å“åº” Web è¯·æ±‚ï¼Œè€Œä¸æ˜¯ç”¨æˆ·è¾“å…¥ã€‚é‚®ä»¶æœåŠ¡å™¨æ˜¯å¦ä¸€ç§è¿™ç§ç±»å‹çš„åº”ç”¨ç¨‹åºã€‚è¿™äº›ç±»å‹çš„ç¨‹åºè¢«ç§°ä¸º _å®ˆæŠ¤è¿›ç¨‹ï¼ˆdaemonï¼‰_ã€‚æœ¯è¯­ daemon æ¥è‡ªå¸Œè…Šç¥è¯ï¼Œä»£è¡¨ç€ä¸€ä¸ªæ—¢ä¸å–„è‰¯ä¹Ÿä¸é‚ªæ¶çš„å®ä½“ï¼Œå®ƒåœ¨ä¸å¯è§çš„æƒ…å†µä¸‹æ‰§è¡Œæœ‰ç”¨çš„ä»»åŠ¡ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ BSD å‰ç¥¥ç‰©æ˜¯ä¸€ä¸ªçœ‹èµ·æ¥å¼€å¿ƒçš„å¸¦ç€è¿åŠ¨é‹å’Œå‰å­çš„ daemonã€‚ÚThere is a convention to name programs that normally run as daemons with a trailing "d".  For example, BIND is the Berkeley Internet Name Domain, but the actual program that executes is `named`.  The Apache web server program is `httpd` and the line printer spooling daemon is `lpd`.  This is only a naming convention.  For example, the main mail daemon for the Sendmail application is `sendmail`, and not `maild`.Ú”æœ‰ä¸€ä¸ªçº¦å®šï¼Œå³é€šå¸¸ä½œä¸ºå®ˆæŠ¤è¿›ç¨‹è¿è¡Œçš„ç¨‹åºçš„å‘½åæ–¹å¼æ˜¯ä»¥å­—æ¯"d"ç»“å°¾çš„ã€‚ä¾‹å¦‚ï¼ŒBIND æ˜¯ Berkeley Internet Name Domain çš„ç¼©å†™ï¼Œä½†å®é™…æ‰§è¡Œçš„ç¨‹åºæ˜¯ `named`ã€‚Apache Web æœåŠ¡å™¨ç¨‹åºæ˜¯ `httpd` ï¼Œçº¿æ‰“å°æœºæ’é˜Ÿå®ˆæŠ¤è¿›ç¨‹æ˜¯ `lpd`ã€‚è¿™åªæ˜¯ä¸€ç§å‘½åçº¦å®šã€‚ä¾‹å¦‚ï¼ŒSendmail åº”ç”¨ç¨‹åºçš„ä¸»é‚®ä»¶å®ˆæŠ¤è¿›ç¨‹æ˜¯ `sendmail`ï¼Œè€Œä¸æ˜¯ `maild`ã€‚±Viewing Processes¬æŸ¥çœ‹è¿›ç¨‹Ú‚To see the processes running on the system, use man:ps[1] or man:top[1].  To display a static list of the currently running processes, their PIDs, how much memory they are using, and the command they were started with, use man:ps[1].  To display all the running processes and update the display every few seconds in order to interactively see what the computer is doing, use man:top[1].Úwè¦æŸ¥çœ‹ç³»ç»Ÿä¸Šè¿è¡Œçš„è¿›ç¨‹ï¼Œè¯·ä½¿ç”¨ man:ps[1] æˆ– man:top[1]ã€‚è¦æ˜¾ç¤ºå½“å‰æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹çš„é™æ€åˆ—è¡¨ï¼ŒåŒ…æ‹¬å®ƒä»¬çš„è¿›ç¨‹ ID ã€ä½¿ç”¨çš„å†…å­˜é‡ä»¥åŠå¯åŠ¨å®ƒä»¬çš„å‘½ä»¤ï¼Œè¯·ä½¿ç”¨ man:ps[1] ã€‚è¦æ˜¾ç¤ºæ‰€æœ‰æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹ï¼Œå¹¶æ¯éš”å‡ ç§’æ›´æ–°ä¸€æ¬¡æ˜¾ç¤ºï¼Œä»¥ä¾¿äº¤äº’å¼åœ°æŸ¥çœ‹è®¡ç®—æœºæ­£åœ¨åšä»€ä¹ˆï¼Œè¯·ä½¿ç”¨ man:top[1]ã€‚ÙcBy default, man:ps[1] only shows the commands that are running and owned by the user.  For example:ÙXé»˜è®¤æƒ…å†µä¸‹ï¼Œman:ps[1] åªæ˜¾ç¤ºæ­£åœ¨è¿è¡Œä¸”ç”±ç”¨æˆ·æ‹¥æœ‰çš„å‘½ä»¤ã€‚ä¾‹å¦‚ï¼šÚŸThe output from man:ps[1] is organized into a number of columns.  The `PID` column displays the process ID.  PIDs are assigned starting at 1, go up to 99999, then wrap around back to the beginning.  However, a PID is not reassigned if it is already in use.  The `TT` column shows the tty the program is running on and `STAT` shows the program's state.  `TIME` is the amount of time the program has been running on the CPU.  This is usually not the elapsed time since the program was started, as most programs spend a lot of time waiting for things to happen before they need to spend time on the CPU.  Finally, `COMMAND` is the command that was used to start the program.Úman:ps[1] çš„è¾“å‡ºè¢«ç»„ç»‡æˆå¤šåˆ—ã€‚`PID` åˆ—æ˜¾ç¤ºè¿›ç¨‹ IDã€‚PID ä» 1 å¼€å§‹åˆ†é…ï¼Œæœ€å¤§ä¸º 99999 ï¼Œç„¶åé‡æ–°ä»å¤´å¼€å§‹åˆ†é…ã€‚ç„¶è€Œï¼Œå¦‚æœ PID å·²ç»è¢«ä½¿ç”¨ï¼Œå®ƒä¸ä¼šè¢«é‡æ–°åˆ†é…ã€‚`TT` åˆ—æ˜¾ç¤ºç¨‹åºæ‰€åœ¨çš„ ttyï¼Œ`STAT` åˆ—æ˜¾ç¤ºç¨‹åºçš„çŠ¶æ€ã€‚ `TIME` æ˜¯ç¨‹åºåœ¨ CPU ä¸Šè¿è¡Œçš„æ—¶é—´ã€‚è¿™é€šå¸¸ä¸æ˜¯ç¨‹åºå¯åŠ¨åç»è¿‡çš„æ—¶é—´ï¼Œå› ä¸ºå¤§å¤šæ•°ç¨‹åºåœ¨éœ€è¦åœ¨ CPU ä¸ŠèŠ±è´¹æ—¶é—´ä¹‹å‰ä¼šèŠ±è´¹å¾ˆå¤šæ—¶é—´ç­‰å¾…äº‹ä»¶å‘ç”Ÿã€‚æœ€åï¼Œ`COMMAND` æ˜¯ç”¨äºå¯åŠ¨ç¨‹åºçš„å‘½ä»¤ã€‚ÚÔA number of different options are available to change the information that is displayed.  One of the most useful sets is `auxww`, where `a` displays information about all the running processes of all users, `u` displays the username and memory usage of the process' owner, `x` displays information about daemon processes, and `ww` causes man:ps[1] to display the full command line for each process, rather than truncating it once it gets too long to fit on the screen.Úræœ‰å¤šç§ä¸åŒçš„é€‰é¡¹å¯ç”¨äºæ›´æ”¹æ˜¾ç¤ºçš„ä¿¡æ¯ã€‚å…¶ä¸­æœ€æœ‰ç”¨çš„ä¸€ç»„æ˜¯ `auxww`ï¼Œå…¶ä¸­ `a` æ˜¾ç¤ºæœ‰å…³æ‰€æœ‰ç”¨æˆ·çš„æ‰€æœ‰è¿è¡Œè¿›ç¨‹çš„ä¿¡æ¯ï¼Œ`u` æ˜¾ç¤ºè¿›ç¨‹æ‰€æœ‰è€…çš„ç”¨æˆ·åå’Œå†…å­˜ä½¿ç”¨æƒ…å†µï¼Œ`x` æ˜¾ç¤ºæœ‰å…³å®ˆæŠ¤è¿›ç¨‹çš„ä¿¡æ¯ï¼Œ`ww` ä½¿ man:ps[1] æ˜¾ç¤ºæ¯ä¸ªè¿›ç¨‹çš„å®Œæ•´å‘½ä»¤è¡Œï¼Œè€Œä¸æ˜¯åœ¨å±å¹•ä¸Šæ˜¾ç¤ºè¿‡é•¿æ—¶æˆªæ–­å®ƒã€‚Ù&The output from man:top[1] is similar:½man:top[1] çš„è¾“å‡ºç±»ä¼¼ï¼šÚOThe output is split into two sections.  The header (the first five or six lines) shows the PID of the last process to run, the system load averages (which are a measure of how busy the system is), the system uptime (time since the last reboot) and the current time.  The other figures in the header relate to how many processes are running, how much memory and swap space has been used, and how much time the system is spending in different CPU states.  If the ZFS file system module has been loaded, an `ARC` line indicates how much data was read from the memory cache instead of from disk.Úè¾“å‡ºåˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ã€‚æ ‡é¢˜éƒ¨åˆ†ï¼ˆå‰äº”æˆ–å…­è¡Œï¼‰æ˜¾ç¤ºäº†æœ€åä¸€ä¸ªè¿è¡Œçš„è¿›ç¨‹çš„ PID ï¼Œç³»ç»Ÿè´Ÿè½½å¹³å‡å€¼ï¼ˆè¡¡é‡ç³»ç»Ÿç¹å¿™ç¨‹åº¦çš„æŒ‡æ ‡ï¼‰ï¼Œç³»ç»Ÿè¿è¡Œæ—¶é—´ï¼ˆè‡ªä¸Šæ¬¡é‡å¯ä»¥æ¥çš„æ—¶é—´ï¼‰å’Œå½“å‰æ—¶é—´ã€‚æ ‡é¢˜ä¸­çš„å…¶ä»–æ•°å­—ä¸æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹æ•°é‡ã€å·²ä½¿ç”¨çš„å†…å­˜å’Œäº¤æ¢ç©ºé—´ä»¥åŠç³»ç»Ÿåœ¨ä¸åŒ CPU çŠ¶æ€ä¸‹èŠ±è´¹çš„æ—¶é—´æœ‰å…³ã€‚å¦‚æœåŠ è½½äº† ZFS æ–‡ä»¶ç³»ç»Ÿæ¨¡å—ï¼Œ`ARC` è¡Œå°†æ˜¾ç¤ºæœ‰å¤šå°‘æ•°æ®æ˜¯ä»å†…å­˜ç¼“å­˜ä¸­è¯»å–è€Œä¸æ˜¯ä»ç£ç›˜ä¸­è¯»å–çš„ã€‚ÚÙBelow the header is a series of columns containing similar information to the output from man:ps[1], such as the PID, username, amount of CPU time, and the command that started the process.  By default, man:top[1] also displays the amount of memory space taken by the process.  This is split into two columns: one for total size and one for resident size.  Total size is how much memory the application has needed and the resident size is how much it is actually using now.Úhåœ¨æ ‡é¢˜ä¸‹é¢æ˜¯ä¸€ç³»åˆ—åˆ—ï¼Œå…¶ä¸­åŒ…å«ä¸ man:ps[1] è¾“å‡ºç±»ä¼¼çš„ä¿¡æ¯ï¼Œä¾‹å¦‚ PIDã€ç”¨æˆ·åã€CPU æ—¶é—´å’Œå¯åŠ¨è¿›ç¨‹çš„å‘½ä»¤ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œman:top[1] è¿˜ä¼šæ˜¾ç¤ºè¿›ç¨‹å ç”¨çš„å†…å­˜ç©ºé—´ã€‚è¿™è¢«åˆ†ä¸ºä¸¤åˆ—ï¼šæ€»å¤§å°å’Œå¸¸é©»å¤§å°ã€‚æ€»å¤§å°æ˜¯åº”ç”¨ç¨‹åºæ‰€éœ€çš„å†…å­˜é‡ï¼Œå¸¸é©»å¤§å°æ˜¯å®ƒå½“å‰å®é™…ä½¿ç”¨çš„å†…å­˜é‡ã€‚Ùqman:top[1] automatically updates the display every two seconds.  A different interval can be specified with `-s`.ÙSman:top[1] æ¯ä¸¤ç§’è‡ªåŠ¨æ›´æ–°æ˜¾ç¤ºã€‚å¯ä»¥ä½¿ç”¨ `-s` æŒ‡å®šä¸åŒçš„é—´éš”ã€‚±Killing Processes¬æ€æ­»è¿›ç¨‹ÚÅOne way to communicate with any running process or daemon is to send a _signal_ using man:kill[1].  There are a number of different signals; some have a specific meaning while others are described in the application's documentation.  A user can only send a signal to a process they own and sending a signal to someone else's process will result in a permission denied error.  The exception is the `root` user, who can send signals to anyone's processes.Ú­ä¸ä»»ä½•æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹æˆ–å®ˆæŠ¤è¿›ç¨‹è¿›è¡Œé€šä¿¡çš„ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨ man:kill[1] å‘é€ä¸€ä¸ª _ä¿¡å·ï¼ˆsignalï¼‰_ã€‚æœ‰è®¸å¤šä¸åŒçš„ä¿¡å·ï¼›ä¸€äº›å…·æœ‰ç‰¹å®šçš„å«ä¹‰ï¼Œè€Œå…¶ä»–ä¿¡å·åœ¨åº”ç”¨ç¨‹åºçš„æ–‡æ¡£ä¸­æœ‰æè¿°ã€‚ç”¨æˆ·åªèƒ½å‘è‡ªå·±æ‹¥æœ‰çš„è¿›ç¨‹å‘é€ä¿¡å·ï¼Œå‘ä»–äººçš„è¿›ç¨‹å‘é€ä¿¡å·å°†å¯¼è‡´æƒé™è¢«æ‹’ç»çš„é”™è¯¯ã€‚ä¾‹å¤–æƒ…å†µæ˜¯ `root` ç”¨æˆ·ï¼Œä»–å¯ä»¥å‘ä»»ä½•è¿›ç¨‹å‘é€ä¿¡å·ã€‚ÚThe operating system can also send a signal to a process.  If an application is badly written and tries to access memory that it is not supposed to, FreeBSD will send the process the "Segmentation Violation" signal (`SIGSEGV`).  If an application has been written to use the man:alarm[3] system call to be alerted after a period of time has elapsed, it will be sent the "Alarm" signal (`SIGALRM`).Úæ“ä½œç³»ç»Ÿä¹Ÿå¯ä»¥å‘è¿›ç¨‹å‘é€ä¿¡å·ã€‚å¦‚æœä¸€ä¸ªåº”ç”¨ç¨‹åºç¼–å†™å¾—å¾ˆç³Ÿç³•ï¼Œè¯•å›¾è®¿é—®å®ƒä¸åº”è¯¥è®¿é—®çš„å†…å­˜ï¼Œ FreeBSD å°†å‘è¯¥è¿›ç¨‹å‘é€â€œåˆ†æ®µè¿è§„ï¼ˆSegmentation Violationï¼‰â€ä¿¡å·ï¼ˆ`SIGSEGV`ï¼‰ã€‚å¦‚æœä¸€ä¸ªåº”ç”¨ç¨‹åºè¢«ç¼–å†™æˆä½¿ç”¨ man:alarm[3] ç³»ç»Ÿè°ƒç”¨ï¼Œåœ¨ç»è¿‡ä¸€æ®µæ—¶é—´åè¢«æé†’ï¼Œå®ƒå°†æ”¶åˆ°â€œé—¹é’Ÿï¼ˆAlarmï¼‰â€ä¿¡å·ï¼ˆ`SIGALRM`ï¼‰ã€‚ÚhTwo signals can be used to stop a process: `SIGTERM` and `SIGKILL`.  `SIGTERM` is the polite way to kill a process as the process can read the signal, close any log files it may have open, and attempt to finish what it is doing before shutting down.  In some cases, a process may ignore `SIGTERM` if it is in the middle of some task that cannot be interrupted.Úsæœ‰ä¸¤ä¸ªä¿¡å·å¯ä»¥ç”¨æ¥åœæ­¢ä¸€ä¸ªè¿›ç¨‹ï¼š`SIGTERM` å’Œ `SIGKILL`ã€‚`SIGTERM` æ˜¯ä¸€ç§ç¤¼è²Œçš„æ–¹å¼æ¥ç»ˆæ­¢ä¸€ä¸ªè¿›ç¨‹ï¼Œå› ä¸ºè¿›ç¨‹å¯ä»¥è¯»å–è¯¥ä¿¡å·ï¼Œå…³é—­å¯èƒ½æ‰“å¼€çš„ä»»ä½•æ—¥å¿—æ–‡ä»¶ï¼Œå¹¶å°è¯•åœ¨å…³é—­ä¹‹å‰å®Œæˆæ­£åœ¨è¿›è¡Œçš„æ“ä½œã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¦‚æœè¿›ç¨‹æ­£åœ¨æ‰§è¡Œæ— æ³•ä¸­æ–­çš„ä»»åŠ¡ï¼Œå®ƒå¯èƒ½ä¼šå¿½ç•¥ `SIGTERM` ä¿¡å·ã€‚Úï`SIGKILL` cannot be ignored by a process.  Sending a `SIGKILL` to a process will usually stop that process there and then. footnote:[There are a few tasks that cannot be interrupted. For example, if the process is trying to read from a file that is on another computer on the network, and the other computer is unavailable, the process is said to be uninterruptible. Eventually the process will time out, typically after two minutes. As soon as this time out occurs the process will be killed.].Ú`SIGKILL` æ— æ³•è¢«è¿›ç¨‹å¿½ç•¥ã€‚å‘ä¸€ä¸ªè¿›ç¨‹å‘é€ `SIGKILL` é€šå¸¸ä¼šç«‹å³åœæ­¢è¯¥è¿›ç¨‹ã€‚footnote:[æœ‰ä¸€äº›ä»»åŠ¡æ˜¯æ— æ³•ä¸­æ–­çš„ã€‚ä¾‹å¦‚ï¼Œå¦‚æœè¿›ç¨‹æ­£åœ¨å°è¯•ä»ç½‘ç»œä¸Šçš„å¦ä¸€å°è®¡ç®—æœºä¸Šè¯»å–æ–‡ä»¶ï¼Œè€Œè¯¥è®¡ç®—æœºä¸å¯ç”¨ï¼Œé‚£ä¹ˆè¯¥è¿›ç¨‹è¢«ç§°ä¸ºä¸å¯ä¸­æ–­ã€‚æœ€ç»ˆï¼Œè¯¥è¿›ç¨‹å°†è¶…æ—¶ï¼Œé€šå¸¸åœ¨ä¸¤åˆ†é’Ÿåã€‚ä¸€æ—¦è¶…æ—¶å‘ç”Ÿï¼Œè¯¥è¿›ç¨‹å°†è¢«ç»ˆæ­¢ã€‚] ã€‚ÙOther commonly used signals are `SIGHUP`, `SIGUSR1`, and `SIGUSR2`.  Since these are general purpose signals, different applications will respond differently.Ùå…¶ä»–å¸¸ç”¨çš„ä¿¡å·åŒ…æ‹¬ `SIGHUP`ã€`SIGUSR1` å’Œ `SIGUSR2`ã€‚ç”±äºè¿™äº›æ˜¯é€šç”¨çš„ä¿¡å·ï¼Œä¸åŒçš„åº”ç”¨ç¨‹åºä¼šæœ‰ä¸åŒçš„å“åº”ã€‚ÚŸFor example, after changing a web server's configuration file, the web server needs to be told to re-read its configuration.  Restarting `httpd` would result in a brief outage period on the web server.  Instead, send the daemon the `SIGHUP` signal.  Be aware that different daemons will have different behavior, so refer to the documentation for the daemon to determine if `SIGHUP` will achieve the desired results.Úvä¾‹å¦‚ï¼Œåœ¨æ›´æ”¹ Web æœåŠ¡å™¨çš„é…ç½®æ–‡ä»¶åï¼Œéœ€è¦å‘Šè¯‰ Web æœåŠ¡å™¨é‡æ–°è¯»å–å…¶é…ç½®ã€‚é‡æ–°å¯åŠ¨ `httpd` å°†å¯¼è‡´ Web æœåŠ¡å™¨çŸ­æš‚çš„åœæœºæ—¶é—´ã€‚ç›¸åï¼Œå‘é€ `SIGHUP` ä¿¡å·ç»™å®ˆæŠ¤è¿›ç¨‹ã€‚è¯·æ³¨æ„ï¼Œä¸åŒçš„å®ˆæŠ¤è¿›ç¨‹ä¼šæœ‰ä¸åŒçš„è¡Œä¸ºï¼Œå› æ­¤è¯·å‚è€ƒå®ˆæŠ¤è¿›ç¨‹çš„æ–‡æ¡£ä»¥ç¡®å®šæ˜¯å¦ä½¿ç”¨ `SIGHUP` å¯ä»¥è¾¾åˆ°æ‰€éœ€çš„ç»“æœã€‚ÚKilling a random process on the system is a bad idea.  In particular, man:init[8], PID 1, is special.  Running `/bin/kill -s KILL 1` is a quick, and unrecommended, way to shutdown the system.  _Always_ double check the arguments to man:kill[1] _before_ pressing kbd:[Return].Úåœ¨ç³»ç»Ÿä¸Šéšæœºæ€æ­»ä¸€ä¸ªè¿›ç¨‹æ˜¯ä¸€ä¸ªåä¸»æ„ã€‚ç‰¹åˆ«æ˜¯ï¼Œman:init[8]ï¼ŒPID 1 ï¼Œæ˜¯ç‰¹æ®Šçš„ã€‚è¿è¡Œ `/bin/kill -s KILL 1` æ˜¯ä¸€ä¸ªå¿«é€Ÿä½†ä¸æ¨èçš„å…³é—­ç³»ç»Ÿçš„æ–¹æ³•ã€‚åœ¨æŒ‰ä¸‹ kbd:[Return] ä¹‹å‰ï¼Œ_å§‹ç»ˆ_ ä»”ç»†æ£€æŸ¥ man:kill[1] çš„å‚æ•°ã€‚¦Shells¦ShellsÚA _shell_ provides a command line interface for interacting with the operating system.  A shell receives commands from the input channel and executes them.  Many shells provide built in functions to help with everyday tasks such as file management, file globbing, command line editing, command macros, and environment variables.  FreeBSD comes with several shells, including the Bourne shell (man:sh[1]) and the extended C shell (man:tcsh[1]).  Other shells are available from the FreeBSD Ports Collection, such as `zsh` and `bash`.ÚÒä¸€ä¸ª _shell_ æä¾›äº†ä¸€ä¸ªå‘½ä»¤è¡Œç•Œé¢ï¼Œç”¨äºä¸æ“ä½œç³»ç»Ÿè¿›è¡Œäº¤äº’ã€‚ Shell ä»è¾“å…¥é€šé“æ¥æ”¶å‘½ä»¤å¹¶æ‰§è¡Œå®ƒä»¬ã€‚è®¸å¤š shell æä¾›äº†å†…ç½®å‡½æ•°æ¥å¸®åŠ©å¤„ç†æ—¥å¸¸ä»»åŠ¡ï¼Œå¦‚æ–‡ä»¶ç®¡ç†ã€æ–‡ä»¶é€šé…ç¬¦ã€å‘½ä»¤è¡Œç¼–è¾‘ã€å‘½ä»¤å®å’Œç¯å¢ƒå˜é‡ã€‚ FreeBSD æä¾›äº†å‡ ä¸ª shellï¼ŒåŒ…æ‹¬ Bourne shellï¼ˆman:sh[1]ï¼‰å’Œæ‰©å±•çš„ C shellï¼ˆman:tcsh[1]ï¼‰ã€‚FreeBSD Ports Collection ä¸­è¿˜æä¾›äº†å…¶ä»– shellï¼Œå¦‚ `zsh` å’Œ `bash`ã€‚ÚLThe shell that is used is really a matter of taste.  A C programmer might feel more comfortable with a C-like shell such as man:tcsh[1].  A Linux(R) user might prefer `bash`.  Each shell has unique properties that may or may not work with a user's preferred working environment, which is why there is a choice of which shell to use.Ú?ä½¿ç”¨çš„ shell å®é™…ä¸Šæ˜¯ä¸ªäººå£å‘³çš„é—®é¢˜ã€‚ C ç¨‹åºå‘˜å¯èƒ½æ›´å–œæ¬¢ç±»ä¼¼ C çš„ shell ï¼Œæ¯”å¦‚ man:tcsh[1] ã€‚ Linux(R) ç”¨æˆ·å¯èƒ½æ›´å–œæ¬¢ `bash`ã€‚æ¯ä¸ª shell éƒ½æœ‰ç‹¬ç‰¹çš„ç‰¹æ€§ï¼Œå¯èƒ½é€‚ç”¨æˆ–ä¸é€‚ç”¨äºç”¨æˆ·é¦–é€‰çš„å·¥ä½œç¯å¢ƒï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆå¯ä»¥é€‰æ‹©ä½¿ç”¨å“ªä¸ª shell çš„åŸå› ã€‚ÚWOne common shell feature is filename completion.  After a user types the first few letters of a command or filename and presses kbd:[Tab], the shell completes the rest of the command or filename.  Consider two files called `foobar` and `football`.  To delete `foobar`, the user might type `rm foo` and press kbd:[Tab] to complete the filename.Ú]ä¸€ä¸ªå¸¸è§çš„ shell åŠŸèƒ½æ˜¯æ–‡ä»¶åè¡¥å…¨ã€‚å½“ç”¨æˆ·è¾“å…¥å‘½ä»¤æˆ–æ–‡ä»¶åçš„å‰å‡ ä¸ªå­—æ¯å¹¶æŒ‰ä¸‹ kbd:[Tab] é”®æ—¶ï¼Œ shell ä¼šè‡ªåŠ¨å®Œæˆå‘½ä»¤æˆ–æ–‡ä»¶åçš„å‰©ä½™éƒ¨åˆ†ã€‚å‡è®¾æœ‰ä¸¤ä¸ªæ–‡ä»¶ååˆ†åˆ«ä¸º `foobar` å’Œ `football`ã€‚è¦åˆ é™¤ `foobar`ï¼Œç”¨æˆ·å¯ä»¥è¾“å…¥ `rm foo` å¹¶æŒ‰ä¸‹ kbd:[Tab] é”®æ¥å®Œæˆæ–‡ä»¶åçš„è¡¥å…¨ã€‚ÚBut the shell only shows `rm foo`.  It was unable to complete the filename because both `foobar` and `football` start with `foo`.  Some shells sound a beep or show all the choices if more than one name matches.  The user must then type more characters to identify the desired filename.  Typing a `t` and pressing kbd:[Tab] again is enough to let the shell determine which filename is desired and fill in the rest.Ú`ä½†æ˜¯ Shell åªæ˜¾ç¤º `rm foo` ã€‚ç”±äº `foobar` å’Œ `football` éƒ½ä»¥ `foo` å¼€å¤´ï¼Œå®ƒæ— æ³•å®Œæˆæ–‡ä»¶åã€‚ä¸€äº› Shell ä¼šå‘å‡ºå“”å“”å£°æˆ–æ˜¾ç¤ºæ‰€æœ‰åŒ¹é…çš„é€‰é¡¹ã€‚ç”¨æˆ·å¿…é¡»è¾“å…¥æ›´å¤šå­—ç¬¦æ¥è¯†åˆ«æ‰€éœ€çš„æ–‡ä»¶åã€‚è¾“å…¥ä¸€ä¸ª `t` å¹¶å†æ¬¡æŒ‰ä¸‹ kbd:[Tab] å°±è¶³å¤Ÿè®© Shell ç¡®å®šæ‰€éœ€çš„æ–‡ä»¶åå¹¶å¡«å……å‰©ä¸‹çš„éƒ¨åˆ†ã€‚Ú§Another feature of the shell is the use of environment variables.  Environment variables are a variable/key pair stored in the shell's environment.  This environment can be read by any program invoked by the shell, and thus contains a lot of program configuration.  <<shell-env-vars>> provides a list of common environment variables and their meanings.  Note that the names of environment variables are always in uppercase.ÚEshell çš„å¦ä¸€ä¸ªç‰¹æ€§æ˜¯ä½¿ç”¨ç¯å¢ƒå˜é‡ã€‚ç¯å¢ƒå˜é‡æ˜¯å­˜å‚¨åœ¨ shell ç¯å¢ƒä¸­çš„é”®å€¼å¯¹ã€‚ä»»ä½•ç”± shell è°ƒç”¨çš„ç¨‹åºéƒ½å¯ä»¥è¯»å–è¿™ä¸ªç¯å¢ƒï¼Œå¹¶å› æ­¤åŒ…å«äº†è®¸å¤šç¨‹åºé…ç½®ã€‚ <<shell-env-vars>> æä¾›äº†å¸¸è§ç¯å¢ƒå˜é‡åŠå…¶å«ä¹‰çš„åˆ—è¡¨ã€‚è¯·æ³¨æ„ï¼Œç¯å¢ƒå˜é‡çš„åç§°å§‹ç»ˆä¸ºå¤§å†™ã€‚¹Type of operating system.¸æ“ä½œç³»ç»Ÿçš„ç±»å‹ã€‚Ú3How to set an environment variable differs between shells.  In man:tcsh[1] and man:csh[1], use `setenv` to set environment variables.  In man:sh[1] and `bash`, use `export` to set the current environment variables.  This example sets the default `EDITOR` to `/usr/local/bin/emacs` for the man:tcsh[1] shell:Ú@åœ¨ä¸åŒçš„ shell ä¸­è®¾ç½®ç¯å¢ƒå˜é‡çš„æ–¹æ³•æ˜¯ä¸åŒçš„ã€‚åœ¨ man:tcsh[1] å’Œ man:csh[1] ä¸­ï¼Œä½¿ç”¨ `setenv` æ¥è®¾ç½®ç¯å¢ƒå˜é‡ã€‚åœ¨ man:sh[1] å’Œ `bash` ä¸­ï¼Œä½¿ç”¨ `export` æ¥è®¾ç½®å½“å‰çš„ç¯å¢ƒå˜é‡ã€‚ä»¥ä¸‹ç¤ºä¾‹å°†é»˜è®¤çš„ `EDITOR` è®¾ç½®ä¸º `/usr/local/bin/emacs`ï¼Œé€‚ç”¨äº man:tcsh[1] shellã€‚Ù+The equivalent command for `bash` would be:¼`bash` çš„ç­‰æ•ˆå‘½ä»¤æ˜¯ï¼šÙÆTo expand an environment variable in order to see its current setting, type a `$` character in front of its name on the command line.  For example, `echo $TERM` displays the current `$TERM` setting.Ù¢ä¸ºäº†å±•å¼€ç¯å¢ƒå˜é‡ä»¥æŸ¥çœ‹å…¶å½“å‰è®¾ç½®ï¼Œåœ¨å‘½ä»¤è¡Œä¸­åœ¨å…¶åç§°å‰é¢é”®å…¥ `$` å­—ç¬¦ã€‚ä¾‹å¦‚ï¼Œ`echo $TERM` ä¼šæ˜¾ç¤ºå½“å‰çš„ `$TERM` è®¾ç½®ã€‚ÚˆShells treat special characters, known as meta-characters, as special representations of data.  The most common meta-character is `\*`, which represents any number of characters in a filename.  Meta-characters can be used to perform filename globbing.  For example, `echo *` is equivalent to `ls` because the shell takes all the files that match `*` and `echo` lists them on the command line.ÚMShell å°†ç‰¹æ®Šå­—ç¬¦ï¼Œç§°ä¸ºå…ƒå­—ç¬¦ï¼Œè§†ä¸ºæ•°æ®çš„ç‰¹æ®Šè¡¨ç¤ºã€‚æœ€å¸¸è§çš„å…ƒå­—ç¬¦æ˜¯ `\*` ï¼Œå®ƒè¡¨ç¤ºæ–‡ä»¶åä¸­çš„ä»»æ„æ•°é‡çš„å­—ç¬¦ã€‚å…ƒå­—ç¬¦å¯ä»¥ç”¨äºæ‰§è¡Œæ–‡ä»¶åé€šé…ç¬¦åŒ¹é…ã€‚ä¾‹å¦‚ï¼Œ`echo *` ç­‰åŒäº `ls` ï¼Œå› ä¸º shell ä¼šå°†ä¸ `*` åŒ¹é…çš„æ‰€æœ‰æ–‡ä»¶å–å‡ºï¼Œå¹¶åœ¨å‘½ä»¤è¡Œä¸Šåˆ—å‡ºå®ƒä»¬ã€‚ÙíTo prevent the shell from interpreting a special character, escape it from the shell by starting it with a backslash (`\`).  For example, `echo $TERM` prints the terminal setting whereas `echo \$TERM` literally prints the string `$TERM`.Ùáä¸ºäº†é˜²æ­¢ shell è§£é‡Šç‰¹æ®Šå­—ç¬¦ï¼Œå¯ä»¥é€šè¿‡åœ¨ç‰¹æ®Šå­—ç¬¦å‰åŠ ä¸Šåæ–œæ ï¼ˆ`\`ï¼‰æ¥å°†å…¶ä» shell ä¸­è½¬ä¹‰ã€‚ä¾‹å¦‚ï¼Œ `echo $TERM` ä¼šæ‰“å°ç»ˆç«¯è®¾ç½®ï¼Œè€Œ `echo \$TERM` ä¼šç›´æ¥æ‰“å°å­—ç¬¦ä¸² `$TERM`ã€‚²Changing the Shell¬æ›´æ”¹ ShellÚThe easiest way to permanently change the default shell is to use `chsh`.  Running this command will open the editor that is configured in the `EDITOR` environment variable, which by default is set to man:vi[1].  Change the `Shell:` line to the full path of the new shell.Ùßæ°¸ä¹…æ›´æ”¹é»˜è®¤ shell çš„æœ€ç®€å•æ–¹æ³•æ˜¯ä½¿ç”¨ `chsh` å‘½ä»¤ã€‚è¿è¡Œæ­¤å‘½ä»¤å°†æ‰“å¼€åœ¨ `EDITOR` ç¯å¢ƒå˜é‡ä¸­é…ç½®çš„ç¼–è¾‘å™¨ï¼Œé»˜è®¤è®¾ç½®ä¸º man:vi[1]ã€‚å°† `Shell:` è¡Œæ›´æ”¹ä¸ºæ–° shell çš„å®Œæ•´è·¯å¾„ã€‚Ù…Alternately, use `chsh -s` which will set the specified shell without opening an editor.  For example, to change the shell to `bash`:Ùˆæˆ–è€…ï¼Œä½¿ç”¨ `chsh -s` å‘½ä»¤å¯ä»¥åœ¨ä¸æ‰“å¼€ç¼–è¾‘å™¨çš„æƒ…å†µä¸‹è®¾ç½®æŒ‡å®šçš„ shellã€‚ä¾‹å¦‚ï¼Œè¦å°† shell æ›´æ”¹ä¸º `bash`ï¼šÙ†Enter your password at the prompt and press kbd:[Return] to change your shell.  Log off and log in again to start using the new shell.ÙŒåœ¨æç¤ºç¬¦å¤„è¾“å…¥æ‚¨çš„å¯†ç ï¼Œç„¶åæŒ‰ä¸‹ kbd:[Return] é”®æ¥æ›´æ”¹æ‚¨çš„ shellã€‚æ³¨é”€å¹¶é‡æ–°ç™»å½•ä»¥å¼€å§‹ä½¿ç”¨æ–°çš„ shellã€‚ÚNThe new shell _must_ be present in `/etc/shells`.  If the shell was installed from the FreeBSD Ports Collection as described in crossref:ports[ports,Installing Applications: Packages and Ports], it should be automatically added to this file.  If it is missing, add it using this command, replacing the path with the path of the shell:Ú=æ–°çš„ shell å¿…é¡»å­˜åœ¨äº `/etc/shells` ä¸­ã€‚å¦‚æœ shell æ˜¯æŒ‰ç…§ crossref:ports[ports,å®‰è£…åº”ç”¨ç¨‹åºï¼šè½¯ä»¶åŒ…å’Œ Ports] ä¸­æè¿°çš„æ–¹å¼ä» FreeBSD Ports Collection å®‰è£…çš„ï¼Œåˆ™åº”è‡ªåŠ¨å°†å…¶æ·»åŠ åˆ°æ­¤æ–‡ä»¶ä¸­ã€‚å¦‚æœç¼ºå°‘ï¼Œåˆ™ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ·»åŠ ï¼Œå°†è·¯å¾„æ›¿æ¢ä¸º shell çš„è·¯å¾„ï¼š¸Then, rerun man:chsh[1].Ù$ç„¶åï¼Œé‡æ–°è¿è¡Œ man:chsh[1]ã€‚¹Advanced Shell Techniques³é«˜çº§ Shell æŠ€å·§ÚeThe UNIX(R) shell is not just a command interpreter, it acts as a powerful tool which allows users to execute commands, redirect their output, redirect their input and chain commands together to improve the final command output.  When this functionality is mixed with built in commands, the user is provided with an environment that can maximize efficiency.Ú4UNIX(R) shell ä¸ä»…ä»…æ˜¯ä¸€ä¸ªå‘½ä»¤è§£é‡Šå™¨ï¼Œå®ƒè¿˜æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å·¥å…·ï¼Œå…è®¸ç”¨æˆ·æ‰§è¡Œå‘½ä»¤ã€é‡å®šå‘è¾“å‡ºã€é‡å®šå‘è¾“å…¥ä»¥åŠé“¾å¼ç»„åˆå‘½ä»¤ï¼Œä»¥æé«˜æœ€ç»ˆå‘½ä»¤çš„è¾“å‡ºã€‚å½“è¿™ç§åŠŸèƒ½ä¸å†…ç½®å‘½ä»¤ç»“åˆä½¿ç”¨æ—¶ï¼Œç”¨æˆ·å¯ä»¥è·å¾—ä¸€ä¸ªå¯ä»¥æœ€å¤§åŒ–æ•ˆç‡çš„ç¯å¢ƒã€‚ÙÔShell redirection is the action of sending the output or the input of a command into another command or into a file.  To capture the output of the man:ls[1] command, for example, into a file, redirect the output:Ù¶Shell é‡å®šå‘æ˜¯å°†å‘½ä»¤çš„è¾“å‡ºæˆ–è¾“å…¥å‘é€åˆ°å¦ä¸€ä¸ªå‘½ä»¤æˆ–æ–‡ä»¶çš„æ“ä½œã€‚ä¾‹å¦‚ï¼Œè¦å°† man:ls[1] å‘½ä»¤çš„è¾“å‡ºæ•è·åˆ°æ–‡ä»¶ä¸­ï¼Œå¯ä»¥ä½¿ç”¨é‡å®šå‘æ“ä½œï¼šÙ¯The directory contents will now be listed in `directory_listing.txt`.  Some commands can be used to read input, such as man:sort[1].  To sort this listing, redirect the input:Ù³ç›®å½•å†…å®¹ç°åœ¨å°†ä¼šåˆ—åœ¨ `directory_listing.txt` ä¸­ã€‚ä¸€äº›å‘½ä»¤å¯ä»¥ç”¨æ¥è¯»å–è¾“å…¥ï¼Œæ¯”å¦‚ man:sort[1] ã€‚è¦å¯¹è¿™ä¸ªåˆ—è¡¨è¿›è¡Œæ’åºï¼Œå¯ä»¥é‡å®šå‘è¾“å…¥ï¼šÙ£The input will be sorted and placed on the screen.  To redirect that input into another file, one could redirect the output of man:sort[1] by mixing the direction:Ù”è¾“å…¥å°†è¢«æ’åºå¹¶æ˜¾ç¤ºåœ¨å±å¹•ä¸Šã€‚è¦å°†è¯¥è¾“å…¥é‡å®šå‘åˆ°å¦ä¸€ä¸ªæ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡æ··åˆæ–¹å‘æ¥é‡å®šå‘ man:sort[1] çš„è¾“å‡ºã€‚Ú!In all of the previous examples, the commands are performing redirection using file descriptors.  Every UNIX(R) system has file descriptors, which include standard input (stdin), standard output (stdout), and standard error (stderr).  Each one has a purpose, where input could be a keyboard or a mouse, something that provides input.  Output could be a screen or paper in a printer.  And error would be anything that is used for diagnostic or error messages.  All three are considered I/O based file descriptors and sometimes considered streams.Úëåœ¨æ‰€æœ‰ä¹‹å‰çš„ç¤ºä¾‹ä¸­ï¼Œå‘½ä»¤éƒ½æ˜¯ä½¿ç”¨æ–‡ä»¶æè¿°ç¬¦è¿›è¡Œé‡å®šå‘ã€‚æ¯ä¸ª UNIX(R) ç³»ç»Ÿéƒ½æœ‰æ–‡ä»¶æè¿°ç¬¦ï¼ŒåŒ…æ‹¬æ ‡å‡†è¾“å…¥ (stdin)ã€æ ‡å‡†è¾“å‡º (stdout) å’Œæ ‡å‡†é”™è¯¯ (stderr)ã€‚æ¯ä¸ªæ–‡ä»¶æè¿°ç¬¦éƒ½æœ‰å…¶ç”¨é€”ï¼Œå…¶ä¸­è¾“å…¥å¯ä»¥æ˜¯é”®ç›˜æˆ–é¼ æ ‡ï¼Œæä¾›è¾“å…¥çš„è®¾å¤‡ã€‚è¾“å‡ºå¯ä»¥æ˜¯å±å¹•æˆ–æ‰“å°æœºä¸Šçš„çº¸å¼ ã€‚è€Œé”™è¯¯åˆ™æ˜¯ç”¨äºè¯Šæ–­æˆ–é”™è¯¯æ¶ˆæ¯çš„ä»»ä½•å†…å®¹ã€‚è¿™ä¸‰ä¸ªéƒ½è¢«è§†ä¸ºåŸºäº I/O çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œæœ‰æ—¶ä¹Ÿè¢«ç§°ä¸ºæµã€‚ÙËThrough the use of these descriptors, the shell allows output and input to be passed around through various commands and redirected to or from a file.  Another method of redirection is the pipe operator.Ù»é€šè¿‡ä½¿ç”¨è¿™äº›æè¿°ç¬¦ï¼Œ Shell å…è®¸è¾“å‡ºå’Œè¾“å…¥åœ¨å„ä¸ªå‘½ä»¤ä¹‹é—´ä¼ é€’ï¼Œå¹¶å¯ä»¥é‡å®šå‘åˆ°æ–‡ä»¶æˆ–ä»æ–‡ä»¶ä¸­è¯»å–ã€‚å¦ä¸€ç§é‡å®šå‘çš„æ–¹æ³•æ˜¯ç®¡é“æ“ä½œç¬¦ã€‚ÙğThe UNIX(R) pipe operator, "|" allows the output of one command to be directly passed or directed to another program.  Basically, a pipe allows the standard output of a command to be passed as standard input to another command, for example:ÙÒUNIX(R) ç®¡é“æ“ä½œç¬¦â€œ|â€å…è®¸å°†ä¸€ä¸ªå‘½ä»¤çš„è¾“å‡ºç›´æ¥ä¼ é€’æˆ–å®šå‘åˆ°å¦ä¸€ä¸ªç¨‹åºã€‚åŸºæœ¬ä¸Šï¼Œç®¡é“å…è®¸å°†ä¸€ä¸ªå‘½ä»¤çš„æ ‡å‡†è¾“å‡ºä½œä¸ºå¦ä¸€ä¸ªå‘½ä»¤çš„æ ‡å‡†è¾“å…¥ä¼ é€’ï¼Œä¾‹å¦‚ï¼šÙàIn that example, the contents of `directory_listing.txt` will be sorted and the output passed to man:less[1].  This allows the user to scroll through the output at their own pace and prevent it from scrolling off the screen.ÙÇåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ`directory_listing.txt` çš„å†…å®¹å°†è¢«æ’åºï¼Œå¹¶ä¸”è¾“å‡ºå°†ä¼ é€’ç»™ man:less[1] ã€‚è¿™ä½¿å¾—ç”¨æˆ·å¯ä»¥æŒ‰ç…§è‡ªå·±çš„èŠ‚å¥æ»šåŠ¨è¾“å‡ºï¼Œå¹¶é˜²æ­¢å…¶æ»šåŠ¨åˆ°å±å¹•å¤–ã€‚¬Text Editors¯æ–‡æœ¬ç¼–è¾‘å™¨ÙàMost FreeBSD configuration is done by editing text files, so it is a good idea to become familiar with a text editor.  FreeBSD comes with a few as part of the base system, and many more are available in the Ports Collection.Ùìå¤§å¤šæ•° FreeBSD çš„é…ç½®æ˜¯é€šè¿‡ç¼–è¾‘æ–‡æœ¬æ–‡ä»¶æ¥å®Œæˆçš„ï¼Œå› æ­¤ç†Ÿæ‚‰æ–‡æœ¬ç¼–è¾‘å™¨æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ã€‚FreeBSD è‡ªå¸¦äº†ä¸€äº›åŸºæœ¬ç³»ç»Ÿçš„æ–‡æœ¬ç¼–è¾‘å™¨ï¼Œè¿˜æœ‰æ›´å¤šçš„ç¼–è¾‘å™¨å¯ä»¥åœ¨ Ports Collection ä¸­æ‰¾åˆ°ã€‚ÚA simple editor to learn is man:ee[1], which stands for easy editor.  To start this editor, type `ee _filename_` where _filename_ is the name of the file to be edited.  Once inside the editor, all of the commands for manipulating the editor's functions are listed at the top of the display.  The caret (`^`) represents kbd:[Ctrl], so `^e` expands to kbd:[Ctrl+e].  To leave man:ee[1], press kbd:[Esc], then choose the "leave editor" option from the main menu.  The editor will prompt to save any changes if the file has been modified.Úä¸€ä¸ªç®€å•çš„å­¦ä¹ ç¼–è¾‘å™¨æ˜¯ man:ee[1] ï¼Œå®ƒä»£è¡¨ç€ easy editorï¼ˆç®€æ˜“ç¼–è¾‘å™¨ï¼‰ã€‚è¦å¯åŠ¨è¿™ä¸ªç¼–è¾‘å™¨ï¼Œè¾“å…¥ `ee _filename_`ï¼Œå…¶ä¸­ _filename_ æ˜¯è¦ç¼–è¾‘çš„æ–‡ä»¶åã€‚ä¸€æ—¦è¿›å…¥ç¼–è¾‘å™¨ï¼Œæ‰€æœ‰ç”¨äºæ“ä½œç¼–è¾‘å™¨åŠŸèƒ½çš„å‘½ä»¤éƒ½åˆ—åœ¨æ˜¾ç¤ºå±çš„é¡¶éƒ¨ã€‚æ’å…¥ç¬¦å·ï¼ˆ`^`ï¼‰ä»£è¡¨ kbd:[Ctrl]ï¼Œæ‰€ä»¥ `^e` æ‰©å±•ä¸º kbd:[Ctrl + e]ã€‚è¦ç¦»å¼€ man:ee[1]ï¼ŒæŒ‰ä¸‹ kbd:[Esc]ï¼Œç„¶åä»ä¸»èœå•ä¸­é€‰æ‹©â€œç¦»å¼€ç¼–è¾‘å™¨â€é€‰é¡¹ã€‚å¦‚æœæ–‡ä»¶å·²è¢«ä¿®æ”¹ï¼Œç¼–è¾‘å™¨å°†æç¤ºä¿å­˜ä»»ä½•æ›´æ”¹ã€‚Ú‰FreeBSD also comes with more powerful text editors, such as man:vi[1], as part of the base system.  Other editors, like package:editors/emacs[] and package:editors/vim[], are part of the FreeBSD Ports Collection.  These editors offer more functionality at the expense of being more complicated to learn.  Learning a more powerful editor such as vim or Emacs can save more time in the long run.ÚŠFreeBSD è¿˜é…å¤‡äº†æ›´å¼ºå¤§çš„æ–‡æœ¬ç¼–è¾‘å™¨ï¼Œä¾‹å¦‚ man:vi[1]ï¼Œä½œä¸ºåŸºæœ¬ç³»ç»Ÿçš„ä¸€éƒ¨åˆ†ã€‚å…¶ä»–ç¼–è¾‘å™¨ï¼Œå¦‚ package:editors/emacs[] å’Œ package:editors/vim[]ï¼Œæ˜¯ FreeBSD Ports Collection çš„ä¸€éƒ¨åˆ†ã€‚è¿™äº›ç¼–è¾‘å™¨æä¾›äº†æ›´å¤šçš„åŠŸèƒ½ï¼Œä½†å­¦ä¹ èµ·æ¥æ›´åŠ å¤æ‚ã€‚å­¦ä¹ ä½¿ç”¨åƒ vim æˆ– Emacs è¿™æ ·æ›´å¼ºå¤§çš„ç¼–è¾‘å™¨å¯ä»¥åœ¨é•¿æœŸæ¥çœ‹èŠ‚çœæ›´å¤šçš„æ—¶é—´ã€‚ÙÃMany applications which modify files or require typed input will automatically open a text editor.  To change the default editor, set the `EDITOR` environment variable as described in <<shells>>.ÙÁè®¸å¤šä¿®æ”¹æ–‡ä»¶æˆ–éœ€è¦è¾“å…¥æ–‡æœ¬çš„åº”ç”¨ç¨‹åºä¼šè‡ªåŠ¨æ‰“å¼€ä¸€ä¸ªæ–‡æœ¬ç¼–è¾‘å™¨ã€‚è¦æ›´æ”¹é»˜è®¤çš„ç¼–è¾‘å™¨ï¼Œè¯·æŒ‰ç…§ <<shells>> ä¸­æè¿°çš„æ–¹å¼è®¾ç½® `EDITOR` ç¯å¢ƒå˜é‡ã€‚¸Devices and Device Nodesµè®¾å¤‡å’Œè®¾å¤‡èŠ‚ç‚¹ÚA device is a term used mostly for hardware-related activities in a system, including disks, printers, graphics cards, and keyboards.  When FreeBSD boots, the majority of the boot messages refer to devices being detected.  A copy of the boot messages is saved to `/var/run/dmesg.boot`.Ùõè®¾å¤‡æ˜¯ç³»ç»Ÿä¸­ä¸»è¦ç”¨äºç¡¬ä»¶ç›¸å…³æ´»åŠ¨çš„æœ¯è¯­ï¼ŒåŒ…æ‹¬ç£ç›˜ã€æ‰“å°æœºã€æ˜¾å¡å’Œé”®ç›˜ç­‰ã€‚å½“ FreeBSD å¯åŠ¨æ—¶ï¼Œå¤§éƒ¨åˆ†å¼•å¯¼æ¶ˆæ¯éƒ½æ˜¯å…³äºæ£€æµ‹åˆ°çš„è®¾å¤‡ã€‚å¼•å¯¼æ¶ˆæ¯çš„å‰¯æœ¬ä¿å­˜åœ¨ `/var/run/dmesg.boot` ä¸­ã€‚Ù‚Each device has a device name and number.  For example, `ada0` is the first SATA hard drive, while `kbd0` represents the keyboard.Ùyæ¯ä¸ªè®¾å¤‡éƒ½æœ‰ä¸€ä¸ªè®¾å¤‡åç§°å’Œç¼–å·ã€‚ä¾‹å¦‚ï¼Œ `ada0` è¡¨ç¤ºç¬¬ä¸€ä¸ª SATA ç¡¬ç›˜ï¼Œè€Œ `kbd0` è¡¨ç¤ºé”®ç›˜ã€‚ÙpMost devices in FreeBSD must be accessed through special files called device nodes, which are located in `/dev`.Ùƒåœ¨ FreeBSD ä¸­ï¼Œå¤§å¤šæ•°è®¾å¤‡å¿…é¡»é€šè¿‡ç§°ä¸ºè®¾å¤‡èŠ‚ç‚¹çš„ç‰¹æ®Šæ–‡ä»¶è¿›è¡Œè®¿é—®ï¼Œè¿™äº›æ–‡ä»¶ä½äº `/dev` ç›®å½•ä¸­ã€‚¬Manual Pages©æ‰‹å†Œé¡µÙùThe most comprehensive documentation on FreeBSD is in the form of manual pages.  Nearly every program on the system comes with a short reference manual explaining the basic operation and available arguments.  These manuals can be viewed using `man`:ÙÛFreeBSD ä¸Šæœ€å…¨é¢çš„æ–‡æ¡£æ˜¯ä»¥æ‰‹å†Œé¡µçš„å½¢å¼å­˜åœ¨çš„ã€‚ç³»ç»Ÿä¸Šå‡ ä¹æ¯ä¸ªç¨‹åºéƒ½é™„å¸¦æœ‰ä¸€ä¸ªç®€çŸ­çš„å‚è€ƒæ‰‹å†Œï¼Œè§£é‡Šå…¶åŸºæœ¬æ“ä½œå’Œå¯ç”¨å‚æ•°ã€‚å¯ä»¥ä½¿ç”¨ `man` å‘½ä»¤æŸ¥çœ‹è¿™äº›æ‰‹å†Œã€‚Ùmwhere _command_ is the name of the command to learn about.  For example, to learn more about man:ls[1], type:Ùså…¶ä¸­ _command_ æ˜¯è¦äº†è§£çš„å‘½ä»¤çš„åç§°ã€‚ä¾‹å¦‚ï¼Œè¦äº†è§£æœ‰å…³ man:ls[1] çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·è¾“å…¥ï¼šÙ|Manual pages are divided into sections which represent the type of topic.  In FreeBSD, the following sections are available:Ùræ‰‹å†Œé¡µè¢«åˆ†ä¸ºä¸åŒçš„ç« èŠ‚ï¼Œä»£è¡¨ä¸åŒçš„ä¸»é¢˜ç±»å‹ã€‚åœ¨ FreeBSD ä¸­ï¼Œæœ‰ä»¥ä¸‹å‡ ä¸ªç« èŠ‚å¯ç”¨ï¼š®User commands.¯ç”¨æˆ·å‘½ä»¤ã€‚¿System calls and error numbers.¾ç³»ç»Ÿè°ƒç”¨å’Œé”™è¯¯ç¼–å·ã€‚½Functions in the C libraries.´C åº“ä¸­çš„å‡½æ•°ã€‚¯Device drivers.µè®¾å¤‡é©±åŠ¨ç¨‹åºã€‚­File formats.¯æ–‡ä»¶æ ¼å¼ã€‚»Games and other diversions.¾æ¸¸æˆå’Œå…¶ä»–å¨±ä¹æ´»åŠ¨ã€‚ºMiscellaneous information.¯æ‚é¡¹ä¿¡æ¯ã€‚Ù*System maintenance and operation commands.¾ç³»ç»Ÿç»´æŠ¤å’Œæ“ä½œå‘½ä»¤ã€‚¹System kernel interfaces.µç³»ç»Ÿå†…æ ¸æ¥å£ã€‚ÙìIn some cases, the same topic may appear in more than one section of the online manual.  For example, there is a `chmod` user command and a `chmod()` system call.  To tell man:man[1] which section to display, specify the section number:Ùæåœ¨æŸäº›æƒ…å†µä¸‹ï¼ŒåŒä¸€ä¸ªä¸»é¢˜å¯èƒ½ä¼šå‡ºç°åœ¨åœ¨çº¿æ‰‹å†Œçš„å¤šä¸ªéƒ¨åˆ†ä¸­ã€‚ä¾‹å¦‚ï¼Œæœ‰ä¸€ä¸ª `chmod` ç”¨æˆ·å‘½ä»¤å’Œä¸€ä¸ª `chmod()` ç³»ç»Ÿè°ƒç”¨ã€‚è¦å‘Šè¯‰ man:man[1] æ˜¾ç¤ºå“ªä¸ªéƒ¨åˆ†ï¼Œéœ€è¦æŒ‡å®šéƒ¨åˆ†å·ç ï¼šÚThis will display the manual page for the user command man:chmod[1].  References to a particular section of the online manual are traditionally placed in parenthesis in written documentation, so man:chmod[1] refers to the user command and man:chmod[2] refers to the system call.Ùİè¿™å°†æ˜¾ç¤ºç”¨æˆ·å‘½ä»¤ man:chmod[1] çš„æ‰‹å†Œé¡µé¢ã€‚åœ¨ä¹¦é¢æ–‡æ¡£ä¸­ï¼Œå¯¹åœ¨çº¿æ‰‹å†Œçš„ç‰¹å®šéƒ¨åˆ†çš„å¼•ç”¨é€šå¸¸æ”¾åœ¨æ‹¬å·ä¸­ï¼Œå› æ­¤ man:chmod[1] æŒ‡çš„æ˜¯ç”¨æˆ·å‘½ä»¤ï¼Œman:chmod[2] æŒ‡çš„æ˜¯ç³»ç»Ÿè°ƒç”¨ã€‚ÙoIf the name of the manual page is unknown, use `man -k` to search for keywords in the manual page descriptions:Ù^å¦‚æœä¸çŸ¥é“æ‰‹å†Œé¡µçš„åç§°ï¼Œè¯·ä½¿ç”¨ `man -k` åœ¨æ‰‹å†Œé¡µæè¿°ä¸­æœç´¢å…³é”®å­—ï¼šÙ‰This command displays a list of commands that have the keyword "mail" in their descriptions.  This is equivalent to using man:apropos[1].Ùtè¯¥å‘½ä»¤æ˜¾ç¤ºå…·æœ‰å…³é”®å­—â€œmailâ€åœ¨å…¶æè¿°ä¸­çš„å‘½ä»¤åˆ—è¡¨ã€‚è¿™ç›¸å½“äºä½¿ç”¨ man:apropos[1] å‘½ä»¤ã€‚ÙFTo read the descriptions for all of the commands in `/usr/sbin`, type:ÙCè¦é˜…è¯» `/usr/sbin` ç›®å½•ä¸‹æ‰€æœ‰å‘½ä»¤çš„æè¿°ï¼Œè¯·è¾“å…¥ï¼š¢or¦æˆ–è€…®GNU Info Files¯GNU Info æ–‡ä»¶Ú1FreeBSD includes several applications and utilities produced by the Free Software Foundation (FSF).  In addition to manual pages, these programs may include hypertext documents called `info` files.  These can be viewed using man:info[1] or, if package:editors/emacs[] is installed, the info mode of emacs.Ú?FreeBSD åŒ…å«äº†ç”±è‡ªç”±è½¯ä»¶åŸºé‡‘ä¼šï¼ˆFSFï¼‰åˆ¶ä½œçš„å¤šä¸ªåº”ç”¨ç¨‹åºå’Œå®ç”¨å·¥å…·ã€‚é™¤äº†æ‰‹å†Œé¡µï¼Œè¿™äº›ç¨‹åºè¿˜å¯èƒ½åŒ…æ‹¬ç§°ä¸º `info` æ–‡ä»¶çš„è¶…æ–‡æœ¬æ–‡æ¡£ã€‚å¯ä»¥ä½¿ç”¨ man:info[1] å‘½ä»¤æˆ–è€…å¦‚æœå®‰è£…äº† package:editors/emacs[] ï¼Œå¯ä»¥ä½¿ç”¨ emacs çš„ info æ¨¡å¼æ¥æŸ¥çœ‹è¿™äº›æ–‡ä»¶ã€‚¹To use man:info[1], type:Ù$è¦ä½¿ç”¨ man:info[1]ï¼Œè¯·è¾“å…¥ï¼šÙMFor a brief introduction, type `h`.  For a quick command reference, type `?`.ÙVè¦è¿›è¡Œç®€è¦ä»‹ç»ï¼Œè¯·è¾“å…¥ `h`ã€‚è¦æŸ¥çœ‹å¿«é€Ÿå‘½ä»¤å‚è€ƒï¼Œè¯·è¾“å…¥ `?`ã€‚Ú4A variety of free and commercial partition resizing tools are listed at link:https://en.wikipedia.org/wiki/List_of_disk_partitioning_software[List of disk partitioning software wikipedia entry].  link:https://gparted.org/livecd.php[GParted Live] is a free live CD which includes the GParted partition editor.Ú"åœ¨ link:https://en.wikipedia.org/wiki/List_of_disk_partitioning_software[ç£ç›˜åˆ†åŒºè½¯ä»¶ç»´åŸºç™¾ç§‘æ¡ç›®] ä¸­åˆ—å‡ºäº†å„ç§å…è´¹å’Œå•†ä¸šçš„åˆ†åŒºè°ƒæ•´å·¥å…·ã€‚link:https://gparted.org/livecd.php[GParted Live] æ˜¯ä¸€ä¸ªå…è´¹çš„ Live CDï¼Œå…¶ä¸­åŒ…å«äº† GParted åˆ†åŒºç¼–è¾‘å™¨ã€‚ÚWhen used properly, disk shrinking utilities can safely create space for creating a new partition.  Since the possibility of selecting the wrong partition exists, always backup any important data and verify the integrity of the backup before modifying disk partitions.ÙŞå½“æ­£ç¡®ä½¿ç”¨æ—¶ï¼Œç£ç›˜æ”¶ç¼©å·¥å…·å¯ä»¥å®‰å…¨åœ°ä¸ºåˆ›å»ºæ–°åˆ†åŒºè…¾å‡ºç©ºé—´ã€‚ç”±äºé€‰æ‹©é”™è¯¯åˆ†åŒºçš„å¯èƒ½æ€§å­˜åœ¨ï¼Œä¸€å®šè¦åœ¨ä¿®æ”¹ç£ç›˜åˆ†åŒºä¹‹å‰å¤‡ä»½ä»»ä½•é‡è¦æ•°æ®å¹¶éªŒè¯å¤‡ä»½çš„å®Œæ•´æ€§ã€‚Ú6Disk partitions containing different operating systems make it possible to install multiple operating systems on one computer.  An alternative is to use crossref:virtualization[virtualization,virtualization] which allows multiple operating systems to run at the same time without modifying any disk partitions.ÙáåŒ…å«ä¸åŒæ“ä½œç³»ç»Ÿçš„ç£ç›˜åˆ†åŒºä½¿å¾—åœ¨ä¸€å°è®¡ç®—æœºä¸Šå®‰è£…å¤šä¸ªæ“ä½œç³»ç»Ÿæˆä¸ºå¯èƒ½ã€‚å¦ä¸€ç§é€‰æ‹©æ˜¯ä½¿ç”¨è™šæ‹ŸåŒ–æŠ€æœ¯ï¼Œå®ƒå…è®¸å¤šä¸ªæ“ä½œç³»ç»ŸåŒæ—¶è¿è¡Œï¼Œè€Œæ— éœ€ä¿®æ”¹ä»»ä½•ç£ç›˜åˆ†åŒºã€‚¾*Collect Network Information*
µ*æ”¶é›†ç½‘ç»œä¿¡æ¯*
ÙÇSome FreeBSD installation methods require a network connection in order to download the installation files.  After any installation, the installer will offer to setup the system's network interfaces.Ù™ä¸€äº› FreeBSD å®‰è£…æ–¹æ³•éœ€è¦ç½‘ç»œè¿æ¥æ‰èƒ½ä¸‹è½½å®‰è£…æ–‡ä»¶ã€‚åœ¨ä»»ä½•å®‰è£…ä¹‹åï¼Œå®‰è£…ç¨‹åºå°†æä¾›è®¾ç½®ç³»ç»Ÿç½‘ç»œæ¥å£çš„é€‰é¡¹ã€‚ÙüIf the network has a DHCP server, it can be used to provide automatic network configuration.  If DHCP is not available, the following network information for the system must be obtained from the local network administrator or Internet service provider:ÙÆå¦‚æœç½‘ç»œæœ‰ DHCP æœåŠ¡å™¨ï¼Œå¯ä»¥ä½¿ç”¨å®ƒæ¥æä¾›è‡ªåŠ¨ç½‘ç»œé…ç½®ã€‚å¦‚æœæ²¡æœ‰ DHCP å¯ç”¨ï¼Œå¿…é¡»ä»æœ¬åœ°ç½‘ç»œç®¡ç†å‘˜æˆ–äº’è”ç½‘æœåŠ¡æä¾›å•†è·å–ç³»ç»Ÿçš„ä»¥ä¸‹ç½‘ç»œä¿¡æ¯ï¼š¼Required Network Information²æ‰€éœ€ç½‘ç»œä¿¡æ¯ªIP address©IP åœ°å€«Subnet mask¬å­ç½‘æ©ç ½IP address of default gateway¹é»˜è®¤ç½‘å…³çš„ IP åœ°å€ºDomain name of the network¯ç½‘ç»œçš„åŸŸåÙ)IP addresses of the network's DNS serversÙ$ç½‘ç»œçš„ DNS æœåŠ¡å™¨çš„ IP åœ°å€»*Check for FreeBSD Errata*
»*æ£€æŸ¥ FreeBSD å‹˜è¯¯è¡¨*
Ú«Although the FreeBSD Project strives to ensure that each release of FreeBSD is as stable as possible, bugs occasionally creep into the process.  On very rare occasions those bugs affect the installation process.  As these problems are discovered and fixed, they are noted in the FreeBSD Errata page of each version.  Check the errata before installing to make sure that there are no problems that might affect the installation.Úkå°½ç®¡ FreeBSD é¡¹ç›®åŠªåŠ›ç¡®ä¿æ¯ä¸ª FreeBSD ç‰ˆæœ¬å°½å¯èƒ½ç¨³å®šï¼Œä½†å¶å°”ä¼šå‡ºç°ä¸€äº›é”™è¯¯ã€‚åœ¨éå¸¸ç½•è§çš„æƒ…å†µä¸‹ï¼Œè¿™äº›é”™è¯¯ä¼šå½±å“å®‰è£…è¿‡ç¨‹ã€‚å½“è¿™äº›é—®é¢˜è¢«å‘ç°å¹¶ä¿®å¤æ—¶ï¼Œå®ƒä»¬ä¼šåœ¨æ¯ä¸ªç‰ˆæœ¬çš„ FreeBSD å‹˜è¯¯é¡µé¢ä¸­è¿›è¡Œè®°å½•ã€‚åœ¨å®‰è£…ä¹‹å‰ï¼Œè¯·æ£€æŸ¥å‹˜è¯¯é¡µé¢ï¼Œä»¥ç¡®ä¿æ²¡æœ‰å¯èƒ½å½±å“å®‰è£…çš„é—®é¢˜ã€‚Ù‰Information and errata for all the releases can be found on the link:https://www.FreeBSD.org/releases/[FreeBSD Release Information] page.ÙŠæ‰€æœ‰å‘å¸ƒç‰ˆæœ¬çš„ä¿¡æ¯å’Œå‹˜è¯¯è¡¨éƒ½å¯ä»¥åœ¨ link:https://www.FreeBSD.org/releases/[FreeBSD Release Information] é¡µé¢ä¸Šæ‰¾åˆ°ã€‚¾Prepare the Installation Media²å‡†å¤‡å®‰è£…ä»‹è´¨ÚThe FreeBSD installer is not an application that can be run from within another operating system.  Instead, download a FreeBSD installation file, burn it to the media associated with its file type and size (CD, DVD, or USB), and boot the system to install from the inserted media.ÚFreeBSD å®‰è£…ç¨‹åºä¸æ˜¯å¯ä»¥åœ¨å¦ä¸€ä¸ªæ“ä½œç³»ç»Ÿä¸­è¿è¡Œçš„åº”ç”¨ç¨‹åºã€‚ç›¸åï¼Œæ‚¨éœ€è¦ä¸‹è½½ä¸€ä¸ª FreeBSD å®‰è£…æ–‡ä»¶ï¼Œå°†å…¶åˆ»å½•åˆ°ä¸å…¶æ–‡ä»¶ç±»å‹å’Œå¤§å°ï¼ˆCDã€DVD æˆ– USBï¼‰ç›¸å…³è”çš„ä»‹è´¨ä¸Šï¼Œå¹¶ä»æ’å…¥çš„ä»‹è´¨å¯åŠ¨ç³»ç»Ÿä»¥è¿›è¡Œå®‰è£…ã€‚ÙÛFreeBSD installation files are available at the link:https://www.FreeBSD.org/where/[FreeBSD download page].  Each installation file's name includes the release version of FreeBSD, the architecture, and the type of file.Ù¸FreeBSD å®‰è£…æ–‡ä»¶å¯ä»¥åœ¨ link:https://www.FreeBSD.org/where/[FreeBSD ä¸‹è½½é¡µé¢] ä¸Šæ‰¾åˆ°ã€‚æ¯ä¸ªå®‰è£…æ–‡ä»¶çš„åç§°åŒ…æ‹¬ FreeBSD çš„å‘å¸ƒç‰ˆæœ¬ã€æ¶æ„å’Œæ–‡ä»¶ç±»å‹ã€‚Ù¤Installation files are available in several formats, compressed with man:xz[1] or uncompressed.  The formats vary depending on computer architecture and media type.Ù¡å®‰è£…æ–‡ä»¶æœ‰å¤šç§æ ¼å¼å¯ä¾›é€‰æ‹©ï¼Œå¯ä»¥ä½¿ç”¨ man:xz[1] è¿›è¡Œå‹ç¼©æˆ–è€…ä¸å‹ç¼©ã€‚è¿™äº›æ ¼å¼æ ¹æ®è®¡ç®—æœºæ¶æ„å’Œåª’ä½“ç±»å‹è€Œæœ‰æ‰€ä¸åŒã€‚¸Installation file types:µå®‰è£…æ–‡ä»¶ç±»å‹ï¼šÚ`*-bootonly.iso*`: This is the smallest installation file as it only contains the installer. A working Internet connection is required during installation as the installer will download the files it needs to complete the FreeBSD installation. This file should be burned to optical media.Ùõ`*-bootonly.iso*`ï¼šè¿™æ˜¯æœ€å°çš„å®‰è£…æ–‡ä»¶ï¼ŒåªåŒ…å«å®‰è£…ç¨‹åºã€‚åœ¨å®‰è£…è¿‡ç¨‹ä¸­éœ€è¦ä¸€ä¸ªå¯ç”¨çš„äº’è”ç½‘è¿æ¥ï¼Œå› ä¸ºå®‰è£…ç¨‹åºå°†ä¸‹è½½å®Œæˆ FreeBSD å®‰è£…æ‰€éœ€çš„æ–‡ä»¶ã€‚è¿™ä¸ªæ–‡ä»¶åº”è¯¥è¢«åˆ»å½•åˆ°å…‰ç›˜ä»‹è´¨ä¸Šã€‚Ù¡`*-disc1.iso*`: This file contains all of the files needed to install FreeBSD, its source, and the Ports Collection. This file should be burned to optical media.Ù¢`*-disc1.iso*`ï¼šè¿™ä¸ªæ–‡ä»¶åŒ…å«äº†å®‰è£… FreeBSD æ‰€éœ€çš„æ‰€æœ‰æ–‡ä»¶ï¼ŒåŒ…æ‹¬å…¶æºä»£ç å’Œ Ports é›†åˆã€‚è¿™ä¸ªæ–‡ä»¶åº”è¯¥è¢«åˆ»å½•åˆ°å…‰ç›˜ä»‹è´¨ä¸Šã€‚Ún`*-dvd1.iso*`: This file contains all of the files needed to install FreeBSD, its source, and the Ports Collection. It also contains a set of popular binary packages for installing a window manager and some applications so that a complete system can be installed from media without requiring a connection to the Internet. This file should be burned to optical media.ÚS`*-dvd1.iso*` ï¼šè¯¥æ–‡ä»¶åŒ…å«å®‰è£… FreeBSD æ‰€éœ€çš„æ‰€æœ‰æ–‡ä»¶ï¼ŒåŒ…æ‹¬å…¶æºä»£ç å’Œ Ports é›†åˆã€‚å®ƒè¿˜åŒ…å«ä¸€ç»„æµè¡Œçš„äºŒè¿›åˆ¶è½¯ä»¶åŒ…ï¼Œç”¨äºå®‰è£…çª—å£ç®¡ç†å™¨å’Œä¸€äº›åº”ç”¨ç¨‹åºï¼Œä»¥ä¾¿å¯ä»¥åœ¨æ²¡æœ‰è¿æ¥åˆ°äº’è”ç½‘çš„æƒ…å†µä¸‹ä»ä»‹è´¨ä¸Šå®‰è£…å®Œæ•´çš„ç³»ç»Ÿã€‚è¯¥æ–‡ä»¶åº”è¯¥è¢«åˆ»å½•åˆ°å…‰ç›˜ä»‹è´¨ä¸Šã€‚Ù¶`*-memstick.img*`: This file contains all of the files needed to install FreeBSD, its source, and the Ports Collection. Write this file to a USB stick as shown in <<bsdinstall-usb>>.ÙÁ`*-memstick.img*`ï¼šè¯¥æ–‡ä»¶åŒ…å«å®‰è£… FreeBSD æ‰€éœ€çš„æ‰€æœ‰æ–‡ä»¶ï¼ŒåŒ…æ‹¬å…¶æºä»£ç å’Œ Ports é›†åˆã€‚æŒ‰ç…§ <<bsdinstall-usb>> ä¸­æ‰€ç¤ºçš„æ–¹æ³•å°†è¯¥æ–‡ä»¶å†™å…¥ USB å­˜å‚¨è®¾å¤‡ã€‚Ùõ`*-mini-memstick.img*`: Like `*-bootonly.iso*`, does not include installation files, but downloads them as needed. A working internet connection is required during installation. It should be written to a USB stick as shown in <<bsdinstall-usb>>.Ùù`*-mini-memstick.img*`ï¼šä¸ `*-bootonly.iso*` ç±»ä¼¼ï¼Œä¸åŒ…å«å®‰è£…æ–‡ä»¶ï¼Œä½†ä¼šåœ¨éœ€è¦æ—¶è¿›è¡Œä¸‹è½½ã€‚åœ¨å®‰è£…è¿‡ç¨‹ä¸­éœ€è¦ä¸€ä¸ªå¯ç”¨çš„äº’è”ç½‘è¿æ¥ã€‚è¯·æŒ‰ç…§ <<bsdinstall-usb>> ä¸­æ‰€ç¤ºçš„æ–¹å¼å°†å…¶å†™å…¥ USB å­˜å‚¨è®¾å¤‡ã€‚Ú2After downloading the image file, download at least one _checksum_ file from the same directory.  There are two _checksum_ files available, named after the release number and the architecture name.  For example: `CHECKSUM.SHA256-FreeBSD-13.1-RELEASE-amd64` and `CHECKSUM.SHA512-FreeBSD-13.1-RELEASE-amd64`.Úåœ¨ä¸‹è½½é•œåƒæ–‡ä»¶åï¼Œä»ç›¸åŒç›®å½•ä¸‹è½½è‡³å°‘ä¸€ä¸ª _checksum_ æ–‡ä»¶ã€‚æœ‰ä¸¤ä¸ª _checksum_ æ–‡ä»¶å¯ç”¨ï¼Œåˆ†åˆ«ä»¥å‘å¸ƒç‰ˆæœ¬å·å’Œæ¶æ„åç§°å‘½åã€‚ä¾‹å¦‚ï¼š`CHECKSUM.SHA256-FreeBSD-13.1-RELEASE-amd64` å’Œ `CHECKSUM.SHA512-FreeBSD-13.1-RELEASE-amd64`ã€‚Ú¼After downloading one of the files (or both), calculate the _checksum_ for the image file and compare it with the one shown in the _checksum_ file.  Note that you need to compare the calculated _checksum_ against the correct file, as they correspond to two different algorithms: SHA256 and SHA512.  FreeBSD provides man:sha256[1] and man:sha512[1] that can be used for calculating the _checksum_.  Other operating systems have similar programs.ÚÄåœ¨ä¸‹è½½å…¶ä¸­ä¸€ä¸ªæ–‡ä»¶ï¼ˆæˆ–ä¸¤ä¸ªæ–‡ä»¶ï¼‰ä¹‹åï¼Œè®¡ç®—é•œåƒæ–‡ä»¶çš„ _æ ¡éªŒå’Œï¼ˆchecksumï¼‰_ å¹¶å°†å…¶ä¸ _checksum_ æ–‡ä»¶ä¸­æ˜¾ç¤ºçš„ _æ ¡éªŒå’Œ_ è¿›è¡Œæ¯”è¾ƒã€‚è¯·æ³¨æ„ï¼Œæ‚¨éœ€è¦å°†è®¡ç®—å‡ºçš„ _æ ¡éªŒå’Œ_ ä¸æ­£ç¡®çš„æ–‡ä»¶è¿›è¡Œæ¯”è¾ƒï¼Œå› ä¸ºå®ƒä»¬å¯¹åº”äºä¸¤ç§ä¸åŒçš„ç®—æ³•ï¼š SHA256 å’Œ SHA512ã€‚ FreeBSD æä¾›äº†å¯ä»¥ç”¨äºè®¡ç®— _æ ¡éªŒå’Œ_ çš„ man:sha256[1] å’Œ man:sha512[1]ã€‚å…¶ä»–æ“ä½œç³»ç»Ÿä¹Ÿæœ‰ç±»ä¼¼çš„ç¨‹åºã€‚ÙyVerifying the _checksum_ in FreeBSD can be done automatically using man:sha256sum[1] (and man:sha512sum[1]) by executing:Ùmåœ¨ FreeBSD ä¸­ï¼Œå¯ä»¥é€šè¿‡æ‰§è¡Œ man:sha256sum[1]ï¼ˆå’Œ man:sha512sum[1]ï¼‰æ¥è‡ªåŠ¨éªŒè¯ _æ ¡éªŒå’Œ_ã€‚ÙyThe checksums must match exactly.  If the checksums do not match, the image file is corrupt and must be downloaded again.Ùfæ ¡éªŒå’Œå¿…é¡»å®Œå…¨åŒ¹é…ã€‚å¦‚æœæ ¡éªŒå’Œä¸åŒ¹é…ï¼Œåˆ™å›¾åƒæ–‡ä»¶æŸåï¼Œå¿…é¡»é‡æ–°ä¸‹è½½ã€‚¼Writing an Image File to USB¹å°†é•œåƒæ–‡ä»¶å†™å…¥ USBÚThe `\*memstick.img` file is an _image_ of the complete contents of a memory stick.  It _cannot_ be copied to the target device as a file.  Several applications are available for writing the `*.img` to a USB stick.  This section describes two of these utilities.Ùß`\*memstick.img` æ–‡ä»¶æ˜¯ä¸€ä¸ªå†…å­˜æ£’çš„å®Œæ•´å†…å®¹çš„ `é•œåƒ`ã€‚å®ƒä¸èƒ½ä½œä¸ºæ–‡ä»¶å¤åˆ¶åˆ°ç›®æ ‡è®¾å¤‡ä¸Šã€‚æœ‰å‡ ä¸ªåº”ç”¨ç¨‹åºå¯ç”¨äºå°† `*.img` å†™å…¥ USB å†…å­˜æ£’ã€‚æœ¬èŠ‚ä»‹ç»å…¶ä¸­ä¸¤ä¸ªå®ç”¨ç¨‹åºã€‚ÙzBefore proceeding, back up any important data on the USB stick.  This procedure will erase the existing data on the stick.Ùiåœ¨ç»§ç»­ä¹‹å‰ï¼Œè¯·å¤‡ä»½ U ç›˜ä¸Šçš„ä»»ä½•é‡è¦æ•°æ®ã€‚æ­¤æ“ä½œå°†æ“¦é™¤ U ç›˜ä¸Šçš„ç°æœ‰æ•°æ®ã€‚Ù-*Procedure. Using `dd` to write the image* +
Ù**æ­¥éª¤ ä½¿ç”¨ `dd` å‘½ä»¤å†™å…¥é•œåƒ* +
ÙÔThis example uses `/dev/da0` as the target device where the image will be written.  Be *very careful* that the correct device is used as this command will destroy the existing data on the specified target device.ÙÁè¿™ä¸ªä¾‹å­ä½¿ç”¨ `/dev/da0` ä½œä¸ºç›®æ ‡è®¾å¤‡ï¼Œé•œåƒå°†è¢«å†™å…¥å…¶ä¸­ã€‚è¯· *éå¸¸å°å¿ƒ* ç¡®ä¿ä½¿ç”¨æ­£ç¡®çš„è®¾å¤‡ï¼Œå› ä¸ºè¿™ä¸ªå‘½ä»¤ä¼šç ´åæŒ‡å®šç›®æ ‡è®¾å¤‡ä¸Šçš„ç°æœ‰æ•°æ®ã€‚ÚiThe command-line utility is available on BSD, Linux(R), and Mac OS(R) systems. To burn the image using `dd`, insert the USB stick and determine its device name. Then, specify the name of the downloaded installation file and the device name for the USB stick. This example burns the amd64 installation image to the first USB device on an existing FreeBSD system.ÚBå‘½ä»¤è¡Œå®ç”¨ç¨‹åºå¯åœ¨ BSDã€Linux(R) å’Œ Mac OS(R) ç³»ç»Ÿä¸Šä½¿ç”¨ã€‚è¦ä½¿ç”¨ `dd` çƒ§å½•é•œåƒï¼Œè¯·æ’å…¥ USB é—ªå­˜å¹¶ç¡®å®šå…¶è®¾å¤‡åç§°ã€‚ç„¶åï¼ŒæŒ‡å®šä¸‹è½½çš„å®‰è£…æ–‡ä»¶çš„åç§°å’Œ USB é—ªå­˜çš„è®¾å¤‡åç§°ã€‚æ­¤ç¤ºä¾‹å°† amd64 å®‰è£…é•œåƒçƒ§å½•åˆ°ç°æœ‰çš„ FreeBSD ç³»ç»Ÿä¸Šçš„ç¬¬ä¸€ä¸ª USB è®¾å¤‡ã€‚ÙzIf this command fails, verify that the USB stick is not mounted and that the device name is for the disk, not a partition.Ùnå¦‚æœæ­¤å‘½ä»¤å¤±è´¥ï¼Œè¯·éªŒè¯ USB å­˜å‚¨è®¾å¤‡æ˜¯å¦æŒ‚è½½ï¼Œå¹¶ä¸”è®¾å¤‡åç§°æ˜¯ç£ç›˜è€Œä¸æ˜¯åˆ†åŒºã€‚Ú$Some operating systems might require this command to be run with man:sudo[8].  The man:dd[1] syntax varies slightly across different platforms; for example, Mac OS(R) requires a lower-case `bs=1m`.  Systems like Linux(R) might buffer writes.  To force all writes to complete, use man:sync[8].Ú5æŸäº›æ“ä½œç³»ç»Ÿå¯èƒ½éœ€è¦ä½¿ç”¨ man:sudo[8] å‘½ä»¤æ¥è¿è¡Œæ­¤å‘½ä»¤ã€‚man:dd[1] çš„è¯­æ³•åœ¨ä¸åŒçš„å¹³å°ä¸Šç•¥æœ‰ä¸åŒï¼›ä¾‹å¦‚ï¼ŒMac OS(R) éœ€è¦ä½¿ç”¨å°å†™çš„ `bs = 1m`ã€‚åƒ Linux(R) è¿™æ ·çš„ç³»ç»Ÿå¯èƒ½ä¼šç¼“å†²å†™å…¥æ“ä½œã€‚è¦å¼ºåˆ¶å®Œæˆæ‰€æœ‰å†™å…¥æ“ä½œï¼Œè¯·ä½¿ç”¨ man:sync[8] å‘½ä»¤ã€‚Ù3*Procedure. Using Windows(R) to Write the Image* +
Ù.* æ­¥éª¤ã€‚ä½¿ç”¨ Windows(R) å†™å…¥é•œåƒ * +
ÙwBe sure to give the correct drive letter as the existing data on the specified drive will be overwritten and destroyed.Ùiè¯·åŠ¡å¿…æä¾›æ­£ç¡®çš„é©±åŠ¨å™¨å­—æ¯ï¼Œå› ä¸ºæŒ‡å®šé©±åŠ¨å™¨ä¸Šçš„ç°æœ‰æ•°æ®å°†è¢«è¦†ç›–å’Œé”€æ¯ã€‚Ù(*Obtaining Image Writer for Windows(R)*
Ù(*è·å– Windows(R) çš„å›¾åƒå†™å…¥å™¨* 
ÙèImage Writer for Windows(R) is a free application that can correctly write an image file to a memory stick.  Download it from https://sourceforge.net/projects/win32diskimager/[win32diskimager home page] and extract it into a folder.ÙèImage Writer for Windows(R) æ˜¯ä¸€ä¸ªå…è´¹çš„åº”ç”¨ç¨‹åºï¼Œå¯ä»¥æ­£ç¡®åœ°å°†å›¾åƒæ–‡ä»¶å†™å…¥å­˜å‚¨å¡ã€‚ä» https://sourceforge.net/projects/win32diskimager/[win32diskimager ä¸»é¡µ] ä¸‹è½½å¹¶å°†å…¶è§£å‹åˆ°ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸­ã€‚Ù&*Writing the Image with Image Writer*
Ù(*ä½¿ç”¨ Writing the Image å†™å…¥é•œåƒ*
ÚÓDouble-click the Win32DiskImager icon to start the program.  Verify that the drive letter shown under `Device` is the drive with the memory stick.  Click the folder icon and select the image to be written to the memory stick.  Click btn:[Save] to accept the image file name.  Verify that everything is correct, and that no folders on the memory stick are open in other windows.  When everything is ready, click btn:[Write] to write the image file to the memory stick.Ú{åŒå‡» Win32DiskImager å›¾æ ‡å¯åŠ¨ç¨‹åºã€‚ç¡®ä¿åœ¨ `Device` ä¸‹æ˜¾ç¤ºçš„é©±åŠ¨å™¨å­—æ¯æ˜¯å­˜å‚¨å™¨çš„é©±åŠ¨å™¨ã€‚ç‚¹å‡»æ–‡ä»¶å¤¹å›¾æ ‡å¹¶é€‰æ‹©è¦å†™å…¥å­˜å‚¨å™¨çš„é•œåƒã€‚ç‚¹å‡» btn:[Save] æ¥å—é•œåƒæ–‡ä»¶åã€‚ç¡®è®¤ä¸€åˆ‡æ­£ç¡®ï¼Œå¹¶ä¸”å­˜å‚¨å™¨ä¸Šæ²¡æœ‰å…¶ä»–çª—å£ä¸­æ‰“å¼€çš„æ–‡ä»¶å¤¹ã€‚å½“ä¸€åˆ‡å‡†å¤‡å°±ç»ªæ—¶ï¼Œç‚¹å‡» btn:[Write] å°†é•œåƒæ–‡ä»¶å†™å…¥å­˜å‚¨å™¨ã€‚¹Starting the Installation¬å¼€å§‹å®‰è£…ÙcBy default, the installation will not make any changes to the disk(s) before the following message:ÙZé»˜è®¤æƒ…å†µä¸‹ï¼Œåœ¨ä»¥ä¸‹æ¶ˆæ¯ä¹‹å‰ï¼Œå®‰è£…ç¨‹åºä¸ä¼šå¯¹ç£ç›˜è¿›è¡Œä»»ä½•æ›´æ”¹ï¼šÙİThe install can be exited at any time prior to this warning.  If there is a concern that something is incorrectly configured, just turn the computer off before this point and no changes will be made to the system's disks.Ù¨åœ¨å‡ºç°æ­¤è­¦å‘Šä¹‹å‰ï¼Œå¯ä»¥éšæ—¶é€€å‡ºå®‰è£…ã€‚å¦‚æœæ‹…å¿ƒæŸäº›é…ç½®ä¸æ­£ç¡®ï¼Œåªéœ€åœ¨æ­¤ä¹‹å‰å…³é—­è®¡ç®—æœºï¼Œç³»ç»Ÿç£ç›˜å°†ä¸ä¼šè¿›è¡Œä»»ä½•æ›´æ”¹ã€‚Ú¯This section describes how to boot the system from the installation media which was prepared using the instructions in <<bsdinstall-installation-media>>.  When using a bootable USB stick, plug in the USB stick before turning on the computer.  When booting from CD or DVD, turn on the computer and insert the media at the first opportunity.  How to configure the system to boot from the inserted media depends upon the architecture.Úeæœ¬èŠ‚æè¿°äº†å¦‚ä½•ä»ä½¿ç”¨ <<bsdinstall-installation-media>> ä¸­çš„è¯´æ˜å‡†å¤‡çš„å®‰è£…ä»‹è´¨å¼•å¯¼ç³»ç»Ÿã€‚ä½¿ç”¨å¯å¯åŠ¨çš„ USB é—ªå­˜é©±åŠ¨å™¨æ—¶ï¼Œåœ¨æ‰“å¼€è®¡ç®—æœºä¹‹å‰æ’å…¥ USB é—ªå­˜é©±åŠ¨å™¨ã€‚ä» CD æˆ– DVD å¼•å¯¼æ—¶ï¼Œåº”åœ¨ç¬¬ä¸€æ—¶é—´æ‰“å¼€è®¡ç®—æœºå¹¶æ’å…¥ä»‹è´¨ã€‚å¦‚ä½•é…ç½®ç³»ç»Ÿä»¥ä»æ’å…¥çš„ä»‹è´¨å¼•å¯¼å–å†³äºä½“ç³»ç»“æ„ã€‚±FreeBSD Boot Menu´FreeBSD å¯åŠ¨èœå•ÙeOnce the system boots from the installation media, a menu similar to the following will be displayed:ÙEä¸€æ—¦ç³»ç»Ÿä»å®‰è£…ä»‹è´¨å¯åŠ¨ï¼Œå°†æ˜¾ç¤ºç±»ä¼¼ä»¥ä¸‹çš„èœå•ï¼š¸FreeBSD Boot Loader MenuÙ FreeBSD å¼•å¯¼åŠ è½½ç¨‹åºèœå•¸FreeBSD boot loader menuÙ FreeBSD å¼•å¯¼åŠ è½½ç¨‹åºèœå•ÚaBy default, the menu will wait ten seconds for user input before booting into the FreeBSD installer or, if FreeBSD is already installed, before booting into FreeBSD.  To pause the boot timer in order to review the selections, press kbd:[Space].  To select an option, press its highlighted number, character, or key.  The following options are available.ÚYé»˜è®¤æƒ…å†µä¸‹ï¼Œèœå•å°†åœ¨å¯åŠ¨ FreeBSD å®‰è£…ç¨‹åºä¹‹å‰ç­‰å¾…åç§’é’Ÿä»¥ç­‰å¾…ç”¨æˆ·è¾“å…¥ï¼Œæˆ–è€…å¦‚æœ FreeBSD å·²ç»å®‰è£…ï¼Œåˆ™åœ¨å¯åŠ¨ FreeBSD ä¹‹å‰ç­‰å¾…åç§’é’Ÿã€‚è¦æš‚åœå¯åŠ¨è®¡æ—¶å™¨ä»¥æŸ¥çœ‹é€‰æ‹©é¡¹ï¼Œè¯·æŒ‰ä¸‹ç©ºæ ¼é”®ã€‚è¦é€‰æ‹©ä¸€ä¸ªé€‰é¡¹ï¼Œè¯·æŒ‰ä¸‹å…¶çªå‡ºæ˜¾ç¤ºçš„æ•°å­—ã€å­—ç¬¦æˆ–é”®ã€‚ä»¥ä¸‹é€‰é¡¹å¯ç”¨ã€‚ÙŸ`Boot Multi User`: This will continue the FreeBSD boot process. If the boot timer has been paused, press kbd:[1], upper- or lower-case kbd:[B], or kbd:[Enter].Ù¿`å¯åŠ¨å¤šç”¨æˆ·æ¨¡å¼ï¼ˆBoot Multi Userï¼‰`ï¼šè¿™å°†ç»§ç»­ FreeBSD çš„å¯åŠ¨è¿‡ç¨‹ã€‚å¦‚æœå¯åŠ¨è®¡æ—¶å™¨å·²ç»æš‚åœï¼Œè¯·æŒ‰ä¸‹ kbd:[1]ã€å¤§å†™æˆ–å°å†™çš„ kbd:[B] æˆ– kbd:[Enter] é”®ã€‚ÙŞ`Boot Single User`: This mode can be used to fix an existing FreeBSD installation as described in crossref:boot[boot-singleuser,â€œSingle-User Modeâ€]. Press kbd:[2] or the upper- or lower-case kbd:[S] to enter this mode.Ùó`å•ç”¨æˆ·å¯åŠ¨ï¼ˆBoot Single Userï¼‰`: è¿™ç§æ¨¡å¼å¯ä»¥ç”¨äºä¿®å¤å·²æœ‰çš„ FreeBSD å®‰è£…ï¼Œå¦‚ crossref:boot[boot-singleuser ,â€å•ç”¨æˆ·æ¨¡å¼â€œ] ä¸­æ‰€è¿°ã€‚æŒ‰ä¸‹é”®ç›˜ä¸Šçš„ kbd:[2] æˆ–å¤§å†™æˆ–å°å†™çš„ kbd:[S] è¿›å…¥æ­¤æ¨¡å¼ã€‚Ùş`Escape to loader prompt`: This will boot the system into a repair prompt that contains a limited number of low-level commands. This prompt is described in crossref:boot[boot-loader,â€œStage Threeâ€]. Press kbd:[3] or kbd:[Esc] to boot into this prompt.Ú`è¿›å…¥åŠ è½½å™¨æç¤ºç¬¦ï¼ˆEscape to loader promptï¼‰`: è¿™å°†ä½¿ç³»ç»Ÿå¯åŠ¨åˆ°ä¸€ä¸ªåŒ…å«æœ‰é™æ•°é‡ä½çº§å‘½ä»¤çš„ä¿®å¤æç¤ºç¬¦ã€‚è¯¥æç¤ºç¬¦åœ¨ crossref:boot[boot-loader,â€œStage Threeâ€] ä¸­æœ‰æè¿°ã€‚æŒ‰ä¸‹ kbd:[3] æˆ– kbd:[Esc] é”®è¿›å…¥è¯¥æç¤ºç¬¦ã€‚½`Reboot`: Reboots the system.Ù `Reboot`ï¼šé‡æ–°å¯åŠ¨ç³»ç»Ÿã€‚Ùr`Cons`: Allow to continue the installation by `video`, `serial`, `Dual (serial primary)` or `Dual (Video primary)`Ù‘`Cons`: å…è®¸é€šè¿‡ `è§†é¢‘ï¼ˆvideoï¼‰`ã€`ä¸²å£ï¼ˆserialï¼‰`ã€`åŒä¸²å£ï¼ˆä¸²å£ä¸ºä¸»ï¼‰` æˆ– `åŒè§†é¢‘ï¼ˆè§†é¢‘ä¸ºä¸»ï¼‰` ç»§ç»­å®‰è£…ã€‚Ù#`Kernel`: Loads a different kernel.Ù(`Kernel`: åŠ è½½ä¸€ä¸ªä¸åŒçš„å†…æ ¸ã€‚Ù_`Boot Options`: Opens the menu shown in, and described under, <<bsdinstall-boot-options-menu>>.Ùv`å¼•å¯¼é€‰é¡¹ï¼ˆBoot Optionsï¼‰` ï¼šæ‰“å¼€èœå•ï¼Œè¯¥èœå•åœ¨ <<bsdinstall-boot-options-menu>> ä¸­æ˜¾ç¤ºå¹¶æè¿°ã€‚¹FreeBSD Boot Options MenuºFreeBSD å¯åŠ¨é€‰é¡¹èœå•Ù1Menu showing the different boot options supportedÙ*æ˜¾ç¤ºæ”¯æŒçš„ä¸åŒå¯åŠ¨é€‰é¡¹çš„èœå•ÚAfter the keymaps have been loaded, bsdinstall displays the menu shown in <<bsdinstall-keymap-10>>.  Use the up and down arrows to select the keymap that most closely represents the mapping of the keyboard attached to the system.  Press kbd:[Enter] to save the selection.ÙÕåœ¨åŠ è½½äº†é”®ä½æ˜ å°„ä¹‹åï¼Œ bsdinstall ä¼šæ˜¾ç¤ºå¦‚ <<bsdinstall-keymap-10>> æ‰€ç¤ºçš„èœå•ã€‚ä½¿ç”¨ä¸Šä¸‹ç®­å¤´é€‰æ‹©æœ€æ¥è¿‘ç³»ç»Ÿè¿æ¥çš„é”®ç›˜æ˜ å°„çš„é”®ä½æ˜ å°„ã€‚æŒ‰ä¸‹ kbd:[Enter] ä¿å­˜é€‰æ‹©ã€‚µKeymap Selection Menu¸æŒ‰é”®æ˜ å°„é€‰æ‹©èœå•Ù5Keymap selection menu showing all supported keyboardsÙ6æ˜¾ç¤ºæ‰€æœ‰æ”¯æŒçš„é”®ç›˜çš„æŒ‰é”®æ˜ å°„é€‰æ‹©èœå•Ù´Pressing kbd:[Esc] will exit this menu and use the default keymap.  If the choice of keymap is not clear, [.guimenuitem]#United States of America ISO-8859-1# is also a safe option.Ù´æŒ‰ä¸‹ kbd:[Esc] å°†é€€å‡ºæ­¤èœå•å¹¶ä½¿ç”¨é»˜è®¤é”®æ˜ å°„ã€‚å¦‚æœé”®æ˜ å°„çš„é€‰æ‹©ä¸æ˜ç¡®ï¼Œ[.guimenuitem]#United States of America ISO-8859-1# ä¹Ÿæ˜¯ä¸€ä¸ªå®‰å…¨çš„é€‰é¡¹ã€‚Ù¢In addition, when selecting a different keymap, the user can try the keymap and ensure it is correct before proceeding, as shown in <<bsdinstall-keymap-testing>>.Ù”æ­¤å¤–ï¼Œåœ¨é€‰æ‹©ä¸åŒçš„é”®ç›˜æ˜ å°„æ—¶ï¼Œç”¨æˆ·å¯ä»¥åœ¨ç»§ç»­ä¹‹å‰å°è¯•å¹¶ç¡®ä¿å®ƒæ˜¯æ­£ç¡®çš„ï¼Œå¦‚ <<bsdinstall-keymap-testing>> æ‰€ç¤ºã€‚³Keymap Testing Menu¸æŒ‰é”®æ˜ å°„æµ‹è¯•èœå•³Keymap testing menu¸æŒ‰é”®æ˜ å°„æµ‹è¯•èœå•´Setting the Hostname¯è®¾ç½®ä¸»æœºåÙTThe next bsdinstall menu is used to set the hostname for the newly installed system.ÙEä¸‹ä¸€ä¸ª bsdinstall èœå•ç”¨äºè®¾ç½®æ–°å®‰è£…ç³»ç»Ÿçš„ä¸»æœºåã€‚´Setting the hostname¯è®¾ç½®ä¸»æœºåÙ|Type in a hostname that is unique for the network.  It should be a fully-qualified hostname, such as `machine3.example.com`.Ù{è¾“å…¥ä¸€ä¸ªåœ¨ç½‘ç»œä¸­å”¯ä¸€çš„ä¸»æœºåã€‚å®ƒåº”è¯¥æ˜¯ä¸€ä¸ªå®Œå…¨åˆæ ¼çš„ä¸»æœºåï¼Œä¾‹å¦‚ `machine3.example.com` ã€‚¿Selecting Components to Install¸é€‰æ‹©è¦å®‰è£…çš„ç»„ä»¶ÙFNext, bsdinstall will prompt to select optional components to install.ÙBæ¥ä¸‹æ¥ï¼Œ bsdinstall å°†æç¤ºé€‰æ‹©è¦å®‰è£…çš„å¯é€‰ç»„ä»¶ã€‚Ù=Different components that can be installed. Example: base-dbgÙ/å¯ä»¥å®‰è£…çš„ä¸åŒç»„ä»¶ã€‚ç¤ºä¾‹ï¼šbase-dbgÚ,Deciding which components to install will depend largely on the intended use of the system and the amount of disk space available.  The FreeBSD kernel and userland, collectively known as the _base system_, are always installed.  Depending on the architecture, some of these components may not appear:Ùíå†³å®šå®‰è£…å“ªäº›ç»„ä»¶å°†ä¸»è¦å–å†³äºç³»ç»Ÿçš„é¢„æœŸç”¨é€”å’Œå¯ç”¨çš„ç£ç›˜ç©ºé—´ã€‚ FreeBSD å†…æ ¸å’Œç”¨æˆ·ç©ºé—´ï¼Œç»Ÿç§°ä¸ºâ€œåŸºæœ¬ç³»ç»Ÿâ€ï¼Œå§‹ç»ˆä¼šè¢«å®‰è£…ã€‚æ ¹æ®æ¶æ„çš„ä¸åŒï¼Œå…¶ä¸­ä¸€äº›ç»„ä»¶å¯èƒ½ä¸ä¼šå‡ºç°ï¼šÙY`base-dbg` - Base tools like cat and ls, among many others, with debug symbols activated.Ù^`base-dbg` - åŸºæœ¬å·¥å…·ï¼Œå¦‚ cat å’Œ ls ç­‰ï¼Œå…¶ä¸­åŒ…å«å¯ç”¨äº†è°ƒè¯•ç¬¦å·çš„å·¥å…·ã€‚Ù?`kernel-dbg` - Kernel and modules with debug symbols activated.Ù9`kernel-dbg` - å¯ç”¨äº†è°ƒè¯•ç¬¦å·çš„å†…æ ¸å’Œæ¨¡å—ã€‚Ù‚`lib32-dbg` - Compatibility libraries for running 32-bit applications on a 64-bit version of FreeBSD with debug symbols activated.Ùg`lib32-dbg` - åœ¨å¯ç”¨è°ƒè¯•ç¬¦å·çš„ 64 ä½ FreeBSD ç‰ˆæœ¬ä¸Šè¿è¡Œ 32 ä½åº”ç”¨ç¨‹åºçš„å…¼å®¹åº“ã€‚Ùa`lib32` - Compatibility libraries for running 32-bit applications on a 64-bit version of FreeBSD.ÙT`lib32` - åœ¨ 64 ä½ç‰ˆæœ¬çš„ FreeBSD ä¸Šè¿è¡Œ 32 ä½åº”ç”¨ç¨‹åºçš„å…¼å®¹æ€§åº“ã€‚Ú
`ports` - The FreeBSD Ports Collection is a collection of files which automates the downloading, compiling and installation of third-party software packages. crossref:ports[ports,Installing Applications: Packages and Ports] discusses how to use the Ports Collection.ÙÖ`ports` - FreeBSD Ports Collection æ˜¯ä¸€ç»„æ–‡ä»¶ï¼Œç”¨äºè‡ªåŠ¨ä¸‹è½½ã€ç¼–è¯‘å’Œå®‰è£…ç¬¬ä¸‰æ–¹è½¯ä»¶åŒ…ã€‚ crossref:ports[ports,å®‰è£…åº”ç”¨ç¨‹åºï¼šè½¯ä»¶åŒ…å’Œ Ports] è®¨è®ºäº†å¦‚ä½•ä½¿ç”¨ Ports Collectionã€‚ÙÎThe installation program does not check for adequate disk space.  Select this option only if sufficient hard disk space is available.  The FreeBSD Ports Collection takes up about {ports-size} of disk space.Ù­å®‰è£…ç¨‹åºä¸ä¼šæ£€æŸ¥ç£ç›˜ç©ºé—´æ˜¯å¦è¶³å¤Ÿã€‚åªæœ‰åœ¨æœ‰è¶³å¤Ÿçš„ç¡¬ç›˜ç©ºé—´æ—¶æ‰é€‰æ‹©æ­¤é€‰é¡¹ã€‚ FreeBSD Ports é›†åˆå¤§çº¦å ç”¨ {ports-size} çš„ç£ç›˜ç©ºé—´ã€‚Ú¢`src` - The complete FreeBSD source code for both the kernel and the userland. Although not required for the majority of applications, it may be required to build device drivers, kernel modules, or some applications from the Ports Collection. It is also used for developing FreeBSD itself. The full source tree requires 1 GB of disk space and recompiling the entire FreeBSD system requires an additional 5 GB of space.Úv`src` - åŒ…å« FreeBSD å†…æ ¸å’Œç”¨æˆ·ç©ºé—´çš„å®Œæ•´æºä»£ç ã€‚è™½ç„¶å¤§å¤šæ•°åº”ç”¨ç¨‹åºä¸éœ€è¦å®ƒï¼Œä½†åœ¨æ„å»ºè®¾å¤‡é©±åŠ¨ç¨‹åºã€å†…æ ¸æ¨¡å—æˆ–ä» Ports Collection ä¸­æ„å»ºæŸäº›åº”ç”¨ç¨‹åºæ—¶å¯èƒ½éœ€è¦å®ƒã€‚å®ƒè¿˜ç”¨äºå¼€å‘ FreeBSD æœ¬èº«ã€‚å®Œæ•´çš„æºä»£ç æ ‘éœ€è¦ 1 GB çš„ç£ç›˜ç©ºé—´ï¼Œé‡æ–°ç¼–è¯‘æ•´ä¸ª FreeBSD ç³»ç»Ÿéœ€è¦é¢å¤–çš„ 5 GB ç©ºé—´ã€‚½`tests` - FreeBSD Test Suite.Ù!`tests` - FreeBSD æµ‹è¯•å¥—ä»¶ã€‚»Installing from the Network¯ä»ç½‘ç»œå®‰è£…ÚÛThe menu shown in <<bsdinstall-netinstall-notify>> only appears when installing from a `-bootonly.iso` or `-mini-memstick.img`, as this installation media does not hold copies of the installation files.  Since the installation files must be retrieved over a network connection, this menu indicates that the network interface must be configured first.  If this menu is shown in any step of the process, remember to follow the instructions in <<bsdinstall-config-network-dev>>.Ú§åœ¨ <<bsdinstall-netinstall-notify>> ä¸­æ˜¾ç¤ºçš„èœå•åªä¼šåœ¨ä» `-bootonly.iso` æˆ– `-mini-memstick.img` è¿›è¡Œå®‰è£…æ—¶å‡ºç°ï¼Œå› ä¸ºè¿™ç§å®‰è£…ä»‹è´¨ä¸ä¿å­˜å®‰è£…æ–‡ä»¶çš„å‰¯æœ¬ã€‚ç”±äºå®‰è£…æ–‡ä»¶å¿…é¡»é€šè¿‡ç½‘ç»œè¿æ¥è·å–ï¼Œæ‰€ä»¥è¯¥èœå•è¡¨ç¤ºå¿…é¡»å…ˆé…ç½®ç½‘ç»œæ¥å£ã€‚å¦‚æœåœ¨è¿‡ç¨‹çš„ä»»ä½•æ­¥éª¤ä¸­æ˜¾ç¤ºäº†è¯¥èœå•ï¼Œè¯·è®°ä½æŒ‰ç…§ <<bsdinstall-config-network-dev>> ä¸­çš„è¯´æ˜è¿›è¡Œæ“ä½œã€‚Ù_Indicates that certain components have not been found and will be downloaded using the network.Ù?è¡¨ç¤ºæŸäº›ç»„ä»¶æœªæ‰¾åˆ°ï¼Œå¹¶å°†ä½¿ç”¨ç½‘ç»œè¿›è¡Œä¸‹è½½ã€‚µAllocating Disk Space²åˆ†é…ç£ç›˜ç©ºé—´ÙHThe next menu is used to determine the method for allocating disk space.Ù9ä¸‹ä¸€ä¸ªèœå•ç”¨äºç¡®å®šåˆ†é…ç£ç›˜ç©ºé—´çš„æ–¹æ³•ã€‚´Partitioning Choices¬åˆ†åŒºé€‰æ‹©Ù6Shows the different partition options. Example: ManualÙ-æ˜¾ç¤ºä¸åŒçš„åˆ†åŒºé€‰é¡¹ã€‚ç¤ºä¾‹ï¼šManualÙAbsdinstall gives the user four methods for allocating disk space:ÙAbsdinstall ä¸ºç”¨æˆ·æä¾›äº†å››ç§åˆ†é…ç£ç›˜ç©ºé—´çš„æ–¹æ³•ï¼šÙu`Auto (ZFS)` partitioning creates a root-on-ZFS system with optional GELI encryption support for _boot environments_.Ùi`Auto (ZFS)` åˆ†åŒºåˆ›å»ºä¸€ä¸ªåŸºäº ZFS çš„ç³»ç»Ÿï¼Œå¯é€‰æ‹©æ”¯æŒ GELI åŠ å¯†ç”¨äº _å¼•å¯¼ç¯å¢ƒ_ã€‚Ù``Auto (UFS)` partitioning automatically sets up the disk partitions using the `UFS` file system.ÙS`Auto (UFS)` åˆ†åŒºæ˜¯ä½¿ç”¨ `UFS` æ–‡ä»¶ç³»ç»Ÿè‡ªåŠ¨è®¾ç½®ç£ç›˜åˆ†åŒºçš„åŠŸèƒ½ã€‚Ù^`Manual` partitioning allows advanced users to create customized partitions from menu options.ÙK`Manual` åˆ†åŒºå…è®¸é«˜çº§ç”¨æˆ·é€šè¿‡èœå•é€‰é¡¹åˆ›å»ºè‡ªå®šä¹‰åˆ†åŒºã€‚Ù¥`Shell` opens a shell prompt where advanced users can create customized partitions using command-line utilities like man:gpart[8], man:fdisk[8], and man:bsdlabel[8].ÙŸ`Shell` æ‰“å¼€ä¸€ä¸ª shell æç¤ºç¬¦ï¼Œé«˜çº§ç”¨æˆ·å¯ä»¥ä½¿ç”¨å‘½ä»¤è¡Œå·¥å…·ï¼ˆå¦‚ man:gpart[8]ã€man:fdisk[8] å’Œ man:bsdlabel[8]ï¼‰åˆ›å»ºè‡ªå®šä¹‰åˆ†åŒºã€‚Ù‘This section describes what to consider when laying out the disk partitions.  It then demonstrates how to use the different partitioning methods.Ùræœ¬èŠ‚æè¿°äº†åœ¨å¸ƒç½®ç£ç›˜åˆ†åŒºæ—¶éœ€è¦è€ƒè™‘çš„äº‹é¡¹ã€‚ç„¶åæ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨ä¸åŒçš„åˆ†åŒºæ–¹æ³•ã€‚¾Designing the Partition Layout²è®¾è®¡åˆ†åŒºå¸ƒå±€ÚjThe default partition layout for file systems includes one file system for the entire system.  When using `UFS` it may be worth considering the use of multiple file systems if you have sufficient disk space or multiple disks.  When laying out file systems, remember that hard drives transfer data faster from the outer tracks to the inner.  Thus, smaller and heavier-accessed file systems should be closer to the outside of the drive, while larger partitions like `/usr` should be placed toward the inner parts of the disk.  It is a good idea to create partitions in an order similar to: `/`, swap, `/var`, and `/usr`.Ú)æ–‡ä»¶ç³»ç»Ÿçš„é»˜è®¤åˆ†åŒºå¸ƒå±€åŒ…æ‹¬ä¸€ä¸ªç”¨äºæ•´ä¸ªç³»ç»Ÿçš„æ–‡ä»¶ç³»ç»Ÿã€‚å½“ä½¿ç”¨ `UFS` æ—¶ï¼Œå¦‚æœæ‚¨æœ‰è¶³å¤Ÿçš„ç£ç›˜ç©ºé—´æˆ–å¤šä¸ªç£ç›˜ï¼Œè€ƒè™‘ä½¿ç”¨å¤šä¸ªæ–‡ä»¶ç³»ç»Ÿå¯èƒ½æ˜¯å€¼å¾—çš„ã€‚åœ¨å¸ƒç½®æ–‡ä»¶ç³»ç»Ÿæ—¶ï¼Œè¯·è®°ä½ç¡¬ç›˜ä»å¤–éƒ¨è½¨é“åˆ°å†…éƒ¨ä¼ è¾“æ•°æ®é€Ÿåº¦æ›´å¿«ã€‚å› æ­¤ï¼Œè¾ƒå°ä¸”è®¿é—®é¢‘ç‡è¾ƒé«˜çš„æ–‡ä»¶ç³»ç»Ÿåº”è¯¥é è¿‘é©±åŠ¨å™¨çš„å¤–éƒ¨ï¼Œè€Œåƒ `/usr` è¿™æ ·çš„è¾ƒå¤§åˆ†åŒºåº”è¯¥æ”¾ç½®åœ¨ç£ç›˜çš„å†…éƒ¨éƒ¨åˆ†ã€‚æŒ‰ç…§ç±»ä¼¼çš„é¡ºåºåˆ›å»ºåˆ†åŒºæ˜¯ä¸€ä¸ªå¥½ä¸»æ„ï¼š `/` ã€äº¤æ¢ç©ºé—´ã€`/var` å’Œ `/usr`ã€‚ÚfThe size of the `/var` partition reflects the intended machine's usage.  This partition is used to hold mailboxes, log files, and printer spools.  Mailboxes and log files can grow to unexpected sizes depending on the number of users and how long log files are kept.  On average, most users rarely need more than about a gigabyte of free disk space in `/var`.ÚX`/var` åˆ†åŒºçš„å¤§å°åæ˜ äº†é¢„æœŸæœºå™¨çš„ä½¿ç”¨æƒ…å†µã€‚è¯¥åˆ†åŒºç”¨äºå­˜å‚¨é‚®ç®±ã€æ—¥å¿—æ–‡ä»¶å’Œæ‰“å°æœºé˜Ÿåˆ—ã€‚æ ¹æ®ç”¨æˆ·æ•°é‡å’Œæ—¥å¿—æ–‡ä»¶ä¿ç•™æ—¶é—´çš„é•¿çŸ­ï¼Œé‚®ç®±å’Œæ—¥å¿—æ–‡ä»¶çš„å¤§å°å¯èƒ½ä¼šå‡ºä¹æ„æ–™åœ°å¢é•¿ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œå¤§å¤šæ•°ç”¨æˆ·åœ¨ `/var` åˆ†åŒºä¸­å¾ˆå°‘éœ€è¦è¶…è¿‡ 1GB çš„å¯ç”¨ç£ç›˜ç©ºé—´ã€‚Ú,Sometimes, a lot of disk space is required in `/var/tmp`.  When new software is installed, the packaging tools extract a temporary copy of the packages under `/var/tmp`.  Large software packages, like Firefox or LibreOffice may be tricky to install if there is not enough disk space under `/var/tmp`.Ú!æœ‰æ—¶ï¼Œåœ¨ `/var/tmp` ç›®å½•ä¸‹éœ€è¦å¤§é‡çš„ç£ç›˜ç©ºé—´ã€‚å½“å®‰è£…æ–°è½¯ä»¶æ—¶ï¼Œæ‰“åŒ…å·¥å…·ä¼šåœ¨ `/var/tmp` ç›®å½•ä¸‹æå–è½¯ä»¶åŒ…çš„ä¸´æ—¶å‰¯æœ¬ã€‚å¦‚æœ `/var/tmp` ç›®å½•ä¸‹çš„ç£ç›˜ç©ºé—´ä¸è¶³ï¼Œå®‰è£…å¤§å‹è½¯ä»¶åŒ…ï¼ˆå¦‚ Firefox æˆ– LibreOffice ï¼‰å¯èƒ½ä¼šå˜å¾—æ£˜æ‰‹ã€‚ÚyThe `/usr` partition holds many of the files which support the system, including the FreeBSD Ports Collection and system source code.  At least 2 gigabytes of space is recommended for this partition.  Also, note that home directories for users are placed in `/usr/home` by default, but can be placed on another partition.  By default, `/home` is a symbolic link to `/usr/home`.ÚT`/usr` åˆ†åŒºå­˜æ”¾ç€è®¸å¤šæ”¯æŒç³»ç»Ÿçš„æ–‡ä»¶ï¼ŒåŒ…æ‹¬ FreeBSD Ports Collection å’Œç³»ç»Ÿæºä»£ç ã€‚å»ºè®®ä¸ºè¿™ä¸ªåˆ†åŒºæä¾›è‡³å°‘ 2GB çš„ç©ºé—´ã€‚æ­¤å¤–ï¼Œè¯·æ³¨æ„ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œç”¨æˆ·çš„å®¶ç›®å½•ä½äº `/usr/home` ï¼Œä½†ä¹Ÿå¯ä»¥æ”¾åœ¨å¦ä¸€ä¸ªåˆ†åŒºä¸Šã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œ `/home` æ˜¯æŒ‡å‘ `/usr/home` çš„ç¬¦å·é“¾æ¥ã€‚Ù—When selecting partition sizes, keep the space requirements in mind.  Running out of space in one partition while barely using another can be a hassle.Ùåœ¨é€‰æ‹©åˆ†åŒºå¤§å°æ—¶ï¼Œè¯·è€ƒè™‘ç©ºé—´éœ€æ±‚ã€‚åœ¨ä¸€ä¸ªåˆ†åŒºä¸­ç©ºé—´ä¸è¶³ï¼Œè€Œå¦ä¸€ä¸ªåˆ†åŒºå‡ ä¹æœªä½¿ç”¨å¯èƒ½ä¼šå¸¦æ¥éº»çƒ¦ã€‚ÚQAs a rule of thumb, the swap partition should be about double the size of physical memory (RAM).  Systems with minimal RAM (less for larger-memory configurations) may perform better with more swap.  Configuring too little swap can lead to inefficiencies in the VM page scanning code and might create issues later if more memory is added.Ú_ä½œä¸ºä¸€ä¸ªç»éªŒæ³•åˆ™ï¼Œäº¤æ¢åˆ†åŒºçš„å¤§å°åº”è¯¥æ˜¯ç‰©ç†å†…å­˜ï¼ˆRAMï¼‰çš„ä¸¤å€å·¦å³ã€‚å…·æœ‰è¾ƒå°å†…å­˜çš„ç³»ç»Ÿï¼ˆå¯¹äºè¾ƒå¤§å†…å­˜é…ç½®æ¥è¯´æ›´å°‘ï¼‰å¯èƒ½åœ¨æœ‰æ›´å¤šäº¤æ¢ç©ºé—´æ—¶æ€§èƒ½æ›´å¥½ã€‚é…ç½®è¿‡å°‘çš„äº¤æ¢ç©ºé—´å¯èƒ½å¯¼è‡´è™šæ‹Ÿå†…å­˜é¡µé¢æ‰«æä»£ç çš„ä½æ•ˆï¼Œå¹¶ä¸”å¦‚æœæ·»åŠ æ›´å¤šå†…å­˜åå¯èƒ½ä¼šå¼•å‘é—®é¢˜ã€‚Ú
On larger systems with multiple SCSI disks or multiple IDE disks operating on different controllers, it is recommended that swap be configured on each drive, up to four drives.  The swap partitions should be approximately the same size.  The kernel can handle arbitrary sizes, but internal data structures scale to 4 times the largest swap partition.  Keeping the swap partitions near the same size will allow the kernel to optimally stripe swap space across disks.  Large swap sizes may elicit a kernel warning message about the total configured swap.  The limit is raised by increasing the amount of memory allowed for keeping track of swap allocations, as instructed by the warning message.  It might be easier to recover from a runaway program before being forced to reboot.Ú±åœ¨å…·æœ‰å¤šä¸ª SCSI ç£ç›˜æˆ–å¤šä¸ªåœ¨ä¸åŒæ§åˆ¶å™¨ä¸Šè¿è¡Œçš„ IDE ç£ç›˜çš„è¾ƒå¤§ç³»ç»Ÿä¸Šï¼Œå»ºè®®åœ¨æ¯ä¸ªé©±åŠ¨å™¨ä¸Šé…ç½®äº¤æ¢ç©ºé—´ï¼Œæœ€å¤šå››ä¸ªé©±åŠ¨å™¨ã€‚äº¤æ¢åˆ†åŒºçš„å¤§å°åº”è¯¥å¤§è‡´ç›¸åŒã€‚å†…æ ¸å¯ä»¥å¤„ç†ä»»æ„å¤§å°ï¼Œä½†å†…éƒ¨æ•°æ®ç»“æ„ä¼šæŒ‰ç…§æœ€å¤§äº¤æ¢åˆ†åŒºçš„ 4 å€è¿›è¡Œæ‰©å±•ã€‚ä¿æŒäº¤æ¢åˆ†åŒºçš„å¤§å°æ¥è¿‘ç›¸åŒï¼Œå¯ä»¥è®©å†…æ ¸ä»¥æœ€ä½³æ–¹å¼åœ¨ä¸åŒç£ç›˜é—´æ¡å¸¦åŒ–äº¤æ¢ç©ºé—´ã€‚è¾ƒå¤§çš„äº¤æ¢å¤§å°å¯èƒ½ä¼šå¼•å‘æœ‰å…³æ€»é…ç½®äº¤æ¢çš„å†…æ ¸è­¦å‘Šæ¶ˆæ¯ã€‚é€šè¿‡å¢åŠ ç”¨äºè·Ÿè¸ªäº¤æ¢åˆ†é…çš„å†…å­˜é‡æ¥æé«˜é™åˆ¶ï¼Œå¦‚è­¦å‘Šæ¶ˆæ¯æ‰€æŒ‡ç¤ºçš„é‚£æ ·ã€‚åœ¨è¢«è¿«é‡æ–°å¯åŠ¨ä¹‹å‰ï¼Œä»å¤±æ§çš„ç¨‹åºä¸­æ¢å¤å¯èƒ½æ›´å®¹æ˜“ã€‚ÚäBy properly partitioning a system, fragmentation introduced in the smaller write-heavy partitions will not bleed over into the mostly read partitions.  Keeping the write-loaded partitions closer to the disk's edge will increase I/O performance in the partitions where it occurs the most.  While I/O performance in the larger partitions may be needed, shifting them more toward the edge of the disk will not lead to a significant performance improvement over moving `/var` to the edge.Úké€šè¿‡æ­£ç¡®åœ°åˆ†åŒºç³»ç»Ÿï¼Œè¾ƒå°çš„å†™å…¥å¯†é›†åˆ†åŒºå¼•å…¥çš„ç¢ç‰‡ä¸ä¼šæ³¢åŠåˆ°ä¸»è¦è¯»å–åˆ†åŒºã€‚å°†å†™å…¥è´Ÿè½½è¾ƒé‡çš„åˆ†åŒºä¿æŒåœ¨ç£ç›˜è¾¹ç¼˜é™„è¿‘ï¼Œå°†æé«˜åœ¨è¿™äº›åˆ†åŒºä¸­å‘ç”Ÿçš„ I/O æ€§èƒ½ã€‚è™½ç„¶å¯èƒ½éœ€è¦è¾ƒå¤§åˆ†åŒºçš„ I/O æ€§èƒ½ï¼Œä½†å°†å®ƒä»¬æ›´é è¿‘ç£ç›˜è¾¹ç¼˜ä¸ä¼šæ¯”å°† `/var` ç§»åŠ¨åˆ°è¾¹ç¼˜å¸¦æ¥æ˜¾è‘—çš„æ€§èƒ½æ”¹å–„ã€‚½Guided Partitioning Using UFS½ä½¿ç”¨ UFS è¿›è¡Œå¼•å¯¼åˆ†åŒºÙ›When this method is selected, a menu will display the available disk(s).  If multiple disks are connected, choose the one where FreeBSD is to be installed.Ù~å½“é€‰æ‹©æ­¤æ–¹æ³•æ—¶ï¼Œèœå•å°†æ˜¾ç¤ºå¯ç”¨çš„ç£ç›˜ã€‚å¦‚æœè¿æ¥äº†å¤šä¸ªç£ç›˜ï¼Œè¯·é€‰æ‹©è¦å®‰è£… FreeBSD çš„ç£ç›˜ã€‚½Selecting from Multiple Disks¾ä»å¤šä¸ªç£ç›˜ä¸­è¿›è¡Œé€‰æ‹©Ù9Shows the list of disks on which FreeBSD can be installedÙ*æ˜¾ç¤ºå¯ä»¥å®‰è£… FreeBSD çš„ç£ç›˜åˆ—è¡¨ÚFOnce the disk is selected, the next menu prompts to install to either the entire disk or to create a partition using free space.  If btn:[Entire Disk] is chosen, a general partition layout filling the whole disk is automatically created.  Selecting btn:[Partition] creates a partition layout from the unused space on the disk.Ú&é€‰æ‹©ç£ç›˜åï¼Œä¸‹ä¸€ä¸ªèœå•ä¼šæç¤ºé€‰æ‹©æ˜¯å°†æ•´ä¸ªç£ç›˜å®‰è£…ï¼Œè¿˜æ˜¯ä½¿ç”¨å¯ç”¨ç©ºé—´åˆ›å»ºåˆ†åŒºã€‚å¦‚æœé€‰æ‹© btn:[Entire Disk] ï¼Œå°†è‡ªåŠ¨åˆ›å»ºä¸€ä¸ªå¡«æ»¡æ•´ä¸ªç£ç›˜çš„é€šç”¨åˆ†åŒºå¸ƒå±€ã€‚é€‰æ‹© btn:[Partition] å°†ä»ç£ç›˜ä¸Šæœªä½¿ç”¨çš„ç©ºé—´åˆ›å»ºä¸€ä¸ªåˆ†åŒºå¸ƒå±€ã€‚Ù"Selecting Entire Disk or Partition»é€‰æ‹©æ•´ä¸ªç£ç›˜æˆ–åˆ†åŒºÙhMenu asking the user if he wants to use all the available space on the disk or wants to make a partitionÙ`èœå•è¯¢é—®ç”¨æˆ·æ˜¯å¦æƒ³è¦ä½¿ç”¨ç£ç›˜ä¸Šçš„æ‰€æœ‰å¯ç”¨ç©ºé—´ï¼Œè¿˜æ˜¯æƒ³è¦è¿›è¡Œåˆ†åŒºã€‚ÙsAfter the btn:[Entire Disk] option is chosen, bsdinstall displays a dialog indicating that the disk will be erased.Ùcé€‰æ‹© btn:[Entire Disk] é€‰é¡¹åï¼Œbsdinstall ä¼šæ˜¾ç¤ºä¸€ä¸ªå¯¹è¯æ¡†ï¼ŒæŒ‡ç¤ºå°†æ“¦é™¤ç£ç›˜ã€‚¬Confirmation¦ç¡®è®¤Ù^Menu indicating the user that all data on the disk will be deleted and asking for confirmationÙKèœå•æç¤ºç”¨æˆ·æ‰€æœ‰ç£ç›˜ä¸Šçš„æ•°æ®å°†è¢«åˆ é™¤ï¼Œå¹¶è¦æ±‚ç¡®è®¤ã€‚ÚRThe next menu shows a list with the available partition scheme types.  GPT is usually the most appropriate choice for amd64 computers.  Older computers that are not compatible with GPT should use MBR.  The other partition schemes are generally used for uncommon or older computers.  More information is available in <<partition-schemes>>.Ú%ä¸‹ä¸€ä¸ªèœå•æ˜¾ç¤ºäº†å¯ç”¨çš„åˆ†åŒºæ–¹æ¡ˆç±»å‹åˆ—è¡¨ã€‚å¯¹äº amd64 è®¡ç®—æœºæ¥è¯´ï¼Œ GPT é€šå¸¸æ˜¯æœ€åˆé€‚çš„é€‰æ‹©ã€‚ä¸å…¼å®¹ GPT çš„æ—§è®¡ç®—æœºåº”è¯¥ä½¿ç”¨ MBRã€‚å…¶ä»–åˆ†åŒºæ–¹æ¡ˆé€šå¸¸ç”¨äºä¸å¸¸è§æˆ–è¾ƒæ—§çš„è®¡ç®—æœºã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜… <<partition-schemes>> ã€‚·Select Partition Scheme²é€‰æ‹©åˆ†åŒºæ–¹æ¡ˆÙjMenu showing the user the different the different types of partition that exist and requesting one of themÙNèœå•æ˜¾ç¤ºç”¨æˆ·å­˜åœ¨çš„ä¸åŒç±»å‹çš„åˆ†åŒºï¼Œå¹¶è¦æ±‚é€‰æ‹©å…¶ä¸­ä¹‹ä¸€Ú’After the partition layout has been created, review it to ensure it meets the needs of the installation.  Selecting btn:[Revert] will reset the partitions to their original values. Pressing btn:[Auto] will recreate the automatic FreeBSD partitions.  Partitions can also be manually created, modified, or deleted.  When the partitioning is correct, select btn:[Finish] to continue with the installation.Ú9åœ¨åˆ›å»ºåˆ†åŒºå¸ƒå±€ä¹‹åï¼Œè¯·è¿›è¡Œå®¡æ ¸ä»¥ç¡®ä¿å®ƒæ»¡è¶³å®‰è£…çš„éœ€æ±‚ã€‚é€‰æ‹© btn:[Revert] å°†é‡ç½®åˆ†åŒºä¸ºå…¶åŸå§‹å€¼ã€‚æŒ‰ä¸‹ btn:[Auto] å°†é‡æ–°åˆ›å»ºè‡ªåŠ¨çš„ FreeBSD åˆ†åŒºã€‚åˆ†åŒºä¹Ÿå¯ä»¥æ‰‹åŠ¨åˆ›å»ºã€ä¿®æ”¹æˆ–åˆ é™¤ã€‚å½“åˆ†åŒºè®¾ç½®æ­£ç¡®æ—¶ï¼Œè¯·é€‰æ‹© btn:[Finish] ç»§ç»­è¿›è¡Œå®‰è£…ã€‚¹Review Created Partitions¸å®¡æŸ¥å·²åˆ›å»ºçš„åˆ†åŒº¿Menu showing created partitions¾æ˜¾ç¤ºå·²åˆ›å»ºåˆ†åŒºçš„èœå•ÚlOnce the disks are configured, the next menu provides the last chance to make changes before the selected drives are formatted.  If changes need to be made, select btn:[Back] to return to the main partitioning menu.  btn:[Revert & Exit] exits the installer without making any changes to the drive.  Otherwise, select btn:[Commit] to start the installation process.ÚDä¸€æ—¦ç£ç›˜é…ç½®å®Œæˆï¼Œä¸‹ä¸€ä¸ªèœå•æä¾›äº†åœ¨é€‰æ‹©çš„é©±åŠ¨å™¨æ ¼å¼åŒ–ä¹‹å‰è¿›è¡Œæ›´æ”¹çš„æœ€åæœºä¼šã€‚å¦‚æœéœ€è¦è¿›è¡Œæ›´æ”¹ï¼Œè¯·é€‰æ‹© btn:[è¿”å›] è¿”å›åˆ°ä¸»åˆ†åŒºèœå•ã€‚ btn:[è¿˜åŸå’Œé€€å‡º] é€€å‡ºå®‰è£…ç¨‹åºï¼Œä¸å¯¹é©±åŠ¨å™¨è¿›è¡Œä»»ä½•æ›´æ”¹ã€‚å¦åˆ™ï¼Œé€‰æ‹© btn:[æäº¤] å¼€å§‹å®‰è£…è¿‡ç¨‹ã€‚²Final Confirmation¬æœ€ç»ˆç¡®è®¤Ù Menu indicating to the user that all changes will be written to disk and informing that if he decides to continue the existing data will be permanently deleted.Ù{èœå•å‘ç”¨æˆ·æŒ‡ç¤ºæ‰€æœ‰æ›´æ”¹å°†è¢«å†™å…¥ç£ç›˜ï¼Œå¹¶å‘ŠçŸ¥å¦‚æœç”¨æˆ·å†³å®šç»§ç»­ï¼Œç°æœ‰æ•°æ®å°†è¢«æ°¸ä¹…åˆ é™¤ã€‚ÙVTo continue with the installation process, go to <<bsdinstall-fetching-distribution>>.ÙJè¦ç»§ç»­å®‰è£…è¿‡ç¨‹ï¼Œè¯·è½¬åˆ° <<bsdinstall-fetching-distribution>> ã€‚³Manual Partitioning¬æ‰‹åŠ¨åˆ†åŒºÙ1Selecting this method opens the partition editor:Ù*é€‰æ‹©æ­¤æ–¹æ³•å°†æ‰“å¼€åˆ†åŒºç¼–è¾‘å™¨ï¼šºManually Create Partitions²æ‰‹åŠ¨åˆ›å»ºåˆ†åŒºÙ"Menu showing the Partition Editor.Ù!æ˜¾ç¤ºåˆ†åŒºç¼–è¾‘å™¨çš„èœå•ã€‚ÙƒHighlight the installation drive (`ada0` in this example) and select btn:[Create] to display a menu of available partition schemes:Ù~é«˜äº®æ˜¾ç¤ºå®‰è£…é©±åŠ¨å™¨ï¼ˆåœ¨æ­¤ç¤ºä¾‹ä¸­ä¸º `ada0`ï¼‰ï¼Œç„¶åé€‰æ‹© btn:[Create] ä»¥æ˜¾ç¤ºå¯ç”¨åˆ†åŒºæ–¹æ¡ˆçš„èœå•ï¼šÙ4Menu showing the different kind of partition schemesÙ*èœå•æ˜¾ç¤ºäº†ä¸åŒç±»å‹çš„åˆ†åŒºæ–¹æ¡ˆÙÒGPT is usually the most appropriate choice for amd64 computers.  Older computers that are not compatible with GPT should use MBR.  The other partition schemes are generally used for uncommon or older computers.ÙGPT é€šå¸¸æ˜¯ amd64 è®¡ç®—æœºçš„æœ€åˆé€‚é€‰æ‹©ã€‚ä¸å…¼å®¹ GPT çš„æ—§è®¡ç®—æœºåº”ä½¿ç”¨ MBRã€‚å…¶ä»–åˆ†åŒºæ–¹æ¡ˆé€šå¸¸ç”¨äºä¸å¸¸è§æˆ–è¾ƒæ—§çš„è®¡ç®—æœºã€‚´Partitioning Schemes¬åˆ†åŒºæ–¹æ¡ˆ¬Abbreviation¦ç¼©å†™Ù(Apple Partition Map, used by PowerPC(R).Ù.Apple Partition Mapï¼Œç”± PowerPC(R) ä½¿ç”¨ã€‚ÙwBSD label without an MBR, sometimes called _dangerously dedicated mode_ as non-BSD disk utilities may not recognize it.Ùuæ²¡æœ‰ MBR çš„ BSD æ ‡ç­¾ï¼Œæœ‰æ—¶è¢«ç§°ä¸º _å±é™©ä¸“ç”¨æ¨¡å¼_ï¼Œå› ä¸ºé BSD ç£ç›˜å·¥å…·å¯èƒ½æ— æ³•è¯†åˆ«å®ƒã€‚ÙNlink:https://en.wikipedia.org/wiki/GUID_Partition_Table[GUID Partition Table].ÙKlink:https://en.wikipedia.org/wiki/GUID_Partition_Table[GUID åˆ†åŒºè¡¨] ã€‚ÙJlink:https://en.wikipedia.org/wiki/Master_boot_record[Master Boot Record].ÙJlink:https://en.wikipedia.org/wiki/Master_boot_record[ä¸»å¼•å¯¼è®°å½•] ã€‚ÙğAfter the partitioning scheme has been selected and created, select btn:[Create] again to create the partitions.  The kbd:[Tab] key is used to give focus to the fields (after cycling through btn:[<OK>], btn:[<Options>], and btn:[<Cancel>]).ÙĞåœ¨é€‰æ‹©å’Œåˆ›å»ºåˆ†åŒºæ–¹æ¡ˆä¹‹åï¼Œå†æ¬¡é€‰æ‹© btn:[Create] æ¥åˆ›å»ºåˆ†åŒºã€‚ä½¿ç”¨ kbd:[Tab] é”®å°†ç„¦ç‚¹æ”¾åœ¨å­—æ®µä¸Šï¼ˆåœ¨å¾ªç¯é€šè¿‡ btn:[<OK>] ã€ btn:[<Options>] å’Œ btn:[<Cancel>] ä¹‹åï¼‰ã€‚´Menu requesting type²è¯·æ±‚ç±»å‹èœå•Ù`A standard FreeBSD GPT installation uses at least three partitions, including either UFS or ZFS:ÙYæ ‡å‡†çš„ FreeBSD GPT å®‰è£…è‡³å°‘ä½¿ç”¨ä¸‰ä¸ªåˆ†åŒºï¼Œå…¶ä¸­åŒ…æ‹¬ UFS æˆ– ZFS ä¹‹ä¸€ï¼šÙ6`freebsd-boot` or `efi` - Holds the FreeBSD boot code.Ù?`freebsd-boot` æˆ– `efi` - å­˜æ”¾ç€ FreeBSD çš„å¼•å¯¼ä»£ç ã€‚Ù*`freebsd-ufs` - A FreeBSD UFS file system.Ù2`freebsd-ufs` - ä¸€ä¸ª FreeBSD UFS æ–‡ä»¶ç³»ç»Ÿã€‚Ù€`freebsd-zfs` - A FreeBSD ZFS file system. More information about ZFS is available in crossref:zfs[zfs,The Z File System (ZFS)].ÙŠ`freebsd-zfs` - ä¸€ä¸ª FreeBSD çš„ ZFS æ–‡ä»¶ç³»ç»Ÿã€‚æœ‰å…³ ZFS çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜… crossref:zfs[zfs,Z æ–‡ä»¶ç³»ç»Ÿï¼ˆZFSï¼‰] ã€‚Ù$`freebsd-swap` - FreeBSD swap space.Ù(`freebsd-swap` - FreeBSD äº¤æ¢ç©ºé—´ã€‚ÙLRefer to man:gpart[8] for descriptions of the available GPT partition types.ÙEè¯·å‚è€ƒ man:gpart[8]ï¼Œäº†è§£å¯ç”¨çš„ GPT åˆ†åŒºç±»å‹çš„æè¿°ã€‚Ù•Multiple file system partitions can be created. Some people prefer a traditional layout with separate partitions for `/`, `/var`, `/tmp`, and `/usr`.Ùå¯ä»¥åˆ›å»ºå¤šä¸ªæ–‡ä»¶ç³»ç»Ÿåˆ†åŒºã€‚æœ‰äº›äººå–œæ¬¢ä¼ ç»Ÿçš„å¸ƒå±€ï¼Œå°† `/`ã€`/var`ã€`/tmp` å’Œ `/usr` åˆ†åˆ«æ”¾åœ¨ä¸åŒçš„åˆ†åŒºä¸­ã€‚ÙsNote that `/tmp` can be added later as a memory-based file system (man:tmpfs[5]) on systems with sufficient memory.Ù}è¯·æ³¨æ„ï¼Œåœ¨å…·æœ‰è¶³å¤Ÿå†…å­˜çš„ç³»ç»Ÿä¸Šï¼Œå¯ä»¥å°† `/tmp` ä½œä¸ºåŸºäºå†…å­˜çš„æ–‡ä»¶ç³»ç»Ÿï¼ˆman:tmpfs[5]ï¼‰æ·»åŠ ã€‚Ù6See <<bsdinstall-part-manual-splitfs>> for an example.Ù<è¯·å‚è€ƒ <<bsdinstall-part-manual-splitfs>> ä¸­çš„ç¤ºä¾‹ã€‚ÙpThe `Size` may be entered with common abbreviations: _K_ for kilobytes, _M_ for megabytes, or _G_ for gigabytes.Ùs`Size` å¯ä»¥ä½¿ç”¨å¸¸è§çš„ç¼©å†™è¿›è¡Œè¾“å…¥ï¼š_K_ è¡¨ç¤ºåƒå­—èŠ‚ï¼Œ_M_ è¡¨ç¤ºå…†å­—èŠ‚ï¼Œ_G_ è¡¨ç¤ºå‰å­—èŠ‚ã€‚ÚËProper sector alignment provides the best performance, and making partition sizes even multiples of 4K bytes helps to ensure alignment on drives with either 512-byte or 4K-byte sectors.  Generally, using partition sizes that are even multiples of 1M or 1G is the easiest way to make sure every partition starts at an even multiple of 4K.  There is one exception: the _freebsd-boot_ partition should be no larger than 512K due to current boot code limitations.Úæ­£ç¡®çš„æ‰‡åŒºå¯¹é½å¯ä»¥æä¾›æœ€ä½³æ€§èƒ½ï¼Œå°†åˆ†åŒºå¤§å°è®¾ç½®ä¸º 4K å­—èŠ‚çš„å€æ•°æœ‰åŠ©äºç¡®ä¿åœ¨å…·æœ‰ 512 å­—èŠ‚æˆ– 4K å­—èŠ‚æ‰‡åŒºçš„é©±åŠ¨å™¨ä¸Šè¿›è¡Œå¯¹é½ã€‚é€šå¸¸ï¼Œä½¿ç”¨ 1M æˆ– 1G çš„å€æ•°ä½œä¸ºåˆ†åŒºå¤§å°æ˜¯ç¡®ä¿æ¯ä¸ªåˆ†åŒºä» 4K çš„å€æ•°å¼€å§‹çš„æœ€ç®€å•æ–¹æ³•ã€‚æœ‰ä¸€ä¸ªä¾‹å¤–ï¼šç”±äºå½“å‰å¼•å¯¼ä»£ç çš„é™åˆ¶ï¼Œ_freebsd-boot_ åˆ†åŒºçš„å¤§å°ä¸åº”è¶…è¿‡ 512K ã€‚Ù”A `Mountpoint` is needed if the partition will contain a file system.  If only a single UFS partition will be created, the mountpoint should be `/`.Ù€å¦‚æœåˆ†åŒºå°†åŒ…å«æ–‡ä»¶ç³»ç»Ÿï¼Œåˆ™éœ€è¦ä¸€ä¸ª `Mountpoint` ã€‚å¦‚æœåªåˆ›å»ºä¸€ä¸ª UFS åˆ†åŒºï¼Œåˆ™æŒ‚è½½ç‚¹åº”ä¸º `/`ã€‚ÚThe `Label` is a name by which the partition will be known.  Drive names or numbers can change if the drive is connected to a different controller or port, but the partition label does not change.  Referring to labels instead of drive names and partition numbers in files like `/etc/fstab` makes the system more tolerant to hardware changes.  GPT labels appear in `/dev/gpt/` when a disk is attached.  Other partitioning schemes have different label capabilities and their labels appear in different directories in `/dev/`.ÚÑ`Label` æ˜¯åˆ†åŒºçš„åç§°ã€‚å¦‚æœé©±åŠ¨å™¨è¿æ¥åˆ°ä¸åŒçš„æ§åˆ¶å™¨æˆ–ç«¯å£ï¼Œé©±åŠ¨å™¨åç§°æˆ–ç¼–å·å¯èƒ½ä¼šå‘ç”Ÿå˜åŒ–ï¼Œä½†åˆ†åŒºæ ‡ç­¾ä¸ä¼šæ”¹å˜ã€‚åœ¨åƒ `/etc/fstab` è¿™æ ·çš„æ–‡ä»¶ä¸­ä½¿ç”¨æ ‡ç­¾è€Œä¸æ˜¯é©±åŠ¨å™¨åç§°å’Œåˆ†åŒºç¼–å·ï¼Œå¯ä»¥ä½¿ç³»ç»Ÿæ›´å®¹å¿ç¡¬ä»¶å˜åŒ–ã€‚å½“è¿æ¥äº†ç£ç›˜æ—¶ï¼ŒGPT æ ‡ç­¾ä¼šå‡ºç°åœ¨ `/dev/gpt/` ä¸­ã€‚å…¶ä»–åˆ†åŒºæ–¹æ¡ˆå…·æœ‰ä¸åŒçš„æ ‡ç­¾åŠŸèƒ½ï¼Œå®ƒä»¬çš„æ ‡ç­¾ä¼šå‡ºç°åœ¨ `/dev/` ä¸­çš„ä¸åŒç›®å½•ä¸­ã€‚ÚUse a unique label on every partition to avoid conflicts from identical labels.  A few letters from the computer's name, use, or location can be added to the label.  For instance, use `labroot` or `rootfslab` for the UFS root partition on the computer named `lab`.Úåœ¨æ¯ä¸ªåˆ†åŒºä¸Šä½¿ç”¨å”¯ä¸€çš„æ ‡ç­¾ï¼Œä»¥é¿å…ç›¸åŒæ ‡ç­¾å¼•èµ·çš„å†²çªã€‚å¯ä»¥åœ¨æ ‡ç­¾ä¸­æ·»åŠ è®¡ç®—æœºåç§°ã€ç”¨é€”æˆ–ä½ç½®çš„å‡ ä¸ªå­—æ¯ã€‚ä¾‹å¦‚ï¼Œå¯¹äºåä¸º `lab` çš„è®¡ç®—æœºä¸Šçš„ UFS æ ¹åˆ†åŒºï¼Œå¯ä»¥ä½¿ç”¨ `labroot` æˆ– `rootfslab` ä½œä¸ºæ ‡ç­¾ã€‚Ù1Creating Traditional Split File System PartitionsÙ'åˆ›å»ºä¼ ç»Ÿçš„åˆ†å‰²æ–‡ä»¶ç³»ç»Ÿåˆ†åŒºÚêFor a traditional partition layout where the `/`, `/var`, `/tmp`, and `/usr` directories are separate file systems on their own partitions, create a GPT partitioning scheme, then create the partitions as shown.  Partition sizes shown are typical for a 20G target disk.  If more space is available on the target disk, larger swap or `/var` partitions may be useful.  Labels shown here are prefixed with `ex` for "example", but readers should use other unique label values as described above.Ú¿å¯¹äºä¼ ç»Ÿçš„åˆ†åŒºå¸ƒå±€ï¼Œå…¶ä¸­ `/`ã€`/var`ã€`/tmp` å’Œ `/usr` ç›®å½•æ˜¯å„è‡ªç‹¬ç«‹çš„æ–‡ä»¶ç³»ç»Ÿï¼Œåˆ›å»ºä¸€ä¸ª GPT åˆ†åŒºæ–¹æ¡ˆï¼Œç„¶åæŒ‰ç…§æ‰€ç¤ºåˆ›å»ºåˆ†åŒºã€‚æ‰€ç¤ºçš„åˆ†åŒºå¤§å°é€‚ç”¨äº 20G ç›®æ ‡ç£ç›˜ã€‚å¦‚æœç›®æ ‡ç£ç›˜ä¸Šæœ‰æ›´å¤šçš„ç©ºé—´ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨æ›´å¤§çš„äº¤æ¢ç©ºé—´æˆ– `/var` åˆ†åŒºã€‚è¿™é‡Œæ˜¾ç¤ºçš„æ ‡ç­¾ä»¥ `ex` ä¸ºå‰ç¼€ï¼Œè¡¨ç¤º"ç¤ºä¾‹"ï¼Œä½†è¯»è€…åº”æ ¹æ®ä¸Šè¿°è¯´æ˜ä½¿ç”¨å…¶ä»–å”¯ä¸€çš„æ ‡ç­¾å€¼ã€‚ÙXBy default, FreeBSD's `gptboot` expects the first UFS partition to be the `/` partition.ÙSé»˜è®¤æƒ…å†µä¸‹ï¼ŒFreeBSD çš„ `gptboot` æœŸæœ›ç¬¬ä¸€ä¸ª UFS åˆ†åŒºæ˜¯ `/` åˆ†åŒºã€‚®Partition Type¬åˆ†åŒºç±»å‹¤Size¦å¤§å°ªMountpoint©æŒ‚è½½ç‚¹¥Label¦æ ‡ç­¾¨`exswap`¡`Ù*accept the default (remainder of the disk)Ù6æ¥å—é»˜è®¤é€‰é¡¹ï¼ˆä½¿ç”¨ç£ç›˜çš„å‰©ä½™ç©ºé—´ï¼‰ã€‚Ù”After the custom partitions have been created, select btn:[Finish] to continue with the installation and go to <<bsdinstall-fetching-distribution>>.Ùpåœ¨åˆ›å»ºè‡ªå®šä¹‰åˆ†åŒºåï¼Œé€‰æ‹© btn:[Finish] ç»§ç»­å®‰è£…å¹¶è½¬åˆ° <<bsdinstall-fetching-distribution>> ã€‚Ù%Guided Partitioning Using Root-on-ZFSÙ%ä½¿ç”¨ Root-on-ZFS è¿›è¡Œå¼•å¯¼åˆ†åŒºÙÃThis partitioning mode only works with whole disks and will erase the contents of the entire disk.  The main ZFS configuration menu offers a number of options to control the creation of the pool.Ù›è¿™ç§åˆ†åŒºæ¨¡å¼åªé€‚ç”¨äºæ•´ä¸ªç£ç›˜ï¼Œå¹¶ä¸”ä¼šæ“¦é™¤æ•´ä¸ªç£ç›˜çš„å†…å®¹ã€‚ä¸»è¦çš„ ZFS é…ç½®èœå•æä¾›äº†ä¸€äº›é€‰é¡¹æ¥æ§åˆ¶æ± çš„åˆ›å»ºã€‚µZFS Partitioning Menu°ZFS åˆ†åŒºèœå•Ù<Menu showing the different options to configure the ZFS poolÙ,æ˜¾ç¤ºé…ç½® ZFS æ± çš„ä¸åŒé€‰é¡¹çš„èœå•Ù.Here is a summary of the options in this menu:Ù$è¿™æ˜¯è¯¥èœå•ä¸­é€‰é¡¹çš„æ‘˜è¦ï¼šÙD`Install` - Proceed with the installation with the selected options.Ù9`å®‰è£…ï¼ˆInstallï¼‰` - ä½¿ç”¨æ‰€é€‰é€‰é¡¹ç»§ç»­å®‰è£…ã€‚Ú4`Pool Type/Disks` - Configure the `Pool Type` and the disk(s) that will constitute the pool. The automatic ZFS installer currently only supports the creation of a single top level vdev, except in stripe mode. To create more complex pools, use the instructions in <<bsdinstall-part-shell>> to create the pool.Ú` æ± ç±»å‹åŠç£ç›˜ï¼ˆPool Type/Disksï¼‰` - é…ç½® `æ± ç±»å‹` å’Œç»„æˆæ± çš„ç£ç›˜ã€‚è‡ªåŠ¨ ZFS å®‰è£…ç¨‹åºç›®å‰åªæ”¯æŒåˆ›å»ºå•ä¸ªé¡¶çº§ vdevï¼Œé™¤éæ˜¯ stripe æ¨¡å¼ã€‚è¦åˆ›å»ºæ›´å¤æ‚çš„æ± ï¼Œè¯·ä½¿ç”¨ <<bsdinstall-part-shell>> ä¸­çš„è¯´æ˜æ¥åˆ›å»ºæ± ã€‚Ù:`Rescan Devices` - Repopulate the list of available disks.ÙL`é‡æ–°æ‰«æè®¾å¤‡ï¼ˆRescan Devicesï¼‰` - é‡æ–°å¡«å……å¯ç”¨ç£ç›˜åˆ—è¡¨ã€‚Ù¶`Disk Info` - This menu can be used to inspect each disk, including its partition table and various other information such as the device model number and serial number, if available.Ù¡`ç£ç›˜ä¿¡æ¯ï¼ˆDisk Infoï¼‰` - æ­¤èœå•å¯ç”¨äºæ£€æŸ¥æ¯ä¸ªç£ç›˜ï¼ŒåŒ…æ‹¬å…¶åˆ†åŒºè¡¨å’Œå…¶ä»–å„ç§ä¿¡æ¯ï¼Œå¦‚è®¾å¤‡å‹å·å’Œåºåˆ—å·ï¼ˆå¦‚æœå¯ç”¨ï¼‰ã€‚ÙJ`Pool Name` - Establish the name of the pool. The default name is _zroot_.ÙM`æ± åç§°ï¼ˆPool Nameï¼‰` - è®¾ç½®æ± çš„åç§°ã€‚é»˜è®¤åç§°ä¸º  _zroot_ã€‚Úà`Force 4K Sectors?` - Force the use of 4K sectors. By default, the installer will automatically create partitions aligned to 4K boundaries and force ZFS to use 4K sectors. This is safe even with 512 byte sector disks, and has the added benefit of ensuring that pools created on 512 byte disks will be able to have 4K sector disks added in the future, either as additional storage space or as replacements for failed disks. Press the kbd:[Enter] key to chose to activate it or not.Úì`å¼ºåˆ¶ä½¿ç”¨ 4K æ‰‡åŒºï¼ˆForce 4K Sectorsï¼‰ï¼Ÿ` - å¼ºåˆ¶ä½¿ç”¨ 4K æ‰‡åŒºã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå®‰è£…ç¨‹åºå°†è‡ªåŠ¨åˆ›å»ºä¸ 4K è¾¹ç•Œå¯¹é½çš„åˆ†åŒºï¼Œå¹¶å¼ºåˆ¶ ZFS ä½¿ç”¨ 4K æ‰‡åŒºã€‚å³ä½¿æ˜¯ 512 å­—èŠ‚æ‰‡åŒºçš„ç£ç›˜ï¼Œè¿™ä¹Ÿæ˜¯å®‰å…¨çš„ï¼Œå¹¶ä¸”è¿˜æœ‰ä¸€ä¸ªé¢å¤–çš„å¥½å¤„ï¼Œå³ç¡®ä¿åœ¨å°†æ¥å¯ä»¥å°† 4K æ‰‡åŒºç£ç›˜æ·»åŠ åˆ°åœ¨ 512 å­—èŠ‚ç£ç›˜ä¸Šåˆ›å»ºçš„æ± ä¸­ï¼Œæ— è®ºæ˜¯ä½œä¸ºé¢å¤–çš„å­˜å‚¨ç©ºé—´è¿˜æ˜¯ä½œä¸ºæ›¿æ¢å¤±è´¥çš„ç£ç›˜ã€‚æŒ‰ä¸‹ kbd:[Enter] é”®é€‰æ‹©æ˜¯å¦æ¿€æ´»å®ƒã€‚Ú`Encrypt Disks?` - Encrypting the disks allows the user to encrypt the disks using GELI. More information about disk encryption is available in crossref:disks[disks-encrypting-geli,â€œDisk Encryption with geliâ€]. Press the kbd:[Enter] key to choose whether to activate it or not.Ú`åŠ å¯†ç£ç›˜ï¼ˆEncrypt Disksï¼‰ï¼Ÿ` - åŠ å¯†ç£ç›˜å…è®¸ç”¨æˆ·ä½¿ç”¨ GELI å¯¹ç£ç›˜è¿›è¡ŒåŠ å¯†ã€‚æœ‰å…³ç£ç›˜åŠ å¯†çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜… crossref:disks[disks-encrypting-geli,â€œä½¿ç”¨ geli è¿›è¡Œç£ç›˜åŠ å¯†â€]ã€‚æŒ‰ä¸‹ kbd:[Enter] é”®é€‰æ‹©æ˜¯å¦æ¿€æ´»å®ƒã€‚Ù `Partition Scheme` - Choose the partition scheme. GPT is the recommended option in most cases. Press the kbd:[Enter] key to chose between the different options.Ùª`åˆ†åŒºæ–¹æ¡ˆï¼ˆPartition Schemeï¼‰` - é€‰æ‹©åˆ†åŒºæ–¹æ¡ˆã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼ŒGPT æ˜¯æ¨èçš„é€‰é¡¹ã€‚æŒ‰ä¸‹ kbd:[Enter] é”®æ¥åœ¨ä¸åŒé€‰é¡¹ä¹‹é—´è¿›è¡Œé€‰æ‹©ã€‚Ù1`Swap Size` - Establish the amount of swap space.ÙD`äº¤æ¢ç©ºé—´å¤§å°ï¼ˆSwap Sizeï¼‰` - è®¾ç½®äº¤æ¢ç©ºé—´çš„å¤§å°ã€‚Ùª`Mirror Swap?` - Whether to mirror the swap between the disks. Be aware that enabling mirror swap will break crash dumps. Press the kbd:[Enter] key to activate it or not.ÙË`é•œåƒäº¤æ¢åˆ†åŒºï¼ˆMirror Swapï¼‰ï¼Ÿ` - æ˜¯å¦åœ¨ç£ç›˜ä¹‹é—´è¿›è¡Œäº¤æ¢åˆ†åŒºçš„é•œåƒã€‚è¯·æ³¨æ„ï¼Œå¯ç”¨é•œåƒäº¤æ¢åˆ†åŒºå°†ä¼šç ´åå´©æºƒè½¬å‚¨ã€‚æŒ‰ä¸‹ kbd:[Enter] é”®æ¥æ¿€æ´»æˆ–ä¸æ¿€æ´»ã€‚Ú1`Encrypt Swap?` - Whether to encrypt the swap. This will encrypt the swap with a temporary key each time the system boots, and discards it on reboot. Press the kbd:[Enter] key to choose to activate it or not. More information about swap encryption in crossref:disks[swap-encrypting,â€œEncrypting Swapâ€].ÚI`åŠ å¯†äº¤æ¢ç©ºé—´ï¼ˆEncrypt Swapï¼‰ï¼Ÿ` - æ˜¯å¦åŠ å¯†äº¤æ¢ç©ºé—´ã€‚è¿™å°†åœ¨æ¯æ¬¡ç³»ç»Ÿå¯åŠ¨æ—¶ä½¿ç”¨ä¸´æ—¶å¯†é’¥åŠ å¯†äº¤æ¢ç©ºé—´ï¼Œå¹¶åœ¨é‡æ–°å¯åŠ¨æ—¶ä¸¢å¼ƒå®ƒã€‚æŒ‰ä¸‹ kbd:[Enter] é”®é€‰æ‹©æ˜¯å¦æ¿€æ´»ã€‚æœ‰å…³åŠ å¯†äº¤æ¢ç©ºé—´çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜… crossref:disks[swap-encrypting ,â€œåŠ å¯†äº¤æ¢ç©ºé—´â€] ã€‚ÙZSelect kbd:[T] to configure the `Pool Type` and the disk(s) that will constitute the pool.Ù=é€‰æ‹© kbd:[T] æ¥é…ç½® `æ± ç±»å‹` å’Œç»„æˆæ± çš„ç£ç›˜ã€‚­ZFS Pool Type­ZFS æ± ç±»å‹Ù3Menu requesting the Virtual Device type. Ex: stripeÙ3è¯·æ±‚è™šæ‹Ÿè®¾å¤‡ç±»å‹çš„èœå•ã€‚ä¾‹å¦‚ï¼šstripeÙGHere is a summary of the `Pool Type` that can be selected in this menu:ÙCè¿™æ˜¯ä¸€ä¸ªå…³äºæ­¤èœå•ä¸­å¯é€‰æ‹©çš„ `æ± ç±»å‹` çš„æ‘˜è¦ï¼šÙš`stripe` - Striping provides maximum storage of all connected devices, but no redundancy. If just one disk fails the data on the pool is lost irrevocably.Ù‰`stripe` - æ¡å¸¦åŒ–æä¾›äº†æœ€å¤§çš„å­˜å‚¨ç©ºé—´ï¼Œä½†æ²¡æœ‰å†—ä½™ã€‚å¦‚æœåªæœ‰ä¸€ä¸ªç£ç›˜æ•…éšœï¼Œæ± ä¸­çš„æ•°æ®å°†æ— æ³•æ¢å¤ã€‚Ú<`mirror` - Mirroring stores a complete copy of all data on every disk. Mirroring provides good read performance because data is read from all disks in parallel. Write performance is slower as the data must be written to all disks in the pool. Allows all but one disk to fail. This option requires at least two disks.Ú@`é•œåƒï¼ˆmirrorï¼‰` - é•œåƒå°†æ‰€æœ‰æ•°æ®å®Œæ•´åœ°å­˜å‚¨åœ¨æ¯ä¸ªç£ç›˜ä¸Šã€‚é•œåƒæä¾›è‰¯å¥½çš„è¯»å–æ€§èƒ½ï¼Œå› ä¸ºæ•°æ®å¯ä»¥å¹¶è¡Œä»æ‰€æœ‰ç£ç›˜ä¸­è¯»å–ã€‚å†™å…¥æ€§èƒ½è¾ƒæ…¢ï¼Œå› ä¸ºæ•°æ®å¿…é¡»å†™å…¥æ± ä¸­çš„æ‰€æœ‰ç£ç›˜ã€‚å…è®¸é™¤ä¸€ä¸ªç£ç›˜å¤–çš„æ‰€æœ‰ç£ç›˜æ•…éšœã€‚æ­¤é€‰é¡¹è‡³å°‘éœ€è¦ä¸¤ä¸ªç£ç›˜ã€‚Ù¡`raid10` - Striped mirrors. Provides the best performance, but the least storage. This option needs at least an even number of disks and a minimum of four disks.Ù†`raid10` - é•œåƒæ¡å¸¦åŒ–ã€‚æä¾›æœ€ä½³æ€§èƒ½ï¼Œä½†å­˜å‚¨ç©ºé—´æœ€å°‘ã€‚æ­¤é€‰é¡¹è‡³å°‘éœ€è¦å¶æ•°ä¸ªç£ç›˜å’Œè‡³å°‘å››ä¸ªç£ç›˜ã€‚Ùn`raidz1` - Single Redundant RAID. Allow one disk to fail concurrently. This option needs at least three disks.Ùb`raidz1` - å•å†—ä½™ RAID ã€‚å…è®¸åŒæ—¶æ•…éšœä¸€ä¸ªç£ç›˜ã€‚æ­¤é€‰é¡¹è‡³å°‘éœ€è¦ä¸‰ä¸ªç£ç›˜ã€‚Ùo`raidz2` - Double Redundant RAID. Allows two disks to fail concurrently. This option needs at least four disks.Ùb`raidz2` - åŒå†—ä½™ RAID ã€‚å…è®¸åŒæ—¶æ•…éšœä¸¤ä¸ªç£ç›˜ã€‚æ­¤é€‰é¡¹è‡³å°‘éœ€è¦å››ä¸ªç£ç›˜ã€‚Ùq`raidz3` - Triple Redundant RAID. Allows three disks to fail concurrently. This option needs at least five disks.Ùe`raidz3` - ä¸‰é‡å†—ä½™ RAID ã€‚å…è®¸åŒæ—¶æ•…éšœä¸‰ä¸ªç£ç›˜ã€‚æ­¤é€‰é¡¹è‡³å°‘éœ€è¦äº”ä¸ªç£ç›˜ã€‚ÚfOnce a `Pool Type` has been selected, a list of available disks is displayed, and the user is prompted to select one or more disks to make up the pool.  The configuration is then validated to ensure that enough disks are selected.  If validation fails, select btn:[<Change Selection>] to return to the list of disks or btn:[<Back>] to change the `Pool Type`.Ú-ä¸€æ—¦é€‰æ‹©äº† `æ± ç±»å‹`ï¼Œå°†æ˜¾ç¤ºå¯ç”¨ç£ç›˜åˆ—è¡¨ï¼Œå¹¶æç¤ºç”¨æˆ·é€‰æ‹©ä¸€ä¸ªæˆ–å¤šä¸ªç£ç›˜æ¥ç»„æˆæ± ã€‚ç„¶åï¼Œå°†éªŒè¯é…ç½®ä»¥ç¡®ä¿é€‰æ‹©äº†è¶³å¤Ÿçš„ç£ç›˜ã€‚å¦‚æœéªŒè¯å¤±è´¥ï¼Œè¯·é€‰æ‹© btn:[<Change Selection>] è¿”å›åˆ°ç£ç›˜åˆ—è¡¨ï¼Œæˆ–é€‰æ‹© btn:[<Back>] æ›´æ”¹ `æ± ç±»å‹`ã€‚®Disk Selection¬ç£ç›˜é€‰æ‹©Ù8Menu requesting how many disks will be added to the poolÙ*èœå•è¯·æ±‚æ·»åŠ å¤šå°‘ä¸ªç£ç›˜åˆ°æ± ä¸­±Invalid Selection¬æ— æ•ˆé€‰æ‹©Ù9Menu indicating that not enough disks have been selected.Ù'èœå•æŒ‡ç¤ºæœªé€‰æ‹©è¶³å¤Ÿçš„ç£ç›˜ã€‚Ù³If one or more disks are missing from the list, or if disks were attached after the installer was started, select btn:[- Rescan Devices] to repopulate the list of available disks.Ù¢å¦‚æœåˆ—è¡¨ä¸­ç¼ºå°‘ä¸€ä¸ªæˆ–å¤šä¸ªç£ç›˜ï¼Œæˆ–è€…åœ¨å¯åŠ¨å®‰è£…ç¨‹åºåé™„åŠ äº†ç£ç›˜ï¼Œè¯·é€‰æ‹© btn:[- Rescan Devices] ä»¥é‡æ–°å¡«å……å¯ç”¨ç£ç›˜åˆ—è¡¨ã€‚®Rescan Devices²é‡æ–°æ‰«æè®¾å¤‡­Device rescan²è®¾å¤‡é‡æ–°æ‰«æÙçTo avoid accidentally erasing the wrong disk, the btn:[- Disk Info] menu can be used to inspect each disk, including its partition table and various other information such as the device model number and serial number, if available.Ù¾ä¸ºäº†é¿å…æ„å¤–æ“¦é™¤é”™è¯¯çš„ç£ç›˜ï¼Œå¯ä»¥ä½¿ç”¨ btn:[- Disk Info] èœå•æ¥æ£€æŸ¥æ¯ä¸ªç£ç›˜ï¼ŒåŒ…æ‹¬å…¶åˆ†åŒºè¡¨å’Œå…¶ä»–å„ç§ä¿¡æ¯ï¼Œå¦‚è®¾å¤‡å‹å·å’Œåºåˆ—å·ï¼ˆå¦‚æœæœ‰ï¼‰ã€‚°Analyzing a Disk¬åˆ†æç£ç›˜Ù/Menu showing the information of the partitions.¾æ˜¾ç¤ºåˆ†åŒºä¿¡æ¯çš„èœå•ã€‚ÙµSelect kbd:[N] to configure the `Pool Name`.  Enter the desired name, then select btn:[<OK>] to establish it or btn:[<Cancel>] to return to the main menu and leave the default name.Ù£é€‰æ‹© kbd:[N] æ¥é…ç½® `æ± åç§°`ã€‚è¾“å…¥æ‰€éœ€çš„åç§°ï¼Œç„¶åé€‰æ‹© btn:[<OK>] æ¥ç¡®è®¤ï¼Œæˆ–é€‰æ‹© btn:[<Cancel>] è¿”å›ä¸»èœå•å¹¶ä¿ç•™é»˜è®¤åç§°ã€‚©Pool Name©æ± åç§°Ù%Menu requesting the name of the pool.Ù$è¯·æ±‚è¾“å…¥æ± çš„åç§°çš„èœå•ã€‚Ù¼Select kbd:[S] to set the amount of swap.  Enter the desired amount of swap, then select btn:[<OK>] to establish it or btn:[<Cancel>] to return to the main menu and let the default amount.Ù¾é€‰æ‹© kbd:[S] æ¥è®¾ç½®äº¤æ¢ç©ºé—´çš„å¤§å°ã€‚è¾“å…¥æ‰€éœ€çš„äº¤æ¢ç©ºé—´å¤§å°ï¼Œç„¶åé€‰æ‹© btn:[<OK>] æ¥ç¡®è®¤è®¾ç½®ï¼Œæˆ–é€‰æ‹© btn:[<Cancel>] è¿”å›ä¸»èœå•å¹¶ä½¿ç”¨é»˜è®¤å¤§å°ã€‚«Swap Amount²äº¤æ¢ç©ºé—´å¤§å°Ù)Menu requesting the amount of swap memoryÙ$è¯·æ±‚äº¤æ¢å†…å­˜çš„æ•°é‡çš„èœå•ÙõOnce all options have been set to the desired values, select the btn:[>>> Install] option at the top of the menu.  The installer then offers a last chance to cancel before the contents of the selected drives are destroyed to create the ZFS pool.ÙÒä¸€æ—¦æ‰€æœ‰é€‰é¡¹éƒ½è®¾ç½®ä¸ºæ‰€éœ€çš„å€¼ï¼Œé€‰æ‹©èœå•é¡¶éƒ¨çš„ btn:[>>> Install] é€‰é¡¹ã€‚ç„¶åå®‰è£…ç¨‹åºä¼šåœ¨é”€æ¯æ‰€é€‰é©±åŠ¨å™¨çš„å†…å®¹ä»¥åˆ›å»º ZFS æ± ä¹‹å‰ï¼Œæä¾›æœ€åä¸€æ¬¡å–æ¶ˆçš„æœºä¼šã€‚«Last Chance¬æœ€åæœºä¼šÙ6Menu indicating to the user that the data will be lostÙ'èœå•æç¤ºç”¨æˆ·æ•°æ®å°†ä¼šä¸¢å¤±ã€‚Ù§If GELI disk encryption was enabled, the installer will prompt twice for the passphrase to be used to encrypt the disks.  Initialization of the encryption then begins.Ù–å¦‚æœå¯ç”¨äº† GELI ç£ç›˜åŠ å¯†ï¼Œå®‰è£…ç¨‹åºå°†ä¼šä¸¤æ¬¡æç¤ºè¾“å…¥ç”¨äºåŠ å¯†ç£ç›˜çš„å¯†ç çŸ­è¯­ã€‚ç„¶åï¼ŒåŠ å¯†çš„åˆå§‹åŒ–è¿‡ç¨‹å¼€å§‹ã€‚¸Disk Encryption Password²ç£ç›˜åŠ å¯†å¯†ç Ù4Menu requesting the password to encrypt the devices.Ù-è¦æ±‚è¾“å…¥å¯†ç ä»¥åŠ å¯†è®¾å¤‡çš„èœå•ã€‚·Initializing Encryption¯åˆå§‹åŒ–åŠ å¯†Ù1Menu showing that the encryption is initializing.Ù$èœå•æ˜¾ç¤ºåŠ å¯†æ­£åœ¨åˆå§‹åŒ–ã€‚ÙxThe installation then proceeds normally.  To continue with the installation, go to <<bsdinstall-fetching-distribution>>.Ù_å®‰è£…ç„¶åæ­£å¸¸è¿›è¡Œã€‚è¦ç»§ç»­å®‰è£…ï¼Œè¯·è½¬åˆ° <<bsdinstall-fetching-distribution>> ã€‚·Shell Mode Partitioning²Shell æ¨¡å¼åˆ†åŒºÚ³When creating advanced installations, the bsdinstall partitioning menus may not provide the level of flexibility required.  Advanced users can select the btn:[Shell] option from the partitioning menu in order to manually partition the drives, create the file system(s), populate `/tmp/bsdinstall_etc/fstab`, and mount the file systems under `/mnt`.  Once this is done, type `exit` to return to bsdinstall and continue the installation.Ú_åœ¨åˆ›å»ºé«˜çº§å®‰è£…æ—¶ï¼Œbsdinstall åˆ†åŒºèœå•å¯èƒ½æ— æ³•æä¾›æ‰€éœ€çš„çµæ´»æ€§æ°´å¹³ã€‚é«˜çº§ç”¨æˆ·å¯ä»¥ä»åˆ†åŒºèœå•ä¸­é€‰æ‹© btn:[Shell] é€‰é¡¹ï¼Œä»¥æ‰‹åŠ¨åˆ†åŒºé©±åŠ¨å™¨ï¼Œåˆ›å»ºæ–‡ä»¶ç³»ç»Ÿï¼Œå¡«å…… `/tmp/bsdinstall_etc/fstab` ï¼Œå¹¶å°†æ–‡ä»¶ç³»ç»ŸæŒ‚è½½åˆ° `/mnt` ä¸‹ã€‚å®Œæˆåï¼Œè¾“å…¥ `exit` è¿”å›åˆ° bsdinstall å¹¶ç»§ç»­å®‰è£…ã€‚»Fetching Distribution Files²è·å–åˆ†å‘æ–‡ä»¶Ù£Installation time will vary depending on the distributions chosen, installation media, and speed of the computer.  A series of messages will indicate the progress.ÙŠå®‰è£…æ—¶é—´å°†æ ¹æ®æ‰€é€‰æ‹©çš„å‘è¡Œç‰ˆã€å®‰è£…ä»‹è´¨å’Œè®¡ç®—æœºé€Ÿåº¦è€Œæœ‰æ‰€ä¸åŒã€‚ä¸€ç³»åˆ—çš„æ¶ˆæ¯å°†æŒ‡ç¤ºå®‰è£…çš„è¿›åº¦ã€‚Ù´First, the installer formats the selected disk(s) and initializes the partitions.  Next, in the case of a `bootonly media` or `mini memstick`, it downloads the selected components:Ù­é¦–å…ˆï¼Œå®‰è£…ç¨‹åºä¼šæ ¼å¼åŒ–æ‰€é€‰ç£ç›˜å¹¶åˆå§‹åŒ–åˆ†åŒºã€‚æ¥ä¸‹æ¥ï¼Œåœ¨é€‰æ‹©äº† `ä»…å¼•å¯¼åª’ä½“` æˆ– `è¿·ä½ å†…å­˜æ£’` çš„æƒ…å†µä¸‹ï¼Œå®ƒä¼šä¸‹è½½æ‰€é€‰ç»„ä»¶ï¼šÙ6Menu showing the download of the different components.Ù'èœå•æ˜¾ç¤ºäº†ä¸åŒç»„ä»¶çš„ä¸‹è½½ã€‚Ù˜Next, the integrity of the distribution files is verified to ensure they have not been corrupted during download or misread from the installation media:Ù{æ¥ä¸‹æ¥ï¼Œå°†éªŒè¯åˆ†å‘æ–‡ä»¶çš„å®Œæ•´æ€§ï¼Œä»¥ç¡®ä¿åœ¨ä¸‹è½½è¿‡ç¨‹ä¸­æ²¡æœ‰æŸåæˆ–åœ¨å®‰è£…ä»‹è´¨ä¸­è¯»å–é”™è¯¯ï¼š¼Verifying Distribution Files²éªŒè¯åˆ†å‘æ–‡ä»¶Ù:Menu showing the verification of the different components.Ù$æ˜¾ç¤ºä¸åŒç»„ä»¶çš„éªŒè¯èœå•ã€‚ÙCFinally, the verified distribution files are extracted to the disk:Ù9æœ€åï¼ŒéªŒè¯è¿‡çš„åˆ†å‘æ–‡ä»¶è¢«è§£å‹åˆ°ç£ç›˜ä¸Šï¼š½Extracting Distribution Files²æå–åˆ†å‘æ–‡ä»¶Ù8Menu showing the extraction of the different components.Ù-èœå•æ˜¾ç¤ºäº†ä¸åŒç»„ä»¶çš„æå–è¿‡ç¨‹ã€‚ÙÍOnce all requested distribution files have been extracted, bsdinstall displays the first post-installation configuration screen.  The available post-configuration options are described in the next section.Ùä¸€æ—¦æå–äº†æ‰€æœ‰è¯·æ±‚çš„åˆ†å‘æ–‡ä»¶ï¼Œ bsdinstall å°†æ˜¾ç¤ºç¬¬ä¸€ä¸ªå®‰è£…åé…ç½®å±å¹•ã€‚ä¸‹ä¸€èŠ‚å°†ä»‹ç»å¯ç”¨çš„åé…ç½®é€‰é¡¹ã€‚Ù?Network Interfaces, Accounts, Time Zone, Services and HardeningÙ0ç½‘ç»œæ¥å£ï¼Œè´¦æˆ·ï¼Œæ—¶åŒºï¼ŒæœåŠ¡å’ŒåŠ å›º»Setting the `root` Password´è®¾ç½® `root` å¯†ç Ù¿First, the `root` password must be set.  While entering the password, the characters being typed are not displayed on the screen.  The password must be entered twice to prevent typing errors.Ùé¦–å…ˆï¼Œå¿…é¡»è®¾ç½® `root` å¯†ç ã€‚åœ¨è¾“å…¥å¯†ç æ—¶ï¼Œå±å¹•ä¸Šä¸ä¼šæ˜¾ç¤ºæ­£åœ¨è¾“å…¥çš„å­—ç¬¦ã€‚ä¸ºäº†é˜²æ­¢è¾“å…¥é”™è¯¯ï¼Œå¯†ç å¿…é¡»è¾“å…¥ä¸¤æ¬¡ã€‚Ù7Menu showing requesting the password for the root user.Ù0æ˜¾ç¤ºè¦æ±‚è¾“å…¥ root ç”¨æˆ·å¯†ç çš„èœå•ã€‚¾Configuring Network Interfaces²é…ç½®ç½‘ç»œæ¥å£ÙjNext, a list of the network interfaces found on the computer is shown.  Select the interface to configure.Ù]æ¥ä¸‹æ¥ï¼Œå°†æ˜¾ç¤ºè®¡ç®—æœºä¸Šæ‰¾åˆ°çš„ç½‘ç»œæ¥å£åˆ—è¡¨ã€‚è¯·é€‰æ‹©è¦é…ç½®çš„æ¥å£ã€‚ºChoose a Network Interface¸é€‰æ‹©ä¸€ä¸ªç½‘ç»œæ¥å£Ù;Menu showing the different network interfaces to configure.Ù3æ˜¾ç¤ºä¸åŒç½‘ç»œæ¥å£ä»¥è¿›è¡Œé…ç½®çš„èœå•ã€‚ÙàIf an Ethernet interface is selected, the installer will skip ahead to the menu shown in <<bsdinstall-configure-net-ipv4>>.  If a wireless network interface is chosen, the system will instead scan for wireless access points:Ù¿å¦‚æœé€‰æ‹©äº†ä»¥å¤ªç½‘æ¥å£ï¼Œå®‰è£…ç¨‹åºå°†ç›´æ¥è·³è½¬åˆ° <<bsdinstall-configure-net-ipv4>> ä¸­æ˜¾ç¤ºçš„èœå•ã€‚å¦‚æœé€‰æ‹©äº†æ— çº¿ç½‘ç»œæ¥å£ï¼Œç³»ç»Ÿå°†ä¼šæ‰«ææ— çº¿æ¥å…¥ç‚¹ï¼šÙ#Scanning for Wireless Access Pointsµæ‰«ææ— çº¿æ¥å…¥ç‚¹Ù'Menu showing wireless network scanning.Ù$æ˜¾ç¤ºæ— çº¿ç½‘ç»œæ‰«æçš„èœå•ã€‚ÚñWireless networks are identified by a Service Set Identifier (SSID); a short, unique name given to each network.  SSIDs found during the scan are listed, followed by a description of the encryption types available for that network.  If the desired SSID does not appear in the list, select btn:[Rescan] to scan again.  If the desired network still does not appear, check for problems with antenna connections or try moving the computer closer to the access point.  Rescan after each change is made.Ú¿æ— çº¿ç½‘ç»œé€šè¿‡æœåŠ¡é›†æ ‡è¯†ç¬¦ï¼ˆSSIDï¼‰è¿›è¡Œè¯†åˆ«ï¼Œæ¯ä¸ªç½‘ç»œéƒ½æœ‰ä¸€ä¸ªçŸ­è€Œç‹¬ç‰¹çš„åç§°ã€‚æ‰«ææœŸé—´æ‰¾åˆ°çš„ SSID å°†åˆ—å‡ºï¼Œç„¶åæ˜¯è¯¥ç½‘ç»œå¯ç”¨çš„åŠ å¯†ç±»å‹çš„æè¿°ã€‚å¦‚æœæ‰€éœ€çš„ SSID åœ¨åˆ—è¡¨ä¸­æœªå‡ºç°ï¼Œè¯·é€‰æ‹© btn:[Rescan] è¿›è¡Œå†æ¬¡æ‰«æã€‚å¦‚æœæ‰€éœ€çš„ç½‘ç»œä»æœªå‡ºç°ï¼Œè¯·æ£€æŸ¥å¤©çº¿è¿æ¥æ˜¯å¦æœ‰é—®é¢˜ï¼Œæˆ–å°è¯•å°†è®¡ç®—æœºç§»åŠ¨åˆ°æ¥å…¥ç‚¹é™„è¿‘ã€‚æ¯æ¬¡æ›´æ”¹åéƒ½è¦é‡æ–°æ‰«æã€‚»Choosing a Wireless Network²é€‰æ‹©æ— çº¿ç½‘ç»œÙ;Menu showing the different wireless networks to connect to.Ù0æ˜¾ç¤ºå¯è¿æ¥çš„ä¸åŒæ— çº¿ç½‘ç»œçš„èœå•ã€‚ÚxNext, enter the encryption information for connecting to the selected wireless network.  WPA2 encryption is strongly recommended over older encryption types such as WEP, which offer little security.  If the network uses WPA2, input the password, also known as the Pre-Shared Key (PSK).  For security reasons, the characters typed into the input box are displayed as asterisks.ÚJæ¥ä¸‹æ¥ï¼Œè¯·è¾“å…¥è¿æ¥åˆ°æ‰€é€‰æ— çº¿ç½‘ç»œçš„åŠ å¯†ä¿¡æ¯ã€‚å¼ºçƒˆå»ºè®®ä½¿ç”¨ WPA2 åŠ å¯†ï¼Œè€Œä¸æ˜¯è¾ƒæ—§çš„åŠ å¯†ç±»å‹ï¼Œå¦‚ WEP ï¼Œå› ä¸º WEP æä¾›çš„å®‰å…¨æ€§å¾ˆä½ã€‚å¦‚æœç½‘ç»œä½¿ç”¨ WPA2ï¼Œè¯·è¾“å…¥å¯†ç ï¼Œä¹Ÿç§°ä¸ºé¢„å…±äº«å¯†é’¥ï¼ˆPSKï¼‰ã€‚å‡ºäºå®‰å…¨åŸå› ï¼Œè¾“å…¥æ¡†ä¸­é”®å…¥çš„å­—ç¬¦å°†æ˜¾ç¤ºä¸ºæ˜Ÿå·ã€‚ªWPA2 Setup«WPA2 è®¾ç½®Ù.Menu requesting the wireless network password.Ù$è¯·æ±‚æ— çº¿ç½‘ç»œå¯†ç çš„èœå•ã€‚ÙgNext, choose whether or not an IPv4 address should be configured on the Ethernet or wireless interface:ÙKæ¥ä¸‹æ¥ï¼Œé€‰æ‹©æ˜¯å¦åœ¨ä»¥å¤ªç½‘æˆ–æ— çº¿æ¥å£ä¸Šé…ç½® IPv4 åœ°å€ï¼š¶Choose IPv4 Networking²é€‰æ‹© IPv4 ç½‘ç»œÙJMenu indicating if IPv4 wants to be configured for the selected interface.Ù3èœå•æŒ‡ç¤ºæ˜¯å¦è¦ä¸ºæ‰€é€‰æ¥å£é…ç½® IPv4 ã€‚ÚThere are two methods of IPv4 configuration.  DHCP will automatically configure the network interface correctly and should be used if the network provides a DHCP server.  Otherwise, the addressing information needs to be input manually as a static configuration.ÙÃIPv4 é…ç½®æœ‰ä¸¤ç§æ–¹æ³•ã€‚å¦‚æœç½‘ç»œæä¾›äº† DHCP æœåŠ¡å™¨ï¼ŒDHCP å°†è‡ªåŠ¨æ­£ç¡®é…ç½®ç½‘ç»œæ¥å£ï¼Œå¹¶ä¸”åº”è¯¥ä½¿ç”¨ DHCPã€‚å¦åˆ™ï¼Œéœ€è¦æ‰‹åŠ¨è¾“å…¥åœ°å€ä¿¡æ¯ä½œä¸ºé™æ€é…ç½®ã€‚ÚDo not enter random network information as it will not work.  If a DHCP server is not available, obtain the information listed in <<bsdinstall-collect-network-information, Required Network Information>> from the network administrator or Internet service provider.Ùğè¯·ä¸è¦è¾“å…¥éšæœºçš„ç½‘ç»œä¿¡æ¯ï¼Œå› ä¸ºå®ƒä¸ä¼šèµ·ä½œç”¨ã€‚å¦‚æœæ²¡æœ‰ DHCP æœåŠ¡å™¨å¯ç”¨ï¼Œè¯·å‘ç½‘ç»œç®¡ç†å‘˜æˆ–äº’è”ç½‘æœåŠ¡æä¾›å•†è·å– <<bsdinstall-collect-network-information,æ‰€éœ€ç½‘ç»œä¿¡æ¯>> ä¸­åˆ—å‡ºçš„ä¿¡æ¯ã€‚ÙüIf a DHCP server is available, select btn:[Yes] in the next menu to automatically configure the network interface.  The installer will appear to pause for a minute or so as it finds the DHCP server and obtains the addressing information for the system.ÙÎå¦‚æœæœ‰ DHCP æœåŠ¡å™¨å¯ç”¨ï¼Œè¯·åœ¨ä¸‹ä¸€ä¸ªèœå•ä¸­é€‰æ‹© btn:[Yes] ä»¥è‡ªåŠ¨é…ç½®ç½‘ç»œæ¥å£ã€‚å®‰è£…ç¨‹åºå°†ä¼šæš‚åœä¸€åˆ†é’Ÿå·¦å³ï¼Œä»¥ä¾¿æ‰¾åˆ° DHCP æœåŠ¡å™¨å¹¶è·å–ç³»ç»Ÿçš„åœ°å€ä¿¡æ¯ã€‚¾Choose IPv4 DHCP Configuration·é€‰æ‹© IPv4 DHCP é…ç½®ÙJMenu indicating if DHCP wants to be configured for the selected interface.Ù3èœå•æŒ‡ç¤ºæ˜¯å¦è¦ä¸ºæ‰€é€‰æ¥å£é…ç½® DHCP ã€‚ÙoIf a DHCP server is not available, select btn:[No] and input the following addressing information in this menu:Ùiå¦‚æœæ²¡æœ‰å¯ç”¨çš„ DHCP æœåŠ¡å™¨ï¼Œè¯·é€‰æ‹© btn:[No]ï¼Œå¹¶åœ¨æ­¤èœå•ä¸­è¾“å…¥ä»¥ä¸‹å¯»å€ä¿¡æ¯ï¼š¹IPv4 Static Configuration±IPv4 é™æ€é…ç½®Ù/Menu requesting data to configure IPv4 network.Ù$è¯·æ±‚é…ç½® IPv4 ç½‘ç»œçš„èœå•ã€‚Ù”`IP Address` - The IPv4 address assigned to this computer. The address must be unique and not already in use by another device on the local network.Ù™`IP åœ°å€ï¼ˆIP Addressï¼‰` - åˆ†é…ç»™æ­¤è®¡ç®—æœºçš„ IPv4 åœ°å€ã€‚è¯¥åœ°å€å¿…é¡»æ˜¯å”¯ä¸€çš„ï¼Œå¹¶ä¸”åœ¨æœ¬åœ°ç½‘ç»œä¸Šæ²¡æœ‰è¢«å…¶ä»–è®¾å¤‡ä½¿ç”¨ã€‚Ù0`Subnet Mask` - The subnet mask for the network.Ù:`å­ç½‘æ©ç ï¼ˆSubnet Maskï¼‰` - ç½‘ç»œçš„å­ç½‘æ©ç ã€‚ÙC`Default Router` - The IP address of the network's default gateway.ÙM`é»˜è®¤è·¯ç”±å™¨ï¼ˆDefault Routerï¼‰` - ç½‘ç»œçš„é»˜è®¤ç½‘å…³çš„ IP åœ°å€ã€‚Ù‰The next screen will ask if the interface should be configured for IPv6. If IPv6 is available and desired, choose btn:[Yes] to select it.Ù}ä¸‹ä¸€ä¸ªå±å¹•å°†è¯¢é—®æ˜¯å¦åº”è¯¥ä¸º IPv6 é…ç½®æ¥å£ã€‚å¦‚æœ IPv6 å¯ç”¨ä¸”éœ€è¦ï¼Œè¯·é€‰æ‹© btn:[Yes] æ¥é€‰æ‹©å®ƒã€‚¶Choose IPv6 Networking²é€‰æ‹© IPv6 ç½‘ç»œÙJMenu indicating if IPv6 wants to be configured for the selected interface.Ù3èœå•æŒ‡ç¤ºæ˜¯å¦è¦ä¸ºæ‰€é€‰æ¥å£é…ç½® IPv6 ã€‚Ú>IPv6 also has two methods of configuration.  StateLess Address AutoConfiguration (SLAAC) will automatically request the correct configuration information from a local router.  Refer to http://tools.ietf.org/html/rfc4862[rfc4862] for more information.  Static configuration requires manual entry of network information.ÙùIPv6 è¿˜æœ‰ä¸¤ç§é…ç½®æ–¹æ³•ã€‚æ— çŠ¶æ€åœ°å€è‡ªåŠ¨é…ç½®ï¼ˆSLAACï¼‰å°†è‡ªåŠ¨ä»æœ¬åœ°è·¯ç”±å™¨è¯·æ±‚æ­£ç¡®çš„é…ç½®ä¿¡æ¯ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜… http://tools.ietf.org/html/rfc4862[rfc4862]ã€‚é™æ€é…ç½®éœ€è¦æ‰‹åŠ¨è¾“å…¥ç½‘ç»œä¿¡æ¯ã€‚ÙøIf an IPv6 router is available, select btn:[Yes] in the next menu to automatically configure the network interface.  The installer will appear to pause for a minute or so as it finds the router and obtains the addressing information for the system.ÙÅå¦‚æœæœ‰ IPv6 è·¯ç”±å™¨å¯ç”¨ï¼Œè¯·åœ¨ä¸‹ä¸€ä¸ªèœå•ä¸­é€‰æ‹© btn:[Yes] ä»¥è‡ªåŠ¨é…ç½®ç½‘ç»œæ¥å£ã€‚å®‰è£…ç¨‹åºå°†ä¼šæš‚åœä¸€åˆ†é’Ÿå·¦å³ï¼Œä»¥æŸ¥æ‰¾è·¯ç”±å™¨å¹¶è·å–ç³»ç»Ÿçš„å¯»å€ä¿¡æ¯ã€‚¿Choose IPv6 SLAAC Configuration¸é€‰æ‹© IPv6 SLAAC é…ç½®ÙKMenu indicating if SLAAC wants to be configured for the selected interface.Ù4èœå•æŒ‡ç¤ºæ˜¯å¦è¦ä¸ºæ‰€é€‰æ¥å£é…ç½® SLAAC ã€‚ÙpIf an IPv6 router is not available, select btn:[No] and input the following addressing information in this menu:Ùgå¦‚æœæ²¡æœ‰å¯ç”¨çš„ IPv6 è·¯ç”±å™¨ï¼Œè¯·é€‰æ‹© btn:[No] å¹¶åœ¨æ­¤èœå•ä¸­è¾“å…¥ä»¥ä¸‹å¯»å€ä¿¡æ¯ï¼š¹IPv6 Static Configuration±IPv6 é™æ€é…ç½®Ù/Menu requesting data to configure IPv6 network.Ù*èœå•è¯·æ±‚é…ç½® IPv6 ç½‘ç»œçš„æ•°æ®ã€‚Ù–`IPv6 Address` - The IPv6 address assigned to this computer. The address must be unique and not already in use by another device on the local network.Ù`IPv6 åœ°å€ï¼ˆIPv6 Addressï¼‰` - åˆ†é…ç»™æ­¤è®¡ç®—æœºçš„ IPv6 åœ°å€ã€‚è¯¥åœ°å€å¿…é¡»æ˜¯å”¯ä¸€çš„ï¼Œå¹¶ä¸”åœ¨æœ¬åœ°ç½‘ç»œä¸­æ²¡æœ‰è¢«å…¶ä»–è®¾å¤‡ä½¿ç”¨ã€‚ÙE`Default Router` - The IPv6 address of the network's default gateway.ÙO`é»˜è®¤è·¯ç”±å™¨ï¼ˆDefault Routerï¼‰` - ç½‘ç»œçš„é»˜è®¤ç½‘å…³çš„ IPv6 åœ°å€ã€‚ÚÕThe last network configuration menu is used to configure the Domain Name System (DNS) resolver, which converts hostnames to and from network addresses.  If DHCP or SLAAC was used to autoconfigure the network interface, the `Resolver Configuration` values may already be filled in.  Otherwise, enter the local network's domain name in the `Search` field.  `DNS #1` and `DNS #2` are the IPv4 and/or IPv6 addresses of the DNS servers.  At least one DNS server is required.Úãæœ€åä¸€ä¸ªç½‘ç»œé…ç½®èœå•ç”¨äºé…ç½®åŸŸåç³»ç»Ÿï¼ˆDNSï¼‰è§£æå™¨ï¼Œè¯¥è§£æå™¨å°†ä¸»æœºåè½¬æ¢ä¸ºç½‘ç»œåœ°å€ï¼Œå¹¶ä¸”å¯ä»¥å°†ç½‘ç»œåœ°å€è½¬æ¢ä¸ºä¸»æœºåã€‚å¦‚æœä½¿ç”¨ DHCP æˆ– SLAAC è‡ªåŠ¨é…ç½®ç½‘ç»œæ¥å£ï¼Œåˆ™ `è§£æå™¨é…ç½®ï¼ˆResolver Configurationï¼‰` å€¼å¯èƒ½å·²ç»å¡«å†™ã€‚å¦åˆ™ï¼Œè¯·åœ¨ `æœç´¢ï¼ˆSearchï¼‰` å­—æ®µä¸­è¾“å…¥æœ¬åœ°ç½‘ç»œçš„åŸŸåã€‚`DNS #1` å’Œ `DNS #2` æ˜¯ DNS æœåŠ¡å™¨çš„ IPv4 å’Œ / æˆ– IPv6 åœ°å€ã€‚è‡³å°‘éœ€è¦ä¸€ä¸ª DNS æœåŠ¡å™¨ã€‚±DNS ConfigurationªDNS é…ç½®Ù6Menu requesting data to configure DNS for the network.Ù,èœå•è¯·æ±‚æ•°æ®ä»¥é…ç½®ç½‘ç»œçš„ DNS ã€‚ÚOnce the interface is configured, select a mirror site that is located in the same region of the world as the computer on which FreeBSD is being installed.  Files can be retrieved more quickly when the mirror is close to the target computer, reducing installation time.ÙÉä¸€æ—¦é…ç½®äº†æ¥å£ï¼Œé€‰æ‹©ä¸€ä¸ªä½äºä¸å®‰è£… FreeBSD çš„è®¡ç®—æœºç›¸åŒåœ°åŒºçš„é•œåƒç«™ç‚¹ã€‚å½“é•œåƒç«™ç‚¹é è¿‘ç›®æ ‡è®¡ç®—æœºæ—¶ï¼Œå¯ä»¥æ›´å¿«åœ°æ£€ç´¢æ–‡ä»¶ï¼Œä»è€Œå‡å°‘å®‰è£…æ—¶é—´ã€‚ÙaSelecting `ftp://ftp.freebsd.org (Main Site)` will automatically route you to the nearest mirror.Ù[é€‰æ‹© `ftp://ftp.freebsd.org (Main Site)` å°†è‡ªåŠ¨å°†æ‚¨è·¯ç”±åˆ°æœ€è¿‘çš„é•œåƒç«™ç‚¹ã€‚±Choosing a Mirror¯é€‰æ‹©é•œåƒæºÙ!Menu requesting a network mirror.¾è¯·æ±‚ç½‘ç»œé•œåƒçš„èœå•ã€‚µSetting the Time Zone¬è®¾ç½®æ—¶åŒºÚ5The next series of menus are used to determine the correct local time by selecting the geographic region, country, and time zone.  Setting the time zone allows the system to automatically correct for regional time changes, such as daylight savings time, and perform other time zone related functions properly.ÙÛä¸‹ä¸€ç³»åˆ—èœå•ç”¨äºé€šè¿‡é€‰æ‹©åœ°ç†åŒºåŸŸã€å›½å®¶å’Œæ—¶åŒºæ¥ç¡®å®šæ­£ç¡®çš„æœ¬åœ°æ—¶é—´ã€‚è®¾ç½®æ—¶åŒºå…è®¸ç³»ç»Ÿè‡ªåŠ¨æ ¡æ­£åŒºåŸŸæ—¶é—´å˜åŒ–ï¼Œå¦‚å¤ä»¤æ—¶ï¼Œå¹¶æ­£ç¡®æ‰§è¡Œå…¶ä»–ä¸æ—¶åŒºç›¸å…³çš„åŠŸèƒ½ã€‚ÙThe example shown here is for a machine located in the mainland time zone of Spain, Europe.  The selections will vary according to the geographical location.Ù„è¿™é‡Œå±•ç¤ºçš„ç¤ºä¾‹é€‚ç”¨äºä½äºè¥¿ç­ç‰™æ¬§æ´²å¤§é™†æ—¶åŒºçš„æœºå™¨ã€‚æ ¹æ®åœ°ç†ä½ç½®çš„ä¸åŒï¼Œé€‰æ‹©é¡¹ä¼šæœ‰æ‰€å˜åŒ–ã€‚¯Select a Region²é€‰æ‹©ä¸€ä¸ªåœ°åŒºÙ$Menu requesting the timezone region.¾è¯·æ±‚æ—¶åŒºåœ°åŒºçš„èœå•ã€‚ÙVThe appropriate region is selected using the arrow keys and then pressing kbd:[Enter].ÙFä½¿ç”¨ç®­å¤´é”®é€‰æ‹©é€‚å½“çš„åŒºåŸŸï¼Œç„¶åæŒ‰ä¸‹ kbd:[Enter] é”®ã€‚°Select a Country²é€‰æ‹©ä¸€ä¸ªå›½å®¶Ù%Menu requesting the timezone country.¾è¯·æ±‚æ—¶åŒºå›½å®¶çš„èœå•ã€‚ÙJSelect the appropriate country using the arrow keys and press kbd:[Enter].ÙNä½¿ç”¨ç®­å¤´é”®é€‰æ‹©é€‚å½“çš„å›½å®¶ï¼Œç„¶åæŒ‰ä¸‹é”®ç›˜ä¸Šçš„ [Enter] é”®ã€‚²Select a Time Zone²é€‰æ‹©ä¸€ä¸ªæ—¶åŒºÙ"Menu requesting the timezone zone.¸è¯·æ±‚æ—¶åŒºçš„èœå•ã€‚ÙTThe appropriate time zone is selected using the arrow keys and pressing kbd:[Enter].ÙLä½¿ç”¨ç®­å¤´é”®é€‰æ‹©é€‚å½“çš„æ—¶åŒºï¼Œç„¶åæŒ‰ä¸‹ kbd:[Enter] é”®ç¡®è®¤ã€‚±Confirm Time Zone¬ç¡®è®¤æ—¶åŒºÙ6Menu requesting confirmation of the selected timezone.Ù!èœå•è¯·æ±‚ç¡®è®¤æ‰€é€‰æ—¶åŒºã€‚Ù6Confirm the abbreviation for the time zone is correct.Ù'è¯·ç¡®è®¤æ—¶åŒºçš„ç¼©å†™æ˜¯å¦æ­£ç¡®ã€‚«Select Date¬é€‰æ‹©æ—¥æœŸÙ Menu requesting the system date.¾è¯·æ±‚ç³»ç»Ÿæ—¥æœŸçš„èœå•ã€‚ÙThe appropriate date is selected using the arrow keys and then pressing btn:[Set Date].  Otherwise, the date selection can be skipped by pressing btn:[Skip].Ù…ä½¿ç”¨ç®­å¤´é”®é€‰æ‹©é€‚å½“çš„æ—¥æœŸï¼Œç„¶åæŒ‰ä¸‹ btn:[Set Date] ã€‚å¦åˆ™ï¼Œå¯ä»¥é€šè¿‡æŒ‰ä¸‹ btn:[Skip] æ¥è·³è¿‡æ—¥æœŸé€‰æ‹©ã€‚«Select Time¬é€‰æ‹©æ—¶é—´Ù Menu requesting the system time.¾è¯·æ±‚ç³»ç»Ÿæ—¶é—´çš„èœå•ã€‚ÙThe appropriate time is selected using the arrow keys and then pressing btn:[Set Time].  Otherwise, the time selection can be skipped by pressing btn:[Skip].Ù…ä½¿ç”¨ç®­å¤´é”®é€‰æ‹©é€‚å½“çš„æ—¶é—´ï¼Œç„¶åæŒ‰ä¸‹ btn:[Set Time] ã€‚å¦åˆ™ï¼Œå¯ä»¥é€šè¿‡æŒ‰ä¸‹ btn:[Skip] æ¥è·³è¿‡æ—¶é—´é€‰æ‹©ã€‚±Enabling Services¬å¯ç”¨æœåŠ¡ÙÍThe next menu is used to configure which system services will be started whenever the system boots.  All of these services are optional.  Only start the services that are needed for the system to function.Ù“ä¸‹ä¸€ä¸ªèœå•ç”¨äºé…ç½®ç³»ç»Ÿå¯åŠ¨æ—¶å°†å¯åŠ¨å“ªäº›ç³»ç»ŸæœåŠ¡ã€‚æ‰€æœ‰è¿™äº›æœåŠ¡éƒ½æ˜¯å¯é€‰çš„ã€‚åªå¯åŠ¨ç³»ç»Ÿè¿è¡Œæ‰€éœ€çš„æœåŠ¡ã€‚Ù'Selecting Additional Services to Enable¸é€‰æ‹©å¯ç”¨é™„åŠ æœåŠ¡Ù.Menu showing the different services available.¾æ˜¾ç¤ºä¸åŒæœåŠ¡çš„èœå•ã€‚ÙCHere is a summary of the services that can be enabled in this menu:Ù9è¿™é‡Œæ˜¯å¯ä»¥åœ¨æ­¤èœå•ä¸­å¯ç”¨çš„æœåŠ¡çš„æ‘˜è¦ï¼šÚ`local_unbound` - Enable the DNS local unbound. It is necessary to keep in mind that this is a configuration only meant for use as a local caching forwarding resolver. If the objective is to set up a resolver for the entire network, install package:dns/unbound[].Ùã`local_unbound` - å¯ç”¨æœ¬åœ° DNS è§£æå™¨ unbound ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªé…ç½®åªé€‚ç”¨äºä½œä¸ºæœ¬åœ°ç¼“å­˜è½¬å‘è§£æå™¨ä½¿ç”¨ã€‚å¦‚æœç›®æ ‡æ˜¯ä¸ºæ•´ä¸ªç½‘ç»œè®¾ç½®è§£æå™¨ï¼Œè¯·å®‰è£… `dns/unbound` è½¯ä»¶åŒ…ã€‚Ù¶`sshd` - The Secure Shell (SSH) daemon is used to remotely access a system over an encrypted connection. Only enable this service if the system should be available for remote logins.Ù–`sshd` - å®‰å…¨ Shellï¼ˆSSHï¼‰å®ˆæŠ¤è¿›ç¨‹ç”¨äºé€šè¿‡åŠ å¯†è¿æ¥è¿œç¨‹è®¿é—®ç³»ç»Ÿã€‚åªæœ‰åœ¨ç³»ç»Ÿéœ€è¦æä¾›è¿œç¨‹ç™»å½•æ—¶æ‰å¯ç”¨æ­¤æœåŠ¡ã€‚Ù^`moused` - Enable this service if the mouse will be used from the command-line system console.ÙV`moused` - å¦‚æœå¸Œæœ›ä»å‘½ä»¤è¡Œç³»ç»Ÿæ§åˆ¶å°ä½¿ç”¨é¼ æ ‡ï¼Œè¯·å¯ç”¨æ­¤æœåŠ¡ã€‚ÙÌ`ntpdate` - Enable automatic clock synchronization at boot time. Note that the functionality of this program is now available in the man:ntpd[8] daemon and the man:ntpdate[8] utility will soon be retired.Ùº`ntpdate` - åœ¨å¯åŠ¨æ—¶å¯ç”¨è‡ªåŠ¨æ—¶é’ŸåŒæ­¥ã€‚è¯·æ³¨æ„ï¼Œè¯¥ç¨‹åºçš„åŠŸèƒ½ç°åœ¨å·²ç»æ•´åˆåˆ° `man:ntpd[8]` å®ˆæŠ¤è¿›ç¨‹ä¸­ï¼Œ `man:ntpdate[8]` å®ç”¨ç¨‹åºå°†å¾ˆå¿«è¢«å¼ƒç”¨ã€‚Ù¸`ntpd` - The Network Time Protocol (NTP) daemon for automatic clock synchronization. Enable this service if you wish to synchronise your system clock with a remote time server or pool.Ù¨`ntpd` - è‡ªåŠ¨æ—¶é’ŸåŒæ­¥çš„ç½‘ç»œæ—¶é—´åè®®ï¼ˆNTPï¼‰å®ˆæŠ¤è¿›ç¨‹ã€‚å¦‚æœæ‚¨å¸Œæœ›å°†ç³»ç»Ÿæ—¶é’Ÿä¸è¿œç¨‹æ—¶é—´æœåŠ¡å™¨æˆ–æ—¶é—´æ± åŒæ­¥ï¼Œè¯·å¯ç”¨æ­¤æœåŠ¡ã€‚ÙL`powerd` - System power control utility for power control and energy saving.Ù>`powerd` - ç”¨äºç³»ç»Ÿç”µæºæ§åˆ¶å’ŒèŠ‚èƒ½çš„å®ç”¨ç¨‹åºã€‚Ùq`dumpdev` - Crash dumps are useful when debugging issues with the system, so users are encouraged to enable them.Ù``dumpdev` - å´©æºƒè½¬å‚¨åœ¨è°ƒè¯•ç³»ç»Ÿé—®é¢˜æ—¶éå¸¸æœ‰ç”¨ï¼Œå› æ­¤é¼“åŠ±ç”¨æˆ·å¯ç”¨å®ƒä»¬ã€‚Ù#Enabling Hardening Security Options¸å¯ç”¨å¼ºåŒ–å®‰å…¨é€‰é¡¹ÙŒThe next menu is used to configure which security options will be enabled.  All of these options are optional.  But their use is encouraged.Ùoä¸‹ä¸€ä¸ªèœå•ç”¨äºé…ç½®å¯ç”¨çš„å®‰å…¨é€‰é¡¹ã€‚æ‰€æœ‰è¿™äº›é€‰é¡¹éƒ½æ˜¯å¯é€‰çš„ï¼Œä½†å»ºè®®ä½¿ç”¨å®ƒä»¬ã€‚Ù$Selecting Hardening Security Options¸é€‰æ‹©åŠ å›ºå®‰å…¨é€‰é¡¹Ù6Menu shoring the different hardening security options.Ù-æ˜¾ç¤ºä¸åŒçš„åŠ å›ºå®‰å…¨é€‰é¡¹çš„èœå•ã€‚ÙBHere is a summary of the options that can be enabled in this menu:Ù6è¿™é‡Œæ˜¯å¯ä»¥åœ¨æ­¤èœå•ä¸­å¯ç”¨çš„é€‰é¡¹æ‘˜è¦ï¼šÙ‹`hide_uids` - Hide processes running as other users (UID). This prevents unprivileged users from seeing running processes from other users.ÙŒ`hide_uids` - éšè—ä»¥å…¶ä»–ç”¨æˆ·ï¼ˆUIDï¼‰èº«ä»½è¿è¡Œçš„è¿›ç¨‹ã€‚è¿™å¯ä»¥é˜²æ­¢éç‰¹æƒç”¨æˆ·çœ‹åˆ°å…¶ä»–ç”¨æˆ·æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹ã€‚Ù`hide_gids` - Hide processes running as other groups (GID). This prevents unprivileged users from seeing running processes from other groups.Ù†`hide_gids` - éšè—ä»¥å…¶ä»–ç»„ï¼ˆGIDï¼‰èº«ä»½è¿è¡Œçš„è¿›ç¨‹ã€‚è¿™å¯ä»¥é˜²æ­¢éç‰¹æƒç”¨æˆ·çœ‹åˆ°æ¥è‡ªå…¶ä»–ç»„çš„è¿è¡Œè¿›ç¨‹ã€‚Ù{`hide_jail` - Hide processes running in jails. This prevents unprivileged users from seeing processes running inside jails.Ùw`hide_jail` - éšè—åœ¨ jail ä¸­è¿è¡Œçš„è¿›ç¨‹ã€‚è¿™å¯ä»¥é˜²æ­¢éç‰¹æƒç”¨æˆ·çœ‹åˆ°åœ¨ jail å†…éƒ¨è¿è¡Œçš„è¿›ç¨‹ã€‚Ù¯`read_msgbuf` - Disable reading kernel message buffer for unprivileged users. Prevent unprivileged users from using man:dmesg[8] to view messages from the kernel's log buffer.Ùœ`read_msgbuf` - ç¦æ­¢éç‰¹æƒç”¨æˆ·è¯»å–å†…æ ¸æ¶ˆæ¯ç¼“å†²åŒºã€‚é˜²æ­¢éç‰¹æƒç”¨æˆ·ä½¿ç”¨ man:dmesg[8] å‘½ä»¤æŸ¥çœ‹å†…æ ¸æ—¥å¿—ç¼“å†²åŒºä¸­çš„æ¶ˆæ¯ã€‚Ú—`proc_debug` - Disable process debugging facilities for unprivileged users. Disables a variety of unprivileged inter-process debugging services, including some procfs functionality, `ptrace()`, and `ktrace()`. Please note that this will also prevent debugging tools such as man:lldb[1], man:truss[1] and man:procstat[1], as well as some built-in debugging facilities in certain scripting languages like PHP.ÚG`proc_debug` - ç¦ç”¨éç‰¹æƒç”¨æˆ·çš„è¿›ç¨‹è°ƒè¯•åŠŸèƒ½ã€‚ç¦ç”¨äº†å„ç§éç‰¹æƒè¿›ç¨‹é—´è°ƒè¯•æœåŠ¡ï¼ŒåŒ…æ‹¬ä¸€äº› procfs åŠŸèƒ½ï¼Œ`ptrace()` å’Œ `ktrace()`ã€‚è¯·æ³¨æ„ï¼Œè¿™ä¹Ÿä¼šé˜»æ­¢è°ƒè¯•å·¥å…·å¦‚ man:lldb[1]ã€man:truss[1] å’Œ man:procstat[1]ï¼Œä»¥åŠæŸäº›è„šæœ¬è¯­è¨€ï¼ˆå¦‚ PHPï¼‰ä¸­çš„ä¸€äº›å†…ç½®è°ƒè¯•åŠŸèƒ½ã€‚Ù.`random_pid` - Randomize the PID of processes.Ù)`random_pid` - éšæœºåŒ–è¿›ç¨‹çš„ PID ã€‚Ù5`clear_tmp` - Clean `/tmp` when the system starts up.Ù7`clear_tmp` - åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶æ¸…ç† `/tmp` ç›®å½•ã€‚Úa`disable_syslogd` - Disable opening the syslogd network socket. By default, FreeBSD runs syslogd in a secure way with `-s`. This prevents the daemon from listening for incoming UDP requests on port 514. With this option enabled, syslogd will instead run with `-ss`, which prevents syslogd from opening any port. For more information, see man:syslogd[8].Úo`disable_syslogd` - ç¦ç”¨æ‰“å¼€ syslogd ç½‘ç»œå¥—æ¥å­—ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒFreeBSD ä»¥å®‰å…¨æ–¹å¼è¿è¡Œ syslogd ï¼Œä½¿ç”¨ `-s` é€‰é¡¹ã€‚è¿™æ ·å¯ä»¥é˜²æ­¢å®ˆæŠ¤è¿›ç¨‹åœ¨ 514 ç«¯å£ä¸Šç›‘å¬ä¼ å…¥çš„ UDP è¯·æ±‚ã€‚å¯ç”¨æ­¤é€‰é¡¹åï¼Œ syslogd å°†æ”¹ä¸ºä½¿ç”¨ `-ss` è¿è¡Œï¼Œè¿™å°†é˜»æ­¢ syslogd æ‰“å¼€ä»»ä½•ç«¯å£ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜… man:syslogd[8] ã€‚Ù?`disable_sendmail` - Disable the sendmail mail transport agent.Ù:`disable_sendmail` - ç¦ç”¨ sendmail é‚®ä»¶ä¼ è¾“ä»£ç†ã€‚Ùf`secure_console` - Make the command prompt request the `root` password when entering single-user mode.Ù``secure_console` - åœ¨è¿›å…¥å•ç”¨æˆ·æ¨¡å¼æ—¶ï¼Œä½¿å‘½ä»¤æç¤ºç¬¦è¦æ±‚è¾“å…¥ `root` å¯†ç ã€‚Ùç`disable_ddtrace` - DTrace can run in a mode that affects the running kernel. Destructive actions may not be used unless explicitly enabled. Use `-w` to enable this option when using DTrace. For more information, see man:dtrace[1].Ùï`disable_ddtrace` - DTrace å¯ä»¥ä»¥å½±å“è¿è¡Œä¸­çš„å†…æ ¸çš„æ¨¡å¼è¿è¡Œã€‚é™¤éæ˜¾å¼å¯ç”¨ï¼Œå¦åˆ™ä¸å¾—ä½¿ç”¨ç ´åæ€§æ“ä½œã€‚åœ¨ä½¿ç”¨ DTrace æ—¶ï¼Œä½¿ç”¨ `-w` æ¥å¯ç”¨æ­¤é€‰é¡¹ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜… man:dtrace[1] ã€‚ÙÛ`enable_aslr` - Enable address layout randomization. For more information about address layout randomization the link:https://en.wikipedia.org/wiki/Address_space_layout_randomization[Wikipedia article] can be consulted.ÙÎ`enable_aslr` - å¯ç”¨åœ°å€ç©ºé—´å¸ƒå±€éšæœºåŒ–ã€‚æœ‰å…³åœ°å€ç©ºé—´å¸ƒå±€éšæœºåŒ–çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è€ƒ link:https://en.wikipedia.org/wiki/Address_space_layout_randomization[ç»´åŸºç™¾ç§‘æ–‡ç« ] ã€‚©Add Users¬æ·»åŠ ç”¨æˆ·Ú%The next menu prompts to create at least one user account.  It is recommended to log into the system using a user account rather than as `root`.  When logged in as `root`, there are essentially no limits or protection on what can be done.  Logging in as a normal user is safer and more secure.Úä¸‹ä¸€ä¸ªèœå•æç¤ºæ‚¨åˆ›å»ºè‡³å°‘ä¸€ä¸ªç”¨æˆ·å¸æˆ·ã€‚å»ºè®®ä½¿ç”¨ç”¨æˆ·å¸æˆ·ç™»å½•ç³»ç»Ÿï¼Œè€Œä¸æ˜¯ä½¿ç”¨â€œ root â€ç”¨æˆ·ã€‚ä»¥ `root` ç”¨æˆ·èº«ä»½ç™»å½•æ—¶ï¼ŒåŸºæœ¬ä¸Šæ²¡æœ‰é™åˆ¶æˆ–ä¿æŠ¤ï¼Œå¯ä»¥åšä»»ä½•äº‹æƒ…ã€‚ä»¥æ™®é€šç”¨æˆ·èº«ä»½ç™»å½•æ›´å®‰å…¨ã€æ›´å¯é ã€‚Ù"Select btn:[Yes] to add new users.Ù&é€‰æ‹© btn:[Yes] æ¥æ·»åŠ æ–°ç”¨æˆ·ã€‚±Add User Accounts²æ·»åŠ ç”¨æˆ·è´¦æˆ·Ù9Menu requesting if a user want to be added to the system.Ù0èœå•è¯¢é—®ç”¨æˆ·æ˜¯å¦è¦æ·»åŠ åˆ°ç³»ç»Ÿä¸­ã€‚ÙŸFollow the prompts and input the requested information for the user account.  The example shown in <<bsdinstall-add-user2>> creates the `asample` user account.Ù|æŒ‰ç…§æç¤ºè¾“å…¥ç”¨æˆ·è´¦æˆ·æ‰€éœ€çš„ä¿¡æ¯ã€‚åœ¨ <<bsdinstall-add-user2>> ä¸­çš„ç¤ºä¾‹åˆ›å»ºäº† `asample` ç”¨æˆ·è´¦æˆ·ã€‚¶Enter User Information²è¾“å…¥ç”¨æˆ·ä¿¡æ¯Ù7Menu requesting different information for the new user.Ù'èœå•è¯·æ±‚æ–°ç”¨æˆ·çš„ä¸åŒä¿¡æ¯ã€‚Ù.Here is a summary of the information to input:¾è¿™æ˜¯è¾“å…¥ä¿¡æ¯çš„æ‘˜è¦ï¼šÚ`Username` - The name the user will enter to log in. A common convention is to use the first letter of the first name combined with the last name, as long as each username is unique for the system. The username is case sensitive and should not contain any spaces.Ùß`ç”¨æˆ·åï¼ˆUsernameï¼‰` - ç”¨æˆ·ç™»å½•æ—¶è¾“å…¥çš„åç§°ã€‚å¸¸è§çš„çº¦å®šæ˜¯ä½¿ç”¨åå­—çš„é¦–å­—æ¯ä¸å§“æ°ç»“åˆï¼Œåªè¦æ¯ä¸ªç”¨æˆ·ååœ¨ç³»ç»Ÿä¸­æ˜¯å”¯ä¸€çš„ã€‚ç”¨æˆ·ååŒºåˆ†å¤§å°å†™ï¼Œä¸åº”åŒ…å«ä»»ä½•ç©ºæ ¼ã€‚Ùn`Full name` - The user's full name. This can contain spaces and is used as a description for the user account.ÙY`Full name` - ç”¨æˆ·çš„å…¨åã€‚å¯ä»¥åŒ…å«ç©ºæ ¼ï¼Œå¹¶ä¸”ç”¨ä½œç”¨æˆ·è´¦æˆ·çš„æè¿°ã€‚ÙZ`Uid` - User ID. This is typically left blank so the system automatically assigns a value.ÙE`Uid` - ç”¨æˆ· ID ã€‚é€šå¸¸ç•™ç©ºï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨åˆ†é…ä¸€ä¸ªå€¼ã€‚ÙU`Login group` - The user's group. This is typically left blank to accept the default.ÙU`ç™»å½•ç»„ï¼ˆLogin groupï¼‰` - ç”¨æˆ·æ‰€å±çš„ç»„ã€‚é€šå¸¸ç•™ç©ºä»¥æ¥å—é»˜è®¤å€¼ã€‚ÙŸ`Invite _user_ into other groups?` - Additional groups to which the user will be added as a member. If the user needs administrative access, type `wheel` here.ÙÅå°† `ç”¨æˆ·` é‚€è¯·åŠ å…¥å…¶ä»–ç¾¤ç»„ï¼ˆInvite _user_ into other groupsï¼‰ï¼Ÿ - ç”¨æˆ·å°†ä½œä¸ºæˆå‘˜æ·»åŠ åˆ°å…¶ä»–ç¾¤ç»„ã€‚å¦‚æœç”¨æˆ·éœ€è¦ç®¡ç†å‘˜è®¿é—®æƒé™ï¼Œè¯·åœ¨æ­¤å¤„è¾“å…¥ `wheel` ã€‚Ù5`Login class` - Typically left blank for the default.Ù@`ç™»å½•ç±»ï¼ˆLogin classï¼‰` - é€šå¸¸ç•™ç©ºä»¥ä½¿ç”¨é»˜è®¤å€¼ã€‚Ù `Shell` - Type in one of the listed values to set the interactive shell for the user. Refer to crossref:basics[shells,Shells] for more information about shells.Ù•`Shell` - è¾“å…¥åˆ—è¡¨ä¸­çš„ä¸€ä¸ªå€¼æ¥è®¾ç½®ç”¨æˆ·çš„äº¤äº’å¼ shell ã€‚æœ‰å…³ shell çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è€ƒ crossref:basics[shells,Shells] ã€‚ÙM`Home directory` - The user's home directory. The default is usually correct.ÙR`Home directory` - ç”¨æˆ·çš„ä¸»ç›®å½•ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œé»˜è®¤å€¼æ˜¯æ­£ç¡®çš„ã€‚Ùh`Home directory permissions` - Permissions on the user's home directory. The default is usually correct.Ù|`ä¸»ç›®å½•æƒé™ï¼ˆHome directory permissionsï¼‰` - ç”¨æˆ·ä¸»ç›®å½•çš„æƒé™ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œé»˜è®¤è®¾ç½®æ˜¯æ­£ç¡®çš„ã€‚Ùu`Use password-based authentication?` - Typically `yes` so that the user is prompted to input their password at login.Ù—`ä½¿ç”¨åŸºäºå¯†ç çš„èº«ä»½éªŒè¯ï¼ˆse password-based authenticationï¼‰ï¼Ÿ` - é€šå¸¸é€‰æ‹© `yes`ï¼Œè¿™æ ·ç”¨æˆ·åœ¨ç™»å½•æ—¶ä¼šè¢«æç¤ºè¾“å…¥å¯†ç ã€‚ÙS`Use an empty password?` - Typically `no` as empty or blank passwords are insecure.Ù`ä½¿ç”¨ç©ºå¯†ç ï¼ˆUse an empty passwordï¼‰ï¼Ÿ` - é€šå¸¸æƒ…å†µä¸‹ï¼Œä¸å»ºè®®ä½¿ç”¨ç©ºå¯†ç ï¼Œå› ä¸ºç©ºå¯†ç æˆ–ç©ºç™½å¯†ç æ˜¯ä¸å®‰å…¨çš„ã€‚Ùi`Use a random password?` - Typically `no` so that the user can set their own password in the next prompt.Ù…`ä½¿ç”¨éšæœºå¯†ç ï¼ˆUse a random passwordï¼‰ï¼Ÿ` - é€šå¸¸æ˜¯ `no`ï¼Œè¿™æ ·ç”¨æˆ·å¯ä»¥åœ¨ä¸‹ä¸€ä¸ªæç¤ºä¸­è®¾ç½®è‡ªå·±çš„å¯†ç ã€‚Ùc`Enter password` - The password for this user. Typed-in characters will not be shown on the screen.Ùd`è¾“å…¥å¯†ç ï¼ˆEnter passwordï¼‰` - æ­¤ç”¨æˆ·çš„å¯†ç ã€‚è¾“å…¥çš„å­—ç¬¦ä¸ä¼šæ˜¾ç¤ºåœ¨å±å¹•ä¸Šã€‚ÙK`Enter password again` - The password must be typed again for verification.Ù[`å†æ¬¡è¾“å…¥å¯†ç ï¼ˆEnter password againï¼‰` - ä¸ºäº†éªŒè¯ï¼Œå¿…é¡»å†æ¬¡è¾“å…¥å¯†ç ã€‚ÙT`Lock out the account after creation?` - Typically `no` so that the user can log in.Ùr`åˆ›å»ºåé”å®šè´¦æˆ·ï¼ˆLock out the account after creationï¼‰ï¼Ÿ` - é€šå¸¸æ˜¯ `no`ï¼Œä»¥ä¾¿ç”¨æˆ·å¯ä»¥ç™»å½•ã€‚Ù±After entering all the details, a summary is shown for review.  If a mistake was made, enter `no` to correct it.  Once everything is correct, enter `yes` to create the new user.Ù©è¾“å…¥å®Œæ‰€æœ‰ç»†èŠ‚åï¼Œä¼šæ˜¾ç¤ºä¸€ä¸ªæ‘˜è¦ä¾›å®¡æ ¸ã€‚å¦‚æœæœ‰é”™è¯¯ï¼Œè¯·è¾“å…¥ `no` è¿›è¡Œæ›´æ­£ã€‚ä¸€åˆ‡éƒ½æ­£ç¡®æ— è¯¯åï¼Œè¯·è¾“å…¥ `yes` åˆ›å»ºæ–°ç”¨æˆ·ã€‚¾Exit User and Group Management¸é€€å‡ºç”¨æˆ·å’Œç»„ç®¡ç†ÙUMenu showing the information of the new user and requesting if everything is correct.Ù?èœå•æ˜¾ç¤ºæ–°ç”¨æˆ·çš„ä¿¡æ¯ï¼Œå¹¶è¯¢é—®æ˜¯å¦ä¸€åˆ‡æ­£ç¡®ã€‚Ù•If there are more users to add, answer the `Add another user?` question with `yes`.  Enter `no` to finish adding users and continue the installation.Ùå¦‚æœè¿˜æœ‰æ›´å¤šç”¨æˆ·éœ€è¦æ·»åŠ ï¼Œè¯·ç”¨ `yes` å›ç­”â€œæ˜¯å¦æ·»åŠ å¦ä¸€ä¸ªç”¨æˆ·ï¼Ÿâ€çš„é—®é¢˜ã€‚è¾“å…¥ `no` ä»¥å®Œæˆæ·»åŠ ç”¨æˆ·å¹¶ç»§ç»­å®‰è£…ã€‚ÙFor more information on adding users and user management, see crossref:basics[users-synopsis,Users and Basic Account Management].Ù‚æœ‰å…³æ·»åŠ ç”¨æˆ·å’Œç”¨æˆ·ç®¡ç†çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜… crossref:basics[users-synopsis,ç”¨æˆ·å’ŒåŸºæœ¬å¸æˆ·ç®¡ç†] ä¸€èŠ‚ã€‚³Final Configuration¬æœ€ç»ˆé…ç½®ÙbAfter everything has been installed and configured, a final chance is provided to modify settings.ÙNåœ¨å®‰è£…å’Œé…ç½®å®Œæˆä¹‹åï¼Œæä¾›äº†æœ€åä¸€æ¬¡ä¿®æ”¹è®¾ç½®çš„æœºä¼šã€‚ÙYMenu showing different options to perform before finishing the installation. Ex: Add userÙHåœ¨å®Œæˆå®‰è£…ä¹‹å‰æ˜¾ç¤ºä¸åŒé€‰é¡¹çš„èœå•ã€‚ä¾‹å¦‚ï¼šæ·»åŠ ç”¨æˆ·ÙkUse this menu to make any changes or to do any additional configuration before completing the installation.ÙZåœ¨å®Œæˆå®‰è£…ä¹‹å‰ï¼Œä½¿ç”¨æ­¤èœå•è¿›è¡Œä»»ä½•æ›´æ”¹æˆ–è¿›è¡Œä»»ä½•é¢å¤–çš„é…ç½®ã€‚Ù2`Add User` - Described in <<bsdinstall-addusers>>.Ù5`Add User` - åœ¨ <<bsdinstall-addusers>> ä¸­æè¿°ã€‚Ù8`Root Password` - Described in <<bsdinstall-post-root>>.ÙD`Root Password` - åœ¨ <<bsdinstall-post-root>> ä¸­æœ‰è¯¦ç»†æè¿°ã€‚Ù2`Hostname` - Described in <<bsdinstall-hostname>>.Ù>`Hostname` - åœ¨ <<bsdinstall-hostname>> ä¸­æœ‰è¯¦ç»†æè¿°ã€‚Ù;`Network` - Described in <<bsdinstall-config-network-dev>>.ÙG`Network` - åœ¨ <<bsdinstall-config-network-dev>> ä¸­è¿›è¡Œäº†æè¿°ã€‚Ù1`Services` - Described in <<bsdinstall-sysconf>>.Ù=`Services` - åœ¨ <<bsdinstall-sysconf>> ä¸­è¿›è¡Œäº†æè¿°ã€‚Ù;`System Hardening` - Described in <<bsdinstall-hardening>>.ÙG`System Hardening` - åœ¨ <<bsdinstall-hardening>> ä¸­è¿›è¡Œäº†æè¿°ã€‚Ù3`Time Zone` - Described in <<bsdinstall-timezone>>.Ù6`Time Zone` - åœ¨ <<bsdinstall-timezone>> ä¸­æè¿°ã€‚Ù7`Handbook` - Download and install the FreeBSD Handbook.Ù.`Handbook` - ä¸‹è½½å¹¶å®‰è£… FreeBSD æ‰‹å†Œã€‚Ù2Once configuration is complete, select btn:[Exit].Ù&é…ç½®å®Œæˆåï¼Œé€‰æ‹© btn:[Exit]ã€‚´Manual Configuration¬æ‰‹åŠ¨é…ç½®ÙoMenu showing that the installation has finished. And asking if you want to open a shell to make manual changes.Ù[èœå•æ˜¾ç¤ºå®‰è£…å·²å®Œæˆï¼Œå¹¶è¯¢é—®æ˜¯å¦è¦æ‰“å¼€ä¸€ä¸ª shell æ¥è¿›è¡Œæ‰‹åŠ¨æ›´æ”¹ã€‚Ùëbsdinstall will prompt for any additional configuration that needs to be done before rebooting into the new system.  Select btn:[Yes] to exit to a shell within the new system or btn:[No] to proceed to the last step of the installation.ÙÆbsdinstall å°†æç¤ºè¿›è¡Œä»»ä½•åœ¨é‡å¯è¿›å…¥æ–°ç³»ç»Ÿä¹‹å‰éœ€è¦å®Œæˆçš„é¢å¤–é…ç½®ã€‚é€‰æ‹© btn:[Yes] é€€å‡ºåˆ°æ–°ç³»ç»Ÿä¸­çš„ shell ï¼Œæˆ–é€‰æ‹© btn:[No] ç»§ç»­è¿›è¡Œå®‰è£…çš„æœ€åä¸€æ­¥ã€‚¹Complete the Installation¬å®Œæˆå®‰è£…ÙnMenu showing that the installation has finished and asking whether to reboot the system or access the Live CD.ÙTèœå•æ˜¾ç¤ºå®‰è£…å·²å®Œæˆï¼Œå¹¶è¯¢é—®æ˜¯å¦é‡æ–°å¯åŠ¨ç³»ç»Ÿæˆ–è®¿é—® Live CD ã€‚ÙvIf further configuration or special setup is needed, select btn:[Live CD] to boot the install media into Live CD mode.Ùrå¦‚æœéœ€è¦è¿›ä¸€æ­¥é…ç½®æˆ–ç‰¹æ®Šè®¾ç½®ï¼Œè¯·é€‰æ‹© btn:[Live CD] ä»¥å°†å®‰è£…ä»‹è´¨å¼•å¯¼åˆ° Live CD æ¨¡å¼ã€‚ÙÊIf the installation is complete, select btn:[Reboot] to reboot the computer and start the new FreeBSD system.  Do not forget to remove the FreeBSD install media or the computer might boot from it again.Ù¼å¦‚æœå®‰è£…å®Œæˆï¼Œè¯·é€‰æ‹© btn:[Reboot] æ¥é‡æ–°å¯åŠ¨è®¡ç®—æœºå¹¶å¯åŠ¨æ–°çš„ FreeBSD ç³»ç»Ÿã€‚ä¸è¦å¿˜è®°ç§»é™¤ FreeBSD å®‰è£…ä»‹è´¨ï¼Œå¦åˆ™è®¡ç®—æœºå¯èƒ½ä¼šå†æ¬¡ä»å®ƒå¯åŠ¨ã€‚ÚwAs FreeBSD boots, informational messages are displayed.  After the system finishes booting, a login prompt is displayed.  At the `login:` prompt, enter the username added during the installation.  Avoid logging in as `root`.  Refer to crossref:basics[users-superuser,The Superuser Account] for instructions on how to become the superuser when administrative access is needed.ÚWFreeBSD å¯åŠ¨æ—¶ä¼šæ˜¾ç¤ºä¿¡æ¯æ€§çš„æ¶ˆæ¯ã€‚ç³»ç»Ÿå®Œæˆå¯åŠ¨åï¼Œä¼šæ˜¾ç¤ºä¸€ä¸ªç™»å½•æç¤ºç¬¦ã€‚åœ¨ `login:` æç¤ºç¬¦ä¸‹ï¼Œè¾“å…¥åœ¨å®‰è£…è¿‡ç¨‹ä¸­æ·»åŠ çš„ç”¨æˆ·åã€‚é¿å…ä½¿ç”¨ `root` ç™»å½•ã€‚å¦‚éœ€è¿›è¡Œç®¡ç†è®¿é—®æ—¶ï¼Œå‚è€ƒ crossref:basics[users-superuser,è¶…çº§ç”¨æˆ·è´¦æˆ·] ä¸­çš„è¯´æ˜ï¼Œäº†è§£å¦‚ä½•æˆä¸ºè¶…çº§ç”¨æˆ·ã€‚ÚéThe messages that appear during boot can be reviewed by pressing kbd:[Scroll-Lock] to turn on the scroll-back buffer.  The kbd:[PgUp], kbd:[PgDn], and arrow keys can be used to scroll back through the messages.  When finished, press kbd:[Scroll-Lock] again to unlock the display and return to the console.  To review these messages once the system has been up for some time, type `less /var/run/dmesg.boot` from a command prompt.  Press kbd:[q] to return to the command line after viewing.Ú°æŒ‰ä¸‹ kbd:[Scroll-Lock] é”®å¯ä»¥æŸ¥çœ‹å¯åŠ¨è¿‡ç¨‹ä¸­å‡ºç°çš„æ¶ˆæ¯ï¼Œä»¥æ‰“å¼€æ»šåŠ¨ç¼“å†²åŒºã€‚ä½¿ç”¨ kbd:[PgUp]ã€kbd:[PgDn] å’Œç®­å¤´é”®å¯ä»¥å‘åæ»šåŠ¨æŸ¥çœ‹æ¶ˆæ¯ã€‚å®Œæˆåï¼Œå†æ¬¡æŒ‰ä¸‹ kbd:[Scroll-Lock] é”®ä»¥è§£é”æ˜¾ç¤ºå¹¶è¿”å›åˆ°æ§åˆ¶å°ã€‚è¦åœ¨ç³»ç»Ÿè¿è¡Œä¸€æ®µæ—¶é—´åæŸ¥çœ‹è¿™äº›æ¶ˆæ¯ï¼Œè¯·åœ¨å‘½ä»¤æç¤ºç¬¦ä¸‹è¾“å…¥ `less /var/run/dmesg.boot`ã€‚æŸ¥çœ‹å®Œæ¯•åï¼ŒæŒ‰ä¸‹ kbd:[q] é”®è¿”å›åˆ°å‘½ä»¤è¡Œã€‚ÙîIf sshd was enabled in <<bsdinstall-config-serv>>, the first boot might be a bit slower as the system generates SSH host keys.  Subsequent boots will be faster.  The fingerprints of the keys are then displayed as in the following example:Ùãå¦‚æœåœ¨ <<bsdinstall-config-serv>> ä¸­å¯ç”¨äº† sshdï¼Œç³»ç»Ÿåœ¨ç¬¬ä¸€æ¬¡å¯åŠ¨æ—¶å¯èƒ½ä¼šæ…¢ä¸€äº›ï¼Œå› ä¸ºç³»ç»Ÿä¼šç”Ÿæˆ SSH ä¸»æœºå¯†é’¥ã€‚éšåçš„å¯åŠ¨å°†ä¼šæ›´å¿«ã€‚ç„¶åï¼Œå¯†é’¥çš„æŒ‡çº¹å°†ä¼šæ˜¾ç¤ºå¦‚ä¸‹ç¤ºä¾‹ï¼šÙ^Refer to crossref:security[openssh,"OpenSSH"] for more information about fingerprints and SSH.ÙYæœ‰å…³æŒ‡çº¹å’Œ SSH çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è€ƒ crossref:security[openssh ,"OpenSSH"] ã€‚Ù¾FreeBSD does not install a graphical environment by default.  Refer to crossref:x11[x11,The X Window System] for more information about installing and configuring a graphical window manager.Ù é»˜è®¤æƒ…å†µä¸‹ï¼ŒFreeBSD ä¸å®‰è£…å›¾å½¢åŒ–ç¯å¢ƒã€‚æœ‰å…³å®‰è£…å’Œé…ç½®å›¾å½¢çª—å£ç®¡ç†å™¨çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è€ƒ crossref:x11[x11,X Window ç³»ç»Ÿ] ã€‚ÚProper shutdown of a FreeBSD computer helps protect data and hardware from damage.  _Do not turn off the power before the system has been properly shut down!_ If the user is a member of the `wheel` group, become the superuser by typing `su` at the command line and entering the `root` password.  Then, type `shutdown -p now` and the system will shut down cleanly, and, if the hardware supports it, turn itself off.Úpæ­£ç¡®å…³é—­ FreeBSD è®¡ç®—æœºæœ‰åŠ©äºä¿æŠ¤æ•°æ®å’Œç¡¬ä»¶å…å—æŸåã€‚åœ¨ç³»ç»Ÿæ­£ç¡®å…³é—­ä¹‹å‰ï¼Œè¯·ä¸è¦å…³é—­ç”µæºï¼å¦‚æœç”¨æˆ·æ˜¯ `wheel` ç»„çš„æˆå‘˜ï¼Œè¯·åœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥ `su` å¹¶è¾“å…¥ `root` å¯†ç ä»¥æˆä¸ºè¶…çº§ç”¨æˆ·ã€‚ç„¶åï¼Œè¾“å…¥ `shutdown -p now`ï¼Œç³»ç»Ÿå°†ä¼šå¹²å‡€åœ°å…³é—­ï¼Œå¹¶ä¸”å¦‚æœç¡¬ä»¶æ”¯æŒçš„è¯ï¼Œä¼šè‡ªåŠ¨å…³é—­ç”µæºã€‚¯Troubleshooting¬æ•…éšœæ’é™¤ÙeThis section covers basic installation troubleshooting, such as common problems people have reported.ÙHæœ¬èŠ‚ä»‹ç»åŸºæœ¬çš„å®‰è£…æ•…éšœæ’é™¤ï¼Œä¾‹å¦‚äººä»¬å¸¸è§çš„é—®é¢˜ã€‚Ù²Check the Hardware Notes listed on the link:https://www.FreeBSD.org/releases/[FreeBSD Release Information] page for the version of FreeBSD to make sure the hardware is supported.Ùè¯·æŸ¥çœ‹ link:https://www.FreeBSD.org/releases/[FreeBSD Release Information] é¡µé¢ä¸Šåˆ—å‡ºçš„ç¡¬ä»¶è¯´æ˜ï¼Œä»¥ç¡®ä¿ç¡¬ä»¶å¾—åˆ°æ”¯æŒã€‚Ú*Some installation problems can be avoided or alleviated by updating the firmware on various hardware components, most notably the motherboard.  Motherboard firmware is usually referred to as the BIOS.  Most motherboard and computer manufacturers have a website for upgrades and upgrade information.Ùİé€šè¿‡æ›´æ–°å„ç§ç¡¬ä»¶ç»„ä»¶çš„å›ºä»¶ï¼Œå°¤å…¶æ˜¯ä¸»æ¿çš„å›ºä»¶ï¼Œå¯ä»¥é¿å…æˆ–å‡è½»ä¸€äº›å®‰è£…é—®é¢˜ã€‚ä¸»æ¿å›ºä»¶é€šå¸¸è¢«ç§°ä¸º BIOSã€‚å¤§å¤šæ•°ä¸»æ¿å’Œè®¡ç®—æœºåˆ¶é€ å•†éƒ½æœ‰å‡çº§å’Œå‡çº§ä¿¡æ¯çš„ç½‘ç«™ã€‚ÙèManufacturers generally advise against upgrading the motherboard BIOS unless there is a good reason for doing so, like a critical update.  The upgrade process _can_ go wrong, leaving the BIOS incomplete and the computer inoperative.Ù¹é™¤éæœ‰å……åˆ†çš„ç†ç”±ï¼Œå¦‚å…³é”®æ›´æ–°ï¼Œå¦åˆ™åˆ¶é€ å•†é€šå¸¸å»ºè®®ä¸è¦å‡çº§ä¸»æ¿ BIOSã€‚å‡çº§è¿‡ç¨‹å¯èƒ½ä¼šå‡ºé”™ï¼Œå¯¼è‡´ BIOS ä¸å®Œæ•´ï¼Œä½¿è®¡ç®—æœºæ— æ³•æ­£å¸¸è¿è¡Œã€‚ÚìIf the system hangs while probing hardware during boot or behaves strangely during the installation process, ACPI may be the culprit.  FreeBSD makes extensive use of the system ACPI service on the i386 and amd64 platforms to aid in system configuration if it is detected during boot.  Unfortunately, some bugs still exist in both the ACPI driver and within system motherboards and BIOS firmware.  ACPI can be disabled by setting the `hint.acpi.0.disabled` hint in the third stage boot loader:Ú¹å¦‚æœç³»ç»Ÿåœ¨å¯åŠ¨è¿‡ç¨‹ä¸­æ¢æµ‹ç¡¬ä»¶æ—¶å¡ä½æˆ–åœ¨å®‰è£…è¿‡ç¨‹ä¸­è¡¨ç°å¼‚å¸¸ï¼ŒACPI å¯èƒ½æ˜¯ç½ªé­ç¥¸é¦–ã€‚FreeBSD åœ¨ i386 å’Œ amd64 å¹³å°ä¸Šåœ¨å¯åŠ¨è¿‡ç¨‹ä¸­æ£€æµ‹åˆ° ACPI åä¼šå¹¿æ³›ä½¿ç”¨ç³»ç»Ÿ ACPI æœåŠ¡æ¥å¸®åŠ©ç³»ç»Ÿé…ç½®ã€‚ä¸å¹¸çš„æ˜¯ï¼ŒACPI é©±åŠ¨ç¨‹åºå’Œç³»ç»Ÿä¸»æ¿ä»¥åŠ BIOS å›ºä»¶ä¸­ä»ç„¶å­˜åœ¨ä¸€äº›é”™è¯¯ã€‚å¯ä»¥é€šè¿‡åœ¨ç¬¬ä¸‰é˜¶æ®µå¼•å¯¼åŠ è½½ç¨‹åºä¸­è®¾ç½® `hint.acpi.0.disabled` æç¤ºæ¥ç¦ç”¨ ACPIã€‚ÙèThis is reset each time the system is booted, so it is necessary to add `hint.acpi.0.disabled="1"` to the file `/boot/loader.conf`.  More information about the boot loader can be found in crossref:boot[boot-synopsis,â€œSynopsisâ€].Ùïæ¯æ¬¡ç³»ç»Ÿå¯åŠ¨æ—¶éƒ½ä¼šé‡ç½®è¿™ä¸ªè®¾ç½®ï¼Œå› æ­¤éœ€è¦å°† `hint.acpi.0.disabled ="1"` æ·»åŠ åˆ°æ–‡ä»¶ `/boot/loader.conf` ä¸­ã€‚æœ‰å…³å¼•å¯¼åŠ è½½ç¨‹åºçš„æ›´å¤šä¿¡æ¯å¯ä»¥åœ¨ crossref:boot[boot-synopsis,â€œSynopsisâ€] ä¸­æ‰¾åˆ°ã€‚±Using the Live CD®ä½¿ç”¨ Live CDÚThe welcome menu of bsdinstall, shown in <<bsdinstall-choose-mode>>, provides a btn:[Live CD] option.  This is useful for those who are still wondering whether FreeBSD is the right operating system for them and want to test some of the features before installing.Úbsdinstall çš„æ¬¢è¿èœå•åœ¨ <<bsdinstall-choose-mode>> ä¸­æ˜¾ç¤ºï¼Œæä¾›äº† btn:[Live CD] é€‰é¡¹ã€‚å¯¹äºé‚£äº›ä»ç„¶åœ¨çŠ¹è±«æ˜¯å¦é€‰æ‹© FreeBSD ä½œä¸ºä»–ä»¬çš„æ“ä½œç³»ç»Ÿï¼Œå¹¶ä¸”æƒ³åœ¨å®‰è£…ä¹‹å‰æµ‹è¯•ä¸€äº›åŠŸèƒ½çš„äººæ¥è¯´ï¼Œè¿™æ˜¯éå¸¸æœ‰ç”¨çš„ã€‚ÙDThe following points should be noted before using the btn:[Live CD]:Ù9åœ¨ä½¿ç”¨ btn:[Live CD] ä¹‹å‰ï¼Œåº”æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼šÙkTo gain access to the system, authentication is required. The username is `root` and the password is blank.ÙRè¦è®¿é—®ç³»ç»Ÿï¼Œéœ€è¦è¿›è¡Œèº«ä»½éªŒè¯ã€‚ç”¨æˆ·åä¸º `root`ï¼Œå¯†ç ä¸ºç©ºã€‚Ù‘As the system runs directly from the installation media, performance will be significantly slower than that of a system installed on a hard disk.Ùcç”±äºç³»ç»Ÿç›´æ¥ä»å®‰è£…ä»‹è´¨è¿è¡Œï¼Œå› æ­¤æ€§èƒ½å°†æ˜æ˜¾ä½äºå®‰è£…åœ¨ç¡¬ç›˜ä¸Šçš„ç³»ç»Ÿã€‚ÙIThis option only provides a command prompt and not a graphical interface.Ù?è¯¥é€‰é¡¹åªæä¾›å‘½ä»¤æç¤ºç¬¦ï¼Œè€Œä¸æä¾›å›¾å½¢ç•Œé¢ã€‚¨Abstract¦æ‘˜è¦Ú|Welcome to FreeBSD! This handbook covers the installation and day to day use of _FreeBSD {rel140-current}-RELEASE, {rel132-current}-RELEASE_ and _FreeBSD {rel124-current}-RELEASE_.  This book is the result of ongoing work by many individuals.  Some sections might be outdated.  Those interested in helping to update and expand this document should send email to the {freebsd-doc}.ÚKæ¬¢è¿æ¥åˆ° FreeBSD ï¼æœ¬æ‰‹å†Œæ¶µç›–äº† _FreeBSD {rel140-current}-RELEASE, {rel132-current}-RELEASE_ å’Œ _FreeBSD {rel124-current}-RELEASE_ çš„å®‰è£…å’Œæ—¥å¸¸ä½¿ç”¨ã€‚æœ¬ä¹¦æ˜¯è®¸å¤šäººæŒç»­å·¥ä½œçš„ç»“æœã€‚æŸäº›éƒ¨åˆ†å¯èƒ½å·²è¿‡æ—¶ã€‚æœ‰å…´è¶£å¸®åŠ©æ›´æ–°å’Œæ‰©å±•æœ¬æ–‡æ¡£çš„äººåº”è¯¥å‘é€ç”µå­é‚®ä»¶è‡³ {freebsd-doc}ã€‚ÚThe latest version of this book is available from the https://www.FreeBSD.org/[FreeBSD web site].  Previous versions can be obtained from https://docs.FreeBSD.org/doc/[https://docs.FreeBSD.org/doc/].  The book can be downloaded in a variety of formats and compression options from the https://download.freebsd.org/doc/[FreeBSD download server] or one of the numerous link:./mirrors#mirrors[mirror sites].  Searches can be performed on the handbook and other documents on the link:https://www.FreeBSD.org/search/[search page].ÚÍè¿™æœ¬ä¹¦çš„æœ€æ–°ç‰ˆæœ¬å¯ä»¥ä» https://www.FreeBSD.org/[FreeBSD ç½‘ç«™] è·å–ã€‚ä»¥å‰çš„ç‰ˆæœ¬å¯ä»¥ä» https://docs.FreeBSD.org/doc/[https://docs.FreeBSD.org/doc/] è·å–ã€‚è¯¥ä¹¦å¯ä»¥ä» https://download.freebsd.org/doc/[FreeBSD ä¸‹è½½æœåŠ¡å™¨] æˆ–ä¼—å¤š link:./mirrors#mirrors[é•œåƒç«™ç‚¹] ä¹‹ä¸€ä»¥å¤šç§æ ¼å¼å’Œå‹ç¼©é€‰é¡¹ä¸‹è½½ã€‚å¯ä»¥åœ¨æ‰‹å†Œå’Œå…¶ä»–æ–‡æ¡£ä¸Šè¿›è¡Œæœç´¢ï¼Œé“¾æ¥åœ¨ link:https://www.FreeBSD.org/search/[æœç´¢é¡µé¢] ä¸Šã€‚ÙÁThe FreeBSD newcomer will find that the first section of this book guides the user through the FreeBSD installation process and gently introduces the concepts and conventions that underpin UNIXÙŒFreeBSD æ–°æ‰‹ä¼šå‘ç°æœ¬ä¹¦çš„ç¬¬ä¸€éƒ¨åˆ†æŒ‡å¯¼ç”¨æˆ·å®Œæˆ FreeBSD å®‰è£…è¿‡ç¨‹ï¼Œå¹¶è½»æ¾åœ°ä»‹ç»äº†æ”¯æ’‘ UNIX çš„æ¦‚å¿µå’Œçº¦å®šã€‚§Preface¦å‰è¨€±Intended Audience¬é¢„æœŸè¯»è€…ÚZThe FreeBSD newcomer will find that the first section of this book guides the user through the FreeBSD installation process and gently introduces the concepts and conventions that underpin UNIX(R).  Working through this section requires little more than the desire to explore, and the ability to take on board new concepts as they are introduced.ÙÚFreeBSD æ–°æ‰‹ä¼šå‘ç°æœ¬ä¹¦çš„ç¬¬ä¸€éƒ¨åˆ†æŒ‡å¯¼ç”¨æˆ·å®Œæˆ FreeBSD å®‰è£…è¿‡ç¨‹ï¼Œå¹¶è½»æ¾åœ°ä»‹ç»äº† UNIX(R) çš„æ¦‚å¿µå’Œçº¦å®šã€‚é˜…è¯»è¿™ä¸€éƒ¨åˆ†åªéœ€è¦æœ‰æ¢ç´¢çš„æ„¿æœ›ï¼Œä»¥åŠæ¥å—æ–°æ¦‚å¿µçš„èƒ½åŠ›ã€‚Ú=Once you have traveled this far, the second, far larger, section of the Handbook is a comprehensive reference to all manner of topics of interest to FreeBSD system administrators.  Some of these chapters may recommend that you do some prior reading, and this is noted in the synopsis at the beginning of each chapter.Ùÿä¸€æ—¦ä½ èµ°åˆ°è¿™ä¸€æ­¥ï¼Œæ‰‹å†Œçš„ç¬¬äºŒéƒ¨åˆ†ï¼Œä¹Ÿæ˜¯æ›´å¤§çš„éƒ¨åˆ†ï¼Œæ˜¯ä¸€ä¸ªå¯¹ FreeBSD ç³»ç»Ÿç®¡ç†å‘˜æ„Ÿå…´è¶£çš„å„ç§ä¸»é¢˜çš„å…¨é¢å‚è€ƒã€‚å…¶ä¸­ä¸€äº›ç« èŠ‚å¯èƒ½ä¼šå»ºè®®ä½ å…ˆé˜…è¯»ä¸€äº›å†…å®¹ï¼Œåœ¨æ¯ä¸ªç« èŠ‚çš„ç®€ä»‹ä¸­ä¼šæœ‰æ³¨æ˜ã€‚ÙmFor a list of additional sources of information, please see crossref:bibliography[bibliography,Bibliography].Ùaæœ‰å…³æ›´å¤šä¿¡æ¯æ¥æºçš„åˆ—è¡¨ï¼Œè¯·å‚è§ crossref:bibliography[bibliography,å‚è€ƒæ–‡çŒ®]ã€‚®Fourth Edition©ç¬¬å››ç‰ˆÙÙThe current version of the Handbook represents the cumulative effort of a working group that has been reviewing and updating all Handbook content.  These are the major updates since the fourth edition of the Handbook.Ù«å½“å‰ç‰ˆæœ¬çš„æ‰‹å†Œä»£è¡¨äº†ä¸€ä¸ªå·¥ä½œç»„çš„ç´¯ç§¯åŠªåŠ›ï¼Œè¯¥å·¥ä½œç»„ä¸€ç›´åœ¨å®¡æŸ¥å’Œæ›´æ–°æ‰€æœ‰æ‰‹å†Œå†…å®¹ã€‚ä»¥ä¸‹æ˜¯è‡ªç¬¬å››ç‰ˆæ‰‹å†Œä»¥æ¥çš„ä¸»è¦æ›´æ–°ã€‚Ù—The Handbook has been converted from link:https://docbook.org/[Docbook] to link:https://gohugo.io/[Hugo] and link:https://asciidoctor.org/[AsciiDoctor]Ù‰æ‰‹å†Œå·²ä» link:https://docbook.org/[Docbook] è½¬æ¢ä¸º link:https://gohugo.io/[Hugo] å’Œ link:https://asciidoctor.org/[AsciiDoctor]ã€‚ÙQThe link:https://docs.FreeBSD.org[FreeBSD Documentation Portal] has been created.Ù@link:https://docs.FreeBSD.org[FreeBSD æ–‡æ¡£é—¨æˆ·] å·²åˆ›å»ºã€‚Ùycrossref:wayland[wayland,Wayland] has been added with information about installing and configuring Wayland under FreeBSD.Ùmæ·»åŠ äº† crossref:wayland[wayland,Wayland]ï¼Œå…¶ä¸­åŒ…å«åœ¨ FreeBSD ä¸‹å®‰è£…å’Œé…ç½® Wayland çš„ä¿¡æ¯ã€‚ÙRThe crossref:bibliography[bibliography,Bibliography] has been extensively updated.ÙRcrossref:bibliography[bibliography,å‚è€ƒæ–‡çŒ®] å·²ç»è¿›è¡Œäº†å¹¿æ³›çš„æ›´æ–°ã€‚­Third Edition©ç¬¬ä¸‰ç‰ˆÙñThe current online version of the Handbook represents the cumulative effort of many hundreds of contributors over the past 10 years.  The following are some of the significant changes since the two volume third edition was published in 2004:Ù£å½“å‰åœ¨çº¿ç‰ˆæœ¬çš„æ‰‹å†Œä»£è¡¨äº†è¿‡å» 10 å¹´æ¥æ•°ç™¾åè´¡çŒ®è€…çš„ç´¯ç§¯åŠªåŠ›ã€‚ä»¥ä¸‹æ˜¯è‡ª 2004 å¹´å‡ºç‰ˆç¬¬ä¸‰ç‰ˆä¸¤å·æœ¬ä»¥æ¥çš„ä¸€äº›é‡å¤§å˜åŒ–ï¼šÙmcrossref:wine[wine,WINE] has been added with information about how to run Windows(R) applications on FreeBSD.Ùjæ·»åŠ äº† crossref:wine[wine,WINE]ï¼Œå…³äºå¦‚ä½•åœ¨ FreeBSD ä¸Šè¿è¡Œ Windows(R) åº”ç”¨ç¨‹åºçš„ä¿¡æ¯ã€‚Ùscrossref:dtrace[dtrace,DTrace] has been added with information about the powerful DTrace performance analysis tool.Ùccrossref:dtrace[dtrace,DTrace] æ·»åŠ äº†æœ‰å…³åŠŸèƒ½å¼ºå¤§çš„ DTrace æ€§èƒ½åˆ†æå·¥å…·çš„ä¿¡æ¯ã€‚Ù™crossref:filesystems[filesystems,Other File Systems] have been added with information about non-native file systems in FreeBSD, such as ZFS from Sun(TM).Ù‡crossref:filesystems[filesystems,å…¶ä»–æ–‡ä»¶ç³»ç»Ÿ] æ·»åŠ äº†æœ‰å…³ FreeBSD ä¸­éæœ¬åœ°æ–‡ä»¶ç³»ç»Ÿçš„ä¿¡æ¯ï¼Œå¦‚ Sun(TM) çš„ ZFSã€‚Ùƒcrossref:audit[audit,Security Event Auditing] has been added to cover the new auditing capabilities in FreeBSD and explain its use.Ùzcrossref:audit[audit,å®‰å…¨äº‹ä»¶å®¡è®¡] å¢åŠ äº†å…³äº FreeBSD ä¸­æ–°çš„å®¡è®¡åŠŸèƒ½çš„ä¿¡æ¯ï¼Œå¹¶è§£é‡Šäº†å…¶ç”¨é€”ã€‚Ù‹crossref:virtualization[virtualization,Virtualization] has been added with information about installing FreeBSD on virtualization software.Ù}crossref:virtualization[virtualization,è™šæ‹ŸåŒ–] æ·»åŠ äº†æœ‰å…³åœ¨è™šæ‹ŸåŒ–è½¯ä»¶ä¸Šå®‰è£… FreeBSD çš„ä¿¡æ¯ã€‚çš„ä¿¡æ¯ã€‚Ù’crossref:bsdinstall[bsdinstall,Installing FreeBSD] has been added to cover installation of FreeBSD using the new installation utility, bsdinstall.Ùtcrossref:bsdinstall[bsdinstall,å®‰è£… FreeBSD] æ–°å¢äº†ä½¿ç”¨æ–°å®‰è£…ç¨‹åº bsdinstall å®‰è£… FreeBSD çš„å†…å®¹ã€‚µSecond Edition (2004)·ç¬¬äºŒç‰ˆï¼ˆ2004 å¹´ï¼‰ÚThe third edition was the culmination of over two years of work by the dedicated members of the FreeBSD Documentation Project.  The printed edition grew to such a size that it was necessary to publish as two separate volumes.  The following are the major changes in this new edition:Ù½ç¬¬ä¸‰ç‰ˆæ˜¯ FreeBSD æ–‡æ¡£é¡¹ç›®ä¸“æ³¨æˆå‘˜è¶…è¿‡ä¸¤å¹´å·¥ä½œçš„å·…å³°ä¹‹ä½œã€‚å°åˆ·ç‰ˆçš„è§„æ¨¡å¢é•¿åˆ°äº†éœ€è¦åˆ†ä¸ºä¸¤å·å‡ºç‰ˆçš„ç¨‹åº¦ã€‚ä»¥ä¸‹æ˜¯è¿™ä¸ªæ–°ç‰ˆä¸­çš„ä¸»è¦å˜åŒ–ï¼šÙÇcrossref:config[config-tuning,Configuration and Tuning] has been expanded with new information about the ACPI power and resource management, the `cron` system utility, and more kernel tuning options.Ù£crossref:config[config-tuning ,é…ç½®å’Œè°ƒä¼˜] å¢åŠ äº†å…³äº ACPI ç”µæºå’Œèµ„æºç®¡ç†ã€`cron` ç³»ç»Ÿå®ç”¨ç¨‹åºä»¥åŠæ›´å¤šå†…æ ¸è°ƒä¼˜é€‰é¡¹çš„æ–°ä¿¡æ¯ã€‚Ù´crossref:security[security,Security] has been expanded with new information about virtual private networks (VPNs), file system access control lists (ACLs), and security advisories.Ù™crossref:security[security, Security] å¢åŠ äº†å…³äºè™šæ‹Ÿç§æœ‰ç½‘ç»œï¼ˆVPNï¼‰ã€æ–‡ä»¶ç³»ç»Ÿè®¿é—®æ§åˆ¶åˆ—è¡¨ï¼ˆACLsï¼‰å’Œå®‰å…¨å…¬å‘Šçš„æ–°ä¿¡æ¯ã€‚Ù¥crossref:mac[mac,Mandatory Access Control] is a new chapter with this edition. It explains what MAC is and how this mechanism can be used to secure a FreeBSD system.Ùœcrossref:mac[mac,Mandatory Access Control] æ˜¯æœ¬ç‰ˆæœ¬çš„æ–°ç« èŠ‚ã€‚å®ƒè§£é‡Šäº† MAC æ˜¯ä»€ä¹ˆï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨è¿™ç§æœºåˆ¶æ¥ä¿æŠ¤ FreeBSD ç³»ç»Ÿã€‚ÙÎcrossref:disks[disks,Storage] has been expanded with new information about USB storage devices, file system snapshots, file system quotas, file and network backed filesystems, and encrypted disk partitions.Ù¶crossref:disks[disks,Storage] å¢åŠ äº†å…³äº USB å­˜å‚¨è®¾å¤‡ã€æ–‡ä»¶ç³»ç»Ÿå¿«ç…§ã€æ–‡ä»¶ç³»ç»Ÿé…é¢ã€æ–‡ä»¶å’Œç½‘ç»œæ”¯æŒçš„æ–‡ä»¶ç³»ç»Ÿä»¥åŠåŠ å¯†ç£ç›˜åˆ†åŒºçš„æ–°ä¿¡æ¯ã€‚ÙTA troubleshooting section has been added to crossref:ppp-and-slip[ppp-and-slip,PPP].ÙJå‘ crossref:ppp-and-slip[ppp-and-slip,PPP] æ·»åŠ äº†æ•…éšœæ’é™¤éƒ¨åˆ†ã€‚Ù¿crossref:mail[mail,Electronic Mail] has been expanded with new information about using alternative transport agents, SMTP authentication, UUCP, fetchmail, procmail, and other advanced topics.ÙŸcrossref:mail[mail,ç”µå­é‚®ä»¶] æ‰©å±•äº†å…³äºä½¿ç”¨æ›¿ä»£ä¼ è¾“ä»£ç†ã€SMTP èº«ä»½éªŒè¯ã€UUCPã€fetchmailã€procmail å’Œå…¶ä»–é«˜çº§ä¸»é¢˜çš„æ–°ä¿¡æ¯ã€‚Úvcrossref:network-servers[network-servers,Network Servers] is all new with this edition. This chapter includes information about setting up the Apache HTTP Server, ftpd, and setting up a server for Microsoft(R) Windows(R) clients with Samba. Some sections from crossref:advanced-networking[advanced-networking,Advanced Networking] were moved here to improve the presentation.Úgcrossref:network-servers[network-servers,ç½‘ç»œæœåŠ¡å™¨] åœ¨æœ¬ç‰ˆä¸­æ˜¯å…¨æ–°çš„ã€‚æœ¬ç« åŒ…æ‹¬æœ‰å…³è®¾ç½® Apache HTTP æœåŠ¡å™¨ã€ftpd ä»¥åŠä½¿ç”¨ Samba ä¸º Microsoft(R) Windows(R) å®¢æˆ·ç«¯è®¾ç½®æœåŠ¡å™¨çš„ä¿¡æ¯ã€‚ä¸ºäº†æ”¹å–„å‘ˆç°æ•ˆæœï¼Œä¸€äº›æ¥è‡ª crossref:advanced-networking[advanced-networking ,é«˜çº§ç½‘ç»œ] çš„éƒ¨åˆ†å†…å®¹è¢«ç§»è‡³æ­¤å¤„ã€‚Ùêcrossref:advanced-networking[advanced-networking,Advanced Networking] has been expanded with new information about using Bluetooth(R) devices with FreeBSD, setting up wireless networks, and Asynchronous Transfer Mode (ATM) networking.Ù·crossref:advanced-networking[advanced-networking,é«˜çº§ç½‘ç»œ] å¢åŠ äº†å…³äºåœ¨ FreeBSD ä¸Šä½¿ç”¨è“ç‰™è®¾å¤‡ã€è®¾ç½®æ— çº¿ç½‘ç»œå’Œå¼‚æ­¥ä¼ è¾“æ¨¡å¼ï¼ˆATMï¼‰ç½‘ç»œçš„æ–°ä¿¡æ¯ã€‚ÙxA glossary has been added to provide a central location for the definitions of technical terms used throughout the book.Ùcæ·»åŠ æœ¯è¯­è¡¨ï¼Œä»¥æä¾›ä¸€ä¸ªé›†ä¸­çš„ä½ç½®ï¼Œç”¨äºå®šä¹‰æ•´æœ¬ä¹¦ä¸­ä½¿ç”¨çš„æŠ€æœ¯æœ¯è¯­ã€‚Ù`A number of aesthetic improvements have been made to the tables and figures throughout the book.Ù?å¯¹æœ¬ä¹¦ä¸­çš„è¡¨æ ¼å’Œå›¾è¡¨è¿›è¡Œäº†ä¸€äº›ç¾è§‚çš„æ”¹è¿›ã€‚´First Edition (2001)·ç¬¬ä¸€ç‰ˆï¼ˆ2001 å¹´ï¼‰Ù¶The second edition was the culmination of over two years of work by the dedicated members of the FreeBSD Documentation Project.  The following were the major changes in this edition:Ùoç¬¬äºŒç‰ˆæ˜¯ FreeBSD æ–‡æ¡£é¡¹ç›®ä¸“æ³¨æˆå‘˜ä¸¤å¹´å¤šå·¥ä½œçš„å·…å³°ä¹‹ä½œã€‚ä»¥ä¸‹æ˜¯æœ¬ç‰ˆçš„ä¸»è¦å˜åŒ–ï¼šÙ A complete Index has been added.µæ·»åŠ å®Œæ•´ç´¢å¼•ã€‚Ù;All ASCII figures have been replaced by graphical diagrams.Ù=æ‰€æœ‰çš„ ASCII å›¾å½¢éƒ½å·²è¢«æ›¿æ¢ä¸ºå›¾å½¢åŒ–çš„å›¾è¡¨ã€‚ÙA standard synopsis has been added to each chapter to give a quick summary of what information the chapter contains, and what the reader is expected to know.Ù~æ¯ä¸ªç« èŠ‚éƒ½æ·»åŠ äº†ä¸€ä¸ªæ ‡å‡†çš„ç®€ä»‹ï¼Œä»¥ä¾¿å¿«é€Ÿæ¦‚è¿°è¯¥ç« èŠ‚åŒ…å«çš„ä¿¡æ¯ä»¥åŠè¯»è€…åº”è¯¥äº†è§£çš„å†…å®¹ã€‚ÙzThe content has been logically reorganized into three parts: "Getting Started", "System Administration", and "Appendices".Ùoå†…å®¹å·²ç»åœ¨é€»è¾‘ä¸Šé‡æ–°ç»„ç»‡æˆä¸‰ä¸ªéƒ¨åˆ†ï¼šâ€œå…¥é—¨æŒ‡å—â€ï¼Œâ€œç³»ç»Ÿç®¡ç†â€å’Œâ€œé™„å½•â€ã€‚Ùcrossref:basics[basics,FreeBSD Basics] has been expanded to contain additional information about processes, daemons, and signals.Ùƒå¯¹ crossref:basics[basics, FreeBSD åŸºç¡€çŸ¥è¯†] è¿›è¡Œäº†æ‰©å±•ï¼ŒåŒ…å«äº†å…³äºè¿›ç¨‹ã€å®ˆæŠ¤è¿›ç¨‹å’Œä¿¡å·çš„é¢å¤–ä¿¡æ¯ã€‚Ù–crossref:ports[ports,Installing Applications: Packages and Ports] has been expanded to contain additional information about binary package management.Ùˆå¯¹ crossref:ports[ports ,å®‰è£…åº”ç”¨ç¨‹åºï¼šè½¯ä»¶åŒ…å’Œç«¯å£] è¿›è¡Œäº†æ‰©å±•ï¼ŒåŒ…å«äº†å…³äºäºŒè¿›åˆ¶åŒ…ç®¡ç†çš„é¢å¤–ä¿¡æ¯ã€‚Ù£crossref:x11[x11,The X Window System] has been completely rewritten with an emphasis on using modern desktop technologies such as KDE and GNOME on XFree86(TM) 4.X.Ù‡crossref:x11[x11,X Window ç³»ç»Ÿ] ç« èŠ‚å®Œå…¨é‡å†™ï¼Œé‡ç‚¹æ˜¯ä½¿ç”¨ç°ä»£æ¡Œé¢æŠ€æœ¯ï¼Œå¦‚ KDE å’Œ GNOME åœ¨ XFree86(TM) 4.X ä¸Šã€‚ÙBcrossref:boot[boot,The FreeBSD Booting Process] has been expanded.Ù@å¯¹ crossref:boot[boot, FreeBSD å¼•å¯¼è¿‡ç¨‹] è¿›è¡Œäº†æ‰©å±•ã€‚Úcrossref:disks[disks,Storage] has been written from what used to be two separate chapters on "Disks" and "Backups". We feel that the topics are easier to comprehend when presented as a single chapter. A section on RAID (both hardware and software) has also been added.Ùücrossref:disks[disks,å­˜å‚¨] ä¸€ç« æ˜¯ç”±åŸæœ¬åˆ†ä¸º"ç£ç›˜"å’Œ"å¤‡ä»½"ä¸¤ä¸ªç« èŠ‚åˆå¹¶è€Œæˆçš„ã€‚æˆ‘ä»¬è®¤ä¸ºå°†è¿™äº›ä¸»é¢˜ä½œä¸ºä¸€ä¸ªå•ç‹¬çš„ç« èŠ‚å‘ˆç°æ›´å®¹æ˜“ç†è§£ã€‚åŒæ—¶ï¼Œè¿˜æ·»åŠ äº†ä¸€ä¸ªå…³äº RAID ï¼ˆç¡¬ä»¶å’Œè½¯ä»¶ï¼‰çš„éƒ¨åˆ†ã€‚Ùxcrossref:serialcomms[serialcomms,Serial Communications] has been completely reorganized and updated for FreeBSD 4.X/5.X.Ùycrossref:serialcomms[serialcomms,Serial Communications] ç« èŠ‚å®Œå…¨é‡æ–°ç»„ç»‡å’Œæ›´æ–°ï¼Œé€‚ç”¨äº FreeBSD 4.X/5.X ã€‚ÙGcrossref:ppp-and-slip[ppp-and-slip,PPP] has been substantially updated.ÙFcrossref:ppp-and-slip[ppp-and-slip,PPP] ç« èŠ‚è¿›è¡Œäº†é‡å¤§æ›´æ–°ã€‚ÙkMany new sections have been added to crossref:advanced-networking[advanced-networking,Advanced Networking].Ù`crossref:advanced-networking[advanced-networking,é«˜çº§ç½‘ç»œ] ä¸­æ·»åŠ äº†è®¸å¤šæ–°çš„éƒ¨åˆ†ã€‚Ùmcrossref:mail[mail,Electronic Mail] has been expanded to include more information about configuring sendmail.Ùcå¯¹ crossref:mail[mail ,ç”µå­é‚®ä»¶] è¿›è¡Œæ‰©å±•ï¼ŒåŒ…æ‹¬æ›´å¤šå…³äºé…ç½® sendmail çš„ä¿¡æ¯ã€‚Ùcrossref:linuxemu[linuxemu,LinuxÂ® Binary Compatibility] has been expanded to include information about installing Oracle(R) and SAP(R) R/3(R).Ù†å¯¹ crossref:linuxemu[linuxemu, LinuxÂ® äºŒè¿›åˆ¶å…¼å®¹æ€§] è¿›è¡Œäº†æ‰©å±•ï¼ŒåŒ…æ‹¬äº†å®‰è£… Oracle(R) å’Œ SAP(R) R/3(R) çš„ä¿¡æ¯ã€‚Ù<The following new topics are covered in this second edition:Ù'æœ¬ç¬¬äºŒç‰ˆæ¶µç›–äº†ä»¥ä¸‹æ–°ä¸»é¢˜ï¼šÙ8crossref:config[config-tuning,Configuration and Tuning].Ù1crossref:config[config-tuning,é…ç½®å’Œè°ƒä¼˜]ã€‚Ù+crossref:multimedia[multimedia,Multimedia].Ù,crossref:multimedia[multimedia,å¤šåª’ä½“]ã€‚¹Organization of This Bookµæœ¬ä¹¦çš„ç»„ç»‡ç»“æ„ÚiThis book is split into five logically distinct sections.  The first section, _Getting Started_, covers the installation and basic usage of FreeBSD.  It is expected that the reader will follow these chapters in sequence, possibly skipping chapters covering familiar topics.  The second section, _Common Tasks_, covers some frequently used features of FreeBSD.  This section, and all subsequent sections, can be read out of order.  Each chapter begins with a succinct synopsis that describes what the chapter covers and what the reader is expected to already know.  This is meant to allow the casual reader to skip around to find chapters of interest.  The third section, _System Administration_, covers administration topics.  The fourth section, _Network Communication_, covers networking and server topics.  The fifth section contains appendices of reference information.Ú‘æœ¬ä¹¦åˆ†ä¸ºäº”ä¸ªé€»è¾‘ä¸Šç‹¬ç«‹çš„éƒ¨åˆ†ã€‚ç¬¬ä¸€éƒ¨åˆ†æ˜¯ _å…¥é—¨_ï¼Œä»‹ç»äº† FreeBSD çš„å®‰è£…å’ŒåŸºæœ¬ä½¿ç”¨ã€‚é¢„è®¡è¯»è€…ä¼šæŒ‰ç…§ç« èŠ‚çš„é¡ºåºé˜…è¯»ï¼Œå¯èƒ½ä¼šè·³è¿‡ç†Ÿæ‚‰çš„ä¸»é¢˜ç« èŠ‚ã€‚ç¬¬äºŒéƒ¨åˆ†æ˜¯ _å¸¸è§ä»»åŠ¡_ï¼Œä»‹ç»äº† FreeBSD çš„ä¸€äº›å¸¸ç”¨åŠŸèƒ½ã€‚è¿™éƒ¨åˆ†ä»¥åŠåç»­çš„éƒ¨åˆ†å¯ä»¥æŒ‰ä»»æ„é¡ºåºé˜…è¯»ã€‚æ¯ä¸ªç« èŠ‚éƒ½ä»¥ç®€æ´çš„æ‘˜è¦å¼€å§‹ï¼Œæè¿°äº†ç« èŠ‚å†…å®¹å’Œè¯»è€…æ‰€éœ€çš„åŸºç¡€çŸ¥è¯†ã€‚è¿™æ ·å¯ä»¥è®©è¯»è€…éšæ„è·³è½¬åˆ°æ„Ÿå…´è¶£çš„ç« èŠ‚ã€‚ç¬¬ä¸‰éƒ¨åˆ†æ˜¯ _ç³»ç»Ÿç®¡ç†_ï¼Œä»‹ç»äº†ç®¡ç†ä¸»é¢˜ã€‚ç¬¬å››éƒ¨åˆ†æ˜¯ _ç½‘ç»œé€šä¿¡_ï¼Œä»‹ç»äº†ç½‘ç»œå’ŒæœåŠ¡å™¨ä¸»é¢˜ã€‚ç¬¬äº”éƒ¨åˆ†åŒ…å«å‚è€ƒä¿¡æ¯çš„é™„å½•ã€‚Ù&_crossref:introduction[,Introduction]_Ù-_crossref:introduction[introduction, å¯¼è¨€]_ÙsIntroduces FreeBSD to a new user. It describes the history of the FreeBSD Project, its goals and development model.Ùcæœ¬æ–‡å‘æ–°ç”¨æˆ·ä»‹ç» FreeBSD ã€‚å®ƒæè¿°äº† FreeBSD é¡¹ç›®çš„å†å²ã€ç›®æ ‡å’Œå¼€å‘æ¨¡å‹ã€‚Ù4_crossref:bsdinstall[bsdinstall,Installing FreeBSD]_Ù1_crossref:bsdinstall[bsdinstall, å®‰è£… FreeBSD]_ÙaWalks a user through the entire installation process of FreeBSD 9._x_ and later using bsdinstall.Ù[ä½¿ç”¨ bsdinstallï¼Œå¼•å¯¼ç”¨æˆ·å®Œæˆ FreeBSD 9._x_åŠæ›´é«˜ç‰ˆæœ¬çš„å®Œæ•´å®‰è£…è¿‡ç¨‹ã€‚Ù(_crossref:basics[basics,FreeBSD Basics]_Ù/_crossref:basics[basics, FreeBSD åŸºç¡€çŸ¥è¯†]_Ù´Covers the basic commands and functionality of the FreeBSD operating system. If you are familiar with Linux(R) or another flavor of UNIX(R) then you can probably skip this chapter.Ù”ä»‹ç»äº† FreeBSD æ“ä½œç³»ç»Ÿçš„åŸºæœ¬å‘½ä»¤å’ŒåŠŸèƒ½ã€‚å¦‚æœæ‚¨ç†Ÿæ‚‰ Linux(R) æˆ–å…¶ä»– UNIX(R) çš„å˜ç§ï¼Œé‚£ä¹ˆæ‚¨å¯èƒ½å¯ä»¥è·³è¿‡æœ¬ç« ã€‚ÙC_crossref:ports[ports,Installing Applications: Packages and Ports]_Ù@_crossref:ports[ports ,å®‰è£…åº”ç”¨ç¨‹åºï¼šè½¯ä»¶åŒ…å’Œ Ports]_ÙCovers the installation of third-party software with both FreeBSD's innovative "Ports Collection" and standard binary packages.Ùyæœ¬æ–‡ä»‹ç»äº†ä½¿ç”¨ FreeBSD åˆ›æ–°çš„â€œPorts Collectionâ€å’Œæ ‡å‡†äºŒè¿›åˆ¶è½¯ä»¶åŒ…å®‰è£…ç¬¬ä¸‰æ–¹è½¯ä»¶çš„æ–¹æ³•ã€‚Ù'_crossref:x11[x11,The X Window System]_Ù$_crossref:x11[x11, X Window ç³»ç»Ÿ]_Ù’Describes the X Window System in general and using X11 on FreeBSD in particular. Also describes common desktop environments such as KDE and GNOME.Ù“æè¿°äº† X Window System çš„ä¸€èˆ¬æƒ…å†µï¼Œç‰¹åˆ«æ˜¯åœ¨ FreeBSD ä¸Šä½¿ç”¨ X11 çš„æƒ…å†µã€‚è¿˜æè¿°äº†å¸¸è§çš„æ¡Œé¢ç¯å¢ƒï¼Œå¦‚ KDE å’Œ GNOMEã€‚Ù#_crossref:wayland[wayland,Wayland]_Ù$_crossref:wayland[wayland, Wayland]_ÙŸDescribes the Wayland display server in general and using Wayland on FreeBSD in particular. Also describes common compositors such as Wayfire, Hikari and Sway.Ù§æè¿°äº† Wayland æ˜¾ç¤ºæœåŠ¡å™¨çš„ä¸€èˆ¬æƒ…å†µï¼Œç‰¹åˆ«æ˜¯åœ¨ FreeBSD ä¸Šä½¿ç”¨ Wayland çš„æƒ…å†µã€‚è¿˜æè¿°äº†å¸¸è§çš„åˆæˆå™¨ï¼Œå¦‚ Wayfireã€Hikari å’Œ Swayã€‚Ù0_crossref:desktop[desktop,Desktop Applications]_Ù._crossref:desktop[desktop,æ¡Œé¢åº”ç”¨ç¨‹åº]_ÙƒLists some common desktop applications, such as web browsers and productivity suites, and describes how to install them on FreeBSD.Ùåˆ—ä¸¾äº†ä¸€äº›å¸¸è§çš„æ¡Œé¢åº”ç”¨ç¨‹åºï¼Œå¦‚ç½‘ç»œæµè§ˆå™¨å’ŒåŠå…¬å¥—ä»¶ï¼Œå¹¶æè¿°äº†å¦‚ä½•åœ¨ FreeBSD ä¸Šå®‰è£…å®ƒä»¬ã€‚Ù,_crossref:multimedia[multimedia,Multimedia]_Ù+_crossref:multimedia[multimedia,å¤šåª’ä½“]_Ù~Shows how to set up sound and video playback support for your system. Also describes some sample audio and video applications.Ùxå±•ç¤ºäº†å¦‚ä½•ä¸ºæ‚¨çš„ç³»ç»Ÿè®¾ç½®éŸ³é¢‘å’Œè§†é¢‘æ’­æ”¾æ”¯æŒã€‚è¿˜ä»‹ç»äº†ä¸€äº›ç¤ºä¾‹éŸ³é¢‘å’Œè§†é¢‘åº”ç”¨ç¨‹åºã€‚ÙD_crossref:kernelconfig[kernelconfig,Configuring the FreeBSD Kernel]_Ù;_crossref:kernelconfig[kernelconfig,é…ç½® FreeBSD å†…æ ¸]_Ù“Explains why you might need to configure a new kernel and provides detailed instructions for configuring, building, and installing a custom kernel.Ù„è§£é‡Šäº†ä¸ºä»€ä¹ˆæ‚¨å¯èƒ½éœ€è¦é…ç½®ä¸€ä¸ªæ–°çš„å†…æ ¸ï¼Œå¹¶æä¾›äº†è¯¦ç»†çš„é…ç½®ã€æ„å»ºå’Œå®‰è£…è‡ªå®šä¹‰å†…æ ¸çš„æŒ‡ä»¤ã€‚Ù&_crossref:printing[printing,Printing]_Ù%_crossref:printing[printing ,æ‰“å°]_ÙxDescribes managing printers on FreeBSD, including information about banner pages, printer accounting, and initial setup.Ùxæè¿°äº†åœ¨ FreeBSD ä¸Šç®¡ç†æ‰“å°æœºçš„æ–¹æ³•ï¼ŒåŒ…æ‹¬æœ‰å…³æ¨ªå¹…é¡µé¢ã€æ‰“å°æœºè®¡è´¹å’Œåˆå§‹è®¾ç½®çš„ä¿¡æ¯ã€‚Ù:_crossref:linuxemu[linuxemu,LinuxÂ® Binary Compatibility]_Ù;_crossref:linuxemu[linuxemu , Linux(R) äºŒè¿›åˆ¶å…¼å®¹æ€§]_Ù·Describes the Linux(R) compatibility features of FreeBSD. Also provides detailed installation instructions for many popular Linux(R) applications such as Oracle(R) and Mathematica(R).Ùæè¿°äº† FreeBSD çš„ Linux(R) å…¼å®¹åŠŸèƒ½ã€‚è¿˜æä¾›äº†è®¸å¤šæµè¡Œçš„ Linux(R) åº”ç”¨ç¨‹åºï¼ˆå¦‚ Oracle(R) å’Œ Mathematica(R)ï¼‰çš„è¯¦ç»†å®‰è£…è¯´æ˜ã€‚º_crossref:wine[wine,WINE]_º_crossref:wine[wine,WINE]_ÙÒDescribes WINE and provides detailed installation instructions. Also describes how WINE operates, how to install a GUI helper, how to run Windows(R) applications on FreeBSD, and offers other tips and solutions.ÙÎæè¿°äº† WINE å¹¶æä¾›äº†è¯¦ç»†çš„å®‰è£…è¯´æ˜ã€‚è¿˜æè¿°äº† WINE çš„æ“ä½œæ–¹å¼ï¼Œå¦‚ä½•å®‰è£… GUI åŠ©æ‰‹ï¼Œå¦‚ä½•åœ¨ FreeBSD ä¸Šè¿è¡Œ Windows(R) åº”ç”¨ç¨‹åºï¼Œå¹¶æä¾›å…¶ä»–æç¤ºå’Œè§£å†³æ–¹æ¡ˆã€‚Ù9_crossref:config[config-tuning,Configuration and Tuning]_Ù1_crossref:config[config-tuning ,é…ç½®å’Œè°ƒä¼˜]_ÙÅDescribes the parameters available for system administrators to tune a FreeBSD system for optimum performance. Also describes the various configuration files used in FreeBSD and where to find them.Ù¢æè¿°äº†ç³»ç»Ÿç®¡ç†å‘˜å¯ä»¥è°ƒæ•´ FreeBSD ç³»ç»Ÿä»¥è·å¾—æœ€ä½³æ€§èƒ½çš„å‚æ•°ã€‚è¿˜æè¿°äº†åœ¨ FreeBSD ä¸­ä½¿ç”¨çš„å„ç§é…ç½®æ–‡ä»¶ä»¥åŠå®ƒä»¬çš„ä½ç½®ã€‚Ù1_crossref:boot[boot,The FreeBSD Booting Process]_Ù+_crossref:boot[boot, FreeBSD å¼•å¯¼è¿‡ç¨‹]_ÙgDescribes the FreeBSD boot process and explains how to control this process with configuration options.Ù`æè¿°äº† FreeBSD çš„å¯åŠ¨è¿‡ç¨‹ï¼Œå¹¶è§£é‡Šäº†å¦‚ä½•é€šè¿‡é…ç½®é€‰é¡¹æ¥æ§åˆ¶è¿™ä¸ªè¿‡ç¨‹ã€‚Ù&_crossref:security[security,Security]_Ù$_crossref:security[security,å®‰å…¨]_ÙxDescribes many different tools available to help keep your FreeBSD system secure, including Kerberos, IPsec and OpenSSH.Ù€æè¿°äº†è®¸å¤šä¸åŒçš„å·¥å…·ï¼Œå¯ç”¨äºå¸®åŠ©ä¿æŠ¤æ‚¨çš„ FreeBSD ç³»ç»Ÿçš„å®‰å…¨æ€§ï¼ŒåŒ…æ‹¬ Kerberosã€IPsec å’Œ OpenSSHã€‚½_crossref:jails[jails,Jails]_½_crossref:jails[jails,Jails]_ÙlDescribes the jails framework, and the improvements of jails over the traditional chroot support of FreeBSD.Ù^æè¿°äº† FreeBSD ä¸­çš„ jails æ¡†æ¶ä»¥åŠ jails ç›¸å¯¹äºä¼ ç»Ÿçš„ chroot æ”¯æŒçš„æ”¹è¿›ã€‚Ù,_crossref:mac[mac,Mandatory Access Control]_Ù&_crossref:mac[mac,å¼ºåˆ¶è®¿é—®æ§åˆ¶]_ÙnExplains what Mandatory Access Control (MAC) is and how this mechanism can be used to secure a FreeBSD system.Ù‚è§£é‡Šäº†å¼ºåˆ¶è®¿é—®æ§åˆ¶ï¼ˆMandatory Access Control,MACï¼‰æ˜¯ä»€ä¹ˆï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨è¿™ç§æœºåˆ¶æ¥ä¿æŠ¤ FreeBSD ç³»ç»Ÿã€‚Ù/_crossref:audit[audit,Security Event Auditing]_Ù*_crossref:audit[audit,å®‰å…¨äº‹ä»¶å®¡è®¡]_Ù‚Describes what FreeBSD Event Auditing is, how it can be installed, configured, and how audit trails can be inspected or monitored.Ùiæè¿°äº†ä»€ä¹ˆæ˜¯ FreeBSD äº‹ä»¶å®¡è®¡ï¼Œå¦‚ä½•å®‰è£…ã€é…ç½®ä»¥åŠå¦‚ä½•æ£€æŸ¥æˆ–ç›‘æ§å®¡è®¡æ—¥å¿—ã€‚¿_crossref:disks[disks,Storage]_¾_crossref:disks[disks,å­˜å‚¨]_Ù´Describes how to manage storage media and filesystems with FreeBSD. This includes physical disks, RAID arrays, optical and tape media, memory-backed disks, and network filesystems.Ù­æè¿°äº†å¦‚ä½•ä½¿ç”¨ FreeBSD ç®¡ç†å­˜å‚¨ä»‹è´¨å’Œæ–‡ä»¶ç³»ç»Ÿã€‚è¿™åŒ…æ‹¬ç‰©ç†ç£ç›˜ã€RAID é˜µåˆ—ã€å…‰ç›˜å’Œç£å¸¦ä»‹è´¨ã€å†…å­˜æ”¯æŒçš„ç£ç›˜å’Œç½‘ç»œæ–‡ä»¶ç³»ç»Ÿã€‚ÙA_crossref:geom[geom,GEOM: Modular Disk Transformation Framework]_Ù9_crossref:geom[geom, GEOMï¼šæ¨¡å—åŒ–ç£ç›˜è½¬æ¢æ¡†æ¶]_ÙcDescribes what the GEOM framework in FreeBSD is and how to configure various supported RAID levels.Ù]æè¿°äº† FreeBSD ä¸­çš„ GEOM æ¡†æ¶æ˜¯ä»€ä¹ˆä»¥åŠå¦‚ä½•é…ç½®å„ç§æ”¯æŒçš„ RAID çº§åˆ«ã€‚Ù0_crossref:zfs[zfs,The OpenZFS storage platform]_Ù)_crossref:zfs[zfs, OpenZFS å­˜å‚¨å¹³å°]_ÙŒDescribes the OpenZFS storage platform and provides a quick-start guide and information about advanced topics running OpenZFS under FreeBSD.Ùæè¿°äº† OpenZFS å­˜å‚¨å¹³å°ï¼Œå¹¶æä¾›äº†ä¸€ä¸ªå¿«é€Ÿå…¥é—¨æŒ‡å—ï¼Œä»¥åŠå…³äºåœ¨ FreeBSD ä¸‹è¿è¡Œ OpenZFS çš„é«˜çº§ä¸»é¢˜çš„ä¿¡æ¯ã€‚Ù6_crossref:filesystems[filesystems,Other File Systems]_Ù6_crossref:filesystems[filesystems,å…¶ä»–æ–‡ä»¶ç³»ç»Ÿ]_ÙTExamines support for non-native file systems under FreeBSD like ext2, ext3 and ext4.ÙUç ”ç©¶äº† FreeBSD å¯¹éæœ¬åœ°æ–‡ä»¶ç³»ç»Ÿï¼ˆå¦‚ ext2ã€ ext3 å’Œ ext4ï¼‰çš„æ”¯æŒã€‚Ù8_crossref:virtualization[virtualization,Virtualization]_Ù3_crossref:virtualization[virtualization,è™šæ‹ŸåŒ–]_ÙSDescribes what virtualization systems offer, and how they can be used with FreeBSD.ÙQæè¿°äº†è™šæ‹ŸåŒ–ç³»ç»Ÿæä¾›çš„åŠŸèƒ½ä»¥åŠå¦‚ä½•åœ¨ FreeBSD ä¸Šä½¿ç”¨å®ƒä»¬ã€‚Ù>_crossref:l10n[l10n,Localization - i18n/L10n Usage and Setup]_Ù>_crossref:l10n[l10n,æœ¬åœ°åŒ– - i18n/L10n çš„ä½¿ç”¨å’Œè®¾ç½®]_ÙtDescribes how to use FreeBSD in languages other than English. Covers both system and application level localization.Ùnæè¿°äº†å¦‚ä½•åœ¨éè‹±è¯­è¯­è¨€ç¯å¢ƒä¸­ä½¿ç”¨ FreeBSDã€‚æ¶µç›–äº†ç³»ç»Ÿå’Œåº”ç”¨ç¨‹åºçº§åˆ«çš„æœ¬åœ°åŒ–ã€‚ÙJ_crossref:cutting-edge[updating-upgrading,Updating and Upgrading FreeBSD]_ÙC_crossref:cutting-edge[updating-upgrading,æ›´æ–°å’Œå‡çº§ FreeBSD]_ÚExplains the differences between FreeBSD-STABLE, FreeBSD-CURRENT, and FreeBSD releases. Describes which users would benefit from tracking a development system and outlines that process. Covers the methods users may take to update their system to the latest security release.Ùôè§£é‡Šäº† FreeBSD-STABLEã€FreeBSD-CURRENT å’Œ FreeBSD å‘å¸ƒç‰ˆä¹‹é—´çš„åŒºåˆ«ã€‚æè¿°äº†å“ªäº›ç”¨æˆ·ä¼šä»è·Ÿè¸ªå¼€å‘ç³»ç»Ÿä¸­å—ç›Šï¼Œå¹¶æ¦‚è¿°äº†è¯¥è¿‡ç¨‹ã€‚ä»‹ç»äº†ç”¨æˆ·å¯ä»¥é‡‡å–çš„æ–¹æ³•æ¥æ›´æ–°ç³»ç»Ÿåˆ°æœ€æ–°çš„å®‰å…¨å‘å¸ƒç‰ˆã€‚Ù _crossref:dtrace[dtrace,DTrace]_Ù"_crossref:dtrace[dtrace , DTrace]_Ù¨Describes how to configure and use the DTrace tool from Sun(TM) on FreeBSD. Dynamic tracing can help locate performance issues, by performing real time system analysis.Ù•æè¿°äº†å¦‚ä½•åœ¨ FreeBSD ä¸Šé…ç½®å’Œä½¿ç”¨ Sun(TM) çš„ DTrace å·¥å…·ã€‚é€šè¿‡è¿›è¡Œå®æ—¶ç³»ç»Ÿåˆ†æï¼ŒåŠ¨æ€è·Ÿè¸ªå¯å¸®åŠ©å®šä½æ€§èƒ½é—®é¢˜ã€‚ÙE_crossref:usb-device-mode[usb-device-mode,USB Device Mode / USB OTG]_ÙD_crossref:usb-device-mode[usb-device-mode,USB è®¾å¤‡æ¨¡å¼/USB OTG]_ÙKExplains the use of USB Device Mode and USB On The Go (USB OTG) on FreeBSD.ÙYè§£é‡Šäº†åœ¨ FreeBSD ä¸Šä½¿ç”¨ USB è®¾å¤‡æ¨¡å¼å’Œ USB On The Goï¼ˆUSB OTGï¼‰çš„æ–¹æ³•ã€‚Ù)_crossref:ppp-and-slip[ppp-and-slip,PPP]_Ù)_crossref:ppp-and-slip[ppp-and-slip,PPP]_ÙADescribes how to use PPP to connect to remote systems in FreeBSD.ÙAæè¿°äº†å¦‚ä½•åœ¨ FreeBSD ä¸­ä½¿ç”¨ PPP è¿æ¥åˆ°è¿œç¨‹ç³»ç»Ÿã€‚Ù%_crossref:mail[mail,Electronic Mail]_Ù"_crossref:mail[mail,ç”µå­é‚®ä»¶]_Ù”Explains the different components of an email server and dives into simple configuration topics for the most popular mail server software: sendmail.Ù…è§£é‡Šäº†ç”µå­é‚®ä»¶æœåŠ¡å™¨çš„ä¸åŒç»„ä»¶ï¼Œå¹¶æ·±å…¥æ¢è®¨äº†æœ€æµè¡Œçš„é‚®ä»¶æœåŠ¡å™¨è½¯ä»¶ sendmail çš„ç®€å•é…ç½®ä¸»é¢˜ã€‚Ù;_crossref:network-servers[network-servers,Network Servers]_Ù;_crossref:network-servers[network-servers,ç½‘ç»œæœåŠ¡å™¨]_ÙÔProvides detailed instructions and example configuration files to set up your FreeBSD machine as a network filesystem server, domain name server, network information system server, or time synchronization server.Ù·æä¾›è¯¦ç»†çš„è¯´æ˜å’Œç¤ºä¾‹é…ç½®æ–‡ä»¶ï¼Œä»¥å°†æ‚¨çš„ FreeBSD æœºå™¨è®¾ç½®ä¸ºç½‘ç»œæ–‡ä»¶ç³»ç»ŸæœåŠ¡å™¨ã€åŸŸåæœåŠ¡å™¨ã€ç½‘ç»œä¿¡æ¯ç³»ç»ŸæœåŠ¡å™¨æˆ–æ—¶é—´åŒæ­¥æœåŠ¡å™¨ã€‚Ù)_crossref:firewalls[firewalls,Firewalls]_Ù*_crossref:firewalls[firewalls, Firewalls]_Ù£Explains the philosophy behind software-based firewalls and provides detailed information about the configuration of the different firewalls available for FreeBSD.Ùè§£é‡Šäº†åŸºäºè½¯ä»¶çš„é˜²ç«å¢™èƒŒåçš„å“²å­¦ï¼Œå¹¶æä¾›æœ‰å…³å¯ç”¨äº FreeBSD çš„ä¸åŒé˜²ç«å¢™çš„é…ç½®çš„è¯¦ç»†ä¿¡æ¯ã€‚ÙG_crossref:advanced-networking[advanced-networking,Advanced Networking]_Ù@_crossref:advanced-networking[advanced-networking,é«˜çº§ç½‘ç»œ]_ÙÂDescribes many networking topics, including sharing an Internet connection with other computers on your LAN, advanced routing topics, wireless networking, Bluetooth(R), ATM, IPv6, and much more.Ù¡æè¿°äº†è®¸å¤šç½‘ç»œä¸»é¢˜ï¼ŒåŒ…æ‹¬åœ¨å±€åŸŸç½‘ä¸Šä¸å…¶ä»–è®¡ç®—æœºå…±äº«äº’è”ç½‘è¿æ¥ã€é«˜çº§è·¯ç”±ä¸»é¢˜ã€æ— çº¿ç½‘ç»œã€è“ç‰™(R)ã€ATMã€IPv6 ç­‰ç­‰ã€‚Ù-_crossref:mirrors[mirrors,Obtaining FreeBSD]_Ù*_crossref:mirrors[mirrors,è·å– FreeBSD]_ÙLists different sources for obtaining FreeBSD media on CDROM or DVD as well as different sites on the Internet that allow you to download and install FreeBSD.Ù€åˆ—å‡ºäº†è·å– FreeBSD å…‰ç›˜æˆ– DVD çš„ä¸åŒæ¥æºï¼Œä»¥åŠå…è®¸æ‚¨ä¸‹è½½å’Œå®‰è£… FreeBSD çš„äº’è”ç½‘ä¸Šçš„ä¸åŒç½‘ç«™ã€‚Ù2_crossref:bibliography[bibliography,Bibliography]_Ù3_crossref:bibliography[bibliography ,å‚è€ƒæ–‡çŒ®]_Ù´This book touches on many different subjects that may leave you hungry for a more detailed explanation. The bibliography lists many excellent books that are referenced in the text.Ùè¿™æœ¬ä¹¦æ¶‰åŠäº†è®¸å¤šä¸åŒçš„ä¸»é¢˜ï¼Œå¯èƒ½ä¼šè®©ä½ æ¸´æœ›æ›´è¯¦ç»†çš„è§£é‡Šã€‚å‚è€ƒä¹¦ç›®åˆ—å‡ºäº†æ–‡æœ¬ä¸­å¼•ç”¨çš„è®¸å¤šä¼˜ç§€ä¹¦ç±ã€‚Ù;_crossref:eresources[eresources,Resources on the Internet]_Ù2_crossref:eresources[eresources ,äº’è”ç½‘èµ„æº]_Ù|Describes the many forums available for FreeBSD users to post questions and engage in technical conversations about FreeBSD.Ùcæè¿°äº†è®¸å¤šå¯ä¾› FreeBSD ç”¨æˆ·å‘å¸ƒé—®é¢˜å’Œå‚ä¸æœ‰å…³ FreeBSD çš„æŠ€æœ¯è®¨è®ºçš„è®ºå›ã€‚Ù(_crossref:pgpkeys[pgpkeys,OpenPGP Keys]_Ù,_crossref:pgpkeys[pgpkeys , OpenPGP å¯†é’¥]_Ù9Lists the PGP fingerprints of several FreeBSD Developers.Ù2åˆ—å‡ºäº†å‡ ä½ FreeBSD å¼€å‘è€…çš„ PGP æŒ‡çº¹ã€‚½Conventions used in this book¸æœ¬ä¹¦ä¸­ä½¿ç”¨çš„çº¦å®šÙdTo provide a consistent and easy to read text, several conventions are followed throughout the book.ÙKä¸ºäº†æä¾›ä¸€è‡´ä¸”æ˜“äºé˜…è¯»çš„æ–‡æœ¬ï¼Œæœ¬ä¹¦éµå¾ªäº†å‡ ä¸ªçº¦å®šã€‚·Typographic Conventions¬æ’ç‰ˆçº¦å®š¨_Italic_¨_æ–œä½“_ÙfAn _italic_ font is used for filenames, URLs, emphasized text, and the first usage of technical terms.ÙTæ–œä½“å­—ç”¨äºæ–‡ä»¶åã€URLã€å¼ºè°ƒçš„æ–‡æœ¬ä»¥åŠæŠ€æœ¯æœ¯è¯­çš„é¦–æ¬¡ä½¿ç”¨ã€‚«`Monospace`¨`ç­‰å®½`Ù±A `monospaced` font is used for error messages, commands, environment variables, names of ports, hostnames, user names, group names, device names, variables, and code fragments.Ùé”™è¯¯æ¶ˆæ¯ã€å‘½ä»¤ã€ç¯å¢ƒå˜é‡ã€ç«¯å£åç§°ã€ä¸»æœºåã€ç”¨æˆ·åã€ç»„åã€è®¾å¤‡åã€å˜é‡å’Œä»£ç ç‰‡æ®µä½¿ç”¨ `ç­‰å®½å­—ä½“`ã€‚¤Bold¦ç²—ä½“Ù;A *bold* font is used for applications, commands, and keys.Ù7åº”ç”¨ç¨‹åºã€å‘½ä»¤å’ŒæŒ‰é”®ä½¿ç”¨ *ç²—ä½“* å­—ä½“ã€‚ªUser Input¬ç”¨æˆ·è¾“å…¥Ù Keys are shown in *bold* to stand out from other text.  Key combinations that are meant to be typed simultaneously are shown with `+` between the keys, such as:Ù~é”®ä»¥ *ç²—ä½“* æ˜¾ç¤ºï¼Œä»¥çªå‡ºæ˜¾ç¤ºä¸å…¶ä»–æ–‡æœ¬çš„åŒºåˆ«ã€‚åŒæ—¶è¾“å…¥çš„é”®ç»„åˆä»¥ `+` ç¬¦å·åˆ†éš”é”®ï¼Œä¾‹å¦‚ï¼š²kbd:[Ctrl+Alt+Del]¶kbd:[Ctrl + Alt + Del]Ù\Meaning the user should type the kbd:[Ctrl], kbd:[Alt], and kbd:[Del] keys at the same time.ÙMæ„æ€æ˜¯ç”¨æˆ·åº”è¯¥åŒæ—¶æŒ‰ä¸‹ kbd:[Ctrl]ã€kbd:[Alt] å’Œ kbd:[Del] é”®ã€‚ÙWKeys that are meant to be typed in sequence will be separated with commas, for example:Ù9éœ€è¦æŒ‰é¡ºåºè¾“å…¥çš„é”®å°†ç”¨é€—å·åˆ†éš”ï¼Œä¾‹å¦‚ï¼šºkbd:[Ctrl+X], kbd:[Ctrl+S]¿kbd:[Ctrl + X]ï¼Œkbd:[Ctrl + S]ÙœWould mean that the user is expected to type the kbd:[Ctrl] and kbd:[X] keys simultaneously and then to type the kbd:[Ctrl] and kbd:[S] keys simultaneously.Ùè¿™æ„å‘³ç€ç”¨æˆ·éœ€è¦åŒæ—¶æŒ‰ä¸‹é”®ç›˜ä¸Šçš„ kbd:[Ctrl] å’Œ kbd:[X] é”®ï¼Œç„¶åå†åŒæ—¶æŒ‰ä¸‹é”®ç›˜ä¸Šçš„ kbd:[Ctrl] å’Œ kbd:[S] é”®ã€‚¨Examples¦ç¤ºä¾‹ÙÎExamples starting with [.filename]#C:\># indicate a MS-DOS(R) command.  Unless otherwise noted, these commands may be executed from a "Command Prompt" window in a modern Microsoft(R) Windows(R) environment.Ù¾ä»¥ [.filename]#C:\># å¼€å¤´çš„ç¤ºä¾‹è¡¨ç¤ºä¸€ä¸ª MS-DOS(R) å‘½ä»¤ã€‚é™¤éå¦æœ‰è¯´æ˜ï¼Œè¿™äº›å‘½ä»¤å¯ä»¥åœ¨ç°ä»£ Microsoft(R) Windows(R) ç¯å¢ƒä¸­çš„ "Command Prompt" çª—å£ä¸­æ‰§è¡Œã€‚ÙÛExamples starting with # indicate a command that must be invoked as the superuser in FreeBSD.  You can login as `root` to type the command, or login as your normal account and use man:su[1] to gain superuser privileges.ÙÖä»¥ # å¼€å¤´çš„ç¤ºä¾‹è¡¨ç¤ºåœ¨ FreeBSD ä¸­å¿…é¡»ä»¥è¶…çº§ç”¨æˆ·èº«ä»½è°ƒç”¨çš„å‘½ä»¤ã€‚æ‚¨å¯ä»¥ç™»å½•ä¸º `root` æ¥è¾“å…¥å‘½ä»¤ï¼Œæˆ–è€…ç™»å½•ä¸ºæ‚¨çš„æ™®é€šå¸æˆ·å¹¶ä½¿ç”¨ man:su[1] æ¥è·å–è¶…çº§ç”¨æˆ·æƒé™ã€‚ÙÊExamples starting with % indicate a command that should be invoked from a normal user account.  Unless otherwise noted, C-shell syntax is used for setting environment variables and other shell commands.Ùšä»¥ % å¼€å¤´çš„ç¤ºä¾‹è¡¨ç¤ºåº”ä»æ™®é€šç”¨æˆ·å¸æˆ·è°ƒç”¨çš„å‘½ä»¤ã€‚é™¤éå¦æœ‰è¯´æ˜ï¼Œè®¾ç½®ç¯å¢ƒå˜é‡å’Œå…¶ä»– shell å‘½ä»¤ä½¿ç”¨ C-shell è¯­æ³•ã€‚¯Acknowledgments¦è‡´è°¢ÙËThe book you are holding represents the efforts of many hundreds of people around the world.  Whether they sent in fixes for typos, or submitted complete chapters, all the contributions have been useful.Ù–ä½ æ‰‹ä¸­çš„è¿™æœ¬ä¹¦ä»£è¡¨äº†å…¨çƒæ•°ç™¾äººçš„åŠªåŠ›ã€‚æ— è®ºä»–ä»¬æ˜¯çº æ­£é”™åˆ«å­—è¿˜æ˜¯æäº¤å®Œæ•´çš„ç« èŠ‚ï¼Œæ‰€æœ‰çš„è´¡çŒ®éƒ½æ˜¯æœ‰ç”¨çš„ã€‚Ú[Several companies have supported the development of this document by paying authors to work on it full-time, paying for publication, etc.  In particular, BSDi (subsequently acquired by http://www.windriver.com[Wind River Systems]) paid members of the FreeBSD Documentation Project to work on improving this book full time leading up to the publication of the first printed edition in March 2000 (ISBN 1-57176-241-8).  Wind River Systems then paid several additional authors to make a number of improvements to the print-output infrastructure and to add additional chapters to the text.  This work culminated in the publication of the second printed edition in November 2001 (ISBN 1-57176-303-1).  In 2003-2004, http://www.freebsdmall.com[FreeBSD Mall, Inc], paid several contributors to improve the Handbook in preparation for the third printed edition.  The third printed edition has been split into two volumes.  Both volumes have been published as The FreeBSD Handbook 3rd Edition Volume 1: User Guide (ISBN 1-57176-327-9) and The FreeBSD Handbook 3rd Edition Volume 2: Administrators Guide (ISBN 1-57176-328-7).Úµå‡ å®¶å…¬å¸é€šè¿‡æ”¯ä»˜ä½œè€…å…¨èŒå·¥ä½œã€å‡ºç‰ˆè´¹ç”¨ç­‰æ–¹å¼æ”¯æŒäº†æœ¬æ–‡æ¡£çš„å¼€å‘ã€‚ç‰¹åˆ«æ˜¯ BSDiï¼ˆåæ¥è¢« Wind River Systems æ”¶è´­ï¼‰æ”¯ä»˜äº† FreeBSD æ–‡æ¡£é¡¹ç›®çš„æˆå‘˜å…¨èŒå·¥ä½œï¼Œä»¥æ”¹è¿›è¿™æœ¬ä¹¦ï¼Œç›´åˆ° 2000 å¹´ 3 æœˆç¬¬ä¸€ç‰ˆå°åˆ·ç‰ˆçš„å‡ºç‰ˆï¼ˆISBN 1-57176-241-8ï¼‰ã€‚éšåï¼Œ http://www.windriver.com[Wind River Systems] æ”¯ä»˜äº†å‡ ä½é¢å¤–çš„ä½œè€…ï¼Œæ”¹è¿›äº†å°åˆ·è¾“å‡ºåŸºç¡€è®¾æ–½ï¼Œå¹¶ä¸ºæ–‡æœ¬æ·»åŠ äº†é¢å¤–çš„ç« èŠ‚ã€‚è¿™é¡¹å·¥ä½œæœ€ç»ˆåœ¨ 2001 å¹´ 11 æœˆå‡ºç‰ˆäº†ç¬¬äºŒç‰ˆå°åˆ·ç‰ˆï¼ˆISBN 1-57176-303-1ï¼‰ã€‚åœ¨ 2003 å¹´è‡³ 2004 å¹´æœŸé—´ï¼Œ http://www.freebsdmall.com[FreeBSD Mall,Inc] æ”¯ä»˜äº†å‡ ä½è´¡çŒ®è€…ï¼Œæ”¹è¿›äº†æ‰‹å†Œï¼Œä¸ºç¬¬ä¸‰ç‰ˆå°åˆ·ç‰ˆåšå‡†å¤‡ã€‚ç¬¬ä¸‰ç‰ˆå°åˆ·ç‰ˆè¢«åˆ†ä¸ºä¸¤å·ã€‚ä¸¤å·éƒ½å·²å‡ºç‰ˆï¼Œåˆ†åˆ«æ˜¯ The FreeBSD Handbook 3rd Edition Volume 1: User Guideï¼ˆISBN 1-57176-327-9ï¼‰å’ŒThe FreeBSD Handbook 3rd Edition Volume 2: Administrators Guideï¼ˆISBN 1-57176-328-7ï¼‰ã€‚ÙÃFreeBSD provides two complementary technologies for installing third-party software: the FreeBSD Ports Collection, for installing from source, and packages, for installing from pre-built binariesÙ¶FreeBSD æä¾›äº†ä¸¤ç§äº’è¡¥çš„æŠ€æœ¯æ¥å®‰è£…ç¬¬ä¸‰æ–¹è½¯ä»¶ï¼šFreeBSD Ports Collection ç”¨äºä»æºä»£ç å®‰è£…ï¼Œè€ŒåŒ…ï¼ˆpackagesï¼‰ç”¨äºä»é¢„ç¼–è¯‘çš„äºŒè¿›åˆ¶æ–‡ä»¶å®‰è£…ã€‚Ù6Chapter 4. Installing Applications: Packages and PortsÙ1ç¬¬ 4 ç«  å®‰è£…åº”ç”¨ç¨‹åºï¼šè½¯ä»¶åŒ…å’Œ PortsÙ+Installing Applications: Packages and PortsÙ'å®‰è£…åº”ç”¨ç¨‹åºï¼šè½¯ä»¶åŒ…å’Œ PortsÚ}FreeBSD is bundled with a rich collection of system tools as part of the base system.  In addition, FreeBSD provides two complementary technologies for installing third-party software: the FreeBSD Ports Collection, for installing from source, and packages, for installing from pre-built binaries.  Either method may be used to install software from local media or from the network.ÚCFreeBSD æ†ç»‘äº†ä¸°å¯Œçš„ç³»ç»Ÿå·¥å…·ä½œä¸ºåŸºæœ¬ç³»ç»Ÿçš„ä¸€éƒ¨åˆ†ã€‚æ­¤å¤–ï¼ŒFreeBSD è¿˜æä¾›äº†ä¸¤ç§äº’è¡¥çš„æŠ€æœ¯æ¥å®‰è£…ç¬¬ä¸‰æ–¹è½¯ä»¶ï¼šFreeBSD Ports Collection ç”¨äºä»æºä»£ç å®‰è£…ï¼Œè€Œè½¯ä»¶åŒ…åˆ™ç”¨äºä»é¢„ç¼–è¯‘çš„äºŒè¿›åˆ¶æ–‡ä»¶å®‰è£…ã€‚å¯ä»¥ä½¿ç”¨ä»»ä¸€æ–¹æ³•ä»æœ¬åœ°åª’ä½“æˆ–ç½‘ç»œå®‰è£…è½¯ä»¶ã€‚Ù1The difference between binary packages and ports.Ù(äºŒè¿›åˆ¶åŒ…å’Œ ports ä¹‹é—´çš„åŒºåˆ«ã€‚ÙAHow to find third-party software that has been ported to FreeBSD.Ù9å¦‚ä½•æ‰¾åˆ°å·²ç»ç§»æ¤åˆ° FreeBSD çš„ç¬¬ä¸‰æ–¹è½¯ä»¶ã€‚Ù(How to manage binary packages using pkg.Ù,å¦‚ä½•ä½¿ç”¨ pkg ç®¡ç†äºŒè¿›åˆ¶è½¯ä»¶åŒ…ã€‚ÙIHow to build third-party software from source using the Ports Collection.ÙBå¦‚ä½•ä½¿ç”¨ Ports Collection ä»æºä»£ç æ„å»ºç¬¬ä¸‰æ–¹è½¯ä»¶ã€‚ÙYHow to find the files installed with the application for post-installation configuration.ÙEå¦‚ä½•æ‰¾åˆ°åº”ç”¨ç¨‹åºå®‰è£…åçš„æ–‡ä»¶ï¼Œä»¥è¿›è¡Œåç»­é…ç½®ã€‚Ù,What to do if a software installation fails.Ù-å¦‚æœè½¯ä»¶å®‰è£…å¤±è´¥ï¼Œåº”è¯¥æ€ä¹ˆåŠã€‚Ù!Overview of Software Installation²è½¯ä»¶å®‰è£…æ¦‚è¿°ÚA FreeBSD _port_ is a collection of files designed to automate the process of compiling an application from source code.  The files that comprise a port contain all the necessary information to automatically download, extract, patch, compile, and install the application.ÙÛFreeBSD çš„ `ports` æ˜¯ä¸€ç»„æ–‡ä»¶ï¼Œæ—¨åœ¨è‡ªåŠ¨åŒ–ä»æºä»£ç ç¼–è¯‘åº”ç”¨ç¨‹åºçš„è¿‡ç¨‹ã€‚ç»„æˆ ports çš„æ–‡ä»¶åŒ…å«äº†è‡ªåŠ¨ä¸‹è½½ã€æå–ã€æ‰“è¡¥ä¸ã€ç¼–è¯‘å’Œå®‰è£…åº”ç”¨ç¨‹åºæ‰€éœ€çš„æ‰€æœ‰å¿…è¦ä¿¡æ¯ã€‚Ù“If the software has not already been adapted and tested on FreeBSD, the source code might need editing in order for it to install and run properly.Ù{å¦‚æœè½¯ä»¶å°šæœªåœ¨ FreeBSD ä¸Šè¿›è¡Œé€‚é…å’Œæµ‹è¯•ï¼Œæºä»£ç å¯èƒ½éœ€è¦è¿›è¡Œç¼–è¾‘ï¼Œä»¥ä¾¿æ­£ç¡®å®‰è£…å’Œè¿è¡Œã€‚ÙÚHowever, over link:https://www.FreeBSD.org/ports/[{numports}] third-party applications have already been ported to FreeBSD.  When feasible, these applications are made available for download as pre-compiled _packages_.ÙØç„¶è€Œï¼Œåœ¨ link:https://www.FreeBSD.org/ports/[{numports}] ä¸Šå·²ç»æœ‰è®¸å¤šç¬¬ä¸‰æ–¹åº”ç”¨ç¨‹åºè¢«ç§»æ¤åˆ°äº† FreeBSDã€‚åœ¨å¯è¡Œçš„æƒ…å†µä¸‹ï¼Œè¿™äº›åº”ç”¨ç¨‹åºä¼šä»¥é¢„ç¼–è¯‘çš„è½¯ä»¶åŒ…å½¢å¼æä¾›ä¸‹è½½ã€‚ÙIPackages can be manipulated with the FreeBSD package management commands.Ù?å¯ä»¥ä½¿ç”¨ FreeBSD è½¯ä»¶åŒ…ç®¡ç†å‘½ä»¤æ¥æ“ä½œè½¯ä»¶åŒ…ã€‚ÙÍBoth packages and ports understand dependencies.  If a package or port is used to install an application and a dependent library is not already installed, the library will automatically be installed first.ÙªåŒ…å’Œ ports éƒ½èƒ½ç†è§£ä¾èµ–å…³ç³»ã€‚å¦‚æœä½¿ç”¨åŒ…æˆ– ports æ¥å®‰è£…ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œå¹¶ä¸”æ‰€ä¾èµ–çš„åº“å°šæœªå®‰è£…ï¼Œé‚£ä¹ˆè¯¥åº“å°†ä¼šè‡ªåŠ¨è¢«å…ˆå®‰è£…ã€‚ÙßA FreeBSD package contains pre-compiled copies of all the commands for an application, as well as any configuration files and documentation.  A package can be manipulated with the man:pkg[8] commands, such as `pkg install`.Ù¶ä¸€ä¸ª FreeBSD è½¯ä»¶åŒ…åŒ…å«äº†ä¸€ä¸ªåº”ç”¨ç¨‹åºçš„é¢„ç¼–è¯‘å‰¯æœ¬ï¼Œä»¥åŠä»»ä½•é…ç½®æ–‡ä»¶å’Œæ–‡æ¡£ã€‚å¯ä»¥ä½¿ç”¨ man:pkg[8] å‘½ä»¤æ¥æ“ä½œè½¯ä»¶åŒ…ï¼Œä¾‹å¦‚ `pkg install`ã€‚Ù¶While the two technologies are similar, packages and ports each have their own strengths.  Select the technology that meets your requirements for installing a particular application.Ù‚è™½ç„¶è¿™ä¸¤ç§æŠ€æœ¯ç›¸ä¼¼ï¼Œä½†è½¯ä»¶åŒ…å’Œ ports å„æœ‰å„çš„ä¼˜åŠ¿ã€‚é€‰æ‹©ç¬¦åˆæ‚¨å®‰è£…ç‰¹å®šåº”ç”¨ç¨‹åºéœ€æ±‚çš„æŠ€æœ¯ã€‚°Package Benefits¬åŒ…çš„å¥½å¤„Ù}A compressed package tarball is typically smaller than the compressed tarball containing the source code for the application.Ù]é€šå¸¸ï¼Œå‹ç¼©çš„è½¯ä»¶åŒ… tarball æ¯”åŒ…å«åº”ç”¨ç¨‹åºæºä»£ç çš„å‹ç¼© tarball è¦å°ã€‚ÙPackages do not require compilation time. For large applications, such as Firefox, KDE Plasma, or GNOME, this can be important on a slow system.Ù‰åŒ…ä¸éœ€è¦ç¼–è¯‘æ—¶é—´ã€‚å¯¹äºå¤§å‹åº”ç”¨ç¨‹åºï¼Œå¦‚ Firefox ã€KDE Plasma æˆ– GNOMEï¼Œåœ¨æ…¢é€Ÿç³»ç»Ÿä¸Šè¿™ä¸€ç‚¹å¯èƒ½å¾ˆé‡è¦ã€‚ÙcPackages do not require any understanding of the process involved in compiling software on FreeBSD.ÙEåœ¨ FreeBSD ä¸Šç¼–è¯‘è½¯ä»¶çš„è¿‡ç¨‹ä¸­ï¼ŒåŒ…ä¸éœ€è¦ä»»ä½•ç†è§£ã€‚­Port Benefits®Port çš„å¥½å¤„Ù·Packages are normally compiled with conservative options because they have to run on the maximum number of systems. By compiling from the port, one can change the compilation options.Ù²é€šå¸¸æƒ…å†µä¸‹ï¼Œè½¯ä»¶åŒ…ä¼šä½¿ç”¨ä¿å®ˆçš„é€‰é¡¹è¿›è¡Œç¼–è¯‘ï¼Œå› ä¸ºå®ƒä»¬éœ€è¦åœ¨å°½å¯èƒ½å¤šçš„ç³»ç»Ÿä¸Šè¿è¡Œã€‚é€šè¿‡ä» ports è¿›è¡Œç¼–è¯‘ï¼Œå¯ä»¥æ›´æ”¹ç¼–è¯‘é€‰é¡¹ã€‚Ù°Some applications have compile-time options relating to which features are installed. For example, NGINX(R) can be configured with a wide variety of different built-in options.Ùä¸€äº›åº”ç”¨ç¨‹åºå…·æœ‰ä¸å®‰è£…çš„åŠŸèƒ½ç›¸å…³çš„ç¼–è¯‘æ—¶é€‰é¡¹ã€‚ä¾‹å¦‚ï¼ŒNGINX(R) å¯ä»¥é…ç½®å¤šç§ä¸åŒçš„å†…ç½®é€‰é¡¹ã€‚ÚeIn some cases, multiple packages will exist for the same application to specify certain settings. For example, NGINX(R) is available as a `nginx` package and a `nginx-lite` package, depending on whether or not Xorg is installed. Creating multiple packages rapidly becomes impossible if an application has more than one or two different compile-time options.ÚKåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä¸ºäº†æŒ‡å®šç‰¹å®šçš„è®¾ç½®ï¼ŒåŒä¸€ä¸ªåº”ç”¨ç¨‹åºå¯èƒ½ä¼šå­˜åœ¨å¤šä¸ªè½¯ä»¶åŒ…ã€‚ä¾‹å¦‚ï¼ŒNGINX(R) æœ‰ä¸€ä¸ª `nginx` è½¯ä»¶åŒ…å’Œä¸€ä¸ª `nginx-lite` è½¯ä»¶åŒ…ï¼Œå–å†³äºæ˜¯å¦å®‰è£…äº† Xorgã€‚å¦‚æœä¸€ä¸ªåº”ç”¨ç¨‹åºæœ‰è¶…è¿‡ä¸€ä¸¤ä¸ªä¸åŒçš„ç¼–è¯‘é€‰é¡¹ï¼Œåˆ›å»ºå¤šä¸ªè½¯ä»¶åŒ…å°†å¾ˆå¿«å˜å¾—ä¸å¯èƒ½ã€‚ÙThe licensing conditions of some software forbid binary distribution. Such software must be distributed as source code which must be compiled by the end-user.Ù„ä¸€äº›è½¯ä»¶çš„è®¸å¯æ¡ä»¶ç¦æ­¢äºŒè¿›åˆ¶åˆ†å‘ã€‚è¿™ç±»è½¯ä»¶å¿…é¡»ä»¥æºä»£ç çš„å½¢å¼åˆ†å‘ï¼Œå¹¶ç”±æœ€ç»ˆç”¨æˆ·è¿›è¡Œç¼–è¯‘ã€‚Ù|Some people do not trust binary distributions or prefer to read through source code in order to look for potential problems.Ù]æœ‰äº›äººä¸ä¿¡ä»»äºŒè¿›åˆ¶å‘è¡Œç‰ˆï¼Œæˆ–è€…æ›´å–œæ¬¢é˜…è¯»æºä»£ç ä»¥å¯»æ‰¾æ½œåœ¨é—®é¢˜ã€‚Ù7Source code is needed in order to apply custom patches.Ù6ä¸ºäº†åº”ç”¨è‡ªå®šä¹‰è¡¥ä¸ï¼Œéœ€è¦æä¾›æºä»£ç ã€‚Ù^To keep track of updated ports, subscribe to the {freebsd-ports} and the {freebsd-ports-bugs}.ÙRè¦è·Ÿè¸ªæ›´æ–°çš„ ports ï¼Œè¯·è®¢é˜… {freebsd-ports} å’Œ {freebsd-ports-bugs} ã€‚ÙaBefore installing an application, check https://vuxml.freebsd.org/[] for related security issues.Ùiåœ¨å®‰è£…åº”ç”¨ç¨‹åºä¹‹å‰ï¼Œè¯·æ£€æŸ¥ https://vuxml.freebsd.org/[] æ˜¯å¦å­˜åœ¨ç›¸å…³çš„å®‰å…¨é—®é¢˜ã€‚ÙNTo audit installed packages against known vulnerabilities, run `pkg audit -F`.ÙTè¦å¯¹å·²å®‰è£…çš„è½¯ä»¶åŒ…è¿›è¡Œå·²çŸ¥æ¼æ´çš„å®¡è®¡ï¼Œè¯·è¿è¡Œ `pkg audit -F`ã€‚Ù{The remainder of this chapter explains how to use packages and ports to install and manage third-party software on FreeBSD.Ùmæœ¬ç« çš„å…¶ä½™éƒ¨åˆ†å°†è§£é‡Šå¦‚ä½•ä½¿ç”¨è½¯ä»¶åŒ…å’Œ ports åœ¨ FreeBSD ä¸Šå®‰è£…å’Œç®¡ç†ç¬¬ä¸‰æ–¹è½¯ä»¶ã€‚°Finding Software¬å¯»æ‰¾è½¯ä»¶ÙzFreeBSD's list of available applications is growing all the time.  There are a number of ways to find software to install:ÙbFreeBSD çš„å¯ç”¨åº”ç”¨ç¨‹åºåˆ—è¡¨ä¸æ–­å¢é•¿ã€‚æœ‰å¤šç§æ–¹æ³•å¯ä»¥æ‰¾åˆ°è¦å®‰è£…çš„è½¯ä»¶ï¼šÙÜThe FreeBSD web site maintains an up-to-date searchable list of all the available applications, at link:https://www.FreeBSD.org/ports/[Ports Portal]. The ports can be searched by application name or by software category.ÙÁFreeBSD ç½‘ç«™ç»´æŠ¤ç€ä¸€ä¸ªæœ€æ–°çš„å¯æœç´¢çš„åº”ç”¨ç¨‹åºåˆ—è¡¨ï¼Œä½äº link:https://www.FreeBSD.org/ports/[Ports Portal]ã€‚å¯ä»¥é€šè¿‡åº”ç”¨ç¨‹åºåç§°æˆ–è½¯ä»¶ç±»åˆ«æ¥æœç´¢ portsã€‚Ú2Dan Langille maintains https://www.freshports.org/[FreshPorts] which provides a comprehensive search utility and also tracks changes to the applications in the Ports Collection. Registered users can create a customized watch list in order to receive an automated email when their watched ports are updated.ÚDan Langille ç»´æŠ¤ç€ https://www.freshports.org/[FreshPorts]ï¼Œè¯¥ç½‘ç«™æä¾›äº†ä¸€ä¸ªå…¨é¢çš„æœç´¢å·¥å…·ï¼Œå¹¶è·Ÿè¸ª Ports Collection ä¸­åº”ç”¨ç¨‹åºçš„å˜åŒ–ã€‚æ³¨å†Œç”¨æˆ·å¯ä»¥åˆ›å»ºä¸€ä¸ªå®šåˆ¶çš„ç›‘è§†åˆ—è¡¨ï¼Œä»¥ä¾¿åœ¨æ‰€ç›‘è§†çš„ ports æ›´æ–°æ—¶æ”¶åˆ°è‡ªåŠ¨é‚®ä»¶é€šçŸ¥ã€‚ÚIf finding a particular application becomes challenging, try searching a site like https://sourceforge.net/[SourceForge] or https://github.com/[GitHub] then check back at the link:https://www.FreeBSD.org/ports/[Ports Portal] to see if the application has been ported.Úå¦‚æœæ‰¾åˆ°ä¸€ä¸ªç‰¹å®šçš„åº”ç”¨ç¨‹åºå˜å¾—å›°éš¾ï¼Œå¯ä»¥å°è¯•åœ¨ https://sourceforge.net/[SourceForge] æˆ–è€… https://github.com/[GitHub] è¿™æ ·çš„ç½‘ç«™ä¸Šè¿›è¡Œæœç´¢ï¼Œç„¶åå†å›åˆ° link:https://www.FreeBSD.org/ports/[Ports Portal] æŸ¥çœ‹è¯¥åº”ç”¨ç¨‹åºæ˜¯å¦å·²ç»è¢«ç§»æ¤ã€‚ÙTSearch the binary package repository for an application using the man:pkg[8] commandÙNä½¿ç”¨ man:pkg[8] å‘½ä»¤åœ¨äºŒè¿›åˆ¶è½¯ä»¶åŒ…ä»“åº“ä¸­æœç´¢ä¸€ä¸ªåº”ç”¨ç¨‹åºÙ'Using pkg for Binary Package ManagementÙ#ä½¿ç”¨ pkg è¿›è¡ŒäºŒè¿›åˆ¶åŒ…ç®¡ç†Ùqman:pkg[8] provides an interface for manipulating	packages: registering, adding, removing and upgrading packages.Ùhman:pkg[8] æä¾›äº†ä¸€ä¸ªç”¨äºæ“ä½œè½¯ä»¶åŒ…çš„æ¥å£ï¼šæ³¨å†Œã€æ·»åŠ ã€åˆ é™¤å’Œå‡çº§è½¯ä»¶åŒ…ã€‚Ù…For sites wishing to only use prebuilt binary packages from the FreeBSD mirrors, managing packages with man:pkg[8] can be sufficient.Ùå¯¹äºåªå¸Œæœ›ä½¿ç”¨ FreeBSD é•œåƒç«™ç‚¹æä¾›çš„é¢„ç¼–è¯‘äºŒè¿›åˆ¶åŒ…çš„ç½‘ç«™ï¼Œä½¿ç”¨ man:pkg[8] æ¥ç®¡ç†è½¯ä»¶åŒ…å¯èƒ½å·²ç»è¶³å¤Ÿäº†ã€‚ÙxHowever, for those sites building from source a separate <<ports-upgrading-tools, port management tool>> will be needed.Ùgç„¶è€Œï¼Œå¯¹äºé‚£äº›ä»æºä»£ç æ„å»ºç½‘ç«™çš„ç”¨æˆ·ï¼Œå°†éœ€è¦ä½¿ç”¨å•ç‹¬çš„ ports ç®¡ç†å·¥å…·ã€‚ÙêSince man:pkg[8] only works with binary packages, it is not a replacement for such tools.  Those tools can be used to install software from both binary packages and the Ports Collection, while man:pkg[8] installs only binary packages.ÙÛç”±äº man:pkg[8] åªèƒ½ç”¨äºäºŒè¿›åˆ¶è½¯ä»¶åŒ…ï¼Œå®ƒå¹¶ä¸èƒ½æ›¿ä»£è¿™äº›å·¥å…·ã€‚è¿™äº›å·¥å…·å¯ä»¥ç”¨äºå®‰è£…æ¥è‡ªäºŒè¿›åˆ¶è½¯ä»¶åŒ…å’Œ Ports Collection çš„è½¯ä»¶ï¼Œè€Œ man:pkg[8] åªèƒ½å®‰è£…äºŒè¿›åˆ¶è½¯ä»¶åŒ…ã€‚¸Getting Started with pkg°å¼€å§‹ä½¿ç”¨ pkgÙ½All supported versions of FreeBSD now contain `/usr/sbin/pkg` a.k.a man:pkg[7].  This is a small placeholder that has just the minimum functionality required to install the real man:pkg[8].Ùµæ‰€æœ‰æ”¯æŒçš„ FreeBSD ç‰ˆæœ¬ç°åœ¨éƒ½åŒ…å« `/usr/sbin/pkg`ï¼Œä¹Ÿè¢«ç§°ä¸º man:pkg[7] ã€‚è¿™æ˜¯ä¸€ä¸ªå°çš„å ä½ç¬¦ï¼ŒåªåŒ…å«å®‰è£…çœŸæ­£çš„ man:pkg[8] æ‰€éœ€çš„æœ€å°åŠŸèƒ½ã€‚ÙPAn Internet working connection is required for the bootstrap process to succeed.Ù?åœ¨å¼•å¯¼è¿‡ç¨‹ä¸­ï¼Œéœ€è¦ä¸€ä¸ªäº’è”ç½‘è¿æ¥æ‰èƒ½æˆåŠŸã€‚¼Run man:pkg[8] command line:¾è¿è¡Œ man:pkg[8] å‘½ä»¤è¡Œï¼šÙñman:pkg[7] will intercept the command, and if you confirm that is your intention, download the man:pkg[8] tarball, install man:pkg[8] from it, bootstrap the local package database and then proceed to run the command you originally requested.ÙÏman:pkg[7] å°†æ‹¦æˆªè¯¥å‘½ä»¤ï¼Œå¦‚æœæ‚¨ç¡®è®¤è¿™æ˜¯æ‚¨çš„æ„å›¾ï¼Œå°†ä¸‹è½½ man:pkg[8] tarball ï¼Œå¹¶ä»ä¸­å®‰è£… man:pkg[8]ï¼Œå¼•å¯¼æœ¬åœ°è½¯ä»¶åŒ…æ•°æ®åº“ï¼Œç„¶åç»§ç»­è¿è¡Œæ‚¨æœ€åˆè¯·æ±‚çš„å‘½ä»¤ã€‚ÚMore recent versions of man:pkg[7] understand `pkg -N` as a test to see if man:pkg[8] is installed without triggering the installation, and conversely, pkg bootstrap[-f] to install man:pkg[8] (or force it to be reinstalled) without performing any other actions.Ùûè¾ƒæ–°ç‰ˆæœ¬çš„ man:pkg[7] å¯ä»¥ç†è§£ `pkg -N` ä½œä¸ºä¸€ç§æµ‹è¯•ï¼Œç”¨äºæ£€æŸ¥æ˜¯å¦å®‰è£…äº† man:pkg[8]ï¼Œè€Œä¸è§¦å‘å®‰è£…æ“ä½œã€‚ç›¸åï¼Œpkg bootstrap[-f] ç”¨äºå®‰è£… man:pkg[8]ï¼ˆæˆ–å¼ºåˆ¶é‡æ–°å®‰è£…ï¼‰ï¼Œè€Œä¸æ‰§è¡Œä»»ä½•å…¶ä»–æ“ä½œã€‚Ù¾Usage information for pkg is available in the man:pkg[8] manual page or by running `pkg` without additional arguments.  Additional pkg configuration options are described in man:pkg.conf[5].ÙÄå¯ä»¥é€šè¿‡æŸ¥çœ‹ man:pkg[8] æ‰‹å†Œé¡µé¢æˆ–è€…åœ¨è¿è¡Œ `pkg` å‘½ä»¤æ—¶ä¸æ·»åŠ é¢å¤–å‚æ•°æ¥è·å– pkg çš„ä½¿ç”¨ä¿¡æ¯ã€‚æœ‰å…³å…¶ä»– pkg é…ç½®é€‰é¡¹çš„æè¿°ï¼Œè¯·å‚é˜… man:pkg.conf[5] ã€‚ÙJEach pkg command argument is documented in a command-specific manual page.ÙJæ¯ä¸ª pkg å‘½ä»¤å‚æ•°éƒ½åœ¨ç‰¹å®šå‘½ä»¤çš„æ‰‹å†Œé¡µä¸­æœ‰è¯¦ç»†è¯´æ˜ã€‚ÙITo read the manual page for `pkg install`, for example, run this command:ÙHä¾‹å¦‚ï¼Œè¦é˜…è¯» `pkg install` çš„æ‰‹å†Œé¡µï¼Œè¯·è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼šÚThe rest of this section demonstrates common binary package management tasks which can be performed using man:pkg[8].  Each demonstrated command provides many switches to customize its use.  Refer to a command's help or man page for details and more examples.Ùòæœ¬èŠ‚çš„å…¶ä½™éƒ¨åˆ†æ¼”ç¤ºäº†ä½¿ç”¨ man:pkg[8] æ‰§è¡Œçš„å¸¸è§äºŒè¿›åˆ¶åŒ…ç®¡ç†ä»»åŠ¡ã€‚æ¯ä¸ªæ¼”ç¤ºçš„å‘½ä»¤éƒ½æä¾›äº†è®¸å¤šå¼€å…³æ¥è‡ªå®šä¹‰å…¶ä½¿ç”¨æ–¹å¼ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯å’Œæ›´å¤šç¤ºä¾‹ï¼Œè¯·å‚é˜…å‘½ä»¤çš„å¸®åŠ©æˆ– man é¡µé¢ã€‚Ù#Quarterly and Latest Ports Branches¿å­£åº¦å’Œæœ€æ–°çš„ ports åˆ†æ”¯ÚÔThe `Quarterly` branch provides users with a more predictable and stable experience for port and package installation and upgrades.  This is done essentially by only allowing non-feature updates.  Quarterly branches aim to receive security fixes (that may be version updates, or backports of commits), bug fixes and ports compliance or framework changes.  The Quarterly branch is cut from HEAD at the beginning of every (yearly) quarter in January, April, July, and October.  Branches are named according to the year (YYYY) and quarter (Q1-4) they are created in.  For example, the quarterly branch created in January 2023, is named 2023Q1.  And the `Latest` branch provides the latest versions of the packages to the users.ÚO`Quarterly` åˆ†æ”¯ä¸ºç”¨æˆ·æä¾›äº†æ›´å¯é¢„æµ‹å’Œç¨³å®šçš„ ports å’Œè½¯ä»¶åŒ…å®‰è£…å’Œå‡çº§ä½“éªŒã€‚è¿™ä¸»è¦é€šè¿‡åªå…è®¸éåŠŸèƒ½æ€§æ›´æ–°æ¥å®ç°ã€‚å­£åº¦åˆ†æ”¯æ—¨åœ¨æ¥æ”¶å®‰å…¨ä¿®å¤ï¼ˆå¯èƒ½æ˜¯ç‰ˆæœ¬æ›´æ–°æˆ–æäº¤çš„å›æº¯ï¼‰ã€é”™è¯¯ä¿®å¤å’Œ ports åˆè§„æ€§æˆ–æ¡†æ¶æ›´æ”¹ã€‚å­£åº¦åˆ†æ”¯åœ¨æ¯å¹´çš„ä¸€æœˆã€å››æœˆã€ä¸ƒæœˆå’Œåæœˆçš„å­£åº¦åˆä» HEAD ä¸­åˆ‡å‡ºã€‚åˆ†æ”¯çš„å‘½åæ–¹å¼æ ¹æ®å®ƒä»¬åˆ›å»ºçš„å¹´ä»½ï¼ˆYYYYï¼‰å’Œå­£åº¦ï¼ˆQ1-4ï¼‰ã€‚ä¾‹å¦‚ï¼Œ 2023 å¹´ 1 æœˆåˆ›å»ºçš„å­£åº¦åˆ†æ”¯è¢«å‘½åä¸º 2023Q1ã€‚è€Œ `Latest` åˆ†æ”¯ä¸ºç”¨æˆ·æä¾›äº†è½¯ä»¶åŒ…çš„æœ€æ–°ç‰ˆæœ¬ã€‚ÙITo switch man:pkg[8] from Quarterly to Latest run the following commands:ÙKè¦å°† man:pkg[8] ä»å­£åº¦ç‰ˆåˆ‡æ¢åˆ°æœ€æ–°ç‰ˆï¼Œè¯·è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼šÙ`Then run this command to update the local package repositories catalogues for the Latest branch:Ù`ç„¶åè¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥æ›´æ–°æœ¬åœ°è½¯ä»¶åŒ…ä»“åº“ç›®å½•ï¼Œä»¥è·å–æœ€æ–°åˆ†æ”¯çš„å†…å®¹ï¼š­Configure pkgªé…ç½® pkgÙ”man:pkg.conf[5] is the system-wide configuration file used by the man:pkg[8] tools.  The default location of this file is `/usr/local/etc/pkg.conf`.Ù~man:pkg.conf[5] æ˜¯ man:pkg[8] å·¥å…·ä½¿ç”¨çš„ç³»ç»Ÿçº§é…ç½®æ–‡ä»¶ã€‚è¯¥æ–‡ä»¶çš„é»˜è®¤ä½ç½®æ˜¯ `/usr/local/etc/pkg.conf`ã€‚Ù¥FreeBSD does not need to have a `pkg.conf` file.  Many installations will work well with no `pkg.conf` at all or with an empty `pkg.conf` (other than comment lines).Ù­FreeBSD ä¸éœ€è¦æœ‰ `pkg.conf` æ–‡ä»¶ã€‚è®¸å¤šå®‰è£…å¯ä»¥åœ¨æ²¡æœ‰ä»»ä½• `pkg.conf` æ–‡ä»¶æˆ–åªæœ‰ç©ºçš„ `pkg.conf` æ–‡ä»¶ï¼ˆé™¤äº†æ³¨é‡Šè¡Œï¼‰çš„æƒ…å†µä¸‹æ­£å¸¸å·¥ä½œã€‚ÙDLines in the file beginning with a "#" are	comments and are ignored.Ù-ä»¥"#"å¼€å¤´çš„è¡Œæ˜¯æ³¨é‡Šï¼Œä¼šè¢«å¿½ç•¥ã€‚Ù The file is in UCL format.  For more information on the syntax of man:libucl[3], please visit the link:https://github.com/vstakhov/libucl[official UCL website].Ù•è¯¥æ–‡ä»¶é‡‡ç”¨ UCL æ ¼å¼ã€‚æœ‰å…³ man:libucl[3] è¯­æ³•çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·è®¿é—® link:https://github.com/vstakhov/libucl[official UCL website] ã€‚ÙQThe following types of options are recognized - boolean, string and list options.ÙKè¯†åˆ«ä»¥ä¸‹ç±»å‹çš„é€‰é¡¹ - å¸ƒå°”å‹ã€å­—ç¬¦ä¸²å‹å’Œåˆ—è¡¨å‹é€‰é¡¹ã€‚ÙA boolean option is marked as enabled if one of the following values is specified in the configuration file - YES, TRUE and ON.Ùoå¦‚æœåœ¨é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šäº†ä»¥ä¸‹å€¼ä¹‹ä¸€ - YES ã€TRUE å’Œ ONï¼Œåˆ™å°†å¸ƒå°”é€‰é¡¹æ ‡è®°ä¸ºå·²å¯ç”¨ã€‚²Searching Packages¯æœç´¢è½¯ä»¶åŒ…Ù2To search a package man:pkg-search[8] can be used:ÙCè¦æœç´¢ä¸€ä¸ªè½¯ä»¶åŒ…ï¼Œå¯ä»¥ä½¿ç”¨ man:pkg-search[8] å‘½ä»¤ï¼šÙ Installing and Fetching Packages¸å®‰è£…å’Œè·å–è½¯ä»¶åŒ…ÙßTo install a binary package man:pkg-install[8] can be used.  This command uses repository data to determine which version of the software to install and if it has any uninstalled dependencies.  For example, to install curl:ÙÑè¦å®‰è£…ä¸€ä¸ªäºŒè¿›åˆ¶è½¯ä»¶åŒ…ï¼Œå¯ä»¥ä½¿ç”¨ man:pkg-install[8] å‘½ä»¤ã€‚è¯¥å‘½ä»¤ä½¿ç”¨å­˜å‚¨åº“æ•°æ®æ¥ç¡®å®šè¦å®‰è£…çš„è½¯ä»¶çš„ç‰ˆæœ¬ä»¥åŠæ˜¯å¦æœ‰æœªå®‰è£…çš„ä¾èµ–é¡¹ã€‚ä¾‹å¦‚ï¼Œè¦å®‰è£… curl ï¼šÙ{The new package and any additional packages that were installed as dependencies can be seen in the installed packages list:Ùræ–°çš„è½¯ä»¶åŒ…ä»¥åŠä½œä¸ºä¾èµ–é¡¹å®‰è£…çš„ä»»ä½•å…¶ä»–è½¯ä»¶åŒ…éƒ½å¯ä»¥åœ¨å·²å®‰è£…è½¯ä»¶åŒ…åˆ—è¡¨ä¸­çœ‹åˆ°ï¼šÙyTo fetch a package and install it later or in another place use man:pkg-fetch[8].  For example, to download `nginx-lite`:Ù‡è¦è·å–ä¸€ä¸ªè½¯ä»¶åŒ…å¹¶ç¨åå®‰è£…å®ƒæˆ–åœ¨å¦ä¸€ä¸ªåœ°æ–¹å®‰è£…ï¼Œè¯·ä½¿ç”¨ man:pkg-fetch[8]ã€‚ä¾‹å¦‚ï¼Œè¦ä¸‹è½½ `nginx-lite`ï¼šÙ(`-d`: used to fetch all the dependenciesÙ%`-d`ï¼šç”¨äºè·å–æ‰€æœ‰çš„ä¾èµ–é¡¹Ù,`-o`: used to specify the download directory¿`-o`ï¼šç”¨äºæŒ‡å®šä¸‹è½½ç›®å½•ÙMTo install the downloaded packages man:pkg-install[8] can be used as follows:Ù\è¦å®‰è£…ä¸‹è½½çš„è½¯ä»¶åŒ…ï¼Œå¯ä»¥ä½¿ç”¨ man:pkg-install[8] å‘½ä»¤ï¼Œå…·ä½“æ“ä½œå¦‚ä¸‹ï¼šÙ.Obtaining Information About Installed PackagesÙ!è·å–å·²å®‰è£…è½¯ä»¶åŒ…çš„ä¿¡æ¯ÙİInformation about the packages installed on a system can be viewed by running man:pkg-info[8] which, when run without any switches, will list the package version for either all installed packages or the specified package.Ù¼å¯ä»¥é€šè¿‡è¿è¡Œ man:pkg-info[8] æ¥æŸ¥çœ‹ç³»ç»Ÿä¸Šå®‰è£…çš„è½¯ä»¶åŒ…çš„ä¿¡æ¯ã€‚å½“ä¸å¸¦ä»»ä½•å¼€å…³è¿è¡Œæ—¶ï¼Œå®ƒå°†åˆ—å‡ºæ‰€æœ‰å·²å®‰è£…è½¯ä»¶åŒ…æˆ–æŒ‡å®šè½¯ä»¶åŒ…çš„ç‰ˆæœ¬ä¿¡æ¯ã€‚Ù;For example, to see which version of pkg is installed, run:Ù8ä¾‹å¦‚ï¼Œè¦æŸ¥çœ‹å·²å®‰è£…çš„ pkg ç‰ˆæœ¬ï¼Œè¯·è¿è¡Œï¼š¼Upgrading Installed Packages»å‡çº§å·²å®‰è£…çš„è½¯ä»¶åŒ…ÙUInstalled packages can be upgraded to their latest versions using man:pkg-upgrade[8]:ÙSå·²å®‰è£…çš„è½¯ä»¶åŒ…å¯ä»¥ä½¿ç”¨ man:pkg-upgrade[8] å‘½ä»¤å‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬ã€‚Ù‡This command will compare the installed versions with those available in the repository catalogue and upgrade them from the repository.Ùlè¯¥å‘½ä»¤å°†æ¯”è¾ƒå·²å®‰è£…çš„ç‰ˆæœ¬ä¸å­˜å‚¨åº“ç›®å½•ä¸­å¯ç”¨çš„ç‰ˆæœ¬ï¼Œå¹¶ä»å­˜å‚¨åº“ä¸­å‡çº§å®ƒä»¬ã€‚»Auditing Installed Packages»å®¡æ ¸å·²å®‰è£…çš„è½¯ä»¶åŒ…ÚSoftware vulnerabilities are regularly discovered in third-party applications.  To address this, pkg includes a built-in auditing mechanism.  To determine if there are any known vulnerabilities for the software installed on the system, use man:pkg-audit[8]:ÙÜç¬¬ä¸‰æ–¹åº”ç”¨ç¨‹åºç»å¸¸ä¼šå‘ç°è½¯ä»¶æ¼æ´ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œpkg åŒ…å«äº†ä¸€ä¸ªå†…ç½®çš„å®¡è®¡æœºåˆ¶ã€‚è¦ç¡®å®šç³»ç»Ÿä¸Šå®‰è£…çš„è½¯ä»¶æ˜¯å¦å­˜åœ¨å·²çŸ¥çš„æ¼æ´ï¼Œè¯·ä½¿ç”¨ man:pkg-audit[8] å‘½ä»¤ã€‚±Removing Packages¯ç§»é™¤è½¯ä»¶åŒ…ÙIPackages that are no longer needed can be removed with man:pkg-delete[8].ÙLä¸å†éœ€è¦çš„è½¯ä»¶åŒ…å¯ä»¥ä½¿ç”¨ man:pkg-delete[8] å‘½ä»¤è¿›è¡Œåˆ é™¤ã€‚¬For example:©ä¾‹å¦‚ï¼šÙ&Automatically Removing Unused PackagesÙ!è‡ªåŠ¨åˆ é™¤æœªä½¿ç”¨çš„è½¯ä»¶åŒ…ÙÜRemoving a package may leave behind dependencies which are no longer required.  Unneeded packages that were installed as dependencies (leaf packages) can be automatically detected and removed using man:pkg-autoremove[8]:Ù¼åˆ é™¤ä¸€ä¸ªè½¯ä»¶åŒ…å¯èƒ½ä¼šç•™ä¸‹ä¸å†éœ€è¦çš„ä¾èµ–é¡¹ã€‚å¯ä»¥ä½¿ç”¨ man:pkg-autoremove[8] è‡ªåŠ¨æ£€æµ‹å’Œåˆ é™¤ä½œä¸ºä¾èµ–é¡¹å®‰è£…çš„ä¸éœ€è¦çš„è½¯ä»¶åŒ…ï¼ˆå¶å­è½¯ä»¶åŒ…ï¼‰ã€‚ÙÈPackages installed as dependencies are called _automatic_ packages.  Non-automatic packages, i.e the packages that were explicity installed not as a dependency to another package, can be listed using:ÙÁä½œä¸ºä¾èµ–å®‰è£…çš„è½¯ä»¶åŒ…è¢«ç§°ä¸º _è‡ªåŠ¨_ è½¯ä»¶åŒ…ã€‚éè‡ªåŠ¨è½¯ä»¶åŒ…ï¼Œå³æ˜ç¡®å®‰è£…è€Œä¸æ˜¯ä½œä¸ºå…¶ä»–è½¯ä»¶åŒ…çš„ä¾èµ–é¡¹å®‰è£…çš„è½¯ä»¶åŒ…ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆ—å‡ºï¼šÚ`pkg prime-list` is an alias command declared in `/usr/local/etc/pkg.conf`.  There are many others that can be used to query the package database of the system.  For instance, command `pkg prime-origins` can be used to get the origin port directory of the list mentioned above:Ùó`pkg prime-list` æ˜¯åœ¨ `/usr/local/etc/pkg.conf` ä¸­å£°æ˜çš„ä¸€ä¸ªåˆ«åå‘½ä»¤ã€‚ç³»ç»Ÿä¸­è¿˜æœ‰è®¸å¤šå…¶ä»–å‘½ä»¤å¯ä»¥ç”¨æ¥æŸ¥è¯¢è½¯ä»¶åŒ…æ•°æ®åº“ã€‚ä¾‹å¦‚ï¼Œå‘½ä»¤ `pkg prime-origins` å¯ä»¥ç”¨æ¥è·å–ä¸Šè¿°åˆ—è¡¨çš„æº ports ç›®å½•ã€‚Ù›This list can be used to rebuild all packages installed on a system using build tools such as package:ports-mgmt/poudriere[] or package:ports-mgmt/synth[].Ù¡è¿™ä¸ªåˆ—è¡¨å¯ä»¥ç”¨äºä½¿ç”¨æ„å»ºå·¥å…·ï¼ˆå¦‚ package:ports-mgmt/poudriere[] æˆ– package:ports-mgmt/synth[]ï¼‰é‡æ–°æ„å»ºç³»ç»Ÿä¸Šå®‰è£…çš„æ‰€æœ‰è½¯ä»¶åŒ…ã€‚Ù<Marking an installed package as automatic can be done using:ÙHå°†å·²å®‰è£…çš„è½¯ä»¶åŒ…æ ‡è®°ä¸ºè‡ªåŠ¨å®‰è£…å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•ï¼šÙbOnce a package is a leaf package and is marked as automatic, it gets selected by `pkg autoremove`.Ùrä¸€æ—¦ä¸€ä¸ªåŒ…æ˜¯ä¸€ä¸ªå¶å­åŒ…å¹¶ä¸”è¢«æ ‡è®°ä¸ºè‡ªåŠ¨å®‰è£…ï¼Œå®ƒå°†è¢« `pkg autoremove` å‘½ä»¤é€‰æ‹©åˆ é™¤ã€‚ÙBMarking an installed package as _not_ automatic can be done using:ÙOå°†å·²å®‰è£…çš„è½¯ä»¶åŒ…æ ‡è®°ä¸º _é_ è‡ªåŠ¨å®‰è£…å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•ï¼š·Removing Stale Packages¸ç§»é™¤è¿‡æœŸçš„è½¯ä»¶åŒ…ÚBy default, pkg stores binary packages in a cache directory defined by `PKG_CACHEDIR` in man:pkg.conf[5].  Only copies of the latest installed packages are kept. Older versions of pkg kept all previous packages.  To remove these outdated binary packages, run:Úé»˜è®¤æƒ…å†µä¸‹ï¼Œpkg å°†äºŒè¿›åˆ¶è½¯ä»¶åŒ…å­˜å‚¨åœ¨ç”± man:pkg.conf[5] ä¸­çš„ `PKG_CACHEDIR` å®šä¹‰çš„ç¼“å­˜ç›®å½•ä¸­ã€‚åªä¿ç•™æœ€æ–°å®‰è£…çš„è½¯ä»¶åŒ…çš„å‰¯æœ¬ã€‚æ—§ç‰ˆæœ¬çš„ pkg ä¼šä¿ç•™æ‰€æœ‰å…ˆå‰çš„è½¯ä»¶åŒ…ã€‚è¦åˆ é™¤è¿™äº›è¿‡æ—¶çš„äºŒè¿›åˆ¶è½¯ä»¶åŒ…ï¼Œè¯·è¿è¡Œï¼šÙ+The entire cache may be cleared by running:Ù6å¯ä»¥é€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥æ¸…é™¤æ•´ä¸ªç¼“å­˜ï¼š¾Locking and Unlocking Packages¸é”å®šå’Œè§£é”è½¯ä»¶åŒ…Úkman:pkg-lock[8] is used to lock packages against reinstallation, modification or deletion.  man:pkg-unlock[8] unlocks the named packages.  Either variant only has an effect on currently installed packages.  Consequently it is impossible to block installation of a new package by using this mechanism, unless such an installation implies updating a locked package.Ú'man:pkg-lock[8] ç”¨äºé”å®šåŒ…ï¼Œé˜²æ­¢é‡æ–°å®‰è£…ã€ä¿®æ”¹æˆ–åˆ é™¤ã€‚man:pkg-unlock[8] ç”¨äºè§£é”æŒ‡å®šçš„åŒ…ã€‚æ— è®ºå“ªç§å˜ä½“ï¼Œéƒ½åªå¯¹å½“å‰å·²å®‰è£…çš„åŒ…äº§ç”Ÿå½±å“ã€‚å› æ­¤ï¼Œé™¤éå®‰è£…æ–°åŒ…æ„å‘³ç€æ›´æ–°å·²é”å®šçš„åŒ…ï¼Œå¦åˆ™æ— æ³•é€šè¿‡æ­¤æœºåˆ¶é˜»æ­¢æ–°åŒ…çš„å®‰è£…ã€‚Ù"For example, to lock `nginx-lite`:Ù"ä¾‹å¦‚ï¼Œè¦é”å®š `nginx-lite`ï¼š»And to unlock `nginx-lite`:¹è¦è§£é” `nginx-lite`ï¼šºModifying Package Metadata¸ä¿®æ”¹è½¯ä»¶åŒ…å…ƒæ•°æ®ÚBSoftware within the FreeBSD Ports Collection can undergo major version number changes.  To address this, pkg has a built-in command to update package origins.  This can be useful, for example, if package:lang/python3[] is renamed to package:lang/python311[] so that package:lang/python3[] can now represent version `3.11`.ÚUFreeBSD Ports Collection ä¸­çš„è½¯ä»¶å¯èƒ½ä¼šç»å†ä¸»ç‰ˆæœ¬å·çš„æ›´æ”¹ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œpkg æœ‰ä¸€ä¸ªå†…ç½®å‘½ä»¤æ¥æ›´æ–°è½¯ä»¶åŒ…çš„æ¥æºã€‚è¿™åœ¨æŸäº›æƒ…å†µä¸‹éå¸¸æœ‰ç”¨ï¼Œä¾‹å¦‚ï¼Œå¦‚æœ package:lang/python3[] è¢«é‡å‘½åä¸º package:lang/python311[] ï¼Œé‚£ä¹ˆ package:lang/python3[] ç°åœ¨å¯ä»¥è¡¨ç¤ºç‰ˆæœ¬ `3.11`ã€‚Ù8To change the package origin for the above example, run:ÙBè¦æ›´æ”¹ä¸Šé¢ç¤ºä¾‹çš„è½¯ä»¶åŒ…æ¥æºï¼Œè¯·è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼šÙRAs another example, to update package:lang/ruby31[] to package:lang/ruby32[], run:Ùiå¦ä¸€ä¸ªä¾‹å­æ˜¯ï¼Œè¦å°† package:lang/ruby31[] æ›´æ–°ä¸º package:lang/ruby32[]ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼šÙ·When changing package origins, it is important to reinstall packages that are dependent on the package with the modified origin.  To force a reinstallation of dependent packages, run:Ùåœ¨æ›´æ”¹è½¯ä»¶åŒ…æ¥æºæ—¶ï¼Œé‡è¦çš„æ˜¯é‡æ–°å®‰è£…ä¾èµ–äºå·²ä¿®æ”¹æ¥æºçš„è½¯ä»¶åŒ…ã€‚è¦å¼ºåˆ¶é‡æ–°å®‰è£…ä¾èµ–è½¯ä»¶åŒ…ï¼Œè¯·è¿è¡Œï¼šºUsing the Ports Collection³ä½¿ç”¨ Ports é›†åˆÙÃThe Ports Collection is a set of `Makefiles`, patches, and description files.  Each set of these files is used to compile and install an individual application on FreeBSD, and is called a _port_.Ù¦Ports Collection æ˜¯ä¸€ç»„ `Makefiles`ã€è¡¥ä¸å’Œæè¿°æ–‡ä»¶ã€‚æ¯ç»„è¿™äº›æ–‡ä»¶ç”¨äºåœ¨ FreeBSD ä¸Šç¼–è¯‘å’Œå®‰è£…å•ä¸ªåº”ç”¨ç¨‹åºï¼Œè¢«ç§°ä¸ºä¸€ä¸ª _ports_ã€‚ÙTBy default, the Ports Collection itself is stored as a subdirectory of `/usr/ports`.ÙRé»˜è®¤æƒ…å†µä¸‹ï¼ŒPorts Collection æœ¬èº«å­˜å‚¨åœ¨ `/usr/ports` çš„å­ç›®å½•ä¸­ã€‚Ú›Before installing and using the Ports Collection, please be aware that it is generally ill-advised to use the Ports Collection in conjunction with the binary packages provided via pkg to install software.  pkg, by default, tracks quarterly branch-releases of the ports tree and not HEAD.  Dependencies could be different for a port in HEAD compared to its counterpart in a quarterly branch release and this could result in conflicts between dependencies installed by pkg and those from the Ports Collection.  If the Ports Collection and pkg must be used in conjunction, then be sure that your Ports Collection and pkg are on the same branch release of the ports tree.Ú*åœ¨å®‰è£…å’Œä½¿ç”¨ Ports Collection ä¹‹å‰ï¼Œè¯·æ³¨æ„é€šå¸¸ä¸å»ºè®®ä½¿ç”¨ Ports Collection ä¸é€šè¿‡ pkg æä¾›çš„äºŒè¿›åˆ¶è½¯ä»¶åŒ…ä¸€èµ·å®‰è£…è½¯ä»¶ã€‚ pkg é»˜è®¤è·Ÿè¸ª ports æ ‘çš„å­£åº¦åˆ†æ”¯å‘å¸ƒï¼Œè€Œä¸æ˜¯ HEAD ã€‚ä¸å­£åº¦åˆ†æ”¯å‘å¸ƒä¸­çš„å¯¹åº” ports ç›¸æ¯”ï¼Œ HEAD ä¸­çš„ ports çš„ä¾èµ–å…³ç³»å¯èƒ½ä¸åŒï¼Œè¿™å¯èƒ½å¯¼è‡´ pkg å®‰è£…çš„ä¾èµ–å…³ç³»ä¸ Ports Collection ä¸­çš„ä¾èµ–å…³ç³»å‘ç”Ÿå†²çªã€‚å¦‚æœå¿…é¡»åŒæ—¶ä½¿ç”¨ Ports Collection å’Œ pkg ï¼Œè¯·ç¡®ä¿æ‚¨çš„ Ports Collection å’Œ pkg ä½äºç›¸åŒçš„ ports æ ‘åˆ†æ”¯å‘å¸ƒä¸Šã€‚ÚPThe Ports Collection contains directories for software categories.  Inside each category are subdirectories for individual applications.  Each application subdirectory contains a set of files that tells FreeBSD how to compile and install that program, called a _ports skeleton_.  Each port skeleton includes these files and directories:ÚPorts é›†åˆåŒ…å«äº†è½¯ä»¶ç±»åˆ«çš„ç›®å½•ã€‚æ¯ä¸ªç±»åˆ«ä¸­éƒ½æœ‰é’ˆå¯¹ä¸ªåˆ«åº”ç”¨ç¨‹åºçš„å­ç›®å½•ã€‚æ¯ä¸ªåº”ç”¨ç¨‹åºå­ç›®å½•åŒ…å«ä¸€ç»„æ–‡ä»¶ï¼Œå‘Šè¯‰ FreeBSD å¦‚ä½•ç¼–è¯‘å’Œå®‰è£…è¯¥ç¨‹åºï¼Œç§°ä¸º _ports skeleton_ã€‚æ¯ä¸ª ports éª¨æ¶åŒ…æ‹¬ä»¥ä¸‹æ–‡ä»¶å’Œç›®å½•ï¼šÙ‚*Makefile*: contains statements that specify how the application should be compiled and where its components should be installed.
Ù_*Makefile*ï¼šåŒ…å«æŒ‡å®šåº”ç”¨ç¨‹åºå¦‚ä½•ç¼–è¯‘ä»¥åŠå…¶ç»„ä»¶åº”å®‰è£…åœ¨ä½•å¤„çš„è¯­å¥ã€‚
Ùe*distinfo*: contains the names and checksums of the files that must be downloaded to build the port.
ÙN*distinfo*ï¼šåŒ…å«æ„å»º ports æ‰€éœ€ä¸‹è½½çš„æ–‡ä»¶çš„åç§°å’Œæ ¡éªŒå’Œã€‚
Ù¬*files/*: this directory contains any patches needed for the program to compile and install on FreeBSD. This directory may also contain other files used to build the port.
Ù*files/*ï¼šè¿™ä¸ªç›®å½•åŒ…å«äº†åœ¨ FreeBSD ä¸Šç¼–è¯‘å’Œå®‰è£…ç¨‹åºæ‰€éœ€çš„è¡¥ä¸æ–‡ä»¶ã€‚è¿™ä¸ªç›®å½•ä¹Ÿå¯èƒ½åŒ…å«å…¶ä»–ç”¨äºæ„å»º ports çš„æ–‡ä»¶ã€‚
ÙB*pkg-descr*: provides a more detailed description of the program.
Ù0*pkg-descr*ï¼šæä¾›ç¨‹åºçš„æ›´è¯¦ç»†æè¿°ã€‚
Ù“*pkg-plist*: a list of all the files that will be installed by the port. It also tells the ports system which files to remove upon deinstallation.
Ù†*pkg-plist*ï¼šä¸€ä¸ªåŒ…å«æ‰€æœ‰å°†ç”± ports å®‰è£…çš„æ–‡ä»¶çš„åˆ—è¡¨ã€‚å®ƒè¿˜å‘Šè¯‰ ports ç³»ç»Ÿåœ¨å¸è½½æ—¶è¦åˆ é™¤å“ªäº›æ–‡ä»¶ã€‚
ÙËSome ports include `pkg-message` or other files to handle special situations.  For more details on these files, and on ports in general, refer to the extref:{porters-handbook}[FreeBSD Porter's Handbook].ÙÁä¸€äº› ports åŒ…æ‹¬ `pkg-message` æˆ–å…¶ä»–æ–‡ä»¶æ¥å¤„ç†ç‰¹æ®Šæƒ…å†µã€‚æœ‰å…³è¿™äº›æ–‡ä»¶ä»¥åŠ ports çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è€ƒ extref:{porters-handbook}[FreeBSD Porter's Handbook]ã€‚Ù¾The port does not include the actual source code, also known as a `distfile`.  The extract portion of building a port will automatically save the downloaded source to `/usr/ports/distfiles`.Ùš ports ä¸åŒ…å«å®é™…çš„æºä»£ç ï¼Œä¹Ÿç§°ä¸º `distfile` ã€‚æ„å»º ports çš„æå–éƒ¨åˆ†å°†è‡ªåŠ¨å°†ä¸‹è½½çš„æºä»£ç ä¿å­˜åˆ° `/usr/ports/distfiles`ã€‚¿Installing the Ports Collection³å®‰è£… Ports é›†åˆÙÎBefore an application can be compiled using a port, the Ports Collection must first be installed.  If it was not installed during the installation of FreeBSD, use one of the following methods to install it:Ù¡åœ¨ä½¿ç”¨ ports ç¼–è¯‘åº”ç”¨ç¨‹åºä¹‹å‰ï¼Œå¿…é¡»å…ˆå®‰è£… ports é›†åˆã€‚å¦‚æœåœ¨å®‰è£… FreeBSD æ—¶æ²¡æœ‰å®‰è£…å®ƒï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•ä¹‹ä¸€è¿›è¡Œå®‰è£…ï¼š¸*Procedure: Git Method*
¶*è¿‡ç¨‹ï¼šGit æ–¹æ³•*
Ú
If more control over the ports tree is needed or if local changes need to be maintained, or if running FreeBSD-CURRENT, Git can be used to obtain the Ports Collection.  Refer to extref:{committers-guide}[the Git Primer, git-primer] for a detailed description of Git.Ùÿå¦‚æœéœ€è¦å¯¹ ports æ ‘è¿›è¡Œæ›´å¤šçš„æ§åˆ¶ï¼Œæˆ–è€…éœ€è¦ç»´æŠ¤æœ¬åœ°æ›´æ”¹ï¼Œæˆ–è€…æ­£åœ¨è¿è¡Œ FreeBSD-CURRENTï¼Œå¯ä»¥ä½¿ç”¨ Git æ¥è·å– Ports Collectionã€‚æœ‰å…³ Git çš„è¯¦ç»†æè¿°ï¼Œè¯·å‚é˜… extref:{committers-guide}[Git Primer,git-primer]ã€‚ÙGit must be installed before it can be used to check out the ports tree. If a copy of the ports tree is already present, install Git like this:Ùåœ¨ä½¿ç”¨ Git æ£€å‡º ports æ ‘ä¹‹å‰ï¼Œå¿…é¡»å…ˆå®‰è£… Git ã€‚å¦‚æœå·²ç»å­˜åœ¨ä¸€ä¸ª ports æ ‘çš„å‰¯æœ¬ï¼Œè¯·æŒ‰ç…§ä»¥ä¸‹æ–¹å¼å®‰è£… Git ï¼šÙoIf the ports tree is not available, or pkg is being used to manage packages, Git can be installed as a package:Ùtå¦‚æœ ports æ ‘ä¸å¯ç”¨ï¼Œæˆ–è€…æ­£åœ¨ä½¿ç”¨ pkg æ¥ç®¡ç†è½¯ä»¶åŒ…ï¼Œå¯ä»¥å°† Git ä½œä¸ºä¸€ä¸ªè½¯ä»¶åŒ…å®‰è£…ï¼šÙ6Check out a copy of the HEAD branch of the ports tree:Ù+æ£€å‡º ports æ ‘çš„ HEAD åˆ†æ”¯çš„å‰¯æœ¬ï¼šÙ+Or, check out a copy of a quarterly branch:Ù-æˆ–è€…ï¼Œæ£€å‡ºä¸€ä¸ªå­£åº¦åˆ†æ”¯çš„å‰¯æœ¬ï¼šÙ>As needed, update `/usr/ports` after the initial Git checkout:ÙBåœ¨åˆå§‹çš„ Git æ£€å‡ºä¹‹åï¼Œæ ¹æ®éœ€è¦æ›´æ–° `/usr/ports`ã€‚Ù?As needed, switch `/usr/ports` to a different quarterly branch:ÙAæ ¹æ®éœ€è¦ï¼Œå°† `/usr/ports` åˆ‡æ¢åˆ°ä¸åŒçš„å­£åº¦åˆ†æ”¯ï¼š°Installing Ports¬å®‰è£… PortsÙÓThis section provides basic instructions on using the Ports Collection to install or remove software.  The detailed description of available `make` targets and environment variables is available in man:ports[7].Ù¥æœ¬èŠ‚æä¾›äº†ä½¿ç”¨ Ports Collection å®‰è£…æˆ–åˆ é™¤è½¯ä»¶çš„åŸºæœ¬è¯´æ˜ã€‚æœ‰å…³å¯ç”¨çš„ `make` ç›®æ ‡å’Œç¯å¢ƒå˜é‡çš„è¯¦ç»†æè¿°ï¼Œè¯·å‚é˜… man:ports[7]ã€‚ÚTBefore compiling any port, be sure to update the Ports Collection as described in the previous section.  Since the installation of any third-party software can introduce security vulnerabilities, it is recommended to first check https://vuxml.freebsd.org/[] for known security issues related to the port.  Alternatively, run `pkg audit -F` before installing a new port.  This command can be configured to automatically perform a security audit and an update of the vulnerability database during the daily security system check. For more information, refer to man:pkg-audit[8] and man:periodic[8].Úìåœ¨ç¼–è¯‘ä»»ä½• ports ä¹‹å‰ï¼Œè¯·ç¡®ä¿æŒ‰ç…§å‰ä¸€èŠ‚ä¸­çš„æè¿°æ›´æ–° Ports Collectionã€‚ç”±äºå®‰è£…ä»»ä½•ç¬¬ä¸‰æ–¹è½¯ä»¶éƒ½å¯èƒ½å¼•å…¥å®‰å…¨æ¼æ´ï¼Œå»ºè®®é¦–å…ˆåœ¨ https://vuxml.freebsd.org/[] ä¸Šæ£€æŸ¥ä¸è¯¥ ports ç›¸å…³çš„å·²çŸ¥å®‰å…¨é—®é¢˜ã€‚æˆ–è€…ï¼Œåœ¨å®‰è£…æ–° ports ä¹‹å‰è¿è¡Œ `pkg audit -F`ã€‚æ­¤å‘½ä»¤å¯ä»¥é…ç½®ä¸ºåœ¨æ¯æ—¥å®‰å…¨ç³»ç»Ÿæ£€æŸ¥æœŸé—´è‡ªåŠ¨æ‰§è¡Œå®‰å…¨å®¡è®¡å’Œæ¼æ´æ•°æ®åº“çš„æ›´æ–°ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜… man:pkg-audit[8] å’Œ man:periodic[8]ã€‚ÙhUsing the Ports Collection assumes a working Internet connection.  It also requires superuser privilege.Ù[ä½¿ç”¨ Ports é›†åˆéœ€è¦ä¸€ä¸ªæ­£å¸¸çš„äº’è”ç½‘è¿æ¥ã€‚å®ƒè¿˜éœ€è¦è¶…çº§ç”¨æˆ·æƒé™ã€‚Ù£To compile and install the port, change to the directory of the port to be installed, then type `make install` at the prompt.  Messages will indicate the progress:Ù‹è¦ç¼–è¯‘å’Œå®‰è£… portsï¼Œè¯·åˆ‡æ¢åˆ°è¦å®‰è£…çš„ ports çš„ç›®å½•ï¼Œç„¶ååœ¨æç¤ºç¬¦ä¸‹é”®å…¥ `make install`ã€‚æ¶ˆæ¯å°†æŒ‡ç¤ºè¿›åº¦ï¼šÙ³Since `lsof` is a program that runs with increased privileges, a security warning is displayed as it is installed.  Once the installation is complete, the prompt will be returned.Ù’ç”±äº `lsof` æ˜¯ä¸€ä¸ªä»¥å¢åŠ æƒé™è¿è¡Œçš„ç¨‹åºï¼Œå› æ­¤åœ¨å®‰è£…æ—¶ä¼šæ˜¾ç¤ºä¸€ä¸ªå®‰å…¨è­¦å‘Šã€‚å®‰è£…å®Œæˆåï¼Œæç¤ºç¬¦å°†ä¼šè¿”å›ã€‚Ú­Some shells keep a cache of the commands that are available in the directories listed in the `PATH` environment variable, to speed up lookup operations for the executable file of these commands.  Users of the `tcsh` shell should type `rehash` so that a newly installed command can be used without specifying its full path.  Use `hash -r` instead for the `sh` shell.  Refer to the documentation for the shell for more information.Úsä¸€äº› shell ä¼šåœ¨ `PATH` ç¯å¢ƒå˜é‡æ‰€åˆ—ç›®å½•ä¸­ä¿ç•™ä¸€ä¸ªå‘½ä»¤ç¼“å­˜ï¼Œä»¥åŠ å¿«å¯¹è¿™äº›å‘½ä»¤å¯æ‰§è¡Œæ–‡ä»¶çš„æŸ¥æ‰¾æ“ä½œã€‚ä½¿ç”¨ `tcsh` shell çš„ç”¨æˆ·åº”è¯¥è¾“å…¥ `rehash` å‘½ä»¤ï¼Œä»¥ä¾¿å¯ä»¥åœ¨ä¸æŒ‡å®šå®Œæ•´è·¯å¾„çš„æƒ…å†µä¸‹ä½¿ç”¨æ–°å®‰è£…çš„å‘½ä»¤ã€‚å¯¹äº `sh` shellï¼Œè¯·ä½¿ç”¨ `hash -r` å‘½ä»¤ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜… shell çš„æ–‡æ¡£ã€‚ÙüDuring installation, a working subdirectory is created which contains all the temporary files used during compilation.  Removing this directory saves disk space and minimizes the chance of problems later when upgrading to the newer version of the port:Ùîåœ¨å®‰è£…è¿‡ç¨‹ä¸­ï¼Œä¼šåˆ›å»ºä¸€ä¸ªå·¥ä½œå­ç›®å½•ï¼Œå…¶ä¸­åŒ…å«ç¼–è¯‘è¿‡ç¨‹ä¸­ä½¿ç”¨çš„æ‰€æœ‰ä¸´æ—¶æ–‡ä»¶ã€‚åˆ é™¤æ­¤ç›®å½•å¯ä»¥èŠ‚çœç£ç›˜ç©ºé—´ï¼Œå¹¶åœ¨ä»¥åå‡çº§åˆ°æ–°ç‰ˆæœ¬çš„ ports æ—¶æœ€å¤§ç¨‹åº¦åœ°å‡å°‘é—®é¢˜çš„å¯èƒ½æ€§ã€‚ÙRTo save this extra step, instead use `make install clean` when compiling the port.ÙXä¸ºäº†é¿å…è¿™ä¸ªé¢å¤–çš„æ­¥éª¤ï¼Œç¼–è¯‘ ports æ—¶å¯ä»¥ä½¿ç”¨ `make install clean`ã€‚¾Customizing Ports Installation¶è‡ªå®šä¹‰ ports å®‰è£…Ú\Some ports provide build options which can be used to enable or disable application components, provide security options, or allow for other customizations.  Examples include package:www/firefox[] and package:security/gpgme[].  If the port depends upon other ports which have configurable options, it may pause several times for user interaction as the default behavior is to prompt the user to select options from a menu.  To avoid this and do all of the configuration in one batch, run `make config-recursive` within the port skeleton.  Then, run `make install [clean]` to compile and install the port.Ú1ä¸€äº› ports æä¾›æ„å»ºé€‰é¡¹ï¼Œå¯ä»¥ç”¨äºå¯ç”¨æˆ–ç¦ç”¨åº”ç”¨ç¨‹åºç»„ä»¶ï¼Œæä¾›å®‰å…¨é€‰é¡¹æˆ–å…è®¸å…¶ä»–è‡ªå®šä¹‰ã€‚ç¤ºä¾‹åŒ…æ‹¬ package:www/firefox[] å’Œ package:security/gpgme[]ã€‚å¦‚æœè¯¥ ports ä¾èµ–äºå…·æœ‰å¯é…ç½®é€‰é¡¹çš„å…¶ä»– portsï¼Œåˆ™é»˜è®¤è¡Œä¸ºæ˜¯æç¤ºç”¨æˆ·ä»èœå•ä¸­é€‰æ‹©é€‰é¡¹ï¼Œå› æ­¤å¯èƒ½ä¼šå¤šæ¬¡æš‚åœä»¥è¿›è¡Œç”¨æˆ·äº¤äº’ã€‚ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œå¹¶åœ¨ä¸€ä¸ªæ‰¹å¤„ç†ä¸­è¿›è¡Œæ‰€æœ‰é…ç½®ï¼Œè¯·åœ¨ ports éª¨æ¶ä¸­è¿è¡Œ `make config-recursive`ã€‚ç„¶åï¼Œè¿è¡Œ `make install [clean]` æ¥ç¼–è¯‘å’Œå®‰è£…è¯¥ portsã€‚Ú?When using `config-recursive`, the list of ports to configure are gathered by the `all-depends-list` target.  It is recommended to run `make config-recursive` until all dependent ports options have been defined, and ports options screens no longer appear, to be certain that all dependency options have been configured.Úå½“ä½¿ç”¨ `config-recursive` æ—¶ï¼Œè¦é…ç½®çš„ ports åˆ—è¡¨æ˜¯é€šè¿‡ `all-depends-list` ç›®æ ‡æ”¶é›†çš„ã€‚å»ºè®®è¿è¡Œ `make config-recursive` ç›´åˆ°æ‰€æœ‰ä¾èµ– ports é€‰é¡¹éƒ½è¢«å®šä¹‰ï¼Œå¹¶ä¸” ports é€‰é¡¹å±å¹•ä¸å†å‡ºç°ï¼Œä»¥ç¡®ä¿æ‰€æœ‰ä¾èµ–é€‰é¡¹éƒ½å·²é…ç½®ã€‚ÚÒThere are several ways to revisit a port's build options menu in order to add, remove, or change these options after a port has been built.  One method is to `cd` into the directory containing the port and type `make config`.  Another option is to use `make showconfig`.  Another option is to execute `make rmconfig` which will remove all selected options and allow you to start over.  All of these options, and others, are explained in great detail in man:ports[7].ÚÁåœ¨æ„å»º ports åï¼Œæœ‰å‡ ç§æ–¹æ³•å¯ä»¥é‡æ–°è®¿é—® ports çš„æ„å»ºé€‰é¡¹èœå•ï¼Œä»¥æ·»åŠ ã€åˆ é™¤æˆ–æ›´æ”¹è¿™äº›é€‰é¡¹ã€‚ä¸€ç§æ–¹æ³•æ˜¯è¿›å…¥åŒ…å« ports çš„ç›®å½•ï¼Œç„¶åè¾“å…¥ `make config` å‘½ä»¤ã€‚å¦ä¸€ç§é€‰æ‹©æ˜¯ä½¿ç”¨ `make showconfig` å‘½ä»¤ã€‚è¿˜å¯ä»¥æ‰§è¡Œ `make rmconfig` å‘½ä»¤ï¼Œè¯¥å‘½ä»¤å°†åˆ é™¤æ‰€æœ‰å·²é€‰æ‹©çš„é€‰é¡¹ï¼Œå¹¶å…è®¸æ‚¨é‡æ–°å¼€å§‹ã€‚æ‰€æœ‰è¿™äº›é€‰é¡¹ä»¥åŠå…¶ä»–é€‰é¡¹éƒ½åœ¨ man:ports[7] ä¸­è¯¦ç»†è§£é‡Šã€‚ÚBThe ports system uses man:fetch[1] to download the source files, which supports various environment variables.  The `FTP_PASSIVE_MODE`, `FTP_PROXY`, and `FTP_PASSWORD` variables may need to be set if the FreeBSD system is behind a firewall or FTP/HTTP proxy.  See man:fetch[3] for the complete list of supported variables.Ú)ports ç³»ç»Ÿä½¿ç”¨ man:fetch[1] æ¥ä¸‹è½½æºæ–‡ä»¶ï¼Œè¯¥å·¥å…·æ”¯æŒå„ç§ç¯å¢ƒå˜é‡ã€‚å¦‚æœ FreeBSD ç³»ç»Ÿä½äºé˜²ç«å¢™æˆ– FTP/HTTP ä»£ç†åé¢ï¼Œå¯èƒ½éœ€è¦è®¾ç½® `FTP_PASSIVE_MODE`ã€`FTP_PROXY` å’Œ `FTP_PASSWORD` å˜é‡ã€‚æœ‰å…³æ”¯æŒçš„å˜é‡çš„å®Œæ•´åˆ—è¡¨ï¼Œè¯·å‚é˜… man:fetch[3]ã€‚ÚŞFor users who cannot be connected to the Internet all the time, `make fetch` can be run within `/usr/ports`, to fetch all distfiles, or within a category, such as `/usr/ports/net`, or within the specific port skeleton.  Note that if a port has any dependencies, running this command in a category or ports skeleton will _not_ fetch the distfiles of ports from another category.  Instead, use `make fetch-recursive` to also fetch the distfiles for all the dependencies of a port.Úôå¯¹äºä¸èƒ½å§‹ç»ˆè¿æ¥åˆ°äº’è”ç½‘çš„ç”¨æˆ·ï¼Œå¯ä»¥åœ¨ `/usr/ports` ç›®å½•ä¸‹è¿è¡Œ `make fetch` å‘½ä»¤ï¼Œä»¥è·å–æ‰€æœ‰çš„ distfilesï¼Œæˆ–è€…åœ¨æŸä¸ªåˆ†ç±»ç›®å½•ï¼ˆä¾‹å¦‚ `/usr/ports/net`ï¼‰æˆ–ç‰¹å®šçš„ ports éª¨æ¶ä¸­è¿è¡Œã€‚è¯·æ³¨æ„ï¼Œå¦‚æœä¸€ä¸ª ports æœ‰ä»»ä½•ä¾èµ–é¡¹ï¼Œé‚£ä¹ˆåœ¨åˆ†ç±»ç›®å½•æˆ– ports éª¨æ¶ä¸­è¿è¡Œæ­¤å‘½ä»¤å°†ä¸ä¼šè·å–æ¥è‡ªå…¶ä»–åˆ†ç±»çš„ ports çš„ distfilesã€‚ç›¸åï¼Œä½¿ç”¨ `make fetch-recursive` å‘½ä»¤ä¹Ÿå¯ä»¥è·å– ports çš„æ‰€æœ‰ä¾èµ–é¡¹çš„ distfilesã€‚ÙâIn rare cases, such as when an organization has a local distfiles repository, the `MASTER_SITES` variable can be used to override the download locations specified in the `Makefile`.  When using, specify the alternate location:ÙÂåœ¨æå°‘æ•°æƒ…å†µä¸‹ï¼Œä¾‹å¦‚å½“ç»„ç»‡æ‹¥æœ‰æœ¬åœ°çš„ distfiles ä»“åº“æ—¶ï¼Œ`MASTER_SITES` å˜é‡å¯ä»¥ç”¨äºè¦†ç›– `Makefile` ä¸­æŒ‡å®šçš„ä¸‹è½½ä½ç½®ã€‚åœ¨ä½¿ç”¨æ—¶ï¼Œè¯·æŒ‡å®šæ›¿ä»£ä½ç½®ï¼šÙoThe `WRKDIRPREFIX` and `PREFIX` variables can override the default working and target directories. For example:Ù^`WRKDIRPREFIX` å’Œ `PREFIX` å˜é‡å¯ä»¥è¦†ç›–é»˜è®¤çš„å·¥ä½œç›®å½•å’Œç›®æ ‡ç›®å½•ã€‚ä¾‹å¦‚ï¼šÙ]will compile the port in `/usr/home/example/ports` and install everything under `/usr/local`.Ùoå°† ports ç¼–è¯‘åœ¨ `/usr/home/example/ports` ç›®å½•ä¸‹ï¼Œå¹¶å°†æ‰€æœ‰å†…å®¹å®‰è£…åœ¨ `/usr/local` ç›®å½•ä¸‹ã€‚ÙWwill compile the port in `/usr/ports` and install it in `/usr/home/example/local`. And:Ùcå°† ports ç¼–è¯‘åœ¨ `/usr/ports` ä¸­ï¼Œå¹¶å°†å…¶å®‰è£…åœ¨ `/usr/home/example/local` ä¸­ã€‚å¹¶ä¸”ï¼šµwill combine the two.²å°†ä¸¤è€…åˆå¹¶ã€‚Ù”These can also be set as environmental variables.  Refer to the manual page for your shell for instructions on how to set an environmental variable.Ù‚è¿™äº›ä¹Ÿå¯ä»¥è®¾ç½®ä¸ºç¯å¢ƒå˜é‡ã€‚è¯·å‚è€ƒæ‚¨æ‰€ä½¿ç”¨çš„ shell çš„æ‰‹å†Œé¡µé¢ï¼Œäº†è§£å¦‚ä½•è®¾ç½®ç¯å¢ƒå˜é‡çš„æŒ‡ä»¤ã€‚¸Removing Installed Ports¹ç§»é™¤å·²å®‰è£…çš„ ports ÙŠInstalled ports can be uninstalled using `pkg delete`.  Examples for using this command can be found in the man:pkg-delete[8] manual page.Ù„ä½¿ç”¨ `pkg delete` å‘½ä»¤å¯ä»¥å¸è½½å·²å®‰è£…çš„ portsã€‚æœ‰å…³ä½¿ç”¨æ­¤å‘½ä»¤çš„ç¤ºä¾‹ï¼Œè¯·å‚é˜… man:pkg-delete[8] æ‰‹å†Œé¡µã€‚ÙBAlternately, `make deinstall` can be run in the port\'s directory:ÙFæˆ–è€…ï¼Œå¯ä»¥åœ¨ ports çš„ç›®å½•ä¸­è¿è¡Œ `make deinstall` å‘½ä»¤ï¼šÚ(It is recommended to read the messages as the port is uninstalled.  If the port has any applications that depend upon it, this information will be displayed but the uninstallation will proceed.  In such cases, it may be better to reinstall the application in order to prevent broken dependencies.Ùòå»ºè®®åœ¨å¸è½½ ports ä¹‹å‰é˜…è¯»æ¶ˆæ¯ã€‚å¦‚æœè¯¥ ports æœ‰ä»»ä½•ä¾èµ–äºå®ƒçš„åº”ç”¨ç¨‹åºï¼Œè¿™äº›ä¿¡æ¯å°†è¢«æ˜¾ç¤ºï¼Œä½†å¸è½½å°†ç»§ç»­è¿›è¡Œã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œé‡æ–°å®‰è£…åº”ç”¨ç¨‹åºå¯èƒ½æ›´å¥½ï¼Œä»¥é˜²æ­¢ä¾èµ–å…³ç³»ç ´è£‚ã€‚¯Upgrading Ports¬å‡çº§ portsÙ·Over time, newer versions of software become available in the Ports Collection.  This section describes how to determine which software can be upgraded and how to perform the upgrade.Ù¡éšç€æ—¶é—´çš„æ¨ç§»ï¼ŒPorts Collection ä¸­ä¼šæœ‰æ›´æ–°ç‰ˆæœ¬çš„è½¯ä»¶å¯ç”¨ã€‚æœ¬èŠ‚ä»‹ç»äº†å¦‚ä½•ç¡®å®šå¯ä»¥å‡çº§çš„è½¯ä»¶ä»¥åŠå¦‚ä½•æ‰§è¡Œå‡çº§æ“ä½œã€‚ÚTo determine if newer versions of installed ports are available, ensure that the latest version of the ports tree is installed, using the updating command described in <<ports-using-git-method, "Git Method">>.  The following command will list the installed ports which are out of date:Ùéè¦ç¡®å®šå·²å®‰è£…çš„ ports æ˜¯å¦æœ‰æ›´æ–°ç‰ˆæœ¬å¯ç”¨ï¼Œè¯·ç¡®ä¿å®‰è£…äº†æœ€æ–°ç‰ˆæœ¬çš„ ports æ ‘ï¼Œä½¿ç”¨åœ¨ <<ports-using-git-method, "Git Method">> ä¸­æè¿°çš„æ›´æ–°å‘½ä»¤ã€‚ä»¥ä¸‹å‘½ä»¤å°†åˆ—å‡ºå·²è¿‡æ—¶çš„å·²å®‰è£… portsï¼šÚ5Before attempting an upgrade, read `/usr/ports/UPDATING` from the top of the file to the date closest to the last time ports were upgraded or the system was installed.  This file describes various issues and additional steps users may encounter and need to perform when updating a port, including such things as file format changes, changes in locations of configuration files, or any incompatibilities with previous versions.  Make note of any instructions which match any of the ports that need upgrading and follow these instructions when performing the upgrade.Ú·åœ¨å°è¯•å‡çº§ä¹‹å‰ï¼Œè¯·ä»æ–‡ä»¶é¡¶éƒ¨å¼€å§‹é˜…è¯» `/usr/ports/UPDATING`ï¼Œç›´åˆ°æœ€æ¥è¿‘ä¸Šæ¬¡å‡çº§ ports æˆ–å®‰è£…ç³»ç»Ÿçš„æ—¥æœŸã€‚è¯¥æ–‡ä»¶æè¿°äº†åœ¨æ›´æ–° ports æ—¶ç”¨æˆ·å¯èƒ½é‡åˆ°çš„å„ç§é—®é¢˜å’Œéœ€è¦æ‰§è¡Œçš„é¢å¤–æ­¥éª¤ï¼ŒåŒ…æ‹¬æ–‡ä»¶æ ¼å¼æ›´æ”¹ã€é…ç½®æ–‡ä»¶ä½ç½®æ›´æ”¹æˆ–ä¸å…ˆå‰ç‰ˆæœ¬ä¸å…¼å®¹çš„ä»»ä½•é—®é¢˜ã€‚è¯·æ³¨æ„ä»»ä½•ä¸éœ€è¦å‡çº§çš„ ports åŒ¹é…çš„è¯´æ˜ï¼Œå¹¶åœ¨æ‰§è¡Œå‡çº§æ—¶éµå¾ªè¿™äº›è¯´æ˜ã€‚Ù!Tools to Upgrade and Manage Ports¿å‡çº§å’Œç®¡ç† ports çš„å·¥å…·ÙvThe Ports Collection contains several utilities to perform the actual upgrade.  Each has its strengths and weaknesses.ÙhPorts Collection åŒ…å«å¤šä¸ªå®é™…æ‰§è¡Œå‡çº§çš„å®ç”¨å·¥å…·ã€‚æ¯ä¸ªå·¥å…·éƒ½æœ‰å…¶ä¼˜ç‚¹å’Œç¼ºç‚¹ã€‚ÙfHistorically, most installations used either Portmaster or Portupgrade.  Synth is a newer alternative.Ùsä»å†å²ä¸Šçœ‹ï¼Œå¤§å¤šæ•°å®‰è£…ä½¿ç”¨çš„æ˜¯ Portmaster æˆ– Portupgrade ã€‚Synth æ˜¯ä¸€ç§è¾ƒæ–°çš„æ›¿ä»£æ–¹æ¡ˆã€‚Ù­The choice of which tool is best for a particular system is up to the system administrator.  It is recommended practice to back up your data before using any of these tools.Ù~é€‰æ‹©å“ªç§å·¥å…·æœ€é€‚åˆç‰¹å®šç³»ç»Ÿæ˜¯ç”±ç³»ç»Ÿç®¡ç†å‘˜å†³å®šçš„ã€‚åœ¨ä½¿ç”¨è¿™äº›å·¥å…·ä¹‹å‰ï¼Œå»ºè®®å…ˆå¤‡ä»½æ•°æ®ã€‚Ù Upgrading Ports Using Portmaster¾ä½¿ç”¨ Portmaster å‡çº§ PortsÙñpackage:ports-mgmt/portmaster[] is a very small utility for upgrading installed ports.  It is designed to use the tools installed with the FreeBSD base system without depending on other ports or databases.  To install this utility as a port:Ùğpackage:ports-mgmt/portmaster[] æ˜¯ä¸€ä¸ªéå¸¸å°çš„å·¥å…·ï¼Œç”¨äºå‡çº§å·²å®‰è£…çš„ portsã€‚å®ƒæ—¨åœ¨ä½¿ç”¨å®‰è£…åœ¨ FreeBSD åŸºæœ¬ç³»ç»Ÿä¸­çš„å·¥å…·ï¼Œè€Œä¸ä¾èµ–å…¶ä»– ports æˆ–æ•°æ®åº“ã€‚è¦å°†æ­¤å®ç”¨ç¨‹åºå®‰è£…ä¸ºä¸€ä¸ª portsï¼šÙ,Portmaster defines four categories of ports:Ù-Portmaster å®šä¹‰äº†å››ä¸ª ports çš„åˆ†ç±»ï¼šÙJRoot port: has no dependencies and is not a dependency of any other ports.ÙJRoot portsï¼šæ²¡æœ‰ä¾èµ–é¡¹ï¼Œä¹Ÿä¸æ˜¯ä»»ä½•å…¶ä»– ports çš„ä¾èµ–é¡¹ã€‚Ù@Trunk port: has no dependencies, but other ports depend upon it.Ù?Trunk portsï¼šæ²¡æœ‰ä¾èµ–é¡¹ï¼Œä½†å…¶ä»– ports ä¾èµ–äºå®ƒã€‚Ù=Branch port: has dependencies and other ports depend upon it.Ù@Branch portsï¼šå…·æœ‰ä¾èµ–å…³ç³»ï¼Œå…¶ä»– ports ä¾èµ–äºå®ƒã€‚Ù>Leaf port: has dependencies but no other ports depend upon it.ÙGLeaf portsï¼šå…·æœ‰ä¾èµ–å…³ç³»ï¼Œä½†æ²¡æœ‰å…¶ä»– ports ä¾èµ–äºå®ƒã€‚Ù0To list these categories and search for updates:Ù'è¦åˆ—å‡ºè¿™äº›ç±»åˆ«å¹¶æœç´¢æ›´æ–°ï¼šÙ3This command is used to upgrade all outdated ports:Ù0è¿™ä¸ªå‘½ä»¤ç”¨äºå‡çº§æ‰€æœ‰è¿‡æ—¶çš„ portsï¼šÚÔBy default, Portmaster makes a backup package before deleting the existing port.  If the installation of the new version is successful, Portmaster deletes the backup.  Using `-b` instructs Portmaster not to automatically delete the backup.  Adding `-i` starts Portmaster in interactive mode, prompting for confirmation before upgrading each port.  Many other options are available.  Read through the manual page for man:portmaster[8] for details regarding their usage.Ú«é»˜è®¤æƒ…å†µä¸‹ï¼ŒPortmaster åœ¨åˆ é™¤ç°æœ‰ ports ä¹‹å‰ä¼šåˆ›å»ºä¸€ä¸ªå¤‡ä»½åŒ…ã€‚å¦‚æœæ–°ç‰ˆæœ¬çš„å®‰è£…æˆåŠŸï¼ŒPortmaster ä¼šåˆ é™¤å¤‡ä»½ã€‚ä½¿ç”¨ `-b` æŒ‡ä»¤å¯ä»¥è®© Portmaster ä¸è‡ªåŠ¨åˆ é™¤å¤‡ä»½ã€‚æ·»åŠ  `-i` å¯ä»¥å¯åŠ¨ Portmaster çš„äº¤äº’æ¨¡å¼ï¼Œåœ¨å‡çº§æ¯ä¸ª ports ä¹‹å‰æç¤ºç¡®è®¤ã€‚è¿˜æœ‰è®¸å¤šå…¶ä»–é€‰é¡¹å¯ç”¨ã€‚è¯·é˜…è¯» man:portmaster[8] çš„æ‰‹å†Œé¡µé¢ï¼Œäº†è§£æœ‰å…³å®ƒä»¬ä½¿ç”¨çš„è¯¦ç»†ä¿¡æ¯ã€‚Ù`If errors are encountered during the upgrade process, add `-f` to upgrade and rebuild all ports:ÙZå¦‚æœåœ¨å‡çº§è¿‡ç¨‹ä¸­é‡åˆ°é”™è¯¯ï¼Œè¯·åœ¨å‡çº§å’Œé‡å»ºæ‰€æœ‰ ports æ—¶æ·»åŠ  `-f`ã€‚ÙØPortmaster can also be used to install new ports on the system, upgrading all dependencies before building and installing the new port.  To use this function, specify the location of the port in the Ports Collection:Ù¾Portmaster è¿˜å¯ä»¥ç”¨äºåœ¨ç³»ç»Ÿä¸Šå®‰è£…æ–°çš„ portsï¼Œåœ¨æ„å»ºå’Œå®‰è£…æ–°çš„ ports ä¹‹å‰å‡çº§æ‰€æœ‰ä¾èµ–é¡¹ã€‚è¦ä½¿ç”¨æ­¤åŠŸèƒ½ï¼Œè¯·æŒ‡å®š Ports Collection ä¸­ ports çš„ä½ç½®ï¼šÙWMore information about package:ports-mgmt/portmaster[] may be found in its `pkg-descr`.Ù[æœ‰å…³ package:ports-mgmt/portmaster[] çš„æ›´å¤šä¿¡æ¯å¯ä»¥åœ¨å…¶ `pkg-descr` ä¸­æ‰¾åˆ°ã€‚Ù!Upgrading Ports Using PortupgradeÙ ä½¿ç”¨ Portupgrade å‡çº§ ports ÙØpackage:ports-mgmt/portupgrade[] is another utility that can be used to upgrade ports.  It installs a suite of applications which can be used to manage ports.  However, it is dependent upon Ruby. To install the port:ÙÇpackage:ports-mgmt/portupgrade[] æ˜¯å¦ä¸€ä¸ªå¯ä»¥ç”¨æ¥å‡çº§ ports çš„å®ç”¨å·¥å…·ã€‚å®ƒå®‰è£…äº†ä¸€å¥—å¯ä»¥ç”¨æ¥ç®¡ç† ports çš„åº”ç”¨ç¨‹åºã€‚ç„¶è€Œï¼Œå®ƒä¾èµ–äº Rubyã€‚è¦å®‰è£…è¯¥ portsï¼šÙ¦Before performing an upgrade using this utility, it is recommended to scan the list of installed ports using `pkgdb -F` and to fix all the inconsistencies it reports.Ù‹åœ¨ä½¿ç”¨æ­¤å·¥å…·è¿›è¡Œå‡çº§ä¹‹å‰ï¼Œå»ºè®®ä½¿ç”¨ `pkgdb -F` æ‰«æå·²å®‰è£…çš„ ports åˆ—è¡¨ï¼Œå¹¶ä¿®å¤å®ƒæŠ¥å‘Šçš„æ‰€æœ‰ä¸ä¸€è‡´æ€§ã€‚Ù¥To upgrade all the outdated ports installed on the system, use `portupgrade -a`.  Alternately, include `-i` to be asked for confirmation of every individual upgrade:Ùè¦å‡çº§ç³»ç»Ÿä¸Šå®‰è£…çš„æ‰€æœ‰è¿‡æ—¶ portsï¼Œè¯·ä½¿ç”¨ `portupgrade -a`ã€‚æˆ–è€…ï¼ŒåŠ å…¥ `-i` ä»¥ä¾¿åœ¨æ¯æ¬¡å•ç‹¬å‡çº§æ—¶è¦æ±‚ç¡®è®¤ï¼šÙÌTo upgrade only a specified application instead of all available ports, use `portupgrade _pkgname_`.  It is very important to include `-R` to first upgrade all the ports required by the given application:ÙÃè¦å‡çº§æŒ‡å®šçš„åº”ç”¨ç¨‹åºè€Œä¸æ˜¯æ‰€æœ‰å¯ç”¨çš„ portsï¼Œè¯·ä½¿ç”¨ `portupgrade _pkgname_`ã€‚éå¸¸é‡è¦çš„æ˜¯è¦åŒ…æ‹¬ `-R` é€‰é¡¹ï¼Œä»¥å…ˆå‡çº§ç»™å®šåº”ç”¨ç¨‹åºæ‰€éœ€çš„æ‰€æœ‰ portsï¼šÚ•If `-P` is included, Portupgrade searches for available packages in the local directories listed in `PKG_PATH`.  If none are available locally, it then fetches packages from a remote site.  If packages can not be found locally or fetched remotely, Portupgrade will use ports.  To avoid using ports entirely, specify `-PP`.  This last set of options tells Portupgrade to abort if no packages are available:Úå¦‚æœåŒ…å«äº† `-P` é€‰é¡¹ï¼ŒPortupgrade ä¼šåœ¨ `PKG_PATH` åˆ—å‡ºçš„æœ¬åœ°ç›®å½•ä¸­æœç´¢å¯ç”¨çš„è½¯ä»¶åŒ…ã€‚å¦‚æœæœ¬åœ°æ²¡æœ‰å¯ç”¨çš„è½¯ä»¶åŒ…ï¼Œå®ƒä¼šä»è¿œç¨‹ç«™ç‚¹è·å–è½¯ä»¶åŒ…ã€‚å¦‚æœæ— æ³•åœ¨æœ¬åœ°æˆ–è¿œç¨‹è·å–è½¯ä»¶åŒ…ï¼ŒPortupgrade å°†ä½¿ç”¨ portsã€‚ä¸ºäº†å®Œå…¨é¿å…ä½¿ç”¨ portsï¼Œå¯ä»¥æŒ‡å®š `-PP` é€‰é¡¹ã€‚æœ€åä¸€ç»„é€‰é¡¹å‘Šè¯‰ Portupgrade å¦‚æœæ²¡æœ‰å¯ç”¨çš„è½¯ä»¶åŒ…åˆ™ä¸­æ­¢æ“ä½œã€‚ÙŞTo just fetch the port distfiles, or packages, if `-P` is specified, without building or installing anything, use `-F`.  For further information on all of the available switches, refer to the manual page for `portupgrade`.ÙĞå¦‚æœæŒ‡å®šäº† `-P`ï¼Œåªéœ€è·å– ports  distfiles æˆ–è½¯ä»¶åŒ…ï¼Œè€Œä¸éœ€è¦æ„å»ºæˆ–å®‰è£…ä»»ä½•å†…å®¹ï¼Œè¯·ä½¿ç”¨ `-F ã€‚æœ‰å…³æ‰€æœ‰å¯ç”¨å¼€å…³çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜… `portupgrade` çš„æ‰‹å†Œé¡µã€‚ÙXMore information about package:ports-mgmt/portupgrade[] may be found in its `pkg-descr`.Ù\æœ‰å…³ package:ports-mgmt/portupgrade[] çš„æ›´å¤šä¿¡æ¯å¯ä»¥åœ¨å…¶ `pkg-descr` ä¸­æ‰¾åˆ°ã€‚´Ports and Disk Spaceµports å’Œç£ç›˜ç©ºé—´Ú³Using the Ports Collection will use up disk space over time.  After building and installing a port, running `make clean` within the ports skeleton will clean up the temporary `work` directory.  If Portmaster is used to install a port, it will automatically remove this directory unless `-K` is specified.  If Portupgrade is installed, this command will remove all `work` directories found within the local copy of the Ports Collection:Úˆä½¿ç”¨ Ports Collection ä¼šéšç€æ—¶é—´çš„æ¨ç§»å ç”¨ç£ç›˜ç©ºé—´ã€‚åœ¨æ„å»ºå’Œå®‰è£… ports ä¹‹åï¼Œåœ¨ ports éª¨æ¶ä¸­è¿è¡Œ `make clean` å°†æ¸…ç†ä¸´æ—¶çš„ `work` ç›®å½•ã€‚å¦‚æœä½¿ç”¨ Portmaster å®‰è£… portsï¼Œå®ƒä¼šè‡ªåŠ¨åˆ é™¤æ­¤ç›®å½•ï¼Œé™¤éæŒ‡å®šäº† `-K` é€‰é¡¹ã€‚å¦‚æœå®‰è£…äº† Portupgradeï¼Œæ­¤å‘½ä»¤å°†åˆ é™¤åœ¨æœ¬åœ° Ports Collection å‰¯æœ¬ä¸­æ‰¾åˆ°çš„æ‰€æœ‰ `work` ç›®å½•ï¼šÙ»In addition, outdated source distribution files accumulate in `/usr/ports/distfiles` over time.  To use Portupgrade to delete all the distfiles that are no longer referenced by any ports:Ù¹æ­¤å¤–ï¼Œéšç€æ—¶é—´çš„æ¨ç§»ï¼Œè¿‡æ—¶çš„æºä»£ç åˆ†å‘æ–‡ä»¶ä¼šåœ¨ `/usr/ports/distfiles` ä¸­ç´¯ç§¯ã€‚è¦ä½¿ç”¨ Portupgrade åˆ é™¤æ‰€æœ‰ä¸å†è¢«ä»»ä½• ports å¼•ç”¨çš„åˆ†å‘æ–‡ä»¶ï¼šÙbPortupgrade can remove all distfiles not referenced by any port currently installed on the system:Ù`Portupgrade å¯ä»¥åˆ é™¤ç³»ç»Ÿä¸Šå½“å‰æœªå®‰è£…ä»»ä½• ports å¼•ç”¨çš„æ‰€æœ‰ distfiles æ–‡ä»¶ã€‚Ù If Portmaster is installed, use:Ù)å¦‚æœå·²å®‰è£… Portmasterï¼Œè¯·ä½¿ç”¨ï¼šÙhBy default, this command is interactive and prompts the user to confirm if a distfile should be deleted.ÙZé»˜è®¤æƒ…å†µä¸‹ï¼Œè¯¥å‘½ä»¤æ˜¯äº¤äº’å¼çš„ï¼Œå¹¶æç¤ºç”¨æˆ·ç¡®è®¤æ˜¯å¦åˆ é™¤ distfileã€‚Ù‹In addition to these commands, package:ports-mgmt/pkg_cutleaves[] automates the task of removing installed ports that are no longer needed.Ùé™¤äº†è¿™äº›å‘½ä»¤ä¹‹å¤–ï¼Œpackage:ports-mgmt/pkg_cutleaves[] è¿˜å¯ä»¥è‡ªåŠ¨åŒ–åˆ é™¤ä¸å†éœ€è¦çš„å·²å®‰è£… ports çš„ä»»åŠ¡ã€‚Ù Building Packages with poudriereÙ ä½¿ç”¨ poudriere æ„å»ºè½¯ä»¶åŒ…Úûpoudriere is a `BSD`-licensed utility for creating and testing FreeBSD packages.  It uses FreeBSD jails to set up isolated compilation environments.  These jails can be used to build packages for versions of FreeBSD that are different from the system on which it is installed, and also to build packages for i386 if the host is an amd64 system.  Once the packages are built, they are in a layout identical to the official mirrors.  These packages are usable by man:pkg[8] and other package management tools.ÚÜpoudriere æ˜¯ä¸€ä¸ªä½¿ç”¨ BSD è®¸å¯è¯çš„å®ç”¨å·¥å…·ï¼Œç”¨äºåˆ›å»ºå’Œæµ‹è¯• FreeBSD è½¯ä»¶åŒ…ã€‚å®ƒä½¿ç”¨ FreeBSD jails æ¥è®¾ç½®éš”ç¦»çš„ç¼–è¯‘ç¯å¢ƒã€‚è¿™äº› jails å¯ä»¥ç”¨äºä¸ºä¸å®‰è£…å®ƒçš„ç³»ç»Ÿä¸åŒçš„ FreeBSD ç‰ˆæœ¬æ„å»ºè½¯ä»¶åŒ…ï¼Œä¹Ÿå¯ä»¥ç”¨äºåœ¨ä¸»æœºæ˜¯ amd64 ç³»ç»Ÿçš„æƒ…å†µä¸‹æ„å»º i386 çš„è½¯ä»¶åŒ…ã€‚ä¸€æ—¦è½¯ä»¶åŒ…æ„å»ºå®Œæˆï¼Œå®ƒä»¬çš„å¸ƒå±€ä¸å®˜æ–¹é•œåƒå®Œå…¨ç›¸åŒã€‚è¿™äº›è½¯ä»¶åŒ…å¯ä»¥è¢« man:pkg[8] å’Œå…¶ä»–è½¯ä»¶åŒ…ç®¡ç†å·¥å…·ä½¿ç”¨ã€‚Úpoudriere is installed using the package:ports-mgmt/poudriere[] package or port.  The installation includes a sample configuration file `/usr/local/etc/poudriere.conf.sample`.  Copy this file to `/usr/local/etc/poudriere.conf`.  Edit the copied file to suit the local configuration.Úpoudriere æ˜¯ä½¿ç”¨ package:ports-mgmt/poudriere[] åŒ…æˆ– ports è¿›è¡Œå®‰è£…çš„ã€‚å®‰è£…è¿‡ç¨‹ä¸­åŒ…å«ä¸€ä¸ªç¤ºä¾‹é…ç½®æ–‡ä»¶ `/usr/local/etc/poudriere.conf.sample`ã€‚å°†æ­¤æ–‡ä»¶å¤åˆ¶åˆ° `/usr/local/etc/poudriere.conf`ã€‚ç¼–è¾‘å¤åˆ¶çš„æ–‡ä»¶ä»¥é€‚åº”æœ¬åœ°é…ç½®ã€‚ÚøWhile `ZFS` is not required on the system running poudriere, it is beneficial.  When `ZFS` is used, `ZPOOL` must be specified in `/usr/local/etc/poudriere.conf` and `FREEBSD_HOST` should be set to a nearby mirror.  Defining `CCACHE_DIR` enables the use of package:devel/ccache[] to cache compilation and reduce build times for frequently-compiled code.  It may be convenient to put poudriere datasets in an isolated tree mounted at `/poudriere`.  Defaults for the other configuration values are adequate.ÚÊè™½ç„¶åœ¨è¿è¡Œ poudriere çš„ç³»ç»Ÿä¸Šä¸éœ€è¦ `ZFS`ï¼Œä½†å®ƒæ˜¯æœ‰ç›Šçš„ã€‚å½“ä½¿ç”¨ `ZFS` æ—¶ï¼Œå¿…é¡»åœ¨ `/usr/local/etc/poudriere.conf` ä¸­æŒ‡å®š `ZPOOL`ï¼Œå¹¶å°† `FREEBSD_HOST` è®¾ç½®ä¸ºé™„è¿‘çš„é•œåƒã€‚å®šä¹‰ `CCACHE_DIR` å¯ä»¥å¯ç”¨ `package:devel/ccache[]` æ¥ç¼“å­˜ç¼–è¯‘å¹¶å‡å°‘é¢‘ç¹ç¼–è¯‘ä»£ç çš„æ„å»ºæ—¶é—´ã€‚å°† poudriere æ•°æ®é›†æ”¾åœ¨æŒ‚è½½åœ¨ `/poudriere` çš„éš”ç¦»æ ‘ä¸­å¯èƒ½å¾ˆæ–¹ä¾¿ã€‚å…¶ä»–é…ç½®å€¼çš„é»˜è®¤è®¾ç½®æ˜¯è¶³å¤Ÿçš„ã€‚ÚThe number of processor cores detected is used to define how many builds will run in parallel.  Supply enough virtual memory, either with `RAM` or swap space.  If virtual memory runs out, the compilation jails will stop and be torn down, resulting in weird error messages.Ùòæ£€æµ‹åˆ°çš„å¤„ç†å™¨æ ¸å¿ƒæ•°é‡ç”¨äºå®šä¹‰å¹¶è¡Œè¿è¡Œçš„æ„å»ºæ•°é‡ã€‚è¯·æä¾›è¶³å¤Ÿçš„è™šæ‹Ÿå†…å­˜ï¼Œå¯ä»¥æ˜¯ RAM æˆ–è€…äº¤æ¢ç©ºé—´ã€‚å¦‚æœè™šæ‹Ÿå†…å­˜è€—å°½ï¼Œç¼–è¯‘ç¯å¢ƒå°†åœæ­¢å¹¶è¢«é”€æ¯ï¼Œå¯¼è‡´å‡ºç°å¥‡æ€ªçš„é”™è¯¯ä¿¡æ¯ã€‚¿Initialize Jails and Port Trees¾åˆå§‹åŒ– Jails å’Œ Port TreesÚYAfter configuration, initialize poudriere so that it installs a jail with the required FreeBSD tree and a ports tree.  Specify a name for the jail using `-j` and the FreeBSD version with `-v`.  On systems running FreeBSD/amd64, the architecture can be set with `-a` to either `i386` or `amd64`.  The default is the architecture shown by `uname`.Ú@é…ç½®å®Œæˆåï¼Œåˆå§‹åŒ– poudriereï¼Œä»¥ä¾¿å®‰è£…ä¸€ä¸ªåŒ…å«æ‰€éœ€ FreeBSD æ ‘å’Œ ports æ ‘çš„ jailã€‚ä½¿ç”¨ `-j` æŒ‡å®š jail çš„åç§°ï¼Œå¹¶ä½¿ç”¨ `-v` æŒ‡å®š FreeBSD ç‰ˆæœ¬ã€‚åœ¨è¿è¡Œ FreeBSD/amd64 çš„ç³»ç»Ÿä¸Šï¼Œå¯ä»¥ä½¿ç”¨ `-a` å°†æ¶æ„è®¾ç½®ä¸º `i386` æˆ– `amd64`ã€‚é»˜è®¤æ¶æ„ä¸º `uname` æ˜¾ç¤ºçš„æ¶æ„ã€‚ÚZOn a single computer, poudriere can build ports with multiple configurations, in multiple jails, and from different port trees.  Custom configurations for these combinations are called _sets_.  See the CUSTOMIZATION section of man:poudriere[8] for details after package:ports-mgmt/poudriere[] or package:ports-mgmt/poudriere-devel[] is installed.ÚSåœ¨ä¸€å°è®¡ç®—æœºä¸Šï¼Œpoudriere å¯ä»¥ä½¿ç”¨å¤šä¸ªé…ç½®ï¼Œåœ¨å¤šä¸ª jail ä¸­ï¼Œä»ä¸åŒçš„ ports æ ‘æ„å»º portsã€‚è¿™äº›ç»„åˆçš„è‡ªå®šä¹‰é…ç½®è¢«ç§°ä¸º _é›†åˆ_ã€‚åœ¨å®‰è£…äº† package:ports-mgmt/poudriere[] æˆ– package:ports-mgmt/poudriere-devel[] ä¹‹åï¼Œå¯ä»¥æŸ¥çœ‹ man:poudriere[8] çš„ CUSTOMIZATION éƒ¨åˆ†è·å–è¯¦ç»†ä¿¡æ¯ã€‚ÚxThe basic configuration shown here puts a single jail-, port-, and set-specific `make.conf` in `/usr/local/etc/poudriere.d`.  The filename in this example is created by combining the jail name, port name, and set name: `13amd64-local-workstation-make.conf`.  The system `make.conf` and this new file are combined at build time to create the `make.conf` used by the build jail.ÚŠè¿™é‡Œæ˜¾ç¤ºçš„åŸºæœ¬é…ç½®å°†ä¸€ä¸ªå•ç‹¬çš„ jailã€ port å’Œ set ç‰¹å®šçš„ `make.conf` æ”¾ç½®åœ¨ `/usr/local/etc/poudriere.d` ç›®å½•ä¸‹ã€‚åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæ–‡ä»¶åæ˜¯é€šè¿‡ç»„åˆ jail åç§°ã€ port åç§°å’Œ set åç§°åˆ›å»ºçš„ï¼š`13amd64-local-workstation-make.conf`ã€‚ç³»ç»Ÿçš„ `make.conf` å’Œè¿™ä¸ªæ–°æ–‡ä»¶åœ¨æ„å»ºæ—¶ä¼šåˆå¹¶ï¼Œä»¥åˆ›å»ºæ„å»º jail ä½¿ç”¨çš„ `make.conf` æ–‡ä»¶ã€‚Ù›Packages to be built are entered in `13amd64-local-workstation-pkglist` (ports with extref:{porters-handbook}flavors[FLAVORS] can be defined with @FLAVOR):Ù®è¦æ„å»ºçš„è½¯ä»¶åŒ…åº”è¯¥åœ¨ `13amd64-local-workstation-pkglist` æ–‡ä»¶ä¸­è¾“å…¥ï¼ˆå…·æœ‰ @FLAVOR çš„ extref:{porters-handbook}flavors[FLAVORS] çš„ ports å¯ä»¥å®šä¹‰ï¼‰ã€‚Ù@Options and dependencies for the specified ports are configured:Ù.å·²é…ç½®æŒ‡å®š ports çš„é€‰é¡¹å’Œä¾èµ–é¡¹ï¼šÙ@Finally, packages are built and a package repository is created:Ù3æœ€åï¼Œæ„å»ºè½¯ä»¶åŒ…å¹¶åˆ›å»ºè½¯ä»¶åŒ…ä»“åº“ï¼šÙÎWhile running, pressing kbd:[Ctrl+t] displays the current state of the build.  poudriere also builds files in `/poudriere/logs/bulk/jailname` that can be used with a web server to display build information.Ù×åœ¨è¿è¡Œè¿‡ç¨‹ä¸­ï¼ŒæŒ‰ä¸‹ kbd:[Ctrl+t] é”®å¯ä»¥æ˜¾ç¤ºæ„å»ºçš„å½“å‰çŠ¶æ€ã€‚poudriere è¿˜ä¼šåœ¨ `/poudriere/logs/bulk/jailname` ç›®å½•ä¸­æ„å»ºæ–‡ä»¶ï¼Œå¯ä»¥ä¸ Web æœåŠ¡å™¨ä¸€èµ·ä½¿ç”¨ä»¥æ˜¾ç¤ºæ„å»ºä¿¡æ¯ã€‚ÙdAfter completion, the new packages are now available for installation from the poudriere repository.ÙJå®Œæˆåï¼Œæ–°çš„è½¯ä»¶åŒ…ç°åœ¨å¯ä»¥ä» poudriere ä»“åº“è¿›è¡Œå®‰è£…ã€‚ÙFor more information on using poudriere, see man:poudriere[8] and the main web site, https://github.com/freebsd/poudriere/wiki[].Ù‚æœ‰å…³ä½¿ç”¨ poudriere çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜… man:poudriere[8] å’Œä¸»è¦ç½‘ç«™ https://github.com/freebsd/poudriere/wiki[]ã€‚Ù5Configuring pkg Clients to Use a poudriere RepositoryÙ.é…ç½® pkg å®¢æˆ·ç«¯ä»¥ä½¿ç”¨ poudriere ä»“åº“ÚOWhile it is possible to use both a custom repository along side of the official repository, sometimes it is useful to disable the official repository.  This is done by creating a configuration file that overrides and disables the official configuration file.  Create `/usr/local/etc/pkg/repos/FreeBSD.conf` that contains the following:Úè™½ç„¶å¯ä»¥åŒæ—¶ä½¿ç”¨è‡ªå®šä¹‰ä»“åº“å’Œå®˜æ–¹ä»“åº“ï¼Œä½†æœ‰æ—¶ç¦ç”¨å®˜æ–¹ä»“åº“æ˜¯æœ‰ç”¨çš„ã€‚è¿™å¯ä»¥é€šè¿‡åˆ›å»ºä¸€ä¸ªé…ç½®æ–‡ä»¶æ¥è¦†ç›–å’Œç¦ç”¨å®˜æ–¹é…ç½®æ–‡ä»¶æ¥å®ç°ã€‚åˆ›å»º `/usr/local/etc/pkg/repos/FreeBSD.conf` æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«ä»¥ä¸‹å†…å®¹ï¼šÙóUsually it is easiest to serve a poudriere repository to the client machines via HTTP.  Set up a webserver to serve up the package directory, for instance: `/usr/local/poudriere/data/packages/13amd64`, where `13amd64` is the name of the build.ÙŞé€šå¸¸ï¼Œé€šè¿‡ HTTP å°† poudriere ä»“åº“æä¾›ç»™å®¢æˆ·æœºæœ€ä¸ºç®€å•ã€‚è®¾ç½®ä¸€ä¸ª web æœåŠ¡å™¨æ¥æä¾›è½¯ä»¶åŒ…ç›®å½•ï¼Œä¾‹å¦‚ï¼š `/usr/local/poudriere/data/packages/13amd64`ï¼Œå…¶ä¸­ `13amd64` æ˜¯æ„å»ºçš„åç§°ã€‚Ù¬If the URL to the package repository is: `http://pkg.example.com/13amd64`, then the repository configuration file in `/usr/local/etc/pkg/repos/custom.conf` would look like:Ù¡å¦‚æœè½¯ä»¶åŒ…ä»“åº“çš„ URL æ˜¯ï¼š`http://pkg.example.com/13amd64`ï¼Œé‚£ä¹ˆä½äº `/usr/local/etc/pkg/repos/custom.conf` çš„ä»“åº“é…ç½®æ–‡ä»¶å°†å¦‚ä¸‹æ‰€ç¤ºï¼šÙŠIf exposing the package repository to the internet is not desired, the `file://` protocol can be used to point to the repository directly:Ùkå¦‚æœä¸å¸Œæœ›å°†è½¯ä»¶åŒ…ä»“åº“æš´éœ²åœ¨äº’è”ç½‘ä¸Šï¼Œå¯ä»¥ä½¿ç”¨ `file://` åè®®ç›´æ¥æŒ‡å‘ä»“åº“ï¼šÙ Post-Installation Considerations¸å®‰è£…åçš„è€ƒè™‘äº‹é¡¹ÚRegardless of whether the software was installed from a binary package or port, most third-party applications require some level of configuration after installation.  The following commands and locations can be used to help determine what was installed with the application.ÙĞæ— è®ºè½¯ä»¶æ˜¯ä»äºŒè¿›åˆ¶åŒ…è¿˜æ˜¯ ports å®‰è£…çš„ï¼Œå¤§å¤šæ•°ç¬¬ä¸‰æ–¹åº”ç”¨ç¨‹åºåœ¨å®‰è£…åéƒ½éœ€è¦è¿›è¡Œä¸€å®šç¨‹åº¦çš„é…ç½®ã€‚ä»¥ä¸‹å‘½ä»¤å’Œä½ç½®å¯ç”¨äºå¸®åŠ©ç¡®å®šåº”ç”¨ç¨‹åºå®‰è£…äº†ä»€ä¹ˆã€‚ÚÈMost applications install at least one default configuration file in `/usr/local/etc`. In cases where an application has a large number of configuration files, a subdirectory will be created to hold them. Often, sample configuration files are installed which end with a suffix such as `.sample`. The configuration files should be reviewed and possibly edited to meet the system's needs. To edit a sample file, first copy it without the `.sample` extension.Ú™å¤§å¤šæ•°åº”ç”¨ç¨‹åºéƒ½ä¼šåœ¨ `/usr/local/etc` ç›®å½•ä¸‹å®‰è£…è‡³å°‘ä¸€ä¸ªé»˜è®¤é…ç½®æ–‡ä»¶ã€‚åœ¨åº”ç”¨ç¨‹åºæœ‰å¤§é‡é…ç½®æ–‡ä»¶çš„æƒ…å†µä¸‹ï¼Œä¼šåˆ›å»ºä¸€ä¸ªå­ç›®å½•æ¥å­˜æ”¾å®ƒä»¬ã€‚é€šå¸¸ï¼Œä¼šå®‰è£…ä¸€äº›ä»¥ `.sample` åç¼€ç»“å°¾çš„ç¤ºä¾‹é…ç½®æ–‡ä»¶ã€‚åº”è¯¥å®¡æŸ¥å¹¶å¯èƒ½ç¼–è¾‘è¿™äº›é…ç½®æ–‡ä»¶ä»¥æ»¡è¶³ç³»ç»Ÿçš„éœ€æ±‚ã€‚è¦ç¼–è¾‘ç¤ºä¾‹æ–‡ä»¶ï¼Œé¦–å…ˆå°†å…¶å¤åˆ¶å¹¶å»æ‰ `.sample` æ‰©å±•åã€‚Ù¿Applications which provide documentation will install it into `/usr/local/share/doc` and many applications also install manual pages. This documentation should be consulted before continuing.Ù®æä¾›æ–‡æ¡£çš„åº”ç”¨ç¨‹åºä¼šå°†æ–‡æ¡£å®‰è£…åˆ° `/usr/local/share/doc` ç›®å½•ä¸‹ï¼Œè®¸å¤šåº”ç”¨ç¨‹åºè¿˜ä¼šå®‰è£…æ‰‹å†Œé¡µã€‚åœ¨ç»§ç»­ä¹‹å‰ï¼Œåº”è¯¥å…ˆæŸ¥é˜…è¿™äº›æ–‡æ¡£ã€‚ÚSome applications run services which must be added to `/etc/rc.conf` before starting the application. These applications usually install a startup script in `/usr/local/etc/rc.d`. See crossref:config[configtuning-starting-services,Starting Services] for more information.Úä¸€äº›åº”ç”¨ç¨‹åºè¿è¡Œçš„æœåŠ¡åœ¨å¯åŠ¨åº”ç”¨ç¨‹åºä¹‹å‰å¿…é¡»æ·»åŠ åˆ° `/etc/rc.conf` ä¸­ã€‚è¿™äº›åº”ç”¨ç¨‹åºé€šå¸¸ä¼šåœ¨ `/usr/local/etc/rc.d` ä¸­å®‰è£…ä¸€ä¸ªå¯åŠ¨è„šæœ¬ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜… crossref:config[configtuning-starting-services,å¯åŠ¨æœåŠ¡]ã€‚ÙËBy design, applications do not run their startup script upon installation, nor do they run their stop script upon deinstallation or upgrade.  This decision is left to the individual system administrator.Ù«æ ¹æ®è®¾è®¡ï¼Œåº”ç”¨ç¨‹åºåœ¨å®‰è£…æ—¶ä¸ä¼šè¿è¡Œå¯åŠ¨è„šæœ¬ï¼Œä¹Ÿä¸ä¼šåœ¨å¸è½½æˆ–å‡çº§æ—¶è¿è¡Œåœæ­¢è„šæœ¬ã€‚è¿™ä¸ªå†³å®šç•™ç»™äº†ä¸ªåˆ«ç³»ç»Ÿç®¡ç†å‘˜æ¥å†³å®šã€‚Ù^Users of man:csh[1] should run `rehash` to rebuild the known binary list in the shells `PATH`.Ù|ä½¿ç”¨ man:csh[1] çš„ç”¨æˆ·åº”è¯¥è¿è¡Œ `rehash` å‘½ä»¤æ¥é‡æ–°æ„å»º shell çš„ `PATH` ä¸­å·²çŸ¥çš„äºŒè¿›åˆ¶æ–‡ä»¶åˆ—è¡¨ã€‚ÙeUse `pkg info` to determine which files, man pages, and binaries were installed with the application.Ùdä½¿ç”¨ `pkg info` å‘½ä»¤æ¥ç¡®å®šåº”ç”¨ç¨‹åºå®‰è£…äº†å“ªäº›æ–‡ä»¶ã€man é¡µé¢å’ŒäºŒè¿›åˆ¶æ–‡ä»¶ã€‚¹Dealing with Broken Portsµå¤„ç†æŸåçš„ portsÙ9When a port does not build or install, try the following:Ù=å½“ ports æ— æ³•æ„å»ºæˆ–å®‰è£…æ—¶ï¼Œè¯·å°è¯•ä»¥ä¸‹æ“ä½œï¼šÙ³Search to see if there is a fix pending for the port in the link:https://www.FreeBSD.org/support/[Problem Report database]. If so, implementing the proposed fix may fix the issue.ÙÂæœç´¢ä¸€ä¸‹ link:https://www.FreeBSD.org/support/[Problem Report database] ä¸­çš„ ports æ˜¯å¦æœ‰å¾…ä¿®å¤çš„é—®é¢˜æŠ¥å‘Šã€‚å¦‚æœæœ‰çš„è¯ï¼Œå®æ–½å»ºè®®çš„ä¿®å¤å¯èƒ½ä¼šè§£å†³è¿™ä¸ªé—®é¢˜ã€‚ÙòAsk the maintainer of the port for help. Type `make maintainer` in the ports skeleton or read the port's `Makefile` to find the maintainer's email address. Remember to include the output leading up to the error in the email to the maintainer.Ùêå‘ ports çš„ç»´æŠ¤è€…å¯»æ±‚å¸®åŠ©ã€‚åœ¨ ports éª¨æ¶ä¸­é”®å…¥ `make maintainer`ï¼Œæˆ–è€…é˜…è¯» ports çš„ `Makefile` ä»¥æ‰¾åˆ°ç»´æŠ¤è€…çš„ç”µå­é‚®ä»¶åœ°å€ã€‚è®°å¾—åœ¨å‘é€ç»™ç»´æŠ¤è€…çš„ç”µå­é‚®ä»¶ä¸­åŒ…å«é”™è¯¯ä¹‹å‰çš„è¾“å‡ºã€‚Ú4Some ports are not maintained by an individual but instead by a group maintainer represented by a extref:{mailing-list-faq}[mailing list].  Many, but not all, of these addresses look like mailto:freebsd-listname@FreeBSD.org[freebsd-listname@FreeBSD.org].  Please take this into account when sending an email.Úä¸€äº› ports ä¸æ˜¯ç”±ä¸ªäººç»´æŠ¤ï¼Œè€Œæ˜¯ç”±ä¸€ä¸ªç”±é‚®ä»¶åˆ—è¡¨è¡¨ç¤ºçš„å›¢é˜Ÿç»´æŠ¤è€…ç»´æŠ¤ã€‚å…¶ä¸­è®¸å¤šï¼ˆä½†ä¸æ˜¯å…¨éƒ¨ï¼‰åœ°å€çœ‹èµ·æ¥åƒ mailto:freebsd-listname@FreeBSD.org[freebsd-listname@FreeBSD.org]ã€‚åœ¨å‘é€ç”µå­é‚®ä»¶æ—¶ï¼Œè¯·è€ƒè™‘è¿™ä¸€ç‚¹ã€‚ÚIn particular, ports maintained by mailto:ports@FreeBSD.org[ports@FreeBSD.org] are not maintained by a specific individual.  Instead, any fixes and support come from the general community who subscribe to that mailing list. More volunteers are always needed!ÙÜç‰¹åˆ«æ˜¯ï¼Œç”± mailto:ports@FreeBSD.org[ports@FreeBSD.org] ç»´æŠ¤çš„ ports ä¸ç”±ç‰¹å®šä¸ªäººç»´æŠ¤ã€‚ç›¸åï¼Œä»»ä½•ä¿®å¤å’Œæ”¯æŒéƒ½æ¥è‡ªè®¢é˜…è¯¥é‚®ä»¶åˆ—è¡¨çš„å¹¿å¤§ç¤¾åŒºã€‚æˆ‘ä»¬å§‹ç»ˆéœ€è¦æ›´å¤šçš„å¿—æ„¿è€…ï¼ÙIf there is no response to the email, use Bugzilla to submit a bug report using the instructions in extref:{problem-reports}[Writing FreeBSD Problem Reports].Ùµå¦‚æœæ²¡æœ‰æ”¶åˆ°é‚®ä»¶å›å¤ï¼Œè¯·æŒ‰ç…§ extref:{problem-reports}[Writing FreeBSD Problem Reports,ç¼–å†™ FreeBSD é—®é¢˜æŠ¥å‘Š] ä¸­çš„è¯´æ˜ï¼Œä½¿ç”¨ Bugzilla æäº¤é”™è¯¯æŠ¥å‘Šã€‚ÙºFix it! The extref:{porters-handbook}[Porter's Handbook] includes detailed information on the ports infrastructure so that you can fix the occasional broken port or even submit your own!ÙÂä¿®å¤å®ƒï¼ extref:{porters-handbook}[Porter's Handbook] åŒ…å«äº†æœ‰å…³ ports åŸºç¡€è®¾æ–½çš„è¯¦ç»†ä¿¡æ¯ï¼Œä»¥ä¾¿æ‚¨å¯ä»¥ä¿®å¤å¶å°”å‡ºç°çš„æŸå portsï¼Œç”šè‡³æäº¤æ‚¨è‡ªå·±çš„ portsï¼ÙRInstall the package instead of the port using the instructions in <<pkgng-intro>>.ÙMæŒ‰ç…§ <<pkgng-intro>> ä¸­çš„è¯´æ˜å®‰è£…è½¯ä»¶åŒ…ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ portsã€‚¹FreeBSD Handbook Colophon´FreeBSD æ‰‹å†Œåè®°¨Colophon¦åè®°Ù…This book is the combined work of hundreds of contributors to "The FreeBSD Documentation Project".  The text is authored in AsciiDoc.Ùxè¿™æœ¬ä¹¦æ˜¯ç”±ã€ŠFreeBSD æ–‡æ¡£é¡¹ç›®ã€‹çš„æ•°ç™¾åè´¡çŒ®è€…å…±åŒå®Œæˆçš„ã€‚è¯¥æ–‡æœ¬ä½¿ç”¨ AsciiDoc æ ¼å¼ç¼–å†™ã€‚ÙƒThis chapter describes how to install and configure Wayland and compositors on FreeBSD, which provides a graphical user environmentÙiæœ¬ç« ä»‹ç»äº†å¦‚ä½•åœ¨ FreeBSD ä¸Šå®‰è£…å’Œé…ç½® Wayland å’Œåˆæˆå™¨ï¼Œä»¥æä¾›å›¾å½¢ç”¨æˆ·ç¯å¢ƒã€‚²Chapter 6. Wayland±ç¬¬ 6 ç«  Wayland²Wayland on FreeBSDºåœ¨ FreeBSD ä¸Šçš„ Wayland°Wayland Synopsis®Wayland æ¦‚è¿°ÚİWayland is a new display server, but it differs from Xorg in several important ways.  First, Wayland is only a protocol that acts as an intermediary between clients using a different mechanism which removes the dependency on an X server.  Xorg includes both the X11 protocol, used to run remote displays and the X server will accept connections and display windows.  Under Wayland, the compositor or window manager provides the display server instead of a traditional X server.Ú¯Wayland æ˜¯ä¸€ä¸ªæ–°çš„æ˜¾ç¤ºæœåŠ¡å™¨ï¼Œä½†å®ƒä¸ Xorg åœ¨å‡ ä¸ªé‡è¦æ–¹é¢æœ‰æ‰€ä¸åŒã€‚é¦–å…ˆï¼ŒWayland åªæ˜¯ä¸€ä¸ªåè®®ï¼Œå……å½“å®¢æˆ·ç«¯ä¹‹é—´çš„ä¸­ä»‹ï¼Œä½¿ç”¨ä¸åŒçš„æœºåˆ¶æ¥æ¶ˆé™¤å¯¹ X æœåŠ¡å™¨çš„ä¾èµ–ã€‚Xorg æ—¢åŒ…æ‹¬ç”¨äºè¿è¡Œè¿œç¨‹æ˜¾ç¤ºçš„ X11 åè®®ï¼Œä¹ŸåŒ…æ‹¬ X æœåŠ¡å™¨å°†æ¥å—è¿æ¥å’Œæ˜¾ç¤ºçª—å£ã€‚åœ¨ Wayland ä¸‹ï¼Œåˆæˆå™¨æˆ–çª—å£ç®¡ç†å™¨æä¾›æ˜¾ç¤ºæœåŠ¡å™¨ï¼Œè€Œä¸æ˜¯ä¼ ç»Ÿçš„ X æœåŠ¡å™¨ã€‚Ú2Since Wayland is not an X server, traditional X screen connections will need to utilize other methods such as VNC or RDP for remote desktop management.  Second, Wayland can manage composite communications between clients and a compositor as a separate entity which does not need to support the X protocols.Úç”±äº Wayland ä¸æ˜¯ä¸€ä¸ª X æœåŠ¡å™¨ï¼Œä¼ ç»Ÿçš„ X å±å¹•è¿æ¥éœ€è¦ä½¿ç”¨å…¶ä»–æ–¹æ³•ï¼Œå¦‚ VNC æˆ– RDP æ¥è¿›è¡Œè¿œç¨‹æ¡Œé¢ç®¡ç†ã€‚å…¶æ¬¡ï¼ŒWayland å¯ä»¥ä½œä¸ºä¸€ä¸ªç‹¬ç«‹å®ä½“æ¥ç®¡ç†å®¢æˆ·ç«¯å’Œåˆæˆå™¨ä¹‹é—´çš„å¤åˆé€šä¿¡ï¼Œè€Œä¸éœ€è¦æ”¯æŒ X åè®®ã€‚Ú Wayland is relatively new, and not all software has been updated to run natively without `Xwayland` support.  Because Wayland does not provide the X server, and expects compositors to provide that support, X11 window managers that do not yet support Wayland will require that `Xwayland` is not started with the `-rootless` parameter.  The `-rootless` parameter, when removed, will restore X11 window manager support.ÚpWayland ç›¸å¯¹è¾ƒæ–°ï¼Œä¸æ˜¯æ‰€æœ‰çš„è½¯ä»¶éƒ½å·²ç»æ›´æ–°ä»¥åœ¨æ²¡æœ‰ `Xwayland` æ”¯æŒçš„æƒ…å†µä¸‹æœ¬åœ°è¿è¡Œã€‚å› ä¸º Wayland ä¸æä¾› X æœåŠ¡å™¨ï¼Œå¹¶ä¸”æœŸæœ›åˆæˆå™¨æä¾›è¯¥æ”¯æŒï¼Œå°šä¸æ”¯æŒ Wayland çš„ X11 çª—å£ç®¡ç†å™¨å°†è¦æ±‚ä¸ä½¿ç”¨ `-rootless` å‚æ•°å¯åŠ¨ `Xwayland` ã€‚ç§»é™¤ `-rootless` å‚æ•°åï¼Œå°†æ¢å¤ X11 çª—å£ç®¡ç†å™¨çš„æ”¯æŒã€‚ÙÏThe current NVIDIA(R) driver should work with most wlroots compositors, but it may be a little unstable and not support all features at this time.  Volunteers to help work on the NVIDIA(R) DRM are requested.Ùİå½“å‰çš„ NVIDIA(R) é©±åŠ¨ç¨‹åºåº”è¯¥èƒ½å¤Ÿä¸å¤§å¤šæ•° wlroots åˆæˆå™¨é…åˆä½¿ç”¨ï¼Œä½†å¯èƒ½ä¼šæœ‰ä¸€äº›ä¸ç¨³å®šæ€§ï¼Œå¹¶ä¸”åœ¨æ­¤æ—¶å¯èƒ½ä¸æ”¯æŒæ‰€æœ‰åŠŸèƒ½ã€‚æˆ‘ä»¬è¯·æ±‚å¿—æ„¿è€…å¸®åŠ©æ”¹è¿› NVIDIA(R) DRM ã€‚ÙëCurrently, a lot of software will function with minimal issues on Wayland, including Firefox.  And a few desktops are also available, such as the Compiz Fusion replacement, known as Wayfire, and the i3 window manager replacement, Sway.ÙÈç›®å‰ï¼Œè®¸å¤šè½¯ä»¶åœ¨ Wayland ä¸Šå¯ä»¥æ­£å¸¸è¿è¡Œï¼ŒåŒ…æ‹¬ Firefoxã€‚è¿˜æœ‰ä¸€äº›å¯ç”¨çš„æ¡Œé¢ç¯å¢ƒï¼Œæ¯”å¦‚ Compiz Fusion çš„æ›¿ä»£å“ Wayfireï¼Œä»¥åŠ i3 çª—å£ç®¡ç†å™¨çš„æ›¿ä»£å“ Sway ã€‚ÙıAs of May, 2021, plasma5-kwin does support Wayland on FreeBSD.  To use Plasma under Wayland, use the `startplasma-wayland` parameter to `ck-launch-session` and tie in dbus with: `ck-launch-session dbus-run-session startplasma-wayland` to get it working.Ú2æˆªè‡³ 2021 å¹´ 5 æœˆï¼Œ plasma5-kwin åœ¨ FreeBSD ä¸Šæ”¯æŒ Waylandã€‚è¦åœ¨ Wayland ä¸‹ä½¿ç”¨ Plasmaï¼Œè¯·ä½¿ç”¨ `ck-launch-session` çš„ `startplasma-wayland` å‚æ•°ï¼Œå¹¶ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å°† dbus ä¸å…¶ç»‘å®šï¼š`ck-launch-session dbus-run-session startplasma-wayland`ã€‚è¿™æ ·å¯ä»¥ä½¿å…¶æ­£å¸¸å·¥ä½œã€‚Ú±For compositors, a kernel supporting the man:evdev[4] driver must exist to utilize the keybinding functionality.  This is built into the [.filename]#GENERIC# kernel by default; however, if it has been customized and man:evdev[4] support was stripped out, the man:evdev[4] module will need to be loaded.  In addition, users of `Wayland` will need to be members of the `video` group.  To quickly make this change, use the `pw` command:Úå¯¹äºåˆæˆå™¨æ¥è¯´ï¼Œå¿…é¡»å­˜åœ¨æ”¯æŒ man:evdev[4] é©±åŠ¨ç¨‹åºçš„å†…æ ¸æ‰èƒ½åˆ©ç”¨æŒ‰é”®ç»‘å®šåŠŸèƒ½ã€‚è¿™åœ¨é»˜è®¤æƒ…å†µä¸‹å·²ç»å†…ç½®åœ¨ [.filename]#GENERIC# å†…æ ¸ä¸­ï¼›ç„¶è€Œï¼Œå¦‚æœå†…æ ¸è¢«å®šåˆ¶å¹¶ä¸”å»é™¤äº† man:evdev[4] æ”¯æŒï¼Œé‚£ä¹ˆå°±éœ€è¦åŠ è½½ man:evdev[4] æ¨¡å—ã€‚æ­¤å¤–ï¼Œä½¿ç”¨ `Wayland` çš„ç”¨æˆ·è¿˜éœ€è¦æ˜¯ `video` ç»„çš„æˆå‘˜ã€‚è¦å¿«é€Ÿè¿›è¡Œæ­¤æ›´æ”¹ï¼Œè¯·ä½¿ç”¨ `pw` å‘½ä»¤ï¼šÚKInstalling Wayland is simple; there is not a great deal of configuration for the protocol itself.  Most of the composition will depend on the chosen compositor.  By installing `seatd` now, a step is skipped as part of the compositor installation and configuration as `seatd` is needed to provide non-root access to certain devices.Úå®‰è£… Wayland å¾ˆç®€å•ï¼›åè®®æœ¬èº«æ²¡æœ‰å¤ªå¤šçš„é…ç½®ã€‚å¤§éƒ¨åˆ†çš„ç»„åˆå°†å–å†³äºæ‰€é€‰æ‹©çš„åˆæˆå™¨ã€‚é€šè¿‡ç°åœ¨å®‰è£… `seatd`ï¼Œå¯ä»¥è·³è¿‡åˆæˆå™¨å®‰è£…å’Œé…ç½®ä¸€éƒ¨åˆ†çš„æ­¥éª¤ï¼Œå› ä¸º `seatd` éœ€è¦æä¾›å¯¹æŸäº›è®¾å¤‡çš„é root è®¿é—®æƒé™ã€‚ÙîAll of the compositors described here should work with package:graphics/drm-kmod[] open source drivers; however, the NVIDIA(R) graphics cards may have issues when using the proprietary drivers.  Begin by installing the following packages:ÙÖè¿™é‡Œæè¿°çš„æ‰€æœ‰åˆæˆå™¨éƒ½åº”è¯¥ä¸ package:graphics/drm-kmod[] å¼€æºé©±åŠ¨ç¨‹åºé…åˆä½¿ç”¨ï¼›ç„¶è€Œï¼Œä½¿ç”¨ä¸“æœ‰é©±åŠ¨ç¨‹åºæ—¶ï¼Œ NVIDIA(R) æ˜¾å¡å¯èƒ½ä¼šå‡ºç°é—®é¢˜ã€‚é¦–å…ˆå®‰è£…ä»¥ä¸‹è½¯ä»¶åŒ…ï¼šÚJOnce the protocol and supporting packages have been installed, a compositor must create the user interface.  Several compositors will be covered in the following sections.  All compositors using Wayland will need a runtime directory defined in the environment, which can be achieved with the following command in the bourne shell:Úä¸€æ—¦åè®®å’Œæ”¯æŒåŒ…è¢«å®‰è£…ï¼Œåˆæˆå™¨å¿…é¡»åˆ›å»ºç”¨æˆ·ç•Œé¢ã€‚æ¥ä¸‹æ¥çš„å‡ èŠ‚å°†ä»‹ç»å‡ ç§åˆæˆå™¨ã€‚æ‰€æœ‰ä½¿ç”¨ Wayland çš„åˆæˆå™¨éƒ½éœ€è¦åœ¨ç¯å¢ƒä¸­å®šä¹‰ä¸€ä¸ªè¿è¡Œæ—¶ç›®å½•ï¼Œå¯ä»¥é€šè¿‡åœ¨ Bourne shell ä¸­ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥å®ç°ï¼šÚIt is important to note that most compositors will search the XDG_RUNTIME_DIR directory for the configuration files.  In the examples included here, a parameter will be used to specify a configuration file in [.filename]#~/.config# to keep temporary files and configuration files separate.  It is recommended that an alias be configured for each compositor to load the designated configuration file.ÚNéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¤§å¤šæ•°åˆæˆå™¨ä¼šåœ¨ XDG_RUNTIME_DIR ç›®å½•ä¸­æœç´¢é…ç½®æ–‡ä»¶ã€‚åœ¨è¿™é‡ŒåŒ…å«çš„ç¤ºä¾‹ä¸­ï¼Œå°†ä½¿ç”¨ä¸€ä¸ªå‚æ•°æ¥æŒ‡å®šä¸€ä¸ªé…ç½®æ–‡ä»¶åœ¨ [.filename]# ~ /.config# ä¸­ï¼Œä»¥ä¾¿å°†ä¸´æ—¶æ–‡ä»¶å’Œé…ç½®æ–‡ä»¶åˆ†å¼€å­˜æ”¾ã€‚å»ºè®®ä¸ºæ¯ä¸ªåˆæˆå™¨é…ç½®ä¸€ä¸ªåˆ«åï¼Œä»¥åŠ è½½æŒ‡å®šçš„é…ç½®æ–‡ä»¶ã€‚Ú5It has been reported that ZFS users may experience issues with some Wayland clients because they need access to `posix_fallocate()` in the runtime directory.  While the author could not reproduce this issue on their ZFS system, a recommended workaround is not to use ZFS for the runtime directory and instead use `tmpfs` for the [.filename]#/var/run# directory.  In this case, the `tmpfs` file system is used for [.filename]#/var/run# and mounted through the command `mount -t tmpfs tmpfs /var/run` command and then make this change persist across reboots through [.filename]#/etc/fstab#.  The XDG_RUNTIME_DIR environment variable could be configured to use [.filename]#/var/run/user/$UID# and avoid potential pitfalls with ZFS.  Consider that scenario when reviewing the configuration examples in the following sections.ÚÙæ®æŠ¥é“ï¼ŒZFS ç”¨æˆ·å¯èƒ½ä¼šåœ¨æŸäº› Wayland å®¢æˆ·ç«¯ä¸Šé‡åˆ°é—®é¢˜ï¼Œå› ä¸ºå®ƒä»¬éœ€è¦åœ¨è¿è¡Œæ—¶ç›®å½•ä¸­è®¿é—® `posix_fallocate()` å‡½æ•°ã€‚å°½ç®¡ä½œè€…æ— æ³•åœ¨ä»–ä»¬çš„ ZFS ç³»ç»Ÿä¸Šé‡ç°æ­¤é—®é¢˜ï¼Œä½†å»ºè®®çš„è§£å†³æ–¹æ³•æ˜¯ä¸è¦å°† ZFS ç”¨äºè¿è¡Œæ—¶ç›®å½•ï¼Œè€Œæ˜¯ä½¿ç”¨ `tmpfs` ä½œä¸º [.filename]#/var/run# ç›®å½•ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œé€šè¿‡å‘½ä»¤ `mount -t tmpfs tmpfs /var/run` å°† `tmpfs` æ–‡ä»¶ç³»ç»ŸæŒ‚è½½åˆ° [.filename]#/var/run#ï¼Œç„¶åé€šè¿‡ [.filename]#/etc/fstab# ä½¿æ­¤æ›´æ”¹åœ¨é‡æ–°å¯åŠ¨åæŒä¹…åŒ–ã€‚å¯ä»¥é…ç½® XDG_RUNTIME_DIR ç¯å¢ƒå˜é‡ä»¥ä½¿ç”¨ [.filename]#/var/run/user/$UID#ï¼Œé¿å…ä¸ ZFS å¯èƒ½å­˜åœ¨çš„é—®é¢˜ã€‚åœ¨æŸ¥çœ‹ä»¥ä¸‹éƒ¨åˆ†çš„é…ç½®ç¤ºä¾‹æ—¶ï¼Œè¯·è€ƒè™‘è¿™ç§æƒ…å†µã€‚ÚªThe seatd daemon helps manage access to shared system devices for non-root users in compositors; this includes graphics cards.  For traditional X11 managers, `seatd` is not needed, such as both Plasma and GNOME, but for the Wayland compositors discussed here, it will need enabled on the system and be running before starting a compositor environment.  To enable and start the `seatd` daemon now, and on system initialization:Ú†seatd å®ˆæŠ¤è¿›ç¨‹å¸®åŠ©åœ¨åˆæˆå™¨ä¸­ç®¡ç†é root ç”¨æˆ·å¯¹å…±äº«ç³»ç»Ÿè®¾å¤‡çš„è®¿é—®ï¼ŒåŒ…æ‹¬å›¾å½¢å¡ã€‚å¯¹äºä¼ ç»Ÿçš„ X11 ç®¡ç†å™¨ï¼Œå¦‚ Plasma å’Œ GNOMEï¼Œä¸éœ€è¦ä½¿ç”¨ `seatd`ï¼Œä½†å¯¹äºè¿™é‡Œè®¨è®ºçš„ Wayland åˆæˆå™¨ï¼Œåœ¨å¯åŠ¨åˆæˆå™¨ç¯å¢ƒä¹‹å‰ï¼Œéœ€è¦åœ¨ç³»ç»Ÿä¸Šå¯ç”¨å¹¶è¿è¡Œå®ƒã€‚è¦ç«‹å³å¯ç”¨å’Œå¯åŠ¨ `seatd` å®ˆæŠ¤è¿›ç¨‹ï¼Œå¹¶åœ¨ç³»ç»Ÿåˆå§‹åŒ–æ—¶å¯åŠ¨ï¼šÙõAfterward, a compositor, which is similar to an X11 desktop, will need to be installed for the GUI environment.  Three are discussed here, including basic configuration options, setting up a screen lock, and recommendations for more information.ÙÒä¹‹åï¼Œéœ€è¦å®‰è£…ä¸€ä¸ªç±»ä¼¼äº X11 æ¡Œé¢çš„åˆæˆå™¨ (compositor) æ¥åˆ›å»º GUI ç¯å¢ƒã€‚è¿™é‡Œè®¨è®ºäº†ä¸‰ç§åˆæˆå™¨ï¼ŒåŒ…æ‹¬åŸºæœ¬é…ç½®é€‰é¡¹ã€è®¾ç½®å±å¹•é”å®šä»¥åŠè·å–æ›´å¤šä¿¡æ¯çš„å»ºè®®ã€‚¶The Wayfire Compositor±Wayfire åˆæˆå™¨Ú=Wayfire is a compositor that aims to be lightweight and customizable.  Several features are available, and it brings back several elements from the previously released Compiz Fusion desktop.  All of the parts look beautiful on modern hardware. To get Wayfire up and running, begin by installing the required packages:ÚWayfire æ˜¯ä¸€ä¸ªæ—¨åœ¨è½»é‡åŒ–å’Œå¯å®šåˆ¶åŒ–çš„åˆæˆå™¨ã€‚å®ƒæä¾›äº†å¤šç§åŠŸèƒ½ï¼Œå¹¶ä¸”è¿˜æ¢å¤äº†ä¹‹å‰å‘å¸ƒçš„ Compiz Fusion æ¡Œé¢çš„ä¸€äº›å…ƒç´ ã€‚æ‰€æœ‰çš„éƒ¨åˆ†åœ¨ç°ä»£ç¡¬ä»¶ä¸Šçœ‹èµ·æ¥éƒ½å¾ˆæ¼‚äº®ã€‚è¦å¯åŠ¨å’Œè¿è¡Œ Wayfireï¼Œè¯·å…ˆå®‰è£…æ‰€éœ€çš„è½¯ä»¶åŒ…ï¼šÚ¿The `alacritty` package provides a terminal emulator.  Still, it is not completely required as other terminal emulators such as `kitty`, and XFCE-4 `Terminal` have been tested and verified to work under the Wayfire compositor.  Wayfire configuration is relatively simple; it uses a file that should be reviewed for any customizations.  To begin, copy the example file over to the runtime environment configuration directory and then edit the file:Ú`alacritty` è½¯ä»¶åŒ…æä¾›äº†ä¸€ä¸ªç»ˆç«¯ä»¿çœŸå™¨ã€‚ç„¶è€Œï¼Œå¹¶ä¸å®Œå…¨éœ€è¦å®ƒï¼Œå› ä¸ºå…¶ä»–ç»ˆç«¯ä»¿çœŸå™¨å¦‚ `kitty` å’Œ XFCE-4 `Terminal` å·²ç»åœ¨ Wayfire åˆæˆå™¨ä¸‹è¿›è¡Œäº†æµ‹è¯•å’ŒéªŒè¯ã€‚ Wayfire çš„é…ç½®ç›¸å¯¹ç®€å•ï¼›å®ƒä½¿ç”¨ä¸€ä¸ªæ–‡ä»¶ï¼Œåº”è¯¥å¯¹å…¶ä¸­çš„ä»»ä½•è‡ªå®šä¹‰è¿›è¡Œå®¡æŸ¥ã€‚è¦å¼€å§‹ï¼Œå°†ç¤ºä¾‹æ–‡ä»¶å¤åˆ¶åˆ°è¿è¡Œæ—¶ç¯å¢ƒé…ç½®ç›®å½•ï¼Œç„¶åç¼–è¾‘è¯¥æ–‡ä»¶ï¼šÙåThe defaults for most users should be fine.  Within the configuration file, items like the famous `cube` are pre-configured, and there are instructions to help with the available settings.  A few primary settings of note include:Ùìå¯¹äºå¤§å¤šæ•°ç”¨æˆ·æ¥è¯´ï¼Œé»˜è®¤è®¾ç½®åº”è¯¥æ˜¯å¯ä»¥çš„ã€‚åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼Œåƒè‘—åçš„ `cube` è¿™æ ·çš„é¡¹ç›®å·²ç»é¢„å…ˆé…ç½®å¥½äº†ï¼Œå¹¶ä¸”æœ‰è¯´æ˜æ¥å¸®åŠ©è®¾ç½®å¯ç”¨çš„é€‰é¡¹ã€‚ä¸€äº›å€¼å¾—æ³¨æ„çš„ä¸»è¦è®¾ç½®åŒ…æ‹¬ï¼šÚ In this example, from the configuration file, the screen's output should be the listed mode at the listed hertz.  For example, the mode should be set to `widthxheight@refresh_rate`.  The position places the output at a specific pixel location specified.  The default should be fine for most users.  Finally, transform sets a background transform, and scale will scale the output to the specified scale factor.  The defaults for these options are generally acceptable; for more information, see the documentation.Úáåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œä»é…ç½®æ–‡ä»¶ä¸­ï¼Œå±å¹•çš„è¾“å‡ºåº”è¯¥æ˜¯åˆ—è¡¨ä¸­åˆ—å‡ºçš„æ¨¡å¼å’Œåˆ—è¡¨ä¸­åˆ—å‡ºçš„èµ«å…¹ã€‚ä¾‹å¦‚ï¼Œæ¨¡å¼åº”è¯¥è®¾ç½®ä¸º `widthxheight@refresh_rate`ã€‚ä½ç½®å°†è¾“å‡ºæ”¾ç½®åœ¨æŒ‡å®šçš„åƒç´ ä½ç½®ä¸Šã€‚é»˜è®¤å€¼å¯¹å¤§å¤šæ•°ç”¨æˆ·æ¥è¯´åº”è¯¥æ˜¯å¯ä»¥æ¥å—çš„ã€‚æœ€åï¼Œ transform è®¾ç½®äº†èƒŒæ™¯å˜æ¢ï¼Œ scale å°†è¾“å‡ºæŒ‰æŒ‡å®šçš„æ¯”ä¾‹å› å­è¿›è¡Œç¼©æ”¾ã€‚è¿™äº›é€‰é¡¹çš„é»˜è®¤å€¼é€šå¸¸æ˜¯å¯ä»¥æ¥å—çš„ï¼›æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…æ–‡æ¡£ã€‚Ú_As mentioned, Wayland is new, and not all applications work with the protocol yet.  At this time, `sddm` does not appear to support starting and managing compositors in Wayland.  The `swaylock` utility has been used instead in these examples. The configuration file contains options to run `swayidle` and `swaylock` for idle and locking of the screen.ÚGå¦‚å‰æ‰€è¿°ï¼ŒWayland æ˜¯ä¸€ç§æ–°çš„åè®®ï¼Œè¿˜ä¸æ˜¯æ‰€æœ‰çš„åº”ç”¨ç¨‹åºéƒ½èƒ½ä¸ä¹‹å…¼å®¹ã€‚ç›®å‰ï¼Œ`sddm` ä¼¼ä¹ä¸æ”¯æŒåœ¨ Wayland ä¸­å¯åŠ¨å’Œç®¡ç†åˆæˆå™¨ã€‚åœ¨è¿™äº›ç¤ºä¾‹ä¸­ï¼Œä½¿ç”¨äº† `swaylock` å®ç”¨ç¨‹åºã€‚é…ç½®æ–‡ä»¶ä¸­åŒ…å«äº†è¿è¡Œ `swayidle` å’Œ `swaylock` æ¥å¤„ç†å±å¹•ç©ºé—²å’Œé”å®šçš„é€‰é¡¹ã€‚ÙNThis option to define the action to take when the system is idle is listed as:ÙTå½“ç³»ç»Ÿå¤„äºç©ºé—²çŠ¶æ€æ—¶ï¼Œå¯ä»¥ä½¿ç”¨æ­¤é€‰é¡¹æ¥å®šä¹‰è¦æ‰§è¡Œçš„æ“ä½œã€‚Ù=And the lock timeout is configured using the following lines:Ù0é”å®šè¶…æ—¶æ˜¯é€šè¿‡ä»¥ä¸‹è¡Œè¿›è¡Œé…ç½®çš„ï¼šÙ‹The first option will lock the screen after 300 seconds, and after another 300, the screen will shut off through the `dpms_timeout` option.Ùqç¬¬ä¸€ä¸ªé€‰é¡¹å°†åœ¨ 300 ç§’åé”å®šå±å¹•ï¼Œå†è¿‡ 300 ç§’åï¼Œå±å¹•å°†é€šè¿‡ `dpms_timeout` é€‰é¡¹å…³é—­ã€‚ÚOne final thing to note is the <super> key.  Most of the configuration mentions this key, and it is the traditional `Windows` key on the keyboard.  Most keyboards have this super key available; however, it should be remapped within this configuration file if it is not available.  For example, to lock the screen, press and hold the super key, the kbd:[shift] key, and press the kbd:[escape] key.  nless the mappings have changed, this will execute the swaylock application.  The default configuration for `swaylock` will show a grey screen; however, the application is highly customizable and well documented.  In addition, since the swaylock-effects is the version that was installed, there are several options available such as the blur effect, which can be seen using the following command:Ú®éœ€è¦æ³¨æ„çš„æœ€åä¸€ä»¶äº‹æ˜¯ <super> é”®ã€‚å¤§å¤šæ•°é…ç½®éƒ½æåˆ°äº†è¿™ä¸ªé”®ï¼Œå®ƒæ˜¯é”®ç›˜ä¸Šçš„ä¼ ç»Ÿ `Windows` é”®ã€‚å¤§å¤šæ•°é”®ç›˜éƒ½æœ‰è¿™ä¸ªè¶…çº§é”®å¯ç”¨ï¼›ç„¶è€Œï¼Œå¦‚æœè¯¥é”®ä¸å¯ç”¨ï¼Œåº”åœ¨æ­¤é…ç½®æ–‡ä»¶ä¸­é‡æ–°æ˜ å°„å®ƒã€‚ä¾‹å¦‚ï¼Œè¦é”å®šå±å¹•ï¼Œè¯·æŒ‰ä½è¶…çº§é”®ï¼Œkbd:[shift] é”®ï¼Œç„¶åæŒ‰ä¸‹ kbd:[escape] é”®ã€‚é™¤éæ˜ å°„å·²æ›´æ”¹ï¼Œå¦åˆ™è¿™å°†æ‰§è¡Œ swaylock åº”ç”¨ç¨‹åºã€‚ `swaylock` çš„é»˜è®¤é…ç½®å°†æ˜¾ç¤ºä¸€ä¸ªç°è‰²å±å¹•ï¼›ç„¶è€Œï¼Œè¯¥åº”ç”¨ç¨‹åºå¯ä»¥é«˜åº¦è‡ªå®šä¹‰ï¼Œå¹¶ä¸”æœ‰å¾ˆå¥½çš„æ–‡æ¡£ã€‚æ­¤å¤–ï¼Œç”±äºå®‰è£…çš„æ˜¯ swaylock-effects ç‰ˆæœ¬ï¼Œå› æ­¤æœ‰å‡ ä¸ªå¯ç”¨çš„é€‰é¡¹ï¼Œä¾‹å¦‚æ¨¡ç³Šæ•ˆæœï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹ï¼šÚsThere is also the `--clock` parameter which will display a clock with the date and time on the lock screen.  When package:x11/swaylock-effects[] was installed, a default [.filename]#pam.d# configuration was included.  It provides the default options that should be fine for most users.  More advanced options are available; see the PAM documentation for more information.ÚKè¿˜æœ‰ä¸€ä¸ª `--clock` å‚æ•°ï¼Œå®ƒä¼šåœ¨é”å±ç•Œé¢ä¸Šæ˜¾ç¤ºä¸€ä¸ªå¸¦æœ‰æ—¥æœŸå’Œæ—¶é—´çš„æ—¶é’Ÿã€‚å½“å®‰è£…äº† `x11/swaylock-effects` è½¯ä»¶åŒ…æ—¶ï¼Œä¼šåŒ…å«ä¸€ä¸ªé»˜è®¤çš„ `pam.d` é…ç½®æ–‡ä»¶ã€‚å®ƒæä¾›äº†é€‚ç”¨äºå¤§å¤šæ•°ç”¨æˆ·çš„é»˜è®¤é€‰é¡¹ã€‚è¿˜æœ‰æ›´é«˜çº§çš„é€‰é¡¹å¯ç”¨ï¼›æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜… PAM æ–‡æ¡£ã€‚ÙuAt this point, it is time to test Wayfire and see if it can start up on the system.  Just type the following command:Ùiæ­¤æ—¶ï¼Œæ˜¯æ—¶å€™æµ‹è¯• Wayfire å¹¶æŸ¥çœ‹å®ƒæ˜¯å¦èƒ½åœ¨ç³»ç»Ÿä¸Šå¯åŠ¨äº†ã€‚åªéœ€è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼šÚµThe compositor should now start and display a background image along with a menu bar at the top of the screen.  Wayfire will attempt to list installed compatible applications for the desktop and present them in this drop-down menu; for example, if the XFCE-4 file manager is installed, it will show up in this drop-down menu.  If a specific application is compatible and valuable enough for a keyboard shortcut, it may be mapped to a keyboard sequence using the [.filename]#wayfire.ini# configuration file.  Wayfire also has a configuration tool named Wayfire Config Manager.  It is located in the drop-down menu bar but may also be started through a terminal by issuing the following command:ÚJç°åœ¨ï¼Œåˆæˆå™¨åº”è¯¥å¼€å§‹è¿è¡Œï¼Œå¹¶åœ¨å±å¹•é¡¶éƒ¨æ˜¾ç¤ºä¸€ä¸ªèƒŒæ™¯å›¾åƒå’Œä¸€ä¸ªèœå•æ ã€‚ Wayfire å°†å°è¯•åˆ—å‡ºå·²å®‰è£…çš„å…¼å®¹åº”ç”¨ç¨‹åºï¼Œå¹¶åœ¨æ­¤ä¸‹æ‹‰èœå•ä¸­å‘ˆç°å®ƒä»¬ï¼›ä¾‹å¦‚ï¼Œå¦‚æœå®‰è£…äº† XFCE-4 æ–‡ä»¶ç®¡ç†å™¨ï¼Œå®ƒå°†æ˜¾ç¤ºåœ¨æ­¤ä¸‹æ‹‰èœå•ä¸­ã€‚å¦‚æœç‰¹å®šåº”ç”¨ç¨‹åºä¸é”®ç›˜å¿«æ·é”®å…¼å®¹ä¸”è¶³å¤Ÿæœ‰ä»·å€¼ï¼Œå¯ä»¥ä½¿ç”¨ [.filename]#wayfire.ini# é…ç½®æ–‡ä»¶å°†å…¶æ˜ å°„åˆ°é”®ç›˜åºåˆ—ã€‚ Wayfire è¿˜æœ‰ä¸€ä¸ªåä¸º Wayfire Config Manager çš„é…ç½®å·¥å…·ã€‚å®ƒä½äºä¸‹æ‹‰èœå•æ ä¸­ï¼Œä½†ä¹Ÿå¯ä»¥é€šè¿‡ç»ˆç«¯å‘å‡ºä»¥ä¸‹å‘½ä»¤æ¥å¯åŠ¨ï¼šÚ"Various Wayfire configuration options, including the composite special effects, maybe enabled, disabled, or configured through this application.  In addition, for a more user-friendly experience, a background manager, panel, and docking application may be enabled in the configuration file:Ùêé€šè¿‡è¿™ä¸ªåº”ç”¨ç¨‹åºï¼Œå¯ä»¥å¯ç”¨ã€ç¦ç”¨æˆ–é…ç½®å„ç§ Wayfire é…ç½®é€‰é¡¹ï¼ŒåŒ…æ‹¬åˆæˆç‰¹æ•ˆã€‚æ­¤å¤–ï¼Œä¸ºäº†æä¾›æ›´ç”¨æˆ·å‹å¥½çš„ä½“éªŒï¼Œå¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­å¯ç”¨èƒŒæ™¯ç®¡ç†å™¨ã€é¢æ¿å’Œåœé åº”ç”¨ç¨‹åºã€‚ÙßChanges made through `wcm` will overwrite custom changes in the [.filename]#wayfire.ini# configuration file.  The [.filename]#wayfire.ini# file is highly recommended to be backed up so any essential changes may be restored.ÙÂé€šè¿‡ `wcm` è¿›è¡Œçš„æ›´æ”¹å°†è¦†ç›– [.filename]#wayfire.ini# é…ç½®æ–‡ä»¶ä¸­çš„è‡ªå®šä¹‰æ›´æ”¹ã€‚å¼ºçƒˆå»ºè®®å¤‡ä»½ [.filename]#wayfire.ini# æ–‡ä»¶ï¼Œä»¥ä¾¿å¯ä»¥æ¢å¤ä»»ä½•é‡è¦çš„æ›´æ”¹ã€‚ÙFinally, the default launcher listed in the [.filename]#wayfire.ini# is package:x11/wf-shell[] which may be replaced with other panels if desired by the user.Ùæœ€åï¼Œåœ¨ [.filename]#wayfire.ini# ä¸­åˆ—å‡ºçš„é»˜è®¤å¯åŠ¨å™¨æ˜¯ package:x11/wf-shell[] ï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®éœ€è¦æ›¿æ¢ä¸ºå…¶ä»–é¢æ¿ã€‚µThe Hikari Compositor°Hikari åˆæˆå™¨ÚÓThe Hikari compositor uses several concepts centered around productivity, such as sheets, workspaces, and more.  In that way, it resembles a tiling window manager.  Breaking this down, the compositor starts with a single workspace, which is similar to virtual desktops.  Hikari uses a single workspace or virtual desktop for user interaction. The workspace is made up of several views, which are the working windows in the compositor grouped as either sheets or groups.  Both sheets and groups are made up of a collection of views; again, the windows that are grouped together.  When switching between sheets or groups, the active sheet or group will become known collectively as the workspace.  The manual page will break this down into more information on the functions of each but for this document, just consider a single workspace utilizing a single sheet.  Hikari installation will comprise of a single package, package:x11-wm/hikari[], and a terminal emulator `alacritty`:ÚZHikari åˆæˆå™¨ä½¿ç”¨äº†å‡ ä¸ªä»¥æé«˜ç”Ÿäº§åŠ›ä¸ºä¸­å¿ƒçš„æ¦‚å¿µï¼Œä¾‹å¦‚å·¥ä½œè¡¨ï¼ˆsheetsï¼‰ã€å·¥ä½œåŒºï¼ˆworkspacesï¼‰ç­‰ç­‰ã€‚ä»è¿™ä¸ªè§’åº¦æ¥çœ‹ï¼Œå®ƒç±»ä¼¼äºå¹³é“ºå¼çª—å£ç®¡ç†å™¨ã€‚å…·ä½“æ¥è¯´ï¼Œåˆæˆå™¨ä»ä¸€ä¸ªå•ä¸€çš„å·¥ä½œåŒºå¼€å§‹ï¼Œç±»ä¼¼äºè™šæ‹Ÿæ¡Œé¢ã€‚ Hikari ä½¿ç”¨ä¸€ä¸ªå•ä¸€çš„å·¥ä½œåŒºæˆ–è™šæ‹Ÿæ¡Œé¢è¿›è¡Œç”¨æˆ·äº¤äº’ã€‚å·¥ä½œåŒºç”±å¤šä¸ªè§†å›¾ç»„æˆï¼Œè¿™äº›è§†å›¾æ˜¯åˆæˆå™¨ä¸­çš„å·¥ä½œçª—å£ï¼Œåˆ†ç»„ä¸ºå·¥ä½œè¡¨æˆ–ç»„ï¼ˆgroupsï¼‰ã€‚å·¥ä½œè¡¨å’Œç»„éƒ½ç”±ä¸€ç»„è§†å›¾ç»„æˆï¼Œå³è¢«åˆ†ç»„åœ¨ä¸€èµ·çš„çª—å£ã€‚åœ¨å·¥ä½œè¡¨æˆ–ä¹‹é—´åˆ‡æ¢æ—¶ï¼Œæ´»åŠ¨çš„å·¥ä½œè¡¨æˆ–ç»„å°†è¢«ç»Ÿç§°ä¸ºå·¥ä½œåŒºã€‚æ‰‹å†Œå°†è¯¦ç»†ä»‹ç»æ¯ä¸ªåŠŸèƒ½ï¼Œä½†åœ¨æœ¬æ–‡æ¡£ä¸­ï¼Œåªéœ€è€ƒè™‘ä¸€ä¸ªä½¿ç”¨å•ä¸ª å·¥ä½œè¡¨çš„å·¥ä½œåŒºã€‚ Hikari çš„å®‰è£…å°†åŒ…æ‹¬ä¸€ä¸ªå•ä¸€çš„è½¯ä»¶åŒ… package:x11-wm/hikari[] å’Œä¸€ä¸ªç»ˆç«¯æ¨¡æ‹Ÿå™¨ `alacritty` ã€‚Ù«Other shells, such as `kitty` or the Plasma `Terminal`, will function under Wayland. Users should experiment with their favorite terminal editor to validate compatibility.Ù¦å…¶ä»–ç»ˆç«¯ï¼Œå¦‚ `kitty` æˆ– Plasma çš„ `Terminal`ï¼Œåœ¨ Wayland ä¸‹å¯ä»¥æ­£å¸¸å·¥ä½œã€‚ç”¨æˆ·åº”è¯¥å°è¯•ä½¿ç”¨ä»–ä»¬å–œæ¬¢çš„ç»ˆç«¯ç¼–è¾‘å™¨æ¥éªŒè¯å…¼å®¹æ€§ã€‚ÚHikari uses a configuration file, [.filename]#hikari.conf#, which could either be placed in the XDG_RUNTIME_DIR or specified on startup using the `-c` parameter.  An autostart configuration file is not required but may make the migration to this compositor a little easier.  Beginning the configuration is to create the Hikari configuration directory and copy over the configuration file for editing:ÚDHikari ä½¿ç”¨ä¸€ä¸ªé…ç½®æ–‡ä»¶ [.filename]#hikari.conf#ï¼Œå¯ä»¥æ”¾ç½®åœ¨ XDG_RUNTIME_DIR ç›®å½•ä¸­ï¼Œä¹Ÿå¯ä»¥åœ¨å¯åŠ¨æ—¶ä½¿ç”¨ `-c` å‚æ•°æŒ‡å®šã€‚ä¸éœ€è¦è‡ªåŠ¨å¯åŠ¨é…ç½®æ–‡ä»¶ï¼Œä½†æ˜¯å¯èƒ½ä¼šä½¿è¿ç§»åˆ°è¿™ä¸ªåˆæˆå™¨æ›´å®¹æ˜“ä¸€äº›ã€‚å¼€å§‹é…ç½®æ˜¯åˆ›å»º Hikari é…ç½®ç›®å½•å¹¶å¤åˆ¶é…ç½®æ–‡ä»¶è¿›è¡Œç¼–è¾‘ï¼šÚeThe configuration is broken out into various stanzas such as ui, outputs, layouts, and more.  For most users, the defaults will function fine; however, some important changes should be made.  For example, the $TERMINAL variable is normally not set within the user's environment.  Changing this variable or altering the [.filename]#hikari.conf# file to read:ÚPé…ç½®è¢«åˆ†è§£ä¸ºå„ç§éƒ¨åˆ†ï¼Œå¦‚ uiã€outputsã€layouts ç­‰ç­‰ã€‚å¯¹äºå¤§å¤šæ•°ç”¨æˆ·æ¥è¯´ï¼Œé»˜è®¤è®¾ç½®åº”è¯¥å¯ä»¥æ­£å¸¸è¿è¡Œï¼›ä½†æ˜¯è¿˜éœ€è¦è¿›è¡Œä¸€äº›é‡è¦çš„æ›´æ”¹ã€‚ä¾‹å¦‚ï¼Œ$TERMINAL å˜é‡é€šå¸¸åœ¨ç”¨æˆ·çš„ç¯å¢ƒä¸­æ²¡æœ‰è®¾ç½®ã€‚å¯ä»¥æ›´æ”¹è¿™ä¸ªå˜é‡æˆ–è€…ä¿®æ”¹ [.filename]#hikari.conf# æ–‡ä»¶ä»¥è¿›è¡Œè¯»å–ã€‚ÚWill launch the `alacritty` terminal using the bound key press.  While going through the configuration file, it should be noted that the capital letters are used to map keys out for the user.  For example, the kbd:[L] key for starting the terminal kbd:[L+Return] is actually the previously discussed super key or Windows logo key.  Therefore, holding the kbd:[L/super/Windows] key and pressing kbd:[Enter] will open the specified terminal emulator with the default configuration.  Mapping other keys to applications require an action definition to be created.  For this, the action item should be listed in the actions stanza, for example:Úçå°†ä½¿ç”¨ç»‘å®šçš„æŒ‰é”®å¯åŠ¨ `alacritty` ç»ˆç«¯ã€‚åœ¨æµè§ˆé…ç½®æ–‡ä»¶æ—¶ï¼Œåº”æ³¨æ„å¤§å†™å­—æ¯ç”¨äºä¸ºç”¨æˆ·æ˜ å°„é”®ã€‚ä¾‹å¦‚ï¼Œç”¨äºå¯åŠ¨ç»ˆç«¯çš„ kbd:[L] é”® kbd:[L + Return] å®é™…ä¸Šæ˜¯å‰é¢è®¨è®ºè¿‡çš„è¶…çº§é”®æˆ– Windows å¾½æ ‡é”®ã€‚å› æ­¤ï¼ŒæŒ‰ä½ kbd:[L/super/Windows] é”®å¹¶æŒ‰ä¸‹ kbd:[Enter] é”®å°†ä½¿ç”¨é»˜è®¤é…ç½®æ‰“å¼€æŒ‡å®šçš„ç»ˆç«¯ä»¿çœŸå™¨ã€‚å°†å…¶ä»–é”®æ˜ å°„åˆ°åº”ç”¨ç¨‹åºéœ€è¦åˆ›å»ºä¸€ä¸ªåŠ¨ä½œå®šä¹‰ã€‚ä¸ºæ­¤ï¼ŒåŠ¨ä½œé¡¹åº”åˆ—åœ¨åŠ¨ä½œæ®µä¸­ï¼Œä¾‹å¦‚ï¼šÙdThen an action may be mapped under the keyboard stanza, which is defined within the bindings stanza:ÙZç„¶åï¼Œå¯ä»¥å°†ä¸€ä¸ªåŠ¨ä½œæ˜ å°„åˆ°é”®ç›˜éƒ¨åˆ†ï¼Œè¯¥éƒ¨åˆ†åœ¨ç»‘å®šéƒ¨åˆ†ä¸­å®šä¹‰ï¼šÚAAfter Hikari is restarted, holding the Windows logo button and pressing the kbd:[b] key on the keyboard will start the web browser.  The compositor does not have a menu bar, and it is recommended the user set up, at minimal, a terminal emulator before migration.  The manual page contains a great deal of documentation it should be read before performing a full migration.  Another positive aspect about Hikari is that, while migrating to the compositor, Hikari can be started in the Plasma and GNOME desktop environments, allowing for a test-drive before completely migrating.Úºåœ¨ Hikari é‡æ–°å¯åŠ¨åï¼ŒæŒ‰ä½ Windows å¾½æ ‡æŒ‰é’®å¹¶åœ¨é”®ç›˜ä¸ŠæŒ‰ä¸‹ kbd:[b] é”®å°†å¯åŠ¨ç½‘é¡µæµè§ˆå™¨ã€‚åˆæˆå™¨æ²¡æœ‰èœå•æ ï¼Œå»ºè®®ç”¨æˆ·åœ¨è¿ç§»ä¹‹å‰è‡³å°‘è®¾ç½®ä¸€ä¸ªç»ˆç«¯ä»¿çœŸå™¨ã€‚æ‰‹å†Œä¸­åŒ…å«å¤§é‡çš„æ–‡æ¡£ï¼Œåº”åœ¨è¿›è¡Œå®Œæ•´è¿ç§»ä¹‹å‰é˜…è¯»ã€‚Hikari çš„å¦ä¸€ä¸ªç§¯ææ–¹é¢æ˜¯ï¼Œåœ¨è¿ç§»åˆ°åˆæˆå™¨æ—¶ï¼Œå¯ä»¥åœ¨ Plasma å’Œ GNOME æ¡Œé¢ç¯å¢ƒä¸­å¯åŠ¨ Hikariï¼Œä»¥ä¾¿åœ¨å®Œå…¨è¿ç§»ä¹‹å‰è¿›è¡Œè¯•ç”¨ã€‚ÚQLocking the screen in Hikari is easy because a default [.filename]#pam.d# configuration file and unlock utility are bundled with the package.  The key binding for locking the screen is kbd:[L] (Windows logo key)+ kbd:[Shift] + kbd:[Backspace].  It should be noted that all views not marked public will be hidden.  These views will never accept input when locked but beware of sensitive information being visible.  For some users, it may be easier to migrate to a different screen locking utility such as swaylock-effects, discussed in this section.  To start Hikari, use the following command:Ú.åœ¨ Hikari ä¸­é”å®šå±å¹•å¾ˆå®¹æ˜“ï¼Œå› ä¸ºé»˜è®¤çš„ [.filename]#pam.d# é…ç½®æ–‡ä»¶å’Œè§£é”å·¥å…·å·²ç»ä¸è½¯ä»¶åŒ…æ†ç»‘åœ¨ä¸€èµ·ã€‚é”å®šå±å¹•çš„é”®ç»‘å®šæ˜¯ kbd:[L]ï¼ˆWindows å¾½æ ‡é”®ï¼‰+ kbd:[Shift] + kbd:[Backspace]ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ‰€æœ‰æœªæ ‡è®°ä¸ºå…¬å…±çš„è§†å›¾å°†è¢«éšè—ã€‚å½“å±å¹•é”å®šæ—¶ï¼Œè¿™äº›è§†å›¾å°†ä¸æ¥å—è¾“å…¥ï¼Œä½†è¦æ³¨æ„æ•æ„Ÿä¿¡æ¯å¯èƒ½å¯è§ã€‚å¯¹äºä¸€äº›ç”¨æˆ·æ¥è¯´ï¼Œå¯èƒ½æ›´å®¹æ˜“è¿ç§»åˆ°å…¶ä»–å±å¹•é”å®šå·¥å…·ï¼Œæ¯”å¦‚åœ¨æœ¬èŠ‚ä¸­è®¨è®ºçš„ swaylock-effectsã€‚è¦å¯åŠ¨ Hikariï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š³The Sway Compositor®Sway åˆæˆå™¨Ú‘The Sway compositor is a tiling compositor that attempts to replace the i3 windows manager.  It should work with the user's current i3 configuration; however, new features may require some additional setup.  In the forthcoming examples, a fresh installation without migrating any i3 configuration will be assumed.  To install Sway and valuable components, issue the following command as the root user:Ú^Sway åˆæˆå™¨æ˜¯ä¸€ç§å¹³é“ºå¼åˆæˆå™¨ï¼Œæ—¨åœ¨å–ä»£ i3 çª—å£ç®¡ç†å™¨ã€‚å®ƒåº”è¯¥ä¸ç”¨æˆ·å½“å‰çš„ i3 é…ç½®å…¼å®¹ï¼›ä½†æ˜¯ï¼Œæ–°åŠŸèƒ½å¯èƒ½éœ€è¦ä¸€äº›é¢å¤–çš„è®¾ç½®ã€‚åœ¨æ¥ä¸‹æ¥çš„ç¤ºä¾‹ä¸­ï¼Œå‡è®¾è¿›è¡Œäº†å…¨æ–°å®‰è£…ï¼Œæ²¡æœ‰è¿ç§»ä»»ä½• i3 é…ç½®ã€‚è¦å®‰è£… Sway å’Œæœ‰ä»·å€¼çš„ç»„ä»¶ï¼Œè¯·ä»¥ root ç”¨æˆ·èº«ä»½æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼šÙuFor a basic configuration file, issue the following commands and then edit the configuration file after it is copied:Ùfå¯¹äºä¸€ä¸ªåŸºæœ¬çš„é…ç½®æ–‡ä»¶ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œç„¶ååœ¨å¤åˆ¶å®Œæˆåç¼–è¾‘é…ç½®æ–‡ä»¶ï¼šÙThe base configuration file has many defaults, which will be fine for most users.  Several important changes should be made like the following:ÙåŸºæœ¬é…ç½®æ–‡ä»¶æœ‰è®¸å¤šé»˜è®¤å€¼ï¼Œå¯¹äºå¤§å¤šæ•°ç”¨æˆ·æ¥è¯´è¿™æ˜¯å¯ä»¥çš„ã€‚ä½†æ˜¯è¿˜éœ€è¦è¿›è¡Œä¸€äº›é‡è¦çš„æ›´æ”¹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼šÚŠIn the previous example, the `xkb` rules for man:evdev[4] events are loaded, and the $mod key is set to the Windows logo key for the key bindings.  Next, the terminal emulator was set to be `alacritty`, and a screen lock command was defined; more on this later.  The output keyword, the mode, the position, a background wallpaper, and Sway is also told to stretch this wallpaper to fill out the screen.  Finally, `swaylock` is set to daemonize and lock the screen after a timeout of 300 seconds, placing the screen or monitor into sleep mode after 600 seconds.  The locked background color of 000000, which is black, is also defined here.  Using swaylock-effects, a clock may also be displayed with the `--clock` parameter.  See the manual page for more options.  The man:sway-output[5] manual page should also be reviewed; it includes a great deal of information on customing the output options available.Úîåœ¨å‰é¢çš„ç¤ºä¾‹ä¸­ï¼ŒåŠ è½½äº† `xkb` è§„åˆ™ä»¥å¤„ç† man:evdev[4] äº‹ä»¶ï¼Œå¹¶å°† $mod é”®è®¾ç½®ä¸º Windows å¾½æ ‡é”®ä»¥è¿›è¡Œé”®ç»‘å®šã€‚æ¥ä¸‹æ¥ï¼Œç»ˆç«¯ä»¿çœŸå™¨è¢«è®¾ç½®ä¸º `alacritty`ï¼Œå¹¶å®šä¹‰äº†ä¸€ä¸ªå±å¹•é”å®šå‘½ä»¤ï¼›ç¨åä¼šè¯¦ç»†ä»‹ç»ã€‚è¾“å‡ºå…³é”®å­—ã€æ¨¡å¼ã€ä½ç½®ã€èƒŒæ™¯å£çº¸ä»¥åŠ Sway è¿˜è¢«å‘ŠçŸ¥å°†è¯¥å£çº¸æ‹‰ä¼¸ä»¥å¡«æ»¡å±å¹•ã€‚æœ€åï¼Œè®¾ç½® `swaylock` åœ¨ 300 ç§’è¶…æ—¶åå°†å±å¹•æˆ–ç›‘è§†å™¨é”å®šå¹¶è¿›å…¥ç¡çœ æ¨¡å¼ã€‚åœ¨è¿™é‡Œè¿˜å®šä¹‰äº†é”å®šçš„èƒŒæ™¯é¢œè‰²ä¸º 000000ï¼Œå³é»‘è‰²ã€‚ä½¿ç”¨ swaylock-effectsï¼Œè¿˜å¯ä»¥ä½¿ç”¨ `--clock` å‚æ•°æ˜¾ç¤ºæ—¶é’Ÿã€‚æœ‰å…³æ›´å¤šé€‰é¡¹ï¼Œè¯·å‚é˜…æ‰‹å†Œé¡µã€‚è¿˜åº”è¯¥æŸ¥çœ‹ man:sway-output[5] æ‰‹å†Œé¡µï¼›å®ƒåŒ…å«äº†å¤§é‡å…³äºè‡ªå®šä¹‰è¾“å‡ºé€‰é¡¹çš„ä¿¡æ¯ã€‚Ú˜While in Sway, to bring up a menu of applications, hold the Windows logo key (mod) and press the kbd:[d] key.  The menu may be navigated using the arrow keys on the keyboard.  There is also a method to manipulate the layout of the bar and add a tray; read the man:sway-bar[5] manual page for more information.  The default configuration adds a date and time to the upper right-hand corner.  See the `Bar` stanza in the configuration file for an example.  By default, the configuration does not include locking the screen outside of the example above, enabling a lockout timer.  Creating a lock key binding requires the following line to the `Key bindings` section:Ú9åœ¨ Sway ä¸­ï¼Œè¦æ‰“å¼€åº”ç”¨ç¨‹åºèœå•ï¼Œè¯·æŒ‰ä½ Windows å¾½æ ‡é”®ï¼ˆmod é”®ï¼‰å¹¶æŒ‰ä¸‹ kbd:[d] é”®ã€‚å¯ä»¥ä½¿ç”¨é”®ç›˜ä¸Šçš„ç®­å¤´é”®æ¥å¯¼èˆªèœå•ã€‚è¿˜æœ‰ä¸€ç§æ–¹æ³•å¯ä»¥æ“ä½œæ çš„å¸ƒå±€å¹¶æ·»åŠ ä¸€ä¸ªæ‰˜ç›˜ï¼›è¯·é˜…è¯» man:sway-bar[5] æ‰‹å†Œé¡µé¢è·å–æ›´å¤šä¿¡æ¯ã€‚é»˜è®¤é…ç½®åœ¨å³ä¸Šè§’æ·»åŠ äº†æ—¥æœŸå’Œæ—¶é—´ã€‚åœ¨é…ç½®æ–‡ä»¶çš„ `Bar` éƒ¨åˆ†ä¸­å¯ä»¥æ‰¾åˆ°ä¸€ä¸ªç¤ºä¾‹ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œé…ç½®ä¸åŒ…æ‹¬åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¹‹å¤–é”å®šå±å¹•ï¼Œå¯ç”¨é”å®šè®¡æ—¶å™¨ã€‚åˆ›å»ºä¸€ä¸ªé”å®šé”®ç»‘å®šéœ€è¦åœ¨ `Key bindings` éƒ¨åˆ†æ·»åŠ ä»¥ä¸‹è¡Œï¼šÚµNow the screen may be locked using the combination of holding the Windows logo key, pressing and holding shift, and finally pressing return.  When Sway is installed, whether from a package or the FreeBSD Ports Collection, a default file for [.filename]#pam.d# was installed.  The default configuration should be acceptable for most users, but more advanced options are available.  Read through the PAM documentation for more information.Ú‰ç°åœ¨å¯ä»¥ä½¿ç”¨æŒ‰ä½ Windows å¾½æ ‡é”®ã€æŒ‰ä½ Shift é”®ï¼Œæœ€åæŒ‰ä¸‹å›è½¦é”®çš„ç»„åˆæ¥é”å®šå±å¹•ã€‚å½“å®‰è£…äº† Swayï¼Œæ— è®ºæ˜¯ä»è½¯ä»¶åŒ…è¿˜æ˜¯ FreeBSD Ports Collection å®‰è£…çš„ï¼Œéƒ½ä¼šå®‰è£…ä¸€ä¸ªé»˜è®¤çš„ [.filename]#pam.d# æ–‡ä»¶ã€‚é»˜è®¤é…ç½®å¯¹å¤§å¤šæ•°ç”¨æˆ·æ¥è¯´åº”è¯¥æ˜¯å¯æ¥å—çš„ï¼Œä½†ä¹Ÿæä¾›äº†æ›´é«˜çº§çš„é€‰é¡¹ã€‚è¯·é˜…è¯» PAM æ–‡æ¡£ä»¥è·å–æ›´å¤šä¿¡æ¯ã€‚Ú²Finally, to exit Sway and return to the shell, hold the Windows logo key, the shift key, and press the kbd:[e] key.  A prompt will be displayed with an option to exit Sway.  During migration, Sway can be started through a terminal emulator on an X11 desktop such as Plasma.  This makes testing different changes and key bindings a little easier prior to fully migrating to this compositor.  To start Sway, issue the following command:Ú¹æœ€åï¼Œè¦é€€å‡º Sway å¹¶è¿”å›åˆ° shellï¼Œè¯·æŒ‰ä½ Windows å¾½æ ‡é”®å’Œ Shift é”®ï¼Œç„¶åæŒ‰ä¸‹é”®ç›˜ä¸Šçš„ [e] é”®ã€‚ä¼šæ˜¾ç¤ºä¸€ä¸ªæç¤ºï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªé€‰é¡¹å¯ä»¥é€€å‡º Swayã€‚åœ¨è¿ç§»æœŸé—´ï¼Œå¯ä»¥é€šè¿‡åœ¨è¯¸å¦‚ Plasma ä¹‹ç±»çš„ X11 æ¡Œé¢ä¸Šçš„ç»ˆç«¯æ¨¡æ‹Ÿå™¨ä¸­å¯åŠ¨ Sway ã€‚è¿™ä½¿å¾—åœ¨å®Œå…¨è¿ç§»åˆ°è¿™ä¸ªåˆæˆå™¨ä¹‹å‰ï¼Œæµ‹è¯•ä¸åŒçš„æ›´æ”¹å’Œé”®ç»‘å®šå˜å¾—æ›´åŠ å®¹æ˜“ã€‚è¦å¯åŠ¨ Sway ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š®Using Xwayland¯ä½¿ç”¨ XwaylandÙáWhen installing Wayland, the `Xwayland` binary should have been installed unless Wayland was built without X11 support.  If the [.filename]#/usr/local/bin/Xwayland# file does not exist, install it using the following command:Ùâåœ¨å®‰è£… Wayland æ—¶ï¼Œé™¤é Wayland æ˜¯æ²¡æœ‰æ„å»º X11 æ”¯æŒçš„ï¼Œå¦åˆ™åº”è¯¥å·²ç»å®‰è£…äº† `Xwayland` äºŒè¿›åˆ¶æ–‡ä»¶ã€‚å¦‚æœ [.filename]#/usr/local/bin/Xwayland# æ–‡ä»¶ä¸å­˜åœ¨ï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿›è¡Œå®‰è£…ï¼šÙ¯The development version of Xwayland is recommended and was most likely installed with the Wayland package.  Each compositor has a method of enabling or disabling this feature.Ù æ¨èä½¿ç”¨ Xwayland çš„å¼€å‘ç‰ˆæœ¬ï¼Œå¹¶ä¸”å¾ˆå¯èƒ½å·²ç»éš Wayland è½¯ä»¶åŒ…ä¸€èµ·å®‰è£…ã€‚æ¯ä¸ªåˆæˆå™¨éƒ½æœ‰ä¸€ç§å¯ç”¨æˆ–ç¦ç”¨æ­¤åŠŸèƒ½çš„æ–¹æ³•ã€‚Ù¡Once `Xwayland` has been installed, configure it within the chosen compositor.  For Wayfire, the following line is required in the [.filename]#wayfire.ini# file:Ùä¸€æ—¦å®‰è£…äº† `Xwayland`ï¼Œè¯·åœ¨æ‰€é€‰çš„åˆæˆå™¨ä¸­è¿›è¡Œé…ç½®ã€‚å¯¹äº Wayfire æ¥è¯´ï¼Œåœ¨ [.filename]#wayfire.ini# æ–‡ä»¶ä¸­éœ€è¦æ·»åŠ ä»¥ä¸‹è¡Œï¼šÙ¿For the Sway compositor, `Xwayland` should be enabled by default.  Even so, it is recommened to manually add a configuration line in the [.filename]#~/.config/sway/config# like the following:Ù›å¯¹äº Sway åˆæˆå™¨ï¼Œé»˜è®¤æƒ…å†µä¸‹åº”å¯ç”¨ `Xwayland`ã€‚å³ä¾¿å¦‚æ­¤ï¼Œå»ºè®®åœ¨ [.filename]#~/.config/sway/config# ä¸­æ‰‹åŠ¨æ·»åŠ ä»¥ä¸‹é…ç½®è¡Œï¼š°xwayland enable
±å¯ç”¨ XWayland 
ÙÎFinally, for Hikari, no changes are needed.  Support for `Xwayland` is build in by default.  To disable that support, rebuild the package from the ports collection and disable Xwayland support at that time.Ùèæœ€åï¼Œå¯¹äº Hikari æ¥è¯´ï¼Œä¸éœ€è¦è¿›è¡Œä»»ä½•æ›´æ”¹ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå·²ç»å†…ç½®äº†å¯¹ `Xwayland` çš„æ”¯æŒã€‚è¦ç¦ç”¨è¯¥æ”¯æŒï¼Œå¯ä»¥ä» ports é›†åˆä¸­é‡æ–°æ„å»ºè¯¥è½¯ä»¶åŒ…ï¼Œå¹¶åœ¨é‚£æ—¶ç¦ç”¨ Xwayland æ”¯æŒã€‚ÚRAfter these changes are made, start the compositor at the command line and execute a terminal from the key bindings.  Within this terminal, issue the `env` command and search for the `DISPLAY` variables.  If the compositor was able to properly start the Xwayland X server, these environment variables should look similar to the following:Úåœ¨è¿›è¡Œè¿™äº›æ›´æ”¹åï¼Œé€šè¿‡å‘½ä»¤è¡Œå¯åŠ¨åˆæˆå™¨ï¼Œå¹¶ä»é”®ç»‘å®šä¸­æ‰§è¡Œä¸€ä¸ªç»ˆç«¯ã€‚åœ¨è¿™ä¸ªç»ˆç«¯ä¸­ï¼Œè¾“å…¥ `env` å‘½ä»¤å¹¶æœç´¢ `DISPLAY` å˜é‡ã€‚å¦‚æœåˆæˆå™¨èƒ½å¤Ÿæ­£ç¡®å¯åŠ¨ Xwayland X æœåŠ¡å™¨ï¼Œè¿™äº›ç¯å¢ƒå˜é‡åº”è¯¥ç±»ä¼¼äºä»¥ä¸‹å†…å®¹ï¼šÚàIn this output, there is a default Wayland display and a display set for the Xwayland server.  Another method to verify that `Xwayland` is functioning properly is to use install and test the small package:[x11/eyes] and check the output.  If the `xeyes` application starts and the eyes follow the mouse pointer, Xwayland is functioning properly.  If an error such as the following is displayed, something happened during the `Xwayland` intitialization and it may need reinstalled:ÚÔåœ¨è¿™ä¸ªè¾“å‡ºä¸­ï¼Œæœ‰ä¸€ä¸ªé»˜è®¤çš„ Wayland æ˜¾ç¤ºå™¨å’Œä¸€ä¸ªä¸º Xwayland æœåŠ¡å™¨è®¾ç½®çš„æ˜¾ç¤ºå™¨ã€‚éªŒè¯ `Xwayland` æ˜¯å¦æ­£å¸¸å·¥ä½œçš„å¦ä¸€ç§æ–¹æ³•æ˜¯å®‰è£…å’Œæµ‹è¯•ä¸€ä¸ªå°åŒ… package:[x11/eyes]ï¼Œå¹¶æ£€æŸ¥è¾“å‡ºã€‚å¦‚æœ `xeyes` åº”ç”¨ç¨‹åºå¯åŠ¨å¹¶ä¸”çœ¼ç›è·Ÿéšé¼ æ ‡æŒ‡é’ˆç§»åŠ¨ï¼Œé‚£ä¹ˆ Xwayland æ­£å¸¸å·¥ä½œã€‚å¦‚æœæ˜¾ç¤ºäº†ä»¥ä¸‹é”™è¯¯æˆ–ç±»ä¼¼é”™è¯¯ï¼Œåˆ™åœ¨ `Xwayland` åˆå§‹åŒ–è¿‡ç¨‹ä¸­å‘ç”Ÿäº†æŸäº›é—®é¢˜ï¼Œå¯èƒ½éœ€è¦é‡æ–°å®‰è£…ï¼šÙÄA security feature of Wayland is that, without running an X server, there is not another network listener.  Once `Xwayland` is enabled, this security feature is no longer applicable to the system.ÙµWayland çš„ä¸€ä¸ªå®‰å…¨ç‰¹æ€§æ˜¯ï¼Œåœ¨æ²¡æœ‰è¿è¡Œ X æœåŠ¡å™¨çš„æƒ…å†µä¸‹ï¼Œæ²¡æœ‰å…¶ä»–ç½‘ç»œç›‘å¬å™¨ã€‚ä¸€æ—¦å¯ç”¨äº† `Xwayland`ï¼Œè¿™ä¸ªå®‰å…¨ç‰¹æ€§å¯¹ç³»ç»Ÿå°±ä¸å†é€‚ç”¨ã€‚Ù¦For some compositors, such as Wayfire, `Xwayland` may not start properly.  As such, `env` will show the following information for the `DISPLAY` environment variables:Ùå¯¹äºä¸€äº›å¤åˆå™¨ï¼Œæ¯”å¦‚ Wayfireï¼Œ`Xwayland` å¯èƒ½æ— æ³•æ­£å¸¸å¯åŠ¨ã€‚å› æ­¤ï¼Œ`env` å°†æ˜¾ç¤º `DISPLAY` ç¯å¢ƒå˜é‡çš„ä»¥ä¸‹ä¿¡æ¯ï¼šÚ*Even though `Xwayfire` was installed and configured, X11 applications will not start giving a display issue.  To work around this, verify that there is already an instance of `Xwayland` using a UNIX socket through these two methods.  First, check the output from `sockstat` and search for X11-unix:Ú"å°½ç®¡å·²ç»å®‰è£…å’Œé…ç½®äº† `Xwayfire`ï¼Œä½† X11 åº”ç”¨ç¨‹åºæ— æ³•å¯åŠ¨ï¼Œå‡ºç°æ˜¾ç¤ºé—®é¢˜ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹æ³•éªŒè¯æ˜¯å¦å·²ç»å­˜åœ¨ä¸€ä¸ªä½¿ç”¨ UNIX å¥—æ¥å­—çš„ `Xwayland` å®ä¾‹ã€‚é¦–å…ˆï¼Œæ£€æŸ¥ `sockstat` çš„è¾“å‡ºï¼Œå¹¶æœç´¢ X11-unix:Ù?There should be something similar to the following information:Ù'åº”è¯¥æœ‰ç±»ä¼¼ä»¥ä¸‹ä¿¡æ¯çš„å†…å®¹ï¼šÙ±This suggests the existence of an X11 socket.  This can be further verified by attempting to execute `Xwayland` manually within a terminal emulator running under the compositor:Ùè¿™è¡¨æ˜å­˜åœ¨ä¸€ä¸ª X11 å¥—æ¥å­—ã€‚å¯ä»¥é€šè¿‡åœ¨åˆæˆå™¨ä¸‹è¿è¡Œçš„ç»ˆç«¯æ¨¡æ‹Ÿå™¨ä¸­å°è¯•æ‰‹åŠ¨æ‰§è¡Œ `Xwayland` æ¥è¿›ä¸€æ­¥éªŒè¯ï¼šÙ[If an X11 socket is already available, the following error should be presented to the user:ÙMå¦‚æœå·²ç»å­˜åœ¨ä¸€ä¸ª X11 å¥—æ¥å­—ï¼Œåˆ™åº”å‘ç”¨æˆ·æ˜¾ç¤ºä»¥ä¸‹é”™è¯¯ï¼šÚLSince there is an active X display available using display zero, the environment variable was just set improperly, to fix this, change the `DISPLAY` environment variable to `:0` and attempt to execute the application again.  The following example uses package:mail/claws-mail[] as the application which needs the `Xwayland` service:Ú,ç”±äºå­˜åœ¨ä¸€ä¸ªå¯ç”¨çš„æ´»åŠ¨ X æ˜¾ç¤ºå™¨ï¼Œä½¿ç”¨æ˜¾ç¤ºå™¨é›¶ï¼Œç¯å¢ƒå˜é‡è®¾ç½®ä¸æ­£ç¡®ï¼Œè¦ä¿®å¤è¿™ä¸ªé—®é¢˜ï¼Œå°† `DISPLAY` ç¯å¢ƒå˜é‡æ›´æ”¹ä¸º `:0`ï¼Œç„¶åå°è¯•å†æ¬¡æ‰§è¡Œåº”ç”¨ç¨‹åºã€‚ä»¥ä¸‹ç¤ºä¾‹ä½¿ç”¨ `package:mail/claws-mail[]` ä½œä¸ºéœ€è¦ `Xwayland` æœåŠ¡çš„åº”ç”¨ç¨‹åºï¼šÙxAfter this change, the package:mail/claws-mail[] application should now start using `Xwayland` and function as expected.Ùtåœ¨è¿™ä¸ªæ”¹å˜ä¹‹åï¼Œpackage:mail/claws-mail[] åº”ç”¨ç¨‹åºç°åœ¨åº”è¯¥å¼€å§‹ä½¿ç”¨ `Xwayland` å¹¶æ­£å¸¸å·¥ä½œã€‚¸Remote Desktop Using VNCÙ#ä½¿ç”¨ VNC è¿›è¡Œè¿œç¨‹æ¡Œé¢è®¿é—®Ú{Earlier in this document it was noted that Wayland does not provide the same X server style access as Xorg provides.  Instead, users are free to pick and choose a remote desktop protocol such as RDP or VNC.  The FreeBSD Ports collection includes the `wayvnc`, which will support wlroots based compositors such as the ones discussed here.  This application may be installed using:ÚXåœ¨æœ¬æ–‡æ¡£ä¸­æ—©äº›æ—¶å€™å·²ç»æŒ‡å‡ºï¼Œ Wayland ä¸åƒ Xorg æä¾›ç›¸åŒçš„ X æœåŠ¡å™¨æ ·å¼è®¿é—®ã€‚ç›¸åï¼Œç”¨æˆ·å¯ä»¥è‡ªç”±é€‰æ‹©è¿œç¨‹æ¡Œé¢åè®®ï¼Œå¦‚ RDP æˆ– VNCã€‚FreeBSD Ports é›†åˆä¸­åŒ…æ‹¬ `wayvnc`ï¼Œå®ƒå°†æ”¯æŒåŸºäº wlroots çš„åˆæˆå™¨ï¼Œä¾‹å¦‚åœ¨è¿™é‡Œè®¨è®ºçš„åˆæˆå™¨ã€‚å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å®‰è£…æ­¤åº”ç”¨ç¨‹åºï¼šÙÉUnlike some other packages, `wayvnc` does not come with a configuration file.  Thankfully, the manual page documents the important options and they may be extrapolated into a simple configuration file:Ù´ä¸å…¶ä»–ä¸€äº›è½¯ä»¶åŒ…ä¸åŒï¼Œ`wayvnc` ä¸æä¾›é…ç½®æ–‡ä»¶ã€‚å¹¸è¿çš„æ˜¯ï¼Œæ‰‹å†Œé¡µé¢è®°å½•äº†é‡è¦çš„é€‰é¡¹ï¼Œå¹¶ä¸”å¯ä»¥å°†å®ƒä»¬æ¨å¯¼æˆä¸€ä¸ªç®€å•çš„é…ç½®æ–‡ä»¶ï¼šÚ‚The key files will need to be generated, and it is highly recommended they be used for increased security of the connection.  When invoked, wayvnc will search for the configuration file in [.filename]#~/.config/wayvnc/config#.  This could be overwritten using the `-C configuration_file` option when starting the server.  Thus, to start the `wayvnc` server, issue the following command:Ú@éœ€è¦ç”Ÿæˆå¯†é’¥æ–‡ä»¶ï¼Œå¹¶å¼ºçƒˆå»ºè®®ä½¿ç”¨å®ƒä»¬ä»¥å¢åŠ è¿æ¥çš„å®‰å…¨æ€§ã€‚å½“è°ƒç”¨æ—¶ï¼Œwayvnc å°†åœ¨ [.filename]#~/.config/wayvnc/config# ä¸­æœç´¢é…ç½®æ–‡ä»¶ã€‚å¯ä»¥ä½¿ç”¨ `-C configuration_file` é€‰é¡¹åœ¨å¯åŠ¨æœåŠ¡å™¨æ—¶è¦†ç›–è¯¥æ–‡ä»¶ã€‚å› æ­¤ï¼Œè¦å¯åŠ¨ `wayvnc` æœåŠ¡å™¨ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼šÙîAt the time of this writing, there is no rc.d script to start `wayvnc` on system initialization.  If that functionality is desired, a local startup file will need to be created.  This is probably a feature request for the port maintainer.ÙÆåœ¨æ’°å†™æœ¬æ–‡æ—¶ï¼Œç³»ç»Ÿåˆå§‹åŒ–æ—¶æ²¡æœ‰ rc.d è„šæœ¬æ¥å¯åŠ¨ `wayvnc`ã€‚å¦‚æœéœ€è¦è¿™ä¸ªåŠŸèƒ½ï¼Œéœ€è¦åˆ›å»ºä¸€ä¸ªæœ¬åœ°å¯åŠ¨æ–‡ä»¶ã€‚è¿™å¯èƒ½æ˜¯å¯¹ç«¯å£ç»´æŠ¤è€…çš„ä¸€ä¸ªåŠŸèƒ½è¯·æ±‚ã€‚µWayland Login Manager·Wayland ç™»å½•ç®¡ç†å™¨Ú=While several login managers exist and are slowly migrating to Wayland, one option is the package:x11/ly[] text user interface (TUI) manager.  Needing minimal configuration, `ly` will start Sway, Wayfire, and others by presenting a login window on system initialization.  To install `ly`, issue the following command:ÚHè™½ç„¶å­˜åœ¨å¤šä¸ªç™»å½•ç®¡ç†å™¨ï¼Œå¹¶ä¸”æ­£åœ¨é€æ¸è¿ç§»åˆ° Waylandï¼Œä½†å…¶ä¸­ä¸€ä¸ªé€‰æ‹©æ˜¯ package:x11/ly[] ä¸­çš„æ–‡æœ¬ç”¨æˆ·ç•Œé¢ï¼ˆTUIï¼‰ç®¡ç†å™¨ã€‚`ly` åªéœ€è¦æœ€å°‘çš„é…ç½®ï¼Œå®ƒä¼šåœ¨ç³»ç»Ÿåˆå§‹åŒ–æ—¶æ˜¾ç¤ºä¸€ä¸ªç™»å½•çª—å£æ¥å¯åŠ¨ Swayã€Wayfire ç­‰æ¡Œé¢ç¯å¢ƒã€‚è¦å®‰è£… `ly`ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼šÙ€There will be some configuration hints presented, the import steps are to add the following lines to [.filename]#/etc/gettytab#:Ùmå°†ä¼šæä¾›ä¸€äº›é…ç½®æç¤ºï¼Œå¯¼å…¥æ­¥éª¤æ˜¯å°†ä»¥ä¸‹è¡Œæ·»åŠ åˆ° [.filename]#/etc/gettytab# æ–‡ä»¶ä¸­ï¼šÙUAnd then modify the ttyv1 line in [.filename]#/etc/ttys# to match the following line:ÙRç„¶ååœ¨ [.filename]#/etc/ttys# ä¸­ä¿®æ”¹ ttyv1 è¡Œï¼Œä½¿å…¶ä¸ä»¥ä¸‹è¡ŒåŒ¹é…ï¼šÚAfter a system reboot, a login should appear.  To configure specific settings, such as language and edit [.filename]#/usr/local/etc/ly/config.ini#.  At minimal, this file should have the designated tty that was previously specified in [.filename]#/etc/ttys#.Ùåç³»ç»Ÿé‡æ–°å¯åŠ¨åï¼Œåº”è¯¥å‡ºç°ç™»å½•ç•Œé¢ã€‚è¦é…ç½®ç‰¹å®šçš„è®¾ç½®ï¼Œä¾‹å¦‚è¯­è¨€å’Œç¼–è¾‘ [.filename]#/usr/local/etc/ly/config.ini# ã€‚è‡³å°‘ï¼Œè¿™ä¸ªæ–‡ä»¶åº”è¯¥æœ‰ä¹‹å‰åœ¨ [.filename]#/etc/ttys# ä¸­æŒ‡å®šçš„ç»ˆç«¯ã€‚ÙˆIf setting ttyv0 up as the login terminal, it may be required to press the kbd:[alt] and kbd:[F1] keys to properly see the login window.Ùvå¦‚æœå°† ttyv0 è®¾ç½®ä¸ºç™»å½•ç»ˆç«¯ï¼Œå¯èƒ½éœ€è¦æŒ‰ä¸‹ kbd:[alt] å’Œ kbd:[F1] é”®æ‰èƒ½æ­£ç¡®æ˜¾ç¤ºç™»å½•çª—å£ã€‚ÙwWhen the login window appears, using the left and right arrows will swap through different, supported, window managers.Ùcå½“ç™»å½•çª—å£å‡ºç°æ—¶ï¼Œä½¿ç”¨å·¦å³ç®­å¤´å¯ä»¥åœ¨ä¸åŒæ”¯æŒçš„çª—å£ç®¡ç†å™¨ä¹‹é—´åˆ‡æ¢ã€‚°Useful Utilities¯æœ‰ç”¨çš„å·¥å…·Ú€One useful Wayland utility which all compositors can make use of is the waybar.  While Wayfire does come with a launch menu, an easy-to-use and fast taskbar is a good accessory for any compositor or desktop manager.  A Wayland compatible taskbar that is fast and easy to configure is waybar.  To install the package and a supporting audio control utility, issue the following command:Ú‘æ‰€æœ‰åˆæˆå™¨éƒ½å¯ä»¥ä½¿ç”¨çš„ä¸€ä¸ªæœ‰ç”¨çš„ Wayland å®ç”¨ç¨‹åºæ˜¯ waybarã€‚è™½ç„¶ Wayfire å¸¦æœ‰ä¸€ä¸ªå¯åŠ¨èœå•ï¼Œä½†ä¸€ä¸ªæ˜“äºä½¿ç”¨å’Œå¿«é€Ÿçš„ä»»åŠ¡æ å¯¹äºä»»ä½•åˆæˆå™¨æˆ–æ¡Œé¢ç®¡ç†å™¨æ¥è¯´éƒ½æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é™„ä»¶ã€‚ä¸€ä¸ªå¿«é€Ÿä¸”æ˜“äºé…ç½®çš„ Wayland å…¼å®¹çš„ä»»åŠ¡æ æ˜¯ waybarã€‚è¦å®‰è£…è¯¥è½¯ä»¶åŒ…å’Œä¸€ä¸ªæ”¯æŒéŸ³é¢‘æ§åˆ¶çš„å®ç”¨ç¨‹åºï¼Œè¯·æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼šÙqTo create the configuration directory and copy over a default configuration file, execute the following commands:ÙKè¦åˆ›å»ºé…ç½®ç›®å½•å¹¶å¤åˆ¶é»˜è®¤é…ç½®æ–‡ä»¶ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼šÙµThe `lavalauncher` utility provides a launch bar for various applications.  There is no example configuration file provided with the package, so the following actions must be taken:Ù™`lavalauncher` å®ç”¨ç¨‹åºä¸ºå„ç§åº”ç”¨ç¨‹åºæä¾›äº†ä¸€ä¸ªå¯åŠ¨æ ã€‚è½¯ä»¶åŒ…ä¸­æ²¡æœ‰æä¾›ç¤ºä¾‹é…ç½®æ–‡ä»¶ï¼Œå› æ­¤å¿…é¡»æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼šÙ_An example configuration file that only includes Firefox, and is placed on the right, is below:ÙQä¸‹é¢æ˜¯ä¸€ä¸ªåªåŒ…å« Firefox çš„ç¤ºä¾‹é…ç½®æ–‡ä»¶ï¼Œå¹¶ä¸”æ”¾ç½®åœ¨å³ä¾§ï¼šÙ›This chapter delves into the topic of network configuration and performance, showcasing the robust networking capabilities of the FreeBSD operating system.Ùlæœ¬ç« æ·±å…¥æ¢è®¨äº†ç½‘ç»œé…ç½®å’Œæ€§èƒ½çš„ä¸»é¢˜ï¼Œå±•ç¤ºäº† FreeBSD æ“ä½œç³»ç»Ÿå¼ºå¤§çš„ç½‘ç»œèƒ½åŠ›ã€‚²Chapter 7. Network°ç¬¬ 7 ç«  ç½‘ç»œ§Network¦ç½‘ç»œÚ8This chapter delves into the topic of network configuration and performance, showcasing the robust networking capabilities of the FreeBSD operating system.  Whether working with wired or wireless networks, this chapter provides a comprehensive guide to configuring and optimizing network connectivity in FreeBSD.Ùùæœ¬ç« æ·±å…¥æ¢è®¨äº†ç½‘ç»œé…ç½®å’Œæ€§èƒ½çš„ä¸»é¢˜ï¼Œå±•ç¤ºäº† FreeBSD æ“ä½œç³»ç»Ÿå¼ºå¤§çš„ç½‘ç»œèƒ½åŠ›ã€‚æ— è®ºæ˜¯ä½¿ç”¨æœ‰çº¿ç½‘ç»œè¿˜æ˜¯æ— çº¿ç½‘ç»œï¼Œæœ¬ç« æä¾›äº†ä¸€ä¸ªå…¨é¢çš„æŒ‡å—ï¼Œå¸®åŠ©æ‚¨åœ¨ FreeBSD ä¸­é…ç½®å’Œä¼˜åŒ–ç½‘ç»œè¿æ¥ã€‚Ù¨Before diving into the details, it is beneficial for readers to have a basic understanding of networking concepts such as protocols, network interfaces, and addressing.Ùuåœ¨æ·±å…¥äº†è§£ç»†èŠ‚ä¹‹å‰ï¼Œè¯»è€…å¯¹ç½‘ç»œæ¦‚å¿µå¦‚åè®®ã€ç½‘ç»œæ¥å£å’Œå¯»å€æœ‰åŸºæœ¬çš„äº†è§£æ˜¯æœ‰ç›Šçš„ã€‚´This chapter covers:µæœ¬ç« å†…å®¹åŒ…æ‹¬ï¼šÙ}The ability to configure wired networks in FreeBSD, including network interface setup, addressing, and customization options.Ù`åœ¨ FreeBSD ä¸­é…ç½®æœ‰çº¿ç½‘ç»œçš„èƒ½åŠ›ï¼ŒåŒ…æ‹¬ç½‘ç»œæ¥å£è®¾ç½®ã€å¯»å€å’Œå®šåˆ¶é€‰é¡¹ã€‚Ù˜The skills to configure wireless networks in FreeBSD, encompassing wireless network interface setup, security protocols, and troubleshooting techniques.Ùråœ¨ FreeBSD ä¸­é…ç½®æ— çº¿ç½‘ç»œçš„æŠ€èƒ½ï¼ŒåŒ…æ‹¬æ— çº¿ç½‘ç»œæ¥å£è®¾ç½®ã€å®‰å…¨åè®®å’Œæ•…éšœæ’é™¤æŠ€æœ¯ã€‚ÙWFreeBSD's networking capabilities and its reputation for excellent network performance.ÙGFreeBSD çš„ç½‘ç»œèƒ½åŠ›ä»¥åŠå…¶åœ¨ä¼˜ç§€ç½‘ç»œæ€§èƒ½æ–¹é¢çš„å£°èª‰ã€‚ÙˆAn understanding of various network services and protocols supported by FreeBSD, with configuration instructions for DNS, DHCP and more.Ùfå¯¹äº FreeBSD æ”¯æŒçš„å„ç§ç½‘ç»œæœåŠ¡å’Œåè®®çš„ç†è§£ï¼ŒåŒ…æ‹¬ DNSã€DHCP ç­‰çš„é…ç½®è¯´æ˜ã€‚ÙŒMore information about how to make advanced network configurations in crossref:advanced-networking[advanced-networking,Advanced Networking].Ù‚æœ‰å…³å¦‚ä½•è¿›è¡Œé«˜çº§ç½‘ç»œé…ç½®çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜… crossref:advanced-networking[advanced-networking, é«˜çº§ç½‘ç»œ]ã€‚¶Setting up the Network¬è®¾ç½®ç½‘ç»œÙ¹Setting up a wired or wireless connection is a common task for a FreeBSD user.  This section will show how to identify the wired and wireless network adapters and how to configure them.Ùœä¸º FreeBSD ç”¨æˆ·è®¾ç½®æœ‰çº¿æˆ–æ— çº¿è¿æ¥æ˜¯ä¸€ä¸ªå¸¸è§çš„ä»»åŠ¡ã€‚æœ¬èŠ‚å°†å±•ç¤ºå¦‚ä½•è¯†åˆ«æœ‰çº¿å’Œæ— çº¿ç½‘ç»œé€‚é…å™¨ä»¥åŠå¦‚ä½•é…ç½®å®ƒä»¬ã€‚ÙZBefore starting with the configuration it is necessary to know the following network data:Ù9åœ¨å¼€å§‹é…ç½®ä¹‹å‰ï¼Œéœ€è¦äº†è§£ä»¥ä¸‹ç½‘ç»œæ•°æ®ï¼š·If the network has DHCP·å¦‚æœç½‘ç»œä½¿ç”¨ DHCPÙ;If the network does not have DHCP, the static IP to be usedÙ0å¦‚æœç½‘ç»œæ²¡æœ‰ DHCPï¼Œåˆ™ä½¿ç”¨é™æ€ IP ã€‚«The netmask¬å­ç½‘æ©ç Ù%The IP address of the default gateway¹é»˜è®¤ç½‘å…³çš„ IP åœ°å€ÙZThe network connection may have been configured at installation time by man:bsdinstall[8].ÙCç½‘ç»œè¿æ¥å¯èƒ½åœ¨å®‰è£…æ—¶ç”± man:bsdinstall[8] è¿›è¡Œé…ç½®ã€‚¹Identify Network Adaptersµè¯†åˆ«ç½‘ç»œé€‚é…å™¨ÙñFreeBSD supports a wide variety of network adapters for both wired and wireless networks.  Check the Hardware Compatibility List for the used link:https://www.freebsd.org/releases/[FreeBSD release] to see if the network adapter is supported.ÙÖFreeBSD æ”¯æŒå„ç§æœ‰çº¿å’Œæ— çº¿ç½‘ç»œé€‚é…å™¨ã€‚è¯·æŸ¥çœ‹æ‰€ä½¿ç”¨çš„ FreeBSD ç‰ˆæœ¬çš„ç¡¬ä»¶å…¼å®¹æ€§åˆ—è¡¨ link:https://www.freebsd.org/releases/[FreeBSD release]ï¼Œä»¥æŸ¥çœ‹ç½‘ç»œé€‚é…å™¨æ˜¯å¦å—æ”¯æŒã€‚ÙMTo get the network adapters used by our system execute the following command:ÙHè¦è·å–æˆ‘ä»¬ç³»ç»Ÿä½¿ç”¨çš„ç½‘ç»œé€‚é…å™¨ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼šÙ‚The text before the '@' symbol is the name of the driver controlling the device.  In this case these are man:em[4] and man:iwn[4].Ùåœ¨ '@' ç¬¦å·ä¹‹å‰çš„æ–‡æœ¬æ˜¯æ§åˆ¶è®¾å¤‡çš„é©±åŠ¨ç¨‹åºçš„åç§°ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒä»¬æ˜¯ man:em[4] å’Œ man:iwn[4]ã€‚¼Shows the name of the vendor¸æ˜¾ç¤ºä¾›åº”å•†çš„åç§°¼Shows the name of the deviceµæ˜¾ç¤ºè®¾å¤‡çš„åç§°ÙhIt is only necessary to load the network interface card module if FreeBSD has not detected it correctly.ÙWåªæœ‰åœ¨ FreeBSD æ²¡æœ‰æ­£ç¡®æ£€æµ‹åˆ°ç½‘ç»œæ¥å£å¡æ—¶ï¼Œæ‰éœ€è¦åŠ è½½è¯¥æ¨¡å—ã€‚ÙJFor example, to load the man:alc[4] module, execute the following command:Ù?ä¾‹å¦‚ï¼Œè¦åŠ è½½ man:alc[4] æ¨¡å—ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼šÙwAlternatively, to load the driver as a module at boot time, place the following line in [.filename]#/boot/loader.conf#:Ùwæˆ–è€…ï¼Œè¦åœ¨å¯åŠ¨æ—¶å°†é©±åŠ¨ç¨‹åºåŠ è½½ä¸ºæ¨¡å—ï¼Œè¯·å°†ä»¥ä¸‹è¡Œæ”¾ç½®åœ¨ [.filename]#/boot/loader.conf# ä¸­ï¼š®Wired Networks¬æœ‰çº¿ç½‘ç»œÚOnce the right driver is loaded the network adapter needs to be configured.  FreeBSD uses the driver name followed by a unit number to name the network interface adapter.  The unit number represents the order in which the adapter is detected at boot time, or is later discovered.Ùşä¸€æ—¦æ­£ç¡®çš„é©±åŠ¨ç¨‹åºåŠ è½½å®Œæˆï¼Œéœ€è¦é…ç½®ç½‘ç»œé€‚é…å™¨ã€‚FreeBSD ä½¿ç”¨é©±åŠ¨ç¨‹åºåç§°åè·Ÿä¸€ä¸ªå•å…ƒå·æ¥å‘½åç½‘ç»œæ¥å£é€‚é…å™¨ã€‚å•å…ƒå·è¡¨ç¤ºé€‚é…å™¨åœ¨å¼•å¯¼æ—¶è¢«æ£€æµ‹åˆ°çš„é¡ºåºï¼Œæˆ–è€…æ˜¯ç¨åè¢«å‘ç°çš„é¡ºåºã€‚ÙfFor example, `em0` is the first network interface card (NIC) on the system using the man:em[4] driver.Ù_ä¾‹å¦‚ï¼Œ`em0` æ˜¯ç³»ç»Ÿä¸Šä½¿ç”¨ man:em[4] é©±åŠ¨ç¨‹åºçš„ç¬¬ä¸€ä¸ªç½‘ç»œæ¥å£å¡ï¼ˆNICï¼‰ã€‚ÙLTo display the network interface configuration, enter the following command:Ù6è¦æ˜¾ç¤ºç½‘ç»œæ¥å£é…ç½®ï¼Œè¯·è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼šÙ6In this example, the following devices were displayed:Ù-åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæ˜¾ç¤ºäº†ä»¥ä¸‹è®¾å¤‡ï¼š¾`em0`: The Ethernet interface.º`em0`ï¼šä»¥å¤ªç½‘æ¥å£ã€‚Ù³`lo0`: The loop interface is a software loopback mechanism which may be used for performance analysis, software testing, and/or local communication. More information in man:lo[4].Ù“`lo0`ï¼šå›ç¯æ¥å£æ˜¯ä¸€ç§è½¯ä»¶ç¯å›æœºåˆ¶ï¼Œå¯ç”¨äºæ€§èƒ½åˆ†æã€è½¯ä»¶æµ‹è¯•æˆ–æœ¬åœ°é€šä¿¡ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜… man:lo[4]ã€‚Ù/The example shows that `em0` is up and running.Ù1è¿™ä¸ªä¾‹å­æ˜¾ç¤º `em0` å·²ç»å¯åŠ¨å¹¶è¿è¡Œã€‚·The key indicators are:µå…³é”®æŒ‡æ ‡åŒ…æ‹¬ï¼šÙ6`UP` means that the interface is configured and ready.Ù,`UP` è¡¨ç¤ºæ¥å£å·²é…ç½®å¹¶å‡†å¤‡å°±ç»ªã€‚ÙDThe interface has an IPv4 Internet (`inet`) address, `192.168.1.19`.ÙIè¯¥æ¥å£å…·æœ‰ä¸€ä¸ª IPv4 Internetï¼ˆ`inet`ï¼‰åœ°å€ï¼Œ`192.168.1.19`ã€‚ÙUThe interface has an IPv6 Internet (`inet6`) address, `fe80::21f:16ff:fe0f:275a%em0`.Ù[è¯¥æ¥å£å…·æœ‰ä¸€ä¸ª IPv6 Internetï¼ˆ`inet6`ï¼‰åœ°å€ï¼Œ`fe80::21f:16ff:fe0f:275a%em0` ã€‚ÙZIt has a valid subnet mask (`netmask`), where `0xffffff00` is the same as `255.255.255.0`.Ùaå®ƒå…·æœ‰æœ‰æ•ˆçš„å­ç½‘æ©ç ï¼ˆ`netmask`ï¼‰ï¼Œå…¶ä¸­ `0xffffff00` ä¸ `255.255.255.0` ç›¸åŒã€‚Ù2It has a valid broadcast address, `192.168.1.255`.Ù3å®ƒå…·æœ‰æœ‰æ•ˆçš„å¹¿æ’­åœ°å€ï¼Œ`192.168.1.255`ã€‚ÙBThe MAC address of the interface (`ether`) is `00:1f:16:0f:27:5a`.Ù;æ¥å£ï¼ˆ`ether`ï¼‰çš„ MAC åœ°å€æ˜¯ `00:1f:16:0f:27:5a`ã€‚ÙoThe physical media selection is on autoselection mode (`media: Ethernet autoselect (1000baseT <full-duplex>)`).Ùiç‰©ç†åª’ä½“é€‰æ‹©å¤„äºè‡ªåŠ¨é€‰æ‹©æ¨¡å¼ï¼ˆ`media: Ethernet autoselect (1000baseT <full-duplex>)`ï¼‰ã€‚ÙÍThe status of the link (`status`) is `active`, indicating that the carrier signal is detected. For `em0`, the `status: no carrier` status is normal when an Ethernet cable is not plugged into the interface.Ùªé“¾æ¥çš„çŠ¶æ€ï¼ˆ`status`ï¼‰ä¸º `active`ï¼Œè¡¨ç¤ºæ£€æµ‹åˆ°è½½æ³¢ä¿¡å·ã€‚å¯¹äº `em0`ï¼Œå½“ä»¥å¤ªç½‘ç”µç¼†æœªæ’å…¥æ¥å£æ—¶ï¼Œ`status: no carrier` çŠ¶æ€æ˜¯æ­£å¸¸çš„ã€‚Ù…If the man:ifconfig[8] output had shown something similar to the next output it would indicate the interface has not been configured:Ùnå¦‚æœ man:ifconfig[8] å‘½ä»¤çš„è¾“å‡ºç»“æœä¸ä¸‹é¢çš„è¾“å‡ºç»“æœç±»ä¼¼ï¼Œé‚£ä¹ˆè¯´æ˜æ¥å£å°šæœªé…ç½®ï¼š¿Configuring Static IPv4 Address¸é…ç½®é™æ€ IPv4 åœ°å€ÙWThis section provides a guide to configuring a static IPv4 address on a FreeBSD system.ÙHæœ¬èŠ‚æä¾›äº†åœ¨ FreeBSD ç³»ç»Ÿä¸Šé…ç½®é™æ€ IPv4 åœ°å€çš„æŒ‡å—ã€‚ÙÍThe network interface card configuration can be performed from the command line with man:ifconfig[8] but will not persist after a reboot unless the configuration is also added to [.filename]#/etc/rc.conf#.Ùªå¯ä»¥ä½¿ç”¨å‘½ä»¤è¡Œçš„ man:ifconfig[8] æ¥é…ç½®ç½‘ç»œæ¥å£å¡ï¼Œä½†æ˜¯å¦‚æœä¸å°†é…ç½®æ·»åŠ åˆ° [.filename]#/etc/rc.conf# ä¸­ï¼Œé…ç½®åœ¨é‡å¯åå°†ä¸ä¼šä¿ç•™ã€‚ÙÙIf the network was configured during installation by man:bsdinstall[8], some entries for the network interface card (NICs) may be already present.  Double check [.filename]#/etc/rc.conf# before executing man:sysrc[8].ÙÎå¦‚æœç½‘ç»œåœ¨å®‰è£…è¿‡ç¨‹ä¸­ç”± man:bsdinstall[8] è¿›è¡Œé…ç½®ï¼Œåˆ™å¯èƒ½å·²ç»å­˜åœ¨ä¸€äº›ç½‘ç»œæ¥å£å¡ï¼ˆNICï¼‰çš„æ¡ç›®ã€‚åœ¨æ‰§è¡Œ man:sysrc[8] ä¹‹å‰ï¼Œè¯·ä»”ç»†æ£€æŸ¥ [.filename]#/etc/rc.conf#ã€‚Ù:The IP address can be set executing the following command:Ù4å¯ä»¥é€šè¿‡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ¥è®¾ç½® IP åœ°å€ï¼šÙHTo make the change persist across reboots execute the following command:ÙEè¦ä½¿æ›´æ”¹åœ¨é‡æ–°å¯åŠ¨åä¿æŒç”Ÿæ•ˆï¼Œè¯·æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼šÙ7Add the default router executing the following command:Ù*æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ·»åŠ é»˜è®¤è·¯ç”±å™¨ï¼šÙ5Add the DNS records to [.filename]#/etc/resolv.conf#:Ù7å°† DNS è®°å½•æ·»åŠ åˆ° [/etc/resolv.conf] æ–‡ä»¶ä¸­ï¼šÙCThen restart `netif` and `routing` executing the following command:Ù=ç„¶åæ‰§è¡Œä»¥ä¸‹å‘½ä»¤é‡æ–°å¯åŠ¨ `netif` å’Œ `routing`ï¼šÙ/The connection can be tested using man:ping[8]:Ù+å¯ä»¥ä½¿ç”¨ man:ping[8] æ¥æµ‹è¯•è¿æ¥ã€‚Ù Configuring Dynamic IPv4 Address¸é…ç½®åŠ¨æ€ IPv4 åœ°å€ÙëIf the network has a DHCP server, it is very easy to configure the network interface to use DHCP.  FreeBSD uses man:dhclient[8] as the DHCP client.  man:dhclient[8] will automatically provide the IP, the netmask and the default router.ÙÙå¦‚æœç½‘ç»œæœ‰ä¸€ä¸ª DHCP æœåŠ¡å™¨ï¼Œé…ç½®ç½‘ç»œæ¥å£ä½¿ç”¨ DHCP éå¸¸ç®€å•ã€‚FreeBSD ä½¿ç”¨ man:dhclient[8] ä½œä¸º DHCP å®¢æˆ·ç«¯ã€‚ man:dhclient[8] ä¼šè‡ªåŠ¨æä¾› IP åœ°å€ã€å­ç½‘æ©ç å’Œé»˜è®¤è·¯ç”±å™¨ã€‚ÙCTo make the interface work with DHCP execute the following command:Ù<è¦ä½¿æ¥å£ä¸ DHCP é…åˆå·¥ä½œï¼Œè¯·æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼šÙFman:dhclient[8] can be used manually by running the following command:Ù=man:dhclient[8] å¯ä»¥é€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤æ‰‹åŠ¨ä½¿ç”¨ï¼šÙVIn this way it can be verified that the address assignment using DHCP works correctly.ÙQé€šè¿‡è¿™ç§æ–¹å¼å¯ä»¥éªŒè¯ä½¿ç”¨ DHCP è¿›è¡Œåœ°å€åˆ†é…æ˜¯å¦æ­£å¸¸å·¥ä½œã€‚Ù²man:dhclient[8] client can be started in background.  This can cause trouble with applications depending on a working network, but it will provide a faster startup in many cases.Ùµman:dhclient[8] å®¢æˆ·ç«¯å¯ä»¥åœ¨åå°å¯åŠ¨ã€‚è¿™å¯èƒ½ä¼šå¯¹ä¾èµ–äºæ­£å¸¸å·¥ä½œç½‘ç»œçš„åº”ç”¨ç¨‹åºé€ æˆéº»çƒ¦ï¼Œä½†åœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œå®ƒå°†æä¾›æ›´å¿«çš„å¯åŠ¨é€Ÿåº¦ã€‚ÙGTo execute man:dhclient[8] in background execute the following command:Ù=è¦åœ¨åå°æ‰§è¡Œ man:dhclient[8]ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼šÙ5Then restart `netif` executing the following command:Ù/ç„¶åæ‰§è¡Œä»¥ä¸‹å‘½ä»¤é‡æ–°å¯åŠ¨ `netif`ï¼šÙJIPv6 is the new version of the well-known IP protocol, also known as IPv4.ÙDIPv6 æ˜¯å¹¿ä¸ºäººçŸ¥çš„ IP åè®®çš„æ–°ç‰ˆæœ¬ï¼Œä¹Ÿè¢«ç§°ä¸º IPv4ã€‚ÙHIPv6 provides several advantages over IPv4 as well as many new features:ÙDIPv6 ç›¸æ¯” IPv4 æä¾›äº†å‡ ä¸ªä¼˜åŠ¿ï¼Œä»¥åŠè®¸å¤šæ–°çš„åŠŸèƒ½ï¼šÙ²Its 128-bit address space allows for 340,282,366,920,938,463,463,374,607,431,768,211,456 addresses. This addresses the IPv4 address shortage and eventual IPv4 address exhaustion.Ù¬å®ƒçš„ 128 ä½åœ°å€ç©ºé—´å…è®¸æ‹¥æœ‰ 340,282,366,920,938,463,463,374,607,431,768,211,456 ä¸ªåœ°å€ã€‚è¿™è§£å†³äº† IPv4 åœ°å€çŸ­ç¼ºå’Œæœ€ç»ˆçš„ IPv4 åœ°å€è€—å°½é—®é¢˜ã€‚ÚwRouters only store network aggregation addresses in their routing tables, thus reducing the average space of a routing table to 8192 entries. This addresses the scalability issues associated with IPv4, which required every allocated block of IPv4 addresses to be exchanged between Internet routers, causing their routing tables to become too large to allow efficient routing.ÚGè·¯ç”±å™¨åªåœ¨å…¶è·¯ç”±è¡¨ä¸­å­˜å‚¨ç½‘ç»œèšåˆåœ°å€ï¼Œä»è€Œå°†è·¯ç”±è¡¨çš„å¹³å‡ç©ºé—´å‡å°‘åˆ° 8192 ä¸ªæ¡ç›®ã€‚è¿™è§£å†³äº†ä¸ IPv4 ç›¸å…³çš„å¯æ‰©å±•æ€§é—®é¢˜ï¼Œå› ä¸º IPv4 è¦æ±‚æ¯ä¸ªåˆ†é…çš„ IPv4 åœ°å€å—åœ¨äº’è”ç½‘è·¯ç”±å™¨ä¹‹é—´è¿›è¡Œäº¤æ¢ï¼Œå¯¼è‡´å®ƒä»¬çš„è·¯ç”±è¡¨å˜å¾—è¿‡å¤§ï¼Œæ— æ³•å®ç°é«˜æ•ˆçš„è·¯ç”±ã€‚ÙIAddress autoconfiguration (http://www.ietf.org/rfc/rfc2462.txt[RFC2462]).ÙAåœ°å€è‡ªåŠ¨é…ç½® (http://www.ietf.org/rfc/rfc2462.txt[RFC2462])¾Mandatory multicast addresses.¸å¼ºåˆ¶æ€§å¤šæ’­åœ°å€ã€‚½Built-in IPsec (IP security).Ù å†…ç½® IPsecï¼ˆIP securityï¼‰ã€‚¼Simplified header structure.¸ç®€åŒ–çš„æ ‡é¢˜ç»“æ„ã€‚¶Support for mobile IP.²æ”¯æŒç§»åŠ¨ IPã€‚Ù#IPv6-to-IPv4 transition mechanisms.Ù IPv6 åˆ° IPv4 çš„è¿‡æ¸¡æœºåˆ¶ã€‚ÙƒFreeBSD includes the http://www.kame.net/[KAME project] IPv6 reference implementation and comes with everything needed to use IPv6.ÙuFreeBSD åŒ…å«äº† http://www.kame.net/[KAME é¡¹ç›®] IPv6 å‚è€ƒå®ç°ï¼Œå¹¶ä¸”æä¾›äº†ä½¿ç”¨ IPv6 æ‰€éœ€çš„ä¸€åˆ‡ã€‚Ù<This section focuses on getting IPv6 configured and running.Ù/æœ¬èŠ‚é‡ç‚¹ä»‹ç»å¦‚ä½•é…ç½®å’Œè¿è¡Œ IPv6ã€‚Ù2There are three different types of IPv6 addresses:Ù&IPv6 åœ°å€æœ‰ä¸‰ç§ä¸åŒçš„ç±»å‹ï¼š§Unicast¦å•æ’­ÙUA packet sent to a unicast address arrives at the interface belonging to the address.ÙEå‘é€åˆ°å•æ’­åœ°å€çš„æ•°æ®åŒ…åˆ°è¾¾ä¸è¯¥åœ°å€ç›¸å…³çš„æ¥å£ã€‚§Anycast¦ä»»æ’­ÙøThese addresses are syntactically indistinguishable from unicast addresses but they address a group of interfaces.  The packet destined for an anycast address will arrive at the nearest router interface.  Anycast addresses are only used by routers.ÙÃè¿™äº›åœ°å€åœ¨è¯­æ³•ä¸Šä¸å•æ’­åœ°å€æ— æ³•åŒºåˆ†ï¼Œä½†å®ƒä»¬ç”¨äºå¯»å€ä¸€ç»„æ¥å£ã€‚å‘é€åˆ°ä»»æ’­åœ°å€çš„æ•°æ®åŒ…å°†åˆ°è¾¾æœ€è¿‘çš„è·¯ç”±å™¨æ¥å£ã€‚ä»»æ’­åœ°å€åªç”±è·¯ç”±å™¨ä½¿ç”¨ã€‚©Multicast¦å¤šæ’­ÙÿThese addresses identify a group of interfaces.  A packet destined for a multicast address will arrive at all interfaces belonging to the multicast group.  The IPv4 broadcast address, usually `xxx.xxx.xxx.255`, is expressed by multicast addresses in IPv6.ÙÃè¿™äº›åœ°å€æ ‡è¯†äº†ä¸€ç»„æ¥å£ã€‚å‘é€åˆ°å¤šæ’­åœ°å€çš„æ•°æ®åŒ…å°†åˆ°è¾¾å±äºå¤šæ’­ç»„çš„æ‰€æœ‰æ¥å£ã€‚ IPv4 å¹¿æ’­åœ°å€é€šå¸¸ä¸º `xxx.xxx.xxx.255`ï¼Œåœ¨ IPv6 ä¸­ç”¨å¤šæ’­åœ°å€è¡¨ç¤ºã€‚Ù½When reading an IPv6 address, the canonical form is represented as `x:x:x:x:x:x:x:x`, where each `x` represents a 16 bit hex value.  An example is `FEBC:A574:382B:23C1:AA49:4592:4EFE:9982`.Ùºåœ¨é˜…è¯» IPv6 åœ°å€æ—¶ï¼Œè§„èŒƒå½¢å¼è¡¨ç¤ºä¸º `x:x:x:x:x:x:x:x`ï¼Œå…¶ä¸­æ¯ä¸ª `x` è¡¨ç¤ºä¸€ä¸ª 16 ä½çš„åå…­è¿›åˆ¶å€¼ã€‚ä¸€ä¸ªä¾‹å­æ˜¯ `FEBC:A574:382B:23C1:AA49:4592:4EFE:9982`ã€‚Ú'Often, an address will have long substrings of all zeros.  A `::` (double colon) can be used to replace one substring per address.  Also, up to three leading ``0``s per hex value can be omitted.  For example, `fe80::1` corresponds to the canonical form `fe80:0000:0000:0000:0000:0000:0000:0001`.Úé€šå¸¸ï¼Œä¸€ä¸ªåœ°å€ä¼šæœ‰å¾ˆé•¿çš„å…¨é›¶å­ä¸²ã€‚ä¸€ä¸ª `::`ï¼ˆåŒå†’å·ï¼‰å¯ä»¥ç”¨æ¥æ›¿æ¢åœ°å€ä¸­çš„ä¸€ä¸ªå­ä¸²ã€‚æ­¤å¤–ï¼Œæ¯ä¸ªåå…­è¿›åˆ¶å€¼å‰é¢çš„æœ€å¤šä¸‰ä¸ª `0` å¯ä»¥çœç•¥ã€‚ä¾‹å¦‚ï¼Œ `fe80::1` å¯¹åº”çš„è§„èŒƒå½¢å¼æ˜¯ `fe80:0000:0000:0000:0000:0000:0000:0001`ã€‚ÙıA third form is to write the last 32 bits using the well known IPv4 notation.  For example, `2002::10.0.0.1` corresponds to the hexadecimal canonical representation `2002:0000:0000:0000:0000:0000:0a00:0001`, which in turn is equivalent to `2002::a00:1`.ÙÚç¬¬ä¸‰ç§å½¢å¼æ˜¯ä½¿ç”¨ä¼—æ‰€å‘¨çŸ¥çš„ IPv4 è¡¨ç¤ºæ³•ç¼–å†™æœ€å 32 ä½ã€‚ä¾‹å¦‚ï¼Œ`2002::10.0.0.1` å¯¹åº”äºåå…­è¿›åˆ¶çš„è§„èŒƒè¡¨ç¤º `2002:0000:0000:0000:0000:0000:0a00:0001`ï¼Œè€Œè¿™åˆç­‰åŒäº `2002::a00:1`ã€‚ÙFTo view a FreeBSD system's IPv6 address execute the following command:ÙBè¦æŸ¥çœ‹ FreeBSD ç³»ç»Ÿçš„ IPv6 åœ°å€ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼šÙ«In this example, the `em0` interface is using `fe80::21f:16ff:fe0f:275a%em0`, an auto-configured link-local address which was automatically generated from the MAC address.Ù¨åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ`em0` æ¥å£æ­£åœ¨ä½¿ç”¨ `fe80::21f:16ff:fe0f:275a%em0`ï¼Œè¿™æ˜¯ä¸€ä¸ªè‡ªåŠ¨é…ç½®çš„é“¾è·¯æœ¬åœ°åœ°å€ï¼Œå®ƒæ˜¯æ ¹æ® MAC åœ°å€è‡ªåŠ¨ç”Ÿæˆçš„ã€‚ÙfSome IPv6 addresses are reserved.  A list of reserved addresses can be checked in the following table:ÙTä¸€äº› IPv6 åœ°å€æ˜¯ä¿ç•™åœ°å€ã€‚ä¿ç•™åœ°å€çš„åˆ—è¡¨å¯ä»¥åœ¨ä¸‹è¡¨ä¸­æŸ¥çœ‹ï¼š¿Example IPv6 Reserved Addresses·IPv6 ä¿ç•™åœ°å€ç¤ºä¾‹¬IPv6 address«IPv6 åœ°å€³Prefixlength (Bits)µå‰ç¼€é•¿åº¦ï¼ˆä½ï¼‰¥Notes¦æ³¨é‡Š¤`::`ÙW`::` æ˜¯ asciidoc ä¸­çš„ä¸€ä¸ªç‰¹æ®Šæ ‡è®°ï¼Œç”¨äºè¡¨ç¤ºä¸€ä¸ªå—çº§å…ƒç´ çš„å¼€å§‹ã€‚¨128 bits§128 ä½«unspecified¬æœªæŒ‡å®šçš„Ù Equivalent to `0.0.0.0` in IPv4.Ù(IPv4 ä¸­ç­‰åŒäº `0.0.0.0` çš„åœ°å€ã€‚°loopback address¬ç¯å›åœ°å€Ù"Equivalent to `127.0.0.1` in IPv4.Ù*IPv4 ä¸­ç­‰åŒäº `127.0.0.1` çš„åœ°å€ã€‚§96 bits¦96 ä½­embedded IPv4®åµŒå…¥å¼ IPv4Ù2The lower 32 bits are the compatible IPv4 address.Ù%ä½ 32 ä½æ˜¯å…¼å®¹çš„ IPv4 åœ°å€ã€‚¸IPv4 mapped IPv6 address·IPv4 æ˜ å°„ IPv6 åœ°å€ÙKThe lower 32 bits are the IPv4 address for hosts which do not support IPv6.Ù7ä½ 32 ä½æ˜¯ä¸æ”¯æŒ IPv6 çš„ä¸»æœºçš„ IPv4 åœ°å€ã€‚§10 bits¦10 ä½ªlink-local¬é“¾è·¯æœ¬åœ°Ù%Equivalent to 169.254.0.0/16 in IPv4.Ù4åœ¨ IPv4 ä¸­ï¼Œç­‰åŒäº 169.254.0.0/16 çš„åœ°å€ã€‚¦7 bits¥7 ä½¬unique-local¬å”¯ä¸€æœ¬åœ°ÙtUnique local addresses are intended for local communication and are only routable within a set of cooperating sites.ÙTå”¯ä¸€æœ¬åœ°åœ°å€ç”¨äºæœ¬åœ°é€šä¿¡ï¼Œåªèƒ½åœ¨ä¸€ç»„åˆä½œç«™ç‚¹å†…è¿›è¡Œè·¯ç”±ã€‚¦8 bits¥8 ä½©multicast¦å¤šæ’­¦3 bits¥3 ä½®global unicast¬å…¨å±€å•æ’­ÙUAll global unicast addresses are assigned from this pool. The first 3 bits are `001`.ÙTæ‰€æœ‰å…¨å±€å•æ’­åœ°å€éƒ½æ˜¯ä»è¿™ä¸ªåœ°å€æ± ä¸­åˆ†é…çš„ã€‚å‰ 3 ä½æ˜¯ `001`ã€‚ÙrFor further information on the structure of IPv6 addresses, refer to http://www.ietf.org/rfc/rfc3513.txt[RFC3513].Ùcæœ‰å…³ IPv6 åœ°å€ç»“æ„çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è€ƒ http://www.ietf.org/rfc/rfc3513.txt[RFC3513]ã€‚¿Configuring Static IPv6 Address¸é…ç½®é™æ€ IPv6 åœ°å€ÙsTo configure a FreeBSD system as an IPv6 client with a static IPv6 address it is necessary to set the IPv6 address.Ùfè¦å°† FreeBSD ç³»ç»Ÿé…ç½®ä¸ºå…·æœ‰é™æ€ IPv6 åœ°å€çš„ IPv6 å®¢æˆ·ç«¯ï¼Œéœ€è¦è®¾ç½® IPv6 åœ°å€ã€‚Ù8Execute the following commands to meet the requirements:Ù$æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ä»¥æ»¡è¶³è¦æ±‚ï¼šÙPTo assign a default router, specify its address executing the following command:ÙHè¦åˆ†é…ä¸€ä¸ªé»˜è®¤è·¯ç”±å™¨ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æŒ‡å®šå…¶åœ°å€ï¼šÙ Configuring Dynamic IPv6 Address¸é…ç½®åŠ¨æ€ IPv6 åœ°å€Ù¹If the network has a DHCP server, it is very easy to configure the network interface to use DHCP.  man:dhclient[8] will provide automatically the IP, the netmask and the default router.Ù¡å¦‚æœç½‘ç»œæœ‰ä¸€ä¸ª DHCP æœåŠ¡å™¨ï¼Œé…ç½®ç½‘ç»œæ¥å£ä½¿ç”¨ DHCP éå¸¸ç®€å•ã€‚man:dhclient[8] ä¼šè‡ªåŠ¨æä¾› IP åœ°å€ã€å­ç½‘æ©ç å’Œé»˜è®¤è·¯ç”±å™¨ã€‚Ù0Router Advertisement and Host Auto ConfigurationÙ$è·¯ç”±å™¨é€šå‘Šå’Œä¸»æœºè‡ªåŠ¨é…ç½®Ù~This section demonstrates how to setup man:rtadvd[8] on an IPv6 router to advertise the IPv6 network prefix and default route.Ùnæœ¬èŠ‚æ¼”ç¤ºäº†å¦‚ä½•åœ¨ IPv6 è·¯ç”±å™¨ä¸Šè®¾ç½® man:rtadvd[8]ï¼Œä»¥å¹¿æ’­ IPv6 ç½‘ç»œå‰ç¼€å’Œé»˜è®¤è·¯ç”±ã€‚Ù7To enable man:rtadvd[8], execute the following command:Ù/è¦å¯ç”¨ man:rtadvd[8]ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼šÙ„It is important to specify the interface on which to do IPv6 router advertisement.  For example, to tell man:rtadvd[8] to use `em0`:ÙcæŒ‡å®š IPv6 è·¯ç”±å™¨é€šå‘Šçš„æ¥å£éå¸¸é‡è¦ã€‚ä¾‹å¦‚ï¼Œè¦å‘Šè¯‰ man:rtadvd[8] ä½¿ç”¨ `em0`ï¼šÙ[Next, create the configuration file, [.filename]#/etc/rtadvd.conf# as seen in this example:ÙRæ¥ä¸‹æ¥ï¼ŒæŒ‰ç…§ä»¥ä¸‹ç¤ºä¾‹åˆ›å»ºé…ç½®æ–‡ä»¶ [.filename]#/etc/rtadvd.conf# ï¼šÙhReplace `em0` with the interface to be used and `2001:db8:1f11:246::` with the prefix of the allocation.Ù]å°† `em0` æ›¿æ¢ä¸ºè¦ä½¿ç”¨çš„æ¥å£ï¼Œå°† `2001:db8:1f11:246::` æ›¿æ¢ä¸ºåˆ†é…çš„å‰ç¼€ã€‚ÙyFor a dedicated `/64` subnet, nothing else needs to be changed.  Otherwise, change the `prefixlen#` to the correct value.Ù{å¯¹äºä¸€ä¸ªä¸“ç”¨çš„ `/64` å­ç½‘ï¼Œä¸éœ€è¦åšä»»ä½•å…¶ä»–æ›´æ”¹ã€‚å¦åˆ™ï¼Œè¯·å°† `prefixlen#` æ›´æ”¹ä¸ºæ­£ç¡®çš„å€¼ã€‚½IPv6 and IPv4 Address mappingºIPv6 å’Œ IPv4 åœ°å€æ˜ å°„Ú When IPv6 is enabled on a server, there may be a need to enable IPv4 mapped IPv6 address communication.  This compatibility option allows for IPv4 addresses to be represented as IPv6 addresses.  Permitting IPv6 applications to communicate with IPv4 and vice versa may be a security issue.ÙŞå½“æœåŠ¡å™¨å¯ç”¨ IPv6 æ—¶ï¼Œå¯èƒ½éœ€è¦å¯ç”¨ IPv4 æ˜ å°„çš„ IPv6 åœ°å€é€šä¿¡ã€‚è¿™ä¸ªå…¼å®¹é€‰é¡¹å…è®¸å°† IPv4 åœ°å€è¡¨ç¤ºä¸º IPv6 åœ°å€ã€‚å…è®¸ IPv6 åº”ç”¨ç¨‹åºä¸ IPv4 ç›¸äº’é€šä¿¡å¯èƒ½ä¼šå­˜åœ¨å®‰å…¨é—®é¢˜ã€‚ÚThis option may not be required in most cases and is available only for compatibility.  This option will allow IPv6-only applications to work with IPv4 in a dual stack environment.  This is most useful for third party applications which may not support an IPv6-only environment.Úåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œè¿™ä¸ªé€‰é¡¹å¯èƒ½ä¸æ˜¯å¿…éœ€çš„ï¼Œåªæ˜¯ä¸ºäº†å…¼å®¹æ€§è€Œæä¾›çš„ã€‚è¿™ä¸ªé€‰é¡¹å°†å…è®¸ä»…æ”¯æŒ IPv6 çš„åº”ç”¨ç¨‹åºåœ¨åŒæ ˆç¯å¢ƒä¸­ä¸ IPv4 ä¸€èµ·å·¥ä½œã€‚è¿™å¯¹äºå¯èƒ½ä¸æ”¯æŒä»… IPv6 ç¯å¢ƒçš„ç¬¬ä¸‰æ–¹åº”ç”¨ç¨‹åºéå¸¸æœ‰ç”¨ã€‚Ù5To enable this feature execute the following command:Ù-è¦å¯ç”¨æ­¤åŠŸèƒ½ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š±Wireless Networks¬æ— çº¿ç½‘ç»œÙqMost wireless networks are based on the link:https://en.wikipedia.org/wiki/IEEE_802.11[IEEE(R) 802.11 standards].Ùgå¤§å¤šæ•°æ— çº¿ç½‘ç»œéƒ½åŸºäº link:https://en.wikipedia.org/wiki/IEEE_802.11[IEEE(R) 802.11 æ ‡å‡†]ã€‚Ú+FreeBSD supports networks that operate using link:https://en.wikipedia.org/wiki/IEEE_802.11a-1999[802.11a], link:https://en.wikipedia.org/wiki/IEEE_802.11b-1999[802.11b], link:https://en.wikipedia.org/wiki/IEEE_802.11g-2003[802.11g] and link:https://en.wikipedia.org/wiki/IEEE_802.11n-2009[802.11n].ÚFreeBSD æ”¯æŒä½¿ç”¨ link:https://en.wikipedia.org/wiki/IEEE_802.11a-1999[802.11a]ï¼Œlink:https://en.wikipedia.org/wiki/IEEE_802.11b-1999[802.11b]ï¼Œlink:https://en.wikipedia.org/wiki/IEEE_802.11g-2003[802.11g] å’Œ link:https://en.wikipedia.org/wiki/IEEE_802.11n-2009[802.11n] ç½‘ç»œã€‚Ùrlink:https://en.wikipedia.org/wiki/IEEE_802.11ac-2013[802.11ac] support on FreeBSD is currently under development.Ùtåœ¨ FreeBSD ä¸Šï¼Œç›®å‰æ­£åœ¨å¼€å‘å¯¹ link:https://en.wikipedia.org/wiki/IEEE_802.11ac-2013[802.11ac] çš„æ”¯æŒã€‚ÙûA basic wireless network consists of multiple stations communicating with radios that broadcast in either the 2.4GHz or 5GHz band, though this varies according to the locale and is also changing to enable communication in the 2.3GHz and 4.9GHz ranges.Ùíä¸€ä¸ªåŸºæœ¬çš„æ— çº¿ç½‘ç»œç”±å¤šä¸ªç«™ç‚¹ç»„æˆï¼Œè¿™äº›ç«™ç‚¹ä½¿ç”¨å¹¿æ’­åœ¨ 2.4GHz æˆ– 5GHz é¢‘æ®µè¿›è¡Œé€šä¿¡ï¼Œå°½ç®¡è¿™åœ¨ä¸åŒåœ°åŒºå¯èƒ½æœ‰æ‰€ä¸åŒï¼Œå¹¶ä¸”ä¹Ÿåœ¨ä¸æ–­å˜åŒ–ä»¥å®ç°åœ¨ 2.3GHz å’Œ 4.9GHz èŒƒå›´å†…çš„é€šä¿¡ã€‚Ù<There are three basic steps to configure a wireless network:Ù*é…ç½®æ— çº¿ç½‘ç»œæœ‰ä¸‰ä¸ªåŸºæœ¬æ­¥éª¤ï¼š¿Scan and select an access point¾æ‰«æå¹¶é€‰æ‹©ä¸€ä¸ªæ¥å…¥ç‚¹¸Authenticate the station¯éªŒè¯è¯¥ç«™ç‚¹Ù$Configure an IP address or use DHCP.Ù!é…ç½® IP åœ°å€æˆ–ä½¿ç”¨ DHCPã€‚Ù)The following sections discuss each step.Ù'ä¸‹é¢çš„éƒ¨åˆ†è®¨è®ºäº†æ¯ä¸ªæ­¥éª¤ã€‚Ù,Quick Start to Connect to a Wireless NetworkÙ'è¿æ¥æ— çº¿ç½‘ç»œçš„å¿«é€Ÿå…¥é—¨æŒ‡å—ÙNConnecting FreeBSD to an existing wireless network is a very common situation.ÙKå°† FreeBSD è¿æ¥åˆ°ç°æœ‰çš„æ— çº¿ç½‘ç»œæ˜¯ä¸€ç§éå¸¸å¸¸è§çš„æƒ…å†µã€‚Ù(This procedure shows the steps required:Ù!è¯¥è¿‡ç¨‹æ˜¾ç¤ºæ‰€éœ€çš„æ­¥éª¤ï¼šÙ”The first step will be to obtain the SSID (Service Set Identifier) and PSK (Pre-Shared Key) for the wireless network from the network administrator.Ùtç¬¬ä¸€æ­¥æ˜¯ä»ç½‘ç»œç®¡ç†å‘˜é‚£é‡Œè·å–æ— çº¿ç½‘ç»œçš„ SSID ï¼ˆæœåŠ¡é›†æ ‡è¯†ï¼‰å’Œ PSK ï¼ˆé¢„å…±äº«å¯†é’¥ï¼‰ã€‚Ù‰The second step will be to add an entry for this network to [.filename]#/etc/wpa_supplicant.conf#. If the file does not exist, create it:Ù~ç¬¬äºŒæ­¥æ˜¯å°†æ­¤ç½‘ç»œæ·»åŠ åˆ° [.filename]#/etc/wpa_supplicant.conf# çš„æ¡ç›®ä¸­ã€‚å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œè¯·åˆ›å»ºå®ƒï¼šÙ¹<.> Is the SSID of the wireless network. Replace it with the name of the wireless network.  <.> Is the PSK of the wireless network. Replace it with the password of the wireless network.Ù’<.> æ˜¯æ— çº¿ç½‘ç»œçš„ SSID ã€‚è¯·å°†å…¶æ›¿æ¢ä¸ºæ— çº¿ç½‘ç»œçš„åç§°ã€‚
<.> æ˜¯æ— çº¿ç½‘ç»œçš„ PSK ã€‚è¯·å°†å…¶æ›¿æ¢ä¸ºæ— çº¿ç½‘ç»œçš„å¯†ç ã€‚ÙTThe third step will be to add the network entry to configure the network on startup:Ù<ç¬¬ä¸‰æ­¥æ˜¯æ·»åŠ ç½‘ç»œæ¡ç›®ä»¥åœ¨å¯åŠ¨æ—¶é…ç½®ç½‘ç»œï¼šÙVAnd the last step will be the restart `netif` service executing the following command:ÙEæœ€åä¸€æ­¥å°†æ˜¯é‡æ–°å¯åŠ¨ `netif` æœåŠ¡ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š¼Basic Wireless Configuration²åŸºæœ¬æ— çº¿é…ç½®ÙÀThe first step will be to configure the wireless network card to an interface.  To find out what wireless network cards are in the system check the section <<config-identify-network-adapter>>.Ùç¬¬ä¸€æ­¥æ˜¯å°†æ— çº¿ç½‘ç»œå¡é…ç½®åˆ°ä¸€ä¸ªæ¥å£ä¸Šã€‚è¦æŸ¥çœ‹ç³»ç»Ÿä¸­æœ‰å“ªäº›æ— çº¿ç½‘ç»œå¡ï¼Œè¯·å‚è€ƒ <<config-identify-network-adapter>> éƒ¨åˆ†ã€‚ÙÔSince the regulatory situation is different in various parts of the world, it is necessary to correctly set the domains that apply to your location to have the correct information about what channels can be used.Ù¢ç”±äºä¸–ç•Œå„åœ°çš„ç›‘ç®¡æƒ…å†µä¸åŒï¼Œå› æ­¤æœ‰å¿…è¦æ­£ç¡®è®¾ç½®é€‚ç”¨äºæ‚¨æ‰€åœ¨åœ°åŒºçš„åŸŸåï¼Œä»¥è·å–å…³äºå¯ä»¥ä½¿ç”¨å“ªäº›é¢‘é“çš„æ­£ç¡®ä¿¡æ¯ã€‚Ù~The available region definitions can be found in [.filename]#/etc/regdomain.xml#.  To set the data at runtime, use `ifconfig`:Ù‡å¯ç”¨çš„åŒºåŸŸå®šä¹‰å¯ä»¥åœ¨ [.filename]#/etc/regdomain.xml# ä¸­æ‰¾åˆ°ã€‚è¦åœ¨è¿è¡Œæ—¶è®¾ç½®æ•°æ®ï¼Œè¯·ä½¿ç”¨ `ifconfig` å‘½ä»¤ï¼šÙ=To persist the settings, add it to [.filename]#/etc/rc.conf#:ÙFè¦æŒä¹…ä¿å­˜è®¾ç½®ï¼Œè¯·å°†å…¶æ·»åŠ åˆ° [/etc/rc.conf] æ–‡ä»¶ä¸­ï¼š¶Scan Wireless Networks²æ‰«ææ— çº¿ç½‘ç»œÙAAvailable wireless networks can be scanned using man:ifconfig[8].ÙAå¯ä»¥ä½¿ç”¨ man:ifconfig[8] å‘½ä»¤æ‰«æå¯ç”¨çš„æ— çº¿ç½‘ç»œã€‚Ù<To list the wireless networks execute the following command:Ù0è¦åˆ—å‡ºæ— çº¿ç½‘ç»œï¼Œè¯·æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼šÙ0SSID/MESH ID identifies the name of the network.Ù%SSID/MESH ID æ ‡è¯†ç½‘ç»œçš„åç§°ã€‚Ù5BSSID identifies the MAC address of the access point.Ù)BSSID æ ‡è¯†äº†æ¥å…¥ç‚¹çš„ MAC åœ°å€ã€‚Ù¬CAPS field identifies the type of each network and the capabilities of the stations operating there (see the definition of `list scan` in man:ifconfig[8] for more details).Ù§CAPS å­—æ®µæ ‡è¯†äº†æ¯ä¸ªç½‘ç»œçš„ç±»å‹ä»¥åŠåœ¨è¯¥ç½‘ç»œä¸Šè¿è¡Œçš„ç«™ç‚¹çš„èƒ½åŠ›ï¼ˆæœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… man:ifconfig[8] ä¸­ `list scan` çš„å®šä¹‰ï¼‰ã€‚Ù3Connection and Authentication to a Wireless Network»è¿æ¥å’Œè®¤è¯æ— çº¿ç½‘ç»œÚÈOnce a wireless network has been selected from the list of scanned networks, it is necessary to perform the connection and the authentication.  In the vast majority of wireless networks, authentication is done with a password configured in the router.  Other schemes require cryptographic handshakes to be completed before data traffic can flow, either using pre-shared keys or secrets, or more complex schemes that involve backend services such as RADIUS.Úuä¸€æ—¦ä»æ‰«æåˆ°çš„ç½‘ç»œåˆ—è¡¨ä¸­é€‰æ‹©äº†ä¸€ä¸ªæ— çº¿ç½‘ç»œï¼Œå°±éœ€è¦è¿›è¡Œè¿æ¥å’Œè®¤è¯ã€‚åœ¨ç»å¤§å¤šæ•°æ— çº¿ç½‘ç»œä¸­ï¼Œè®¤è¯æ˜¯é€šè¿‡è·¯ç”±å™¨ä¸­é…ç½®çš„å¯†ç æ¥å®Œæˆçš„ã€‚å…¶ä»–æ–¹æ¡ˆè¦æ±‚åœ¨æ•°æ®æµé‡å¯ä»¥æµåŠ¨ä¹‹å‰å®ŒæˆåŠ å¯†æ¡æ‰‹ï¼Œå¯ä»¥ä½¿ç”¨é¢„å…±äº«å¯†é’¥æˆ–å¯†é’¥ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨æ¶‰åŠåç«¯æœåŠ¡ï¼ˆå¦‚ RADIUSï¼‰çš„æ›´å¤æ‚çš„æ–¹æ¡ˆã€‚Ù#Authenticate with WPA2/WPA/Personal¸ä½¿ç”¨ WPA2/WPA/PersonalÙUThe authentication process in a wireless network is managed by man:wpa_supplicant[8].ÙGæ— çº¿ç½‘ç»œä¸­çš„èº«ä»½éªŒè¯è¿‡ç¨‹ç”± man:wpa_supplicant[8] ç®¡ç†ã€‚ÙThe man:wpa_supplicant[8] configuration will be made in the [.filename]#/etc/wpa_supplicant.conf# file.  For more information, see man:wpa_supplicant.conf[5].Ù—man:wpa_supplicant[8] é…ç½®å°†åœ¨ [.filename]#/etc/wpa_supplicant.conf# æ–‡ä»¶ä¸­è¿›è¡Œã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜… man:wpa_supplicant.conf[5]ã€‚ÙåOnce the scanning of the wireless networks has been carried out, a network has been chosen and have the password (PSK), that information will be added to the file [.filename]#/etc/wpa_supplicant.conf# as in the following example:ÙÉä¸€æ—¦å®Œæˆäº†å¯¹æ— çº¿ç½‘ç»œçš„æ‰«æï¼Œé€‰æ‹©äº†ä¸€ä¸ªç½‘ç»œå¹¶è·å¾—äº†å¯†ç ï¼ˆPSKï¼‰ï¼Œé‚£ä¹ˆè¿™äº›ä¿¡æ¯å°†è¢«æ·»åŠ åˆ°æ–‡ä»¶ [.filename]#/etc/wpa_supplicant.conf# ä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤ºçš„ç¤ºä¾‹ï¼šÙ‰<.> SSID scan technique. Only need to use this option if the network is hidden.  <.> Network name.  <.> Passwork of the wireless network.Ù|<.> SSID æ‰«ææŠ€æœ¯ã€‚åªæœ‰åœ¨ç½‘ç»œéšè—æ—¶æ‰éœ€è¦ä½¿ç”¨æ­¤é€‰é¡¹ã€‚
<.> ç½‘ç»œåç§°ã€‚
<.> æ— çº¿ç½‘ç»œçš„å¯†ç ã€‚ÙaThe next step will be to configure the wireless connection in the file [.filename]#/etc/rc.conf#.ÙKä¸‹ä¸€æ­¥å°†æ˜¯åœ¨æ–‡ä»¶ [.filename]#/etc/rc.conf# ä¸­é…ç½®æ— çº¿è¿æ¥ã€‚ÙNTo use a static address it will be necessary to execute the following command:Ù3è¦ä½¿ç”¨é™æ€åœ°å€ï¼Œéœ€è¦æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼šÙOTo use a dynamic address it will be necessary to execute the following command:Ù3è¦ä½¿ç”¨åŠ¨æ€åœ°å€ï¼Œéœ€è¦æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼šÙ9Then restart the network executing the following command:Ù-ç„¶åæ‰§è¡Œä»¥ä¸‹å‘½ä»¤é‡æ–°å¯åŠ¨ç½‘ç»œï¼šÙ¹More information on how to perform more advanced methods of authentication can be obtained at crossref:advanced-networking[network-advanced-wireless,"Wireless Advanced Authentication"].Ù¡å¯ä»¥åœ¨ crossref:advanced-networking[network-advanced-wireless ,â€œæ— çº¿é«˜çº§è®¤è¯â€] è·å–æœ‰å…³å¦‚ä½•æ‰§è¡Œæ›´é«˜çº§èº«ä»½éªŒè¯æ–¹æ³•çš„æ›´å¤šä¿¡æ¯ã€‚¿Authenticate with Open NetworksÙ$ä½¿ç”¨å¼€æ”¾ç½‘ç»œè¿›è¡Œèº«ä»½éªŒè¯ÙtIt is important that the user is *very* careful when connecting to open networks without any kind of authentication.Ùoå½“ç”¨æˆ·è¿æ¥åˆ°æ²¡æœ‰ä»»ä½•èº«ä»½éªŒè¯æ–¹å¼çš„å¼€æ”¾ç½‘ç»œæ—¶ï¼Œéå¸¸é‡è¦çš„æ˜¯ç”¨æˆ·è¦éå¸¸å°å¿ƒã€‚ÙwOnce the wireless network scan is done and the SSID of the wireless network is selected, execute the following command:ÙQå®Œæˆæ— çº¿ç½‘ç»œæ‰«æå¹¶é€‰æ‹©æ— çº¿ç½‘ç»œçš„ SSID åï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼šÙ?And then execute man:dhclient[8] to get the address configured:Ù8ç„¶åæ‰§è¡Œ man:dhclient[8] æ¥è·å–é…ç½®çš„åœ°å€ï¼šÙ)Using Both Wired and Wireless ConnectionsÙ!åŒæ—¶ä½¿ç”¨æœ‰çº¿å’Œæ— çº¿è¿æ¥ÙÔA wired connection provides better performance and reliability, while a wireless connection provides flexibility and mobility.  Laptop users typically want to roam seamlessly between the two types of connections.Ù«æœ‰çº¿è¿æ¥æä¾›æ›´å¥½çš„æ€§èƒ½å’Œå¯é æ€§ï¼Œè€Œæ— çº¿è¿æ¥æä¾›çµæ´»æ€§å’Œç§»åŠ¨æ€§ã€‚ç¬”è®°æœ¬ç”µè„‘ç”¨æˆ·é€šå¸¸å¸Œæœ›åœ¨è¿™ä¸¤ç§è¿æ¥ç±»å‹ä¹‹é—´æ— ç¼åˆ‡æ¢ã€‚Ú)On FreeBSD, it is possible to combine two or even more network interfaces together in a "failover" fashion.  This type of configuration uses the most preferred and available connection from a group of network interfaces, and the operating system switches automatically when the link state changes.Ú
åœ¨ FreeBSD ä¸Šï¼Œå¯ä»¥ä»¥â€œæ•…éšœè½¬ç§»ï¼ˆfailoverï¼‰â€çš„æ–¹å¼å°†ä¸¤ä¸ªç”šè‡³æ›´å¤šçš„ç½‘ç»œæ¥å£ç»„åˆåœ¨ä¸€èµ·ã€‚è¿™ç§é…ç½®ç±»å‹ä½¿ç”¨ä¸€ç»„ç½‘ç»œæ¥å£ä¸­æœ€ä¼˜å…ˆå’Œå¯ç”¨çš„è¿æ¥ï¼Œå¹¶ä¸”å½“é“¾è·¯çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæ“ä½œç³»ç»Ÿä¼šè‡ªåŠ¨åˆ‡æ¢ã€‚ÚDLink aggregation and failover is covered in crossref:advanced-networking[network-aggregation,"Link Aggregation and Failover"] and an example for using both wired and wireless connections is provided at crossref:advanced-networking[networking-lagg-wired-and-wireless,"Failover Mode Between Ethernet and Wireless Interfaces"].ÚHé“¾è·¯èšåˆå’Œæ•…éšœè½¬ç§»åœ¨ crossref:advanced-networking[network-aggregation ,â€œé“¾è·¯èšåˆå’Œæ•…éšœè½¬ç§»â€] ä¸­æœ‰è¯¦ç»†ä»‹ç»ï¼Œå¹¶ä¸”åœ¨ crossref:advanced-networking[networking-lagg-wired-and-wireless ,â€œä»¥å¤ªç½‘å’Œæ— çº¿æ¥å£ä¹‹é—´çš„æ•…éšœè½¬ç§»æ¨¡å¼â€] ä¸­æä¾›äº†åŒæ—¶ä½¿ç”¨æœ‰çº¿å’Œæ— çº¿è¿æ¥çš„ç¤ºä¾‹ã€‚¨Hostname©ä¸»æœºåÙZThe hostname represents the fully qualified domain name (FQDN) of the host on the network.Ù@ä¸»æœºåè¡¨ç¤ºç½‘ç»œä¸Šä¸»æœºçš„å®Œå…¨é™å®šåŸŸåï¼ˆFQDNï¼‰ã€‚ÙRIf no hostname has been set for the host FreeBSD will assign the value `Amnesiac`.ÙFå¦‚æœä¸»æœºæ²¡æœ‰è®¾ç½®ä¸»æœºåï¼ŒFreeBSD å°†åˆ†é…å€¼ `Amnesiac`ã€‚ºCheck The Current Hostnameµæ£€æŸ¥å½“å‰ä¸»æœºåÙ:man:hostname[1] can be used to check the current hostname:Ù7man:hostname[1] å¯ä»¥ç”¨æ¥æ£€æŸ¥å½“å‰çš„ä¸»æœºåï¼š¯Change Hostname¯æ›´æ”¹ä¸»æœºåÙ_To change the hostname of the host and persist it across reboots execute the following command:ÙWè¦æ›´æ”¹ä¸»æœºçš„ä¸»æœºåå¹¶åœ¨é‡æ–°å¯åŠ¨åä¿æŒä¸å˜ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼šÙ©The DNS could be understanded as a link:https://en.wikipedia.org/wiki/Telephone_directory[telephone directory] in which an IP is identified to a hostname and vice versa.Ù•DNS å¯ä»¥è¢«ç†è§£ä¸ºä¸€ä¸ª link:https://en.wikipedia.org/wiki/Telephone_directory[ç”µè¯ç°¿]ï¼Œå…¶ä¸­å°† IP åœ°å€ä¸ä¸»æœºåè¿›è¡Œäº’ç›¸è¯†åˆ«ã€‚ÙThere are three files that handle how a FreeBSD system interact with the DNS.  These three files are man:hosts[5], man:resolv.conf[5] and man:nsswitch.conf[5]Ùˆæœ‰ä¸‰ä¸ªæ–‡ä»¶å¤„ç† FreeBSD ç³»ç»Ÿä¸ DNS çš„äº¤äº’ã€‚è¿™ä¸‰ä¸ªæ–‡ä»¶æ˜¯ man:hosts[5]ã€man:resolv.conf[5] å’Œ man:nsswitch.conf[5]ã€‚ÙÓUnless otherwise stated in the [.filename]#/etc/nsswitch.conf# file, FreeBSD will look at the addresses in the [.filename]#/etc/hosts# file and then the DNS information in the [.filename]#/etc/resolv.conf# file.ÙÖé™¤éåœ¨ [.filename]#/etc/nsswitch.conf# æ–‡ä»¶ä¸­å¦æœ‰è¯´æ˜ï¼Œå¦åˆ™ FreeBSD å°†é¦–å…ˆæŸ¥çœ‹ [.filename]#/etc/hosts# æ–‡ä»¶ä¸­çš„åœ°å€ï¼Œç„¶åå†æŸ¥çœ‹ [.filename]#/etc/resolv.conf# æ–‡ä»¶ä¸­çš„ DNS ä¿¡æ¯ã€‚ÙkThe man:nsswitch.conf[5] file specifies how the nsdispatch (name-service switch dispatcher) should operate.Ùeman:nsswitch.conf[5] æ–‡ä»¶æŒ‡å®šäº† nsdispatchï¼ˆåç§°æœåŠ¡åˆ‡æ¢è°ƒåº¦ç¨‹åºï¼‰çš„æ“ä½œæ–¹å¼ã€‚Ù]By default, the hosts section of the [.filename]#/etc/nsswitch.conf# file will be as follows:ÙZé»˜è®¤æƒ…å†µä¸‹ï¼Œ[.filename]#/etc/nsswitch.conf# æ–‡ä»¶çš„ hosts éƒ¨åˆ†å°†å¦‚ä¸‹æ‰€ç¤ºï¼šÙ€For example, in case of using the man:nscd[8] service.  The order of preference could be changed by leaving the line as follows:Ùmä¾‹å¦‚ï¼Œåœ¨ä½¿ç”¨ man:nscd[8] æœåŠ¡çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥é€šè¿‡å°†è¯¥è¡Œä¿æŒå¦‚ä¸‹æ¥æ›´æ”¹ä¼˜å…ˆé¡ºåºï¼š¯Local addresses¬æœ¬åœ°åœ°å€Ú£The [.filename]#/etc/hosts# file is a simple text database who provide host name to IP address mappings.  Entries for local computers connected via a LAN can be added to this file for simplistic naming purposes instead of setting up a DNS server.  Additionally, [.filename]#/etc/hosts# can be used to provide a local record of Internet names, reducing the need to query external DNS servers for commonly accessed names.Ú‰[.filename]#/etc/hosts# æ–‡ä»¶æ˜¯ä¸€ä¸ªç®€å•çš„æ–‡æœ¬æ•°æ®åº“ï¼Œç”¨äºæä¾›ä¸»æœºååˆ° IP åœ°å€çš„æ˜ å°„ã€‚å¯ä»¥å°†è¿æ¥åˆ°å±€åŸŸç½‘çš„æœ¬åœ°è®¡ç®—æœºçš„æ¡ç›®æ·»åŠ åˆ°æ­¤æ–‡ä»¶ä¸­ï¼Œä»¥ç®€åŒ–å‘½åï¼Œè€Œä¸æ˜¯è®¾ç½® DNS æœåŠ¡å™¨ã€‚æ­¤å¤–ï¼Œ [.filename]#/etc/hosts# è¿˜å¯ä»¥ç”¨äºæä¾›äº’è”ç½‘åç§°çš„æœ¬åœ°è®°å½•ï¼Œå‡å°‘æŸ¥è¯¢å¤–éƒ¨ DNS æœåŠ¡å™¨ä»¥è·å–å¸¸ç”¨åç§°çš„éœ€æ±‚ã€‚Ù¨For example, in the case of having a local instance of package:www/gitlab-ce[] in a local environment, it could be added as follows to the file [.filename]#/etc/hosts#:Ùªä¾‹å¦‚ï¼Œåœ¨æœ¬åœ°ç¯å¢ƒä¸­æœ‰ä¸€ä¸ªåä¸º package:www/gitlab-ce[] çš„æœ¬åœ°å®ä¾‹çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥å°†å…¶æ·»åŠ åˆ°æ–‡ä»¶ [.filename]#/etc/hosts# ä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼šºConfiguring the Nameserverµé…ç½®åŸŸåæœåŠ¡å™¨ÙhHow a FreeBSD system accesses the Internet Domain Name System (DNS) is controlled by man:resolv.conf[5].ÙXFreeBSD ç³»ç»Ÿå¦‚ä½•è®¿é—®äº’è”ç½‘åŸŸåç³»ç»Ÿï¼ˆDNSï¼‰ç”± man:resolv.conf[5] æ§åˆ¶ã€‚Ù=The most common entries to [.filename]#/etc/resolv.conf# are:Ù7æœ€å¸¸è§çš„æ¡ç›®æ˜¯ [.filename]#/etc/resolv.conf# ï¼šÙThe IP address of a name server the resolver should query. The servers are queried in the order listed with a maximum of three.Ùpè§£æå™¨åº”æŸ¥è¯¢çš„åç§°æœåŠ¡å™¨çš„ IP åœ°å€ã€‚æŒ‰ç…§åˆ—å‡ºçš„é¡ºåºæŸ¥è¯¢æœåŠ¡å™¨ï¼Œæœ€å¤šæŸ¥è¯¢ä¸‰ä¸ªã€‚ÙaSearch list for hostname lookup. This is normally determined by the domain of the local hostname.ÙKæœç´¢åˆ—è¡¨ç”¨äºä¸»æœºåæŸ¥æ‰¾ã€‚é€šå¸¸ç”±æœ¬åœ°ä¸»æœºåçš„åŸŸç¡®å®šã€‚¶The local domain name.¯æœ¬åœ°åŸŸåã€‚Ù8A typical [.filename]#/etc/resolv.conf# looks like this:ÙCä¸€ä¸ªå…¸å‹çš„ [.filename]#/etc/resolv.conf# æ–‡ä»¶å¦‚ä¸‹æ‰€ç¤ºï¼šÙ=Only one of the `search` and `domain` options should be used.Ù8åªèƒ½ä½¿ç”¨ `search` å’Œ `domain` é€‰é¡¹ä¸­çš„ä¸€ä¸ªã€‚ÙWhen using DHCP, man:dhclient[8] usually rewrites [.filename]#/etc/resolv.conf# with information received from the DHCP server.Ù„åœ¨ä½¿ç”¨ DHCP æ—¶ï¼Œman:dhclient[8] é€šå¸¸ä¼šä½¿ç”¨ä» DHCP æœåŠ¡å™¨æ¥æ”¶åˆ°çš„ä¿¡æ¯é‡å†™ .filename#/etc/resolv.conf# æ–‡ä»¶ã€‚Ù’If the machine in which the configuration is being made is *not* a DNS server, man:local-unbound[8] can be used to improve DNS lookup performance.Ùtå¦‚æœè¿›è¡Œé…ç½®çš„æœºå™¨ *ä¸æ˜¯* DNS æœåŠ¡å™¨ï¼Œå¯ä»¥ä½¿ç”¨ man:local-unbound[8] æ¥æé«˜ DNS æŸ¥æ‰¾æ€§èƒ½ã€‚Ù8To enable it at boot time execute the following command:Ù3è¦åœ¨å¯åŠ¨æ—¶å¯ç”¨å®ƒï¼Œè¯·æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼šÙHTo start the man:local-unbound[8] service execute the following command:Ù@è¦å¯åŠ¨ man:local-unbound[8] æœåŠ¡ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼šÙYWhen troubleshooting hardware and software configurations, check the simple things first.ÙHåœ¨æ’é™¤ç¡¬ä»¶å’Œè½¯ä»¶é…ç½®é—®é¢˜æ—¶ï¼Œé¦–å…ˆæ£€æŸ¥ç®€å•çš„äº‹æƒ…ã€‚Ù Is the network cable plugged in?»ç½‘ç»œç”µç¼†å·²æ’å¥½å—ï¼ŸÙ-Are the network services properly configured?Ù$ç½‘ç»œæœåŠ¡æ˜¯å¦å·²æ­£ç¡®é…ç½®ï¼ŸÙ%Is the firewall configured correctly?»é˜²ç«å¢™é…ç½®æ­£ç¡®å—ï¼ŸÙ Is the NIC supported by FreeBSD?Ù FreeBSD æ˜¯å¦æ”¯æŒè¯¥ç½‘å¡ï¼ŸÙ Is the router working correctly?¾è·¯ç”±å™¨æ˜¯å¦æ­£å¸¸å·¥ä½œï¼ŸÙ÷Before sending a bug report, always check the Hardware Notes in the link:https://www.freebsd.org/releases/[FreeBSD release page], update the version of FreeBSD to the latest STABLE version, check the mailing list archives, and search the Internet.Ùïåœ¨å‘é€é”™è¯¯æŠ¥å‘Šä¹‹å‰ï¼Œå§‹ç»ˆè¦åœ¨ link:https://www.freebsd.org/releases/[FreeBSD å‘å¸ƒé¡µé¢] æ£€æŸ¥ç¡¬ä»¶è¯´æ˜ ï¼Œå°† FreeBSD ç‰ˆæœ¬æ›´æ–°åˆ°æœ€æ–°çš„ STABLE ç‰ˆæœ¬ï¼Œæ£€æŸ¥é‚®ä»¶åˆ—è¡¨å­˜æ¡£ï¼Œå¹¶åœ¨äº’è”ç½‘ä¸Šè¿›è¡Œæœç´¢ã€‚Ù!Troubleshooting in Wired Networks¸æœ‰çº¿ç½‘ç»œæ•…éšœæ’é™¤Ù¨If the card works, yet performance is poor, read through man:tuning[7].  Also, check the network configuration as incorrect network settings can cause slow connections.Ù§å¦‚æœå¡å¯ä»¥æ­£å¸¸å·¥ä½œï¼Œä½†æ€§èƒ½è¾ƒå·®ï¼Œè¯·é˜…è¯» man:tuning[7]ã€‚æ­¤å¤–ï¼Œè¯·æ£€æŸ¥ç½‘ç»œé…ç½®ï¼Œå› ä¸ºä¸æ­£ç¡®çš„ç½‘ç»œè®¾ç½®å¯èƒ½ä¼šå¯¼è‡´è¿æ¥å˜æ…¢ã€‚Úc`No route to host` messages occur if the system is unable to route a packet to the destination host.  This can happen if no default route is specified or if a cable is unplugged.  Check the output of `netstat -rn` and make sure there is a valid route to the host.  If there is not, read crossref:advanced-networking[network-routing,"Gateways and Routes"].Útå¦‚æœç³»ç»Ÿæ— æ³•å°†æ•°æ®åŒ…è·¯ç”±åˆ°ç›®æ ‡ä¸»æœºï¼Œåˆ™ä¼šå‡ºç°â€œæ— æ³•åˆ°è¾¾ä¸»æœºâ€çš„æ¶ˆæ¯ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šé»˜è®¤è·¯ç”±æˆ–è€…ç”µç¼†æœªæ’å¥½ï¼Œå°±ä¼šå‘ç”Ÿè¿™ç§æƒ…å†µã€‚æ£€æŸ¥ `netstat -rn` çš„è¾“å‡ºï¼Œå¹¶ç¡®ä¿å­˜åœ¨åˆ°ç›®æ ‡ä¸»æœºçš„æœ‰æ•ˆè·¯ç”±ã€‚å¦‚æœä¸å­˜åœ¨æœ‰æ•ˆè·¯ç”±ï¼Œè¯·é˜…è¯» crossref:advanced-networking[network-routing,â€œç½‘å…³å’Œè·¯ç”±â€].Ú(`ping: sendto: Permission denied` error messages are often caused by a misconfigured firewall.  If a firewall is enabled on FreeBSD but no rules have been defined, the default policy is to deny all traffic, even man:ping[8].  Refer to crossref:firewalls[firewalls,Firewalls] for more information.Ú+`ping: sendto: Permission denied` é”™è¯¯æ¶ˆæ¯é€šå¸¸æ˜¯ç”±äºé…ç½®é”™è¯¯çš„é˜²ç«å¢™å¼•èµ·çš„ã€‚å¦‚æœåœ¨ FreeBSD ä¸Šå¯ç”¨äº†é˜²ç«å¢™ä½†æ²¡æœ‰å®šä¹‰è§„åˆ™ï¼Œé‚£ä¹ˆé»˜è®¤ç­–ç•¥æ˜¯æ‹’ç»æ‰€æœ‰æµé‡ï¼Œç”šè‡³æ˜¯ man:ping[8]ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è€ƒ crossref:firewalls[firewalls,é˜²ç«å¢™]ã€‚Ù$Troubleshooting in Wireless Networks¸æ— çº¿ç½‘ç»œæ•…éšœæ’é™¤ÙbThis section describes a number of steps to help troubleshoot common wireless networking problems.ÙKæœ¬èŠ‚æè¿°äº†ä¸€äº›æ­¥éª¤ï¼Œä»¥å¸®åŠ©è§£å†³å¸¸è§çš„æ— çº¿ç½‘ç»œé—®é¢˜ã€‚ÙIf the access point is not listed when scanning, check that the configuration has not limited the wireless device to a limited set of channels.Ùcå¦‚æœåœ¨æ‰«ææ—¶æœªåˆ—å‡ºè®¿é—®ç‚¹ï¼Œè¯·æ£€æŸ¥é…ç½®æ˜¯å¦é™åˆ¶äº†æ— çº¿è®¾å¤‡çš„é¢‘é“èŒƒå›´ã€‚Ú‚If the device cannot associate with an access point, verify that the configuration matches the settings on the access point. This includes the authentication scheme and any security protocols. Simplify the configuration as much as possible. If using a security protocol such as WPA2 or WPA, configure the access point for open authentication and no security to see if traffic will pass.Ú%å¦‚æœè®¾å¤‡æ— æ³•ä¸æ¥å…¥ç‚¹å…³è”ï¼Œè¯·éªŒè¯é…ç½®æ˜¯å¦ä¸æ¥å…¥ç‚¹ä¸Šçš„è®¾ç½®åŒ¹é…ã€‚è¿™åŒ…æ‹¬è®¤è¯æ–¹æ¡ˆå’Œä»»ä½•å®‰å…¨åè®®ã€‚å°½é‡ç®€åŒ–é…ç½®ã€‚å¦‚æœä½¿ç”¨ WPA2 æˆ– WPA ç­‰å®‰å…¨åè®®ï¼Œè¯·å°†æ¥å…¥ç‚¹é…ç½®ä¸ºå¼€æ”¾è®¤è¯å’Œæ— å®‰å…¨æ€§ï¼Œä»¥æŸ¥çœ‹æ˜¯å¦å¯ä»¥ä¼ è¾“æµé‡ã€‚ÙuOnce the system can associate with the access point, diagnose the network configuration using tools like man:ping[8].Ùsä¸€æ—¦ç³»ç»Ÿèƒ½å¤Ÿä¸æ¥å…¥ç‚¹å»ºç«‹å…³è”ï¼Œå¯ä»¥ä½¿ç”¨è¯¸å¦‚ man:ping[8] ä¹‹ç±»çš„å·¥å…·æ¥è¯Šæ–­ç½‘ç»œé…ç½®ã€‚ÙŠThere are many lower-level debugging tools. Debugging messages can be enabled in the 802.11 protocol support layer using man:wlandebug[8].Ùkæœ‰è®¸å¤šä½çº§è°ƒè¯•å·¥å…·ã€‚å¯ä»¥ä½¿ç”¨ man:wlandebug[8] åœ¨ 802.11 åè®®æ”¯æŒå±‚å¯ç”¨è°ƒè¯•æ¶ˆæ¯ã€‚Ù›This chapter describes how to install and configure Xorg on FreeBSD, which provides the open source X Window System used to provide a graphical environmentÙ}æœ¬ç« ä»‹ç»äº†å¦‚ä½•åœ¨ FreeBSD ä¸Šå®‰è£…å’Œé…ç½® Xorg ï¼Œå®ƒæä¾›äº†ç”¨äºæä¾›å›¾å½¢ç¯å¢ƒçš„å¼€æº X Window System ã€‚¾Chapter 5. The X Window System¹ç¬¬ 5 ç«  X Window ç³»ç»Ÿ³The X Window SystemÙ%X Window System ï¼ˆX  Windowç³»ç»Ÿï¼‰ÚMAn installation of FreeBSD using bsdinstall does not automatically install a graphical user interface.  This chapter describes how to install and configure Xorg, which provides the open source X Window System used to provide a graphical environment.  It then describes how to find and install a desktop environment or window manager.Úä½¿ç”¨ bsdinstall å®‰è£… FreeBSD æ—¶ï¼Œä¸ä¼šè‡ªåŠ¨å®‰è£…å›¾å½¢ç”¨æˆ·ç•Œé¢ã€‚æœ¬ç« ä»‹ç»äº†å¦‚ä½•å®‰è£…å’Œé…ç½® Xorgï¼Œå®ƒæä¾›äº†ç”¨äºæä¾›å›¾å½¢ç¯å¢ƒçš„å¼€æº X Window ç³»ç»Ÿã€‚ç„¶åï¼Œå®ƒæè¿°äº†å¦‚ä½•æŸ¥æ‰¾å’Œå®‰è£…æ¡Œé¢ç¯å¢ƒæˆ–çª—å£ç®¡ç†å™¨ã€‚Ù(Before reading this chapter, you should:Ù$åœ¨é˜…è¯»æœ¬ç« ä¹‹å‰ï¼Œæ‚¨åº”è¯¥ï¼šÙ†Know how to install additional third-party software as described in crossref:ports[ports,Installing Applications: Packages and Ports].Ù‡æ ¹æ® crossref:ports[ports,å®‰è£…åº”ç”¨ç¨‹åºï¼šè½¯ä»¶åŒ…å’Œ Ports] ä¸­æè¿°çš„æ–¹æ³•ï¼Œäº†è§£å¦‚ä½•å®‰è£…é¢å¤–çš„ç¬¬ä¸‰æ–¹è½¯ä»¶ã€‚ÙIThe various components of the X Window System, and how they interoperate.ÙBX Window ç³»ç»Ÿçš„å„ä¸ªç»„ä»¶ä»¥åŠå®ƒä»¬ä¹‹é—´çš„ç›¸äº’æ“ä½œã€‚Ù"How to install and configure Xorg.½å¦‚ä½•å®‰è£…å’Œé…ç½® Xorgã€‚Ù%How to use TrueType(R) fonts in Xorg.Ù.å¦‚ä½•åœ¨ Xorg ä¸­ä½¿ç”¨ TrueType(R) å­—ä½“ã€‚Ù5How to set up your system for graphical logins (XDM).Ù3å¦‚ä½•è®¾ç½®ç³»ç»Ÿä»¥è¿›è¡Œå›¾å½¢ç™»å½•ï¼ˆXDMï¼‰ã€‚¯Installing Xorg«å®‰è£… XorgÙ7On FreeBSD, Xorg can be installed as a package or port.ÙMåœ¨ FreeBSD ä¸Šï¼ŒXorg å¯ä»¥ä½œä¸ºä¸€ä¸ªè½¯ä»¶åŒ…æˆ–è€…ç«¯å£è¿›è¡Œå®‰è£…ã€‚ÙZThe binary meta package can be installed quickly but with fewer options for customization:Ù?äºŒè¿›åˆ¶å…ƒåŒ…å¯ä»¥å¿«é€Ÿå®‰è£…ï¼Œä½†è‡ªå®šä¹‰é€‰é¡¹è¾ƒå°‘ï¼šÙREither of these installations results in the complete Xorg system being installed.ÙEä»»ä½•ä¸€ç§å®‰è£…æ–¹å¼éƒ½ä¼šå¯¼è‡´å®Œæ•´çš„ Xorg ç³»ç»Ÿè¢«å®‰è£…ã€‚ÙwThe current user must be a member of the `video` group.  To add a user to `video` group, execute the following command:Ùlå½“å‰ç”¨æˆ·å¿…é¡»æ˜¯ `video` ç»„çš„æˆå‘˜ã€‚è¦å°†ç”¨æˆ·æ·»åŠ åˆ° `video` ç»„ä¸­ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼šÙûA smaller version of the X system suitable for experienced users is available in package:x11/xorg-minimal[].  Most of the documents, libraries, and applications will not be installed.  Some applications require these additional components to function.Ùİé€‚ç”¨äºæœ‰ç»éªŒçš„ç”¨æˆ·çš„ X ç³»ç»Ÿçš„è¾ƒå°ç‰ˆæœ¬å¯åœ¨åŒ…ï¼š x11/xorg-minimal[] ä¸­è·å¾—ã€‚å¤§å¤šæ•°æ–‡æ¡£ã€åº“å’Œåº”ç”¨ç¨‹åºå°†ä¸ä¼šè¢«å®‰è£…ã€‚æŸäº›åº”ç”¨ç¨‹åºéœ€è¦è¿™äº›é¢å¤–çš„ç»„ä»¶æ‰èƒ½æ­£å¸¸è¿è¡Œã€‚ÙÌVideo cards, monitors, and input devices are automatically detected and do not require any manual configuration.  Do not create `xorg.conf` or run a `-configure` step unless automatic configuration fails.Ù·è§†é¢‘å¡ã€æ˜¾ç¤ºå™¨å’Œè¾“å…¥è®¾å¤‡ä¼šè¢«è‡ªåŠ¨æ£€æµ‹ï¼Œä¸éœ€è¦ä»»ä½•æ‰‹åŠ¨é…ç½®ã€‚é™¤éè‡ªåŠ¨é…ç½®å¤±è´¥ï¼Œå¦åˆ™ä¸è¦åˆ›å»º `xorg.conf` æ–‡ä»¶æˆ–è¿è¡Œ `-configure` æ­¥éª¤ã€‚´Graphic card drivers²æ˜¾å¡é©±åŠ¨ç¨‹åºÙŒThe following table shows the different graphics cards supported by FreeBSD, which package should be installed and its corresponding module.Ù`ä¸‹è¡¨æ˜¾ç¤ºäº† FreeBSD æ”¯æŒçš„ä¸åŒå›¾å½¢å¡ï¼Œåº”å®‰è£…çš„è½¯ä»¶åŒ…åŠå…¶å¯¹åº”çš„æ¨¡å—ã€‚µGraphic card packages¯å›¾å½¢å¡å¥—ä»¶¥Brand¦å“ç‰Œ¤Type¦ç±»å‹§Package£åŒ…¦Module¦æ¨¡å—«Open Source¦å¼€æº¸`amdgpu` and `radeonkms`¸`amdgpu` å’Œ `radeonkms`«Proprietary©ä¸“æœ‰çš„¼`nvidia` or `nvidia-modeset`½`nvidia` æˆ– `nvidia-modeset`Ù;VirtualBox(R) OSE additions include the `vboxvideo` driver.Ù7VirtualBox(R) OSE å¢åŠ äº† `vboxvideo` é©±åŠ¨ç¨‹åºã€‚Ù]The following command can be used to identify which graphics card is installed in the system:Ù?å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥è¯†åˆ«ç³»ç»Ÿä¸­å®‰è£…çš„å›¾å½¢å¡ï¼šÙåIf the graphics card is not supported by Intel(R), AMD(R) or NVIDIA(R) drivers, then VESA or SCFB modules should be used.  VESA module must be used when booting in BIOS mode and SCFB module must be used when booting in UEFI mode.ÙØå¦‚æœæ˜¾å¡ä¸å— Intel(R)ã€AMD(R) æˆ– NVIDIA(R) é©±åŠ¨ç¨‹åºæ”¯æŒï¼Œåˆ™åº”ä½¿ç”¨ VESA æˆ– SCFB æ¨¡å—ã€‚åœ¨ BIOS æ¨¡å¼ä¸‹å¯åŠ¨æ—¶å¿…é¡»ä½¿ç”¨ VESA æ¨¡å—ï¼Œåœ¨ UEFI æ¨¡å¼ä¸‹å¯åŠ¨æ—¶å¿…é¡»ä½¿ç”¨ SCFB æ¨¡å—ã€‚Ù3This command can be used to check the booting mode:Ù-è¿™ä¸ªå‘½ä»¤å¯ä»¥ç”¨æ¥æ£€æŸ¥å¯åŠ¨æ¨¡å¼ï¼šÚ$Intel(R) Graphics refers to the class of graphics chips that are integrated on the same die as an Intel(R) CPU.  Wikipedia offers link:https://en.wikipedia.org/wiki/List_of_Intel_graphics_processing_units[a good overview of the variations and names used for generations of Intel HD Graphics].ÚIntel(R) Graphics æŒ‡çš„æ˜¯ä¸ Intel(R) CPU é›†æˆåœ¨åŒä¸€èŠ¯ç‰‡ä¸Šçš„å›¾å½¢èŠ¯ç‰‡ç±»åˆ«ã€‚ç»´åŸºç™¾ç§‘æä¾›äº† link:https://en.wikipedia.org/wiki/List_of_Intel_graphics_processing_units[ä¸€ä¸ªå…³äº Intel HD Graphics å„ä¸ªä¸–ä»£çš„å˜ä½“å’Œå‘½åçš„è‰¯å¥½æ¦‚è¿°] ã€‚ÙÅThe package:graphics/drm-kmod[] package indirectly provides a range of kernel modules for use with Intel(R) Graphics cards.  The Intel(R) driver can be installed by executing the following command:Ù¢package:graphics/drm-kmod[] åŒ…é—´æ¥æä¾›äº†ä¸€ç³»åˆ—ç”¨äº Intel(R) å›¾å½¢å¡çš„å†…æ ¸æ¨¡å—ã€‚å¯ä»¥é€šè¿‡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ¥å®‰è£… Intel(R) é©±åŠ¨ç¨‹åºï¼šÙLThen add the module to `/etc/rc.conf` file, executing the following command:ÙLç„¶åå°†è¯¥æ¨¡å—æ·»åŠ åˆ° `/etc/rc.conf` æ–‡ä»¶ä¸­ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼šÙ¿If a high CPU usage is noticed or excessive tearing with HD video, the installation of package:multimedia/libva-intel-driver[] may help.  To install the package execute the following command:ÙÄå¦‚æœæ³¨æ„åˆ°é«˜ CPU ä½¿ç”¨ç‡æˆ–é«˜æ¸…è§†é¢‘å‡ºç°è¿‡å¤šçš„æ’•è£‚ç°è±¡ï¼Œå®‰è£… package:multimedia/libva-intel-driver[] å¯èƒ½ä¼šæœ‰æ‰€å¸®åŠ©ã€‚è¦å®‰è£…è¯¥è½¯ä»¶åŒ…ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼šÚrThe package:graphics/drm-kmod[] package indirectly provides a range of kernel modules for use with AMD(R) Graphics cards.  The modules `amdgpu` and `radeonkms` can be used depending the generation of the hardware.  The FreeBSD project maintains an link:https://wiki.freebsd.org/Graphics/AMD-GPU-Matrix[AMD graphics support matrix to determine which driver must be used].Ú?package:graphics/drm-kmod[] åŒ…é—´æ¥æä¾›äº†ä¸€ç³»åˆ—ç”¨äº AMD(R) å›¾å½¢å¡çš„å†…æ ¸æ¨¡å—ã€‚æ ¹æ®ç¡¬ä»¶çš„ä»£æ•°ï¼Œå¯ä»¥ä½¿ç”¨ `amdgpu` å’Œ `radeonkms` æ¨¡å—ã€‚FreeBSD é¡¹ç›®ç»´æŠ¤äº†ä¸€ä¸ª link:https://wiki.freebsd.org/Graphics/AMD-GPU-Matrix[AMD å›¾å½¢æ”¯æŒçŸ©é˜µ]ï¼Œä»¥ç¡®å®šå¿…é¡»ä½¿ç”¨å“ªä¸ªé©±åŠ¨ç¨‹åºã€‚ÙBAMD(R) driver can be installed by executing the following command:Ù>å¯ä»¥é€šè¿‡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ¥å®‰è£… AMD(R) é©±åŠ¨ç¨‹åºï¼šÙoFor post-HD7000 or Tahiti graphic cards add the module to `/etc/rc.conf` file, executing the following command:Ùnå¯¹äº HD7000 ç³»åˆ—æˆ– Tahiti æ˜¾å¡ï¼Œè¯·å°†æ¨¡å—æ·»åŠ åˆ° `/etc/rc.conf` æ–‡ä»¶ä¸­ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼šÙzFor older graphic cards (pre-HD7000 or pre-Tahiti) add the module to `/etc/rc.conf` file, executing the following command:Ù‚å¯¹äºè¾ƒæ—§çš„å›¾å½¢å¡ï¼ˆHD7000 ä¹‹å‰æˆ– Tahiti ä¹‹å‰ï¼Œè¯·å°†æ¨¡å—æ·»åŠ åˆ° `/etc/rc.conf` æ–‡ä»¶ä¸­ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼šÙíFreeBSD supports different versions of the proprietary NVIDIA(R) driver.  Users of newer graphics cards should install the package:x11/nvidia-driver[] package.  Those with older cards will have to check below which version supports them.ÙÌFreeBSD æ”¯æŒä¸åŒç‰ˆæœ¬çš„ä¸“æœ‰ NVIDIA(R) é©±åŠ¨ç¨‹åºã€‚ä½¿ç”¨è¾ƒæ–°çš„æ˜¾å¡çš„ç”¨æˆ·åº”å®‰è£…åŒ…ï¼š x11/nvidia-driver[]ã€‚é‚£äº›ä½¿ç”¨è¾ƒæ—§æ˜¾å¡çš„ç”¨æˆ·éœ€è¦æŸ¥çœ‹ä¸‹é¢æ”¯æŒå®ƒä»¬çš„ç‰ˆæœ¬ã€‚Ù'Supported versions of NVIDIA(R) driversÙ&æ”¯æŒçš„ NVIDIA(R) é©±åŠ¨ç¨‹åºç‰ˆæœ¬²Supported hardware¯æ”¯æŒçš„ç¡¬ä»¶ÙYlink:https://www.nvidia.com/Download/driverResults.aspx/123712/en-us/[supported hardware]ÙVlink:https://www.nvidia.com/Download/driverResults.aspx/123712/en-us/[æ”¯æŒçš„ç¡¬ä»¶]ÙYlink:https://www.nvidia.com/Download/driverResults.aspx/156167/en-us/[supported hardware]ÙVlink:https://www.nvidia.com/Download/driverResults.aspx/156167/en-us/[æ”¯æŒçš„ç¡¬ä»¶]ÙYlink:https://www.nvidia.com/Download/driverResults.aspx/191122/en-us/[supported hardware]ÙVlink:https://www.nvidia.com/Download/driverResults.aspx/191122/en-us/[æ”¯æŒçš„ç¡¬ä»¶]ÙYlink:https://www.nvidia.com/Download/driverResults.aspx/194639/en-us/[supported hardware]ÙVlink:https://www.nvidia.com/Download/driverResults.aspx/194639/en-us/[æ”¯æŒçš„ç¡¬ä»¶]ÙYlink:https://www.nvidia.com/Download/driverResults.aspx/210651/en-us/[supported hardware]ÙVlink:https://www.nvidia.com/Download/driverResults.aspx/210651/en-us/[æ”¯æŒçš„ç¡¬ä»¶]ÙlVersion 304 of the NVIDIA(R) graphics driver (nvidia-driver-304) does not support xorg-server 1.20 or later.ÙnNVIDIA(R) å›¾å½¢é©±åŠ¨ç¨‹åºçš„ 304 ç‰ˆæœ¬ï¼ˆnvidia-driver-304ï¼‰ä¸æ”¯æŒ xorg-server 1.20 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚ÙNThe latest NVIDIA(R) driver can be installed by running the following command:ÙMæœ€æ–°çš„ NVIDIA(R) é©±åŠ¨ç¨‹åºå¯ä»¥é€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤è¿›è¡Œå®‰è£…ï¼šÙtThe `nvidia` driver must be used if the packages x11/nvidia-driver-304 or x11/nvidia-driver-340 have been installed.Ùtå¦‚æœå®‰è£…äº† x11/nvidia-driver-304 æˆ– x11/nvidia-driver-340 è½¯ä»¶åŒ…ï¼Œåˆ™å¿…é¡»ä½¿ç”¨ `nvidia` é©±åŠ¨ç¨‹åºã€‚²Xorg Configuration«Xorg é…ç½®ÙGXorg supports most common video cards, keyboards, and pointing devices.ÙAXorg æ”¯æŒå¤§å¤šæ•°å¸¸è§çš„è§†é¢‘å¡ã€é”®ç›˜å’ŒæŒ‡é’ˆè®¾å¤‡ã€‚ÙÜVideo cards, monitors, and input devices are automatically detected and do not require any manual configuration.  Do not create [.filename]#xorg.conf# or run a `Xorg -configure` step unless automatic configuration fails.ÙÇè§†é¢‘å¡ã€æ˜¾ç¤ºå™¨å’Œè¾“å…¥è®¾å¤‡ä¼šè¢«è‡ªåŠ¨æ£€æµ‹ï¼Œä¸éœ€è¦ä»»ä½•æ‰‹åŠ¨é…ç½®ã€‚é™¤éè‡ªåŠ¨é…ç½®å¤±è´¥ï¼Œå¦åˆ™ä¸è¦åˆ›å»º [.filename]#xorg.conf# æ–‡ä»¶æˆ–è¿è¡Œ `Xorg -configure` æ­¥éª¤ã€‚³Configuration Files¬é…ç½®æ–‡ä»¶ÙğXorg looks in several directories for configuration files.  [.filename]#/usr/local/etc/X11/# is the *recommended* directory for these files on FreeBSD.  Using this directory helps keep application files separate from operating system files.ÙÊXorg åœ¨å¤šä¸ªç›®å½•ä¸­æŸ¥æ‰¾é…ç½®æ–‡ä»¶ã€‚åœ¨ FreeBSD ä¸Šï¼Œæ¨èä½¿ç”¨ç›®å½• `/usr/local/etc/X11/` æ¥å­˜æ”¾è¿™äº›æ–‡ä»¶ã€‚ä½¿ç”¨è¿™ä¸ªç›®å½•å¯ä»¥å°†åº”ç”¨ç¨‹åºæ–‡ä»¶ä¸æ“ä½œç³»ç»Ÿæ–‡ä»¶åˆ†å¼€ã€‚¸Single or Multiple Files»å•ä¸ªæ–‡ä»¶æˆ–å¤šä¸ªæ–‡ä»¶Ù×It is easier to use multiple files that each configure a specific setting than the traditional single [.filename]#xorg.conf#.  These files are stored in the [.filename]#/usr/local/etc/X11/xorg.conf.d/# subdirectory.Ùµä½¿ç”¨å¤šä¸ªæ–‡ä»¶æ¥é…ç½®ç‰¹å®šè®¾ç½®æ¯”ä¼ ç»Ÿçš„å•ä¸ª [.filename]#xorg.conf# æ–‡ä»¶æ›´å®¹æ˜“ã€‚è¿™äº›æ–‡ä»¶å­˜å‚¨åœ¨ [.filename]#/usr/local/etc/X11/xorg.conf.d/# å­ç›®å½•ä¸­ã€‚Ù¶The traditional single [.filename]#xorg.conf# still works, but is neither as clear nor as flexible as multiple files in the [.filename]#/usr/local/etc/X11/xorg.conf.d/# subdirectory.Ù²ä¼ ç»Ÿçš„å•ä¸€ [.filename]#xorg.conf# ä»ç„¶æœ‰æ•ˆï¼Œä½†æ˜¯ä¸ä½äº [.filename]#/usr/local/etc/X11/xorg.conf.d/# å­ç›®å½•ä¸­çš„å¤šä¸ªæ–‡ä»¶ç›¸æ¯”ï¼Œæ—¢ä¸æ¸…æ™°ä¹Ÿä¸çµæ´»ã€‚«Video Cards©è§†é¢‘å¡ÙpThe driver for the graphics card can be specified in the [.filename]#/usr/local/etc/X11/xorg.conf.d/# directory.Ùaå›¾å½¢å¡çš„é©±åŠ¨ç¨‹åºå¯ä»¥åœ¨ [.filename]#/usr/local/etc/X11/xorg.conf.d/# ç›®å½•ä¸­æŒ‡å®šã€‚Ù9To configure the Intel(R) driver in a configuration file:Ù4è¦åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½® Intel(R) é©±åŠ¨ç¨‹åºï¼šÙ&Select Intel(R) Video Driver in a FileÙ.åœ¨æ–‡ä»¶ä¸­é€‰æ‹© Intel(R) è§†é¢‘é©±åŠ¨ç¨‹åºÙ7To configure the AMD(R) driver in a configuration file:Ù2è¦åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½® AMD(R) é©±åŠ¨ç¨‹åºï¼šÙ$Select AMD(R) Video Driver in a FileÙ,åœ¨æ–‡ä»¶ä¸­é€‰æ‹© AMD(R) è§†é¢‘é©±åŠ¨ç¨‹åºÙ:To configure the NVIDIA(R) driver in a configuration file:Ù5è¦åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½® NVIDIA(R) é©±åŠ¨ç¨‹åºï¼šÙ'Select NVIDIA(R) Video Driver in a FileÙ/åœ¨æ–‡ä»¶ä¸­é€‰æ‹© NVIDIA(R) è§†é¢‘é©±åŠ¨ç¨‹åºÙpackage:x11/nvidia-xconfig[] can also be used to perform basic control over configuration options available in the NVIDIA driver.Ùppackage:x11/nvidia-xconfig[] ä¹Ÿå¯ä»¥ç”¨æ¥å¯¹ NVIDIA é©±åŠ¨ç¨‹åºä¸­å¯ç”¨çš„é…ç½®é€‰é¡¹è¿›è¡ŒåŸºæœ¬æ§åˆ¶ã€‚Ù5To configure the VESA driver in a configuration file:Ù0è¦åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½® VESA é©±åŠ¨ç¨‹åºï¼šÙ"Select VESA Video Driver in a FileÙ*åœ¨æ–‡ä»¶ä¸­é€‰æ‹© VESA è§†é¢‘é©±åŠ¨ç¨‹åºÙ5To configure the SCFB driver in a configuration file:Ù0è¦åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½® SCFB é©±åŠ¨ç¨‹åºï¼šÙ"Select SCFB Video Driver in a FileÙ*åœ¨æ–‡ä»¶ä¸­é€‰æ‹© SCFB è§†é¢‘é©±åŠ¨ç¨‹åºÙ}To configure multiple video cards, the `BusID` can be added.  A list of video card bus ``ID``s can be displayed by executing:Ùqè¦é…ç½®å¤šä¸ªè§†é¢‘å¡ï¼Œå¯ä»¥æ·»åŠ  `BusID`ã€‚æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å¯ä»¥æ˜¾ç¤ºè§†é¢‘å¡æ€»çº¿ `ID` çš„åˆ—è¡¨ï¼šÙASelect Intel(R) Video Driver and NVIDIA(R) Video Driver in a FileÙWåœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­é€‰æ‹© Intel(R) è§†é¢‘é©±åŠ¨ç¨‹åºå’Œ NVIDIA(R) è§†é¢‘é©±åŠ¨ç¨‹åºã€‚¨Monitors©æ˜¾ç¤ºå™¨ÚAlmost all monitors support the Extended Display Identification Data standard (`EDID`).  Xorg uses `EDID` to communicate with the monitor and detect the supported resolutions and refresh rates.  Then it selects the most appropriate combination of settings to use with that monitor.Ùèå‡ ä¹æ‰€æœ‰çš„æ˜¾ç¤ºå™¨éƒ½æ”¯æŒæ‰©å±•æ˜¾ç¤ºè¯†åˆ«æ•°æ®æ ‡å‡†ï¼ˆ`EDID`ï¼‰ã€‚Xorg ä½¿ç”¨ `EDID` ä¸æ˜¾ç¤ºå™¨è¿›è¡Œé€šä¿¡ï¼Œæ£€æµ‹æ”¯æŒçš„åˆ†è¾¨ç‡å’Œåˆ·æ–°ç‡ï¼Œç„¶åé€‰æ‹©æœ€åˆé€‚çš„è®¾ç½®ç»„åˆæ¥ä¸è¯¥æ˜¾ç¤ºå™¨é…åˆä½¿ç”¨ã€‚Ù­Other resolutions supported by the monitor can be chosen by setting the desired resolution in configuration files, or after the X server has been started with man:xrandr[1].Ù–å¯ä»¥é€šè¿‡åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®æ‰€éœ€çš„åˆ†è¾¨ç‡ï¼Œæˆ–åœ¨å¯åŠ¨ X æœåŠ¡å™¨åä½¿ç”¨ man:xrandr[1] æ¥é€‰æ‹©æ˜¾ç¤ºå™¨æ”¯æŒçš„å…¶ä»–åˆ†è¾¨ç‡ã€‚¿Using RandR (Resize and Rotate)Ù ä½¿ç”¨ RandR (Resize and Rotate)ÙcRun man:xrandr[1] without any parameters to see a list of video outputs and detected monitor modes:Ùrè¿è¡Œ man:xrandr[1] å‘½ä»¤ï¼Œä¸å¸¦ä»»ä½•å‚æ•°ï¼Œå¯ä»¥æŸ¥çœ‹è§†é¢‘è¾“å‡ºå’Œæ£€æµ‹åˆ°çš„æ˜¾ç¤ºå™¨æ¨¡å¼åˆ—è¡¨ï¼šÚgThis shows that the `VGA-1` output is being used to display a screen resolution of 1280x960 pixels at a refresh rate of about 60 Hz.  The `LVDS-1` is being used as a secondary monitor to display a screen resolution of 1280x800 pixels at a refresh rate of about 60 Hz.  Monitors are not attached to the `HDMI-1`, `HDMI-2`, `DP-1`, `DP-2` and `DP-3` connectors.Ú+è¿™è¡¨æ˜ `VGA-1` è¾“å‡ºæ­£åœ¨ç”¨äºæ˜¾ç¤ºåˆ†è¾¨ç‡ä¸º 1280x960 åƒç´ ã€åˆ·æ–°ç‡çº¦ä¸º 60 Hz çš„å±å¹•ã€‚`LVDS-1` è¢«ç”¨ä½œè¾…åŠ©æ˜¾ç¤ºå™¨ï¼Œæ˜¾ç¤ºåˆ†è¾¨ç‡ä¸º 1280x800 åƒç´ ã€åˆ·æ–°ç‡çº¦ä¸º 60 Hz çš„å±å¹•ã€‚`HDMI-1`ã€`HDMI-2`ã€`DP-1`ã€`DP-2` å’Œ `DP-3` è¿æ¥å™¨ä¸Šæ²¡æœ‰è¿æ¥æ˜¾ç¤ºå™¨ã€‚ÙqAny of the other display modes can be selected with man:xrandr[1].  For example, to switch to 1280x1024 at 60 Hz:Ùå¯ä»¥ä½¿ç”¨ man:xrandr[1] é€‰æ‹©ä»»ä½•å…¶ä»–çš„æ˜¾ç¤ºæ¨¡å¼ã€‚ä¾‹å¦‚ï¼Œè¦åˆ‡æ¢åˆ° 1280x1024 åˆ†è¾¨ç‡ï¼Œåˆ·æ–°ç‡ä¸º 60 Hz ï¼šÙ!Using the Xorg configuration file¸ä½¿ç”¨ Xorg é…ç½®æ–‡ä»¶ÙBThe monitor configuration can also be set in a configuration file.Ù9ç›‘è§†å™¨é…ç½®ä¹Ÿå¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œè®¾ç½®ã€‚Ù?To set a screen resolution of 1024x768 in a configuration file:Ù7åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®å±å¹•åˆ†è¾¨ç‡ä¸º 1024x768 ï¼š¿Set Screen Resolution in a FileÙ!åœ¨æ–‡ä»¶ä¸­è®¾ç½®å±å¹•åˆ†è¾¨ç‡­Input Devices¬è¾“å…¥è®¾å¤‡ÙLXorg supports the vast majority of input devices via package:x11/libinput[].ÙDXorg é€šè¿‡ package:x11/libinput[] æ”¯æŒç»å¤§éƒ¨åˆ†è¾“å…¥è®¾å¤‡ã€‚Ù°Some desktop environments (such as KDE Plasma) provide a graphical UI for setting these parameters.  Check if this is the case before resorting to manual configuration editing.Ù¡ä¸€äº›æ¡Œé¢ç¯å¢ƒï¼ˆå¦‚ KDE Plasmaï¼‰æä¾›äº†ç”¨äºè®¾ç½®è¿™äº›å‚æ•°çš„å›¾å½¢ç•Œé¢ã€‚åœ¨å°è¯•æ‰‹åŠ¨é…ç½®ç¼–è¾‘ä¹‹å‰ï¼Œè¯·æ£€æŸ¥æ˜¯å¦æœ‰è¿™æ ·çš„ç•Œé¢ã€‚Ù.For example, to configure the keyboard layout:Ù!ä¾‹å¦‚ï¼Œè¦é…ç½®é”®ç›˜å¸ƒå±€ï¼š¹Setting a Keyboard Layout²è®¾ç½®é”®ç›˜å¸ƒå±€³Using Fonts in Xorg¸åœ¨ Xorg ä¸­ä½¿ç”¨å­—ä½“Ú[The default fonts that ship with Xorg are less than ideal for typical desktop publishing applications.  Large presentation fonts show up jagged and unprofessional looking, and small fonts are almost completely unintelligible.  However, there are several free, high quality Type1 (PostScript(R)) fonts available which can be readily used with Xorg.ÚXorg é»˜è®¤æä¾›çš„å­—ä½“å¯¹äºå…¸å‹çš„æ¡Œé¢å‡ºç‰ˆåº”ç”¨æ¥è¯´å¹¶ä¸ç†æƒ³ã€‚å¤§å·æ¼”ç¤ºå­—ä½“æ˜¾ç¤ºå‡ºæ¥ä¼šæœ‰é”¯é½¿çŠ¶ï¼Œä¸å¤Ÿä¸“ä¸šï¼Œè€Œå°å·å­—ä½“å‡ ä¹å®Œå…¨æ— æ³•è¾¨è®¤ã€‚ç„¶è€Œï¼Œæœ‰å‡ ç§å…è´¹çš„é«˜è´¨é‡ Type1 (PostScript(R)) å­—ä½“å¯ä¾›åœ¨ Xorg ä¸­æ–¹ä¾¿åœ°ä½¿ç”¨ã€‚«Type1 Fonts¬Type1 å­—ä½“Ú The URW font collection (package:x11-fonts/urwfonts[]) includes high quality versions of standard type1 fonts (Times Roman(TM), Helvetica(TM), Palatino(TM) and others).  The Freefonts collection (package:x11-fonts/freefonts[]) includes many more fonts, but most of them are intended for use in graphics software such as the Gimp, and are not complete enough to serve as screen fonts.  In addition, Xorg can be configured to use TrueType(R) fonts with a minimum of effort.  For more details on this, see the man:X[7] manual page or <<truetype>>.ÚÃURW å­—ä½“é›†åˆ (package:x11-fonts/urwfonts[]) åŒ…æ‹¬æ ‡å‡† Type1 å­—ä½“ (Times Roman(TM)ï¼ŒHelvetica(TM)ï¼ŒPalatino(TM) ç­‰ï¼‰çš„é«˜è´¨é‡ç‰ˆæœ¬ã€‚Freefonts é›†åˆ (package:x11-fonts/freefonts[]) åŒ…æ‹¬æ›´å¤šå­—ä½“ï¼Œä½†å¤§éƒ¨åˆ†æ˜¯ä¸ºå›¾å½¢è½¯ä»¶ï¼ˆå¦‚ Gimpï¼‰ä½¿ç”¨çš„ï¼Œå¹¶ä¸å®Œæ•´ï¼Œä¸èƒ½ç”¨ä½œå±å¹•å­—ä½“ã€‚æ­¤å¤–ï¼ŒXorg å¯ä»¥é…ç½®ä¸ºè½»æ¾ä½¿ç”¨ TrueType(R) å­—ä½“ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… man:X[7] æ‰‹å†Œé¡µé¢æˆ– <<truetype>>ã€‚Ù]To install the above Type1 font collections from binary packages, run the following commands:ÙXè¦å®‰è£…ä¸Šè¿°çš„ Type1 å­—ä½“é›†åˆï¼Œå¯ä»¥è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥å®‰è£…äºŒè¿›åˆ¶åŒ…ï¼šÙãAnd likewise with the freefont or other collections.  To have the X server detect these fonts, add an appropriate line to the X server configuration file ([.filename]#/usr/local/etc/X11/xorg.conf.d/90-fonts.conf#), which reads:ÙòåŒæ ·ï¼Œå¯¹äº freefont æˆ–å…¶ä»–å­—ä½“é›†åˆä¹Ÿæ˜¯å¦‚æ­¤ã€‚è¦è®© X æœåŠ¡å™¨æ£€æµ‹è¿™äº›å­—ä½“ï¼Œéœ€è¦åœ¨ X æœåŠ¡å™¨é…ç½®æ–‡ä»¶ ([.filename]#/usr/local/etc/X11/xorg.conf.d/90-fonts.conf#) ä¸­æ·»åŠ ä¸€è¡Œé€‚å½“çš„å†…å®¹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼šÙ8Alternatively, at the command line in the X session run:Ù-æˆ–è€…ï¼Œåœ¨ X ä¼šè¯çš„å‘½ä»¤è¡Œä¸­è¿è¡Œï¼šÚcThis will work but will be lost when the X session is closed, unless it is added to the startup file ([.filename]#~/.xinitrc# for a normal `startx` session, or [.filename]#~/.xsession# when logging in through a graphical login manager like XDM).  A third way is to use the new [.filename]#/usr/local/etc/fonts/local.conf# as demonstrated in <<antialias>>.Únè¿™å°†èµ·ä½œç”¨ï¼Œä½†åœ¨ X ä¼šè¯å…³é—­æ—¶å°†ä¸¢å¤±ï¼Œé™¤éå°†å…¶æ·»åŠ åˆ°å¯åŠ¨æ–‡ä»¶ï¼ˆå¯¹äºæ™®é€šçš„ `startx` ä¼šè¯ï¼Œä¸º [.filename]#~/.xinitrc#ï¼Œæˆ–è€…å¯¹äºé€šè¿‡å›¾å½¢ç™»å½•ç®¡ç†å™¨ï¼ˆå¦‚ XDMï¼‰ç™»å½•çš„æƒ…å†µï¼Œä¸º [.filename]#~/.xsession#ï¼‰ã€‚ç¬¬ä¸‰ç§æ–¹æ³•æ˜¯ä½¿ç”¨æ–°çš„ [.filename]#/usr/local/etc/fonts/local.conf#ï¼Œå¦‚ <<antialias>> ä¸­æ‰€ç¤ºã€‚±TrueType(R) Fonts²TrueType(R) å­—ä½“Ú†Xorg has built in support for rendering TrueType(R) fonts.  There are two different modules that can enable this functionality.  The freetype module is used in this example because it is more consistent with the other font rendering back-ends.  To enable the freetype module just add the following line to the `"Module"` section of [.filename]#/usr/local/etc/X11/xorg.conf.d/90-fonts.conf#.ÚWXorg å†…ç½®äº†å¯¹ TrueType(R) å­—ä½“çš„æ¸²æŸ“æ”¯æŒã€‚æœ‰ä¸¤ä¸ªä¸åŒçš„æ¨¡å—å¯ä»¥å¯ç”¨è¿™ä¸ªåŠŸèƒ½ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ä½¿ç”¨ freetype æ¨¡å—ï¼Œå› ä¸ºå®ƒä¸å…¶ä»–å­—ä½“æ¸²æŸ“åç«¯æ›´åŠ ä¸€è‡´ã€‚è¦å¯ç”¨ freetype æ¨¡å—ï¼Œåªéœ€å°†ä»¥ä¸‹è¡Œæ·»åŠ åˆ° [.filename]#/usr/local/etc/X11/xorg.conf.d/90-fonts.conf# æ–‡ä»¶çš„ `"Module"` éƒ¨åˆ†ã€‚Ú%Now make a directory for the TrueType(R) fonts (for example, [.filename]#/usr/local/share/fonts/TrueType#) and copy all of the TrueType(R) fonts into this directory.  Keep in mind that TrueType(R) fonts cannot be directly taken from an Apple(R) Mac(R); they must be in UNIX(R)/MS-DOS(R)/Windows(R) format for use by Xorg.  Once the files have been copied into this directory, use mkfontscale to create a [.filename]#fonts.dir#, so that the X font renderer knows that these new files have been installed.  `mkfontscale` can be installed as a package:Ú"ç°åœ¨åˆ›å»ºä¸€ä¸ªç”¨äº TrueType(R) å­—ä½“çš„ç›®å½•ï¼ˆä¾‹å¦‚ï¼Œ[.filename]#/usr/local/share/fonts/TrueType#ï¼‰ï¼Œå¹¶å°†æ‰€æœ‰çš„ TrueType(R) å­—ä½“å¤åˆ¶åˆ°è¯¥ç›®å½•ä¸­ã€‚è¯·è®°ä½ï¼ŒTrueType(R) å­—ä½“ä¸èƒ½ç›´æ¥ä» Apple(R) Mac(R) ä¸­è·å–ï¼›å®ƒä»¬å¿…é¡»ä»¥ UNIX(R)/MS-DOS(R)/Windows(R) æ ¼å¼å­˜åœ¨ï¼Œä»¥ä¾› Xorg ä½¿ç”¨ã€‚ä¸€æ—¦æ–‡ä»¶è¢«å¤åˆ¶åˆ°è¯¥ç›®å½•ä¸­ï¼Œä½¿ç”¨ mkfontscale åˆ›å»ºä¸€ä¸ª [.filename]#fonts.dir# æ–‡ä»¶ï¼Œä»¥ä¾¿ X å­—ä½“æ¸²æŸ“å™¨çŸ¥é“è¿™äº›æ–°æ–‡ä»¶å·²ç»å®‰è£…ã€‚`mkfontscale` å¯ä»¥ä½œä¸ºä¸€ä¸ªè½¯ä»¶åŒ…è¿›è¡Œå®‰è£…ï¼šÙ4Then create an index of X font files in a directory:Ù9ç„¶ååœ¨ä¸€ä¸ªç›®å½•ä¸­åˆ›å»º X å­—ä½“æ–‡ä»¶çš„ç´¢å¼•ï¼šÙeNow add the TrueType(R) directory to the font path.  This is just the same as described in <<type1>>:Ùiç°åœ¨å°† TrueType(R) ç›®å½•æ·»åŠ åˆ°å­—ä½“è·¯å¾„ä¸­ã€‚è¿™ä¸ <<type1>> ä¸­æè¿°çš„æ–¹å¼å®Œå…¨ç›¸åŒã€‚Ù3or add a `FontPath` line to [.filename]#xorg.conf#.ÙHæˆ–è€…åœ¨ [.filename]#xorg.conf# æ–‡ä»¶ä¸­æ·»åŠ ä¸€ä¸ª `FontPath` è¡Œã€‚ÚNow Gimp, LibreOffice, and all of the other X applications should now recognize the installed TrueType(R) fonts.  Extremely small fonts (as with text in a high resolution display on a web page) and extremely large fonts (within LibreOffice) will look much better now.Ùğç°åœ¨ï¼ŒGimpã€LibreOffice å’Œæ‰€æœ‰å…¶ä»– X åº”ç”¨ç¨‹åºåº”è¯¥èƒ½å¤Ÿè¯†åˆ«å·²å®‰è£…çš„ TrueType(R) å­—ä½“ã€‚ç°åœ¨ï¼Œåœ¨é«˜åˆ†è¾¨ç‡æ˜¾ç¤ºå™¨ä¸Šçš„ç½‘é¡µæ–‡æœ¬ä¸­çš„æå°å­—ä½“ä»¥åŠ LibreOffice ä¸­çš„æå¤§å­—ä½“å°†ä¼šçœ‹èµ·æ¥æ›´å¥½ã€‚²Anti-Aliased Fonts¯æŠ—é”¯é½¿å­—ä½“ÙüAll fonts in Xorg that are found in [.filename]#/usr/local/share/fonts/# and [.filename]#~/.fonts/# are automatically made available for anti-aliasing to Xft-aware applications. Most recent applications are Xft-aware, including KDE, GNOME, and Firefox.Úåœ¨ Xorg ä¸­ï¼Œæ‰€æœ‰åœ¨ [.filename]#/usr/local/share/fonts/# å’Œ [.filename]#~/.fonts/# ç›®å½•ä¸­æ‰¾åˆ°çš„å­—ä½“éƒ½ä¼šè‡ªåŠ¨æä¾›ç»™æ”¯æŒ Xft-aware çš„åº”ç”¨ç¨‹åºè¿›è¡Œåé”¯é½¿å¤„ç†ã€‚å¤§å¤šæ•°æœ€æ–°çš„åº”ç”¨ç¨‹åºéƒ½æ”¯æŒ Xft-awareï¼ŒåŒ…æ‹¬ KDEã€GNOME å’Œ Firefoxã€‚ÚhTo control which fonts are anti-aliased, or to configure anti-aliasing properties, create (or edit, if it already exists) the file [.filename]#/usr/local/etc/fonts/local.conf#.  Several advanced features of the Xft font system can be tuned using this file; this section describes only some simple possibilities.  For more details, please see man:fonts-conf[5].Ú@è¦æ§åˆ¶åé”¯é½¿çš„å­—ä½“æˆ–é…ç½®åé”¯é½¿å±æ€§ï¼Œè¯·åˆ›å»ºï¼ˆæˆ–ç¼–è¾‘ï¼Œå¦‚æœå·²å­˜åœ¨ï¼‰æ–‡ä»¶ [.filename]#/usr/local/etc/fonts/local.conf#ã€‚å¯ä»¥ä½¿ç”¨æ­¤æ–‡ä»¶è°ƒæ•´ Xft å­—ä½“ç³»ç»Ÿçš„å‡ ä¸ªé«˜çº§åŠŸèƒ½ï¼›æœ¬èŠ‚ä»…æè¿°äº†ä¸€äº›ç®€å•çš„å¯èƒ½æ€§ã€‚æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… man:fonts-conf[5]ã€‚ÙÚThis file must be in XML format.  Pay careful attention to case, and make sure all tags are properly closed.  The file begins with the usual XML header followed by a DOCTYPE definition, and then the `<fontconfig>` tag:ÙÅè¿™ä¸ªæ–‡ä»¶å¿…é¡»æ˜¯ XML æ ¼å¼çš„ã€‚è¯·æ³¨æ„å¤§å°å†™ï¼Œå¹¶ç¡®ä¿æ‰€æœ‰æ ‡ç­¾éƒ½æ­£ç¡®é—­åˆã€‚æ–‡ä»¶ä»¥é€šå¸¸çš„ XML å¤´éƒ¨å¼€å§‹ï¼Œæ¥ç€æ˜¯ DOCTYPE å®šä¹‰ï¼Œç„¶åæ˜¯ `<fontconfig>` æ ‡ç­¾ã€‚Ú%As previously stated, all fonts in [.filename]#/usr/local/share/fonts/# as well as [.filename]#~/.fonts/# are already made available to Xft-aware applications.  To add another directory outside of these two directory trees, add a line like this to [.filename]#/usr/local/etc/fonts/local.conf#:Ú=å¦‚å‰æ‰€è¿°ï¼Œä½äº [.filename]#/usr/local/share/fonts/# å’Œ [.filename]#~/.fonts/# ç›®å½•ä¸­çš„æ‰€æœ‰å­—ä½“å·²ç»å¯ä»¥åœ¨æ”¯æŒ Xft-aware çš„åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ã€‚å¦‚æœè¦æ·»åŠ ä¸€ä¸ªä½äºè¿™ä¸¤ä¸ªç›®å½•æ ‘ä¹‹å¤–çš„ç›®å½•ï¼Œå¯ä»¥åœ¨ [.filename]#/usr/local/etc/fonts/local.conf# æ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹ä¸€è¡Œï¼šÙUAfter adding new fonts, and especially new font directories, rebuild the font caches:ÙQåœ¨æ·»åŠ æ–°å­—ä½“ï¼Œå°¤å…¶æ˜¯æ–°çš„å­—ä½“ç›®å½•åï¼Œé‡æ–°æ„å»ºå­—ä½“ç¼“å­˜ï¼šÚAnti-aliasing makes borders slightly fuzzy, which makes very small text more readable and removes "staircases" from large text, but can cause eyestrain if applied to normal text.  To exclude font sizes smaller than 14 point from anti-aliasing, include these lines:ÚæŠ—é”¯é½¿ä¼šä½¿è¾¹ç•Œç•¥å¾®æ¨¡ç³Šï¼Œè¿™ä½¿å¾—éå¸¸å°çš„æ–‡æœ¬æ›´æ˜“è¯»ï¼Œå¹¶æ¶ˆé™¤äº†å¤§æ–‡æœ¬ä¸Šçš„â€œé˜¶æ¢¯çŠ¶â€æ•ˆæœï¼Œä½†å¦‚æœåº”ç”¨äºæ™®é€šæ–‡æœ¬ï¼Œå¯èƒ½ä¼šå¯¼è‡´çœ¼éƒ¨ç–²åŠ³ã€‚è¦æ’é™¤å°äº 14 ç‚¹å­—å·çš„å­—ä½“åº”ç”¨æŠ—é”¯é½¿ï¼ŒåŒ…æ‹¬ä»¥ä¸‹å‡ è¡Œä»£ç ï¼šÙÛSpacing for some monospaced fonts might also be inappropriate with anti-aliasing.  This seems to be an issue with KDE, in particular.  One possible fix is to force the spacing for such fonts to be 100.  Add these lines:ÙÓå¯¹äºæŸäº›ç­‰å®½å­—ä½“ï¼Œä½¿ç”¨åé”¯é½¿å¯èƒ½ä¼šå¯¼è‡´é—´è·ä¸åˆé€‚ã€‚è¿™ä¼¼ä¹æ˜¯ KDE ç‰¹åˆ«å­˜åœ¨çš„é—®é¢˜ã€‚ä¸€ä¸ªå¯èƒ½çš„è§£å†³æ–¹æ³•æ˜¯å¼ºåˆ¶å°†è¿™äº›å­—ä½“çš„é—´è·è®¾ç½®ä¸º 100 ã€‚æ·»åŠ ä»¥ä¸‹è¡Œï¼šÙP(this aliases the other common names for fixed fonts as `"mono"`), and then add:ÙQï¼ˆè¿™å°†å…¶ä»–å¸¸è§çš„å›ºå®šå­—ä½“åç§°åˆ«åä¸º `"mono"`ï¼‰ï¼Œç„¶åæ·»åŠ ï¼šÚCertain fonts, such as Helvetica, may have a problem when anti-aliased.  Usually this manifests itself as a font that seems cut in half vertically.  At worst, it may cause applications to crash.  To avoid this, consider adding the following to [.filename]#local.conf#:ÚæŸäº›å­—ä½“ï¼Œæ¯”å¦‚ Helveticaï¼Œåœ¨åé”¯é½¿å¤„ç†æ—¶å¯èƒ½ä¼šå‡ºç°é—®é¢˜ã€‚é€šå¸¸è¡¨ç°ä¸ºå­—ä½“åœ¨å‚ç›´æ–¹å‘ä¸Šè¢«åˆ‡å‰²äº†ä¸€åŠã€‚æœ€ç³Ÿç³•çš„æƒ…å†µä¸‹ï¼Œå¯èƒ½ä¼šå¯¼è‡´åº”ç”¨ç¨‹åºå´©æºƒã€‚ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œè€ƒè™‘å°†ä»¥ä¸‹å†…å®¹æ·»åŠ åˆ° .local.conf æ–‡ä»¶ä¸­ï¼šÙ“After editing [.filename]#local.conf#, make certain to end the file with the `</fontconfig>` tag.  Not doing this will cause changes to be ignored.ÙŠåœ¨ç¼–è¾‘ [.filename]#local.conf# åï¼Œç¡®ä¿ç”¨ `</fontconfig>` æ ‡ç­¾ç»“æŸæ–‡ä»¶ã€‚å¦‚æœä¸è¿™æ ·åšï¼Œå°†ä¼šå¿½ç•¥æ‰€åšçš„æ›´æ”¹ã€‚ÙUsers can add personalized settings by creating their own [.filename]#~/.config/fontconfig/fonts.conf#.  This file uses the same `XML` format described above.Ù§ç”¨æˆ·å¯ä»¥é€šè¿‡åˆ›å»ºè‡ªå·±çš„ [.filename]#~/.config/fontconfig/fonts.conf# æ–‡ä»¶æ¥æ·»åŠ ä¸ªæ€§åŒ–è®¾ç½®ã€‚è¯¥æ–‡ä»¶ä½¿ç”¨ä¸Šè¿°æè¿°çš„ç›¸åŒçš„ `XML` æ ¼å¼ã€‚Ú+One last point: with an LCD screen, sub-pixel sampling may be desired.  This basically treats the (horizontally separated) red, green and blue components separately to improve the horizontal resolution; the results can be dramatic.  To enable this, add the line somewhere in [.filename]#local.conf#:Ú/æœ€åä¸€ä¸ªè¦ç‚¹ï¼šå¯¹äº LCD å±å¹•ï¼Œå¯èƒ½éœ€è¦è¿›è¡Œäºšåƒç´ é‡‡æ ·ã€‚è¿™åŸºæœ¬ä¸Šæ˜¯å°†ï¼ˆæ°´å¹³åˆ†ç¦»çš„ï¼‰çº¢è‰²ã€ç»¿è‰²å’Œè“è‰²åˆ†é‡åˆ†åˆ«å¤„ç†ï¼Œä»¥æé«˜æ°´å¹³åˆ†è¾¨ç‡ï¼›ç»“æœå¯èƒ½éå¸¸æ˜¾è‘—ã€‚è¦å¯ç”¨æ­¤åŠŸèƒ½ï¼Œè¯·åœ¨ [.filename]#local.conf# ä¸­çš„æŸä¸ªä½ç½®æ·»åŠ ä»¥ä¸‹è¡Œï¼šÙDepending on the sort of display, `rgb` may need to be changed to `bgr`, `vrgb` or `vbgr`: experiment and see which works best.Ùæ ¹æ®æ˜¾ç¤ºå™¨çš„ç±»å‹ï¼Œå¯èƒ½éœ€è¦å°† `rgb` æ›´æ”¹ä¸º `bgr`ã€`vrgb` æˆ– `vbgr`ï¼šè¿›è¡Œå®éªŒå¹¶æŸ¥çœ‹å“ªç§æ•ˆæœæœ€å¥½ã€‚Ù‚For more information about how to install and configure fonts on FreeBSD, please read the article link:{fonts}[Fonts and FreeBSD].Ùnæœ‰å…³åœ¨ FreeBSD ä¸Šå®‰è£…å’Œé…ç½®å­—ä½“çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·é˜…è¯»æ–‡ç«  link:{fonts}[å­—ä½“å’Œ FreeBSD]ã€‚ÙlZFS is an advanced file system designed to solve major problems found in previous storage subsystem softwareÙgZFS æ˜¯ä¸€ç§å…ˆè¿›çš„æ–‡ä»¶ç³»ç»Ÿï¼Œæ—¨åœ¨è§£å†³ä»¥å‰å­˜å‚¨å­ç³»ç»Ÿè½¯ä»¶ä¸­å­˜åœ¨çš„ä¸»è¦é—®é¢˜ã€‚Ù#Chapter 22. The Z File System (ZFS)Ù"ç¬¬ 22 ç«  Z æ–‡ä»¶ç³»ç»Ÿï¼ˆZFSï¼‰·The Z File System (ZFS)·Z æ–‡ä»¶ç³»ç»Ÿï¼ˆZFSï¼‰ÙmZFS is an advanced file system designed to solve major problems found in previous storage subsystem software.ÙgZFS æ˜¯ä¸€ç§å…ˆè¿›çš„æ–‡ä»¶ç³»ç»Ÿï¼Œæ—¨åœ¨è§£å†³ä»¥å‰å­˜å‚¨å­ç³»ç»Ÿè½¯ä»¶ä¸­å­˜åœ¨çš„ä¸»è¦é—®é¢˜ã€‚Ù{Originally developed at Sun(TM), ongoing open source ZFS development has moved to the http://open-zfs.org[OpenZFS Project].Ùnæœ€åˆç”± Sun(TM) å¼€å‘ï¼ŒæŒç»­çš„å¼€æº ZFS å¼€å‘å·²ç»è½¬ç§»åˆ°äº† http://open-zfs.org[OpenZFS é¡¹ç›®]ã€‚Ù!ZFS has three major design goals:Ù%ZFS æœ‰ä¸‰ä¸ªä¸»è¦çš„è®¾è®¡ç›®æ ‡ï¼šÚ|Data integrity: All data includes a <<zfs-term-checksum,checksum>> of the data. ZFS calculates checksums and writes them along with the data. When reading that data later, ZFS recalculates the checksums. If the checksums do not match, meaning detecting one or more data errors, ZFS will attempt to automatically correct errors when ditto-, mirror-, or parity-blocks are available.ÚAæ•°æ®å®Œæ•´æ€§ï¼šæ‰€æœ‰æ•°æ®éƒ½åŒ…å«æ•°æ®çš„æ ¡éªŒå’Œã€‚ZFS ä¼šè®¡ç®—æ ¡éªŒå’Œå¹¶å°†å…¶ä¸æ•°æ®ä¸€èµ·å†™å…¥ã€‚å½“ä»¥åè¯»å–è¯¥æ•°æ®æ—¶ï¼ŒZFS ä¼šé‡æ–°è®¡ç®—æ ¡éªŒå’Œã€‚å¦‚æœæ ¡éªŒå’Œä¸åŒ¹é…ï¼Œå³æ£€æµ‹åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªæ•°æ®é”™è¯¯ï¼ŒZFS å°†å°è¯•åœ¨å¯ç”¨çš„å‰¯æœ¬ã€é•œåƒæˆ–å¥‡å¶å—æ—¶è‡ªåŠ¨çº æ­£é”™è¯¯ã€‚ÙÛPooled storage: adding physical storage devices to a pool, and allocating storage space from that shared pool. Space is available to all file systems and volumes, and increases by adding new storage devices to the pool.ÙÏæ±‡é›†å­˜å‚¨ï¼šå°†ç‰©ç†å­˜å‚¨è®¾å¤‡æ·»åŠ åˆ°ä¸€ä¸ªæ± ä¸­ï¼Œå¹¶ä»è¯¥å…±äº«æ± ä¸­åˆ†é…å­˜å‚¨ç©ºé—´ã€‚ç©ºé—´å¯ä¾›æ‰€æœ‰æ–‡ä»¶ç³»ç»Ÿå’Œå·ä½¿ç”¨ï¼Œå¹¶é€šè¿‡åœ¨æ± ä¸­æ·»åŠ æ–°çš„å­˜å‚¨è®¾å¤‡æ¥å¢åŠ ç©ºé—´ã€‚ÚPerformance: caching mechanisms provide increased performance. <<zfs-term-arc,ARC>> is an advanced memory-based read cache. ZFS provides a second level disk-based read cache with <<zfs-term-l2arc,L2ARC>>, and a disk-based synchronous write cache named <<zfs-term-zil,ZIL>>.Úæ€§èƒ½ï¼šç¼“å­˜æœºåˆ¶æä¾›äº†æ›´é«˜çš„æ€§èƒ½ã€‚<<zfs-term-arc,ARC>> æ˜¯ä¸€ç§å…ˆè¿›çš„åŸºäºå†…å­˜çš„è¯»å–ç¼“å­˜ã€‚ZFS æä¾›äº†ç¬¬äºŒçº§åŸºäºç£ç›˜çš„è¯»å–ç¼“å­˜ <<zfs-term-l2arc,L2ARC>> ï¼Œä»¥åŠä¸€ç§åŸºäºç£ç›˜çš„åŒæ­¥å†™å…¥ç¼“å­˜ï¼Œåä¸º <<zfs-term-zil,ZIL>>ã€‚Ù?A complete list of features and terminology is in <<zfs-term>>.Ù7å®Œæ•´çš„åŠŸèƒ½å’Œæœ¯è¯­åˆ—è¡¨è¯·å‚è§ <<zfs-term>>ã€‚¸What Makes ZFS Different¶ZFS æœ‰ä½•ä¸åŒä¹‹å¤„ÚGMore than a file system, ZFS is fundamentally different from traditional file systems.  Combining the traditionally separate roles of volume manager and file system provides ZFS with unique advantages.  The file system is now aware of the underlying structure of the disks.  Traditional file systems could exist on a single disk alone at a time.  If there were two disks then creating two separate file systems was necessary.  A traditional hardware RAID configuration avoided this problem by presenting the operating system with a single logical disk made up of the space provided by physical disks on top of which the operating system placed a file system.  Even with software RAID solutions like those provided by GEOM, the UFS file system living on top of the RAID believes it's dealing with a single device.  ZFS' combination of the volume manager and the file system solves this and allows the creation of file systems that all share a pool of available storage.  One big advantage of ZFS' awareness of the physical disk layout is that existing file systems grow automatically when adding extra disks to the pool.  This new space then becomes available to the file systems.  ZFS can also apply different properties to each file system. This makes it useful to create separate file systems and datasets instead of a single monolithic file system.ÚZFS ä¸ä»…ä»…æ˜¯ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œå®ƒåœ¨æ ¹æœ¬ä¸Šä¸ä¼ ç»Ÿçš„æ–‡ä»¶ç³»ç»Ÿæœ‰æ‰€ä¸åŒã€‚å°†å·ç®¡ç†å™¨å’Œæ–‡ä»¶ç³»ç»Ÿçš„ä¼ ç»Ÿåˆ†ç¦»è§’è‰²ç»“åˆèµ·æ¥ï¼Œä¸º ZFS æä¾›äº†ç‹¬ç‰¹çš„ä¼˜åŠ¿ã€‚æ–‡ä»¶ç³»ç»Ÿç°åœ¨èƒ½å¤Ÿæ„è¯†åˆ°åº•å±‚ç£ç›˜çš„ç»“æ„ã€‚ä¼ ç»Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸€æ¬¡åªèƒ½å­˜åœ¨äºå•ä¸ªç£ç›˜ä¸Šã€‚å¦‚æœæœ‰ä¸¤ä¸ªç£ç›˜ï¼Œé‚£ä¹ˆå°±éœ€è¦åˆ›å»ºä¸¤ä¸ªå•ç‹¬çš„æ–‡ä»¶ç³»ç»Ÿã€‚ä¼ ç»Ÿçš„ç¡¬ä»¶ RAID é…ç½®é€šè¿‡å°†æ“ä½œç³»ç»Ÿå‘ˆç°ä¸ºç”±ç‰©ç†ç£ç›˜æä¾›çš„ç©ºé—´ç»„æˆçš„å•ä¸ªé€»è¾‘ç£ç›˜æ¥é¿å…è¿™ä¸ªé—®é¢˜ï¼Œæ“ä½œç³»ç»Ÿåœ¨å…¶ä¸Šæ”¾ç½®ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿã€‚å³ä½¿ä½¿ç”¨åƒ GEOM æä¾›çš„è½¯ä»¶ RAID è§£å†³æ–¹æ¡ˆï¼Œä½äº RAID ä¹‹ä¸Šçš„ UFS æ–‡ä»¶ç³»ç»Ÿä¹Ÿè®¤ä¸ºå®ƒæ­£åœ¨å¤„ç†ä¸€ä¸ªå•ä¸€è®¾å¤‡ã€‚ ZFS çš„å·ç®¡ç†å™¨å’Œæ–‡ä»¶ç³»ç»Ÿçš„ç»„åˆè§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œå¹¶å…è®¸åˆ›å»ºå…±äº«å¯ç”¨å­˜å‚¨æ± çš„æ–‡ä»¶ç³»ç»Ÿã€‚ ZFS æ„è¯†åˆ°ç‰©ç†ç£ç›˜å¸ƒå±€çš„ä¸€ä¸ªé‡è¦ä¼˜åŠ¿æ˜¯ï¼Œå½“å‘æ± ä¸­æ·»åŠ é¢å¤–çš„ç£ç›˜æ—¶ï¼Œç°æœ‰çš„æ–‡ä»¶ç³»ç»Ÿä¼šè‡ªåŠ¨å¢é•¿ã€‚ç„¶åï¼Œè¿™ä¸ªæ–°ç©ºé—´å°±å¯ä»¥ä¾›æ–‡ä»¶ç³»ç»Ÿä½¿ç”¨ã€‚ ZFS è¿˜å¯ä»¥ä¸ºæ¯ä¸ªæ–‡ä»¶ç³»ç»Ÿåº”ç”¨ä¸åŒçš„å±æ€§ã€‚è¿™ä½¿å¾—åˆ›å»ºå•ç‹¬çš„æ–‡ä»¶ç³»ç»Ÿå’Œæ•°æ®é›†æ¯”åˆ›å»ºå•ä¸ªçš„æ•´ä½“æ–‡ä»¶ç³»ç»Ÿæ›´æœ‰ç”¨ã€‚±Quick Start Guide²å¿«é€Ÿå…¥é—¨æŒ‡å—ÙFreeBSD can mount ZFS pools and datasets during system initialization.  To enable it, add this line to [.filename]#/etc/rc.conf#:Ù’FreeBSD å¯ä»¥åœ¨ç³»ç»Ÿåˆå§‹åŒ–æœŸé—´æŒ‚è½½ ZFS æ± å’Œæ•°æ®é›†ã€‚è¦å¯ç”¨å®ƒï¼Œè¯·å°†ä»¥ä¸‹è¡Œæ·»åŠ åˆ° [.filename]#/etc/rc.conf#: æ–‡ä»¶ä¸­ï¼š·Then start the service:µç„¶åå¯åŠ¨æœåŠ¡ï¼šÙÎThe examples in this section assume three SCSI disks with the device names [.filename]#da0#, [.filename]#da1#, and [.filename]#da2#.  Users of SATA hardware should instead use [.filename]#ada# device names.ÙÊæœ¬èŠ‚ä¸­çš„ç¤ºä¾‹å‡è®¾æœ‰ä¸‰ä¸ª SCSI ç£ç›˜ï¼Œè®¾å¤‡åç§°åˆ†åˆ«ä¸º [.filename]#da0#ã€[.filename]#da1# å’Œ [.filename]#da2# ã€‚ä½¿ç”¨ SATA ç¡¬ä»¶çš„ç”¨æˆ·åº”è¯¥ä½¿ç”¨ [.filename]#ada# è®¾å¤‡åç§°ã€‚°Single Disk Pool¬å•ç£ç›˜æ± ÙBTo create a simple, non-redundant pool using a single disk device:Ù]è¦ä½¿ç”¨å•ä¸ªç£ç›˜è®¾å¤‡åˆ›å»ºä¸€ä¸ªç®€å•ä¸”éå†—ä½™çš„æ± ï¼Œè¯·æŒ‰ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼šÙ0To view the new pool, review the output of `df`:Ù<è¦æŸ¥çœ‹æ–°çš„å­˜å‚¨æ± ï¼Œè¯·æŸ¥çœ‹ `df` å‘½ä»¤çš„è¾“å‡ºï¼šÙThis output shows creating and mounting of the `example` pool, and that is now accessible as a file system.  Create files for users to browse:Ù†è¿™ä¸ªè¾“å‡ºæ˜¾ç¤ºäº†åˆ›å»ºå’ŒæŒ‚è½½ `example` æ± ï¼Œå¹¶ä¸”ç°åœ¨å¯ä»¥ä½œä¸ºæ–‡ä»¶ç³»ç»Ÿè®¿é—®ã€‚ä¸ºç”¨æˆ·åˆ›å»ºæ–‡ä»¶ä»¥ä¾›æµè§ˆï¼šÙ€This pool is not using any advanced ZFS features and properties yet.  To create a dataset on this pool with compression enabled:Ùƒæ­¤æ± å°šæœªä½¿ç”¨ä»»ä½•é«˜çº§çš„ ZFS åŠŸèƒ½å’Œå±æ€§ã€‚è¦åœ¨æ­¤æ± ä¸Šåˆ›å»ºå¯ç”¨äº†å‹ç¼©çš„æ•°æ®é›†ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼šÙˆThe `example/compressed` dataset is now a ZFS compressed file system.  Try copying some large files to [.filename]#/example/compressed#.Ù`example/compressed` æ•°æ®é›†ç°åœ¨æ˜¯ä¸€ä¸ª ZFS å‹ç¼©æ–‡ä»¶ç³»ç»Ÿã€‚å°è¯•å°†ä¸€äº›å¤§æ–‡ä»¶å¤åˆ¶åˆ° `/example/compressed`ã€‚¹Disable compression with:µç¦ç”¨å‹ç¼©åŠŸèƒ½ï¼šÙETo unmount a file system, use `zfs umount` and then verify with `df`:Ù_è¦å¸è½½æ–‡ä»¶ç³»ç»Ÿï¼Œè¯·ä½¿ç”¨ `zfs umount` å‘½ä»¤ï¼Œç„¶åä½¿ç”¨ `df` å‘½ä»¤è¿›è¡ŒéªŒè¯ï¼šÙ^To re-mount the file system to make it accessible again, use `zfs mount` and verify with `df`:Ùyè¦é‡æ–°æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿä»¥ä½¿å…¶å†æ¬¡å¯è®¿é—®ï¼Œè¯·ä½¿ç”¨ `zfs mount` å‘½ä»¤ï¼Œå¹¶ä½¿ç”¨ `df` å‘½ä»¤è¿›è¡ŒéªŒè¯ï¼šÙ0Running `mount` shows the pool and file systems:Ù3è¿è¡Œ `mount` å‘½ä»¤ä¼šæ˜¾ç¤ºæ± å’Œæ–‡ä»¶ç³»ç»Ÿï¼šÚ"Use ZFS datasets like any file system after creation.  Set other available features on a per-dataset basis when needed.  The example below creates a new file system called `data`.  It assumes the file system contains important files and configures it to store two copies of each data block.Ú3åˆ›å»ºåï¼Œå¯ä»¥åƒä»»ä½•æ–‡ä»¶ç³»ç»Ÿä¸€æ ·ä½¿ç”¨ ZFS æ•°æ®é›†ã€‚æ ¹æ®éœ€è¦ï¼Œå¯ä»¥åœ¨æ¯ä¸ªæ•°æ®é›†ä¸Šè®¾ç½®å…¶ä»–å¯ç”¨çš„åŠŸèƒ½ã€‚ä¸‹é¢çš„ç¤ºä¾‹åˆ›å»ºäº†ä¸€ä¸ªåä¸º `data` çš„æ–°æ–‡ä»¶ç³»ç»Ÿã€‚å®ƒå‡è®¾è¯¥æ–‡ä»¶ç³»ç»ŸåŒ…å«é‡è¦æ–‡ä»¶ï¼Œå¹¶å°†å…¶é…ç½®ä¸ºå­˜å‚¨æ¯ä¸ªæ•°æ®å—çš„ä¸¤ä¸ªå‰¯æœ¬ã€‚Ù)Use `df` to see the data and space usage:Ù6ä½¿ç”¨ `df` å‘½ä»¤æŸ¥çœ‹æ•°æ®å’Œç©ºé—´ä½¿ç”¨æƒ…å†µï¼šÚ,Notice that all file systems in the pool have the same available space.  Using `df` in these examples shows that the file systems use the space they need and all draw from the same pool.  ZFS gets rid of concepts such as volumes and partitions, and allows several file systems to share the same pool.Úè¯·æ³¨æ„ï¼Œæ± ä¸­çš„æ‰€æœ‰æ–‡ä»¶ç³»ç»Ÿéƒ½å…·æœ‰ç›¸åŒçš„å¯ç”¨ç©ºé—´ã€‚åœ¨è¿™äº›ç¤ºä¾‹ä¸­ä½¿ç”¨ `df` å‘½ä»¤æ˜¾ç¤ºï¼Œæ–‡ä»¶ç³»ç»Ÿä½¿ç”¨å®ƒä»¬æ‰€éœ€çš„ç©ºé—´ï¼Œå¹¶ä¸”éƒ½ä»åŒä¸€ä¸ªæ± ä¸­è·å–ã€‚ ZFS æ‘’å¼ƒäº†å·å’Œåˆ†åŒºç­‰æ¦‚å¿µï¼Œå…è®¸å¤šä¸ªæ–‡ä»¶ç³»ç»Ÿå…±äº«åŒä¸€ä¸ªæ± ã€‚ÙGTo destroy the file systems and then the pool that is no longer needed:Ù*é”€æ¯ä¸å†éœ€è¦çš„æ–‡ä»¶ç³»ç»Ÿå’Œæ± ï¼šÙÕDisks fail.  One way to avoid data loss from disk failure is to use RAID.  ZFS supports this feature in its pool design.  RAID-Z pools require three or more disks but provide more usable space than mirrored pools.Ùòç£ç›˜ä¼šå‡ºç°æ•…éšœã€‚é¿å…å› ç£ç›˜æ•…éšœå¯¼è‡´æ•°æ®ä¸¢å¤±çš„ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨ RAIDã€‚ZFS åœ¨å…¶å­˜å‚¨æ± è®¾è®¡ä¸­æ”¯æŒæ­¤åŠŸèƒ½ã€‚ RAID-Z å­˜å‚¨æ± éœ€è¦ä¸‰ä¸ªæˆ–æ›´å¤šçš„ç£ç›˜ï¼Œä½†æä¾›æ¯”é•œåƒå­˜å‚¨æ± æ›´å¤šçš„å¯ç”¨ç©ºé—´ã€‚ÙLThis example creates a RAID-Z pool, specifying the disks to add to the pool:ÙMè¿™ä¸ªç¤ºä¾‹åˆ›å»ºäº†ä¸€ä¸ª RAID-Z æ± ï¼ŒæŒ‡å®šè¦æ·»åŠ åˆ°æ± ä¸­çš„ç£ç›˜ï¼šÚZSun(TM) recommends that the number of devices used in a RAID-Z configuration be between three and nine.  For environments requiring a single pool consisting of 10 disks or more, consider breaking it up into smaller RAID-Z groups.  If two disks are available, ZFS mirroring provides redundancy if required.  Refer to man:zpool[8] for more details.ÚHSun(TM) å»ºè®®åœ¨ RAID-Z é…ç½®ä¸­ä½¿ç”¨çš„è®¾å¤‡æ•°é‡åº”åœ¨ä¸‰åˆ°ä¹ä¹‹é—´ã€‚å¯¹äºéœ€è¦ç”± 10 ä¸ªæˆ–æ›´å¤šç£ç›˜ç»„æˆçš„å•ä¸ªæ± çš„ç¯å¢ƒï¼Œè€ƒè™‘å°†å…¶åˆ†æˆè¾ƒå°çš„ RAID-Z ç»„ã€‚å¦‚æœæœ‰ä¸¤ä¸ªç£ç›˜å¯ç”¨ï¼Œå¯ä»¥ä½¿ç”¨ ZFS é•œåƒæä¾›å†—ä½™æ€§ï¼ˆå¦‚æœéœ€è¦ï¼‰ã€‚æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… man:zpool[8]ã€‚ÙsThe previous example created the `storage` zpool.  This example makes a new file system called `home` in that pool:Ù‚å‰é¢çš„ç¤ºä¾‹åˆ›å»ºäº†åä¸º `storage` çš„ `zpool` ã€‚è¿™ä¸ªç¤ºä¾‹åœ¨è¯¥æ± ä¸­åˆ›å»ºäº†ä¸€ä¸ªåä¸º `home` çš„æ–°æ–‡ä»¶ç³»ç»Ÿï¼šÙDEnable compression and store an extra copy of directories and files:Ù6å¯ç”¨å‹ç¼©å¹¶å­˜å‚¨ç›®å½•å’Œæ–‡ä»¶çš„é¢å¤–å‰¯æœ¬ï¼šÙ~To make this the new home directory for users, copy the user data to this directory and create the appropriate symbolic links:Ùuè¦å°†æ­¤ç›®å½•è®¾ç½®ä¸ºç”¨æˆ·çš„æ–°å®¶ç›®å½•ï¼Œè¯·å°†ç”¨æˆ·æ•°æ®å¤åˆ¶åˆ°æ­¤ç›®å½•å¹¶åˆ›å»ºç›¸åº”çš„ç¬¦å·é“¾æ¥ï¼šÙƒUsers data is now stored on the freshly-created [.filename]#/storage/home#.  Test by adding a new user and logging in as that user.Ù‘ç”¨æˆ·æ•°æ®ç°åœ¨å­˜å‚¨åœ¨æ–°åˆ›å»ºçš„ [.filename]#/storage/home# ä¸Šã€‚é€šè¿‡æ·»åŠ ä¸€ä¸ªæ–°ç”¨æˆ·å¹¶ä»¥è¯¥ç”¨æˆ·èº«ä»½ç™»å½•æ¥è¿›è¡Œæµ‹è¯•ã€‚Ù4Create a file system snapshot to roll back to later:Ù<åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿå¿«ç…§ï¼Œä»¥ä¾¿ä»¥åå¯ä»¥å›æ»šï¼šÙCZFS creates snapshots of a dataset, not a single directory or file.Ù@ZFS åˆ›å»ºæ•°æ®é›†çš„å¿«ç…§ï¼Œè€Œä¸æ˜¯å•ä¸ªç›®å½•æˆ–æ–‡ä»¶ã€‚ÙŞThe `@` character is a delimiter between the file system name or the volume name.  Before deleting an important directory, back up the file system, then roll back to an earlier snapshot in which the directory still exists:Ù¸`@` å­—ç¬¦æ˜¯æ–‡ä»¶ç³»ç»Ÿåç§°æˆ–å·åç§°ä¹‹é—´çš„åˆ†éš”ç¬¦ã€‚åœ¨åˆ é™¤é‡è¦ç›®å½•ä¹‹å‰ï¼Œå…ˆå¤‡ä»½æ–‡ä»¶ç³»ç»Ÿï¼Œç„¶åå›æ»šåˆ°ä¸€ä¸ªæ—©æœŸçš„å¿«ç…§ï¼Œå…¶ä¸­ç›®å½•ä»ç„¶å­˜åœ¨ï¼šÙTo list all available snapshots, run `ls` in the file system's [.filename]#.zfs/snapshot# directory.  For example, to see the snapshot taken:ÙŒè¦åˆ—å‡ºæ‰€æœ‰å¯ç”¨çš„å¿«ç…§ï¼Œè¯·åœ¨æ–‡ä»¶ç³»ç»Ÿçš„ `.zfs/snapshot` ç›®å½•ä¸­è¿è¡Œ `ls` å‘½ä»¤ã€‚ä¾‹å¦‚ï¼Œè¦æŸ¥çœ‹å·²æ‹æ‘„çš„å¿«ç…§ï¼šÙWrite a script to take regular snapshots of user data.  Over time, snapshots can use up a lot of disk space.  Remove the previous snapshot using the command:Ù¨ç¼–å†™ä¸€ä¸ªè„šæœ¬æ¥å®šæœŸå¯¹ç”¨æˆ·æ•°æ®è¿›è¡Œå¿«ç…§ã€‚éšç€æ—¶é—´çš„æ¨ç§»ï¼Œå¿«ç…§å¯èƒ½ä¼šå ç”¨å¤§é‡çš„ç£ç›˜ç©ºé—´ã€‚ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆ é™¤å…ˆå‰çš„å¿«ç…§ï¼šÙ]After testing, make [.filename]#/storage/home# the real [.filename]#/home# with this command:Ùhç»è¿‡æµ‹è¯•ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å°† [.filename]#/storage/home# è®¾ç½®ä¸ºçœŸå®çš„ [.filename]#/home#ï¼šÙjRun `df` and `mount` to confirm that the system now treats the file system as the real [.filename]#/home#:Ùhè¿è¡Œ `df` å’Œ `mount` å‘½ä»¤æ¥ç¡®è®¤ç³»ç»Ÿç°åœ¨å°†æ–‡ä»¶ç³»ç»Ÿè§†ä¸ºçœŸå®çš„ [.filename]#/home# ï¼šÙ½This completes the RAID-Z configuration.  Add daily status updates about the created file systems to the nightly man:periodic[8] runs by adding this line to [.filename]#/etc/periodic.conf#:ÙÍè¿™æ ·å°±å®Œæˆäº† RAID-Z çš„é…ç½®ã€‚é€šè¿‡å°†ä»¥ä¸‹è¡Œæ·»åŠ åˆ° [.filename]#/etc/periodic.conf# ï¼Œå¯ä»¥å°†å…³äºåˆ›å»ºçš„æ–‡ä»¶ç³»ç»Ÿçš„æ¯æ—¥çŠ¶æ€æ›´æ–°æ·»åŠ åˆ°å¤œé—´çš„ man:periodic[8] è¿è¡Œä¸­ï¼š±Recovering RAID-Z­æ¢å¤ RAID-ZÙeEvery software RAID has a method of monitoring its `state`.  View the status of RAID-Z devices using:Ùnæ¯ä¸ªè½¯ä»¶ RAID éƒ½æœ‰ä¸€ç§ç›‘æ§å…¶ `state` çš„æ–¹æ³•ã€‚ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹ RAID-Z è®¾å¤‡çš„çŠ¶æ€ï¼šÙXIf all pools are <<zfs-term-online,Online>> and everything is normal, the message shows:Ùdå¦‚æœæ‰€æœ‰æ± éƒ½å¤„äº <<zfs-term-online,åœ¨çº¿>> çŠ¶æ€ï¼Œå¹¶ä¸”ä¸€åˆ‡æ­£å¸¸ï¼Œæ¶ˆæ¯å°†æ˜¾ç¤ºï¼šÙzIf there is a problem, perhaps a disk being in the <<zfs-term-offline,Offline>> state, the pool state will look like this:Ùkå¦‚æœå‡ºç°é—®é¢˜ï¼Œæ¯”å¦‚ç£ç›˜å¤„äº <<zfs-term-offline,ç¦»çº¿>> çŠ¶æ€ï¼Œæ± çš„çŠ¶æ€å°†å¦‚ä¸‹æ‰€ç¤ºï¼šÙF"OFFLINE" shows the administrator took [.filename]#da1# offline using:ÙH"OFFLINE"æ˜¾ç¤ºç®¡ç†å‘˜ä½¿ç”¨ä»¥ä¸‹æ–¹å¼å°† [.filename]#da1# ä¸‹çº¿ï¼šÙyPower down the computer now and replace [.filename]#da1#.  Power up the computer and return [.filename]#da1# to the pool:Ùqç«‹å³å…³é—­è®¡ç®—æœºå¹¶æ›´æ¢ [.filename]#da1#ã€‚é‡æ–°å¯åŠ¨è®¡ç®—æœºå¹¶å°† [.filename]#da1# è¿”å›åˆ°æ± ä¸­ï¼šÙJNext, check the status again, this time without `-x` to display all pools:ÙTæ¥ä¸‹æ¥ï¼Œå†æ¬¡æ£€æŸ¥çŠ¶æ€ï¼Œè¿™æ¬¡ä¸ä½¿ç”¨ `-x` é€‰é¡¹ä»¥æ˜¾ç¤ºæ‰€æœ‰çš„æ± ï¼šÙ&In this example, everything is normal.Ù'åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œä¸€åˆ‡éƒ½æ­£å¸¸ã€‚±Data Verification¬æ•°æ®éªŒè¯ÙmZFS uses checksums to verify the integrity of stored data.  Creating file systems automatically enables them.ÙmZFS ä½¿ç”¨æ ¡éªŒå’Œæ¥éªŒè¯å­˜å‚¨æ•°æ®çš„å®Œæ•´æ€§ã€‚åˆ›å»ºæ–‡ä»¶ç³»ç»Ÿæ—¶ä¼šè‡ªåŠ¨å¯ç”¨æ ¡éªŒå’ŒåŠŸèƒ½ã€‚ÙşDisabling Checksums is possible but _not_ recommended! Checksums take little storage space and provide data integrity.  Most ZFS features will not work properly with checksums disabled.  Disabling these checksums will not increase performance noticeably.Ùïç¦ç”¨æ ¡éªŒå’Œæ˜¯å¯ä»¥çš„ï¼Œä½† **ä¸æ¨è** ï¼æ ¡éªŒå’Œå ç”¨å¾ˆå°‘çš„å­˜å‚¨ç©ºé—´ï¼Œå¹¶æä¾›æ•°æ®å®Œæ•´æ€§ã€‚å¤§å¤šæ•° ZFS åŠŸèƒ½åœ¨ç¦ç”¨æ ¡éªŒå’Œçš„æƒ…å†µä¸‹å°†æ— æ³•æ­£å¸¸å·¥ä½œã€‚ç¦ç”¨è¿™äº›æ ¡éªŒå’Œä¸ä¼šæ˜æ˜¾æé«˜æ€§èƒ½ã€‚Ù_Verifying the data checksums (called _scrubbing_) ensures integrity of the `storage` pool with:ÙléªŒè¯æ•°æ®æ ¡éªŒå’Œï¼ˆç§°ä¸º _scrubbing_ ï¼‰å¯ä»¥ç¡®ä¿ `storage` æ± çš„å®Œæ•´æ€§ï¼Œå…·ä½“æ“ä½œå¦‚ä¸‹ï¼šÚThe duration of a scrub depends on the amount of data stored.  Larger amounts of data will take proportionally longer to verify.  Since scrubbing is I/O intensive, ZFS allows a single scrub to run at a time.  After scrubbing completes, view the status with `zpool status`:Úä¸€ä¸ª scrub çš„æŒç»­æ—¶é—´å–å†³äºå­˜å‚¨çš„æ•°æ®é‡ã€‚æ•°æ®é‡è¶Šå¤§ï¼ŒéªŒè¯æ‰€éœ€çš„æ—¶é—´å°±è¶Šé•¿ã€‚ç”±äº scrub æ˜¯ I/O å¯†é›†å‹æ“ä½œï¼Œ ZFS åªå…è®¸åŒæ—¶è¿è¡Œä¸€ä¸ª scrubã€‚åœ¨ scrub å®Œæˆåï¼Œå¯ä»¥ä½¿ç”¨ `zpool status` å‘½ä»¤æŸ¥çœ‹çŠ¶æ€ã€‚Ù·Displaying the completion date of the last scrubbing helps decide when to start another.  Routine scrubs help protect data from silent corruption and ensure the integrity of the pool.Ùªæ˜¾ç¤ºæœ€åä¸€æ¬¡æ¸… scrub çš„å®Œæˆæ—¥æœŸæœ‰åŠ©äºå†³å®šä½•æ—¶å¼€å§‹ä¸‹ä¸€æ¬¡ scrubã€‚ä¾‹è¡Œ scrub æœ‰åŠ©äºä¿æŠ¤æ•°æ®å…å—é™é»˜æŸåï¼Œå¹¶ç¡®ä¿æ± çš„å®Œæ•´æ€§ã€‚Ù;Refer to man:zfs[8] and man:zpool[8] for other ZFS options.Ù@è¯·å‚è€ƒ man:zfs[8] å’Œ man:zpool[8] äº†è§£å…¶ä»– ZFS é€‰é¡¹ã€‚¶`zpool` Administration®`zpool` ç®¡ç†Ú=ZFS administration uses two main utilities.  The `zpool` utility controls the operation of the pool and allows adding, removing, replacing, and managing disks.  The <<zfs-zfs,`zfs`>> utility allows creating, destroying, and managing datasets, both <<zfs-term-filesystem,file systems>> and <<zfs-term-volume,volumes>>.ÚZFS ç®¡ç†ä½¿ç”¨ä¸¤ä¸ªä¸»è¦å·¥å…·ã€‚ `zpool` å·¥å…·æ§åˆ¶æ± çš„æ“ä½œï¼Œå…è®¸æ·»åŠ ã€åˆ é™¤ã€æ›¿æ¢å’Œç®¡ç†ç£ç›˜ã€‚<<zfs-zfs,`zfs`>> å·¥å…·å…è®¸åˆ›å»ºã€é”€æ¯å’Œç®¡ç†æ•°æ®é›†ï¼ŒåŒ…æ‹¬ <<zfs-term-filesystem,æ–‡ä»¶ç³»ç»Ÿ>> å’Œ <<zfs-term-volume,å·>>ã€‚Ù%Creating and Destroying Storage Pools¸åˆ›å»ºå’Œé”€æ¯å­˜å‚¨æ± ÚšCreating a ZFS storage pool requires permanent decisions, as the pool structure cannot change after creation.  The most important decision is which types of vdevs to group the physical disks into.  See the list of <<zfs-term-vdev,vdev types>> for details about the possible options.  After creating the pool, most vdev types do not allow adding disks to the vdev.  The exceptions are mirrors, which allow adding new disks to the vdev, and stripes, which upgrade to mirrors by attaching a new disk to the vdev.  Although adding new vdevs expands a pool, the pool layout cannot change after pool creation.  Instead, back up the data, destroy the pool, and recreate it.Úeåˆ›å»ºä¸€ä¸ª ZFS å­˜å‚¨æ± éœ€è¦åšå‡ºæ°¸ä¹…æ€§çš„å†³ç­–ï¼Œå› ä¸ºåœ¨åˆ›å»ºåæ— æ³•æ›´æ”¹æ± çš„ç»“æ„ã€‚æœ€é‡è¦çš„å†³ç­–æ˜¯å°†ç‰©ç†ç£ç›˜åˆ†ç»„æˆå“ªç§ç±»å‹çš„ vdev ã€‚æœ‰å…³å¯èƒ½é€‰é¡¹çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… <<zfs-term-vdev,vdev ç±»å‹ >> åˆ—è¡¨ã€‚åˆ›å»ºæ± åï¼Œå¤§å¤šæ•° vdev ç±»å‹ä¸å…è®¸å‘ vdev æ·»åŠ ç£ç›˜ã€‚ä¾‹å¤–æƒ…å†µæ˜¯é•œåƒï¼Œå®ƒå…è®¸å‘ vdev æ·»åŠ æ–°ç£ç›˜ï¼Œå¹¶ä¸”æ¡å¸¦å¯ä»¥é€šè¿‡å°†æ–°ç£ç›˜é™„åŠ åˆ° vdev æ¥å‡çº§ä¸ºé•œåƒã€‚è™½ç„¶æ·»åŠ æ–°çš„ vdev å¯ä»¥æ‰©å±•æ± ï¼Œä½†æ± çš„å¸ƒå±€åœ¨åˆ›å»ºåæ— æ³•æ›´æ”¹ã€‚å–è€Œä»£ä¹‹çš„æ˜¯å¤‡ä»½æ•°æ®ï¼Œé”€æ¯æ± ï¼Œç„¶åé‡æ–°åˆ›å»ºæ± ã€‚¼Create a simple mirror pool:Ù!åˆ›å»ºä¸€ä¸ªç®€å•çš„é•œåƒæ± ï¼šÙ‰To create more than one vdev with a single command, specify groups of disks separated by the vdev type keyword, `mirror` in this example:Ùjè¦ä½¿ç”¨å•ä¸ªå‘½ä»¤åˆ›å»ºå¤šä¸ª vdev ï¼Œè¯·ä½¿ç”¨ä»¥ vdev ç±»å‹å…³é”®å­— `mirror` åˆ†éš”çš„ç£ç›˜ç»„ã€‚ÚÀPools can also use partitions rather than whole disks.  Putting ZFS in a separate partition allows the same disk to have other partitions for other purposes.  In particular, it allows adding partitions with bootcode and file systems needed for booting.  This allows booting from disks that are also members of a pool.  ZFS adds no performance penalty on FreeBSD when using a partition rather than a whole disk.  Using partitions also allows the administrator to _under-provision_ the disks, using less than the full capacity.  If a future replacement disk of the same nominal size as the original actually has a slightly smaller capacity, the smaller partition will still fit, using the replacement disk.ÚJæ± è¿˜å¯ä»¥ä½¿ç”¨åˆ†åŒºè€Œä¸æ˜¯æ•´ä¸ªç£ç›˜ã€‚å°† ZFS æ”¾åœ¨å•ç‹¬çš„åˆ†åŒºä¸­å¯ä»¥ä½¿åŒä¸€ç£ç›˜å…·æœ‰å…¶ä»–ç”¨é€”çš„åˆ†åŒºã€‚ç‰¹åˆ«æ˜¯ï¼Œå®ƒå…è®¸æ·»åŠ å¸¦æœ‰å¼•å¯¼ä»£ç å’Œç”¨äºå¼•å¯¼çš„æ–‡ä»¶ç³»ç»Ÿçš„åˆ†åŒºã€‚è¿™æ ·å°±å¯ä»¥ä»åŒæ—¶ä¹Ÿæ˜¯æ± æˆå‘˜çš„ç£ç›˜å¯åŠ¨ã€‚åœ¨ FreeBSD ä¸Šï¼Œä½¿ç”¨åˆ†åŒºè€Œä¸æ˜¯æ•´ä¸ªç£ç›˜æ—¶ï¼Œ ZFS ä¸ä¼šå¸¦æ¥æ€§èƒ½æŸå¤±ã€‚ä½¿ç”¨åˆ†åŒºè¿˜å…è®¸ç®¡ç†å‘˜å¯¹ç£ç›˜è¿›è¡Œâ€œæ¬ é…ç½®â€ï¼Œä½¿ç”¨ä¸åˆ°å…¨éƒ¨å®¹é‡ã€‚å¦‚æœå°†æ¥æ›¿æ¢çš„ç£ç›˜ä¸åŸå§‹ç£ç›˜çš„åä¹‰å¤§å°ç›¸åŒï¼Œä½†å®é™…å®¹é‡ç•¥å°ï¼Œè¾ƒå°çš„åˆ†åŒºä»å°†é€‚åº”æ›¿æ¢ç£ç›˜ã€‚Ù?Create a <<zfs-term-vdev-raidz,RAID-Z2>> pool using partitions:Ù?ä½¿ç”¨åˆ†åŒºåˆ›å»ºä¸€ä¸ª <<zfs-term-vdev-raidz,RAID-Z2>> æ± ï¼šÚ]Destroy a pool that is no longer needed to reuse the disks.  Destroying a pool requires unmounting the file systems in that pool first.  If any dataset is in use, the unmount operation fails without destroying the pool.  Force the pool destruction with `-f`.  This can cause undefined behavior in applications which had open files on those datasets.Ú2é”€æ¯ä¸€ä¸ªä¸å†éœ€è¦çš„æ± ä»¥é‡ç”¨ç£ç›˜ã€‚é”€æ¯æ± éœ€è¦å…ˆå¸è½½è¯¥æ± ä¸­çš„æ–‡ä»¶ç³»ç»Ÿã€‚å¦‚æœæœ‰ä»»ä½•æ•°æ®é›†æ­£åœ¨ä½¿ç”¨ä¸­ï¼Œå¸è½½æ“ä½œå°†å¤±è´¥ï¼Œä¸ä¼šé”€æ¯æ± ã€‚å¯ä»¥ä½¿ç”¨ `-f` å¼ºåˆ¶é”€æ¯æ± ã€‚è¿™å¯èƒ½ä¼šå¯¼è‡´åº”ç”¨ç¨‹åºä¸­å¯¹è¿™äº›æ•°æ®é›†æœ‰æ‰“å¼€æ–‡ä»¶çš„æœªå®šä¹‰è¡Œä¸ºã€‚»Adding and Removing Devicesµæ·»åŠ å’Œç§»é™¤è®¾å¤‡ÙäTwo ways exist for adding disks to a pool: attaching a disk to an existing vdev with `zpool attach`, or adding vdevs to the pool with `zpool add`.  Some <<zfs-term-vdev,vdev types>> allow adding disks to the vdev after creation.Ùñæœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥å°†ç£ç›˜æ·»åŠ åˆ°æ± ä¸­ï¼šä½¿ç”¨ `zpool attach` å°†ç£ç›˜é™„åŠ åˆ°ç°æœ‰çš„ vdev ä¸Šï¼Œæˆ–è€…ä½¿ç”¨ `zpool add` å°† vdev æ·»åŠ åˆ°æ± ä¸­ã€‚ä¸€äº› <<zfs-term-vdev,vdev ç±»å‹ >> å…è®¸åœ¨åˆ›å»ºåå‘ vdev æ·»åŠ ç£ç›˜ã€‚ÚÙA pool created with a single disk lacks redundancy.  It can detect corruption but can not repair it, because there is no other copy of the data.  The <<zfs-term-copies,copies>> property may be able to recover from a small failure such as a bad sector, but does not provide the same level of protection as mirroring or RAID-Z.  Starting with a pool consisting of a single disk vdev, use `zpool attach` to add a new disk to the vdev, creating a mirror.  Also use `zpool attach` to add new disks to a mirror group, increasing redundancy and read performance.  When partitioning the disks used for the pool, replicate the layout of the first disk on to the second.  Use `gpart backup` and `gpart restore` to make this process easier.Úä½¿ç”¨å•ä¸ªç£ç›˜åˆ›å»ºçš„æ± ç¼ºä¹å†—ä½™æ€§ã€‚å®ƒå¯ä»¥æ£€æµ‹åˆ°æŸåï¼Œä½†æ— æ³•ä¿®å¤ï¼Œå› ä¸ºæ²¡æœ‰å…¶ä»–æ•°æ®çš„å‰¯æœ¬ã€‚ <<zfs-term-copies,å‰¯æœ¬>> å±æ€§å¯ä»¥ä»å°æ•…éšœï¼ˆå¦‚åæ‰‡åŒºï¼‰ä¸­æ¢å¤ï¼Œä½†ä¸æä¾›ä¸é•œåƒæˆ– RAID-Z ç›¸åŒçº§åˆ«çš„ä¿æŠ¤ã€‚ä»ç”±å•ä¸ªç£ç›˜ vdev ç»„æˆçš„æ± å¼€å§‹ï¼Œä½¿ç”¨ `zpool attach` å°†æ–°ç£ç›˜æ·»åŠ åˆ° vdev ä¸­ï¼Œåˆ›å»ºé•œåƒã€‚è¿˜å¯ä»¥ä½¿ç”¨ `zpool attach` å°†æ–°ç£ç›˜æ·»åŠ åˆ°é•œåƒç»„ï¼Œå¢åŠ å†—ä½™æ€§å’Œè¯»å–æ€§èƒ½ã€‚åœ¨ä¸ºæ± åˆ†åŒºçš„ç£ç›˜ä¸Šï¼Œå°†ç¬¬ä¸€ä¸ªç£ç›˜çš„å¸ƒå±€å¤åˆ¶åˆ°ç¬¬äºŒä¸ªç£ç›˜ä¸Šã€‚ä½¿ç”¨ `gpart backup` å’Œ `gpart restore` å¯ä»¥ä½¿è¿™ä¸ªè¿‡ç¨‹æ›´å®¹æ˜“ã€‚ÙgUpgrade the single disk (stripe) vdev [.filename]#ada0p3# to a mirror by attaching [.filename]#ada1p3#:Ùié€šè¿‡è¿æ¥ [.filename]#ada0p3#ï¼Œå°†å•ä¸ªç£ç›˜ï¼ˆæ¡å¸¦ï¼‰vdev [.filename]#ada1p3# å‡çº§ä¸ºé•œåƒï¼šÚ<When adding disks to the existing vdev is not an option, as for RAID-Z, an alternative method is to add another vdev to the pool.  Adding vdevs provides higher performance by distributing writes across the vdevs.  Each vdev provides its own redundancy.  Mixing vdev types like `mirror` and `RAID-Z` is possible but discouraged.  Adding a non-redundant vdev to a pool containing mirror or RAID-Z vdevs risks the data on the entire pool.  Distributing writes means a failure of the non-redundant disk will result in the loss of a fraction of every block written to the pool.Ú*å½“æ— æ³•å°†ç£ç›˜æ·»åŠ åˆ°ç°æœ‰çš„ vdev æ—¶ï¼Œä¾‹å¦‚å¯¹äº RAID-Z ï¼Œä¸€ç§æ›¿ä»£æ–¹æ³•æ˜¯å‘æ± ä¸­æ·»åŠ å¦ä¸€ä¸ª vdev ã€‚æ·»åŠ  vdev å¯ä»¥é€šè¿‡åœ¨ vdev ä¹‹é—´åˆ†å¸ƒå†™æ“ä½œæ¥æä¾›æ›´é«˜çš„æ€§èƒ½ã€‚æ¯ä¸ª vdev éƒ½æä¾›è‡ªå·±çš„å†—ä½™æ€§ã€‚å¯ä»¥æ··åˆä½¿ç”¨ `mirror` å’Œ `RAID-Z` ç­‰ä¸åŒç±»å‹çš„ vdev ï¼Œä½†ä¸å»ºè®®è¿™æ ·åšã€‚å‘åŒ…å«é•œåƒæˆ– RAID-Z vdev çš„æ± ä¸­æ·»åŠ ä¸€ä¸ªéå†—ä½™çš„ vdev ä¼šå¯¹æ•´ä¸ªæ± ä¸­çš„æ•°æ®é€ æˆé£é™©ã€‚åˆ†å¸ƒå†™æ“ä½œæ„å‘³ç€éå†—ä½™ç£ç›˜çš„æ•…éšœå°†å¯¼è‡´ä¸¢å¤±å¯¹æ± ä¸­æ¯ä¸ªå—çš„ä¸€éƒ¨åˆ†æ•°æ®ã€‚ÚaZFS stripes data across each of the vdevs.  For example, with two mirror vdevs, this is effectively a RAID 10 that stripes writes across two sets of mirrors.  ZFS allocates space so that each vdev reaches 100% full at the same time.  Having vdevs with different amounts of free space will lower performance, as more data writes go to the less full vdev.ÚgZFS å°†æ•°æ®è·¨è¶Šæ¯ä¸ª vdev è¿›è¡Œæ¡å¸¦åŒ–ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨ä¸¤ä¸ªé•œåƒ vdev ï¼Œè¿™å®é™…ä¸Šæ˜¯ä¸€ä¸ª RAID 10ï¼Œå°†å†™æ“ä½œè·¨è¶Šä¸¤ç»„é•œåƒã€‚ZFS åˆ†é…ç©ºé—´ä»¥ä½¿æ¯ä¸ª vdev åœ¨åŒä¸€æ—¶é—´è¾¾åˆ° 100 ï¼…çš„ä½¿ç”¨ç‡ã€‚å¦‚æœ vdev å…·æœ‰ä¸åŒæ•°é‡çš„å¯ç”¨ç©ºé—´ï¼Œæ€§èƒ½å°†é™ä½ï¼Œå› ä¸ºæ›´å¤šçš„æ•°æ®å†™å…¥å°†å‘é€åˆ°ä½¿ç”¨ç‡è¾ƒä½çš„ vdevã€‚ÙKWhen attaching new devices to a boot pool, remember to update the bootcode.ÙEåœ¨å°†æ–°è®¾å¤‡è¿æ¥åˆ°å¼•å¯¼æ± æ—¶ï¼Œè¯·è®°å¾—æ›´æ–°å¼•å¯¼ä»£ç ã€‚ÙbAttach a second mirror group ([.filename]#ada2p3# and [.filename]#ada3p3#) to the existing mirror:Ùdå°†ç¬¬äºŒä¸ªé•œåƒç»„ï¼ˆ[.filename]#ada2p3# å’Œ [.filename]#ada3p3#ï¼‰é™„åŠ åˆ°ç°æœ‰çš„é•œåƒä¸­ï¼šÚRemoving vdevs from a pool is impossible and removal of disks from a mirror is exclusive if there is enough remaining redundancy.  If a single disk remains in a mirror group, that group ceases to be a mirror and becomes a stripe, risking the entire pool if that remaining disk fails.Ùùä»æ± ä¸­åˆ é™¤ vdev æ˜¯ä¸å¯èƒ½çš„ï¼Œå¦‚æœå‰©ä½™çš„å†—ä½™è¶³å¤Ÿï¼Œä»é•œåƒä¸­åˆ é™¤ç£ç›˜æ˜¯ç‹¬å çš„ã€‚å¦‚æœé•œåƒç»„ä¸­åªå‰©ä¸‹ä¸€ä¸ªç£ç›˜ï¼Œè¯¥ç»„å°†ä¸å†æ˜¯é•œåƒï¼Œè€Œå˜æˆæ¡å¸¦ï¼Œå¦‚æœè¯¥å‰©ä½™ç£ç›˜æ•…éšœï¼Œå°†ä¼šå±åŠæ•´ä¸ªæ± ã€‚Ù,Remove a disk from a three-way mirror group:Ù*ä»ä¸‰è·¯é•œåƒç»„ä¸­ç§»é™¤ä¸€ä¸ªç£ç›˜ï¼š½Checking the Status of a Pool²æ£€æŸ¥æ± çš„çŠ¶æ€ÚZPool status is important.  If a drive goes offline or ZFS detects a read, write, or checksum error, the corresponding error count increases.  The `status` output shows the configuration and status of each device in the pool and the status of the entire pool.  Actions to take and details about the last <<zfs-zpool-scrub,`scrub`>> are also shown.Ú6æ± çŠ¶æ€éå¸¸é‡è¦ã€‚å¦‚æœé©±åŠ¨å™¨ç¦»çº¿æˆ– ZFS æ£€æµ‹åˆ°è¯»å–ã€å†™å…¥æˆ–æ ¡éªŒé”™è¯¯ï¼Œç›¸åº”çš„é”™è¯¯è®¡æ•°ä¼šå¢åŠ ã€‚`status` è¾“å‡ºæ˜¾ç¤ºäº†æ± ä¸­æ¯ä¸ªè®¾å¤‡çš„é…ç½®å’ŒçŠ¶æ€ï¼Œä»¥åŠæ•´ä¸ªæ± çš„çŠ¶æ€ã€‚è¿˜æ˜¾ç¤ºäº†è¦é‡‡å–çš„æ“ä½œå’Œæœ‰å…³ä¸Šæ¬¡ <<zfs-zpool-scrub,`scrub`>> çš„è¯¦ç»†ä¿¡æ¯ã€‚¯Clearing Errors¬æ¸…é™¤é”™è¯¯ÚjWhen detecting an error, ZFS increases the read, write, or checksum error counts.  Clear the error message and reset the counts with `zpool clear _mypool_`.  Clearing the error state can be important for automated scripts that alert the administrator when the pool encounters an error.  Without clearing old errors, the scripts may fail to report further errors.ÚNå½“æ£€æµ‹åˆ°é”™è¯¯æ—¶ï¼ŒZFS ä¼šå¢åŠ è¯»å–ã€å†™å…¥æˆ–æ ¡éªŒå’Œé”™è¯¯è®¡æ•°ã€‚ä½¿ç”¨ `zpool clear _mypool_` å‘½ä»¤æ¸…é™¤é”™è¯¯æ¶ˆæ¯å¹¶é‡ç½®è®¡æ•°ã€‚æ¸…é™¤é”™è¯¯çŠ¶æ€å¯¹äºè‡ªåŠ¨åŒ–è„šæœ¬éå¸¸é‡è¦ï¼Œè¿™äº›è„šæœ¬åœ¨æ± é‡åˆ°é”™è¯¯æ—¶ä¼šé€šçŸ¥ç®¡ç†å‘˜ã€‚å¦‚æœä¸æ¸…é™¤æ—§é”™è¯¯ï¼Œè¿™äº›è„šæœ¬å¯èƒ½æ— æ³•æŠ¥å‘Šåç»­çš„é”™è¯¯ã€‚¾Replacing a Functioning DeviceÙ!æ›¿æ¢ä¸€ä¸ªæ­£å¸¸å·¥ä½œçš„è®¾å¤‡Ú%It may be desirable to replace one disk with a different disk.  When replacing a working disk, the process keeps the old disk online during the replacement.  The pool never enters a <<zfs-term-degraded,degraded>> state, reducing the risk of data loss.  Running `zpool replace` copies the data from the old disk to the new one.  After the operation completes, ZFS disconnects the old disk from the vdev.  If the new disk is larger than the old disk, it may be possible to grow the zpool, using the new space.  See <<zfs-zpool-online,Growing a Pool>>.Úíå¯èƒ½éœ€è¦ç”¨ä¸åŒçš„ç£ç›˜æ›¿æ¢ä¸€ä¸ªç£ç›˜ã€‚å½“æ›¿æ¢ä¸€ä¸ªå·¥ä½œä¸­çš„ç£ç›˜æ—¶ï¼Œè¯¥è¿‡ç¨‹ä¼šåœ¨æ›¿æ¢æœŸé—´ä¿æŒæ—§ç£ç›˜åœ¨çº¿ã€‚æ± æ°¸è¿œä¸ä¼šè¿›å…¥ <<zfs-term-degraded,é™çº§>> çŠ¶æ€ï¼Œä»è€Œé™ä½æ•°æ®ä¸¢å¤±çš„é£é™©ã€‚è¿è¡Œ `zpool replace` å‘½ä»¤å°†æ•°æ®ä»æ—§ç£ç›˜å¤åˆ¶åˆ°æ–°ç£ç›˜ã€‚æ“ä½œå®Œæˆåï¼Œ ZFS ä¼šå°†æ—§ç£ç›˜ä¸ vdev æ–­å¼€è¿æ¥ã€‚å¦‚æœæ–°ç£ç›˜æ¯”æ—§ç£ç›˜å¤§ï¼Œå¯èƒ½å¯ä»¥ä½¿ç”¨æ–°ç©ºé—´æ¥æ‰©å±• zpool ã€‚è¯·å‚è§ <<zfs-zpool-online,æ‰©å±•æ± >> ã€‚Ù)Replace a functioning device in the pool:Ù*æ›¿æ¢æ± ä¸­çš„ä¸€ä¸ªæ­£å¸¸å·¥ä½œè®¾å¤‡ï¼š»Dealing with Failed Devices²å¤„ç†æ•…éšœè®¾å¤‡ÚHWhen a disk in a pool fails, the vdev to which the disk belongs enters the <<zfs-term-degraded,degraded>> state.  The data is still available, but with reduced performance because ZFS computes missing data from the available redundancy.  To restore the vdev to a fully functional state, replace the failed physical device.  ZFS is then instructed to begin the <<zfs-term-resilver,resilver>> operation.  ZFS recomputes data on the failed device from available redundancy and writes it to the replacement device.  After completion, the vdev returns to <<zfs-term-online,online>> status.Úüå½“æ± ä¸­çš„ç£ç›˜å‘ç”Ÿæ•…éšœæ—¶ï¼Œè¯¥ç£ç›˜æ‰€å±çš„ vdev å°†è¿›å…¥ <<zfs-term-degraded,é™çº§>> çŠ¶æ€ã€‚æ•°æ®ä»ç„¶å¯ç”¨ï¼Œä½†æ€§èƒ½é™ä½ï¼Œå› ä¸º ZFS ä¼šé€šè¿‡å¯ç”¨çš„å†—ä½™è®¡ç®—ç¼ºå¤±çš„æ•°æ®ã€‚ä¸ºäº†å°† vdev æ¢å¤åˆ°å®Œå…¨åŠŸèƒ½çŠ¶æ€ï¼Œéœ€è¦æ›¿æ¢æ•…éšœçš„ç‰©ç†è®¾å¤‡ã€‚ç„¶åï¼ŒZFS ä¼šå¼€å§‹ <<zfs-term-resilver,é‡å»º>> æ“ä½œã€‚ZFS ä¼šé€šè¿‡å¯ç”¨çš„å†—ä½™é‡æ–°è®¡ç®—æ•…éšœè®¾å¤‡ä¸Šçš„æ•°æ®ï¼Œå¹¶å°†å…¶å†™å…¥æ›¿ä»£è®¾å¤‡ã€‚å®Œæˆåï¼Œvdev å°†è¿”å› <<zfs-term-online,åœ¨çº¿>> çŠ¶æ€ã€‚ÚIf the vdev does not have any redundancy, or if devices have failed and there is not enough redundancy to compensate, the pool enters the <<zfs-term-faulted,faulted>> state.  Unless enough devices can reconnect the pool becomes inoperative requiring a data restore from backups.Úå¦‚æœ vdev æ²¡æœ‰ä»»ä½•å†—ä½™ï¼Œæˆ–è€…è®¾å¤‡å·²ç»æŸåä¸”æ²¡æœ‰è¶³å¤Ÿçš„å†—ä½™æ¥å¼¥è¡¥ï¼Œé‚£ä¹ˆå­˜å‚¨æ± å°†è¿›å…¥ <<zfs-term-faulted,æ•…éšœ>> çŠ¶æ€ã€‚é™¤éæœ‰è¶³å¤Ÿçš„è®¾å¤‡é‡æ–°è¿æ¥å­˜å‚¨æ± ï¼Œå¦åˆ™å­˜å‚¨æ± å°†æ— æ³•è¿è¡Œï¼Œéœ€è¦ä»å¤‡ä»½ä¸­æ¢å¤æ•°æ®ã€‚ÙÓWhen replacing a failed disk, the name of the failed disk changes to the GUID of the new disk.  A new device name parameter for `zpool replace` is not required if the replacement device has the same device name.ÙÄå½“æ›¿æ¢ä¸€ä¸ªæ•…éšœç£ç›˜æ—¶ï¼Œæ•…éšœç£ç›˜çš„åç§°ä¼šå˜ä¸ºæ–°ç£ç›˜çš„ GUIDã€‚å¦‚æœæ›¿æ¢è®¾å¤‡å…·æœ‰ç›¸åŒçš„è®¾å¤‡åç§°ï¼Œåˆ™ä¸éœ€è¦ä¸º `zpool replace` æŒ‡å®šæ–°çš„è®¾å¤‡åç§°å‚æ•°ã€‚Ù,Replace a failed disk using `zpool replace`:Ù5ä½¿ç”¨ `zpool replace` å‘½ä»¤æ›¿æ¢æ•…éšœçš„ç£ç›˜ï¼š°Scrubbing a Pool­Scrubbing æ± ÚqRoutinely <<zfs-term-scrub,scrub>> pools, ideally at least once every month.  The `scrub` operation is disk-intensive and will reduce performance while running.  Avoid high-demand periods when scheduling `scrub` or use <<zfs-advanced-tuning-scrub_delay,`vfs.zfs.scrub_delay`>> to adjust the relative priority of the `scrub` to keep it from slowing down other workloads.Únå®šæœŸå¯¹æ± è¿›è¡Œ <<zfs-term-scrub,scrub>> æ“ä½œï¼Œæœ€å¥½æ¯ä¸ªæœˆè‡³å°‘ä¸€æ¬¡ã€‚`scrub` æ“ä½œå¯¹ç£ç›˜çš„ä½¿ç”¨è¾ƒé«˜ï¼Œè¿è¡Œæ—¶ä¼šé™ä½æ€§èƒ½ã€‚åœ¨å®‰æ’ `scrub` æ“ä½œæ—¶é¿å…é«˜è´Ÿè½½æ—¶æ®µï¼Œæˆ–è€…ä½¿ç”¨ <<zfs-advanced-tuning-scrub_delay,`vfs.zfs.scrub_delay`>> æ¥è°ƒæ•´ `scrub` æ“ä½œçš„ç›¸å¯¹ä¼˜å…ˆçº§ï¼Œä»¥é˜²æ­¢å…¶å½±å“å…¶ä»–å·¥ä½œè´Ÿè½½çš„é€Ÿåº¦ã€‚ÙETo cancel a scrub operation if needed, run `zpool scrub -s _mypool_`.ÙOå¦‚æœéœ€è¦å–æ¶ˆä¸€ä¸ª scrub æ“ä½œï¼Œè¯·è¿è¡Œ `zpool scrub -s _mypool_` ã€‚¬Self-Healing¬è‡ªæˆ‘ä¿®å¤ÚóThe checksums stored with data blocks enable the file system to _self-heal_.  This feature will automatically repair data whose checksum does not match the one recorded on another device that is part of the storage pool.  For example, a mirror configuration with two disks where one drive is starting to malfunction and cannot properly store the data any more.  This is worse when the data was not accessed for a long time, as with long term archive storage.  Traditional file systems need to run commands that check and repair the data like man:fsck[8].  These commands take time, and in severe cases, an administrator has to decide which repair operation to perform.  When ZFS detects a data block with a mismatched checksum, it tries to read the data from the mirror disk.  If that disk can provide the correct data, ZFS will give that to the application and correct the data on the disk with the wrong checksum.  This happens without any interaction from a system administrator during normal pool operation.Úˆå­˜å‚¨åœ¨æ•°æ®å—ä¸­çš„æ ¡éªŒå’Œä½¿æ–‡ä»¶ç³»ç»Ÿèƒ½å¤Ÿè‡ªæˆ‘ä¿®å¤ã€‚è¿™ä¸ªåŠŸèƒ½ä¼šè‡ªåŠ¨ä¿®å¤æ•°æ®ï¼Œå¦‚æœå…¶æ ¡éªŒå’Œä¸å­˜å‚¨æ± ä¸­å¦ä¸€ä¸ªè®¾å¤‡ä¸Šè®°å½•çš„æ ¡éªŒå’Œä¸åŒ¹é…ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªå…·æœ‰ä¸¤ä¸ªç£ç›˜çš„é•œåƒé…ç½®ï¼Œå…¶ä¸­ä¸€ä¸ªé©±åŠ¨å™¨å¼€å§‹å‡ºç°æ•…éšœï¼Œæ— æ³•æ­£ç¡®å­˜å‚¨æ•°æ®ã€‚å½“æ•°æ®é•¿æ—¶é—´æœªè¢«è®¿é—®æ—¶ï¼Œå¦‚é•¿æœŸå­˜æ¡£å­˜å‚¨ï¼Œæƒ…å†µä¼šæ›´ç³Ÿã€‚ä¼ ç»Ÿçš„æ–‡ä»¶ç³»ç»Ÿéœ€è¦è¿è¡Œæ£€æŸ¥å’Œä¿®å¤æ•°æ®çš„å‘½ä»¤ï¼Œå¦‚ man:fsck[8]ã€‚è¿™äº›å‘½ä»¤éœ€è¦æ—¶é—´ï¼Œåœ¨ä¸¥é‡æƒ…å†µä¸‹ï¼Œç®¡ç†å‘˜å¿…é¡»å†³å®šæ‰§è¡Œå“ªä¸ªä¿®å¤æ“ä½œã€‚å½“ ZFS æ£€æµ‹åˆ°ä¸€ä¸ªæ•°æ®å—çš„æ ¡éªŒå’Œä¸åŒ¹é…æ—¶ï¼Œå®ƒä¼šå°è¯•ä»é•œåƒç£ç›˜ä¸­è¯»å–æ•°æ®ã€‚å¦‚æœè¯¥ç£ç›˜èƒ½æä¾›æ­£ç¡®çš„æ•°æ®ï¼Œ ZFS å°†å°†å…¶æä¾›ç»™åº”ç”¨ç¨‹åºï¼Œå¹¶çº æ­£å…·æœ‰é”™è¯¯æ ¡éªŒå’Œçš„ç£ç›˜ä¸Šçš„æ•°æ®ã€‚åœ¨æ­£å¸¸å­˜å‚¨æ± æ“ä½œæœŸé—´ï¼Œè¿™ä¸€åˆ‡éƒ½åœ¨æ²¡æœ‰ä»»ä½•ç³»ç»Ÿç®¡ç†å‘˜å¹²é¢„çš„æƒ…å†µä¸‹å‘ç”Ÿã€‚Ù‰The next example shows this self-healing behavior by creating a mirrored pool of disks [.filename]#/dev/ada0# and [.filename]#/dev/ada1#.Ù•ä¸‹ä¸€ä¸ªç¤ºä¾‹é€šè¿‡åˆ›å»ºä¸€ä¸ªé•œåƒç£ç›˜æ± æ¥å±•ç¤ºè¿™ç§è‡ªæˆ‘ä¿®å¤è¡Œä¸ºï¼Œå…¶ä¸­åŒ…æ‹¬ [.filename]#/dev/ada0# å’Œ [.filename]#/dev/ada1#ã€‚Ù—Copy some important data to the pool to protect from data errors using the self-healing feature and create a checksum of the pool for later comparison.ÙŠå°†ä¸€äº›é‡è¦æ•°æ®å¤åˆ¶åˆ°æ± ä¸­ï¼Œä»¥ä½¿ç”¨è‡ªæˆ‘ä¿®å¤åŠŸèƒ½ä¿æŠ¤å…å—æ•°æ®é”™è¯¯ï¼Œå¹¶ä¸ºæ± åˆ›å»ºæ ¡éªŒå’Œä»¥å¤‡åç»­æ¯”è¾ƒã€‚ÙÛSimulate data corruption by writing random data to the beginning of one of the disks in the mirror.  To keep ZFS from healing the data when detected, export the pool before the corruption and import it again afterwards.ÙËé€šè¿‡å‘é•œåƒä¸­çš„ä¸€ä¸ªç£ç›˜çš„å¼€å¤´å†™å…¥éšæœºæ•°æ®æ¥æ¨¡æ‹Ÿæ•°æ®æŸåã€‚ä¸ºäº†é˜²æ­¢ ZFS åœ¨æ£€æµ‹åˆ°æ•°æ®æŸåæ—¶ä¿®å¤æ•°æ®ï¼Œå¯ä»¥åœ¨æŸåä¹‹å‰å¯¼å‡ºæ± ï¼Œå¹¶åœ¨ä¹‹åé‡æ–°å¯¼å…¥ã€‚ÚÁThis is a dangerous operation that can destroy vital data, shown here for demonstration alone.  *Do not try* it during normal operation of a storage pool.  Nor should this intentional corruption example run on any disk with a file system not using ZFS on another partition in it.  Do not use any other disk device names other than the ones that are part of the pool.  Ensure proper backups of the pool exist and test them before running the command!ÚÜè¿™æ˜¯ä¸€ä¸ªå±é™©çš„æ“ä½œï¼Œå¯èƒ½ä¼šç ´åé‡è¦æ•°æ®ï¼Œä»…ç”¨äºæ¼”ç¤ºç›®çš„ã€‚åœ¨å­˜å‚¨æ± çš„æ­£å¸¸è¿è¡ŒæœŸé—´ï¼Œè¯· *ä¸è¦å°è¯•* æ‰§è¡Œæ­¤æ“ä½œã€‚æ­¤æ„å¤–æŸåç¤ºä¾‹ä¹Ÿä¸åº”åœ¨ä»»ä½•ä½¿ç”¨ ZFS ä»¥å¤–çš„æ–‡ä»¶ç³»ç»Ÿçš„ç£ç›˜ä¸Šè¿è¡Œï¼Œè¯¥ç£ç›˜ä¸Šçš„å¦ä¸€ä¸ªåˆ†åŒºä¸­ä¹Ÿä¸åº”è¯¥æœ‰ ZFS ã€‚è¯·ä¸è¦ä½¿ç”¨é™¤äº†å­˜å‚¨æ± ä¸­çš„è®¾å¤‡åç§°ä¹‹å¤–çš„ä»»ä½•å…¶ä»–ç£ç›˜è®¾å¤‡åç§°ã€‚ç¡®ä¿å­˜å‚¨æ± æœ‰é€‚å½“çš„å¤‡ä»½ï¼Œå¹¶åœ¨æ‰§è¡Œå‘½ä»¤ä¹‹å‰å¯¹å…¶è¿›è¡Œæµ‹è¯•ï¼ÚPThe pool status shows that one device has experienced an error.  Note that applications reading data from the pool did not receive any incorrect data.  ZFS provided data from the [.filename]#ada0# device with the correct checksums.  To find the device with the wrong checksum, look for one whose `CKSUM` column contains a nonzero value.Úæ± çŠ¶æ€æ˜¾ç¤ºä¸€ä¸ªè®¾å¤‡å‘ç”Ÿäº†é”™è¯¯ã€‚è¯·æ³¨æ„ï¼Œä»æ± ä¸­è¯»å–æ•°æ®çš„åº”ç”¨ç¨‹åºæ²¡æœ‰æ¥æ”¶åˆ°ä»»ä½•é”™è¯¯æ•°æ®ã€‚ZFS ä» [.filename]#ada0# è®¾å¤‡æä¾›äº†æ­£ç¡®æ ¡éªŒå’Œçš„æ•°æ®ã€‚è¦æ‰¾åˆ°æ ¡éªŒå’Œé”™è¯¯çš„è®¾å¤‡ï¼Œè¯·æŸ¥æ‰¾ `CKSUM` åˆ—ä¸­åŒ…å«éé›¶å€¼çš„è®¾å¤‡ã€‚ÙÕZFS detected the error and handled it by using the redundancy present in the unaffected [.filename]#ada0# mirror disk.  A checksum comparison with the original one will reveal whether the pool is consistent again.ÙÂZFS æ£€æµ‹åˆ°é”™è¯¯ï¼Œå¹¶é€šè¿‡ä½¿ç”¨æœªå—å½±å“çš„ [.filename]#ada0# é•œåƒç£ç›˜ä¸­çš„å†—ä½™æ¥å¤„ç†è¯¥é”™è¯¯ã€‚é€šè¿‡ä¸åŸå§‹æ•°æ®è¿›è¡Œæ ¡éªŒæ¯”è¾ƒï¼Œå¯ä»¥ç¡®å®šæ± æ˜¯å¦æ¢å¤ä¸€è‡´ã€‚Ú¸Generate checksums before and after the intentional tampering while the pool data still matches.  This shows how ZFS is capable of detecting and correcting any errors automatically when the checksums differ.  Note this is possible with enough redundancy present in the pool.  A pool consisting of a single device has no self-healing capabilities.  That is also the reason why checksums are so important in ZFS; do not disable them for any reason.  ZFS requires no man:fsck[8] or similar file system consistency check program to detect and correct this, and keeps the pool available while there is a problem.  A scrub operation is now required to overwrite the corrupted data on [.filename]#ada1#.Ú[åœ¨æ•…æ„ç¯¡æ”¹ä¹‹å‰å’Œä¹‹åç”Ÿæˆæ ¡éªŒå’Œï¼ŒåŒæ—¶æ± æ•°æ®ä»ç„¶åŒ¹é…ã€‚è¿™æ˜¾ç¤ºäº†å½“æ ¡éªŒå’Œä¸åŒæ—¶ï¼Œ ZFS èƒ½å¤Ÿè‡ªåŠ¨æ£€æµ‹å’Œçº æ­£ä»»ä½•é”™è¯¯ã€‚è¯·æ³¨æ„ï¼Œè¿™éœ€è¦æ± ä¸­å…·æœ‰è¶³å¤Ÿçš„å†—ä½™ã€‚ç”±å•ä¸ªè®¾å¤‡ç»„æˆçš„æ± æ²¡æœ‰è‡ªæˆ‘ä¿®å¤èƒ½åŠ›ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆåœ¨ ZFS ä¸­æ ¡éªŒå’Œå¦‚æ­¤é‡è¦çš„åŸå› ï¼›ä¸è¦å‡ºäºä»»ä½•åŸå› ç¦ç”¨å®ƒä»¬ã€‚ ZFS ä¸éœ€è¦ man:fsck[8] æˆ–ç±»ä¼¼çš„æ–‡ä»¶ç³»ç»Ÿä¸€è‡´æ€§æ£€æŸ¥ç¨‹åºæ¥æ£€æµ‹å’Œçº æ­£è¿™ä¸ªé—®é¢˜ï¼Œå¹¶ä¸”åœ¨å‡ºç°é—®é¢˜æ—¶ä¿æŒæ± å¯ç”¨ã€‚ç°åœ¨éœ€è¦è¿›è¡Œä¸€æ¬¡ scrub æ“ä½œæ¥è¦†ç›–åœ¨ [.filename]#ada1# ä¸Šçš„æŸåæ•°æ®ã€‚ÙìThe scrub operation reads data from [.filename]#ada0# and rewrites any data with a wrong checksum on [.filename]#ada1#, shown by the `(repairing)` output from `zpool status`.  After the operation is complete, the pool status changes to:ÙóScrub æ“ä½œä» [.filename]#ada0# è¯»å–æ•°æ®ï¼Œå¹¶å°†ä»»ä½•å…·æœ‰é”™è¯¯æ ¡éªŒå’Œçš„æ•°æ®é‡å†™åˆ° [.filename]#ada1# ä¸Šï¼Œè¿™å¯ä»¥é€šè¿‡ `zpool status` ä¸­çš„ `(repairing)` è¾“å‡ºæ¥æ˜¾ç¤ºã€‚æ“ä½œå®Œæˆåï¼Œæ± çš„çŠ¶æ€å°†å‘ç”Ÿå˜åŒ–ï¼šÙÏAfter the scrubbing operation completes with all the data synchronized from [.filename]#ada0# to [.filename]#ada1#, <<zfs-zpool-clear,clear>> the error messages from the pool status by running `zpool clear`.Ù½åœ¨ä» [.filename]#ada0# åŒæ­¥æ‰€æœ‰æ•°æ®åˆ° [.filename]#ada1# åï¼Œå®Œæˆäº† <<zfs-zpool-clear,æ¸…æ´—>> æ“ä½œï¼Œè¯·é€šè¿‡è¿è¡Œ `zpool clear` å‘½ä»¤æ¸…é™¤æ± çŠ¶æ€ä¸­çš„é”™è¯¯æ¶ˆæ¯ã€‚ÙNThe pool is now back to a fully working state, with all error counts now zero.ÙQç°åœ¨ï¼Œæ± å·²ç»æ¢å¤åˆ°å®Œå…¨æ­£å¸¸çš„çŠ¶æ€ï¼Œæ‰€æœ‰é”™è¯¯è®¡æ•°éƒ½ä¸ºé›¶ã€‚®Growing a Pool©æ‰©å±•æ± ÚMThe smallest device in each vdev limits the usable size of a redundant pool.  Replace the smallest device with a larger device.  After completing a <<zfs-zpool-replace,replace>> or <<zfs-term-resilver,resilver>> operation, the pool can grow to use the capacity of the new device.  For example, consider a mirror of a 1 TB drive and a 2 TB drive.  The usable space is 1 TB.  When replacing the 1 TB drive with another 2 TB drive, the resilvering process copies the existing data onto the new drive.  As both of the devices now have 2 TB capacity, the mirror's available space grows to 2 TB.Ú&æ¯ä¸ª vdev ä¸­æœ€å°çš„è®¾å¤‡é™åˆ¶äº†å†—ä½™æ± çš„å¯ç”¨å¤§å°ã€‚ç”¨ä¸€ä¸ªæ›´å¤§çš„è®¾å¤‡æ›¿æ¢æœ€å°çš„è®¾å¤‡ã€‚åœ¨å®Œæˆ <<zfs-zpool-replace, æ›¿æ¢>> æˆ– <<zfs-term-resilver, é‡å»º>> æ“ä½œåï¼Œæ± å¯ä»¥æ‰©å±•åˆ°ä½¿ç”¨æ–°è®¾å¤‡çš„å®¹é‡ã€‚ä¾‹å¦‚ï¼Œè€ƒè™‘ä¸€ä¸ªç”± 1 TB é©±åŠ¨å™¨å’Œ 2 TB é©±åŠ¨å™¨ç»„æˆçš„é•œåƒã€‚å¯ç”¨ç©ºé—´ä¸º 1 TB ã€‚å½“ç”¨å¦ä¸€ä¸ª 2 TB é©±åŠ¨å™¨æ›¿æ¢ 1 TB é©±åŠ¨å™¨æ—¶ï¼Œé‡æ–°åŒæ­¥è¿‡ç¨‹å°†ç°æœ‰æ•°æ®å¤åˆ¶åˆ°æ–°é©±åŠ¨å™¨ä¸Šã€‚ç”±äºä¸¤ä¸ªè®¾å¤‡ç°åœ¨éƒ½å…·æœ‰ 2 TB çš„å®¹é‡ï¼Œé•œåƒçš„å¯ç”¨ç©ºé—´å¢é•¿åˆ° 2 TBã€‚Ù‡Start expansion by using `zpool online -e` on each device.  After expanding all devices, the extra space becomes available to the pool.Ù‚é€šè¿‡åœ¨æ¯ä¸ªè®¾å¤‡ä¸Šä½¿ç”¨ `zpool online -e` æ¥å¼€å§‹æ‰©å±•ã€‚åœ¨æ‰©å±•æ‰€æœ‰è®¾å¤‡ä¹‹åï¼Œé¢å¤–çš„ç©ºé—´å°†å¯ç”¨äºæ± ã€‚½Importing and Exporting Pools¸å¯¼å…¥å’Œå¯¼å‡ºå­˜å‚¨æ± ÚL_Export_ pools before moving them to another system.  ZFS unmounts all datasets, marking each device as exported but still locked to prevent use by other disks.  This allows pools to be _imported_ on other machines, other operating systems that support ZFS, and even different hardware architectures (with some caveats, see man:zpool[8]).  When a dataset has open files, use `zpool export -f` to force exporting the pool.  Use this with caution.  The datasets are forcibly unmounted, potentially resulting in unexpected behavior by the applications which had open files on those datasets.ÚPåœ¨å°†å­˜å‚¨æ± ç§»åŠ¨åˆ°å¦ä¸€ä¸ªç³»ç»Ÿä¹‹å‰ï¼Œè¯·å…ˆ _å¯¼å‡ºï¼ˆexportï¼‰_ å®ƒä»¬ã€‚ ZFS ä¼šå¸è½½æ‰€æœ‰æ•°æ®é›†ï¼Œå¹¶å°†æ¯ä¸ªè®¾å¤‡æ ‡è®°ä¸ºå·²å¯¼å‡ºï¼Œä½†ä»ç„¶é”å®šä»¥é˜²æ­¢å…¶ä»–ç£ç›˜ä½¿ç”¨ã€‚è¿™ä½¿å¾—å­˜å‚¨æ± å¯ä»¥åœ¨å…¶ä»–æ”¯æŒ ZFS çš„æœºå™¨ã€å…¶ä»–æ“ä½œç³»ç»Ÿç”šè‡³ä¸åŒçš„ç¡¬ä»¶æ¶æ„ä¸Šå¯¼å…¥ï¼ˆæœ‰ä¸€äº›æ³¨æ„äº‹é¡¹ï¼Œè¯·å‚é˜… man:zpool[8]ï¼‰ã€‚å½“æ•°æ®é›†æœ‰æ‰“å¼€çš„æ–‡ä»¶æ—¶ï¼Œè¯·ä½¿ç”¨ `zpool export -f` å¼ºåˆ¶å¯¼å‡ºå­˜å‚¨æ± ã€‚è¯·è°¨æ…ä½¿ç”¨æ­¤åŠŸèƒ½ã€‚æ•°æ®é›†å°†è¢«å¼ºåˆ¶å¸è½½ï¼Œå¯èƒ½å¯¼è‡´é‚£äº›æ•°æ®é›†ä¸Šæœ‰æ‰“å¼€æ–‡ä»¶çš„åº”ç”¨ç¨‹åºå‡ºç°æ„å¤–è¡Œä¸ºã€‚Ù!Export a pool that is not in use:¾å¯¼å‡ºä¸€ä¸ªæœªä½¿ç”¨çš„æ± ï¼šÚImporting a pool automatically mounts the datasets.  If this is undesired behavior, use `zpool import -N` to prevent it.  `zpool import -o` sets temporary properties for this specific import.  `zpool import altroot=` allows importing a pool with a base mount point instead of the root of the file system.  If the pool was last used on a different system and was not properly exported, force the import using `zpool import -f`.  `zpool import -a` imports all pools that do not appear to be in use by another system.Úİå¯¼å…¥ä¸€ä¸ªå­˜å‚¨æ± ä¼šè‡ªåŠ¨æŒ‚è½½æ•°æ®é›†ã€‚å¦‚æœä¸å¸Œæœ›å‡ºç°è¿™ç§è¡Œä¸ºï¼Œè¯·ä½¿ç”¨ `zpool import -N` æ¥é˜»æ­¢å®ƒã€‚ `zpool import -o` ä¸ºæ­¤ç‰¹å®šå¯¼å…¥è®¾ç½®ä¸´æ—¶å±æ€§ã€‚`zpool import altroot=` å…è®¸ä½¿ç”¨åŸºæœ¬æŒ‚è½½ç‚¹è€Œä¸æ˜¯æ–‡ä»¶ç³»ç»Ÿçš„æ ¹æ¥å¯¼å…¥å­˜å‚¨æ± ã€‚å¦‚æœè¯¥å­˜å‚¨æ± æœ€ååœ¨å¦ä¸€ä¸ªç³»ç»Ÿä¸Šä½¿ç”¨å¹¶ä¸”æ²¡æœ‰æ­£ç¡®å¯¼å‡ºï¼Œè¯·ä½¿ç”¨ `zpool import -f` æ¥å¼ºåˆ¶å¯¼å…¥ã€‚`zpool import -a` å¯¼å…¥æ‰€æœ‰æœªè¢«å…¶ä»–ç³»ç»Ÿä½¿ç”¨çš„å­˜å‚¨æ± ã€‚Ù$List all available pools for import:¾åˆ—å‡ºæ‰€æœ‰å¯å¯¼å…¥çš„æ± ï¼šÙ3Import the pool with an alternative root directory:Ù$å¯¼å…¥å…·æœ‰æ›¿ä»£æ ¹ç›®å½•çš„æ± ï¼š¸Upgrading a Storage Pool¯å‡çº§å­˜å‚¨æ± ÚqAfter upgrading FreeBSD, or if importing a pool from a system using an older version, manually upgrade the pool to the latest ZFS version to support newer features.  Consider whether the pool may ever need importing on an older system before upgrading.  Upgrading is a one-way process.  Upgrade older pools is possible, but downgrading pools with newer features is not.ÚLåœ¨å‡çº§ FreeBSD ä¹‹åï¼Œæˆ–è€…ä»ä½¿ç”¨è¾ƒæ—§ç‰ˆæœ¬çš„ç³»ç»Ÿå¯¼å…¥æ± æ—¶ï¼Œéœ€è¦æ‰‹åŠ¨å°†æ± å‡çº§åˆ°æœ€æ–°çš„ ZFS ç‰ˆæœ¬ä»¥æ”¯æŒæ–°åŠŸèƒ½ã€‚åœ¨å‡çº§ä¹‹å‰ï¼Œè¯·è€ƒè™‘æ± æ˜¯å¦å¯èƒ½éœ€è¦åœ¨è¾ƒæ—§çš„ç³»ç»Ÿä¸Šå¯¼å…¥ã€‚å‡çº§æ˜¯ä¸€ä¸ªå•å‘è¿‡ç¨‹ã€‚å‡çº§è¾ƒæ—§çš„æ± æ˜¯å¯èƒ½çš„ï¼Œä½†æ˜¯æ— æ³•é™çº§å…·æœ‰è¾ƒæ–°åŠŸèƒ½çš„æ± ã€‚Ù.Upgrade a v28 pool to support `Feature Flags`:Ù-å°† v28 æ± å‡çº§ä»¥æ”¯æŒ `Feature Flags`ã€‚ÙÌThe newer features of ZFS will not be available until `zpool upgrade` has completed.  Use `zpool upgrade -v` to see what new features the upgrade provides, as well as which features are already supported.Ù§åªæœ‰åœ¨å®Œæˆ `zpool upgrade` ä¹‹åï¼ŒZFS çš„æ–°åŠŸèƒ½æ‰ä¼šå¯ç”¨ã€‚ä½¿ç”¨ `zpool upgrade -v` å‘½ä»¤æŸ¥çœ‹å‡çº§æä¾›çš„æ–°åŠŸèƒ½ï¼Œä»¥åŠå·²ç»æ”¯æŒçš„åŠŸèƒ½ã€‚Ù,Upgrade a pool to support new feature flags:Ù0å‡çº§ä¸€ä¸ªæ± å­ä»¥æ”¯æŒæ–°çš„åŠŸèƒ½æ ‡å¿—ï¼šÚ#Update the boot code on systems that boot from a pool to support the new pool version.  Use `gpart bootcode` on the partition that contains the boot code.  Two types of bootcode are available, depending on way the system boots: GPT (the most common option) and EFI (for more modern systems).Úæ›´æ–°ä»æ± ä¸­å¼•å¯¼çš„ç³»ç»Ÿçš„å¼•å¯¼ä»£ç ï¼Œä»¥æ”¯æŒæ–°çš„æ± ç‰ˆæœ¬ã€‚åœ¨åŒ…å«å¼•å¯¼ä»£ç çš„åˆ†åŒºä¸Šä½¿ç”¨ `gpart bootcode` å‘½ä»¤ã€‚æ ¹æ®ç³»ç»Ÿçš„å¼•å¯¼æ–¹å¼ï¼Œæœ‰ä¸¤ç§ç±»å‹çš„å¼•å¯¼ä»£ç å¯ç”¨ï¼šGPTï¼ˆæœ€å¸¸è§çš„é€‰é¡¹ï¼‰å’Œ EFIï¼ˆé€‚ç”¨äºæ›´ç°ä»£çš„ç³»ç»Ÿï¼‰ã€‚Ù5For legacy boot using GPT, use the following command:Ù;å¯¹äºä½¿ç”¨ GPT çš„ä¼ ç»Ÿå¼•å¯¼ï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼šÙ=For systems using EFI to boot, execute the following command:Ù;å¯¹äºä½¿ç”¨ EFI å¼•å¯¼çš„ç³»ç»Ÿï¼Œè¯·æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼šÙ]Apply the bootcode to all bootable disks in the pool.  See man:gpart[8] for more information.Ùgå°†å¼•å¯¼ä»£ç åº”ç”¨äºæ± ä¸­çš„æ‰€æœ‰å¯å¼•å¯¼ç£ç›˜ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜… man:gpart[8]ã€‚Ù Displaying Recorded Pool History¸æ˜¾ç¤ºæ± çš„å†å²è®°å½•ÚoZFS records commands that change the pool, including creating datasets, changing properties, or replacing a disk.  Reviewing history about a pool's creation is useful, as is checking which user performed a specific action and when.  History is not kept in a log file, but is part of the pool itself.  The command to review this history is aptly named `zpool history`:ÚpZFS è®°å½•æ›´æ”¹æ± çš„å‘½ä»¤ï¼ŒåŒ…æ‹¬åˆ›å»ºæ•°æ®é›†ã€æ›´æ”¹å±æ€§æˆ–æ›¿æ¢ç£ç›˜ã€‚æŸ¥çœ‹å…³äºæ± åˆ›å»ºçš„å†å²è®°å½•å¾ˆæœ‰ç”¨ï¼Œè¿˜å¯ä»¥æ£€æŸ¥å“ªä¸ªç”¨æˆ·æ‰§è¡Œäº†ç‰¹å®šçš„æ“ä½œä»¥åŠä½•æ—¶æ‰§è¡Œçš„ã€‚å†å²è®°å½•ä¸ä¼šä¿å­˜åœ¨æ—¥å¿—æ–‡ä»¶ä¸­ï¼Œè€Œæ˜¯ä½œä¸ºæ± æœ¬èº«çš„ä¸€éƒ¨åˆ†ã€‚ç”¨äºæŸ¥çœ‹è¿™ä¸ªå†å²è®°å½•çš„å‘½ä»¤è¢«æ°å½“åœ°å‘½åä¸º `zpool history`ã€‚ÙÏThe output shows `zpool` and `zfs` commands altering the pool in some way along with a timestamp.  Commands like `zfs list` are not included.  When specifying no pool name, ZFS displays history of all pools.ÙÌè¾“å‡ºæ˜¾ç¤ºäº† `zpool` å’Œ `zfs` å‘½ä»¤ä»¥æŸç§æ–¹å¼ä¿®æ”¹äº†æ± ï¼Œå¹¶é™„å¸¦äº†æ—¶é—´æˆ³ã€‚ä¸åŒ…æ‹¬åƒ `zfs list` è¿™æ ·çš„å‘½ä»¤ã€‚å½“æœªæŒ‡å®šæ± åç§°æ—¶ï¼Œ ZFS ä¼šæ˜¾ç¤ºæ‰€æœ‰æ± çš„å†å²è®°å½•ã€‚Ù¥`zpool history` can show even more information when providing the options `-i` or `-l`.  `-i` displays user-initiated events as well as internally logged ZFS events.Ù¥å½“ä½¿ç”¨é€‰é¡¹ `-i` æˆ– `-l` æ—¶ï¼Œ`zpool history` å‘½ä»¤å¯ä»¥æ˜¾ç¤ºæ›´å¤šçš„ä¿¡æ¯ã€‚ `-i` é€‰é¡¹ä¼šæ˜¾ç¤ºç”¨æˆ·å‘èµ·çš„äº‹ä»¶ä»¥åŠå†…éƒ¨è®°å½•çš„ ZFS äº‹ä»¶ã€‚ÙÂShow more details by adding `-l`.  Showing history records in a long format, including information like the name of the user who issued the command and the hostname on which the change happened.Ù“é€šè¿‡æ·»åŠ  `-l` æ¥æ˜¾ç¤ºæ›´å¤šè¯¦ç»†ä¿¡æ¯ã€‚ä»¥é•¿æ ¼å¼æ˜¾ç¤ºå†å²è®°å½•ï¼ŒåŒ…æ‹¬å‘å‡ºå‘½ä»¤çš„ç”¨æˆ·çš„åç§°å’Œå‘ç”Ÿæ›´æ”¹çš„ä¸»æœºåã€‚ÚªThe output shows that the `root` user created the mirrored pool with disks [.filename]#/dev/ada0# and [.filename]#/dev/ada1#.  The hostname `myzfsbox` is also shown in the commands after the pool's creation.  The hostname display becomes important when exporting the pool from one system and importing on another.  It's possible to distinguish the commands issued on the other system by the hostname recorded for each command.Úgè¾“å‡ºæ˜¾ç¤º `root` ç”¨æˆ·ä½¿ç”¨ç£ç›˜ [.filename]#/dev/ada0# å’Œ [.filename]#/dev/ada1# åˆ›å»ºäº†é•œåƒæ± ã€‚åœ¨æ± åˆ›å»ºåçš„å‘½ä»¤ä¸­è¿˜æ˜¾ç¤ºäº†ä¸»æœºå `myzfsbox` ã€‚ä¸»æœºåçš„æ˜¾ç¤ºåœ¨å°†æ± ä»ä¸€ä¸ªç³»ç»Ÿå¯¼å‡ºå¹¶åœ¨å¦ä¸€ä¸ªç³»ç»Ÿå¯¼å…¥æ—¶å˜å¾—é‡è¦ã€‚å¯ä»¥é€šè¿‡ä¸ºæ¯ä¸ªå‘½ä»¤è®°å½•çš„ä¸»æœºåæ¥åŒºåˆ†åœ¨å¦ä¸€ä¸ªç³»ç»Ÿä¸Šå‘å‡ºçš„å‘½ä»¤ã€‚ÙóCombine both options to `zpool history` to give the most detailed information possible for any given pool.  Pool history provides valuable information when tracking down the actions performed or when needing more detailed output for debugging.Ù×å°†ä¸¤ä¸ªé€‰é¡¹ `zpool history` ç»“åˆèµ·æ¥ï¼Œä»¥ä¾¿ä¸ºä»»ä½•ç»™å®šçš„æ± æä¾›å°½å¯èƒ½è¯¦ç»†çš„ä¿¡æ¯ã€‚æ± å†å²è®°å½•åœ¨è¿½è¸ªæ‰§è¡Œçš„æ“ä½œæˆ–éœ€è¦æ›´è¯¦ç»†çš„è¾“å‡ºè¿›è¡Œè°ƒè¯•æ—¶æä¾›æœ‰ä»·å€¼çš„ä¿¡æ¯ã€‚¶Performance Monitoring¬æ€§èƒ½ç›‘æ§ÚTA built-in monitoring system can display pool I/O statistics in real time.  It shows the amount of free and used space on the pool, read and write operations performed per second, and I/O bandwidth used.  By default, ZFS monitors and displays all pools in the system.  Provide a pool name to limit monitoring to that pool.  A basic example:Ú8å†…ç½®çš„ç›‘æ§ç³»ç»Ÿå¯ä»¥å®æ—¶æ˜¾ç¤ºæ± çš„ I/O ç»Ÿè®¡ä¿¡æ¯ã€‚å®ƒæ˜¾ç¤ºæ± ä¸­çš„å¯ç”¨ç©ºé—´å’Œå·²ä½¿ç”¨ç©ºé—´çš„æ•°é‡ï¼Œæ¯ç§’æ‰§è¡Œçš„è¯»å†™æ“ä½œæ¬¡æ•°ä»¥åŠä½¿ç”¨çš„ I/O å¸¦å®½ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œ ZFS ç›‘è§†å¹¶æ˜¾ç¤ºç³»ç»Ÿä¸­çš„æ‰€æœ‰æ± ã€‚æä¾›æ± åç§°ä»¥é™åˆ¶ç›‘æ§åˆ°è¯¥æ± ã€‚ä¸€ä¸ªåŸºæœ¬ç¤ºä¾‹ï¼šÚdTo continuously see I/O activity, specify a number as the last parameter, indicating an interval in seconds to wait between updates.  The next statistic line prints after each interval.  Press kbd:[Ctrl+C] to stop this continuous monitoring.  Give a second number on the command line after the interval to specify the total number of statistics to display.Ú/è¦æŒç»­æŸ¥çœ‹ I/O æ´»åŠ¨ï¼Œè¯·åœ¨æœ€åä¸€ä¸ªå‚æ•°ä¸­æŒ‡å®šä¸€ä¸ªæ•°å­—ï¼Œè¡¨ç¤ºæ›´æ–°ä¹‹é—´ç­‰å¾…çš„ç§’æ•°é—´éš”ã€‚æ¯ä¸ªé—´éš”åéƒ½ä¼šæ‰“å°ä¸‹ä¸€ä¸ªç»Ÿè®¡è¡Œã€‚æŒ‰ä¸‹ kbd:[Ctrl + C] åœæ­¢æ­¤è¿ç»­ç›‘è§†ã€‚åœ¨é—´éš”ä¹‹åçš„å‘½ä»¤è¡Œä¸Šç»™å‡ºç¬¬äºŒä¸ªæ•°å­—ï¼Œä»¥æŒ‡å®šè¦æ˜¾ç¤ºçš„ç»Ÿè®¡æ€»æ•°ã€‚Ú<Display even more detailed I/O statistics with `-v`.  Each device in the pool appears with a statistics line.  This is useful for seeing read and write operations performed on each device, and can help determine if any individual device is slowing down the pool.  This example shows a mirrored pool with two devices:Ú:ä½¿ç”¨ `-v` å‚æ•°å¯ä»¥æ˜¾ç¤ºæ›´è¯¦ç»†çš„ I/O ç»Ÿè®¡ä¿¡æ¯ã€‚æ± ä¸­çš„æ¯ä¸ªè®¾å¤‡éƒ½ä¼šæ˜¾ç¤ºä¸€è¡Œç»Ÿè®¡ä¿¡æ¯ã€‚è¿™å¯¹äºæŸ¥çœ‹åœ¨æ¯ä¸ªè®¾å¤‡ä¸Šæ‰§è¡Œçš„è¯»å†™æ“ä½œéå¸¸æœ‰ç”¨ï¼Œå¹¶ä¸”å¯ä»¥å¸®åŠ©ç¡®å®šæ˜¯å¦æœ‰ä»»ä½•å•ä¸ªè®¾å¤‡å¯¼è‡´æ± å˜æ…¢ã€‚ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†ä¸€ä¸ªå…·æœ‰ä¸¤ä¸ªè®¾å¤‡çš„é•œåƒæ± ã€‚¸Splitting a Storage Pool¯åˆ†å‰²å­˜å‚¨æ± ÚZFS can split a pool consisting of one or more mirror vdevs into two pools.  Unless otherwise specified, ZFS detaches the last member of each mirror and creates a new pool containing the same data.  Be sure to make a dry run of the operation with `-n` first.  This displays the details of the requested operation without actually performing it.  This helps confirm that the operation will do what the user intends.ÚjZFS å¯ä»¥å°†ç”±ä¸€ä¸ªæˆ–å¤šä¸ªé•œåƒ vdev ç»„æˆçš„æ± åˆ†å‰²æˆä¸¤ä¸ªæ± ã€‚é™¤éå¦æœ‰æŒ‡å®šï¼ŒZFS ä¼šåˆ†ç¦»æ¯ä¸ªé•œåƒçš„æœ€åä¸€ä¸ªæˆå‘˜ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªåŒ…å«ç›¸åŒæ•°æ®çš„æ–°æ± ã€‚è¯·åŠ¡å¿…å…ˆä½¿ç”¨ `-n` è¿›è¡Œè¯•è¿è¡Œã€‚è¿™å°†æ˜¾ç¤ºæ‰€è¯·æ±‚æ“ä½œçš„è¯¦ç»†ä¿¡æ¯ï¼Œä½†ä¸ä¼šå®é™…æ‰§è¡Œæ“ä½œã€‚è¿™æœ‰åŠ©äºç¡®è®¤æ“ä½œæ˜¯å¦ç¬¦åˆç”¨æˆ·çš„æ„å›¾ã€‚´`zfs` Administration¬`zfs` ç®¡ç†Ù‘The `zfs` utility can create, destroy, and manage all existing ZFS datasets within a pool.  To manage the pool itself, use <<zfs-zpool,`zpool`>>.Ù`zfs` å®ç”¨ç¨‹åºå¯ä»¥åœ¨æ± ä¸­åˆ›å»ºã€é”€æ¯å’Œç®¡ç†æ‰€æœ‰ç°æœ‰çš„ ZFS æ•°æ®é›†ã€‚è¦ç®¡ç†æ± æœ¬èº«ï¼Œè¯·ä½¿ç”¨ <<zfs-zpool,`zpool`>>ã€‚Ù Creating and Destroying Datasets¸åˆ›å»ºå’Œé”€æ¯æ•°æ®é›†ÚDUnlike traditional disks and volume managers, space in ZFS is _not_ preallocated.  With traditional file systems, after partitioning and assigning the space, there is no way to add a new file system without adding a new disk.  With ZFS, creating new file systems is possible at any time.  Each <<zfs-term-dataset,_dataset_>> has properties including features like compression, deduplication, caching, and quotas, as well as other useful properties like readonly, case sensitivity, network file sharing, and a mount point.  Nesting datasets within each other is possible and child datasets will inherit properties from their ancestors.  <<zfs-zfs-allow,Delegate>>, <<zfs-zfs-send,replicate>>, <<zfs-zfs-snapshot,snapshot>>, <<zfs-zfs-jail,jail>> allows administering and destroying each dataset as a unit.  Creating a separate dataset for each different type or set of files has advantages.  The drawbacks to having a large number of datasets are that some commands like `zfs list` will be slower, and that mounting of hundreds or even thousands of datasets will slow the FreeBSD boot process.Ú½ä¸ä¼ ç»Ÿçš„ç£ç›˜å’Œå·ç®¡ç†å™¨ä¸åŒï¼ŒZFS ä¸­çš„ç©ºé—´æ˜¯ _ä¸é¢„åˆ†é…_ çš„ã€‚åœ¨ä¼ ç»Ÿæ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œåˆ†åŒºå’Œåˆ†é…ç©ºé—´åï¼Œæ— æ³•åœ¨ä¸æ·»åŠ æ–°ç£ç›˜çš„æƒ…å†µä¸‹æ·»åŠ æ–°çš„æ–‡ä»¶ç³»ç»Ÿã€‚è€Œåœ¨ ZFS ä¸­ï¼Œå¯ä»¥éšæ—¶åˆ›å»ºæ–°çš„æ–‡ä»¶ç³»ç»Ÿã€‚æ¯ä¸ª <<zfs-term-dataset,æ•°æ®é›†>> éƒ½æœ‰å±æ€§ï¼ŒåŒ…æ‹¬å‹ç¼©ã€å»é‡ã€ç¼“å­˜å’Œé…é¢ç­‰åŠŸèƒ½ï¼Œä»¥åŠå…¶ä»–æœ‰ç”¨çš„å±æ€§ï¼Œå¦‚åªè¯»ã€å¤§å°å†™æ•æ„Ÿã€ç½‘ç»œæ–‡ä»¶å…±äº«å’ŒæŒ‚è½½ç‚¹ã€‚å¯ä»¥å°†æ•°æ®é›†åµŒå¥—åœ¨å½¼æ­¤ä¹‹é—´ï¼Œå¹¶ä¸”å­æ•°æ®é›†å°†ç»§æ‰¿å…¶ç¥–å…ˆçš„å±æ€§ã€‚ <<zfs-zfs-allow,å§”æ´¾>>ã€<<zfs-zfs-send,å¤åˆ¶>>ã€<<zfs-zfs-snapshot,å¿«ç…§>>ã€<<zfs-zfs-jail,jail>> å…è®¸å°†æ¯ä¸ªæ•°æ®é›†ä½œä¸ºä¸€ä¸ªå•å…ƒè¿›è¡Œç®¡ç†å’Œé”€æ¯ã€‚ä¸ºæ¯ç§ä¸åŒç±»å‹æˆ–æ–‡ä»¶é›†åˆ›å»ºå•ç‹¬çš„æ•°æ®é›†å…·æœ‰ä¼˜åŠ¿ã€‚æ‹¥æœ‰å¤§é‡æ•°æ®é›†çš„ç¼ºç‚¹æ˜¯ï¼ŒæŸäº›å‘½ä»¤ï¼ˆå¦‚ `zfs list`ï¼‰çš„é€Ÿåº¦ä¼šå˜æ…¢ï¼Œå¹¶ä¸”æŒ‚è½½æ•°ç™¾ç”šè‡³æ•°åƒä¸ªæ•°æ®é›†ä¼šå‡æ…¢ FreeBSD çš„å¯åŠ¨è¿‡ç¨‹ã€‚ÙSCreate a new dataset and enable <<zfs-term-compression-lz4,LZ4 compression>> on it:Ù[åˆ›å»ºä¸€ä¸ªæ–°çš„æ•°æ®é›†ï¼Œå¹¶åœ¨å…¶ä¸Šå¯ç”¨ <<zfs-term-compression-lz4,LZ4 å‹ç¼©>>ã€‚ÙŸDestroying a dataset is much quicker than deleting the files on the dataset, as it does not involve scanning the files and updating the corresponding metadata.Ùxé”€æ¯æ•°æ®é›†æ¯”åˆ é™¤æ•°æ®é›†ä¸Šçš„æ–‡ä»¶è¦å¿«å¾—å¤šï¼Œå› ä¸ºå®ƒä¸æ¶‰åŠæ‰«ææ–‡ä»¶å’Œæ›´æ–°ç›¸åº”çš„å…ƒæ•°æ®ã€‚¼Destroy the created dataset:¾é”€æ¯å·²åˆ›å»ºçš„æ•°æ®é›†ï¼šÚ‰In modern versions of ZFS, `zfs destroy` is asynchronous, and the free space might take minutes to appear in the pool.  Use `zpool get freeing _poolname_` to see the `freeing` property, that shows which datasets are having their blocks freed in the background.  If there are child datasets, like <<zfs-term-snapshot,snapshots>> or other datasets, destroying the parent is impossible.  To destroy a dataset and its children, use `-r` to recursively destroy the dataset and its children.  Use `-n -v` to list datasets and snapshots destroyed by this operation, without actually destroy anything.  Space reclaimed by destroying snapshots is also shown.Ú}åœ¨ç°ä»£ç‰ˆæœ¬çš„ ZFS ä¸­ï¼Œ `zfs destroy` æ˜¯å¼‚æ­¥çš„ï¼Œé‡Šæ”¾çš„ç©ºé—´å¯èƒ½éœ€è¦å‡ åˆ†é’Ÿæ‰ä¼šåœ¨æ± ä¸­æ˜¾ç¤ºå‡ºæ¥ã€‚ä½¿ç”¨ `zpool get freeing _poolname_` å‘½ä»¤æ¥æŸ¥çœ‹ `freeing` å±æ€§ï¼Œè¯¥å±æ€§æ˜¾ç¤ºäº†å“ªäº›æ•°æ®é›†æ­£åœ¨åå°é‡Šæ”¾å…¶å—ã€‚å¦‚æœå­˜åœ¨å­æ•°æ®é›†ï¼Œä¾‹å¦‚  <<zfs-term-snapshot,å¿«ç…§>> æˆ–å…¶ä»–æ•°æ®é›†ï¼Œé‚£ä¹ˆæ— æ³•é”€æ¯çˆ¶æ•°æ®é›†ã€‚è¦é”€æ¯ä¸€ä¸ªæ•°æ®é›†åŠå…¶å­æ•°æ®é›†ï¼Œå¯ä»¥ä½¿ç”¨ `-r` é€‰é¡¹é€’å½’åœ°é”€æ¯æ•°æ®é›†åŠå…¶å­æ•°æ®é›†ã€‚ä½¿ç”¨ `-n -v` é€‰é¡¹åˆ—å‡ºæ­¤æ“ä½œé”€æ¯çš„æ•°æ®é›†å’Œå¿«ç…§ï¼Œè€Œä¸å®é™…é”€æ¯ä»»ä½•å†…å®¹ã€‚é”€æ¯å¿«ç…§é‡Šæ”¾çš„ç©ºé—´ä¹Ÿä¼šæ˜¾ç¤ºå‡ºæ¥ã€‚¿Creating and Destroying Volumes²åˆ›å»ºå’Œé”€æ¯å·ÚGA volume is a special dataset type.  Rather than mounting as a file system, expose it as a block device under [.filename]#/dev/zvol/poolname/dataset#.  This allows using the volume for other file systems, to back the disks of a virtual machine, or to make it available to other network hosts using protocols like iSCSI or HAST.Ú-å·æ˜¯ä¸€ç§ç‰¹æ®Šçš„æ•°æ®é›†ç±»å‹ã€‚å®ƒä¸åƒæ–‡ä»¶ç³»ç»Ÿé‚£æ ·æŒ‚è½½ï¼Œè€Œæ˜¯åœ¨ `/dev/zvol/poolname/dataset` ä¸‹ä»¥å—è®¾å¤‡çš„å½¢å¼å…¬å¼€ã€‚è¿™ä½¿å¾—å¯ä»¥å°†å·ç”¨äºå…¶ä»–æ–‡ä»¶ç³»ç»Ÿï¼Œç”¨äºè™šæ‹Ÿæœºçš„ç£ç›˜å¤‡ä»½ï¼Œæˆ–è€…é€šè¿‡ iSCSI æˆ– HAST ç­‰åè®®ä½¿å…¶å¯¹å…¶ä»–ç½‘ç»œä¸»æœºå¯ç”¨ã€‚ÚiFormat a volume with any file system or without a file system to store raw data.  To the user, a volume appears to be a regular disk.  Putting ordinary file systems on these _zvols_ provides features that ordinary disks or file systems do not have.  For example, using the compression property on a 250 MB volume allows creation of a compressed FAT file system.Úsä½¿ç”¨ä»»ä½•æ–‡ä»¶ç³»ç»Ÿæˆ–è€…ä¸ä½¿ç”¨æ–‡ä»¶ç³»ç»Ÿæ¥æ ¼å¼åŒ–ä¸€ä¸ªå·ï¼Œä»¥å­˜å‚¨åŸå§‹æ•°æ®ã€‚å¯¹äºç”¨æˆ·æ¥è¯´ï¼Œä¸€ä¸ªå·çœ‹èµ·æ¥å°±åƒä¸€ä¸ªæ™®é€šçš„ç£ç›˜ã€‚åœ¨è¿™äº› _zvol_ ä¸Šæ”¾ç½®æ™®é€šçš„æ–‡ä»¶ç³»ç»Ÿæä¾›äº†æ™®é€šç£ç›˜æˆ–æ–‡ä»¶ç³»ç»Ÿæ‰€æ²¡æœ‰çš„åŠŸèƒ½ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨å‹ç¼©å±æ€§åœ¨ä¸€ä¸ª 250MB çš„å·ä¸Šå¯ä»¥åˆ›å»ºä¸€ä¸ªå‹ç¼©çš„ FAT æ–‡ä»¶ç³»ç»Ÿã€‚Ù¾Destroying a volume is much the same as destroying a regular file system dataset.  The operation is nearly instantaneous, but it may take minutes to reclaim the free space in the background.Ù±é”€æ¯ä¸€ä¸ªå·ä¸é”€æ¯ä¸€ä¸ªå¸¸è§„æ–‡ä»¶ç³»ç»Ÿæ•°æ®é›†åŸºæœ¬ç›¸åŒã€‚è¯¥æ“ä½œå‡ ä¹æ˜¯ç¬æ—¶å®Œæˆçš„ï¼Œä½†åœ¨åå°é‡æ–°è·å–ç©ºé—²ç©ºé—´å¯èƒ½éœ€è¦å‡ åˆ†é’Ÿçš„æ—¶é—´ã€‚²Renaming a Dataset²é‡å‘½åæ•°æ®é›†Ú„To change the name of a dataset, use `zfs rename`.  To change the parent of a dataset, use this command as well.  Renaming a dataset to have a different parent dataset will change the value of those properties inherited from the parent dataset.  Renaming a dataset unmounts then remounts it in the new location (inherited from the new parent dataset).  To prevent this behavior, use `-u`.Úpè¦æ›´æ”¹æ•°æ®é›†çš„åç§°ï¼Œè¯·ä½¿ç”¨ `zfs rename` å‘½ä»¤ã€‚è¦æ›´æ”¹æ•°æ®é›†çš„çˆ¶çº§ï¼Œè¯·åŒæ ·ä½¿ç”¨æ­¤å‘½ä»¤ã€‚å°†æ•°æ®é›†é‡å‘½åä¸ºå…·æœ‰ä¸åŒçˆ¶çº§çš„æ•°æ®é›†å°†æ›´æ”¹ä»çˆ¶çº§æ•°æ®é›†ç»§æ‰¿çš„å±æ€§çš„å€¼ã€‚å°†æ•°æ®é›†é‡å‘½åä¸ºæ–°ä½ç½®ï¼ˆä»æ–°çˆ¶çº§æ•°æ®é›†ç»§æ‰¿ï¼‰å°†å¸è½½ç„¶åé‡æ–°æŒ‚è½½å®ƒã€‚è¦é˜²æ­¢æ­¤è¡Œä¸ºï¼Œè¯·ä½¿ç”¨ `-u` é€‰é¡¹ã€‚ÙDRename a dataset and move it to be under a different parent dataset:Ù?é‡å‘½åæ•°æ®é›†å¹¶å°†å…¶ç§»åŠ¨åˆ°ä¸åŒçš„çˆ¶æ•°æ®é›†ä¸‹ï¼šÙîRenaming snapshots uses the same command.  Due to the nature of snapshots, rename cannot change their parent dataset.  To rename a recursive snapshot, specify `-r`; this will also rename all snapshots with the same name in child datasets.ÙŞé‡å‘½åå¿«ç…§ä½¿ç”¨ç›¸åŒçš„å‘½ä»¤ã€‚ç”±äºå¿«ç…§çš„ç‰¹æ€§ï¼Œé‡å‘½åä¸èƒ½æ”¹å˜å®ƒä»¬çš„çˆ¶æ•°æ®é›†ã€‚è¦é‡å‘½åé€’å½’å¿«ç…§ï¼Œè¯·æŒ‡å®š `-r` ï¼›è¿™ä¹Ÿä¼šé‡å‘½åæ‰€æœ‰å­æ•°æ®é›†ä¸­å…·æœ‰ç›¸åŒåç§°çš„å¿«ç…§ã€‚ºSetting Dataset Propertiesµè®¾ç½®æ•°æ®é›†å±æ€§ÚĞEach ZFS dataset has properties that control its behavior.  Most properties are automatically inherited from the parent dataset, but can be overridden locally.  Set a property on a dataset with `zfs set _property=value dataset_`.  Most properties have a limited set of valid values, `zfs get` will display each possible property and valid values.  Using `zfs inherit` reverts most properties to their inherited values.  User-defined properties are also possible.  They become part of the dataset configuration and provide further information about the dataset or its contents.  To distinguish these custom properties from the ones supplied as part of ZFS, use a colon (`:`) to create a custom namespace for the property.Úæ¯ä¸ª ZFS æ•°æ®é›†éƒ½æœ‰æ§åˆ¶å…¶è¡Œä¸ºçš„å±æ€§ã€‚å¤§å¤šæ•°å±æ€§ä¼šè‡ªåŠ¨ä»çˆ¶æ•°æ®é›†ç»§æ‰¿ï¼Œä½†å¯ä»¥åœ¨æœ¬åœ°è¿›è¡Œè¦†ç›–ã€‚ä½¿ç”¨ `zfs set _property=value dataset_` åœ¨æ•°æ®é›†ä¸Šè®¾ç½®å±æ€§ã€‚å¤§å¤šæ•°å±æ€§æœ‰ä¸€ç»„æœ‰é™çš„æœ‰æ•ˆå€¼ï¼Œ`zfs get` å°†æ˜¾ç¤ºæ¯ä¸ªå¯èƒ½çš„å±æ€§å’Œæœ‰æ•ˆå€¼ã€‚ä½¿ç”¨ `zfs inherit` å°†å¤§å¤šæ•°å±æ€§æ¢å¤ä¸ºå…¶ç»§æ‰¿çš„å€¼ã€‚è¿˜å¯ä»¥å®šä¹‰ç”¨æˆ·è‡ªå®šä¹‰å±æ€§ã€‚å®ƒä»¬æˆä¸ºæ•°æ®é›†é…ç½®çš„ä¸€éƒ¨åˆ†ï¼Œå¹¶æä¾›æœ‰å…³æ•°æ®é›†æˆ–å…¶å†…å®¹çš„è¿›ä¸€æ­¥ä¿¡æ¯ã€‚ä¸ºäº†åŒºåˆ†è¿™äº›è‡ªå®šä¹‰å±æ€§å’Œä½œä¸º ZFS çš„ä¸€éƒ¨åˆ†æä¾›çš„å±æ€§ï¼Œå¯ä»¥ä½¿ç”¨å†’å·ï¼ˆ`:`ï¼‰ä¸ºå±æ€§åˆ›å»ºè‡ªå®šä¹‰å‘½åç©ºé—´ã€‚ÙÉTo remove a custom property, use `zfs inherit` with `-r`.  If the custom property is not defined in any of the parent datasets, this option removes it (but the pool's history still records the change).Ùáè¦åˆ é™¤è‡ªå®šä¹‰å±æ€§ï¼Œè¯·ä½¿ç”¨ `zfs inherit` å‘½ä»¤å¹¶åŠ ä¸Š `-r` é€‰é¡¹ã€‚å¦‚æœè‡ªå®šä¹‰å±æ€§åœ¨ä»»ä½•çˆ¶æ•°æ®é›†ä¸­éƒ½æ²¡æœ‰å®šä¹‰ï¼Œè¿™ä¸ªé€‰é¡¹å°†åˆ é™¤å®ƒï¼ˆä½†æ± çš„å†å²è®°å½•ä»ç„¶ä¼šè®°å½•è¿™ä¸ªæ›´æ”¹ï¼‰ã€‚Ù$Getting and Setting Share Properties»è·å–å’Œè®¾ç½®å…±äº«å±æ€§ÙÿTwo commonly used and useful dataset properties are the NFS and SMB share options.  Setting these defines if and how ZFS shares datasets on the network.  At present, FreeBSD supports setting NFS sharing alone.  To get the current status of a share, enter:Ùôä¸¤ä¸ªå¸¸ç”¨ä¸”æœ‰ç”¨çš„æ•°æ®é›†å±æ€§æ˜¯ NFS å’Œ SMB å…±äº«é€‰é¡¹ã€‚è®¾ç½®è¿™äº›é€‰é¡¹å¯ä»¥å®šä¹‰ ZFS åœ¨ç½‘ç»œä¸Šå…±äº«æ•°æ®é›†çš„æ–¹å¼å’Œæ–¹å¼ã€‚ç›®å‰ï¼ŒFreeBSD ä»…æ”¯æŒè®¾ç½® NFS å…±äº«ã€‚è¦è·å–å…±äº«çš„å½“å‰çŠ¶æ€ï¼Œè¯·è¾“å…¥ï¼šÙ&To enable sharing of a dataset, enter:Ù*è¦å¯ç”¨æ•°æ®é›†çš„å…±äº«ï¼Œè¯·è¾“å…¥ï¼šÙšSet other options for sharing datasets through NFS, such as `-alldirs`, `-maproot` and `-network`.  To set options on a dataset shared through NFS, enter:Ù£è®¾ç½®é€šè¿‡ NFS å…±äº«æ•°æ®é›†çš„å…¶ä»–é€‰é¡¹ï¼Œä¾‹å¦‚ `-alldirs`ã€`-maproot` å’Œ `-network`ã€‚è¦åœ¨é€šè¿‡ NFS å…±äº«çš„æ•°æ®é›†ä¸Šè®¾ç½®é€‰é¡¹ï¼Œè¯·è¾“å…¥ï¼š²Managing Snapshots¬ç®¡ç†å¿«ç…§Ú<<zfs-term-snapshot,Snapshots>> are one of the most powerful features of ZFS.  A snapshot provides a read-only, point-in-time copy of the dataset.  With Copy-On-Write (COW), ZFS creates snapshots fast by preserving older versions of the data on disk.  If no snapshots exist, ZFS reclaims space for future use when data is rewritten or deleted.  Snapshots preserve disk space by recording just the differences between the current dataset and a previous version.  Allowing snapshots on whole datasets, not on individual files or directories.  A snapshot from a dataset duplicates everything contained in it.  This includes the file system properties, files, directories, permissions, and so on.  Snapshots use no extra space when first created, but consume space as the blocks they reference change.  Recursive snapshots taken with `-r` create snapshots with the same name on the dataset and its children, providing a consistent moment-in-time snapshot of the file systems.  This can be important when an application has files on related datasets or that depend upon each other.  Without snapshots, a backup would have copies of the files from different points in time.Úü<<zfs-term-snapshot,å¿«ç…§>> æ˜¯ ZFS æœ€å¼ºå¤§çš„åŠŸèƒ½ä¹‹ä¸€ã€‚å¿«ç…§æä¾›äº†æ•°æ®é›†çš„åªè¯»ã€æ—¶é—´ç‚¹çš„å‰¯æœ¬ã€‚é€šè¿‡å†™æ—¶å¤åˆ¶ï¼ˆCOWï¼‰ï¼ŒZFS é€šè¿‡åœ¨ç£ç›˜ä¸Šä¿ç•™æ—§ç‰ˆæœ¬çš„æ•°æ®æ¥å¿«é€Ÿåˆ›å»ºå¿«ç…§ã€‚å¦‚æœæ²¡æœ‰å¿«ç…§å­˜åœ¨ï¼Œå½“æ•°æ®è¢«é‡å†™æˆ–åˆ é™¤æ—¶ï¼ŒZFS ä¼šå›æ”¶ç©ºé—´ä»¥ä¾›å°†æ¥ä½¿ç”¨ã€‚å¿«ç…§é€šè¿‡è®°å½•å½“å‰æ•°æ®é›†ä¸å…ˆå‰ç‰ˆæœ¬ä¹‹é—´çš„å·®å¼‚æ¥ä¿ç•™ç£ç›˜ç©ºé—´ã€‚å…è®¸åœ¨æ•´ä¸ªæ•°æ®é›†ä¸Šè¿›è¡Œå¿«ç…§ï¼Œè€Œä¸æ˜¯åœ¨å•ä¸ªæ–‡ä»¶æˆ–ç›®å½•ä¸Šè¿›è¡Œå¿«ç…§ã€‚æ•°æ®é›†çš„å¿«ç…§å¤åˆ¶å…¶ä¸­åŒ…å«çš„æ‰€æœ‰å†…å®¹ã€‚è¿™åŒ…æ‹¬æ–‡ä»¶ç³»ç»Ÿå±æ€§ã€æ–‡ä»¶ã€ç›®å½•ã€æƒé™ç­‰ã€‚å¿«ç…§åœ¨åˆ›å»ºæ—¶ä¸å ç”¨é¢å¤–çš„ç©ºé—´ï¼Œä½†éšç€å®ƒä»¬å¼•ç”¨çš„å—çš„å˜åŒ–è€Œæ¶ˆè€—ç©ºé—´ã€‚ä½¿ç”¨ `-r` è¿›è¡Œé€’å½’å¿«ç…§ä¼šåœ¨æ•°æ®é›†åŠå…¶å­æ•°æ®é›†ä¸Šåˆ›å»ºå…·æœ‰ç›¸åŒåç§°çš„å¿«ç…§ï¼Œæä¾›æ–‡ä»¶ç³»ç»Ÿçš„ä¸€è‡´æ—¶åˆ»å¿«ç…§ã€‚å½“åº”ç”¨ç¨‹åºåœ¨ç›¸å…³æ•°æ®é›†ä¸Šæœ‰æ–‡ä»¶æˆ–ç›¸äº’ä¾èµ–æ—¶ï¼Œè¿™å¯èƒ½å¾ˆé‡è¦ã€‚å¦‚æœæ²¡æœ‰å¿«ç…§ï¼Œå¤‡ä»½å°†å…·æœ‰æ¥è‡ªä¸åŒæ—¶é—´ç‚¹çš„æ–‡ä»¶å‰¯æœ¬ã€‚Ú	Snapshots in ZFS provide a variety of features that even other file systems with snapshot functionality lack.  A typical example of snapshot use is as a quick way of backing up the current state of the file system when performing a risky action like a software installation or a system upgrade.  If the action fails, rolling back to the snapshot returns the system to the same state when creating the snapshot.  If the upgrade was successful, delete the snapshot to free up space.  Without snapshots, a failed upgrade often requires restoring backups, which is tedious, time consuming, and may require downtime during which the system is unusable.  Rolling back to snapshots is fast, even while the system is running in normal operation, with little or no downtime.  The time savings are enormous with multi-terabyte storage systems considering the time required to copy the data from backup.  Snapshots are not a replacement for a complete backup of a pool, but offer a quick and easy way to store a dataset copy at a specific time.ÚPZFS ä¸­çš„å¿«ç…§æä¾›äº†è®¸å¤šå…¶ä»–å…·æœ‰å¿«ç…§åŠŸèƒ½çš„æ–‡ä»¶ç³»ç»Ÿæ‰€ç¼ºä¹çš„åŠŸèƒ½ã€‚å¿«ç…§çš„å…¸å‹ç”¨æ³•æ˜¯åœ¨æ‰§è¡Œé£é™©æ“ä½œï¼ˆå¦‚è½¯ä»¶å®‰è£…æˆ–ç³»ç»Ÿå‡çº§ï¼‰æ—¶ï¼Œå¿«é€Ÿå¤‡ä»½æ–‡ä»¶ç³»ç»Ÿçš„å½“å‰çŠ¶æ€ã€‚å¦‚æœæ“ä½œå¤±è´¥ï¼Œå›æ»šåˆ°å¿«ç…§å¯ä»¥å°†ç³»ç»Ÿæ¢å¤åˆ°åˆ›å»ºå¿«ç…§æ—¶çš„ç›¸åŒçŠ¶æ€ã€‚å¦‚æœå‡çº§æˆåŠŸï¼Œå¯ä»¥åˆ é™¤å¿«ç…§ä»¥é‡Šæ”¾ç©ºé—´ã€‚å¦‚æœæ²¡æœ‰å¿«ç…§ï¼Œå‡çº§å¤±è´¥é€šå¸¸éœ€è¦æ¢å¤å¤‡ä»½ï¼Œè¿™æ˜¯ç¹çã€è€—æ—¶çš„ï¼Œå¹¶ä¸”å¯èƒ½éœ€è¦åœæœºæ—¶é—´ï¼ŒæœŸé—´ç³»ç»Ÿæ— æ³•ä½¿ç”¨ã€‚å›æ»šåˆ°å¿«ç…§æ˜¯å¿«é€Ÿçš„ï¼Œå³ä½¿ç³»ç»Ÿåœ¨æ­£å¸¸è¿è¡Œä¸­ï¼Œå‡ ä¹æ²¡æœ‰åœæœºæ—¶é—´ã€‚è€ƒè™‘åˆ°ä»å¤‡ä»½ä¸­å¤åˆ¶æ•°æ®æ‰€éœ€çš„æ—¶é—´ï¼Œå¯¹äºå¤š TB å­˜å‚¨ç³»ç»Ÿæ¥è¯´ï¼ŒèŠ‚çœçš„æ—¶é—´æ˜¯å·¨å¤§çš„ã€‚å¿«ç…§ä¸èƒ½æ›¿ä»£å¯¹æ± çš„å®Œæ•´å¤‡ä»½ï¼Œä½†æä¾›äº†ä¸€ç§å¿«é€Ÿç®€ä¾¿çš„æ–¹å¼æ¥å­˜å‚¨ç‰¹å®šæ—¶é—´ç‚¹çš„æ•°æ®é›†å‰¯æœ¬ã€‚²Creating Snapshots¬åˆ›å»ºå¿«ç…§Ù˜To create snapshots, use `zfs snapshot _dataset_@_snapshotname_`.  Adding `-r` creates a snapshot recursively, with the same name on all child datasets.Ù°è¦åˆ›å»ºå¿«ç…§ï¼Œè¯·ä½¿ç”¨ `zfs snapshot _dataset_@_snapshotname_` å‘½ä»¤ã€‚æ·»åŠ  `-r` é€‰é¡¹å¯ä»¥é€’å½’åœ°åˆ›å»ºå¿«ç…§ï¼Œå¹¶åœ¨æ‰€æœ‰å­æ•°æ®é›†ä¸Šä½¿ç”¨ç›¸åŒçš„åç§°ã€‚Ù/Create a recursive snapshot of the entire pool:Ù!åˆ›å»ºæ•´ä¸ªæ± çš„é€’å½’å¿«ç…§ï¼šÙ¥Snapshots are not shown by a normal `zfs list` operation.  To list snapshots, append `-t snapshot` to `zfs list`.  `-t all` displays both file systems and snapshots.Ù¥æ™®é€šçš„ `zfs list` æ“ä½œä¸ä¼šæ˜¾ç¤ºå¿«ç…§ã€‚è¦åˆ—å‡ºå¿«ç…§ï¼Œè¯·åœ¨ `zfs list` åé¢æ·»åŠ  `-t snapshot`ã€‚ `-t all` å¯ä»¥åŒæ—¶æ˜¾ç¤ºæ–‡ä»¶ç³»ç»Ÿå’Œå¿«ç…§ã€‚ÙñSnapshots are not mounted directly, showing no path in the `MOUNTPOINT` column.  ZFS does not mention available disk space in the `AVAIL` column, as snapshots are read-only after their creation.  Compare the snapshot to the original dataset:ÙÏå¿«ç…§ä¸ä¼šç›´æ¥æŒ‚è½½ï¼Œå› æ­¤åœ¨ `MOUNTPOINT` åˆ—ä¸­ä¸æ˜¾ç¤ºè·¯å¾„ã€‚ZFS åœ¨ `AVAIL` åˆ—ä¸­ä¸æåŠå¯ç”¨ç£ç›˜ç©ºé—´ï¼Œå› ä¸ºå¿«ç…§åœ¨åˆ›å»ºåæ˜¯åªè¯»çš„ã€‚å°†å¿«ç…§ä¸åŸå§‹æ•°æ®é›†è¿›è¡Œæ¯”è¾ƒï¼šÚuDisplaying both the dataset and the snapshot together reveals how snapshots work in <<zfs-term-cow,COW>> fashion.  They save the changes (_delta_) made and not the complete file system contents all over again.  This means that snapshots take little space when making changes.  Observe space usage even more by copying a file to the dataset, then creating a second snapshot:ÚvåŒæ—¶æ˜¾ç¤ºæ•°æ®é›†å’Œå¿«ç…§å¯ä»¥å±•ç¤ºå¿«ç…§ä»¥ <<zfs-term-cow,å†™æ—¶å¤åˆ¶>> æ–¹å¼å·¥ä½œçš„åŸç†ã€‚å®ƒä»¬ä¿å­˜æ‰€åšçš„æ›´æ”¹ï¼ˆ_delta_ï¼‰ï¼Œè€Œä¸æ˜¯å†æ¬¡ä¿å­˜å®Œæ•´çš„æ–‡ä»¶ç³»ç»Ÿå†…å®¹ã€‚è¿™æ„å‘³ç€åœ¨è¿›è¡Œæ›´æ”¹æ—¶ï¼Œå¿«ç…§æ‰€å ç”¨çš„ç©ºé—´å¾ˆå°ã€‚é€šè¿‡å°†æ–‡ä»¶å¤åˆ¶åˆ°æ•°æ®é›†ä¸­ï¼Œç„¶ååˆ›å»ºç¬¬äºŒä¸ªå¿«ç…§ï¼Œå¯ä»¥æ›´åŠ è§‚å¯Ÿç©ºé—´ä½¿ç”¨æƒ…å†µï¼šÚ-The second snapshot contains the changes to the dataset after the copy operation.  This yields enormous space savings.  Notice that the size of the snapshot `_mypool/var/tmp@my_recursive_snapshot_` also changed in the `USED` column to show the changes between itself and the snapshot taken afterwards.Úç¬¬äºŒä¸ªå¿«ç…§åŒ…å«äº†å¤åˆ¶æ“ä½œåæ•°æ®é›†çš„å˜åŒ–ã€‚è¿™æ ·å¯ä»¥èŠ‚çœå¤§é‡çš„ç©ºé—´ã€‚è¯·æ³¨æ„ï¼Œå¿«ç…§ `_mypool/var/tmp@my_recursive_snapshot_` çš„å¤§å°åœ¨ `USED` åˆ—ä¸­ä¹Ÿå‘ç”Ÿäº†å˜åŒ–ï¼Œä»¥æ˜¾ç¤ºå®ƒä¸ä¹‹åæ‹æ‘„çš„å¿«ç…§ä¹‹é—´çš„å˜åŒ–ã€‚³Comparing Snapshots¬æ¯”è¾ƒå¿«ç…§ÚŸZFS provides a built-in command to compare the differences in content between two snapshots.  This is helpful with a lot of snapshots taken over time when the user wants to see how the file system has changed over time.  For example, `zfs diff` lets a user find the latest snapshot that still contains a file deleted by accident.  Doing this for the two snapshots created in the previous section yields this output:ÚZFS æä¾›äº†ä¸€ä¸ªå†…ç½®å‘½ä»¤ï¼Œç”¨äºæ¯”è¾ƒä¸¤ä¸ªå¿«ç…§ä¹‹é—´å†…å®¹çš„å·®å¼‚ã€‚å½“ç”¨æˆ·æƒ³è¦æŸ¥çœ‹æ–‡ä»¶ç³»ç»Ÿéšæ—¶é—´å˜åŒ–çš„æ–¹å¼æ—¶ï¼Œè¿™éå¸¸æœ‰å¸®åŠ©ï¼Œå°¤å…¶æ˜¯åœ¨æœ‰å¾ˆå¤šå¿«ç…§çš„æƒ…å†µä¸‹ã€‚ä¾‹å¦‚ï¼Œ `zfs diff` å‘½ä»¤å¯ä»¥å¸®åŠ©ç”¨æˆ·æ‰¾åˆ°æœ€æ–°çš„å¿«ç…§ï¼Œå…¶ä¸­ä»ç„¶åŒ…å«äº†æ„å¤–åˆ é™¤çš„æ–‡ä»¶ã€‚å¯¹äºå‰ä¸€èŠ‚åˆ›å»ºçš„ä¸¤ä¸ªå¿«ç…§ï¼Œæ‰§è¡Œæ­¤å‘½ä»¤å°†è¾“å‡ºå¦‚ä¸‹ç»“æœï¼šÙ·The command lists the changes between the specified snapshot (in this case `_mypool/var/tmp@my_recursive_snapshot_`) and the live file system.  The first column shows the change type:Ù¢è¯¥å‘½ä»¤åˆ—å‡ºäº†æŒ‡å®šå¿«ç…§ï¼ˆåœ¨æœ¬ä¾‹ä¸­ä¸º `_mypool/var/tmp@my_recursive_snapshot_` ï¼‰ä¸æ´»åŠ¨æ–‡ä»¶ç³»ç»Ÿä¹‹é—´çš„å˜åŒ–ã€‚ç¬¬ä¸€åˆ—æ˜¾ç¤ºå˜åŒ–ç±»å‹ï¼š¸Adding the path or file.¸æ·»åŠ è·¯å¾„æˆ–æ–‡ä»¶ã€‚ºDeleting the path or file.¸åˆ é™¤è·¯å¾„æˆ–æ–‡ä»¶ã€‚»Modifying the path or file.¸ä¿®æ”¹è·¯å¾„æˆ–æ–‡ä»¶ã€‚ºRenaming the path or file.»é‡å‘½åè·¯å¾„æˆ–æ–‡ä»¶ã€‚ÙõComparing the output with the table, it becomes clear that ZFS added [.filename]#passwd# after creating the snapshot `_mypool/var/tmp@my_recursive_snapshot_`.  This also resulted in a modification to the parent directory mounted at `_/var/tmp_`.ÙÜå°†è¾“å‡ºä¸è¡¨æ ¼è¿›è¡Œæ¯”è¾ƒï¼Œå¯ä»¥æ¸…æ¥šåœ°çœ‹åˆ° ZFS åœ¨åˆ›å»ºå¿«ç…§ `_mypool/var/tmp@my_recursive_snapshot_` ä¹‹åæ·»åŠ äº† [.filename]#passwd# ã€‚è¿™ä¹Ÿå¯¼è‡´äº†æŒ‚è½½åœ¨ `_/var/tmp_` ä¸Šçš„çˆ¶ç›®å½•çš„ä¿®æ”¹ã€‚ÙˆComparing two snapshots is helpful when using the ZFS replication feature to transfer a dataset to a different host for backup purposes.Ùzå½“ä½¿ç”¨ ZFS å¤åˆ¶åŠŸèƒ½å°†æ•°æ®é›†ä¼ è¾“åˆ°ä¸åŒçš„ä¸»æœºè¿›è¡Œå¤‡ä»½æ—¶ï¼Œæ¯”è¾ƒä¸¤ä¸ªå¿«ç…§æ˜¯éå¸¸æœ‰å¸®åŠ©çš„ã€‚Ù\Compare two snapshots by providing the full dataset name and snapshot name of both datasets:ÙZé€šè¿‡æä¾›ä¸¤ä¸ªæ•°æ®é›†çš„å®Œæ•´æ•°æ®é›†åç§°å’Œå¿«ç…§åç§°æ¥æ¯”è¾ƒä¸¤ä¸ªå¿«ç…§ï¼šÙÄA backup administrator can compare two snapshots received from the sending host and determine the actual changes in the dataset.  See the <<zfs-zfs-send,Replication>> section for more information.Ù¬å¤‡ä»½ç®¡ç†å‘˜å¯ä»¥æ¯”è¾ƒä»å‘é€ä¸»æœºæ¥æ”¶åˆ°çš„ä¸¤ä¸ªå¿«ç…§ï¼Œå¹¶ç¡®å®šæ•°æ®é›†ä¸­çš„å®é™…æ›´æ”¹ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜… <<zfs-zfs-send,å¤åˆ¶>> éƒ¨åˆ†ã€‚±Snapshot Rollback¬å¿«ç…§å›æ»šÚ·When at least one snapshot is available, roll back to it at any time.  Most often this is the case when the current state of the dataset is no longer and if preferring an older version.  Scenarios such as local development tests gone wrong, botched system updates hampering the system functionality, or the need to restore deleted files or directories are all too common occurrences.  To roll back a snapshot, use `zfs rollback _snapshotname_`.  If a lot of changes are present, the operation will take a long time.  During that time, the dataset always remains in a consistent state, much like a database that conforms to ACID principles is performing a rollback.  This is happening while the dataset is live and accessible without requiring a downtime.  Once the snapshot rolled back, the dataset has the same state as it had when the snapshot was originally taken.  Rolling back to a snapshot discards all other data in that dataset not part of the snapshot.  Taking a snapshot of the current state of the dataset before rolling back to a previous one is a good idea when requiring some data later.  This way, the user can roll back and forth between snapshots without losing data that is still valuable.Úå½“è‡³å°‘æœ‰ä¸€ä¸ªå¿«ç…§å¯ç”¨æ—¶ï¼Œéšæ—¶å¯ä»¥å›æ»šåˆ°è¯¥å¿«ç…§ã€‚å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå½“æ•°æ®é›†çš„å½“å‰çŠ¶æ€ä¸å†å­˜åœ¨æˆ–è€…æ›´å–œæ¬¢æ—§ç‰ˆæœ¬æ—¶ï¼Œä¼šå‡ºç°è¿™ç§æƒ…å†µã€‚è¯¸å¦‚æœ¬åœ°å¼€å‘æµ‹è¯•å¤±è´¥ã€ç³»ç»Ÿæ›´æ–°å¤±è´¥å¯¼è‡´ç³»ç»ŸåŠŸèƒ½å—é˜»ï¼Œæˆ–è€…éœ€è¦æ¢å¤å·²åˆ é™¤çš„æ–‡ä»¶æˆ–ç›®å½•ç­‰æƒ…å†µéƒ½å¾ˆå¸¸è§ã€‚è¦å›æ»šå¿«ç…§ï¼Œè¯·ä½¿ç”¨ `zfs rollback _snapshotname_` å‘½ä»¤ã€‚å¦‚æœå­˜åœ¨å¤§é‡æ›´æ”¹ï¼Œæ“ä½œå°†éœ€è¦å¾ˆé•¿æ—¶é—´ã€‚åœ¨æ­¤æœŸé—´ï¼Œæ•°æ®é›†å§‹ç»ˆä¿æŒä¸€è‡´çš„çŠ¶æ€ï¼Œå°±åƒç¬¦åˆ ACID åŸåˆ™çš„æ•°æ®åº“æ‰§è¡Œå›æ»šæ“ä½œä¸€æ ·ã€‚è¿™ä¸€åˆ‡éƒ½å‘ç”Ÿåœ¨æ•°æ®é›†å¤„äºæ´»åŠ¨çŠ¶æ€ä¸”å¯è®¿é—®çš„æƒ…å†µä¸‹ï¼Œæ— éœ€åœæœºã€‚ä¸€æ—¦å¿«ç…§å›æ»šå®Œæˆï¼Œæ•°æ®é›†çš„çŠ¶æ€ä¸å¿«ç…§åˆ›å»ºæ—¶çš„çŠ¶æ€ç›¸åŒã€‚å›æ»šåˆ°å¿«ç…§ä¼šä¸¢å¼ƒæ•°æ®é›†ä¸­ä¸å±äºè¯¥å¿«ç…§çš„æ‰€æœ‰å…¶ä»–æ•°æ®ã€‚åœ¨å›æ»šåˆ°ä»¥å‰çš„å¿«ç…§ä¹‹å‰ï¼Œå°†å½“å‰æ•°æ®é›†çš„çŠ¶æ€è¿›è¡Œå¿«ç…§æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ï¼Œä»¥ä¾¿ç¨åéœ€è¦æŸäº›æ•°æ®ã€‚è¿™æ ·ï¼Œç”¨æˆ·å¯ä»¥åœ¨å¿«ç…§ä¹‹é—´æ¥å›åˆ‡æ¢ï¼Œè€Œä¸ä¼šä¸¢å¤±ä»ç„¶æœ‰ä»·å€¼çš„æ•°æ®ã€‚ÙyIn the first example, roll back a snapshot because of a careless `rm` operation that removes too much data than intended.Ù~åœ¨ç¬¬ä¸€ä¸ªç¤ºä¾‹ä¸­ï¼Œç”±äºä¸€ä¸ªç²—å¿ƒçš„ `rm` æ“ä½œåˆ é™¤äº†æ¯”é¢„æœŸæ›´å¤šçš„æ•°æ®ï¼Œå› æ­¤éœ€è¦å›æ»šä¸€ä¸ªå¿«ç…§ã€‚ÚAt this point, the user notices the removal of extra files and wants them back.  ZFS provides an easy way to get them back using rollbacks, when performing snapshots of important data on a regular basis.  To get the files back and start over from the last snapshot, issue the command:Úåœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œç”¨æˆ·æ³¨æ„åˆ°é¢å¤–æ–‡ä»¶è¢«åˆ é™¤äº†ï¼Œå¹¶å¸Œæœ›å°†å®ƒä»¬æ¢å¤ã€‚ ZFS æä¾›äº†ä¸€ç§ç®€å•çš„æ–¹æ³•æ¥ä½¿ç”¨å›æ»šå°†å®ƒä»¬æ¢å¤ï¼Œå½“å®šæœŸå¯¹é‡è¦æ•°æ®è¿›è¡Œå¿«ç…§æ—¶ã€‚è¦å°†æ–‡ä»¶æ¢å¤å¹¶ä»æœ€åä¸€ä¸ªå¿«ç…§é‡æ–°å¼€å§‹ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼šÙëThe rollback operation restored the dataset to the state of the last snapshot.  Rolling back to a snapshot taken much earlier with other snapshots taken afterwards is also possible.  When trying to do this, ZFS will issue this warning:ÙÁå›æ»šæ“ä½œå°†æ•°æ®é›†æ¢å¤åˆ°æœ€åä¸€ä¸ªå¿«ç…§çš„çŠ¶æ€ã€‚ä¹Ÿå¯ä»¥å›æ»šåˆ°ä¹‹å‰æ‹æ‘„çš„å¿«ç…§ä¹‹åæ‹æ‘„çš„å…¶ä»–å¿«ç…§çš„çŠ¶æ€ã€‚åœ¨å°è¯•è¿™æ ·åšæ—¶ï¼ŒZFS ä¼šå‘å‡ºä»¥ä¸‹è­¦å‘Šï¼šÚThis warning means that snapshots exist between the current state of the dataset and the snapshot to which the user wants to roll back.  To complete the rollback delete these snapshots.  ZFS cannot track all the changes between different states of the dataset, because snapshots are read-only.  ZFS will not delete the affected snapshots unless the user specifies `-r` to confirm that this is the desired action.  If that is the intention, and understanding the consequences of losing all intermediate snapshots, issue the command:Ú¶è¿™ä¸ªè­¦å‘Šæ„å‘³ç€åœ¨å½“å‰æ•°æ®é›†çŠ¶æ€å’Œç”¨æˆ·æƒ³è¦å›æ»šçš„å¿«ç…§ä¹‹é—´å­˜åœ¨å¿«ç…§ã€‚è¦å®Œæˆå›æ»šæ“ä½œï¼Œè¯·åˆ é™¤è¿™äº›å¿«ç…§ã€‚ç”±äºå¿«ç…§æ˜¯åªè¯»çš„ï¼ŒZFS æ— æ³•è·Ÿè¸ªæ•°æ®é›†ä¸åŒçŠ¶æ€ä¹‹é—´çš„æ‰€æœ‰æ›´æ”¹ã€‚é™¤éç”¨æˆ·ä½¿ç”¨ `-r` å‚æ•°ç¡®è®¤è¿™æ˜¯æ‰€éœ€çš„æ“ä½œï¼Œå¦åˆ™ ZFS ä¸ä¼šåˆ é™¤å—å½±å“çš„å¿«ç…§ã€‚å¦‚æœè¿™æ˜¯ç”¨æˆ·çš„æ„å›¾ï¼Œå¹¶ä¸”ç†è§£ä¸¢å¤±æ‰€æœ‰ä¸­é—´å¿«ç…§çš„åæœï¼Œè¯·æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼šÙ{The output from `zfs list -t snapshot` confirms the removal of the intermediate snapshots as a result of `zfs rollback -r`.Ùi`zfs list -t snapshot` çš„è¾“å‡ºç¡®è®¤äº†ç”±äº `zfs rollback -r` çš„ç»“æœï¼Œä¸­é—´å¿«ç…§å·²è¢«åˆ é™¤ã€‚Ù)Restoring Individual Files from Snapshots¾ä»å¿«ç…§ä¸­æ¢å¤å•ä¸ªæ–‡ä»¶ÚöSnapshots live in a hidden directory under the parent dataset: [.filename]#.zfs/snapshots/snapshotname#.  By default, these directories will not show even when executing a standard `ls -a` .  Although the directory doesn't show, access it like any normal directory.  The property named `snapdir` controls whether these hidden directories show up in a directory listing.  Setting the property to `visible` allows them to appear in the output of `ls` and other commands that deal with directory contents.ÚÆå¿«ç…§å­˜å‚¨åœ¨çˆ¶æ•°æ®é›†çš„éšè—ç›®å½•ä¸‹ï¼š [.filename]#.zfs/snapshots/snapshotname# ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå³ä½¿æ‰§è¡Œæ ‡å‡†çš„ `ls -a` å‘½ä»¤ï¼Œè¿™äº›ç›®å½•ä¹Ÿä¸ä¼šæ˜¾ç¤ºå‡ºæ¥ã€‚å°½ç®¡ç›®å½•ä¸å¯è§ï¼Œä½†å¯ä»¥åƒè®¿é—®æ™®é€šç›®å½•ä¸€æ ·è®¿é—®å®ƒã€‚åä¸º `snapdir` çš„å±æ€§æ§åˆ¶è¿™äº›éšè—ç›®å½•æ˜¯å¦åœ¨ç›®å½•åˆ—è¡¨ä¸­æ˜¾ç¤ºã€‚å°†è¯¥å±æ€§è®¾ç½®ä¸º `visible` å¯ä»¥ä½¿å®ƒä»¬å‡ºç°åœ¨ `ls` å’Œå…¶ä»–å¤„ç†ç›®å½•å†…å®¹çš„å‘½ä»¤çš„è¾“å‡ºä¸­ã€‚Ú¤Restore individual files to a previous state by copying them from the snapshot back to the parent dataset.  The directory structure below [.filename]#.zfs/snapshot# has a directory named like the snapshots taken earlier to make it easier to identify them.  The next example shows how to restore a file from the hidden [.filename]#.zfs# directory by copying it from the snapshot containing the latest version of the file:Ú^é€šè¿‡å°†æ–‡ä»¶ä»å¿«ç…§å¤åˆ¶å›çˆ¶æ•°æ®é›†ï¼Œå°†å…¶æ¢å¤åˆ°å…ˆå‰çš„çŠ¶æ€ã€‚ [.filename]#.zfs/snapshot# ä¸‹çš„ç›®å½•ç»“æ„ä¸­æœ‰ä¸€ä¸ªç±»ä¼¼äºå…ˆå‰æ‹æ‘„çš„å¿«ç…§çš„ç›®å½•ï¼Œä»¥ä¾¿æ›´å®¹æ˜“è¯†åˆ«å®ƒä»¬ã€‚ä¸‹ä¸€ä¸ªç¤ºä¾‹æ˜¾ç¤ºäº†å¦‚ä½•ä»éšè—çš„ [.filename]#.zfs# ç›®å½•ä¸­å¤åˆ¶æ–‡ä»¶ï¼Œä»åŒ…å«æ–‡ä»¶æœ€æ–°ç‰ˆæœ¬çš„å¿«ç…§ä¸­æ¢å¤æ–‡ä»¶ï¼šÚoEven if the `snapdir` property is set to hidden, running `ls .zfs/snapshot` will still list the contents of that directory.  The administrator decides whether to display these directories.  This is a per-dataset setting.  Copying files or directories from this hidden [.filename]#.zfs/snapshot# is simple enough.  Trying it the other way around results in this error:Ú4å³ä½¿å°† `snapdir` å±æ€§è®¾ç½®ä¸ºéšè—ï¼Œè¿è¡Œ `ls .zfs/snapshot` ä»ç„¶ä¼šåˆ—å‡ºè¯¥ç›®å½•çš„å†…å®¹ã€‚ç®¡ç†å‘˜å†³å®šæ˜¯å¦æ˜¾ç¤ºè¿™äº›ç›®å½•ã€‚è¿™æ˜¯æ¯ä¸ªæ•°æ®é›†çš„è®¾ç½®ã€‚ä»è¿™ä¸ªéšè—çš„ [.filename]#.zfs/snapshot# å¤åˆ¶æ–‡ä»¶æˆ–ç›®å½•éå¸¸ç®€å•ã€‚å°è¯•åè¿‡æ¥æ“ä½œä¼šå¯¼è‡´ä»¥ä¸‹é”™è¯¯ï¼šÙğThe error reminds the user that snapshots are read-only and cannot change after creation.  Copying files into and removing them from snapshot directories are both disallowed because that would change the state of the dataset they represent.Ùºè¯¥é”™è¯¯æé†’ç”¨æˆ·å¿«ç…§æ˜¯åªè¯»çš„ï¼Œåˆ›å»ºåä¸èƒ½æ›´æ”¹ã€‚å°†æ–‡ä»¶å¤åˆ¶åˆ°å¿«ç…§ç›®å½•æˆ–ä»ä¸­åˆ é™¤æ–‡ä»¶éƒ½æ˜¯ä¸å…è®¸çš„ï¼Œå› ä¸ºè¿™ä¼šæ”¹å˜æ‰€è¡¨ç¤ºæ•°æ®é›†çš„çŠ¶æ€ã€‚Ù¶Snapshots consume space based on how much the parent file system has changed since the time of the snapshot.  The `written` property of a snapshot tracks the space the snapshot uses.Ùƒå¿«ç…§å ç”¨çš„ç©ºé—´å–å†³äºçˆ¶æ–‡ä»¶ç³»ç»Ÿè‡ªå¿«ç…§ä»¥æ¥çš„æ›´æ”¹é‡ã€‚å¿«ç…§çš„ `written` å±æ€§è·Ÿè¸ªå¿«ç…§ä½¿ç”¨çš„ç©ºé—´ã€‚Ú\To destroy snapshots and reclaim the space, use `zfs destroy _dataset_@_snapshot_`.  Adding `-r` recursively removes all snapshots with the same name under the parent dataset.  Adding `-n -v` to the command displays a list of the snapshots to be deleted and an estimate of the space it would reclaim without performing the actual destroy operation.Ú5è¦é”€æ¯å¿«ç…§å¹¶å›æ”¶ç©ºé—´ï¼Œè¯·ä½¿ç”¨ `zfs destroy _dataset_@_snapshot_` å‘½ä»¤ã€‚æ·»åŠ  `-r` é€‰é¡¹å¯ä»¥é€’å½’åˆ é™¤çˆ¶æ•°æ®é›†ä¸‹å…·æœ‰ç›¸åŒåç§°çš„æ‰€æœ‰å¿«ç…§ã€‚åœ¨å‘½ä»¤ä¸­æ·»åŠ  `-n -v` é€‰é¡¹å¯ä»¥æ˜¾ç¤ºè¦åˆ é™¤çš„å¿«ç…§åˆ—è¡¨ä»¥åŠæ‰§è¡Œå®é™…é”€æ¯æ“ä½œå‰å°†å›æ”¶çš„ç©ºé—´çš„ä¼°è®¡å€¼ã€‚¯Managing Clones²ç®¡ç†å…‹éš†å®ä¾‹Ú²A clone is a copy of a snapshot treated more like a regular dataset.  Unlike a snapshot, a clone is writeable and mountable, and has its own properties.  After creating a clone using `zfs clone`, destroying the originating snapshot is impossible.  To reverse the child/parent relationship between the clone and the snapshot use `zfs promote`.  Promoting a clone makes the snapshot become a child of the clone, rather than of the original parent dataset.  This will change how ZFS accounts for the space, but not actually change the amount of space consumed.  Mounting the clone anywhere within the ZFS file system hierarchy is possible, not only below the original location of the snapshot.Ú=å…‹éš†æ˜¯å¿«ç…§çš„å‰¯æœ¬ï¼Œæ›´åƒä¸€ä¸ªå¸¸è§„æ•°æ®é›†ã€‚ä¸å¿«ç…§ä¸åŒï¼Œå…‹éš†æ˜¯å¯å†™çš„å’Œå¯æŒ‚è½½çš„ï¼Œå¹¶ä¸”å…·æœ‰è‡ªå·±çš„å±æ€§ã€‚ä½¿ç”¨ `zfs clone` åˆ›å»ºå…‹éš†åï¼Œæ— æ³•é”€æ¯åŸå§‹å¿«ç…§ã€‚è¦åè½¬å…‹éš†å’Œå¿«ç…§ä¹‹é—´çš„å­/çˆ¶å…³ç³»ï¼Œè¯·ä½¿ç”¨ `zfs promote` ã€‚å°†å…‹éš†æå‡ä¸ºå¿«ç…§æˆä¸ºå…‹éš†çš„å­é¡¹ï¼Œè€Œä¸æ˜¯åŸå§‹çˆ¶æ•°æ®é›†çš„å­é¡¹ã€‚è¿™å°†æ”¹å˜ ZFS å¯¹ç©ºé—´çš„è®¡ç®—æ–¹å¼ï¼Œä½†å®é™…ä¸Šä¸ä¼šæ”¹å˜æ‰€æ¶ˆè€—çš„ç©ºé—´é‡ã€‚å¯ä»¥åœ¨ ZFS æ–‡ä»¶ç³»ç»Ÿå±‚æ¬¡ç»“æ„ä¸­çš„ä»»ä½•ä½ç½®æŒ‚è½½å…‹éš†ï¼Œä¸ä»…é™äºå¿«ç…§çš„åŸå§‹ä½ç½®ä¸‹æ–¹ã€‚Ù3To show the clone feature use this example dataset:Ù9è¦å±•ç¤ºå…‹éš†åŠŸèƒ½ï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹ç¤ºä¾‹æ•°æ®é›†ï¼šÚºA typical use for clones is to experiment with a specific dataset while keeping the snapshot around to fall back to in case something goes wrong.  Since snapshots cannot change, create a read/write clone of a snapshot.  After achieving the desired result in the clone, promote the clone to a dataset and remove the old file system.  Removing the parent dataset is not strictly necessary, as the clone and dataset can coexist without problems.Úå…‹éš†çš„å…¸å‹ç”¨é€”æ˜¯åœ¨è¿›è¡Œç‰¹å®šæ•°æ®é›†çš„å®éªŒæ—¶ï¼Œä¿ç•™å¿«ç…§ä»¥å¤‡ä¸æ—¶ä¹‹éœ€ã€‚ç”±äºå¿«ç…§æ˜¯ä¸å¯æ›´æ”¹çš„ï¼Œå› æ­¤éœ€è¦åˆ›å»ºä¸€ä¸ªå¯è¯»/å†™çš„å¿«ç…§å…‹éš†ã€‚åœ¨å…‹éš†ä¸­è·å¾—æ‰€éœ€çš„ç»“æœåï¼Œå°†å…‹éš†æå‡ä¸ºæ•°æ®é›†å¹¶åˆ é™¤æ—§çš„æ–‡ä»¶ç³»ç»Ÿã€‚ä¸¥æ ¼æ¥è¯´ï¼Œåˆ é™¤çˆ¶æ•°æ®é›†å¹¶éå¿…éœ€ï¼Œå› ä¸ºå…‹éš†å’Œæ•°æ®é›†å¯ä»¥å…±å­˜è€Œä¸ä¼šå‡ºç°é—®é¢˜ã€‚ÚóCreating a clone makes it an exact copy of the state the dataset was in when taking the snapshot.  Changing the clone independently from its originating dataset is possible now.  The connection between the two is the snapshot.  ZFS records this connection in the property `origin`.  Promoting the clone with `zfs promote` makes the clone an independent dataset.  This removes the value of the `origin` property and disconnects the newly independent dataset from the snapshot.  This example shows it:ÚŸåˆ›å»ºå…‹éš†ä¼šä½¿å…¶æˆä¸ºæ•°æ®é›†åœ¨æ‹æ‘„å¿«ç…§æ—¶çš„ç²¾ç¡®å‰¯æœ¬ã€‚ç°åœ¨å¯ä»¥ç‹¬ç«‹åœ°æ›´æ”¹å…‹éš†ä¸å…¶æºæ•°æ®é›†ä¹‹é—´çš„è¿æ¥ã€‚ä¸¤è€…ä¹‹é—´çš„è¿æ¥æ˜¯å¿«ç…§ã€‚ ZFS å°†æ­¤è¿æ¥è®°å½•åœ¨å±æ€§ `origin` ä¸­ã€‚ä½¿ç”¨ `zfs promote` æå‡å…‹éš†å°†ä½¿å…¶æˆä¸ºç‹¬ç«‹çš„æ•°æ®é›†ã€‚è¿™å°†åˆ é™¤ `origin` å±æ€§çš„å€¼ï¼Œå¹¶æ–­å¼€æ–°ç‹¬ç«‹æ•°æ®é›†ä¸å¿«ç…§ä¹‹é—´çš„è¿æ¥ã€‚ä»¥ä¸‹ç¤ºä¾‹è¯´æ˜äº†è¿™ä¸€ç‚¹ï¼šÚNAfter making some changes like copying [.filename]#loader.conf# to the promoted clone, for example, the old directory becomes obsolete in this case.  Instead, the promoted clone can replace it.  To do this, `zfs destroy` the old dataset first and then `zfs rename` the clone to the old dataset name (or to an entirely different name).Úiåœ¨è¿›è¡Œä¸€äº›æ›´æ”¹åï¼Œä¾‹å¦‚å°† [.filename]#loader.conf# å¤åˆ¶åˆ°æ¨å¹¿çš„å…‹éš†ä¸­ï¼Œæ—§ç›®å½•åœ¨è¿™ç§æƒ…å†µä¸‹å˜å¾—è¿‡æ—¶ã€‚ç›¸åï¼Œæ¨å¹¿çš„å…‹éš†å¯ä»¥æ›¿ä»£å®ƒã€‚ä¸ºäº†åšåˆ°è¿™ä¸€ç‚¹ï¼Œé¦–å…ˆä½¿ç”¨ `zfs destroy` å‘½ä»¤é”€æ¯æ—§æ•°æ®é›†ï¼Œç„¶åä½¿ç”¨ `zfs rename` å‘½ä»¤å°†å…‹éš†é‡å‘½åä¸ºæ—§æ•°æ®é›†çš„åç§°ï¼ˆæˆ–å®Œå…¨ä¸åŒçš„åç§°ï¼‰ã€‚ÚqThe cloned snapshot is now an ordinary dataset.  It contains all the data from the original snapshot plus the files added to it like [.filename]#loader.conf#.  Clones provide useful features to ZFS users in different scenarios.  For example, provide jails as snapshots containing different sets of installed applications.  Users can clone these snapshots and add their own applications as they see fit.  Once satisfied with the changes, promote the clones to full datasets and provide them to end users to work with like they would with a real dataset.  This saves time and administrative overhead when providing these jails.ÚQå…‹éš†çš„å¿«ç…§ç°åœ¨æ˜¯ä¸€ä¸ªæ™®é€šçš„æ•°æ®é›†ã€‚å®ƒåŒ…å«äº†åŸå§‹å¿«ç…§ä¸­çš„æ‰€æœ‰æ•°æ®ï¼Œä»¥åŠåƒ [.filename]#loader.conf# è¿™æ ·æ·»åŠ åˆ°å…¶ä¸­çš„æ–‡ä»¶ã€‚åœ¨ä¸åŒçš„åœºæ™¯ä¸­ï¼Œå…‹éš†ä¸º ZFS ç”¨æˆ·æä¾›äº†æœ‰ç”¨çš„åŠŸèƒ½ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥å°† jails ä½œä¸ºåŒ…å«ä¸åŒå®‰è£…åº”ç”¨ç¨‹åºé›†çš„å¿«ç…§ã€‚ç”¨æˆ·å¯ä»¥å…‹éš†è¿™äº›å¿«ç…§ï¼Œå¹¶æ ¹æ®éœ€è¦æ·»åŠ è‡ªå·±çš„åº”ç”¨ç¨‹åºã€‚ä¸€æ—¦å¯¹æ›´æ”¹æ»¡æ„ï¼Œå¯ä»¥å°†å…‹éš†æå‡ä¸ºå®Œæ•´çš„æ•°æ®é›†ï¼Œå¹¶å°†å…¶æä¾›ç»™æœ€ç»ˆç”¨æˆ·ï¼Œå°±åƒä½¿ç”¨çœŸå®æ•°æ®é›†ä¸€æ ·ã€‚è¿™æ ·å¯ä»¥èŠ‚çœæä¾›è¿™äº›ç›‘ç‹±æ—¶çš„æ—¶é—´å’Œç®¡ç†å¼€é”€ã€‚«Replication¦å¤åˆ¶Ú\Keeping data on a single pool in one location exposes it to risks like theft and natural or human disasters.  Making regular backups of the entire pool is vital.  ZFS provides a built-in serialization feature that can send a stream representation of the data to standard output.  Using this feature, storing this data on another pool connected to the local system is possible, as is sending it over a network to another system.  Snapshots are the basis for this replication (see the section on <<zfs-zfs-snapshot,ZFS snapshots>>).  The commands used for replicating data are `zfs send` and `zfs receive`.Úå°†æ•°æ®å­˜å‚¨åœ¨ä¸€ä¸ªä½ç½®çš„å•ä¸ªæ± ä¸­ä¼šä½¿å…¶æš´éœ²äºç›—çªƒã€è‡ªç„¶ç¾å®³æˆ–äººä¸ºç¾å®³ç­‰é£é™©ã€‚å®šæœŸå¤‡ä»½æ•´ä¸ªæ± æ˜¯è‡³å…³é‡è¦çš„ã€‚ ZFS æä¾›äº†ä¸€ä¸ªå†…ç½®çš„åºåˆ—åŒ–åŠŸèƒ½ï¼Œå¯ä»¥å°†æ•°æ®çš„æµè¡¨ç¤ºå‘é€åˆ°æ ‡å‡†è¾“å‡ºã€‚ä½¿ç”¨æ­¤åŠŸèƒ½ï¼Œå¯ä»¥å°†è¿™äº›æ•°æ®å­˜å‚¨åœ¨è¿æ¥åˆ°æœ¬åœ°ç³»ç»Ÿçš„å¦ä¸€ä¸ªæ± ä¸­ï¼Œä¹Ÿå¯ä»¥å°†å…¶å‘é€åˆ°å¦ä¸€ä¸ªç³»ç»Ÿä¸Šçš„ç½‘ç»œä¸Šã€‚å¿«ç…§æ˜¯å¤åˆ¶çš„åŸºç¡€ï¼ˆå‚è§ <<zfs-zfs-snapshot,ZFS å¿«ç…§>> éƒ¨åˆ†ï¼‰ã€‚ç”¨äºå¤åˆ¶æ•°æ®çš„å‘½ä»¤æ˜¯ `zfs send` å’Œ `zfs receive`ã€‚Ù9These examples show ZFS replication with these two pools:ÙJè¿™äº›ç¤ºä¾‹å±•ç¤ºäº†ä½¿ç”¨è¿™ä¸¤ä¸ªå­˜å‚¨æ± è¿›è¡Œ ZFS å¤åˆ¶çš„æƒ…å†µï¼šÚ$The pool named _mypool_ is the primary pool where writing and reading data happens on a regular basis.  Using a second standby pool _backup_ in case the primary pool becomes unavailable.  Note that this fail-over is not done automatically by ZFS, but must be manually done by a system administrator when needed.  Use a snapshot to provide a consistent file system version to replicate.  After creating a snapshot of _mypool_, copy it to the _backup_ pool by replicating snapshots.  This does not include changes made since the most recent snapshot.ÚÉåä¸º _mypool_ çš„æ± æ˜¯ä¸»è¦çš„æ± ï¼Œæ•°æ®çš„å†™å…¥å’Œè¯»å–åœ¨æ­¤æ± ä¸­å®šæœŸè¿›è¡Œã€‚åœ¨ä¸»è¦æ± ä¸å¯ç”¨æ—¶ï¼Œä½¿ç”¨ç¬¬äºŒä¸ªå¤‡ç”¨æ±  _backup_ã€‚è¯·æ³¨æ„ï¼ŒZFS ä¸ä¼šè‡ªåŠ¨æ‰§è¡Œæ­¤æ•…éšœè½¬ç§»ï¼Œè€Œæ˜¯éœ€è¦ç³»ç»Ÿç®¡ç†å‘˜åœ¨éœ€è¦æ—¶æ‰‹åŠ¨æ‰§è¡Œã€‚ä½¿ç”¨å¿«ç…§æä¾›ä¸€è‡´çš„æ–‡ä»¶ç³»ç»Ÿç‰ˆæœ¬è¿›è¡Œå¤åˆ¶ã€‚åœ¨åˆ›å»º _mypool_ çš„å¿«ç…§åï¼Œé€šè¿‡å¤åˆ¶å¿«ç…§å°†å…¶å¤åˆ¶åˆ° _backup_ æ± ä¸­ã€‚è¿™ä¸åŒ…æ‹¬è‡ªæœ€è¿‘å¿«ç…§ä»¥æ¥æ‰€åšçš„æ›´æ”¹ã€‚ÙşNow that a snapshot exists, use `zfs send` to create a stream representing the contents of the snapshot.  Store this stream as a file or receive it on another pool.  Write the stream to standard output, but redirect to a file or pipe or an error appears:Ùÿç°åœ¨æœ‰äº†ä¸€ä¸ªå¿«ç…§ï¼Œä½¿ç”¨ `zfs send` å‘½ä»¤åˆ›å»ºä¸€ä¸ªè¡¨ç¤ºå¿«ç…§å†…å®¹çš„æµã€‚å°†è¿™ä¸ªæµå­˜å‚¨ä¸ºæ–‡ä»¶ï¼Œæˆ–è€…åœ¨å¦ä¸€ä¸ªå­˜å‚¨æ± ä¸­æ¥æ”¶å®ƒã€‚å°†æµå†™å…¥æ ‡å‡†è¾“å‡ºï¼Œä½†è¦å°†å…¶é‡å®šå‘åˆ°æ–‡ä»¶æˆ–ç®¡é“ï¼Œå¦åˆ™ä¼šå‡ºç°é”™è¯¯ã€‚ÚTo back up a dataset with `zfs send`, redirect to a file located on the mounted backup pool.  Ensure that the pool has enough free space to accommodate the size of the sent snapshot, which means the data contained in the snapshot, not the changes from the previous snapshot.Ùüä½¿ç”¨ `zfs send` å‘½ä»¤å¤‡ä»½æ•°æ®é›†æ—¶ï¼Œå°†å…¶é‡å®šå‘åˆ°ä½äºå·²æŒ‚è½½çš„å¤‡ä»½æ± ä¸Šçš„æ–‡ä»¶ã€‚ç¡®ä¿å¤‡ä»½æ± æœ‰è¶³å¤Ÿçš„ç©ºé—´æ¥å®¹çº³å‘é€çš„å¿«ç…§çš„å¤§å°ï¼Œè¿™æŒ‡çš„æ˜¯å¿«ç…§ä¸­åŒ…å«çš„æ•°æ®ï¼Œè€Œä¸æ˜¯ä¸ä¸Šä¸€ä¸ªå¿«ç…§çš„æ›´æ”¹ã€‚Ù®The `zfs send` transferred all the data in the snapshot called _backup1_ to the pool named _backup_.  To create and send these snapshots automatically, use a man:cron[8] job.Ù±`zfs send` å‘½ä»¤å°†åä¸º _backup1_ çš„å¿«ç…§ä¸­çš„æ‰€æœ‰æ•°æ®ä¼ è¾“åˆ°åä¸º _backup_ çš„å­˜å‚¨æ± ä¸­ã€‚è¦è‡ªåŠ¨åˆ›å»ºå’Œå‘é€è¿™äº›å¿«ç…§ï¼Œè¯·ä½¿ç”¨ man:cron[8] ä»»åŠ¡ã€‚ÚInstead of storing the backups as archive files, ZFS can receive them as a live file system, allowing direct access to the backed up data.  To get to the actual data contained in those streams, use `zfs receive` to transform the streams back into files and directories.  The example below combines `zfs send` and `zfs receive` using a pipe to copy the data from one pool to another.  Use the data directly on the receiving pool after the transfer is complete.  It is only possible to replicate a dataset to an empty dataset.ÚÏZFS å¯ä»¥å°†å¤‡ä»½å­˜å‚¨ä¸ºå®æ—¶æ–‡ä»¶ç³»ç»Ÿï¼Œè€Œä¸æ˜¯å­˜å‚¨ä¸ºå½’æ¡£æ–‡ä»¶ï¼Œä»è€Œå¯ä»¥ç›´æ¥è®¿é—®å¤‡ä»½æ•°æ®ã€‚è¦è®¿é—®è¿™äº›æµä¸­åŒ…å«çš„å®é™…æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨ `zfs receive` å°†æµè½¬æ¢å›æ–‡ä»¶å’Œç›®å½•ã€‚ä¸‹é¢çš„ç¤ºä¾‹ç»“åˆäº† `zfs send` å’Œ `zfs receive` ï¼Œä½¿ç”¨ç®¡é“å°†æ•°æ®ä»ä¸€ä¸ªå­˜å‚¨æ± å¤åˆ¶åˆ°å¦ä¸€ä¸ªå­˜å‚¨æ± ã€‚åœ¨ä¼ è¾“å®Œæˆåï¼Œå¯ä»¥ç›´æ¥åœ¨æ¥æ”¶å­˜å‚¨æ± ä¸Šä½¿ç”¨æ•°æ®ã€‚åªèƒ½å°†æ•°æ®é›†å¤åˆ¶åˆ°ç©ºæ•°æ®é›†ã€‚³Incremental Backups¬å¢é‡å¤‡ä»½Ù«`zfs send` can also determine the difference between two snapshots and send individual differences between the two.  This saves disk space and transfer time.  For example:Ù˜`zfs send` è¿˜å¯ä»¥ç¡®å®šä¸¤ä¸ªå¿«ç…§ä¹‹é—´çš„å·®å¼‚ï¼Œå¹¶å‘é€ä¸¤è€…ä¹‹é—´çš„ä¸ªåˆ«å·®å¼‚ã€‚è¿™æ ·å¯ä»¥èŠ‚çœç£ç›˜ç©ºé—´å’Œä¼ è¾“æ—¶é—´ã€‚ä¾‹å¦‚ï¼šÚiCreate a second snapshot called _replica2_.  This second snapshot contains changes made to the file system between now and the previous snapshot, _replica1_.  Using `zfs send -i` and indicating the pair of snapshots generates an incremental replica stream containing the changed data.  This succeeds if the initial snapshot already exists on the receiving side.ÚYåˆ›å»ºä¸€ä¸ªåä¸º _replica2_ çš„ç¬¬äºŒä¸ªå¿«ç…§ã€‚è¿™ä¸ªç¬¬äºŒä¸ªå¿«ç…§åŒ…å«äº†ä»ç°åœ¨åˆ°ä¸Šä¸€ä¸ªå¿«ç…§ _replica1_ ä¹‹é—´å¯¹æ–‡ä»¶ç³»ç»Ÿæ‰€åšçš„æ›´æ”¹ã€‚ä½¿ç”¨ `zfs send -i` å‘½ä»¤ï¼Œå¹¶æŒ‡å®šå¿«ç…§å¯¹ï¼Œå¯ä»¥ç”Ÿæˆä¸€ä¸ªå¢é‡å¤åˆ¶æµï¼Œå…¶ä¸­åŒ…å«äº†æ›´æ”¹çš„æ•°æ®ã€‚å¦‚æœæ¥æ”¶ç«¯å·²ç»å­˜åœ¨åˆå§‹å¿«ç…§ï¼Œåˆ™æ­¤æ“ä½œå°†æˆåŠŸã€‚Ú2The incremental stream replicated the changed data rather than the entirety of _replica1_.  Sending the differences alone took much less time to transfer and saved disk space by not copying the whole pool each time.  This is useful when replicating over a slow network or one charging per transferred byte.Úå¢é‡æµå¤åˆ¶äº†å˜åŒ–çš„æ•°æ®ï¼Œè€Œä¸æ˜¯æ•´ä¸ª _replica1_ã€‚ä»…å‘é€å·®å¼‚æ‰€éœ€çš„ä¼ è¾“æ—¶é—´æ›´çŸ­ï¼Œå¹¶ä¸”é€šè¿‡ä¸æ¯æ¬¡å¤åˆ¶æ•´ä¸ªæ± æ¥èŠ‚çœç£ç›˜ç©ºé—´ã€‚è¿™åœ¨é€šè¿‡æ…¢é€Ÿç½‘ç»œæˆ–æŒ‰ä¼ è¾“å­—èŠ‚è®¡è´¹çš„ç½‘ç»œä¸Šè¿›è¡Œå¤åˆ¶æ—¶éå¸¸æœ‰ç”¨ã€‚ÚnA new file system, _backup/mypool_, is available with the files and data from the pool _mypool_.  Specifying `-p` copies the dataset properties including compression settings, quotas, and mount points.  Specifying `-R` copies all child datasets of the dataset along with their properties.  Automate sending and receiving to create regular backups on the second pool.Ú`ä¸€ä¸ªæ–°çš„æ–‡ä»¶ç³»ç»Ÿï¼Œ_backup/mypool_ï¼Œå¯ç”¨äºå­˜å‚¨æ¥è‡ªæ±  _mypool_ çš„æ–‡ä»¶å’Œæ•°æ®ã€‚ä½¿ç”¨ `-p` å‚æ•°å¯ä»¥å¤åˆ¶æ•°æ®é›†çš„å±æ€§ï¼ŒåŒ…æ‹¬å‹ç¼©è®¾ç½®ã€é…é¢å’ŒæŒ‚è½½ç‚¹ã€‚ä½¿ç”¨ `-R` å‚æ•°å¯ä»¥å¤åˆ¶æ•°æ®é›†çš„æ‰€æœ‰å­æ•°æ®é›†ä»¥åŠå®ƒä»¬çš„å±æ€§ã€‚è‡ªåŠ¨åŒ–å‘é€å’Œæ¥æ”¶æ“ä½œå¯ä»¥åœ¨ç¬¬äºŒä¸ªæ± ä¸­åˆ›å»ºå®šæœŸå¤‡ä»½ã€‚Ù"Sending Encrypted Backups over SSH½é€šè¿‡ SSH å‘é€åŠ å¯†å¤‡ä»½ÚSending streams over the network is a good way to keep a remote backup, but it does come with a drawback.  Data sent over the network link is not encrypted, allowing anyone to intercept and transform the streams back into data without the knowledge of the sending user.  This is undesirable when sending the streams over the internet to a remote host.  Use SSH to securely encrypt data sent over a network connection.  Since ZFS requires redirecting the stream from standard output, piping it through SSH is easy.  To keep the contents of the file system encrypted in transit and on the remote system, consider using https://wiki.freebsd.org/PEFS[PEFS].Úé€šè¿‡ç½‘ç»œå‘é€æµæ˜¯ä¿æŒè¿œç¨‹å¤‡ä»½çš„å¥½æ–¹æ³•ï¼Œä½†å®ƒä¹Ÿæœ‰ä¸€ä¸ªç¼ºç‚¹ã€‚é€šè¿‡ç½‘ç»œé“¾è·¯å‘é€çš„æ•°æ®æ²¡æœ‰åŠ å¯†ï¼Œå…è®¸ä»»ä½•äººåœ¨ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹æ‹¦æˆªå’Œè½¬æ¢æµä¸ºæ•°æ®ã€‚å½“å°†æµå‘é€åˆ°è¿œç¨‹ä¸»æœºæ—¶ï¼Œè¿™æ˜¯ä¸å¯å–çš„ã€‚ä½¿ç”¨ SSH æ¥å®‰å…¨åœ°åŠ å¯†é€šè¿‡ç½‘ç»œè¿æ¥å‘é€çš„æ•°æ®ã€‚ç”±äº ZFS éœ€è¦å°†æµé‡å®šå‘åˆ°æ ‡å‡†è¾“å‡ºï¼Œæ‰€ä»¥é€šè¿‡ SSH è¿›è¡Œç®¡é“ä¼ è¾“å¾ˆå®¹æ˜“ã€‚ä¸ºäº†åœ¨ä¼ è¾“å’Œè¿œç¨‹ç³»ç»Ÿä¸Šä¿æŒæ–‡ä»¶ç³»ç»Ÿçš„å†…å®¹åŠ å¯†ï¼Œè€ƒè™‘ä½¿ç”¨ https://wiki.freebsd.org/PEFS[PEFS]ã€‚ÙËChange some settings and take security precautions first.  This describes the necessary steps required for the `zfs send` operation; for more information on SSH, see crossref:security[openssh,"OpenSSH"].ÙÄé¦–å…ˆï¼Œæ›´æ”¹ä¸€äº›è®¾ç½®å¹¶é‡‡å–å®‰å…¨é¢„é˜²æªæ–½ã€‚è¿™æè¿°äº†æ‰§è¡Œ `zfs send` æ“ä½œæ‰€éœ€çš„å¿…è¦æ­¥éª¤ï¼›æœ‰å…³ SSH çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§ crossref:security[openssh,"OpenSSH"] ã€‚Ù$Change the configuration as follows:¸å°†é…ç½®æ›´æ”¹å¦‚ä¸‹ï¼šÙIPasswordless SSH access between sending and receiving host using SSH keysÙIä½¿ç”¨ SSH å¯†é’¥åœ¨å‘é€å’Œæ¥æ”¶ä¸»æœºä¹‹é—´å®ç°æ— å¯†ç  SSH è®¿é—®Ù‡ZFS requires the privileges of the `root` user to send and receive streams. This requires logging in to the receiving system as `root`.ÙqZFS éœ€è¦ `root` ç”¨æˆ·çš„æƒé™æ¥å‘é€å’Œæ¥æ”¶æµã€‚è¿™éœ€è¦ä»¥ `root` ç”¨æˆ·èº«ä»½ç™»å½•åˆ°æ¥æ”¶ç³»ç»Ÿã€‚Ù;Security reasons prevent `root` from logging in by default.ÙAå‡ºäºå®‰å…¨åŸå› ï¼Œé»˜è®¤æƒ…å†µä¸‹ç¦æ­¢ `root` ç”¨æˆ·ç™»å½•ã€‚Ù¨Use the <<zfs-zfs-allow,ZFS Delegation>> system to allow a non-`root` user on each system to perform the respective send and receive operations.  On the sending system:Ù’ä½¿ç”¨ <<zfs-zfs-allow,ZFS å§”æ´¾>> ç³»ç»Ÿï¼Œå…è®¸æ¯ä¸ªç³»ç»Ÿä¸Šçš„é `root` ç”¨æˆ·æ‰§è¡Œç›¸åº”çš„å‘é€å’Œæ¥æ”¶æ“ä½œã€‚åœ¨å‘é€ç³»ç»Ÿä¸Šï¼šÙyTo mount the pool, the unprivileged user must own the directory, and regular users need permission to mount file systems.Ù{è¦æŒ‚è½½æ± ï¼Œéç‰¹æƒç”¨æˆ·å¿…é¡»æ‹¥æœ‰è¯¥ç›®å½•çš„æ‰€æœ‰æƒï¼Œå¹¶ä¸”æ™®é€šç”¨æˆ·éœ€è¦æœ‰æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿçš„æƒé™ã€‚¸On the receiving system:µåœ¨æ¥æ”¶ç³»ç»Ÿä¸Šï¼šÙqThe unprivileged user can receive and mount datasets now, and replicates the _home_ dataset to the remote system:Ùeéç‰¹æƒç”¨æˆ·ç°åœ¨å¯ä»¥æ¥æ”¶å’ŒæŒ‚è½½æ•°æ®é›†ï¼Œå¹¶å°† _home_ æ•°æ®é›†å¤åˆ¶åˆ°è¿œç¨‹ç³»ç»Ÿï¼šÚìCreate a recursive snapshot called _monday_ of the file system dataset _home_ on the pool _mypool_.  Then `zfs send -R` includes the dataset, all child datasets, snapshots, clones, and settings in the stream.  Pipe the output through SSH to the waiting `zfs receive` on the remote host _backuphost_.  Using an IP address or fully qualified domain name is good practice.  The receiving machine writes the data to the _backup_ dataset on the _recvpool_ pool.  Adding `-d` to `zfs recv` overwrites the name of the pool on the receiving side with the name of the snapshot.  `-u` causes the file systems to not mount on the receiving side.  Using `-v` shows more details about the transfer, including the elapsed time and the amount of data transferred.Ú¯åœ¨æ±  _mypool_ ä¸Šåˆ›å»ºä¸€ä¸ªåä¸º _monday_ çš„æ–‡ä»¶ç³»ç»Ÿæ•°æ®é›† _home_ çš„é€’å½’å¿«ç…§ã€‚ç„¶åï¼Œ`zfs send -R` å‘½ä»¤å°†æ•°æ®é›†ã€æ‰€æœ‰å­æ•°æ®é›†ã€å¿«ç…§ã€å…‹éš†å’Œè®¾ç½®åŒ…å«åœ¨æµä¸­ã€‚é€šè¿‡ SSH å°†è¾“å‡ºå¯¼å‘ç­‰å¾…çš„è¿œç¨‹ä¸»æœº _backuphost_ ä¸Šçš„ `zfs receive` å‘½ä»¤ã€‚ä½¿ç”¨ IP åœ°å€æˆ–å®Œå…¨é™å®šåŸŸåæ˜¯è‰¯å¥½çš„å®è·µã€‚æ¥æ”¶æœºå°†æ•°æ®å†™å…¥ _recvpool_ æ± ä¸Šçš„ _backup_ æ•°æ®é›†ã€‚åœ¨ `zfs recv` å‘½ä»¤ä¸­æ·»åŠ  `-d` é€‰é¡¹ä¼šä½¿ç”¨å¿«ç…§çš„åç§°è¦†ç›–æ¥æ”¶ç«¯æ± çš„åç§°ã€‚ `-u` é€‰é¡¹ä¼šå¯¼è‡´æ¥æ”¶ç«¯ä¸Šçš„æ–‡ä»¶ç³»ç»Ÿä¸æŒ‚è½½ã€‚ä½¿ç”¨ `-v` é€‰é¡¹å¯ä»¥æ˜¾ç¤ºæœ‰å…³ä¼ è¾“çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç»è¿‡çš„æ—¶é—´å’Œä¼ è¾“çš„æ•°æ®é‡ã€‚¿Dataset, User, and Group Quotas¾æ•°æ®é›†ã€ç”¨æˆ·å’Œç»„é…é¢Ú¦Use <<zfs-term-quota,Dataset quotas>> to restrict the amount of space consumed by a particular dataset.  <<zfs-term-refquota,Reference Quotas>> work in much the same way, but count the space used by the dataset itself, excluding snapshots and child datasets.  Similarly, use <<zfs-term-userquota,user>> and <<zfs-term-groupquota,group>> quotas to prevent users or groups from using up all the space in the pool or dataset.Úä½¿ç”¨ <<zfs-term-quota, æ•°æ®é›†é…é¢ >> æ¥é™åˆ¶ç‰¹å®šæ•°æ®é›†æ¶ˆè€—çš„ç©ºé—´é‡ã€‚ <<zfs-term-refquota, å¼•ç”¨é…é¢ >> çš„å·¥ä½œæ–¹å¼ç±»ä¼¼ï¼Œä½†æ˜¯è®¡ç®—çš„æ˜¯æ•°æ®é›†æœ¬èº«ä½¿ç”¨çš„ç©ºé—´ï¼Œä¸åŒ…æ‹¬å¿«ç…§å’Œå­æ•°æ®é›†ã€‚åŒæ ·åœ°ï¼Œä½¿ç”¨ <<zfs-term-userquota, ç”¨æˆ·é…é¢ >> å’Œ <<zfs-term-groupquota, ç»„é…é¢ >> æ¥é˜²æ­¢ç”¨æˆ·æˆ–ç»„ä½¿ç”¨å®Œæ± æˆ–æ•°æ®é›†ä¸­çš„æ‰€æœ‰ç©ºé—´ã€‚Ú¥The following examples assume that the users already exist in the system.  Before adding a user to the system, make sure to create their home dataset first and set the `mountpoint` to `/home/_bob_`.  Then, create the user and make the home directory point to the dataset's `mountpoint` location.  This will properly set owner and group permissions without shadowing any pre-existing home directory paths that might exist.Úuä»¥ä¸‹ç¤ºä¾‹å‡è®¾ç”¨æˆ·å·²ç»å­˜åœ¨äºç³»ç»Ÿä¸­ã€‚åœ¨å°†ç”¨æˆ·æ·»åŠ åˆ°ç³»ç»Ÿä¹‹å‰ï¼Œè¯·ç¡®ä¿é¦–å…ˆåˆ›å»ºä»–ä»¬çš„ä¸»ç›®å½•æ•°æ®é›†ï¼Œå¹¶å°† `mountpoint` è®¾ç½®ä¸º `/home/_bob_` ã€‚ç„¶åï¼Œåˆ›å»ºç”¨æˆ·å¹¶å°†ä¸»ç›®å½•æŒ‡å‘æ•°æ®é›†çš„ `mountpoint` ä½ç½®ã€‚è¿™å°†æ­£ç¡®è®¾ç½®æ‰€æœ‰è€…å’Œç»„æƒé™ï¼Œè€Œä¸ä¼šé®ç›–å¯èƒ½å­˜åœ¨çš„ä»»ä½•é¢„å…ˆå­˜åœ¨çš„ä¸»ç›®å½•è·¯å¾„ã€‚ÙFTo enforce a dataset quota of 10 GB for [.filename]#storage/home/bob#:ÙVä¸ºäº†å¯¹ [.filename]#storage/home/bob# å¼ºåˆ¶æ‰§è¡Œä¸€ä¸ª 10 GB çš„æ•°æ®é›†é…é¢ï¼šÙHTo enforce a reference quota of 10 GB for [.filename]#storage/home/bob#:ÙMä¸ºäº†å¼ºåˆ¶é™åˆ¶ [.filename]#storage/home/bob# çš„å¼•ç”¨é…é¢ä¸º 10 GB ï¼šÙ=To remove a quota of 10 GB for [.filename]#storage/home/bob#:Ù;è¦ç§»é™¤ [.filename]#storage/home/bob# çš„ 10 GB é…é¢ï¼šÙeThe general format is `userquota@_user_=_size_`, and the user's name must be in one of these formats:Ù]é€šç”¨æ ¼å¼ä¸º `userquota@_user_=_size_` ï¼Œç”¨æˆ·çš„åç§°å¿…é¡»ç¬¦åˆä»¥ä¸‹æ ¼å¼ä¹‹ä¸€ï¼šÙ$POSIX compatible name such as _joe_.Ù'POSIX å…¼å®¹çš„åç§°ï¼Œä¾‹å¦‚ _joe_ã€‚¿POSIX numeric ID such as _789_.Ù!POSIX æ•°å€¼ IDï¼Œä¾‹å¦‚ _789_ã€‚Ù*SID name such as _joe.bloggs@example.com_.Ù/SID åç§°ï¼Œä¾‹å¦‚ _joe.bloggs@example.com_ã€‚Ù)SID numeric ID such as _S-1-123-456-789_.Ù4SID æ˜¯ä¸€ä¸ªæ•°å­— IDï¼Œä¾‹å¦‚ _S-1-123-456-789_ã€‚ÙGFor example, to enforce a user quota of 50 GB for the user named _joe_:ÙJä¾‹å¦‚ï¼Œè¦ä¸ºåä¸º _joe_ çš„ç”¨æˆ·å¼ºåˆ¶æ‰§è¡Œ 50 GB çš„ç”¨æˆ·é…é¢ï¼š´To remove any quota:¸è¦ç§»é™¤ä»»ä½•é…é¢ï¼šÙÔUser quota properties are not displayed by `zfs get all`.  Non-`root` users can't see other's quotas unless granted the `userquota` privilege.  Users with this privilege are able to view and set everyone's quota.Ù×`zfs get all` å‘½ä»¤ä¸ä¼šæ˜¾ç¤ºç”¨æˆ·é…é¢å±æ€§ã€‚é `root` ç”¨æˆ·é™¤éè¢«æˆäºˆ `userquota` æƒé™ï¼Œå¦åˆ™æ— æ³•æŸ¥çœ‹å…¶ä»–ç”¨æˆ·çš„é…é¢ã€‚æ‹¥æœ‰æ­¤æƒé™çš„ç”¨æˆ·å¯ä»¥æŸ¥çœ‹å’Œè®¾ç½®æ‰€æœ‰äººçš„é…é¢ã€‚ÙMThe general format for setting a group quota is: `groupquota@_group_=_size_`.ÙFè®¾ç½®ç¾¤ç»„é…é¢çš„ä¸€èˆ¬æ ¼å¼ä¸ºï¼š`groupquota@_group_=_size_` ã€‚Ù:To set the quota for the group _firstgroup_ to 50 GB, use:ÙJè¦å°†ç»„ _firstgroup_ çš„é…é¢è®¾ç½®ä¸º 50 GBï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼šÙaTo remove the quota for the group _firstgroup_, or to make sure that one is not set, instead use:ÙYè¦åˆ é™¤ç»„ _firstgroup_ çš„é…é¢ï¼Œæˆ–ç¡®ä¿æœªè®¾ç½®é…é¢ï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼šÙÓAs with the user quota property, non-`root` users can see the quotas associated with the groups to which they belong.  A user with the `groupquota` privilege or `root` can view and set all quotas for all groups.ÙÉä¸ç”¨æˆ·é…é¢å±æ€§ä¸€æ ·ï¼Œé `root` ç”¨æˆ·å¯ä»¥æŸ¥çœ‹ä¸ä»–ä»¬æ‰€å±çš„ç»„ç›¸å…³è”çš„é…é¢ã€‚å…·æœ‰ `groupquota` ç‰¹æƒæˆ– `root` æƒé™çš„ç”¨æˆ·å¯ä»¥æŸ¥çœ‹å’Œè®¾ç½®æ‰€æœ‰ç»„çš„æ‰€æœ‰é…é¢ã€‚ÚTo display the amount of space used by each user on a file system or snapshot along with any quotas, use `zfs userspace`.  For group information, use `zfs groupspace`.  For more information about supported options or how to display specific options alone, refer to man:zfs[1].Ùşè¦æ˜¾ç¤ºæ–‡ä»¶ç³»ç»Ÿæˆ–å¿«ç…§ä¸­æ¯ä¸ªç”¨æˆ·ä½¿ç”¨çš„ç©ºé—´é‡ä»¥åŠä»»ä½•é…é¢ï¼Œè¯·ä½¿ç”¨ `zfs userspace`ã€‚è¦è·å–ç»„ä¿¡æ¯ï¼Œè¯·ä½¿ç”¨ `zfs groupspace`ã€‚æœ‰å…³æ”¯æŒçš„é€‰é¡¹æˆ–å¦‚ä½•ä»…æ˜¾ç¤ºç‰¹å®šé€‰é¡¹çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜… man:zfs[1]ã€‚ÙWPrivileged users and `root` can list the quota for [.filename]#storage/home/bob# using:Ùlç‰¹æƒç”¨æˆ·å’Œ `root` ç”¨æˆ·å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆ—å‡º [.filename]#storage/home/bob# ç›®å½•çš„é…é¢ï¼š¬Reservations¬é¢„ç•™ç©ºé—´Ú<<zfs-term-reservation,Reservations>> guarantee an always-available amount of space on a dataset.  The reserved space will not be available to any other dataset.  This useful feature ensures that free space is available for an important dataset or log files.Ùç<<zfs-term-reservation,é¢„ç•™ç©ºé—´ >> ä¿è¯äº†æ•°æ®é›†ä¸Šå§‹ç»ˆå¯ç”¨çš„ä¸€å®šé‡ç©ºé—´ã€‚é¢„ç•™çš„ç©ºé—´å°†ä¸ä¼šå¯¹å…¶ä»–æ•°æ®é›†å¯ç”¨ã€‚è¿™ä¸ªæœ‰ç”¨çš„åŠŸèƒ½ç¡®ä¿äº†é‡è¦æ•°æ®é›†æˆ–æ—¥å¿—æ–‡ä»¶çš„å¯ç”¨çš„ç©ºé—²ç©ºé—´ã€‚Ù‘The general format of the `reservation` property is `reservation=_size_`, so to set a reservation of 10 GB on [.filename]#storage/home/bob#, use:Ù¦`reservation` å±æ€§çš„ä¸€èˆ¬æ ¼å¼æ˜¯ `reservation=_size_`ï¼Œå› æ­¤è¦åœ¨ [.filename]#storage/home/bob# ä¸Šè®¾ç½® 10 GB çš„é¢„ç•™ç©ºé—´ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š¹To clear any reservation:»å–æ¶ˆä»»ä½•é¢„ç•™ç©ºé—´ï¼šÙ­The same principle applies to the `refreservation` property for setting a <<zfs-term-refreservation,Reference Reservation>>, with the general format `refreservation=_size_`.Ù›åŒæ ·çš„åŸåˆ™é€‚ç”¨äºè®¾ç½® `refreservation` å±æ€§ä»¥è®¾ç½® <<zfs-term-refreservation,å¼•ç”¨é¢„ç•™ >>ï¼Œå…¶ä¸€èˆ¬æ ¼å¼ä¸º `refreservation =_size_` ã€‚ÙcThis command shows any reservations or refreservations that exist on [.filename]#storage/home/bob#:Ùjè¯¥å‘½ä»¤æ˜¾ç¤ºä½äº [.filename]#storage/home/bob# ç›®å½•ä¸‹çš„ä»»ä½•é¢„ç•™ç©ºé—´æˆ–å¼•ç”¨é¢„ç•™ç©ºé—´ã€‚«Compression¦å‹ç¼©Ú£ZFS provides transparent compression.  Compressing data written at the block level saves space and also increases disk throughput.  If data compresses by 25% the compressed data writes to the disk at the same rate as the uncompressed version, resulting in an effective write speed of 125%.  Compression can also be a great alternative to <<zfs-zfs-deduplication,Deduplication>> because it does not require extra memory.ÚuZFS æä¾›é€æ˜å‹ç¼©åŠŸèƒ½ã€‚åœ¨å—çº§åˆ«å‹ç¼©æ•°æ®å¯ä»¥èŠ‚çœç©ºé—´ï¼ŒåŒæ—¶æé«˜ç£ç›˜ååé‡ã€‚å¦‚æœæ•°æ®å‹ç¼©ç‡ä¸º 25% ï¼Œå‹ç¼©åçš„æ•°æ®å†™å…¥ç£ç›˜çš„é€Ÿåº¦ä¸æœªå‹ç¼©ç‰ˆæœ¬ç›¸åŒï¼Œä»è€Œå®ç°äº† 125% çš„æœ‰æ•ˆå†™å…¥é€Ÿåº¦ã€‚å‹ç¼©ä¹Ÿå¯ä»¥ä½œä¸º <<zfs-zfs-deduplication,å»é‡>> çš„ä¸€ä¸ªå¾ˆå¥½çš„æ›¿ä»£æ–¹æ¡ˆï¼Œå› ä¸ºå®ƒä¸éœ€è¦é¢å¤–çš„å†…å­˜ã€‚Ú“ZFS offers different compression algorithms, each with different trade-offs.  The introduction of LZ4 compression in ZFS v5000 enables compressing the entire pool without the large performance trade-off of other algorithms.  The biggest advantage to LZ4 is the _early abort_ feature.  If LZ4 does not achieve at least 12.5% compression in the header part of the data, ZFS writes the block uncompressed to avoid wasting CPU cycles trying to compress data that is either already compressed or uncompressible.  For details about the different compression algorithms available in ZFS, see the <<zfs-term-compression,Compression>> entry in the terminology section.Ú8ZFS æä¾›äº†ä¸åŒçš„å‹ç¼©ç®—æ³•ï¼Œæ¯ç§ç®—æ³•éƒ½æœ‰ä¸åŒçš„æƒè¡¡ã€‚åœ¨ ZFS v5000 ä¸­å¼•å…¥çš„ LZ4 å‹ç¼©ç®—æ³•å¯ä»¥åœ¨ä¸ç‰ºç‰²æ€§èƒ½çš„æƒ…å†µä¸‹å¯¹æ•´ä¸ªæ± è¿›è¡Œå‹ç¼©ã€‚ LZ4 çš„æœ€å¤§ä¼˜åŠ¿æ˜¯ _æå‰ä¸­æ­¢ï¼ˆearly abortï¼‰_ åŠŸèƒ½ã€‚å¦‚æœ LZ4 åœ¨æ•°æ®çš„å¤´éƒ¨éƒ¨åˆ†æ— æ³•è¾¾åˆ°è‡³å°‘ 12.5% çš„å‹ç¼©ç‡ï¼Œ ZFS ä¼šä»¥æœªå‹ç¼©çš„æ–¹å¼å†™å…¥è¯¥å—ï¼Œä»¥é¿å…æµªè´¹ CPU å‘¨æœŸå°è¯•å‹ç¼©å·²ç»å‹ç¼©æˆ–æ— æ³•å‹ç¼©çš„æ•°æ®ã€‚æœ‰å…³ ZFS ä¸­å¯ç”¨çš„ä¸åŒå‹ç¼©ç®—æ³•çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…æœ¯è¯­éƒ¨åˆ†ä¸­çš„ <<zfs-term-compression,å‹ç¼©>> æ¡ç›®ã€‚ÙTThe administrator can see the effectiveness of compression using dataset properties.Ù?ç®¡ç†å‘˜å¯ä»¥é€šè¿‡æ•°æ®é›†å±æ€§æŸ¥çœ‹å‹ç¼©çš„æœ‰æ•ˆæ€§ã€‚Ù¾The dataset is using 449 GB of space (the used property).  Without compression, it would have taken 496 GB of space (the `logicalused` property).  This results in a 1.11:1 compression ratio.Ù·è¯¥æ•°æ®é›†ä½¿ç”¨äº† 449 GB çš„ç©ºé—´ï¼ˆä½¿ç”¨çš„å±æ€§ï¼‰ã€‚å¦‚æœä¸è¿›è¡Œå‹ç¼©ï¼Œå®ƒå°†å ç”¨ 496 GB çš„ç©ºé—´ï¼ˆé€»è¾‘ä½¿ç”¨çš„å±æ€§ï¼‰ã€‚è¿™å¯¼è‡´äº† 1.11:1 çš„å‹ç¼©æ¯”ç‡ã€‚ÚCompression can have an unexpected side effect when combined with <<zfs-term-userquota,User Quotas>>.  User quotas restrict how much actual space a user consumes on a dataset _after compression_.  If a user has a quota of 10 GB, and writes 10 GB of compressible data, they will still be able to store more data.  If they later update a file, say a database, with more or less compressible data, the amount of space available to them will change.  This can result in the odd situation where a user did not increase the actual amount of data (the `logicalused` property), but the change in compression caused them to reach their quota limit.Úoå½“ä¸ <<zfs-term-userquota,ç”¨æˆ·é…é¢ >> ç»“åˆä½¿ç”¨æ—¶ï¼Œå‹ç¼©å¯èƒ½ä¼šäº§ç”Ÿæ„æƒ³ä¸åˆ°çš„å‰¯ä½œç”¨ã€‚ç”¨æˆ·é…é¢é™åˆ¶äº†ç”¨æˆ·åœ¨æ•°æ®é›†ä¸Šå®é™…æ¶ˆè€—çš„ç©ºé—´ï¼ˆåœ¨å‹ç¼©ä¹‹åï¼‰ã€‚å¦‚æœä¸€ä¸ªç”¨æˆ·çš„é…é¢æ˜¯ 10GB ï¼Œå¹¶å†™å…¥äº† 10GB çš„å¯å‹ç¼©æ•°æ®ï¼Œä»–ä»¬ä»ç„¶å¯ä»¥å­˜å‚¨æ›´å¤šçš„æ•°æ®ã€‚å¦‚æœä»–ä»¬ç¨åæ›´æ–°ä¸€ä¸ªæ–‡ä»¶ï¼Œæ¯”å¦‚ä¸€ä¸ªæ•°æ®åº“ï¼Œå…¶ä¸­åŒ…å«æ›´å¤šæˆ–æ›´å°‘å¯å‹ç¼©çš„æ•°æ®ï¼Œå¯ç”¨ç©ºé—´çš„æ•°é‡å°†ä¼šæ”¹å˜ã€‚è¿™å¯èƒ½å¯¼è‡´ä¸€ä¸ªå¥‡æ€ªçš„æƒ…å†µï¼Œå³ç”¨æˆ·æ²¡æœ‰å¢åŠ å®é™…æ•°æ®é‡ï¼ˆ `logicalused` å±æ€§ï¼‰ï¼Œä½†å‹ç¼©çš„å˜åŒ–å¯¼è‡´ä»–ä»¬è¾¾åˆ°äº†é…é¢é™åˆ¶ã€‚ÚCompression can have a similar unexpected interaction with backups.  Quotas are often used to limit data storage to ensure there is enough backup space available.  Since quotas do not consider compression ZFS may write more data than would fit with uncompressed backups.Ùõå‹ç¼©å¯èƒ½ä¼šä¸å¤‡ä»½äº§ç”Ÿç±»ä¼¼çš„æ„å¤–äº¤äº’ä½œç”¨ã€‚é…é¢é€šå¸¸ç”¨äºé™åˆ¶æ•°æ®å­˜å‚¨ï¼Œä»¥ç¡®ä¿æœ‰è¶³å¤Ÿçš„å¤‡ä»½ç©ºé—´å¯ç”¨ã€‚ç”±äºé…é¢ä¸è€ƒè™‘å‹ç¼©ï¼Œå› æ­¤ ZFS å¯èƒ½ä¼šå†™å…¥æ¯”æœªå‹ç¼©å¤‡ä»½æ‰€èƒ½å®¹çº³çš„æ›´å¤šæ•°æ®ã€‚µZstandard Compression°Zstandard å‹ç¼©ÚHOpenZFS 2.0 added a new compression algorithm.  Zstandard (Zstd) offers higher compression ratios than the default LZ4 while offering much greater speeds than the alternative, gzip. OpenZFS 2.0 is available starting with FreeBSD 12.1-RELEASE via package:sysutils/openzfs[] and has been the default in since FreeBSD 13.0-RELEASE.Ú/OpenZFS 2.0 å¢åŠ äº†ä¸€ç§æ–°çš„å‹ç¼©ç®—æ³•ã€‚Zstandardï¼ˆZstdï¼‰æä¾›æ¯”é»˜è®¤çš„ LZ4 æ›´é«˜çš„å‹ç¼©æ¯”ï¼ŒåŒæ—¶æ¯”æ›¿ä»£æ–¹æ¡ˆ gzip é€Ÿåº¦æ›´å¿«ã€‚OpenZFS 2.0 å¯ä»¥é€šè¿‡ FreeBSD 12.1-RELEASE çš„ package:sysutils/openzfs[] åŒ…è·å¾—ï¼Œå¹¶ä¸”è‡ª FreeBSD 13.0-RELEASE ä»¥æ¥å·²æˆä¸ºé»˜è®¤é€‰é¡¹ã€‚ÚnZstd provides a large selection of compression levels, providing fine-grained control over performance versus compression ratio.  One of the main advantages of Zstd is that the decompression speed is independent of the compression level.  For data written once but read often, Zstd allows the use of the highest compression levels without a read performance penalty.ÚZstd æä¾›äº†å¤šç§å‹ç¼©çº§åˆ«ï¼Œå¯ä»¥å¯¹æ€§èƒ½å’Œå‹ç¼©æ¯”è¿›è¡Œç»†ç²’åº¦æ§åˆ¶ã€‚Zstd çš„ä¸€ä¸ªä¸»è¦ä¼˜åŠ¿æ˜¯è§£å‹é€Ÿåº¦ä¸å‹ç¼©çº§åˆ«æ— å…³ã€‚å¯¹äºåªå†™å…¥ä¸€æ¬¡ä½†ç»å¸¸è¯»å–çš„æ•°æ®ï¼Œ Zstd å…è®¸ä½¿ç”¨æœ€é«˜çš„å‹ç¼©çº§åˆ«è€Œä¸ä¼šå½±å“è¯»å–æ€§èƒ½ã€‚ÚyEven with frequent data updates, enabling compression often provides higher performance.  One of the biggest advantages comes from the compressed ARC feature.  ZFS's Adaptive Replacement Cache (ARC) caches the compressed version of the data in RAM, decompressing it each time.  This allows the same amount of RAM to store more data and metadata, increasing the cache hit ratio.Újå³ä½¿è¿›è¡Œé¢‘ç¹çš„æ•°æ®æ›´æ–°ï¼Œå¯ç”¨å‹ç¼©é€šå¸¸ä¹Ÿèƒ½æä¾›æ›´é«˜çš„æ€§èƒ½ã€‚å…¶ä¸­æœ€å¤§çš„ä¼˜åŠ¿ä¹‹ä¸€æ¥è‡ªäºå‹ç¼©çš„ ARC åŠŸèƒ½ã€‚ ZFS çš„è‡ªé€‚åº”æ›¿æ¢ç¼“å­˜ï¼ˆARCï¼‰å°†æ•°æ®çš„å‹ç¼©ç‰ˆæœ¬ç¼“å­˜åœ¨ RAM ä¸­ï¼Œæ¯æ¬¡éœ€è¦æ—¶è¿›è¡Œè§£å‹ç¼©ã€‚è¿™ä½¿å¾—ç›¸åŒæ•°é‡çš„ RAM èƒ½å¤Ÿå­˜å‚¨æ›´å¤šçš„æ•°æ®å’Œå…ƒæ•°æ®ï¼Œä»è€Œå¢åŠ äº†ç¼“å­˜å‘½ä¸­ç‡ã€‚Ú¸ZFS offers 19 levels of Zstd compression, each offering incrementally more space savings in exchange for slower compression.  The default level is `zstd-3` and offers greater compression than LZ4 without being much slower.  Levels above 10 require large amounts of memory to compress each block and systems with less than 16 GB of RAM should not use them.  ZFS uses a selection of the Zstd_fast_ levels also, which get correspondingly faster but supports lower compression ratios.  ZFS supports `zstd-fast-1` through `zstd-fast-10`, `zstd-fast-20` through `zstd-fast-100` in increments of 10, and `zstd-fast-500` and `zstd-fast-1000` which provide minimal compression, but offer high performance.Ú„ZFS æä¾› 19 ä¸ªçº§åˆ«çš„ Zstd å‹ç¼©ï¼Œæ¯ä¸ªçº§åˆ«éƒ½å¯ä»¥åœ¨æ›´æ…¢çš„å‹ç¼©é€Ÿåº¦ä¸‹æä¾›æ›´å¤šçš„ç©ºé—´èŠ‚çœã€‚é»˜è®¤çº§åˆ«æ˜¯ `zstd-3`ï¼Œæ¯” LZ4 æä¾›æ›´å¥½çš„å‹ç¼©æ•ˆæœï¼Œä½†é€Ÿåº¦ä¸ä¼šæ…¢å¤ªå¤šã€‚çº§åˆ«è¶…è¿‡ 10 éœ€è¦å¤§é‡çš„å†…å­˜æ¥å‹ç¼©æ¯ä¸ªå—ï¼Œå†…å­˜å°äº 16GB çš„ç³»ç»Ÿä¸åº”ä½¿ç”¨è¿™äº›çº§åˆ«ã€‚ZFS è¿˜ä½¿ç”¨äº†ä¸€ç³»åˆ—çš„ Zstd_fast_ çº§åˆ«ï¼Œå®ƒä»¬çš„å‹ç¼©é€Ÿåº¦æ›´å¿«ï¼Œä½†æ”¯æŒçš„å‹ç¼©æ¯”è¾ƒä½ã€‚ZFS æ”¯æŒ `zstd-fast-1` åˆ° `zstd-fast-10`ï¼Œä»¥åŠä»¥ 10 ä¸ºå¢é‡çš„ `zstd-fast-20` åˆ° `zstd-fast-100`ï¼Œè¿˜æœ‰ `zstd-fast-500` å’Œ `zstd-fast-1000`ï¼Œå®ƒä»¬æä¾›æœ€å°çš„å‹ç¼©æ•ˆæœï¼Œä½†å…·æœ‰é«˜æ€§èƒ½ã€‚ÚVIf ZFS is not able to get the required memory to compress a block with Zstd, it will fall back to storing the block uncompressed.  This is unlikely to happen except at the highest levels of Zstd on memory constrained systems.  ZFS counts how often this has occurred since loading the ZFS module with `kstat.zfs.misc.zstd.compress_alloc_fail`.Ú>å¦‚æœ ZFS æ— æ³•è·å–æ‰€éœ€çš„å†…å­˜æ¥ä½¿ç”¨ Zstd å‹ç¼©å—ï¼Œå®ƒå°†é€€å›åˆ°å­˜å‚¨æœªå‹ç¼©çš„å—ã€‚é™¤éåœ¨å†…å­˜å—é™çš„ç³»ç»Ÿä¸Šä½¿ç”¨ Zstd çš„æœ€é«˜çº§åˆ«ï¼Œå¦åˆ™è¿™ç§æƒ…å†µä¸å¤ªå¯èƒ½å‘ç”Ÿã€‚ZFS é€šè¿‡ `kstat.zfs.misc.zstd.compress_alloc_fail` ç»Ÿè®¡è‡ªåŠ è½½ ZFS æ¨¡å—ä»¥æ¥å‘ç”Ÿæ­¤æƒ…å†µçš„æ¬¡æ•°ã€‚­Deduplication¦å»é‡ÚWhen enabled, <<zfs-term-deduplication,deduplication>> uses the checksum of each block to detect duplicate blocks.  When a new block is a duplicate of an existing block, ZFS writes a new reference to the existing data instead of the whole duplicate block.  Tremendous space savings are possible if the data contains a lot of duplicated files or repeated information.  Warning: deduplication requires a large amount of memory, and enabling compression instead provides most of the space savings without the extra cost.Ú¿å½“å¯ç”¨æ—¶ï¼Œ<<zfs-term-deduplication,å»é‡ >> ä½¿ç”¨æ¯ä¸ªå—çš„æ ¡éªŒå’Œæ¥æ£€æµ‹é‡å¤å—ã€‚å½“ä¸€ä¸ªæ–°å—æ˜¯ç°æœ‰å—çš„å‰¯æœ¬æ—¶ï¼ŒZFS ä¼šå†™å…¥ä¸€ä¸ªå¯¹ç°æœ‰æ•°æ®çš„æ–°å¼•ç”¨ï¼Œè€Œä¸æ˜¯æ•´ä¸ªé‡å¤å—ã€‚å¦‚æœæ•°æ®åŒ…å«å¤§é‡é‡å¤çš„æ–‡ä»¶æˆ–é‡å¤çš„ä¿¡æ¯ï¼Œåˆ™å¯ä»¥å®ç°å·¨å¤§çš„ç©ºé—´èŠ‚çœã€‚è­¦å‘Šï¼šå»é‡éœ€è¦å¤§é‡çš„å†…å­˜ï¼Œå¹¶ä¸”å¯ç”¨å‹ç¼©å¯ä»¥åœ¨ä¸å¢åŠ é¢å¤–æˆæœ¬çš„æƒ…å†µä¸‹æä¾›å¤§éƒ¨åˆ†çš„ç©ºé—´èŠ‚çœã€‚ÙGTo activate deduplication, set the `dedup` property on the target pool:ÙBè¦æ¿€æ´»å»é‡åŠŸèƒ½ï¼Œè¯·åœ¨ç›®æ ‡æ± ä¸Šè®¾ç½® `dedup` å±æ€§ï¼šÙãDeduplicating only affects new data written to the pool.  Merely activating this option will not deduplicate data already written to the pool.  A pool with a freshly activated deduplication property will look like this example:Ùºå»é‡åªä¼šå½±å“å†™å…¥æ± ä¸­çš„æ–°æ•°æ®ã€‚ä»…ä»…æ¿€æ´»æ­¤é€‰é¡¹ä¸ä¼šå¯¹å·²ç»å†™å…¥æ± ä¸­çš„æ•°æ®è¿›è¡Œå»é‡ã€‚ä¸€ä¸ªåˆšåˆšæ¿€æ´»å»é‡å±æ€§çš„æ± å­å°†ä¼šåƒè¿™ä¸ªä¾‹å­ä¸€æ ·ï¼šÚThe `DEDUP` column shows the actual rate of deduplication for the pool.  A value of `1.00x` shows that data has not deduplicated yet.  The next example copies some system binaries three times into different directories on the deduplicated pool created above.Ùë`DEDUP` åˆ—æ˜¾ç¤ºäº†æ± çš„å®é™…é‡å¤æ¶ˆé™¤ç‡ã€‚`1.00x` çš„å€¼è¡¨ç¤ºæ•°æ®å°šæœªè¿›è¡Œé‡å¤æ¶ˆé™¤ã€‚ä¸‹é¢çš„ç¤ºä¾‹å°†ä¸€äº›ç³»ç»ŸäºŒè¿›åˆ¶æ–‡ä»¶å¤åˆ¶äº†ä¸‰æ¬¡ï¼Œåˆ†åˆ«æ”¾å…¥åœ¨ä¸Šè¿°åˆ›å»ºçš„é‡å¤æ¶ˆé™¤æ± ä¸­çš„ä¸åŒç›®å½•ä¸­ã€‚Ù0To observe deduplicating of redundant data, use:Ù-è¦è§‚å¯Ÿå†—ä½™æ•°æ®çš„å»é‡ï¼Œè¯·ä½¿ç”¨ï¼šÚThe `DEDUP` column shows a factor of `3.00x`.  Detecting and deduplicating copies of the data uses a third of the space.  The potential for space savings can be enormous, but comes at the cost of having enough memory to keep track of the deduplicated blocks.ÙÈ`DEDUP` åˆ—æ˜¾ç¤ºäº†ä¸€ä¸ª `3.00x` çš„å› å­ã€‚æ£€æµ‹å’Œå»é‡æ•°æ®çš„å‰¯æœ¬ä½¿ç”¨äº†ä¸‰åˆ†ä¹‹ä¸€çš„ç©ºé—´ã€‚èŠ‚çœç©ºé—´çš„æ½œåŠ›æ˜¯å·¨å¤§çš„ï¼Œä½†éœ€è¦è¶³å¤Ÿçš„å†…å­˜æ¥è·Ÿè¸ªå»é‡å—çš„æˆæœ¬ã€‚Ù§Deduplication is not always beneficial when the data in a pool is not redundant.  ZFS can show potential space savings by simulating deduplication on an existing pool:Ù‹å½“æ± ä¸­çš„æ•°æ®ä¸å†—ä½™æ—¶ï¼Œå»é‡å¹¶ä¸æ€»æ˜¯æœ‰ç›Šçš„ã€‚ZFS å¯ä»¥é€šè¿‡åœ¨ç°æœ‰æ± ä¸Šæ¨¡æ‹Ÿå»é‡æ¥æ˜¾ç¤ºæ½œåœ¨çš„èŠ‚çœç©ºé—´ã€‚ÚpAfter `zdb -S` finishes analyzing the pool, it shows the space reduction ratio that activating deduplication would achieve.  In this case, `1.16` is a poor space saving ratio mainly provided by compression.  Activating deduplication on this pool would not save any amount of space, and is not worth the amount of memory required to enable deduplication.  Using the formula _ratio = dedup * compress / copies_, system administrators can plan the storage allocation, deciding whether the workload will contain enough duplicate blocks to justify the memory requirements.  If the data is reasonably compressible, the space savings may be good.  Good practice is to enable compression first as compression also provides greatly increased performance.  Enable deduplication in cases where savings are considerable and with enough available memory for the <<zfs-term-deduplication,DDT>>.ÚÌåœ¨ `zdb -S` å®Œæˆåˆ†ææ± ä¹‹åï¼Œå®ƒä¼šæ˜¾ç¤ºæ¿€æ´»å»é‡å°†å®ç°çš„ç©ºé—´å‡å°‘æ¯”ä¾‹ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ `1.16` æ˜¯ä¸€ä¸ªä¸»è¦ç”±å‹ç¼©æä¾›çš„è¾ƒä½çš„èŠ‚çœç©ºé—´æ¯”ä¾‹ã€‚åœ¨æ­¤æ± ä¸Šæ¿€æ´»å»é‡å°†ä¸ä¼šèŠ‚çœä»»ä½•ç©ºé—´ï¼Œå¹¶ä¸”ä¸å€¼å¾—ä¸ºå¯ç”¨å»é‡æ‰€éœ€çš„å†…å­˜é‡ã€‚ä½¿ç”¨å…¬å¼ _ratio = dedup * compress / copies_ï¼Œç³»ç»Ÿç®¡ç†å‘˜å¯ä»¥è§„åˆ’å­˜å‚¨åˆ†é…ï¼Œå†³å®šå·¥ä½œè´Ÿè½½æ˜¯å¦åŒ…å«è¶³å¤Ÿçš„é‡å¤å—æ¥è¯æ˜å†…å­˜éœ€æ±‚çš„åˆç†æ€§ã€‚å¦‚æœæ•°æ®å¯ä»¥åˆç†å‹ç¼©ï¼Œç©ºé—´èŠ‚çœå¯èƒ½ä¼šå¾ˆå¥½ã€‚è‰¯å¥½çš„åšæ³•æ˜¯é¦–å…ˆå¯ç”¨å‹ç¼©ï¼Œå› ä¸ºå‹ç¼©è¿˜å¯ä»¥å¤§å¤§æé«˜æ€§èƒ½ã€‚åœ¨èŠ‚çœå¯è§‚ä¸”æœ‰è¶³å¤Ÿå¯ç”¨å†…å­˜ç”¨äº <<zfs-term-deduplication,DDT>> çš„æƒ…å†µä¸‹å¯ç”¨å»é‡ã€‚­ZFS and Jails­ZFS å’Œ JailsÚ™Use `zfs jail` and the corresponding `jailed` property to delegate a ZFS dataset to a crossref:jails[jails,Jail].  `zfs jail _jailid_` attaches a dataset to the specified jail, and `zfs unjail` detaches it.  To control the dataset from within a jail, set the `jailed` property.  ZFS forbids mounting a jailed dataset on the host because it may have mount points that would compromise the security of the host.ÚŸä½¿ç”¨ `zfs jail` å‘½ä»¤å’Œç›¸åº”çš„ `jailed` å±æ€§å°†ä¸€ä¸ª ZFS æ•°æ®é›†å§”æ´¾ç»™ä¸€ä¸ª crossref:jails[jails,jail]ã€‚ `zfs jail _jailid_` å‘½ä»¤å°†æ•°æ®é›†é™„åŠ åˆ°æŒ‡å®šçš„ jailï¼Œ`zfs unjail` å‘½ä»¤å°†å…¶åˆ†ç¦»ã€‚è¦åœ¨ jails å†…æ§åˆ¶æ•°æ®é›†ï¼Œéœ€è¦è®¾ç½® `jailed` å±æ€§ã€‚ç”±äºè¢« jailed çš„æ•°æ®é›†å¯èƒ½å…·æœ‰ä¼šå±åŠä¸»æœºå®‰å…¨çš„æŒ‚è½½ç‚¹ï¼ŒZFS ç¦æ­¢åœ¨ä¸»æœºä¸ŠæŒ‚è½½è¢« jailed çš„æ•°æ®é›†ã€‚¸Delegated Administration¬å§”æ´¾ç®¡ç†Ú8A comprehensive permission delegation system allows unprivileged users to perform ZFS administration functions.  For example, if each user's home directory is a dataset, users need permission to create and destroy snapshots of their home directories.  A user performing backups can get permission to use replication features.  ZFS allows a usage statistics script to run with access to only the space usage data for all users.  Delegating the ability to delegate permissions is also possible.  Permission delegation is possible for each subcommand and most properties.ÚÔä¸€ä¸ªå…¨é¢çš„æƒé™å§”æ´¾ç³»ç»Ÿå…è®¸éç‰¹æƒç”¨æˆ·æ‰§è¡Œ ZFS ç®¡ç†åŠŸèƒ½ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ¯ä¸ªç”¨æˆ·çš„ä¸»ç›®å½•æ˜¯ä¸€ä¸ªæ•°æ®é›†ï¼Œç”¨æˆ·éœ€è¦æœ‰æƒé™åˆ›å»ºå’Œé”€æ¯å…¶ä¸»ç›®å½•çš„å¿«ç…§ã€‚æ‰§è¡Œå¤‡ä»½çš„ç”¨æˆ·å¯ä»¥è·å¾—ä½¿ç”¨å¤åˆ¶åŠŸèƒ½çš„æƒé™ã€‚ZFS å…è®¸ä¸€ä¸ªä½¿ç”¨ç»Ÿè®¡è„šæœ¬ä»…ä»¥è®¿é—®æ‰€æœ‰ç”¨æˆ·çš„ç©ºé—´ä½¿ç”¨æ•°æ®çš„æ–¹å¼è¿è¡Œã€‚è¿˜å¯ä»¥å§”æ´¾å§”æ´¾æƒé™çš„èƒ½åŠ›ã€‚æƒé™å§”æ´¾å¯¹äºæ¯ä¸ªå­å‘½ä»¤å’Œå¤§å¤šæ•°å±æ€§éƒ½æ˜¯å¯èƒ½çš„ã€‚»Delegating Dataset Creationµå§”æ‰˜æ•°æ®é›†åˆ›å»ºÚ²`zfs allow _someuser_ create _mydataset_` gives the specified user permission to create child datasets under the selected parent dataset.  A caveat: creating a new dataset involves mounting it.  That requires setting the FreeBSD `vfs.usermount` man:sysctl[8] to `1` to allow non-root users to mount a file system.  Another restriction aimed at preventing abuse: non-`root` users must own the mountpoint where mounting the file system.Ú‰`zfs allow _someuser_ create _mydataset_` ç»™äºˆæŒ‡å®šç”¨æˆ·åœ¨é€‰å®šçš„çˆ¶æ•°æ®é›†ä¸‹åˆ›å»ºå­æ•°æ®é›†çš„æƒé™ã€‚ä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåˆ›å»ºæ–°æ•°æ®é›†éœ€è¦æŒ‚è½½å®ƒã€‚è¿™è¦æ±‚è®¾ç½® FreeBSD çš„ `vfs.usermount` ç³»ç»Ÿæ§åˆ¶å˜é‡ä¸º `1`ï¼Œä»¥å…è®¸é root ç”¨æˆ·æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿã€‚å¦å¤–ï¼Œä¸ºäº†é˜²æ­¢æ»¥ç”¨ï¼Œé root ç”¨æˆ·å¿…é¡»æ‹¥æœ‰æŒ‚è½½ç‚¹æ¥è¿›è¡Œæ–‡ä»¶ç³»ç»Ÿçš„æŒ‚è½½ã€‚Ù Delegating Permission Delegation²å§”æ´¾æƒé™å§”æ´¾Ú0`zfs allow _someuser_ allow _mydataset_` gives the specified user the ability to assign any permission they have on the target dataset, or its children, to other users.  If a user has the `snapshot` permission and the `allow` permission, that user can then grant the `snapshot` permission to other users.Ú"`zfs allow _someuser_ allow _mydataset_` å‘½ä»¤ä¼šèµ‹äºˆæŒ‡å®šç”¨æˆ·åœ¨ç›®æ ‡æ•°æ®é›†åŠå…¶å­æ•°æ®é›†ä¸Šåˆ†é…å…¶æ‹¥æœ‰çš„ä»»ä½•æƒé™ç»™å…¶ä»–ç”¨æˆ·çš„èƒ½åŠ›ã€‚å¦‚æœä¸€ä¸ªç”¨æˆ·æ‹¥æœ‰ `snapshot` æƒé™å’Œ `allow` æƒé™ï¼Œé‚£ä¹ˆè¯¥ç”¨æˆ·å¯ä»¥å°† `snapshot` æƒé™æˆäºˆå…¶ä»–ç”¨æˆ·ã€‚¯Advanced Topics¬é«˜çº§ä¸»é¢˜¦Tuning¦è°ƒä¼˜ÙAAdjust tunables to make ZFS perform best for different workloads.ÙJè°ƒæ•´å¯è°ƒèŠ‚å‚æ•°ä»¥ä½¿ ZFS åœ¨ä¸åŒçš„å·¥ä½œè´Ÿè½½ä¸‹è¡¨ç°æœ€ä½³ã€‚Ú°[[zfs-advanced-tuning-arc_max]] `_vfs.zfs.arc.max_` starting with 13.x (`vfs.zfs.arc_max` for 12.x) - Upper size of the <<zfs-term-arc,ARC>>. The default is all RAM but 1 GB, or 5/8 of all RAM, whichever is more. Use a lower value if the system runs any other daemons or processes that may require memory. Adjust this value at runtime with man:sysctl[8] and set it in [.filename]#/boot/loader.conf# or [.filename]#/etc/sysctl.conf#.ÚÈ[[zfs-advanced-tuning-arc_max]] `_vfs.zfs.arc.max_` ä» 13.x å¼€å§‹ï¼ˆ12.x ä¸º `vfs.zfs.arc_max`ï¼‰ - <<zfs-term-arc,ARC>> çš„ä¸Šé™å¤§å°ã€‚é»˜è®¤å€¼ä¸ºæ‰€æœ‰ RAM å‡å» 1 GB ï¼Œæˆ–æ‰€æœ‰ RAM çš„ 5/8 ï¼Œä»¥è¾ƒå¤§è€…ä¸ºå‡†ã€‚å¦‚æœç³»ç»Ÿè¿è¡Œå…¶ä»–å¯èƒ½éœ€è¦å†…å­˜çš„å®ˆæŠ¤ç¨‹åºæˆ–è¿›ç¨‹ï¼Œè¯·ä½¿ç”¨è¾ƒä½çš„å€¼ã€‚å¯ä»¥ä½¿ç”¨ man:sysctl[8] åœ¨è¿è¡Œæ—¶è°ƒæ•´æ­¤å€¼ï¼Œå¹¶åœ¨ [.filename]#/boot/loader.conf# æˆ– [.filename]#/etc/sysctl.conf# ä¸­è®¾ç½®ã€‚ÚG[[zfs-advanced-tuning-arc_meta_limit]] `_vfs.zfs.arc.meta_limit_` starting with 13.x (`vfs.zfs.arc_meta_limit` for 12.x)` - Limit the amount of the <<zfs-term-arc,ARC>> used to store metadata. The default is one fourth of `vfs.zfs.arc.max`. Increasing this value will improve performance if the workload involves operations on a large number of files and directories, or frequent metadata operations, at the cost of less file data fitting in the <<zfs-term-arc,ARC>>. Adjust this value at runtime with man:sysctl[8] in [.filename]#/boot/loader.conf# or [.filename]#/etc/sysctl.conf#.Ú.[[zfs-advanced-tuning-arc_meta_limit]] `_vfs.zfs.arc.meta_limit_` ä» 13.x ç‰ˆæœ¬å¼€å§‹ï¼ˆ12.x ç‰ˆæœ¬ä¸º `vfs.zfs.arc_meta_limit`ï¼‰ - é™åˆ¶ç”¨äºå­˜å‚¨å…ƒæ•°æ®çš„ <<zfs-term-arc,ARC>> çš„æ•°é‡ã€‚é»˜è®¤å€¼ä¸º `vfs.zfs.arc.max` çš„å››åˆ†ä¹‹ä¸€ã€‚å¦‚æœå·¥ä½œè´Ÿè½½æ¶‰åŠå¤§é‡æ–‡ä»¶å’Œç›®å½•çš„æ“ä½œï¼Œæˆ–è€…é¢‘ç¹çš„å…ƒæ•°æ®æ“ä½œï¼Œå¢åŠ æ­¤å€¼å°†æé«˜æ€§èƒ½ï¼Œä½†ä¼šå‡å°‘é€‚åº”äº <<zfs-term-arc,ARC>> çš„æ–‡ä»¶æ•°æ®é‡ã€‚å¯ä»¥ä½¿ç”¨ man:sysctl[8] åœ¨ [.filename]#/boot/loader.conf# æˆ– [.filename]#/etc/sysctl.conf# ä¸­åœ¨è¿è¡Œæ—¶è°ƒæ•´æ­¤å€¼ã€‚ÚŸ[[zfs-advanced-tuning-arc_min]] `_vfs.zfs.arc.min_` starting with 13.x (`vfs.zfs.arc_min` for 12.x) - Lower size of the <<zfs-term-arc,ARC>>. The default is one half of `vfs.zfs.arc.meta_limit`. Adjust this value to prevent other applications from pressuring out the entire <<zfs-term-arc,ARC>>. Adjust this value at runtime with man:sysctl[8] and in [.filename]#/boot/loader.conf# or [.filename]#/etc/sysctl.conf#.Ú¥[[zfs-advanced-tuning-arc_min]] `_vfs.zfs.arc.min_` ä» 13.x å¼€å§‹ï¼ˆ12.x ä¸º `vfs.zfs.arc_min`ï¼‰ - é™ä½ <<zfs-term-arc,ARC>> çš„å¤§å°ã€‚é»˜è®¤å€¼ä¸º `vfs.zfs.arc.meta_limit` çš„ä¸€åŠã€‚è°ƒæ•´æ­¤å€¼ä»¥é˜²æ­¢å…¶ä»–åº”ç”¨ç¨‹åºå°†æ•´ä¸ª <<zfs-term-arc,ARC>> å‹åŠ›è¿‡å¤§ã€‚å¯ä»¥ä½¿ç”¨ man:sysctl[8] åœ¨è¿è¡Œæ—¶è°ƒæ•´æ­¤å€¼ï¼Œå¹¶åœ¨ [.filename]#/boot/loader.conf# æˆ– [.filename]#/etc/sysctl.conf# ä¸­è¿›è¡Œè°ƒæ•´ã€‚Ú1[[zfs-advanced-tuning-vdev-cache-size]] `_vfs.zfs.vdev.cache.size_` - A preallocated amount of memory reserved as a cache for each device in the pool. The total amount of memory used will be this value multiplied by the number of devices. Set this value at boot time and in [.filename]#/boot/loader.conf#.Ú[[zfs-advanced-tuning-vdev-cache-size]] `_vfs.zfs.vdev.cache.size_` - åœ¨æ± ä¸­çš„æ¯ä¸ªè®¾å¤‡ä¸Šé¢„ç•™çš„ç”¨ä½œç¼“å­˜çš„å†…å­˜çš„é¢„åˆ†é…é‡ã€‚ä½¿ç”¨çš„æ€»å†…å­˜é‡å°†æ˜¯æ­¤å€¼ä¹˜ä»¥è®¾å¤‡æ•°é‡ã€‚åœ¨å¼•å¯¼æ—¶å’Œ [.filename]#/boot/loader.conf# ä¸­è®¾ç½®æ­¤å€¼ã€‚Ú{[[zfs-advanced-tuning-min-auto-ashift]] `_vfs.zfs.min_auto_ashift_` - Lower `ashift` (sector size) used automatically at pool creation time. The value is a power of two. The default value of `9` represents `2^9 = 512`, a sector size of 512 bytes. To avoid _write amplification_ and get the best performance, set this value to the largest sector size used by a device in the pool.ÚP[[zfs-advanced-tuning-min-auto-ashift]] `_vfs.zfs.min_auto_ashift_` - åœ¨åˆ›å»ºæ± æ—¶è‡ªåŠ¨ä½¿ç”¨çš„è¾ƒä½çš„ `ashift`ï¼ˆæ‰‡åŒºå¤§å°ï¼‰ã€‚è¯¥å€¼æ˜¯ 2 çš„å¹‚ã€‚é»˜è®¤å€¼ä¸º `9` è¡¨ç¤º `2^9 = 512` ï¼Œå³ 512 å­—èŠ‚çš„æ‰‡åŒºå¤§å°ã€‚ä¸ºäº†é¿å…å†™æ”¾å¤§å¹¶è·å¾—æœ€ä½³æ€§èƒ½ï¼Œå°†æ­¤å€¼è®¾ç½®ä¸ºæ± ä¸­è®¾å¤‡ä½¿ç”¨çš„æœ€å¤§æ‰‡åŒºå¤§å°ã€‚ÚCommon drives have 4 KB sectors.  Using the default `ashift` of `9` with these drives results in write amplification on these devices.  Data contained in a single 4 KB write is instead written in eight 512-byte writes.  ZFS tries to read the native sector size from all devices when creating a pool, but drives with 4 KB sectors report that their sectors are 512 bytes for compatibility.  Setting `vfs.zfs.min_auto_ashift` to `12` (`2^12 = 4096`) before creating a pool forces ZFS to use 4 KB blocks for best performance on these drives.Úæ™®é€šç¡¬ç›˜çš„æ‰‡åŒºå¤§å°ä¸º 4 KB ã€‚åœ¨è¿™äº›ç¡¬ç›˜ä¸Šä½¿ç”¨é»˜è®¤çš„ `ashift` å€¼ `9` ä¼šå¯¼è‡´å†™æ”¾å¤§ã€‚ä¸€ä¸ª 4 KB çš„å†™å…¥æ•°æ®å®é™…ä¸Šä¼šè¢«åˆ†æˆå…«ä¸ª 512 å­—èŠ‚çš„å†™å…¥æ“ä½œã€‚åœ¨åˆ›å»ºå­˜å‚¨æ± æ—¶ï¼ŒZFS ä¼šå°è¯•ä»æ‰€æœ‰è®¾å¤‡ä¸­è¯»å–åŸç”Ÿæ‰‡åŒºå¤§å°ï¼Œä½†æ˜¯å…·æœ‰ 4 KB æ‰‡åŒºçš„ç¡¬ç›˜ä¼šæŠ¥å‘Šå®ƒä»¬çš„æ‰‡åŒºå¤§å°ä¸º 512 å­—èŠ‚ï¼Œä»¥ä¿è¯å…¼å®¹æ€§ã€‚åœ¨åˆ›å»ºå­˜å‚¨æ± ä¹‹å‰ï¼Œå°† `vfs.zfs.min_auto_ashift` è®¾ç½®ä¸º `12`ï¼ˆ`2^12 = 4096`ï¼‰å¯ä»¥å¼ºåˆ¶ ZFS åœ¨è¿™äº›ç¡¬ç›˜ä¸Šä½¿ç”¨ 4 KB å—ä»¥è·å¾—æœ€ä½³æ€§èƒ½ã€‚Ù Forcing 4 KB blocks is also useful on pools with planned disk upgrades.  Future disks use 4 KB sectors, and `ashift` values cannot change after creating a pool.Ùµå¯¹äºè®¡åˆ’è¿›è¡Œç£ç›˜å‡çº§çš„å­˜å‚¨æ± æ¥è¯´ï¼Œå¼ºåˆ¶ä½¿ç”¨ 4 KB å—ä¹Ÿæ˜¯æœ‰ç”¨çš„ã€‚æœªæ¥çš„ç£ç›˜ä½¿ç”¨ 4 KB æ‰‡åŒºï¼Œå¹¶ä¸”åœ¨åˆ›å»ºå­˜å‚¨æ± åæ— æ³•æ›´æ”¹ `ashift` å€¼ã€‚ÚIn some specific cases, the smaller 512-byte block size might be preferable.  When used with 512-byte disks for databases or as storage for virtual machines, less data transfers during small random reads.  This can provide better performance when using a smaller ZFS record size.Úåœ¨æŸäº›ç‰¹å®šæƒ…å†µä¸‹ï¼Œè¾ƒå°çš„ 512 å­—èŠ‚å—å¤§å°å¯èƒ½æ›´å¯å–ã€‚å½“ä¸ç”¨äºæ•°æ®åº“æˆ–ä½œä¸ºè™šæ‹Ÿæœºå­˜å‚¨çš„ 512 å­—èŠ‚ç£ç›˜ä¸€èµ·ä½¿ç”¨æ—¶ï¼Œå°è§„æ¨¡éšæœºè¯»å–æ—¶çš„æ•°æ®ä¼ è¾“é‡è¾ƒå°‘ã€‚è¿™å¯ä»¥åœ¨ä½¿ç”¨è¾ƒå°çš„ ZFS è®°å½•å¤§å°æ—¶æä¾›æ›´å¥½çš„æ€§èƒ½ã€‚Úô[[zfs-advanced-tuning-prefetch_disable]] `_vfs.zfs.prefetch_disable_` - Disable prefetch. A value of `0` enables and `1` disables it. The default is `0`, unless the system has less than 4 GB of RAM. Prefetch works by reading larger blocks than requested into the <<zfs-term-arc,ARC>> in hopes to soon need the data. If the workload has a large number of random reads, disabling prefetch may actually improve performance by reducing unnecessary reads. Adjust this value at any time with man:sysctl[8].ÚÖ[[zfs-advanced-tuning-prefetch_disable]] `_vfs.zfs.prefetch_disable_` - ç¦ç”¨é¢„è¯»å–ã€‚å€¼ä¸º `0` è¡¨ç¤ºå¯ç”¨ï¼Œå€¼ä¸º `1` è¡¨ç¤ºç¦ç”¨ã€‚é»˜è®¤å€¼ä¸º `0`ï¼Œé™¤éç³»ç»Ÿå†…å­˜å°äº 4 GBã€‚é¢„è¯»å–é€šè¿‡è¯»å–æ¯”è¯·æ±‚çš„å—æ›´å¤§çš„å—åˆ° <<zfs-term-arc,ARC>> ä¸­ï¼Œå¸Œæœ›å¾ˆå¿«éœ€è¦è¿™äº›æ•°æ®ã€‚å¦‚æœå·¥ä½œè´Ÿè½½æœ‰å¤§é‡çš„éšæœºè¯»å–ï¼Œç¦ç”¨é¢„è¯»å–å¯èƒ½ä¼šé€šè¿‡å‡å°‘ä¸å¿…è¦çš„è¯»å–æ¥æé«˜æ€§èƒ½ã€‚å¯ä»¥éšæ—¶ä½¿ç”¨ man:sysctl[8] è°ƒæ•´æ­¤å€¼ã€‚Ú”[[zfs-advanced-tuning-vdev-trim_on_init]] `_vfs.zfs.vdev.trim_on_init_` - Control whether new devices added to the pool have the `TRIM` command run on them. This ensures the best performance and longevity for SSDs, but takes extra time. If the device has already been secure erased, disabling this setting will make the addition of the new device faster. Adjust this value at any time with man:sysctl[8].Ún[[zfs-advanced-tuning-vdev-trim_on_init]] `_vfs.zfs.vdev.trim_on_init_` - æ§åˆ¶æ˜¯å¦åœ¨å°†æ–°è®¾å¤‡æ·»åŠ åˆ°æ± ä¸­æ—¶å¯¹å…¶è¿è¡Œ `TRIM` å‘½ä»¤ã€‚è¿™å¯ä»¥ç¡®ä¿ SSD çš„æœ€ä½³æ€§èƒ½å’Œå¯¿å‘½ï¼Œä½†ä¼šèŠ±è´¹é¢å¤–çš„æ—¶é—´ã€‚å¦‚æœè®¾å¤‡å·²ç»è¿›è¡Œäº†å®‰å…¨æ“¦é™¤ï¼Œåˆ™ç¦ç”¨æ­¤è®¾ç½®å°†ä½¿æ–°è®¾å¤‡çš„æ·»åŠ æ›´å¿«ã€‚éšæ—¶å¯ä»¥ä½¿ç”¨ man:sysctl[8] è°ƒæ•´æ­¤å€¼ã€‚Ú([[zfs-advanced-tuning-vdev-max_pending]] `_vfs.zfs.vdev.max_pending_` - Limit the number of pending I/O requests per device. A higher value will keep the device command queue full and may give higher throughput. A lower value will reduce latency. Adjust this value at any time with man:sysctl[8].Ú[[zfs-advanced-tuning-vdev-max_pending]] `_vfs.zfs.vdev.max_pending_` - é™åˆ¶æ¯ä¸ªè®¾å¤‡çš„å¾…å¤„ç† I/O è¯·æ±‚çš„æ•°é‡ã€‚è¾ƒé«˜çš„å€¼å°†ä¿æŒè®¾å¤‡å‘½ä»¤é˜Ÿåˆ—æ»¡ï¼Œå¹¶å¯èƒ½æä¾›æ›´é«˜çš„ååé‡ã€‚è¾ƒä½çš„å€¼å°†å‡å°‘å»¶è¿Ÿã€‚æ‚¨å¯ä»¥éšæ—¶ä½¿ç”¨ man:sysctl[8] è°ƒæ•´æ­¤å€¼ã€‚Ú[[zfs-advanced-tuning-top_maxinflight]] `_vfs.zfs.top_maxinflight_` - Upper number of outstanding I/Os per top-level <<zfs-term-vdev,vdev>>. Limits the depth of the command queue to prevent high latency. The limit is per top-level vdev, meaning the limit applies to each <<zfs-term-vdev-mirror,mirror>>, <<zfs-term-vdev-raidz,RAID-Z>>, or other vdev independently. Adjust this value at any time with man:sysctl[8].Ú[[zfs-advanced-tuning-top_maxinflight]] `_vfs.zfs.top_maxinflight_` - æ¯ä¸ªé¡¶çº§ <<zfs-term-vdev,vdev>> çš„æœªå®Œæˆ I/O çš„ä¸Šé™ã€‚é™åˆ¶å‘½ä»¤é˜Ÿåˆ—çš„æ·±åº¦ä»¥é˜²æ­¢é«˜å»¶è¿Ÿã€‚è¯¥é™åˆ¶æ˜¯é’ˆå¯¹æ¯ä¸ªé¡¶çº§ vdev çš„ï¼Œæ„å‘³ç€è¯¥é™åˆ¶ç‹¬ç«‹åº”ç”¨äºæ¯ä¸ª <<zfs-term-vdev-mirror,é•œåƒ>> ã€ <<zfs-term-vdev-raidz,RAID-Z>> æˆ–å…¶ä»– vdev ã€‚å¯ä»¥éšæ—¶ä½¿ç”¨ man:sysctl[8] è°ƒæ•´æ­¤å€¼ã€‚Ú%[[zfs-advanced-tuning-l2arc_write_max]] `_vfs.zfs.l2arc_write_max_` - Limit the amount of data written to the <<zfs-term-l2arc,L2ARC>> per second. This tunable extends the longevity of SSDs by limiting the amount of data written to the device. Adjust this value at any time with man:sysctl[8].Ú [[zfs-advanced-tuning-l2arc_write_max]] `_vfs.zfs.l2arc_write_max_` - é™åˆ¶æ¯ç§’å†™å…¥ <<zfs-term-l2arc,L2ARC>> çš„æ•°æ®é‡ã€‚é€šè¿‡é™åˆ¶å†™å…¥è®¾å¤‡çš„æ•°æ®é‡ï¼Œæ­¤å¯è°ƒæ•´å‚æ•°å¯ä»¥å»¶é•¿å›ºæ€ç¡¬ç›˜ï¼ˆSSDï¼‰çš„ä½¿ç”¨å¯¿å‘½ã€‚æ‚¨å¯ä»¥éšæ—¶ä½¿ç”¨ man:sysctl[8] è°ƒæ•´æ­¤å€¼ã€‚Ú¸[[zfs-advanced-tuning-l2arc_write_boost]] `_vfs.zfs.l2arc_write_boost_` - Adds the value of this tunable to <<zfs-advanced-tuning-l2arc_write_max,`vfs.zfs.l2arc_write_max`>> and increases the write speed to the SSD until evicting the first block from the <<zfs-term-l2arc,L2ARC>>. This "Turbo Warmup Phase" reduces the performance loss from an empty <<zfs-term-l2arc,L2ARC>> after a reboot. Adjust this value at any time with man:sysctl[8].Ú£[[zfs-advanced-tuning-l2arc_write_boost]] `_vfs.zfs.l2arc_write_boost_` - å°†æ­¤å¯è°ƒæ•´å€¼æ·»åŠ åˆ° <<zfs-advanced-tuning-l2arc_write_max,`vfs.zfs.l2arc_write_max`>> ä¸­ï¼Œå¹¶å¢åŠ å¯¹ SSD çš„å†™å…¥é€Ÿåº¦ï¼Œç›´åˆ°ä» <<zfs-term-l2arc,L2ARC>> ä¸­é©±é€ç¬¬ä¸€ä¸ªå—ã€‚è¿™ä¸ª"Turbo Warmup Phase"å¯ä»¥å‡å°‘é‡å¯åç©ºçš„ <<zfs-term-l2arc,L2ARC>> å¸¦æ¥çš„æ€§èƒ½æŸå¤±ã€‚éšæ—¶å¯ä»¥ä½¿ç”¨ man:sysctl[8] è°ƒæ•´æ­¤å€¼ã€‚ÚŠ[[zfs-advanced-tuning-scrub_delay]]`_vfs.zfs.scrub_delay_` - Number of ticks to delay between each I/O during a <<zfs-term-scrub,`scrub`>>. To ensure that a `scrub` does not interfere with the normal operation of the pool, if any other I/O is happening the `scrub` will delay between each command. This value controls the limit on the total IOPS (I/Os Per Second) generated by the `scrub`. The granularity of the setting is determined by the value of `kern.hz` which defaults to 1000 ticks per second. Changing this setting results in a different effective IOPS limit.  The default value is `4`, resulting in a limit of: 1000 ticks/sec / 4 = 250 IOPS. Using a value of _20_ would give a limit of: 1000 ticks/sec / 20 = 50 IOPS. Recent activity on the pool limits the speed of `scrub`, as determined by <<zfs-advanced-tuning-scan_idle,`vfs.zfs.scan_idle`>>. Adjust this value at any time with man:sysctl[8].Ú[[zfs-advanced-tuning-scrub_delay]] `_vfs.zfs.scrub_delay_` - åœ¨è¿›è¡Œ <<zfs-term-scrub,`scrub`>> æ—¶ï¼Œæ¯ä¸ª I/O ä¹‹é—´çš„å»¶è¿Ÿæ—¶é—´ã€‚ä¸ºäº†ç¡®ä¿ `scrub` ä¸ä¼šå¹²æ‰°æ± çš„æ­£å¸¸æ“ä½œï¼Œå¦‚æœæœ‰å…¶ä»– I/O æ­£åœ¨è¿›è¡Œï¼Œ `scrub` ä¼šåœ¨æ¯ä¸ªå‘½ä»¤ä¹‹é—´è¿›è¡Œå»¶è¿Ÿã€‚è¯¥å€¼æ§åˆ¶äº† `scrub` ç”Ÿæˆçš„æ€» IOPSï¼ˆæ¯ç§’ I/O æ•°ï¼‰çš„é™åˆ¶ã€‚è®¾ç½®çš„ç²’åº¦ç”± `kern.hz` çš„å€¼ç¡®å®šï¼Œé»˜è®¤ä¸ºæ¯ç§’ 1000 ä¸ªæ»´ç­”ã€‚æ›´æ”¹æ­¤è®¾ç½®ä¼šå¯¼è‡´ä¸åŒçš„æœ‰æ•ˆ IOPS é™åˆ¶ã€‚é»˜è®¤å€¼ä¸º `4` ï¼Œå› æ­¤é™åˆ¶ä¸ºï¼š 1000 ä¸ªæ»´ç­”/ç§’ Ã· 4 = 250 IOPS ã€‚ä½¿ç”¨å€¼ä¸º _20_ å°†å¾—åˆ°é™åˆ¶ï¼š1000 ä¸ªæ»´ç­”/ç§’ Ã· 20 = 50 IOPSã€‚æ± ä¸Šçš„æœ€è¿‘æ´»åŠ¨é™åˆ¶äº† `scrub` çš„é€Ÿåº¦ï¼Œç”± <<zfs-advanced-tuning-scan_idle,`vfs.zfs.scan_idle`>> ç¡®å®šã€‚éšæ—¶å¯ä»¥ä½¿ç”¨ man:sysctl[8] è°ƒæ•´æ­¤å€¼ã€‚Úw[[zfs-advanced-tuning-resilver_delay]] `_vfs.zfs.resilver_delay_` - Number of milliseconds of delay inserted between each I/O during a <<zfs-term-resilver,resilver>>. To ensure that a resilver does not interfere with the normal operation of the pool, if any other I/O is happening the resilver will delay between each command. This value controls the limit of total IOPS (I/Os Per Second) generated by the resilver. ZFS determins the granularity of the setting by the value of `kern.hz` which defaults to 1000 ticks per second. Changing this setting results in a different effective IOPS limit. The default value is 2, resulting in a limit of: 1000 ticks/sec / 2 = 500 IOPS. Returning the pool to an <<zfs-term-online,Online>> state may be more important if another device failing could <<zfs-term-faulted,Fault>> the pool, causing data loss. A value of 0 will give the resilver operation the same priority as other operations, speeding the healing process. Other recent activity on the pool limits the speed of resilver, as determined by <<zfs-advanced-tuning-scan_idle,`vfs.zfs.scan_idle`>>. Adjust this value at any time with man:sysctl[8].Úó[[zfs-advanced-tuning-resilver_delay]] `_vfs.zfs.resilver_delay_` - åœ¨ <<zfs-term-resilver,é‡å»º>> è¿‡ç¨‹ä¸­ï¼Œæ¯ä¸ª I/O ä¹‹é—´æ’å…¥çš„å»¶è¿Ÿæ—¶é—´ï¼Œä»¥æ¯«ç§’ä¸ºå•ä½ã€‚ä¸ºäº†ç¡®ä¿ resilver ä¸ä¼šå¹²æ‰°æ± çš„æ­£å¸¸æ“ä½œï¼Œå¦‚æœæœ‰å…¶ä»– I/O æ­£åœ¨è¿›è¡Œï¼Œresilver å°†åœ¨æ¯ä¸ªå‘½ä»¤ä¹‹é—´å»¶è¿Ÿã€‚è¯¥å€¼æ§åˆ¶ç”± resilver ç”Ÿæˆçš„æ€» IOPSï¼ˆæ¯ç§’ I/O æ•°ï¼‰çš„é™åˆ¶ã€‚ZFS é€šè¿‡ `kern.hz` çš„å€¼ç¡®å®šè®¾ç½®çš„ç²’åº¦ï¼Œé»˜è®¤ä¸ºæ¯ç§’ 1000 ä¸ªæ»´ç­”ã€‚æ›´æ”¹æ­¤è®¾ç½®ä¼šå¯¼è‡´ä¸åŒçš„æœ‰æ•ˆ IOPS é™åˆ¶ã€‚é»˜è®¤å€¼ä¸º 2 ï¼Œç»“æœä¸ºï¼š1000 ä¸ªæ»´ç­”/ç§’ Ã· 2 = 500 IOPS ã€‚å¦‚æœå¦ä¸€ä¸ªè®¾å¤‡æ•…éšœå¯èƒ½å¯¼è‡´æ± å‘ç”Ÿæ•…éšœï¼Œä»è€Œå¯¼è‡´æ•°æ®ä¸¢å¤±ï¼Œåˆ™å°†æ± æ¢å¤åˆ° <<zfs-term-online,åœ¨çº¿>> çŠ¶æ€å¯èƒ½æ›´ä¸ºé‡è¦ã€‚å€¼ä¸º 0 å°†ä½¿ resilver æ“ä½œä¸å…¶ä»–æ“ä½œå…·æœ‰ç›¸åŒçš„ä¼˜å…ˆçº§ï¼ŒåŠ å¿«ä¿®å¤è¿‡ç¨‹ã€‚æ± ä¸Šçš„å…¶ä»–æœ€è¿‘æ´»åŠ¨ä¼šé™åˆ¶ resilver çš„é€Ÿåº¦ï¼Œç”± <<zfs-advanced-tuning-scan_idle,`vfs.zfs.scan_idle`>> ç¡®å®šã€‚éšæ—¶å¯ä»¥ä½¿ç”¨ man:sysctl[8] è°ƒæ•´æ­¤å€¼ã€‚Ú8[[zfs-advanced-tuning-scan_idle]] `_vfs.zfs.scan_idle_` - Number of milliseconds since the last operation before considering the pool is idle. ZFS disables the rate limiting for <<zfs-term-scrub,`scrub`>> and <<zfs-term-resilver,resilver>> when the pool is idle. Adjust this value at any time with man:sysctl[8].Ú6[[zfs-advanced-tuning-scan_idle]] `_vfs.zfs.scan_idle_` - è·ç¦»ä¸Šæ¬¡æ“ä½œçš„æ¯«ç§’æ•°ï¼Œç”¨äºåˆ¤æ–­æ± æ˜¯å¦å¤„äºç©ºé—²çŠ¶æ€ã€‚å½“æ± å¤„äºç©ºé—²çŠ¶æ€æ—¶ï¼Œ ZFS ä¼šç¦ç”¨å¯¹ <<zfs-term-scrub,`scrub`>> å’Œ <<zfs-term-resilver,é‡å»º>> çš„é€Ÿç‡é™åˆ¶ã€‚æ‚¨å¯ä»¥éšæ—¶ä½¿ç”¨ man:sysctl[8] è°ƒæ•´æ­¤å€¼ã€‚ÚF[[zfs-advanced-tuning-txg-timeout]] `_vfs.zfs.txg.timeout_` - Upper number of seconds between <<zfs-term-txg,transaction group>>s. The current transaction group writes to the pool and a fresh transaction group starts if this amount of time elapsed since the previous transaction group. A transaction group may trigger earlier if writing enough data. The default value is 5 seconds. A larger value may improve read performance by delaying asynchronous writes, but this may cause uneven performance when writing the transaction group. Adjust this value at any time with man:sysctl[8].Úÿ`_vfs.zfs.txg.timeout_` - ä¸¤ä¸ª <<zfs-term-txg,äº‹åŠ¡ç»„ >> ä¹‹é—´çš„æœ€é•¿æ—¶é—´é—´éš”ï¼Œä»¥ç§’ä¸ºå•ä½ã€‚å½“å‰äº‹åŠ¡ç»„å°†æ•°æ®å†™å…¥æ± ä¸­ï¼Œå¹¶ä¸”å¦‚æœè‡ªä¸Šä¸€ä¸ªäº‹åŠ¡ç»„ä»¥æ¥ç»è¿‡äº†è¿™ä¹ˆé•¿æ—¶é—´ï¼Œåˆ™ä¼šå¯åŠ¨ä¸€ä¸ªæ–°çš„äº‹åŠ¡ç»„ã€‚å¦‚æœå†™å…¥çš„æ•°æ®è¶³å¤Ÿå¤šï¼Œäº‹åŠ¡ç»„å¯èƒ½ä¼šæå‰è§¦å‘ã€‚é»˜è®¤å€¼ä¸º 5 ç§’ã€‚å¢å¤§è¯¥å€¼å¯èƒ½ä¼šé€šè¿‡å»¶è¿Ÿå¼‚æ­¥å†™å…¥æ¥æé«˜è¯»å–æ€§èƒ½ï¼Œä½†è¿™å¯èƒ½ä¼šå¯¼è‡´å†™å…¥äº‹åŠ¡ç»„æ—¶æ€§èƒ½ä¸å‡è¡¡ã€‚å¯ä»¥éšæ—¶ä½¿ç”¨ man:sysctl[8] è°ƒæ•´æ­¤å€¼ã€‚«ZFS on i386¯i386 ä¸Šçš„ ZFSÙƒSome of the features provided by ZFS are memory intensive, and may require tuning for upper efficiency on systems with limited RAM.Ù|ZFS æä¾›çš„ä¸€äº›åŠŸèƒ½å¯¹å†…å­˜è¦æ±‚è¾ƒé«˜ï¼Œå¯èƒ½éœ€è¦åœ¨å†…å­˜æœ‰é™çš„ç³»ç»Ÿä¸Šè¿›è¡Œè°ƒæ•´ä»¥è¾¾åˆ°æœ€ä½³æ•ˆç‡ã€‚¦Memory¦å†…å­˜ÚAs a lower value, the total system memory should be at least one gigabyte.  The amount of recommended RAM depends upon the size of the pool and which features ZFS uses.  A general rule of thumb is 1 GB of RAM for every 1 TB of storage.  If using the deduplication feature, a general rule of thumb is 5 GB of RAM per TB of storage to deduplicate.  While some users use ZFS with less RAM, systems under heavy load may panic due to memory exhaustion.  ZFS may require further tuning for systems with less than the recommended RAM requirements.Úóä½œä¸ºä¸€ä¸ªè¾ƒä½çš„å€¼ï¼Œæ€»ç³»ç»Ÿå†…å­˜åº”è‡³å°‘ä¸º 1GB ã€‚æ¨èçš„ RAM æ•°é‡å–å†³äºå­˜å‚¨æ± çš„å¤§å°å’Œ ZFS ä½¿ç”¨çš„åŠŸèƒ½ã€‚ä¸€ä¸ªç»éªŒæ³•åˆ™æ˜¯æ¯ 1TB å­˜å‚¨ç©ºé—´éœ€è¦ 1GB çš„ RAM ã€‚å¦‚æœä½¿ç”¨å»é‡åŠŸèƒ½ï¼Œä¸€ä¸ªç»éªŒæ³•åˆ™æ˜¯æ¯ 1TB å­˜å‚¨ç©ºé—´éœ€è¦ 5GB çš„ RAM ç”¨äºå»é‡ã€‚è™½ç„¶ä¸€äº›ç”¨æˆ·åœ¨è¾ƒå°‘çš„ RAM ä¸‹ä½¿ç”¨ ZFSï¼Œä½†åœ¨è´Ÿè½½è¾ƒé‡çš„ç³»ç»Ÿä¸‹å¯èƒ½ä¼šå› å†…å­˜è€—å°½è€Œå‘ç”Ÿå´©æºƒã€‚å¯¹äº RAM ä½äºæ¨èè¦æ±‚çš„ç³»ç»Ÿï¼Œå¯èƒ½éœ€è¦è¿›ä¸€æ­¥è°ƒæ•´ ZFS ã€‚´Kernel Configuration¬å†…æ ¸é…ç½®ÙÁDue to the address space limitations of the i386(TM) platform, ZFS users on the i386(TM) architecture must add this option to a custom kernel configuration file, rebuild the kernel, and reboot:Ù¯ç”±äº i386(TM) å¹³å°çš„åœ°å€ç©ºé—´é™åˆ¶ï¼Œ i386(TM) æ¶æ„ä¸Šçš„ ZFS ç”¨æˆ·å¿…é¡»å°†æ­¤é€‰é¡¹æ·»åŠ åˆ°è‡ªå®šä¹‰å†…æ ¸é…ç½®æ–‡ä»¶ä¸­ï¼Œé‡æ–°æ„å»ºå†…æ ¸å¹¶é‡æ–°å¯åŠ¨ï¼šÚThis expands the kernel address space, allowing the `vm.kvm_size` tunable to push beyond the imposed limit of 1 GB, or the limit of 2 GB for PAE.  To find the most suitable value for this option, divide the desired address space in megabytes by four.  In this example `512` for 2 GB.Úè¿™å°†æ‰©å±•å†…æ ¸åœ°å€ç©ºé—´ï¼Œå…è®¸ `vm.kvm_size` å¯è°ƒå‚æ•°è¶…è¿‡ 1 GB çš„é™åˆ¶ï¼Œæˆ–è€…è¶…è¿‡ PAE çš„ 2 GB é™åˆ¶ã€‚ä¸ºäº†æ‰¾åˆ°æœ€åˆé€‚çš„é€‰é¡¹å€¼ï¼Œå°†æ‰€éœ€çš„åœ°å€ç©ºé—´ä»¥å…†å­—èŠ‚ä¸ºå•ä½é™¤ä»¥å››ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œä¸º 2 GB é€‰æ‹© `512`ã€‚¯Loader TunablesµåŠ è½½å™¨å¯è°ƒå‚æ•°ÙÓIncreases the [.filename]#kmem# address space on all FreeBSD architectures.  A test system with 1 GB of physical memory benefitted from adding these options to [.filename]#/boot/loader.conf# and then restarting:ÙÌåœ¨æ‰€æœ‰ FreeBSD æ¶æ„ä¸Šå¢åŠ äº† [.filename]#kmem# åœ°å€ç©ºé—´ã€‚ä¸€ä¸ªå…·æœ‰ 1 GB ç‰©ç†å†…å­˜çš„æµ‹è¯•ç³»ç»Ÿé€šè¿‡å°†è¿™äº›é€‰é¡¹æ·»åŠ åˆ° [.filename]#/boot/loader.conf# å¹¶é‡æ–°å¯åŠ¨æ¥å—ç›Šã€‚ÙrFor a more detailed list of recommendations for ZFS-related tuning, see https://wiki.freebsd.org/ZFSTuningGuide[].Ùiæœ‰å…³ ZFS ç›¸å…³è°ƒä¼˜çš„æ›´è¯¦ç»†å»ºè®®åˆ—è¡¨ï¼Œè¯·å‚é˜… https://wiki.freebsd.org/ZFSTuningGuide[] ã€‚±Further Resources¯è¿›ä¸€æ­¥èµ„æº½https://openzfs.org/[OpenZFS]½https://openzfs.org/[OpenZFS]ÙBhttps://wiki.freebsd.org/ZFSTuningGuide[FreeBSD Wiki - ZFS Tuning]ÙBhttps://wiki.freebsd.org/ZFSTuningGuide[FreeBSD Wiki - ZFS è°ƒä¼˜]Ùnhttps://calomel.org/zfs_raid_speed_capacity.html[Calomel Blog - ZFS Raidz Performance, Capacity and Integrity]Ùhhttps://calomel.org/zfs_raid_speed_capacity.html[Calomel åšå®¢ - ZFS Raidz æ€§èƒ½ã€å®¹é‡å’Œå®Œæ•´æ€§]¼ZFS Features and Terminology³ZFS åŠŸèƒ½å’Œæœ¯è¯­Ú;More than a file system, ZFS is fundamentally different.  ZFS combines the roles of file system and volume manager, enabling new storage devices to add to a live system and having the new space available on the existing file systems in that pool at once.  By combining the traditionally separate roles, ZFS is able to overcome previous limitations that prevented RAID groups being able to grow.  A _vdev_ is a top level device in a pool and can be a simple disk or a RAID transformation such as a mirror or RAID-Z array.  ZFS file systems (called _datasets_) each have access to the combined free space of the entire pool.  Used blocks from the pool decrease the space available to each file system.  This approach avoids the common pitfall with extensive partitioning where free space becomes fragmented across the partitions.ÚÓZFS ä¸ä»…ä»…æ˜¯ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œå®ƒåœ¨æ ¹æœ¬ä¸Šæ˜¯ä¸åŒçš„ã€‚ZFS å°†æ–‡ä»¶ç³»ç»Ÿå’Œå·ç®¡ç†å™¨çš„è§’è‰²ç»“åˆåœ¨ä¸€èµ·ï¼Œä½¿æ–°çš„å­˜å‚¨è®¾å¤‡èƒ½å¤Ÿæ·»åŠ åˆ°æ´»åŠ¨ç³»ç»Ÿä¸­ï¼Œå¹¶ä¸”æ–°çš„ç©ºé—´å¯ä»¥ç«‹å³åœ¨è¯¥æ± ä¸­çš„ç°æœ‰æ–‡ä»¶ç³»ç»Ÿä¸Šä½¿ç”¨ã€‚é€šè¿‡ç»“åˆä¼ ç»Ÿä¸Šåˆ†å¼€çš„è§’è‰²ï¼Œ ZFS èƒ½å¤Ÿå…‹æœä»¥å‰é˜»æ­¢ RAID ç»„èƒ½å¤Ÿå¢é•¿çš„é™åˆ¶ã€‚_vdev_ æ˜¯æ± ä¸­çš„é¡¶çº§è®¾å¤‡ï¼Œå¯ä»¥æ˜¯ç®€å•çš„ç£ç›˜æˆ– RAID è½¬æ¢ï¼Œå¦‚é•œåƒæˆ– RAID-Z é˜µåˆ—ã€‚ ZFS æ–‡ä»¶ç³»ç»Ÿï¼ˆç§°ä¸º _datasets_ ï¼‰æ¯ä¸ªéƒ½å¯ä»¥è®¿é—®æ•´ä¸ªæ± çš„åˆå¹¶ç©ºé—²ç©ºé—´ã€‚æ± ä¸­ä½¿ç”¨çš„å—ä¼šå‡å°‘æ¯ä¸ªæ–‡ä»¶ç³»ç»Ÿå¯ç”¨çš„ç©ºé—´ã€‚è¿™ç§æ–¹æ³•é¿å…äº†å¹¿æ³›åˆ†åŒºä¸­å¸¸è§çš„é—®é¢˜ï¼Œå³ç©ºé—²ç©ºé—´åœ¨åˆ†åŒºä¹‹é—´å˜å¾—ç¢ç‰‡åŒ–ã€‚µ[[zfs-term-pool]]pool¿[[zfs-term-pool]] æ± ï¼ˆpoolï¼‰Ú©A storage _pool_ is the most basic building block of ZFS. A pool consists of one or more vdevs, the underlying devices that store the data. A pool is then used to create one or more file systems (datasets) or block devices (volumes).
These datasets and volumes share the pool of remaining free space. Each pool is uniquely identified by a name and a GUID. The ZFS version number on the pool determines the features available.Ú‘å­˜å‚¨æ± æ˜¯ ZFS çš„æœ€åŸºæœ¬æ„å»ºå—ã€‚ä¸€ä¸ªå­˜å‚¨æ± ç”±ä¸€ä¸ªæˆ–å¤šä¸ª vdev ç»„æˆï¼Œ vdev æ˜¯å­˜å‚¨æ•°æ®çš„åº•å±‚è®¾å¤‡ã€‚ç„¶åä½¿ç”¨å­˜å‚¨æ± æ¥åˆ›å»ºä¸€ä¸ªæˆ–å¤šä¸ªæ–‡ä»¶ç³»ç»Ÿï¼ˆæ•°æ®é›†ï¼‰æˆ–å—è®¾å¤‡ï¼ˆå·ï¼‰ã€‚
è¿™äº›æ•°æ®é›†å’Œå·å…±äº«å‰©ä½™çš„è‡ªç”±ç©ºé—´ã€‚æ¯ä¸ªå­˜å‚¨æ± éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„åç§°å’Œ GUID æ¥è¿›è¡Œæ ‡è¯†ã€‚å­˜å‚¨æ± ä¸Šçš„ ZFS ç‰ˆæœ¬å·å†³å®šäº†å¯ç”¨çš„åŠŸèƒ½ã€‚»[[zfs-term-vdev]]vdev Types¼[[zfs-term-vdev]]vdev ç±»å‹ÚA pool consists of one or more vdevs, which themselves are a single disk or a group of disks, transformed to a RAID. When using a lot of vdevs, ZFS spreads data across the vdevs to increase performance and maximize usable space. All vdevs must be at least 128 MB in size. 

* [[zfs-term-vdev-disk]] _Disk_ - The most basic vdev type is a standard block device. This can be an entire disk (such as [.filename]#/dev/ada0# or [.filename]#/dev/da0#) or a partition ([.filename]#/dev/ada0p3#). On FreeBSD, there is no performance penalty for using a partition rather than the entire disk. This differs from recommendations made by the Solaris documentation.
+
[CAUTION]
====
Using an entire disk as part of a bootable pool is strongly discouraged, as this may render the pool unbootable.
Likewise, you should not use an entire disk as part of a mirror or RAID-Z vdev.
Reliably determining the size of an unpartitioned disk at boot time is impossible and there's no place to put in boot code.
====

* [[zfs-term-vdev-file]] _File_ - Regular files may make up ZFS pools, which is useful for testing and experimentation. Use the full path to the file as the device path in `zpool create`.
* [[zfs-term-vdev-mirror]] _Mirror_ - When creating a mirror, specify the `mirror` keyword followed by the list of member devices for the mirror. A mirror consists of two or more devices, writing all data to all member devices. A mirror vdev will hold as much data as its smallest member. A mirror vdev can withstand the failure of all but one of its members without losing any data.
+
[NOTE]
====
To upgrade a regular single disk vdev to a mirror vdev at any time, use `zpool <<zfs-zpool-attach,attach>>`.
====

* [[zfs-term-vdev-raidz]] _RAID-Z_ - ZFS uses RAID-Z, a variation on standard RAID-5 that offers better distribution of parity and eliminates the "RAID-5 write hole" in which the data and parity information become inconsistent after an unexpected restart. ZFS supports three levels of RAID-Z which provide varying levels of redundancy in exchange for decreasing levels of usable storage. ZFS uses RAID-Z1 through RAID-Z3 based on the number of parity devices in the array and the number of disks which can fail before the pool stops  being operational.
+
In a RAID-Z1 configuration with four disks, each 1 TB, usable storage is 3 TB and the pool will still be able to operate in degraded mode with one faulted disk. If another disk goes offline before replacing and resilvering the faulted disk would result in losing all pool data.
+
In a RAID-Z3 configuration with eight disks of 1 TB, the volume will provide 5 TB of usable space and still be able to operate with three faulted disks. Sun(TM) recommends no more than nine disks in a single vdev. If more disks make up the configuration, the recommendation is to divide them into separate vdevs and stripe the pool data across them.
+
A configuration of two RAID-Z2 vdevs consisting of 8 disks each would create something like a RAID-60 array. A RAID-Z group's storage capacity is about the size of the smallest disk multiplied by the number of non-parity disks. Four 1 TB disks in RAID-Z1 has an effective size of about 3 TB, and an array of eight 1 TB disks in RAID-Z3 will yield 5 TB of usable space.
* [[zfs-term-vdev-spare]] _Spare_ - ZFS has a special pseudo-vdev type for keeping track of available hot spares. Note that installed hot spares are not deployed automatically; manually configure them to replace the failed device using `zfs replace`.
* [[zfs-term-vdev-log]] _Log_ - ZFS Log Devices, also known as ZFS Intent Log (<<zfs-term-zil,ZIL>>) move the intent log from the regular pool devices to a dedicated device, typically an SSD. Having a dedicated log device improves the performance of applications with a high volume of synchronous writes like databases. Mirroring of log devices is possible, but RAID-Z is not supported. If using a lot of log devices, writes will be load-balanced across them.
* [[zfs-term-vdev-cache]] _Cache_ - Adding a cache vdev to a pool will add the storage of the cache to the <<zfs-term-l2arc,L2ARC>>. Mirroring cache devices is impossible. Since a cache device stores only new copies of existing data, there is no risk of data loss.ÚKä¸€ä¸ªæ± ç”±ä¸€ä¸ªæˆ–å¤šä¸ª vdev ç»„æˆï¼Œå®ƒä»¬æœ¬èº«æ˜¯ä¸€ä¸ªå•ç‹¬çš„ç£ç›˜æˆ–ä¸€ç»„ç£ç›˜ï¼Œè½¬æ¢ä¸º RAID ã€‚å½“ä½¿ç”¨å¤§é‡çš„ vdev æ—¶ï¼Œ ZFS ä¼šå°†æ•°æ®åˆ†æ•£åœ¨ vdev ä¸Šï¼Œä»¥æé«˜æ€§èƒ½å’Œæœ€å¤§åŒ–å¯ç”¨ç©ºé—´ã€‚æ‰€æœ‰çš„ vdev éƒ½å¿…é¡»è‡³å°‘ 128MB å¤§å°ã€‚

 * [[zfs-term-vdev-disk]] _ç£ç›˜ï¼ˆDiskï¼‰_ - æœ€åŸºæœ¬çš„ vdev ç±»å‹æ˜¯æ ‡å‡†å—è®¾å¤‡ã€‚è¿™å¯ä»¥æ˜¯æ•´ä¸ªç£ç›˜ï¼ˆå¦‚ [.filename]#/dev/ada0# æˆ– [.filename]#/dev/da0#ï¼‰æˆ–ä¸€ä¸ªåˆ†åŒºï¼ˆ[.filename]#/dev/ada0p3#ï¼‰ã€‚åœ¨ FreeBSD ä¸Šï¼Œä½¿ç”¨åˆ†åŒºè€Œä¸æ˜¯æ•´ä¸ªç£ç›˜ä¸ä¼šæœ‰æ€§èƒ½æŸå¤±ã€‚è¿™ä¸ Solaris æ–‡æ¡£çš„å»ºè®®ä¸åŒã€‚
+
[CAUTION]
====
å¼ºçƒˆä¸å»ºè®®å°†æ•´ä¸ªç£ç›˜ä½œä¸ºå¯å¼•å¯¼æ± çš„ä¸€éƒ¨åˆ†ï¼Œå› ä¸ºè¿™å¯èƒ½å¯¼è‡´æ± æ— æ³•å¼•å¯¼ã€‚
åŒæ ·ï¼Œæ‚¨ä¸åº”å°†æ•´ä¸ªç£ç›˜ç”¨ä½œé•œåƒæˆ– RAID-Z vdev çš„ä¸€éƒ¨åˆ†ã€‚
åœ¨å¼•å¯¼æ—¶å¯é åœ°ç¡®å®šæœªåˆ†åŒºç£ç›˜çš„å¤§å°æ˜¯ä¸å¯èƒ½çš„ï¼Œä¹Ÿæ²¡æœ‰åœ°æ–¹æ”¾ç½®å¼•å¯¼ä»£ç ã€‚
====

 * [[zfs-term-vdev-file]] _æ–‡ä»¶ï¼ˆFileï¼‰_ - æ™®é€šæ–‡ä»¶å¯ä»¥ç»„æˆ ZFS æ± ï¼Œè¿™å¯¹äºæµ‹è¯•å’Œå®éªŒå¾ˆæœ‰ç”¨ã€‚åœ¨ `zpool create` ä¸­ï¼Œä½¿ç”¨æ–‡ä»¶çš„å®Œæ•´è·¯å¾„ä½œä¸ºè®¾å¤‡è·¯å¾„ã€‚
 * [[zfs-term-vdev-mirror]] _é•œåƒï¼ˆMirrorï¼‰_ - åˆ›å»ºé•œåƒæ—¶ï¼Œä½¿ç”¨ `mirror` å…³é”®å­—åè·Ÿé•œåƒçš„æˆå‘˜è®¾å¤‡åˆ—è¡¨ã€‚é•œåƒç”±ä¸¤ä¸ªæˆ–æ›´å¤šè®¾å¤‡ç»„æˆï¼Œå°†æ‰€æœ‰æ•°æ®å†™å…¥æ‰€æœ‰æˆå‘˜è®¾å¤‡ã€‚é•œåƒ vdev å°†ä¿å­˜ä¸å…¶æœ€å°æˆå‘˜ç›¸åŒçš„æ•°æ®é‡ã€‚é•œåƒ vdev å¯ä»¥æ‰¿å—é™¤ä¸€ä¸ªæˆå‘˜å¤–çš„æ‰€æœ‰æˆå‘˜æ•…éšœè€Œä¸ä¸¢å¤±ä»»ä½•æ•°æ®ã€‚
+
[NOTE]
====
è¦éšæ—¶å°†å¸¸è§„å•ç£ç›˜ vdev å‡çº§ä¸ºé•œåƒ vdevï¼Œè¯·ä½¿ç”¨ `zpool <<zfs-zpool-attach, attach>>`ã€‚
====

 * [[zfs-term-vdev-raidz]] _RAID-Z_ - ZFS ä½¿ç”¨ RAID-Z ï¼Œè¿™æ˜¯æ ‡å‡† RAID-5 çš„å˜ç§ï¼Œæä¾›æ›´å¥½çš„å¥‡å¶æ ¡éªŒåˆ†å¸ƒï¼Œå¹¶æ¶ˆé™¤äº†â€œRAID-5 å†™å…¥æ¼æ´â€ï¼Œå³åœ¨æ„å¤–é‡å¯åæ•°æ®å’Œå¥‡å¶æ ¡éªŒä¿¡æ¯å˜å¾—ä¸ä¸€è‡´çš„é—®é¢˜ã€‚ ZFS æ”¯æŒä¸‰ä¸ªçº§åˆ«çš„ RAID-Z ï¼Œå®ƒä»¬åœ¨æä¾›ä¸åŒçš„å†—ä½™çº§åˆ«çš„åŒæ—¶é™ä½å¯ç”¨å­˜å‚¨çº§åˆ«ã€‚ZFS ä½¿ç”¨åŸºäºé˜µåˆ—ä¸­å¥‡å¶æ ¡éªŒè®¾å¤‡æ•°é‡å’Œå¯ä»¥æ•…éšœçš„ç£ç›˜æ•°é‡çš„ RAID-Z1 åˆ° RAID-Z3 ã€‚
+
åœ¨ä¸€ä¸ªç”±å››ä¸ª 1TB ç£ç›˜ç»„æˆçš„ RAID-Z1 é…ç½®ä¸­ï¼Œå¯ç”¨å­˜å‚¨ç©ºé—´ä¸º 3TB ï¼Œå¹¶ä¸”æ± ä»èƒ½åœ¨ä¸€ä¸ªæ•…éšœç£ç›˜çš„é™çº§æ¨¡å¼ä¸‹è¿è¡Œã€‚å¦‚æœåœ¨æ›¿æ¢å’Œé‡æ–°åŒæ­¥æ•…éšœç£ç›˜ä¹‹å‰å¦ä¸€ä¸ªç£ç›˜ç¦»çº¿ï¼Œå°†å¯¼è‡´ä¸¢å¤±æ‰€æœ‰æ± æ•°æ®ã€‚
+
åœ¨ä¸€ä¸ªç”±å…«ä¸ª 1TB ç£ç›˜ç»„æˆçš„ RAID-Z3 é…ç½®ä¸­ï¼Œè¯¥å·å°†æä¾› 5TB çš„å¯ç”¨ç©ºé—´ï¼Œå¹¶ä¸”ä»èƒ½åœ¨ä¸‰ä¸ªæ•…éšœç£ç›˜çš„æƒ…å†µä¸‹è¿è¡Œã€‚ Sun(TM) å»ºè®®åœ¨å•ä¸ª vdev ä¸­ä¸è¦ä½¿ç”¨è¶…è¿‡ä¹ä¸ªç£ç›˜ã€‚å¦‚æœæ›´å¤šçš„ç£ç›˜ç»„æˆé…ç½®ï¼Œåˆ™å»ºè®®å°†å®ƒä»¬åˆ†æˆå•ç‹¬çš„ vdev ï¼Œå¹¶å°†æ± æ•°æ®åˆ†å¸ƒåœ¨å®ƒä»¬ä¹‹é—´ã€‚
+
ç”±æ¯ä¸ªåŒ…å« 8 ä¸ªç£ç›˜çš„ RAID-Z2 vdev ç»„æˆçš„é…ç½®å°†åˆ›å»ºç±»ä¼¼äº RAID-60 é˜µåˆ—çš„ä¸œè¥¿ã€‚ RAID-Z ç»„çš„å­˜å‚¨å®¹é‡çº¦ä¸ºæœ€å°ç£ç›˜å¤§å°ä¹˜ä»¥éå¥‡å¶æ ¡éªŒç£ç›˜æ•°é‡ã€‚ RAID-Z1 ä¸­çš„å››ä¸ª 1TB ç£ç›˜çš„æœ‰æ•ˆå¤§å°çº¦ä¸º 3TB ï¼Œè€Œ RAID-Z3 ä¸­çš„å…«ä¸ª 1TB ç£ç›˜é˜µåˆ—å°†æä¾› 5TB çš„å¯ç”¨ç©ºé—´ã€‚
 * [[zfs-term-vdev-spare]] _å¤‡ä»½ï¼ˆSpareï¼‰_ - ZFS æœ‰ä¸€ç§ç‰¹æ®Šçš„ä¼ª vdev ç±»å‹ï¼Œç”¨äºè·Ÿè¸ªå¯ç”¨çš„çƒ­å¤‡ã€‚è¯·æ³¨æ„ï¼Œå·²å®‰è£…çš„çƒ­å¤‡ä¸ä¼šè‡ªåŠ¨éƒ¨ç½²ï¼›è¯·ä½¿ç”¨ `zfs replace` æ‰‹åŠ¨é…ç½®å®ƒä»¬ä»¥æ›¿æ¢æ•…éšœè®¾å¤‡ã€‚
 * [[zfs-term-vdev-log]] _æ—¥å¿—ï¼ˆLogï¼‰_ - ZFS æ—¥å¿—è®¾å¤‡ï¼Œä¹Ÿç§°ä¸º ZFS æ„å›¾æ—¥å¿—ï¼ˆ <<zfs-term-zil,ZIL>> ï¼‰ï¼Œå°†æ„å›¾æ—¥å¿—ä»å¸¸è§„æ± è®¾å¤‡ç§»åŠ¨åˆ°ä¸“ç”¨è®¾å¤‡ï¼Œé€šå¸¸æ˜¯ SSD ã€‚æ‹¥æœ‰ä¸“ç”¨çš„æ—¥å¿—è®¾å¤‡å¯ä»¥æé«˜å…·æœ‰å¤§é‡åŒæ­¥å†™å…¥ï¼ˆå¦‚æ•°æ®åº“ï¼‰çš„åº”ç”¨ç¨‹åºçš„æ€§èƒ½ã€‚æ—¥å¿—è®¾å¤‡çš„é•œåƒæ˜¯å¯èƒ½çš„ï¼Œä½†ä¸æ”¯æŒ RAID-Z ã€‚å¦‚æœä½¿ç”¨å¤§é‡æ—¥å¿—è®¾å¤‡ï¼Œå†™å…¥å°†åœ¨å®ƒä»¬ä¹‹é—´è¿›è¡Œè´Ÿè½½å¹³è¡¡ã€‚
 * [[zfs-term-vdev-cache]] _ç¼“å­˜ï¼ˆCacheï¼‰_ - å‘æ± æ·»åŠ ç¼“å­˜ vdev å°†å°†ç¼“å­˜çš„å­˜å‚¨æ·»åŠ åˆ° <<zfs-term-l2arc,L2ARC>> ä¸­ã€‚é•œåƒç¼“å­˜è®¾å¤‡æ˜¯ä¸å¯èƒ½çš„ã€‚ç”±äºç¼“å­˜è®¾å¤‡ä»…å­˜å‚¨ç°æœ‰æ•°æ®çš„æ–°å‰¯æœ¬ï¼Œä¸å­˜åœ¨æ•°æ®ä¸¢å¤±çš„é£é™©ã€‚Ù([[zfs-term-txg]] Transaction Group (TXG)Ù [[zfs-term-txg]] äº‹åŠ¡ç»„ (TXG)ÚTransaction Groups are the way ZFS groups blocks changes together and writes them to the pool. Transaction groups are the atomic unit that ZFS uses to ensure consistency. ZFS assigns each transaction group a unique 64-bit consecutive identifier. There can be up to three active transaction groups at a time, one in each of these three states: 

* _Open_ - A new transaction group begins in the open state and accepts new writes. There is always a transaction group in the open state, but the transaction group may refuse new writes if it has reached a limit. Once the open transaction group has reached a limit, or reaching the <<zfs-advanced-tuning-txg-timeout,`vfs.zfs.txg.timeout`>>, the transaction group advances to the next state.
* _Quiescing_ - A short state that allows any pending operations to finish without blocking the creation of a new open transaction group. Once all the transactions in the group have completed, the transaction group advances to the final state.
* _Syncing_ - Write all the data in the transaction group to stable storage. This process will in turn change other data, such as metadata and space maps, that ZFS will also write to stable storage. The process of syncing involves several passes. On the first and biggest, all the changed data blocks; next come the metadata, which may take several passes to complete. Since allocating space for the data blocks generates new metadata, the syncing state cannot finish until a pass completes that does not use any new space. The syncing state is also where _synctasks_ complete. Synctasks are administrative operations such as creating or destroying snapshots and datasets that complete the uberblock change. Once the sync state completes the transaction group in the quiescing state advances to the syncing state. All administrative functions, such as <<zfs-term-snapshot,`snapshot`>> write as part of the transaction group. ZFS adds a created synctask to the open transaction group, and that group advances as fast as possible to the syncing state to reduce the latency of administrative commands.ÚÜäº‹åŠ¡ç»„æ˜¯ ZFS å°†å—æ›´æ”¹åˆ†ç»„å¹¶å†™å…¥æ± çš„æ–¹å¼ã€‚äº‹åŠ¡ç»„æ˜¯ ZFS ç”¨æ¥ç¡®ä¿ä¸€è‡´æ€§çš„åŸå­å•ä½ã€‚ ZFS ä¸ºæ¯ä¸ªäº‹åŠ¡ç»„åˆ†é…ä¸€ä¸ªå”¯ä¸€çš„ 64 ä½è¿ç»­æ ‡è¯†ç¬¦ã€‚åŒæ—¶å¯ä»¥æœ‰æœ€å¤šä¸‰ä¸ªæ´»åŠ¨äº‹åŠ¡ç»„ï¼Œåˆ†åˆ«å¤„äºä»¥ä¸‹ä¸‰ç§çŠ¶æ€ä¹‹ä¸€ï¼š

 * _æ‰“å¼€ï¼ˆOpenï¼‰_ - æ–°çš„äº‹åŠ¡ç»„å¼€å§‹æ—¶å¤„äºæ‰“å¼€çŠ¶æ€å¹¶æ¥å—æ–°çš„å†™å…¥ã€‚å§‹ç»ˆæœ‰ä¸€ä¸ªå¤„äºæ‰“å¼€çŠ¶æ€çš„äº‹åŠ¡ç»„ï¼Œä½†å¦‚æœè¾¾åˆ°é™åˆ¶ï¼Œäº‹åŠ¡ç»„å¯èƒ½ä¼šæ‹’ç»æ–°çš„å†™å…¥ã€‚ä¸€æ—¦æ‰“å¼€çš„äº‹åŠ¡ç»„è¾¾åˆ°é™åˆ¶ï¼Œæˆ–è¾¾åˆ°äº† <<zfs-advanced-tuning-txg-timeout,`vfs.zfs.txg.timeout`>> ï¼Œäº‹åŠ¡ç»„å°†è¿›å…¥ä¸‹ä¸€ä¸ªçŠ¶æ€ã€‚
 * _é™é»˜ï¼ˆQuiescingï¼‰_ - ä¸€ä¸ªçŸ­æš‚çš„çŠ¶æ€ï¼Œå…è®¸æ‰€æœ‰å¾…å¤„ç†çš„æ“ä½œå®Œæˆï¼Œè€Œä¸ä¼šé˜»å¡æ–°çš„æ‰“å¼€äº‹åŠ¡ç»„çš„åˆ›å»ºã€‚ä¸€æ—¦ç»„ä¸­çš„æ‰€æœ‰äº‹åŠ¡å®Œæˆï¼Œäº‹åŠ¡ç»„å°†è¿›å…¥æœ€ç»ˆçŠ¶æ€ã€‚
 * _åŒæ­¥ï¼ˆSyncingï¼‰_ - å°†äº‹åŠ¡ç»„ä¸­çš„æ‰€æœ‰æ•°æ®å†™å…¥ç¨³å®šå­˜å‚¨ã€‚è¿™ä¸ªè¿‡ç¨‹å°†è¿›ä¸€æ­¥æ”¹å˜å…¶ä»–æ•°æ®ï¼Œå¦‚å…ƒæ•°æ®å’Œç©ºé—´æ˜ å°„ï¼Œ ZFS ä¹Ÿä¼šå°†å…¶å†™å…¥ç¨³å®šå­˜å‚¨ã€‚åŒæ­¥è¿‡ç¨‹æ¶‰åŠå¤šä¸ªæ­¥éª¤ã€‚é¦–å…ˆæ˜¯æ‰€æœ‰æ›´æ”¹çš„æ•°æ®å—ï¼›æ¥ä¸‹æ¥æ˜¯å…ƒæ•°æ®ï¼Œå¯èƒ½éœ€è¦å¤šæ¬¡é€šè¿‡æ‰èƒ½å®Œæˆã€‚ç”±äºä¸ºæ•°æ®å—åˆ†é…ç©ºé—´ä¼šç”Ÿæˆæ–°çš„å…ƒæ•°æ®ï¼Œå› æ­¤åŒæ­¥çŠ¶æ€æ— æ³•å®Œæˆï¼Œç›´åˆ°å®Œæˆä¸€ä¸ªä¸ä½¿ç”¨ä»»ä½•æ–°ç©ºé—´çš„æ­¥éª¤ã€‚åŒæ­¥çŠ¶æ€ä¹Ÿæ˜¯ _synctasks_ å®Œæˆçš„åœ°æ–¹ã€‚ Synctasks æ˜¯å®Œæˆè¶…çº§å—æ›´æ”¹çš„åˆ›å»ºæˆ–é”€æ¯å¿«ç…§å’Œæ•°æ®é›†ç­‰ç®¡ç†æ“ä½œã€‚ä¸€æ—¦åŒæ­¥çŠ¶æ€å®Œæˆï¼Œå¤„äºé™é»˜çŠ¶æ€çš„äº‹åŠ¡ç»„å°†è¿›å…¥åŒæ­¥çŠ¶æ€ã€‚æ‰€æœ‰ç®¡ç†åŠŸèƒ½ï¼Œå¦‚ <<zfs-term-snapshot,`å¿«ç…§`>> ï¼Œéƒ½ä½œä¸ºäº‹åŠ¡ç»„çš„ä¸€éƒ¨åˆ†è¿›è¡Œå†™å…¥ã€‚ ZFS å°†åˆ›å»ºçš„ synctask æ·»åŠ åˆ°æ‰“å¼€çš„äº‹åŠ¡ç»„ä¸­ï¼Œå¹¶å°½å¿«å°†è¯¥ç»„æ¨è¿›åˆ°åŒæ­¥çŠ¶æ€ï¼Œä»¥å‡å°‘ç®¡ç†å‘½ä»¤çš„å»¶è¿Ÿã€‚Ù0[[zfs-term-arc]]Adaptive Replacement Cache (ARC)Ù/[[zfs-term-arc]] è‡ªé€‚åº”æ›¿æ¢ç¼“å­˜ï¼ˆARCï¼‰ÚÁZFS uses an Adaptive Replacement Cache (ARC), rather than a more traditional Least Recently Used (LRU) cache. An LRU cache is a simple list of items in the cache, sorted by how recently object was used, adding new items to the head of the list. When the cache is full, evicting items from the tail of the list makes room for more active objects. An ARC consists of four lists; the Most Recently Used (MRU) and Most Frequently Used (MFU) objects, plus a ghost list for each. These ghost lists track evicted objects to prevent adding them back to the cache. This increases the cache hit ratio by avoiding objects that have a history of occasional use. Another advantage of using both an MRU and MFU is that scanning an entire file system would evict all data from an MRU or LRU cache in favor of this freshly accessed content. With ZFS, there is also an MFU that tracks the most frequently used objects, and the cache of the most commonly accessed blocks remains.ÚlZFS ä½¿ç”¨è‡ªé€‚åº”æ›¿æ¢ç¼“å­˜ï¼ˆARCï¼‰ï¼Œè€Œä¸æ˜¯æ›´ä¼ ç»Ÿçš„æœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼ˆLRUï¼‰ç¼“å­˜ã€‚LRU ç¼“å­˜æ˜¯ä¸€ä¸ªç®€å•çš„ç¼“å­˜é¡¹åˆ—è¡¨ï¼ŒæŒ‰ç…§å¯¹è±¡æœ€è¿‘ä½¿ç”¨çš„æ—¶é—´æ’åºï¼Œå°†æ–°é¡¹æ·»åŠ åˆ°åˆ—è¡¨çš„å¤´éƒ¨ã€‚å½“ç¼“å­˜å·²æ»¡æ—¶ï¼Œä»åˆ—è¡¨çš„å°¾éƒ¨é€å‡ºé¡¹ä»¥ä¸ºæ›´æ´»è·ƒçš„å¯¹è±¡è…¾å‡ºç©ºé—´ã€‚ ARC ç”±å››ä¸ªåˆ—è¡¨ç»„æˆï¼šæœ€è¿‘æœ€å¸¸ä½¿ç”¨ï¼ˆMRUï¼‰å¯¹è±¡å’Œæœ€é¢‘ç¹ä½¿ç”¨ï¼ˆMFUï¼‰å¯¹è±¡ï¼Œä»¥åŠæ¯ä¸ªåˆ—è¡¨çš„å¹½çµåˆ—è¡¨ã€‚è¿™äº›å¹½çµåˆ—è¡¨è·Ÿè¸ªè¢«é€å‡ºçš„å¯¹è±¡ï¼Œä»¥é˜²æ­¢å°†å®ƒä»¬é‡æ–°æ·»åŠ åˆ°ç¼“å­˜ä¸­ã€‚è¿™é€šè¿‡é¿å…å…·æœ‰å¶å°”ä½¿ç”¨å†å²çš„å¯¹è±¡æ¥æé«˜ç¼“å­˜å‘½ä¸­ç‡ã€‚åŒæ—¶ä½¿ç”¨ MRU å’Œ MFU çš„å¦ä¸€ä¸ªä¼˜ç‚¹æ˜¯ï¼Œæ‰«ææ•´ä¸ªæ–‡ä»¶ç³»ç»Ÿå°†é€å‡º MRU æˆ– LRU ç¼“å­˜ä¸­çš„æ‰€æœ‰æ•°æ®ï¼Œä»¥ä¾¿ä¸ºè¿™äº›æ–°è®¿é—®çš„å†…å®¹è…¾å‡ºç©ºé—´ã€‚åœ¨ ZFS ä¸­ï¼Œè¿˜æœ‰ä¸€ä¸ªè·Ÿè¸ªæœ€å¸¸ä½¿ç”¨å¯¹è±¡çš„ MFUï¼Œå¹¶ä¿ç•™æœ€å¸¸è®¿é—®å—çš„ç¼“å­˜ã€‚·[[zfs-term-l2arc]]L2ARC¸[[zfs-term-l2arc]] L2ARCÚL2ARC is the second level of the ZFS caching system. RAM stores the primary ARC. Since the amount of available RAM is often limited, ZFS can also use <<zfs-term-vdev-cache,cache vdevs>>. Solid State Disks (SSDs) are often used as these cache devices due to their higher speed and lower latency compared to traditional spinning disks. L2ARC is entirely optional, but having one will increase read speeds for cached files on the SSD instead of having to read from the regular disks. L2ARC can also speed up <<zfs-term-deduplication,deduplication>> because a deduplication table (DDT) that does not fit in RAM but does fit in the L2ARC will be much faster than a DDT that must read from disk. Limits on the data rate added to the cache devices prevents prematurely wearing out SSDs with extra writes. Until the cache is full (the first block evicted to make room), writes to the L2ARC limit to the sum of the write limit and the boost limit, and afterwards limit to the write limit. A pair of man:sysctl[8] values control these rate limits. <<zfs-advanced-tuning-l2arc_write_max,`vfs.zfs.l2arc_write_max`>> controls the number of bytes written to the cache per second, while <<zfs-advanced-tuning-l2arc_write_boost,`vfs.zfs.l2arc_write_boost`>> adds to this limit during the "Turbo Warmup Phase" (Write Boost).ÚƒL2ARC æ˜¯ ZFS ç¼“å­˜ç³»ç»Ÿçš„ç¬¬äºŒçº§ã€‚ RAM å­˜å‚¨ä¸»è¦çš„ ARC ã€‚ç”±äºå¯ç”¨çš„ RAM æ•°é‡é€šå¸¸æœ‰é™ï¼Œ ZFS è¿˜å¯ä»¥ä½¿ç”¨ <<zfs-term-vdev-cache,ç¼“å­˜ vdevs>> ã€‚ç”±äºä¸ä¼ ç»Ÿçš„æ—‹è½¬ç¡¬ç›˜ç›¸æ¯”ï¼Œå›ºæ€ç¡¬ç›˜ï¼ˆSSDï¼‰å…·æœ‰æ›´é«˜çš„é€Ÿåº¦å’Œæ›´ä½çš„å»¶è¿Ÿï¼Œå› æ­¤é€šå¸¸å°†å…¶ç”¨ä½œç¼“å­˜è®¾å¤‡ã€‚ L2ARC æ˜¯å®Œå…¨å¯é€‰çš„ï¼Œä½†æ‹¥æœ‰ä¸€ä¸ª L2ARC å°†æé«˜ä» SSD è¯»å–ç¼“å­˜æ–‡ä»¶çš„é€Ÿåº¦ï¼Œè€Œä¸å¿…ä»å¸¸è§„ç£ç›˜è¯»å–ã€‚ L2ARC è¿˜å¯ä»¥åŠ é€Ÿ <<zfs-term-deduplication,å»é‡>>ï¼Œå› ä¸ºä¸é€‚åˆ RAM ä½†é€‚åˆ L2ARC çš„å»é‡è¡¨ï¼ˆDDTï¼‰æ¯”å¿…é¡»ä»ç£ç›˜è¯»å–çš„ DDT å¿«å¾—å¤šã€‚å¯¹ç¼“å­˜è®¾å¤‡æ·»åŠ çš„æ•°æ®é€Ÿç‡é™åˆ¶å¯ä»¥é˜²æ­¢é¢å¤–çš„å†™å…¥è¿‡æ—©ç£¨æŸ SSD ã€‚åœ¨ç¼“å­˜å¡«æ»¡ä¹‹å‰ï¼ˆä¸ºäº†è…¾å‡ºç©ºé—´è€Œé©±é€çš„ç¬¬ä¸€ä¸ªå—ï¼‰ï¼Œå†™å…¥ L2ARC çš„é™åˆ¶ä¸ºå†™å…¥é™åˆ¶å’Œå¢åŠ é™åˆ¶çš„æ€»å’Œï¼Œä¹‹åé™åˆ¶ä¸ºå†™å…¥é™åˆ¶ã€‚ä¸€å¯¹ sysctl å€¼æ§åˆ¶è¿™äº›é€Ÿç‡é™åˆ¶ã€‚ <<zfs-advanced-tuning-l2arc_write_max,`vfs.zfs.l2arc_write_max`>> æ§åˆ¶æ¯ç§’å†™å…¥ç¼“å­˜çš„å­—èŠ‚æ•°ï¼Œè€Œ <<zfs-advanced-tuning-l2arc_write_boost,`vfs.zfs.l2arc_write_boost`>>åœ¨â€œTurbo Warmup Phaseï¼ˆå†™å…¥å¢å¼ºï¼‰â€æœŸé—´å¢åŠ äº†è¿™ä¸ªé™åˆ¶ã€‚³[[zfs-term-zil]]ZIL´[[zfs-term-zil]] ZILÚ/ZIL accelerates synchronous transactions by using storage devices like SSDs that are faster than those used in the main storage pool. When an application requests a synchronous write (a guarantee that the data is stored to disk rather than merely cached for later writes), writing the data to the faster ZIL storage then later flushing it out to the regular disks greatly reduces latency and improves performance. Synchronous workloads like databases will profit from a ZIL alone. Regular asynchronous writes such as copying files will not use the ZIL at all.ÚŞZIL é€šè¿‡ä½¿ç”¨æ¯”ä¸»å­˜å‚¨æ± ä¸­ä½¿ç”¨çš„å­˜å‚¨è®¾å¤‡ï¼ˆå¦‚ SSDï¼‰æ›´å¿«çš„è®¾å¤‡æ¥åŠ é€ŸåŒæ­¥äº‹åŠ¡ã€‚å½“åº”ç”¨ç¨‹åºè¯·æ±‚åŒæ­¥å†™å…¥ï¼ˆä¿è¯æ•°æ®å­˜å‚¨åˆ°ç£ç›˜è€Œä¸ä»…ä»…æ˜¯ç¼“å­˜ä»¥ä¾›ä»¥åå†™å…¥æ—¶ï¼‰ï¼Œå°†æ•°æ®å†™å…¥æ›´å¿«çš„ ZIL å­˜å‚¨ï¼Œç„¶åç¨åå°†å…¶åˆ·æ–°åˆ°å¸¸è§„ç£ç›˜ä¸Šï¼Œå¤§å¤§é™ä½äº†å»¶è¿Ÿå¹¶æé«˜äº†æ€§èƒ½ã€‚åƒæ•°æ®åº“è¿™æ ·çš„åŒæ­¥å·¥ä½œè´Ÿè½½å°†ä» ZIL ä¸­å—ç›Šã€‚è€Œå¸¸è§„çš„å¼‚æ­¥å†™å…¥ï¼ˆå¦‚å¤åˆ¶æ–‡ä»¶ï¼‰åˆ™æ ¹æœ¬ä¸ä¼šä½¿ç”¨ ZILã€‚½[[zfs-term-cow]]Copy-On-WriteÙ&[[zfs-term-cow]] å†™æ—¶å¤åˆ¶ï¼ˆCOWï¼‰ÚÏUnlike a traditional file system, ZFS writes a different block rather than overwriting the old data in place. When completing this write the metadata updates to point to the new location. When a shorn write (a system crash or power loss in the middle of writing a file) occurs, the entire original contents of the file are still available and ZFS discards the incomplete write. This also means that ZFS does not require a man:fsck[8] after an unexpected shutdown.Ú›ä¸ä¼ ç»Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸åŒï¼ŒZFS åœ¨å†™å…¥æ•°æ®æ—¶ä¸ä¼šç›´æ¥è¦†ç›–æ—§æ•°æ®ï¼Œè€Œæ˜¯å†™å…¥ä¸€ä¸ªä¸åŒçš„å—ã€‚å®Œæˆå†™å…¥åï¼Œå…ƒæ•°æ®ä¼šæ›´æ–°ä»¥æŒ‡å‘æ–°çš„ä½ç½®ã€‚å½“å‘ç”Ÿæˆªæ–­å†™å…¥ï¼ˆç³»ç»Ÿå´©æºƒæˆ–æ–­ç”µå¯¼è‡´æ–‡ä»¶å†™å…¥ä¸­æ–­ï¼‰æ—¶ï¼Œæ–‡ä»¶çš„å®Œæ•´åŸå§‹å†…å®¹ä»ç„¶å¯ç”¨ï¼Œè€Œ ZFS ä¼šä¸¢å¼ƒä¸å®Œæ•´çš„å†™å…¥ã€‚è¿™ä¹Ÿæ„å‘³ç€ ZFS åœ¨æ„å¤–å…³é—­åä¸éœ€è¦è¿›è¡Œ man:fsck[8] æ“ä½œã€‚»[[zfs-term-dataset]]DatasetÙ+[[zfs-term-dataset]] æ•°æ®é›†ï¼ˆDatasetï¼‰Ú•_Dataset_ is the generic term for a ZFS file system, volume, snapshot or clone. Each dataset has a unique name in the format _poolname/path@snapshot_. The root of the pool is a dataset as well. Child datasets have hierarchical names like directories. For example, _mypool/home_, the home dataset, is a child of _mypool_ and inherits properties from it. Expand this further by creating _mypool/home/user_. This grandchild dataset will inherit properties from the parent and grandparent. Set properties on a child to override the defaults inherited from the parent and grandparent. Administration of datasets and their children can be <<zfs-zfs-allow,delegated>>.Ú…_æ•°æ®é›†_ æ˜¯ ZFS æ–‡ä»¶ç³»ç»Ÿã€å·ã€å¿«ç…§æˆ–å…‹éš†çš„é€šç”¨æœ¯è¯­ã€‚æ¯ä¸ªæ•°æ®é›†éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„åç§°ï¼Œæ ¼å¼ä¸º _poolname/path@snapshot_ã€‚æ± çš„æ ¹ä¹Ÿæ˜¯ä¸€ä¸ªæ•°æ®é›†ã€‚å­æ•°æ®é›†å…·æœ‰å±‚æ¬¡ç»“æ„çš„åç§°ï¼Œç±»ä¼¼äºç›®å½•ã€‚ä¾‹å¦‚ï¼Œ_mypool/home_ï¼Œå³ home æ•°æ®é›†ï¼Œæ˜¯ mypool çš„å­æ•°æ®é›†ï¼Œå¹¶ä»å…¶ç»§æ‰¿å±æ€§ã€‚é€šè¿‡åˆ›å»º _mypool/home/user_ï¼Œå¯ä»¥è¿›ä¸€æ­¥æ‰©å±•æ­¤ç»“æ„ã€‚è¿™ä¸ªå­™å­æ•°æ®é›†å°†ä»çˆ¶çº§å’Œç¥–çˆ¶çº§ç»§æ‰¿å±æ€§ã€‚åœ¨å­æ•°æ®é›†ä¸Šè®¾ç½®å±æ€§ä»¥è¦†ç›–ä»çˆ¶çº§å’Œç¥–çˆ¶çº§ç»§æ‰¿çš„é»˜è®¤å€¼ã€‚å¯ä»¥å°†æ•°æ®é›†åŠå…¶å­æ•°æ®é›†çš„ç®¡ç† <<zfs-zfs-allow,å§”æ‰˜>> ç»™å…¶ä»–ç”¨æˆ·ã€‚Ù"[[zfs-term-filesystem]]File systemÙ$[[zfs-term-filesystem]] æ–‡ä»¶ç³»ç»ŸÙñA ZFS dataset is most often used as a file system. Like most other file systems, a ZFS file system mounts somewhere in the systems directory hierarchy and contains files and directories of its own with permissions, flags, and other metadata.ÙÚZFS æ•°æ®é›†é€šå¸¸ç”¨ä½œæ–‡ä»¶ç³»ç»Ÿã€‚ä¸å¤§å¤šæ•°å…¶ä»–æ–‡ä»¶ç³»ç»Ÿä¸€æ ·ï¼ŒZFS æ–‡ä»¶ç³»ç»Ÿä¼šæŒ‚è½½åˆ°ç³»ç»Ÿç›®å½•å±‚æ¬¡ç»“æ„çš„æŸä¸ªä½ç½®ï¼Œå¹¶åŒ…å«å…·æœ‰æƒé™ã€æ ‡å¿—å’Œå…¶ä»–å…ƒæ•°æ®çš„æ–‡ä»¶å’Œç›®å½•ã€‚¹[[zfs-term-volume]]VolumeÙ#[[zfs-term-volume]] å·ï¼ˆVolumeï¼‰Ú0ZFS can also create volumes, which appear as disk devices. Volumes have a lot of the same features as datasets, including copy-on-write, snapshots, clones, and checksumming. Volumes can be useful for running other file system formats on top of ZFS, such as UFS virtualization, or exporting iSCSI extents.ÚZFS è¿˜å¯ä»¥åˆ›å»ºå·ï¼Œå®ƒä»¬ä¼šæ˜¾ç¤ºä¸ºç£ç›˜è®¾å¤‡ã€‚å·å…·æœ‰ä¸æ•°æ®é›†ç›¸ä¼¼çš„è®¸å¤šåŠŸèƒ½ï¼ŒåŒ…æ‹¬å†™æ—¶å¤åˆ¶ã€å¿«ç…§ã€å…‹éš†å’Œæ ¡éªŒå’Œã€‚å·å¯¹äºåœ¨ ZFS ä¸Šè¿è¡Œå…¶ä»–æ–‡ä»¶ç³»ç»Ÿæ ¼å¼ï¼ˆå¦‚ UFS è™šæ‹ŸåŒ–ï¼‰æˆ–å¯¼å‡º iSCSI æ‰©å±•éå¸¸æœ‰ç”¨ã€‚½[[zfs-term-snapshot]]SnapshotÙ*[[zfs-term-snapshot]] å¿«ç…§ï¼ˆSnapshotï¼‰ÚèThe <<zfs-term-cow,copy-on-write>> (COW) design of ZFS allows for nearly instantaneous, consistent snapshots with arbitrary names. After taking a snapshot of a dataset, or a recursive snapshot of a parent dataset that will include all child datasets, new data goes to new blocks, but without reclaiming the old blocks as free space. The snapshot contains the original file system version and the live file system contains any changes made since taking the snapshot using no other space. New data written to the live file system uses new blocks to store this data. The snapshot will grow as the blocks are no longer used in the live file system, but in the snapshot alone. Mount these snapshots read-only allows recovering of previous file versions. A <<zfs-zfs-snapshot,rollback>> of a live file system to a specific snapshot is possible, undoing any changes that took place after taking the snapshot. Each block in the pool has a reference counter which keeps track of the snapshots, clones, datasets, or volumes use that block. As files and snapshots get deleted, the reference count  decreases, reclaiming the free space when no longer referencing a block. Marking snapshots with a <<zfs-zfs-snapshot,hold>> results in any attempt to destroy it will  returns an `EBUSY` error. Each snapshot can have holds with a unique name each. The <<zfs-zfs-snapshot,release>> command removes the hold so the snapshot can deleted. Snapshots, cloning, and rolling back works on volumes, but independently mounting does not.Ú$ZFS çš„ <<zfs-term-cow,å†™æ—¶å¤åˆ¶ >>ï¼ˆCOWï¼‰è®¾è®¡å…è®¸å‡ ä¹ç¬é—´åˆ›å»ºå…·æœ‰ä»»æ„åç§°çš„ä¸€è‡´æ€§å¿«ç…§ã€‚åœ¨å¯¹æ•°æ®é›†è¿›è¡Œå¿«ç…§æˆ–å¯¹åŒ…å«æ‰€æœ‰å­æ•°æ®é›†çš„çˆ¶æ•°æ®é›†è¿›è¡Œé€’å½’å¿«ç…§ä¹‹åï¼Œæ–°æ•°æ®å°†è¿›å…¥æ–°çš„å—ï¼Œä½†ä¸ä¼šå°†æ—§å—å›æ”¶ä¸ºå¯ç”¨ç©ºé—´ã€‚å¿«ç…§åŒ…å«åŸå§‹æ–‡ä»¶ç³»ç»Ÿç‰ˆæœ¬ï¼Œæ´»åŠ¨æ–‡ä»¶ç³»ç»ŸåŒ…å«è‡ªå¿«ç…§ä»¥æ¥æ‰€åšçš„ä»»ä½•æ›´æ”¹ï¼Œè€Œä¸ä½¿ç”¨å…¶ä»–ç©ºé—´ã€‚å†™å…¥æ´»åŠ¨æ–‡ä»¶ç³»ç»Ÿçš„æ–°æ•°æ®ä½¿ç”¨æ–°çš„å—æ¥å­˜å‚¨è¿™äº›æ•°æ®ã€‚éšç€å—åœ¨æ´»åŠ¨æ–‡ä»¶ç³»ç»Ÿä¸­ä¸å†ä½¿ç”¨ï¼Œå¿«ç…§å°†å¢é•¿ï¼Œä½†ä»…åœ¨å¿«ç…§ä¸­ä½¿ç”¨ã€‚å°†è¿™äº›å¿«ç…§ä»¥åªè¯»æ–¹å¼æŒ‚è½½å¯ä»¥æ¢å¤å…ˆå‰çš„æ–‡ä»¶ç‰ˆæœ¬ã€‚å¯ä»¥å°†æ´»åŠ¨æ–‡ä»¶ç³»ç»Ÿå›æ»šåˆ°ç‰¹å®šå¿«ç…§çš„ <<zfs-zfs-snapshot,å›æ»š>> æ˜¯å¯èƒ½çš„ï¼Œä»è€Œæ’¤æ¶ˆåœ¨å¿«ç…§ä¹‹åè¿›è¡Œçš„ä»»ä½•æ›´æ”¹ã€‚æ± ä¸­çš„æ¯ä¸ªå—éƒ½æœ‰ä¸€ä¸ªå¼•ç”¨è®¡æ•°å™¨ï¼Œç”¨äºè·Ÿè¸ªä½¿ç”¨è¯¥å—çš„å¿«ç…§ã€å…‹éš†ã€æ•°æ®é›†æˆ–å·ã€‚éšç€æ–‡ä»¶å’Œå¿«ç…§è¢«åˆ é™¤ï¼Œå¼•ç”¨è®¡æ•°å‡å°‘ï¼Œå½“ä¸å†å¼•ç”¨å—æ—¶ï¼Œå›æ”¶å¯ç”¨ç©ºé—´ã€‚ä½¿ç”¨ <<zfs-zfs-snapshot,ä¿ç•™>> æ ‡è®°å¿«ç…§å°†å¯¼è‡´ä»»ä½•è¯•å›¾é”€æ¯å®ƒçš„å°è¯•è¿”å› `EBUSY` é”™è¯¯ã€‚æ¯ä¸ªå¿«ç…§å¯ä»¥å…·æœ‰å”¯ä¸€åç§°çš„ä¿ç•™ã€‚ <<zfs-zfs-snapshot,é‡Šæ”¾>> å‘½ä»¤ä¼šç§»é™¤ä¿ç•™ï¼Œä»¥ä¾¿å¯ä»¥åˆ é™¤å¿«ç…§ã€‚å¿«ç…§ã€å…‹éš†å’Œå›æ»šé€‚ç”¨äºå·ï¼Œä½†ç‹¬ç«‹æŒ‚è½½ä¸é€‚ç”¨ã€‚·[[zfs-term-clone]]CloneÙ$[[zfs-term-clone]] å…‹éš†ï¼ˆCloneï¼‰Ú(Cloning a snapshot is also possible. A clone is a writable version of a snapshot, allowing the file system to fork as a new dataset. As with a snapshot, a clone initially consumes no new space. As new data written to a clone uses new blocks, the size of the clone grows. When blocks are overwritten in the cloned file system or volume, the reference count on the previous block decreases. Removing the snapshot upon which a clone bases is impossible because the clone depends on it. The snapshot is the parent, and the clone is the child. Clones can be _promoted_, reversing this dependency and making the clone the parent and the previous parent the child. This operation requires no new space. Since the amount of space used by the parent and child reverses, it may affect existing quotas and reservations.Ú±å…‹éš†å¿«ç…§ä¹Ÿæ˜¯å¯èƒ½çš„ã€‚å…‹éš†æ˜¯å¿«ç…§çš„å¯å†™ç‰ˆæœ¬ï¼Œå…è®¸æ–‡ä»¶ç³»ç»Ÿåˆ†å‰ä¸ºä¸€ä¸ªæ–°çš„æ•°æ®é›†ã€‚ä¸å¿«ç…§ä¸€æ ·ï¼Œå…‹éš†æœ€åˆä¸å ç”¨æ–°çš„ç©ºé—´ã€‚å½“æ–°æ•°æ®å†™å…¥å…‹éš†æ—¶ï¼Œä½¿ç”¨æ–°çš„å—ï¼Œå…‹éš†çš„å¤§å°å¢é•¿ã€‚å½“åœ¨å…‹éš†çš„æ–‡ä»¶ç³»ç»Ÿæˆ–å·ä¸­è¦†ç›–å—æ—¶ï¼Œå…ˆå‰å—çš„å¼•ç”¨è®¡æ•°å‡å°‘ã€‚åˆ é™¤å…‹éš†æ‰€ä¾èµ–çš„å¿«ç…§æ˜¯ä¸å¯èƒ½çš„ï¼Œå› ä¸ºå…‹éš†ä¾èµ–äºå®ƒã€‚å¿«ç…§æ˜¯çˆ¶çº§ï¼Œå…‹éš†æ˜¯å­çº§ã€‚å…‹éš†å¯ä»¥è¢« _æå‡ï¼ˆpromotedï¼‰_ï¼Œåè½¬è¿™ç§ä¾èµ–å…³ç³»ï¼Œä½¿å…‹éš†æˆä¸ºçˆ¶çº§ï¼Œå…ˆå‰çš„çˆ¶çº§æˆä¸ºå­çº§ã€‚æ­¤æ“ä½œä¸éœ€è¦æ–°çš„ç©ºé—´ã€‚ç”±äºçˆ¶çº§å’Œå­çº§ä½¿ç”¨çš„ç©ºé—´ç›¸äº’è½¬æ¢ï¼Œå¯èƒ½ä¼šå½±å“ç°æœ‰çš„é…é¢å’Œé¢„ç•™ç©ºé—´ã€‚½[[zfs-term-checksum]]ChecksumÙ-[[zfs-term-checksum]] æ ¡éªŒå’Œï¼ˆChecksumï¼‰ÚİEvery block is also checksummed. The checksum algorithm used is a per-dataset property, see <<zfs-zfs-set,`set`>>. The checksum of each block is transparently validated when read, allowing ZFS to detect silent corruption. If the data read does not match the expected checksum, ZFS will attempt to recover the data from any available redundancy, like mirrors or RAID-Z. Triggering a validation of all checksums with <<zfs-term-scrub,`scrub`>>. Checksum algorithms include:

* `fletcher2`
* `fletcher4`
* `sha256`
 The `fletcher` algorithms are faster, but `sha256` is a strong cryptographic hash and has a much lower chance of collisions at the  cost of some performance. Deactivating checksums is possible, but  strongly discouraged.Ú­æ¯ä¸ªå—ä¹Ÿéƒ½æœ‰æ ¡éªŒå’Œã€‚æ‰€ä½¿ç”¨çš„æ ¡éªŒç®—æ³•æ˜¯æ¯ä¸ªæ•°æ®é›†çš„å±æ€§ï¼Œå‚è§ <<zfs-zfs-set,`set`>> ã€‚åœ¨è¯»å–æ—¶ï¼Œæ¯ä¸ªå—çš„æ ¡éªŒå’Œä¼šè¢«é€æ˜åœ°éªŒè¯ï¼Œè¿™ä½¿å¾— ZFS èƒ½å¤Ÿæ£€æµ‹åˆ°é™é»˜æŸåã€‚å¦‚æœè¯»å–çš„æ•°æ®ä¸é¢„æœŸçš„æ ¡éªŒå’Œä¸åŒ¹é…ï¼ŒZFS å°†å°è¯•ä»ä»»ä½•å¯ç”¨çš„å†—ä½™ä¸­æ¢å¤æ•°æ®ï¼Œä¾‹å¦‚é•œåƒæˆ– RAID-Zã€‚å¯ä»¥ä½¿ç”¨ <<zfs-term-scrub,`scrub`>> è§¦å‘å¯¹æ‰€æœ‰æ ¡éªŒå’Œçš„éªŒè¯ã€‚æ ¡éªŒç®—æ³•åŒ…æ‹¬ï¼š

 * `fletcher2` 
 * `fletcher4` 
 * `sha256` 
 `fletcher` ç®—æ³•æ›´å¿«ï¼Œä½† `sha256` æ˜¯ä¸€ç§å¼ºå¤§çš„åŠ å¯†å“ˆå¸Œç®—æ³•ï¼Œå…·æœ‰æ›´ä½çš„ç¢°æ’å‡ ç‡ï¼Œä½†æ€§èƒ½ç¨æœ‰æŸå¤±ã€‚å¯ä»¥ç¦ç”¨æ ¡éªŒå’Œï¼Œä½†å¼ºçƒˆä¸å»ºè®®è¿™æ ·åšã€‚Ù#[[zfs-term-compression]]CompressionÙ0[[zfs-term-compression]] å‹ç¼©ï¼ˆCompressionï¼‰Ú¿Each dataset has a compression property, which defaults to off. Set this property to an available compression algorithm. This causes compression of all new data written to the dataset. Beyond a reduction in space used, read and write throughput often increases because fewer blocks need reading or writing. 

[[zfs-term-compression-lz4]]
* _LZ4_ - Added in ZFS pool version 5000 (feature flags), LZ4 is now the recommended compression algorithm. LZ4 works about 50% faster than LZJB when operating on compressible data, and is over three times faster when operating on uncompressible data. LZ4 also decompresses about 80% faster than LZJB. On modern CPUs, LZ4 can often compress at over 500 MB/s, and decompress at over 1.5 GB/s (per single CPU core).

[[zfs-term-compression-lzjb]]
* _LZJB_ - The default compression algorithm. Created by Jeff Bonwick (one of the original creators of ZFS). LZJB offers good compression with less CPU overhead compared to GZIP. In the future, the default compression algorithm will change to LZ4.

[[zfs-term-compression-gzip]]
* _GZIP_ - A popular stream compression algorithm available in ZFS. One of the main advantages of using GZIP is its configurable level of compression. When setting the `compress` property, the administrator can choose the level of compression, ranging from `gzip1`, the lowest level of compression, to `gzip9`, the highest level of compression. This gives the administrator control over how much CPU time to trade for saved disk space.

[[zfs-term-compression-zle]]
* _ZLE_ - Zero Length Encoding is a special compression algorithm that compresses continuous runs of zeros alone. This compression algorithm is useful when the dataset contains large blocks of zeros.Úæ¯ä¸ªæ•°æ®é›†éƒ½æœ‰ä¸€ä¸ªå‹ç¼©å±æ€§ï¼Œé»˜è®¤ä¸ºå…³é—­çŠ¶æ€ã€‚å°†æ­¤å±æ€§è®¾ç½®ä¸ºå¯ç”¨çš„å‹ç¼©ç®—æ³•ã€‚è¿™å°†å¯¼è‡´å¯¹å†™å…¥æ•°æ®é›†çš„æ‰€æœ‰æ–°æ•°æ®è¿›è¡Œå‹ç¼©ã€‚é™¤äº†å‡å°‘æ‰€ä½¿ç”¨çš„ç©ºé—´å¤–ï¼Œè¯»å†™ååé‡é€šå¸¸ä¹Ÿä¼šå¢åŠ ï¼Œå› ä¸ºéœ€è¦è¯»å–æˆ–å†™å…¥çš„å—è¾ƒå°‘ã€‚

 [[zfs-term-compression-lz4]] 
 * _LZ4_ - åœ¨ ZFS æ± ç‰ˆæœ¬ 5000ï¼ˆfeature flagsï¼‰ä¸­æ·»åŠ ï¼ŒLZ4 ç°åœ¨æ˜¯æ¨èçš„å‹ç¼©ç®—æ³•ã€‚å½“å¤„ç†å¯å‹ç¼©æ•°æ®æ—¶ï¼ŒLZ4 çš„å·¥ä½œé€Ÿåº¦æ¯” LZJB å¿«çº¦ 50 ï¼…ï¼Œå¤„ç†ä¸å¯å‹ç¼©æ•°æ®æ—¶ï¼Œé€Ÿåº¦å¿«ä¸‰å€ä»¥ä¸Šã€‚LZ4 çš„è§£å‹é€Ÿåº¦ä¹Ÿæ¯” LZJB å¿«çº¦ 80 ï¼…ã€‚åœ¨ç°ä»£ CPU ä¸Šï¼ŒLZ4 é€šå¸¸å¯ä»¥ä»¥è¶…è¿‡ 500 MB/s çš„é€Ÿåº¦è¿›è¡Œå‹ç¼©ï¼Œå¹¶ä»¥è¶…è¿‡ 1.5 GB/s çš„é€Ÿåº¦è¿›è¡Œè§£å‹ç¼©ï¼ˆæ¯ä¸ªå•ç‹¬çš„ CPU æ ¸å¿ƒï¼‰ã€‚

 [[zfs-term-compression-lzjb]] 
 * _LZJB_ - é»˜è®¤çš„å‹ç¼©ç®—æ³•ã€‚ç”± Jeff Bonwickï¼ˆ ZFS çš„åŸå§‹åˆ›å»ºè€…ä¹‹ä¸€ï¼‰åˆ›å»ºã€‚ä¸ GZIP ç›¸æ¯”ï¼ŒLZJB æä¾›äº†è¾ƒå¥½çš„å‹ç¼©æ•ˆæœï¼Œå¹¶ä¸” CPU å¼€é”€è¾ƒå°ã€‚åœ¨å°†æ¥ï¼Œé»˜è®¤çš„å‹ç¼©ç®—æ³•å°†æ›´æ”¹ä¸º LZ4 ã€‚

 [[zfs-term-compression-gzip]] 
 * _GZIP_ - ZFS ä¸­æä¾›çš„ä¸€ç§æµå‹ç¼©ç®—æ³•ã€‚ä½¿ç”¨ GZIP çš„ä¸»è¦ä¼˜åŠ¿ä¹‹ä¸€æ˜¯å…¶å¯é…ç½®çš„å‹ç¼©çº§åˆ«ã€‚åœ¨è®¾ç½® `compress` å±æ€§æ—¶ï¼Œç®¡ç†å‘˜å¯ä»¥é€‰æ‹©å‹ç¼©çº§åˆ«ï¼Œä»æœ€ä½çº§åˆ«çš„ `gzip1` åˆ°æœ€é«˜çº§åˆ«çš„ `gzip9`ã€‚è¿™ä½¿ç®¡ç†å‘˜å¯ä»¥æ§åˆ¶ä»¥å¤šå°‘ CPU æ—¶é—´æ¥æ¢å–èŠ‚çœçš„ç£ç›˜ç©ºé—´ã€‚

 [[zfs-term-compression-zle]] 
 * _ZLE_ - é›¶é•¿åº¦ç¼–ç æ˜¯ä¸€ç§ç‰¹æ®Šçš„å‹ç¼©ç®—æ³•ï¼Œä»…å‹ç¼©è¿ç»­çš„é›¶ã€‚å½“æ•°æ®é›†åŒ…å«å¤§å—çš„é›¶æ—¶ï¼Œè¿™ç§å‹ç¼©ç®—æ³•éå¸¸æœ‰ç”¨ã€‚¹[[zfs-term-copies]]CopiesÙ&[[zfs-term-copies]] å‰¯æœ¬ï¼ˆCopiesï¼‰Ú(When set to a value greater than 1, the `copies` property instructs ZFS to maintain copies of each block in the <<zfs-term-filesystem,file system>> or <<zfs-term-volume,volume>>. Setting this property on important datasets provides added redundancy from which to recover a block that does not match its checksum. In pools without redundancy, the copies feature is the single form of redundancy. The copies feature can recover from a single bad sector or other forms of minor corruption, but it does not protect the pool from the loss of an entire disk.Úáå½“ `copies` å±æ€§è®¾ç½®ä¸ºå¤§äº 1 çš„å€¼æ—¶ï¼ŒZFS ä¼šåœ¨ <<zfs-term-filesystem,æ–‡ä»¶ç³»ç»Ÿ >> æˆ– <<zfs-term-volume,å· >> ä¸­ç»´æŠ¤æ¯ä¸ªå—çš„å‰¯æœ¬ã€‚åœ¨é‡è¦çš„æ•°æ®é›†ä¸Šè®¾ç½®æ­¤å±æ€§å¯ä»¥æä¾›é¢å¤–çš„å†—ä½™ï¼Œä»¥ä¾¿ä»ä¸­æ¢å¤ä¸åŒ¹é…å…¶æ ¡éªŒå’Œçš„å—ã€‚åœ¨æ²¡æœ‰å†—ä½™çš„å­˜å‚¨æ± ä¸­ï¼Œå‰¯æœ¬åŠŸèƒ½æ˜¯å”¯ä¸€çš„å†—ä½™å½¢å¼ã€‚å‰¯æœ¬åŠŸèƒ½å¯ä»¥ä»å•ä¸ªåæ‰‡åŒºæˆ–å…¶ä»–å½¢å¼çš„è½»å¾®æŸåä¸­æ¢å¤ï¼Œä½†å®ƒä¸èƒ½ä¿æŠ¤å­˜å‚¨æ± å…å—æ•´ä¸ªç£ç›˜çš„ä¸¢å¤±ã€‚Ù'[[zfs-term-deduplication]]DeduplicationÙ4[[zfs-term-deduplication]] å»é‡ï¼ˆDeduplicationï¼‰Ú¹Checksums make it possible to detect duplicate blocks when writing data. With deduplication, the reference count of an existing, identical block increases, saving storage space. ZFS keeps a deduplication table (DDT) in memory to detect duplicate blocks. The table contains a list of unique checksums, the location of those blocks, and a reference count. When writing new data, ZFS calculates checksums and compares them to the list. When finding a match it uses the existing block. Using the SHA256 checksum algorithm with deduplication provides a secure cryptographic hash. Deduplication is tunable. If `dedup` is `on`, then a matching checksum means that the data is identical. Setting `dedup` to `verify`, ZFS performs a byte-for-byte check on the data ensuring they are actually identical. If the data is not identical, ZFS will note the hash collision and store the two blocks separately. As the DDT must store the hash of each unique block, it consumes a large amount of memory. A general rule of thumb is 5-6 GB of ram per 1 TB of deduplicated data). In situations not practical to have enough RAM to keep the entire DDT in memory, performance will suffer greatly as the DDT must read from disk before writing each new block. Deduplication can use L2ARC to store the DDT, providing a middle ground between fast system memory and slower disks. Consider using compression instead, which often provides nearly as much space savings without the increased memory.Ú?åœ¨å†™å…¥æ•°æ®æ—¶ï¼Œæ ¡éªŒå’Œå¯ä»¥æ£€æµ‹é‡å¤çš„æ•°æ®å—ã€‚é€šè¿‡å»é‡ï¼Œç°æœ‰ç›¸åŒå—çš„å¼•ç”¨è®¡æ•°å¢åŠ ï¼ŒèŠ‚çœå­˜å‚¨ç©ºé—´ã€‚ZFS åœ¨å†…å­˜ä¸­ä¿ç•™ä¸€ä¸ªå»é‡è¡¨ï¼ˆDDTï¼‰æ¥æ£€æµ‹é‡å¤çš„æ•°æ®å—ã€‚è¯¥è¡¨åŒ…å«ä¸€ç³»åˆ—å”¯ä¸€çš„æ ¡éªŒå’Œã€è¿™äº›å—çš„ä½ç½®å’Œå¼•ç”¨è®¡æ•°ã€‚åœ¨å†™å…¥æ–°æ•°æ®æ—¶ï¼ŒZFS è®¡ç®—æ ¡éªŒå’Œå¹¶å°†å…¶ä¸åˆ—è¡¨è¿›è¡Œæ¯”è¾ƒã€‚å½“æ‰¾åˆ°åŒ¹é…é¡¹æ—¶ï¼Œå®ƒä½¿ç”¨ç°æœ‰çš„æ•°æ®å—ã€‚ä½¿ç”¨ SHA256 æ ¡éªŒå’Œç®—æ³•è¿›è¡Œå»é‡æä¾›äº†å®‰å…¨çš„åŠ å¯†å“ˆå¸Œã€‚å»é‡æ˜¯å¯è°ƒæ•´çš„ã€‚å¦‚æœ `dedup` è®¾ç½®ä¸º `on`ï¼Œé‚£ä¹ˆåŒ¹é…çš„æ ¡éªŒå’Œæ„å‘³ç€æ•°æ®æ˜¯ç›¸åŒçš„ã€‚å°† `dedup` è®¾ç½®ä¸º `verify`ï¼ŒZFS å¯¹æ•°æ®æ‰§è¡Œé€å­—èŠ‚çš„æ£€æŸ¥ï¼Œç¡®ä¿å®ƒä»¬å®é™…ä¸Šæ˜¯ç›¸åŒçš„ã€‚å¦‚æœæ•°æ®ä¸ç›¸åŒï¼ŒZFS å°†è®°å½•å“ˆå¸Œå†²çªå¹¶å°†è¿™ä¸¤ä¸ªå—åˆ†åˆ«å­˜å‚¨ã€‚ç”±äº DDT å¿…é¡»å­˜å‚¨æ¯ä¸ªå”¯ä¸€å—çš„å“ˆå¸Œï¼Œå®ƒä¼šæ¶ˆè€—å¤§é‡çš„å†…å­˜ã€‚ä¸€ä¸ªç»éªŒæ³•åˆ™æ˜¯æ¯ 1TB å»é‡æ•°æ®éœ€è¦ 5-6GB çš„ RAMã€‚åœ¨æ— æ³•å®é™…æ‹¥æœ‰è¶³å¤Ÿçš„ RAM æ¥å°†æ•´ä¸ª DDT ä¿ç•™åœ¨å†…å­˜ä¸­çš„æƒ…å†µä¸‹ï¼Œæ€§èƒ½å°†å¤§å¤§é™ä½ï¼Œå› ä¸º DDT å¿…é¡»åœ¨å†™å…¥æ¯ä¸ªæ–°å—ä¹‹å‰ä»ç£ç›˜è¯»å–ã€‚å»é‡å¯ä»¥ä½¿ç”¨ L2ARC æ¥å­˜å‚¨ DDT ï¼Œæä¾›äº†å¿«é€Ÿç³»ç»Ÿå†…å­˜å’Œè¾ƒæ…¢ç£ç›˜ä¹‹é—´çš„æŠ˜ä¸­æ–¹æ¡ˆã€‚è€ƒè™‘ä½¿ç”¨å‹ç¼©ä»£æ›¿ï¼Œå‹ç¼©é€šå¸¸å¯ä»¥æä¾›å‡ ä¹ç›¸åŒçš„ç©ºé—´èŠ‚çœæ•ˆæœï¼Œè€Œä¸éœ€è¦å¢åŠ å†…å­˜ä½¿ç”¨é‡ã€‚·[[zfs-term-scrub]]Scrub¸[[zfs-term-scrub]] ScrubÚ1Instead of a consistency check like man:fsck[8], ZFS has `scrub`. `scrub` reads all data blocks stored on the pool and verifies their checksums against the known good checksums stored in the metadata. A periodic check of all the data stored on the pool ensures the recovery of any corrupted blocks before needing them. A scrub is not required after an unclean shutdown, but good practice is at least once every three months. ZFS verifies the checksum of each block during normal use, but a scrub makes certain to check even infrequently used blocks for silent corruption. ZFS improves data security in archival storage situations. Adjust the relative priority of `scrub` with <<zfs-advanced-tuning-scrub_delay,`vfs.zfs.scrub_delay`>> to prevent the scrub from degrading the performance of other workloads on the pool.Úä¸ man:fsck[8] ç±»ä¼¼çš„ä¸€è‡´æ€§æ£€æŸ¥ä¸åŒï¼ŒZFS ä½¿ç”¨ `scrub` å‘½ä»¤ã€‚`scrub` å‘½ä»¤ä¼šè¯»å–å­˜å‚¨åœ¨æ± ä¸­çš„æ‰€æœ‰æ•°æ®å—ï¼Œå¹¶å°†å®ƒä»¬çš„æ ¡éªŒå’Œä¸å…ƒæ•°æ®ä¸­å­˜å‚¨çš„å·²çŸ¥è‰¯å¥½æ ¡éªŒå’Œè¿›è¡ŒéªŒè¯ã€‚å®šæœŸæ£€æŸ¥æ± ä¸­å­˜å‚¨çš„æ‰€æœ‰æ•°æ®å¯ä»¥ç¡®ä¿åœ¨éœ€è¦ä¹‹å‰æ¢å¤ä»»ä½•æŸåçš„å—ã€‚åœ¨éæ­£å¸¸å…³é—­åä¸éœ€è¦è¿›è¡Œ scrub ï¼Œä½†è‰¯å¥½çš„åšæ³•æ˜¯è‡³å°‘æ¯ä¸‰ä¸ªæœˆè¿›è¡Œä¸€æ¬¡ã€‚ ZFS åœ¨æ­£å¸¸ä½¿ç”¨è¿‡ç¨‹ä¸­ä¼šéªŒè¯æ¯ä¸ªå—çš„æ ¡éªŒå’Œï¼Œä½† scrub ä¼šç¡®ä¿å¯¹å³ä½¿å¾ˆå°‘ä½¿ç”¨çš„å—è¿›è¡Œé™é»˜æŸåæ£€æŸ¥ã€‚ZFS åœ¨å½’æ¡£å­˜å‚¨æƒ…å†µä¸‹æé«˜äº†æ•°æ®å®‰å…¨æ€§ã€‚é€šè¿‡è°ƒæ•´ `scrub` çš„ç›¸å¯¹ä¼˜å…ˆçº§ï¼Œå¯ä»¥ä½¿ç”¨ <<zfs-advanced-tuning-scrub_delay,`vfs.zfs.scrub_delay`>> æ¥é˜²æ­¢ scrub å½±å“æ± ä¸Šå…¶ä»–å·¥ä½œè´Ÿè½½çš„æ€§èƒ½ã€‚¿[[zfs-term-quota]]Dataset QuotaÙ5[[zfs-term-quota]] æ•°æ®é›†é…é¢ï¼ˆDataset Quotaï¼‰ÚµZFS provides fast and accurate dataset, user, and group space accounting as well as quotas and space reservations. This gives the administrator fine grained control over space allocation and allows reserving space for critical file systems. 

ZFS supports different types of quotas: the dataset quota, the <<zfs-term-refquota,reference quota (refquota)>>, the <<zfs-term-userquota,user quota>>, and the <<zfs-term-groupquota,group quota>>.

Quotas limit the total size of a dataset and its descendants, including snapshots of the dataset, child datasets, and the snapshots of those datasets.

[NOTE]
====
Volumes do not support quotas, as the `volsize` property acts as an implicit quota.
====ÚKZFS æä¾›äº†å¿«é€Ÿå‡†ç¡®çš„æ•°æ®é›†ã€ç”¨æˆ·å’Œç»„ç©ºé—´è´¦æˆ·ï¼Œä»¥åŠé…é¢å’Œç©ºé—´é¢„ç•™ã€‚è¿™ä½¿å¾—ç®¡ç†å‘˜å¯ä»¥å¯¹ç©ºé—´åˆ†é…è¿›è¡Œç²¾ç»†æ§åˆ¶ï¼Œå¹¶å…è®¸ä¸ºå…³é”®æ–‡ä»¶ç³»ç»Ÿé¢„ç•™ç©ºé—´ã€‚

ZFS æ”¯æŒä¸åŒç±»å‹çš„é…é¢ï¼šæ•°æ®é›†é…é¢ã€<<zfs-term-refquota,å¼•ç”¨é…é¢ (refquota)>>ã€<<zfs-term-userquota,ç”¨æˆ·é…é¢>> å’Œ <<zfs-term-groupquota,ç»„é…é¢>>ã€‚

é…é¢é™åˆ¶äº†æ•°æ®é›†åŠå…¶åä»£çš„æ€»å¤§å°ï¼ŒåŒ…æ‹¬æ•°æ®é›†çš„å¿«ç…§ã€å­æ•°æ®é›†å’Œè¿™äº›æ•°æ®é›†çš„å¿«ç…§ã€‚
+
[NOTE]
====
å·ä¸æ”¯æŒé…é¢ï¼Œå› ä¸º `volsize` å±æ€§å……å½“éšå¼é…é¢ã€‚
====Ù$[[zfs-term-refquota]]Reference QuotaÙ7[[zfs-term-refquota]] å¼•ç”¨é…é¢ï¼ˆReference Quotaï¼‰ÙïA reference quota limits the amount of space a dataset can consume by enforcing a hard limit. This hard limit includes space referenced by the dataset alone and does not include space used by descendants, such as file systems or snapshots.ÙÕå¼•ç”¨é…é¢é™åˆ¶äº†æ•°æ®é›†å¯ä»¥æ¶ˆè€—çš„ç©ºé—´é‡ï¼Œé€šè¿‡å¼ºåˆ¶æ‰§è¡Œä¸€ä¸ªç¡¬é™åˆ¶ã€‚è¿™ä¸ªç¡¬é™åˆ¶åŒ…æ‹¬æ•°æ®é›†æœ¬èº«å¼•ç”¨çš„ç©ºé—´ï¼Œä½†ä¸åŒ…æ‹¬åä»£ä½¿ç”¨çš„ç©ºé—´ï¼Œæ¯”å¦‚æ–‡ä»¶ç³»ç»Ÿæˆ–å¿«ç…§ã€‚Ù [[zfs-term-userquota]]User QuotaÙ3[[zfs-term-userquota]] ç”¨æˆ·é…é¢ï¼ˆUser Quotaï¼‰ÙOUser quotas are useful to limit the amount of space used by the specified user.ÙEç”¨æˆ·é…é¢å¯¹äºé™åˆ¶æŒ‡å®šç”¨æˆ·ä½¿ç”¨çš„ç©ºé—´é‡éå¸¸æœ‰ç”¨ã€‚Ù"[[zfs-term-groupquota]]Group QuotaÙ2[[zfs-term-groupquota]] ç»„é…é¢ï¼ˆGroup Quotaï¼‰ÙNThe group quota limits the amount of space that a specified group can consume.Ù<ç¾¤ç»„é…é¢é™åˆ¶äº†æŒ‡å®šç¾¤ç»„å¯ä»¥ä½¿ç”¨çš„ç©ºé—´é‡ã€‚Ù+[[zfs-term-reservation]]Dataset ReservationÙG[[zfs-term-reservation]] æ•°æ®é›†é¢„ç•™ç©ºé—´ï¼ˆDataset Reservationï¼‰ÚÚThe `reservation` property makes it possible to guarantee an amount of space for a specific dataset and its descendants. This means that setting a 10 GB reservation on [.filename]#storage/home/bob# prevents other datasets from using up all free space, reserving at least 10 GB of space for this dataset. Unlike a regular <<zfs-term-refreservation,`refreservation`>>, space used by snapshots and descendants is not counted against the reservation. For example, if taking a snapshot of [.filename]#storage/home/bob#, enough disk space other than the `refreservation` amount must exist for the operation to succeed. Descendants of the main data set are not counted in the `refreservation` amount and so do not encroach on the space set.

Reservations of any sort are useful in situations such as planning and testing the suitability of disk space allocation in a new system, or ensuring that enough space is available on file systems for audio logs or system recovery procedures and files.Ú‚`reservation` å±æ€§ä½¿å¾—å¯ä»¥ä¸ºç‰¹å®šæ•°æ®é›†åŠå…¶å­æ•°æ®é›†ä¿è¯ä¸€å®šçš„ç©ºé—´é‡ã€‚è¿™æ„å‘³ç€åœ¨ [.filename]#storage/home/bob# ä¸Šè®¾ç½® 10 GB çš„é¢„ç•™ç©ºé—´ï¼Œå¯ä»¥é˜²æ­¢å…¶ä»–æ•°æ®é›†ä½¿ç”¨å®Œæ‰€æœ‰çš„ç©ºé—²ç©ºé—´ï¼Œè‡³å°‘ä¸ºè¯¥æ•°æ®é›†ä¿ç•™ 10 GB çš„ç©ºé—´ã€‚ä¸å¸¸è§„çš„ <<zfs-term-refreservation,`å¼•ç”¨é¢„ç•™`>> ä¸åŒï¼Œå¿«ç…§å’Œå­æ•°æ®é›†ä½¿ç”¨çš„ç©ºé—´ä¸è®¡å…¥é¢„ç•™ç©ºé—´ã€‚ä¾‹å¦‚ï¼Œå¦‚æœå¯¹ [.filename]#storage/home/bob# è¿›è¡Œå¿«ç…§ï¼Œé™¤äº† `refreservation` çš„ç©ºé—´é‡ä¹‹å¤–ï¼Œå¿…é¡»å­˜åœ¨è¶³å¤Ÿçš„ç£ç›˜ç©ºé—´æ‰èƒ½æˆåŠŸè¿›è¡Œæ“ä½œã€‚ä¸»æ•°æ®é›†çš„å­æ•°æ®é›†ä¸è®¡å…¥ `refreservation` çš„ç©ºé—´é‡ï¼Œå› æ­¤ä¸ä¼šä¾µå è®¾ç½®çš„ç©ºé—´ã€‚

ä»»ä½•ç±»å‹çš„é¢„ç•™ç©ºé—´åœ¨ä»¥ä¸‹æƒ…å†µä¸‹éå¸¸æœ‰ç”¨ï¼šåœ¨æ–°ç³»ç»Ÿä¸­è§„åˆ’å’Œæµ‹è¯•ç£ç›˜ç©ºé—´åˆ†é…çš„é€‚ç”¨æ€§ï¼Œæˆ–ç¡®ä¿æ–‡ä»¶ç³»ç»Ÿä¸Šæœ‰è¶³å¤Ÿçš„ç©ºé—´ç”¨äºéŸ³é¢‘æ—¥å¿—æˆ–ç³»ç»Ÿæ¢å¤ç¨‹åºå’Œæ–‡ä»¶ã€‚Ù0[[zfs-term-refreservation]]Reference ReservationÙC[[zfs-term-refreservation]] å¼•ç”¨é¢„ç•™ï¼ˆReference Reservationï¼‰ÚùThe `refreservation` property makes it possible to guarantee an amount of space for the use of a specific dataset _excluding_ its descendants. This means that setting a 10 GB reservation on [.filename]#storage/home/bob#, and another dataset tries to use the free space, reserving at least 10 GB of space  for this dataset. In contrast to a regular <<zfs-term-reservation,reservation>>, space used by snapshots and descendant datasets is not counted against the reservation. For example, if taking a snapshot of [.filename]#storage/home/bob#, enough disk space other than the `refreservation` amount must exist for the operation to succeed. Descendants of the  main data set are not counted in the `refreservation` amount and so do not encroach on the space set.Ú«`refreservation` å±æ€§ä½¿å¾—å¯ä»¥ä¸ºç‰¹å®šæ•°æ®é›†çš„ä½¿ç”¨ä¿è¯ä¸€å®šçš„ç©ºé—´ï¼Œä½†ä¸åŒ…æ‹¬å…¶å­æ•°æ®é›†ã€‚è¿™æ„å‘³ç€åœ¨ [.filename]#storage/home/bob# ä¸Šè®¾ç½® 10GB çš„ä¿ç•™ç©ºé—´ï¼Œå¦‚æœå¦ä¸€ä¸ªæ•°æ®é›†å°è¯•ä½¿ç”¨ç©ºé—²ç©ºé—´ï¼Œè‡³å°‘è¦ä¿ç•™ 10GB çš„ç©ºé—´ç»™è¯¥æ•°æ®é›†ã€‚ä¸å¸¸è§„çš„ <<zfs-term-reservation, é¢„ç•™ç©ºé—´>> ä¸åŒï¼Œå¿«ç…§å’Œå­æ•°æ®é›†ä½¿ç”¨çš„ç©ºé—´ä¸è®¡å…¥é¢„ç•™ç©ºé—´ã€‚ä¾‹å¦‚ï¼Œå¦‚æœå¯¹ [.filename]#storage/home/bob# è¿›è¡Œå¿«ç…§ï¼Œé™¤äº† `refreservation` çš„ç©ºé—´ä¹‹å¤–ï¼Œå¿…é¡»å­˜åœ¨è¶³å¤Ÿçš„ç£ç›˜ç©ºé—´æ‰èƒ½æˆåŠŸè¿›è¡Œæ“ä½œã€‚ä¸»æ•°æ®é›†çš„å­æ•°æ®é›†ä¸è®¡å…¥ `refreservation` çš„ç©ºé—´ï¼Œå› æ­¤ä¸ä¼šä¾µå è®¾ç½®çš„ç©ºé—´ã€‚½[[zfs-term-resilver]]ResilverÙ*[[zfs-term-resilver]] é‡å»ºï¼ˆResilverï¼‰ÙëWhen replacing a failed disk, ZFS must fill the new disk with the lost data. _Resilvering_ is the process of using the parity information distributed across the remaining drives to calculate and write the missing data to the new drive.ÙÔå½“æ›¿æ¢ä¸€ä¸ªæ•…éšœçš„ç£ç›˜æ—¶ï¼Œ ZFS å¿…é¡»ç”¨ä¸¢å¤±çš„æ•°æ®å¡«å……æ–°çš„ç£ç›˜ã€‚_é‡å»º_ æ˜¯ä½¿ç”¨åˆ†å¸ƒåœ¨å‰©ä½™é©±åŠ¨å™¨ä¸Šçš„å¥‡å¶æ ¡éªŒä¿¡æ¯æ¥è®¡ç®—å¹¶å°†ä¸¢å¤±çš„æ•°æ®å†™å…¥æ–°é©±åŠ¨å™¨çš„è¿‡ç¨‹ã€‚º[[zfs-term-online]] OnlineÙ&[[zfs-term-online]] åœ¨çº¿ï¼ˆOnlineï¼‰Ù–A pool or vdev in the `Online` state has its member devices connected and fully operational. Individual devices in the `Online` state are functioning.ÙŒå¤„äº `åœ¨çº¿` çŠ¶æ€çš„æ± æˆ– vdev å…·æœ‰å…¶æˆå‘˜è®¾å¤‡è¿æ¥å¹¶å®Œå…¨è¿è¡Œã€‚å¤„äº `åœ¨çº¿` çŠ¶æ€çš„ä¸ªåˆ«è®¾å¤‡æ­£åœ¨æ­£å¸¸è¿è¡Œã€‚»[[zfs-term-offline]]OfflineÙ([[zfs-term-offline]] ç¦»çº¿ï¼ˆOfflineï¼‰ÚThe administrator puts individual devices in an `Offline` state if enough redundancy exists to avoid putting the pool or vdev into a <<zfs-term-faulted,Faulted>> state. An administrator may choose to offline a disk in preparation for replacing it, or to make it easier to identify.Úå¦‚æœå­˜åœ¨è¶³å¤Ÿçš„å†—ä½™ä»¥é¿å…ä½¿å­˜å‚¨æ± æˆ–è™šæ‹Ÿè®¾å¤‡è¿›å…¥ <<zfs-term-faulted,æ•…éšœ>> çŠ¶æ€ï¼Œç®¡ç†å‘˜ä¼šå°†å•ä¸ªè®¾å¤‡è®¾ç½®ä¸º `ç¦»çº¿` çŠ¶æ€ã€‚ç®¡ç†å‘˜å¯ä»¥é€‰æ‹©å°†ç£ç›˜è®¾ç½®ä¸ºç¦»çº¿çŠ¶æ€ï¼Œä»¥ä¾¿å‡†å¤‡æ›´æ¢å®ƒï¼Œæˆ–è€…ä¸ºäº†æ›´å®¹æ˜“è¯†åˆ«ã€‚½[[zfs-term-degraded]]DegradedÙ*[[zfs-term-degraded]] é™çº§ï¼ˆDegradedï¼‰Ú‰A pool or vdev in the `Degraded` state has one or more disks that disappeared or failed. The pool is still usable, but if other devices fail, the pool may become unrecoverable. Reconnecting the missing devices or replacing the failed disks will return the pool to an <<zfs-term-online,Online>> state after the reconnected or new device has completed the <<zfs-term-resilver,Resilver>> process.ÚOå¤„äº `é™çº§` çŠ¶æ€çš„æ± æˆ– vdev æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªç£ç›˜æ¶ˆå¤±æˆ–å¤±è´¥ã€‚æ± ä»ç„¶å¯ç”¨ï¼Œä½†å¦‚æœå…¶ä»–è®¾å¤‡å¤±è´¥ï¼Œæ± å¯èƒ½å˜å¾—æ— æ³•æ¢å¤ã€‚é‡æ–°è¿æ¥ä¸¢å¤±çš„è®¾å¤‡æˆ–æ›¿æ¢å¤±è´¥çš„ç£ç›˜å°†åœ¨é‡æ–°è¿æ¥æˆ–æ–°è®¾å¤‡å®Œæˆ <<zfs-term-resilver,é‡å»º>> è¿‡ç¨‹åå°†æ± æ¢å¤åˆ° <<zfs-term-online,åœ¨çº¿>> çŠ¶æ€ã€‚»[[zfs-term-faulted]]FaultedÙ([[zfs-term-faulted]] æ•…éšœï¼ˆFaultedï¼‰ÚÌA pool or vdev in the `Faulted` state is no longer operational. Accessing the data is no longer possible. A pool or vdev enters the `Faulted` state when the number of missing or failed devices exceeds the level of redundancy in the vdev. If reconnecting missing devices the pool will return to an <<zfs-term-online,Online>> state. Insufficient redundancy to compensate for the number of failed disks loses the pool contents and requires restoring from backups.Únå¤„äº `æ•…éšœ` çŠ¶æ€çš„æ± æˆ– vdev ä¸å†å¯æ“ä½œã€‚æ— æ³•è®¿é—®æ•°æ®ã€‚å½“ç¼ºå¤±æˆ–æ•…éšœè®¾å¤‡çš„æ•°é‡è¶…è¿‡ vdev ä¸­çš„å†—ä½™çº§åˆ«æ—¶ï¼Œæ± æˆ– vdev è¿›å…¥ `æ•…éšœ` çŠ¶æ€ã€‚å¦‚æœé‡æ–°è¿æ¥ç¼ºå¤±çš„è®¾å¤‡ï¼Œæ± å°†è¿”å›åˆ° <<zfs-term-online,åœ¨çº¿>> çŠ¶æ€ã€‚å†—ä½™ä¸è¶³ä»¥å¼¥è¡¥æ•…éšœç£ç›˜æ•°é‡ä¼šå¯¼è‡´æ± å†…å®¹ä¸¢å¤±ï¼Œå¹¶éœ€è¦ä»å¤‡ä»½ä¸­æ¢å¤ã€‚ÙRJails improve on the concept of the traditional chroot environment in several waysÙ>Jails åœ¨å¤šä¸ªæ–¹é¢æ”¹è¿›äº†ä¼ ç»Ÿ chroot ç¯å¢ƒçš„æ¦‚å¿µã€‚Ù Chapter 17. Jails and Containersºç¬¬ 17 ç«  Jails å’Œå®¹å™¨´Jails and Containers¯Jails å’Œå®¹å™¨Ú²Since system administration is a difficult task, many tools have been developed to make life easier for the administrator.  These tools often enhance the way systems are installed, configured, and maintained.  One of the tools which can be used to enhance the security of a FreeBSD system is _jails_.  Jails have been available since FreeBSD 4.X and continue to be enhanced in their usefulness, performance, reliability, and security.Úeç”±äºç³»ç»Ÿç®¡ç†æ˜¯ä¸€é¡¹å›°éš¾çš„ä»»åŠ¡ï¼Œå› æ­¤å¼€å‘äº†è®¸å¤šå·¥å…·æ¥ç®€åŒ–ç®¡ç†å‘˜çš„å·¥ä½œã€‚è¿™äº›å·¥å…·é€šå¸¸å¯ä»¥å¢å¼ºç³»ç»Ÿçš„å®‰è£…ã€é…ç½®å’Œç»´æŠ¤æ–¹å¼ã€‚å…¶ä¸­ä¸€ä¸ªå¯ä»¥ç”¨æ¥å¢å¼º FreeBSD ç³»ç»Ÿå®‰å…¨æ€§çš„å·¥å…·æ˜¯ _jails_ã€‚è‡ª FreeBSD 4.X ä»¥æ¥ï¼ŒJails ä¸€ç›´åœ¨å…¶æœ‰ç”¨æ€§ã€æ€§èƒ½ã€å¯é æ€§å’Œå®‰å…¨æ€§æ–¹é¢å¾—åˆ°æ”¹è¿›ã€‚ÚŸJails build upon the man:chroot[2] concept, which is used to change the root directory of a set of processes.  This creates a safe environment, separate from the rest of the system.  Processes created in the chrooted environment can not access files or resources outside of it.  For that reason, compromising a service running in a chrooted environment should not allow the attacker to compromise the entire system.ÚKJails æ˜¯åŸºäº man:chroot[2] æ¦‚å¿µæ„å»ºçš„ï¼Œè¯¥æ¦‚å¿µç”¨äºæ›´æ”¹ä¸€ç»„è¿›ç¨‹çš„æ ¹ç›®å½•ã€‚è¿™æ ·å¯ä»¥åˆ›å»ºä¸€ä¸ªä¸ç³»ç»Ÿå…¶ä½™éƒ¨åˆ†åˆ†ç¦»çš„å®‰å…¨ç¯å¢ƒã€‚åœ¨ chroot ç¯å¢ƒä¸­åˆ›å»ºçš„è¿›ç¨‹æ— æ³•è®¿é—®å…¶å¤–éƒ¨çš„æ–‡ä»¶æˆ–èµ„æºã€‚å› æ­¤ï¼Œå…¥ä¾µ chroot ç¯å¢ƒä¸­è¿è¡Œçš„æœåŠ¡ä¸åº”å…è®¸æ”»å‡»è€…å±å®³æ•´ä¸ªç³»ç»Ÿã€‚ÚHowever, a chroot has several limitations.  It is suited to easy tasks which do not require much flexibility or complex, advanced features.  Over time, many ways have been found to escape from a chrooted environment, making it a less than ideal solution for securing services.Ùóç„¶è€Œï¼Œchroot æœ‰ä¸€äº›é™åˆ¶ã€‚å®ƒé€‚ç”¨äºä¸éœ€è¦å¤ªå¤šçµæ´»æ€§æˆ–å¤æ‚é«˜çº§åŠŸèƒ½çš„ç®€å•ä»»åŠ¡ã€‚éšç€æ—¶é—´çš„æ¨ç§»ï¼Œäººä»¬å‘ç°äº†è®¸å¤šé€ƒç¦» chroot ç¯å¢ƒçš„æ–¹æ³•ï¼Œä½¿å…¶æˆä¸ºä¸å¤ªç†æƒ³çš„ä¿æŠ¤æœåŠ¡çš„è§£å†³æ–¹æ¡ˆã€‚ÙSJails improve on the concept of the traditional chroot environment in several ways.Ù>Jails åœ¨å¤šä¸ªæ–¹é¢æ”¹è¿›äº†ä¼ ç»Ÿ chroot ç¯å¢ƒçš„æ¦‚å¿µã€‚Ú5In a traditional chroot environment, processes are only limited in the part of the file system they can access.  The rest of the system resources, system users, running processes, and the networking subsystem are shared by the chrooted processes and the processes of the host system.  Jails expand this model by virtualizing access to the file system, the set of users, and the networking subsystem.  More fine-grained controls are available for tuning the access of a jailed environment.  Jails can be considered as a type of operating system-level virtualization.Ú´åœ¨ä¼ ç»Ÿçš„ chroot ç¯å¢ƒä¸­ï¼Œè¿›ç¨‹åªèƒ½è®¿é—®æ–‡ä»¶ç³»ç»Ÿçš„ä¸€éƒ¨åˆ†ã€‚å…¶ä½™çš„ç³»ç»Ÿèµ„æºã€ç³»ç»Ÿç”¨æˆ·ã€è¿è¡Œä¸­çš„è¿›ç¨‹å’Œç½‘ç»œå­ç³»ç»Ÿç”± chroot è¿›ç¨‹å’Œä¸»æœºç³»ç»Ÿçš„è¿›ç¨‹å…±äº«ã€‚Jails é€šè¿‡è™šæ‹ŸåŒ–å¯¹æ–‡ä»¶ç³»ç»Ÿã€ç”¨æˆ·é›†å’Œç½‘ç»œå­ç³»ç»Ÿçš„è®¿é—®æ¥æ‰©å±•è¿™ä¸ªæ¨¡å‹ã€‚å¯ä»¥ä½¿ç”¨æ›´ç²¾ç»†çš„æ§åˆ¶æ¥è°ƒæ•´è¢«ç›‘ç¦ç¯å¢ƒçš„è®¿é—®æƒé™ã€‚Jails å¯ä»¥è¢«çœ‹ä½œæ˜¯ä¸€ç§æ“ä½œç³»ç»Ÿçº§åˆ«çš„è™šæ‹ŸåŒ–ã€‚ÙFWhat a jail is and what purpose it may serve in FreeBSD installations.ÙGåœ¨ FreeBSD å®‰è£…ä¸­ï¼Œjail æ˜¯ä»€ä¹ˆä»¥åŠå®ƒå¯èƒ½èµ·åˆ°çš„ä½œç”¨ã€‚¼The different types of jail.·ä¸åŒç±»å‹çš„ jailã€‚Ù7The different ways to configure the network for a jail.Ù$é…ç½® jail ç½‘ç»œçš„ä¸åŒæ–¹æ³•ã€‚¼The jail configuration file.´jail é…ç½®æ–‡ä»¶ã€‚Ù*How to create the different types of jail.Ù#å¦‚ä½•åˆ›å»ºä¸åŒç±»å‹çš„ jailã€‚Ù'How to start, stop, and restart a jail.Ù,å¦‚ä½•å¯åŠ¨ã€åœæ­¢å’Œé‡å¯ä¸€ä¸ª jailã€‚ÙIThe basics of jail administration, both from inside and outside the jail.ÙDjail ç®¡ç†çš„åŸºç¡€çŸ¥è¯†ï¼ŒåŒ…æ‹¬ jail å†…éƒ¨å’Œå¤–éƒ¨çš„ç®¡ç†ã€‚Ù+How to upgrade the different types of jail.Ù#å¦‚ä½•å‡çº§ä¸åŒç±»å‹çš„ jailã€‚Ù9A incomplete list of the different FreeBSD jail managers.Ù2ä¸€ä¸ªä¸å®Œæ•´çš„ FreeBSD jail ç®¡ç†å™¨åˆ—è¡¨ã€‚ªJail Types«Jail ç±»å‹ÙäSome administrators divide jails into different types, although the underlying technology is the same.  Each administrator will have to assess what type of jail to create in each case depending on the problem they have to solve.Ù¿ä¸€äº›ç®¡ç†å‘˜å°† jail åˆ†ä¸ºä¸åŒç±»å‹ï¼Œå°½ç®¡åº•å±‚æŠ€æœ¯æ˜¯ç›¸åŒçš„ã€‚æ¯ä¸ªç®¡ç†å‘˜éƒ½å¿…é¡»æ ¹æ®ä»–ä»¬éœ€è¦è§£å†³çš„é—®é¢˜æ¥è¯„ä¼°åœ¨æ¯ç§æƒ…å†µä¸‹åˆ›å»ºå“ªç§ç±»å‹çš„ jailã€‚ÙdBelow can be found a list of the different types, their characteristics, and considerations for use.ÙZä¸‹é¢æ˜¯ä¸åŒç±»å‹çš„åˆ—è¡¨ï¼ŒåŒ…æ‹¬å®ƒä»¬çš„ç‰¹ç‚¹å’Œä½¿ç”¨æ—¶éœ€è¦è€ƒè™‘çš„äº‹é¡¹ã€‚«Thick Jails´åšï¼ˆThickï¼‰Jails Ú A thick jail is a traditional form of FreeBSD Jail.  In a thick jail, a complete copy of the base system is replicated within the jail's environment.  This means that the jail has its own separate instance of the FreeBSD base system, including libraries, executables, and configuration files.  The jail can be thought of as an almost complete standalone FreeBSD installation, but running within the confines of the host system.  This isolation ensures that the processes within the jail are kept separate from those on the host and other jails.Ú²åš jail æ˜¯ FreeBSD jail çš„ä¸€ç§ä¼ ç»Ÿå½¢å¼ã€‚åœ¨åš jail ä¸­ï¼ŒåŸºæœ¬ç³»ç»Ÿçš„å®Œæ•´å‰¯æœ¬è¢«å¤åˆ¶åˆ° jail çš„ç¯å¢ƒä¸­ã€‚è¿™æ„å‘³ç€ jail æ‹¥æœ‰è‡ªå·±ç‹¬ç«‹çš„ FreeBSD åŸºæœ¬ç³»ç»Ÿå®ä¾‹ï¼ŒåŒ…æ‹¬åº“ã€å¯æ‰§è¡Œæ–‡ä»¶å’Œé…ç½®æ–‡ä»¶ã€‚å¯ä»¥å°† jail è§†ä¸ºä¸€ä¸ªå‡ ä¹å®Œæ•´çš„ç‹¬ç«‹ FreeBSD å®‰è£…ï¼Œä½†åœ¨ä¸»æœºç³»ç»Ÿçš„é™åˆ¶ä¸‹è¿è¡Œã€‚è¿™ç§éš”ç¦»ç¡®ä¿ jail å†…çš„è¿›ç¨‹ä¸ä¸»æœºå’Œå…¶ä»– jail ä¸­çš„è¿›ç¨‹ä¿æŒåˆ†ç¦»ã€‚ºAdvantages of Thick Jails:¶åš Jails çš„ä¼˜åŠ¿ï¼šÙfHigh degree of isolation: Processes within the jail are isolated from the host system and other jails.ÙVé«˜åº¦éš”ç¦»æ€§ï¼šjail å†…çš„è¿›ç¨‹ä¸ä¸»æœºç³»ç»Ÿå’Œå…¶ä»– jail ä¹‹é—´æ˜¯éš”ç¦»çš„ã€‚Ù…Independence: Thick jails can have different versions of libraries, configurations, and software than the host system or other jails.Ùfç‹¬ç«‹æ€§ï¼šåš jail å¯ä»¥æ‹¥æœ‰ä¸ä¸»æœºç³»ç»Ÿæˆ–å…¶ä»– jail ä¸åŒç‰ˆæœ¬çš„åº“ã€é…ç½®å’Œè½¯ä»¶ã€‚ÙSecurity: Since the jail contains its own base system, vulnerabilities or issues affecting the jail environment won't directly impact the host or other jails.Ù†å®‰å…¨æ€§ï¼šç”±äº jail åŒ…å«äº†è‡ªå·±çš„åŸºæœ¬ç³»ç»Ÿï¼Œå½±å“ jail ç¯å¢ƒçš„æ¼æ´æˆ–é—®é¢˜ä¸ä¼šç›´æ¥å½±å“ä¸»æœºæˆ–å…¶ä»– jailã€‚½Disadvantages of Thick Jails:¶åš Jails çš„ç¼ºç‚¹ï¼šÙ‡Resource overhead: Because each jail maintains its own separate base system, thick jails consume more resources compared to thin jails.Ù€èµ„æºå¼€é”€ï¼šç”±äºæ¯ä¸ª jail éƒ½ç»´æŠ¤ç€è‡ªå·±ç‹¬ç«‹çš„åŸºç¡€ç³»ç»Ÿï¼Œç›¸æ¯”äºè–„ jailï¼Œåš jail æ¶ˆè€—æ›´å¤šçš„èµ„æºã€‚Ù_Maintenance: Each jail requires its own maintenance and updates for its base system components.ÙNç»´æŠ¤ï¼šæ¯ä¸ª jail éƒ½éœ€è¦å¯¹å…¶åŸºæœ¬ç³»ç»Ÿç»„ä»¶è¿›è¡Œç»´æŠ¤å’Œæ›´æ–°ã€‚ªThin Jails³è–„ï¼ˆThinï¼‰Jails Ú¨A thin jail shares the base system using OpenZFS snapshots or NullFS mounts from a template.  Only a minimal subset of base system is duplicated for each thin jail, resulting in less resource consumption compared to a thick jail.  However, this also means that thin jails have less isolation and independence compared to thick jails.  Changes in shared components could potentially affect multiple thin jails simultaneously.ÚBè–„ jail ä½¿ç”¨ OpenZFS å¿«ç…§æˆ– NullFS æŒ‚è½½ä»æ¨¡æ¿å…±äº«åŸºç¡€ç³»ç»Ÿã€‚æ¯ä¸ªè–„ jail ä»…å¤åˆ¶åŸºç¡€ç³»ç»Ÿçš„æœ€å°å­é›†ï¼Œä¸åš jail ç›¸æ¯”ï¼Œèµ„æºæ¶ˆè€—æ›´å°‘ã€‚ç„¶è€Œï¼Œè¿™ä¹Ÿæ„å‘³ç€è–„ jail ä¸åš jail ç›¸æ¯”å…·æœ‰è¾ƒå°‘çš„éš”ç¦»æ€§å’Œç‹¬ç«‹æ€§ã€‚å…±äº«ç»„ä»¶çš„æ›´æ”¹å¯èƒ½ä¼šåŒæ—¶å½±å“å¤šä¸ªè–„ jailã€‚Ù¡In summary, a FreeBSD Thin Jail is a type of FreeBSD Jail that replicates a substantial portion, but not all, of the base system within the isolated environment.ÙŠç®€è€Œè¨€ä¹‹ï¼ŒFreeBSD è–„ Jail æ˜¯ä¸€ç§ FreeBSD Jailï¼Œå®ƒåœ¨éš”ç¦»ç¯å¢ƒä¸­å¤åˆ¶äº†åŸºæœ¬ç³»ç»Ÿçš„å¤§éƒ¨åˆ†å†…å®¹ï¼Œä½†å¹¶éå…¨éƒ¨ã€‚¹Advantages of Thin Jails:¶è–„ Jails çš„ä¼˜åŠ¿ï¼šÚResource Efficiency: Thin jails are more resource-efficient compared to thick jails. Since they share most of the base system, they consume less disk space and memory. This makes it possible to run more jails on the same hardware without consuming excessive resources.Úèµ„æºæ•ˆç‡ï¼šä¸åš jail ç›¸æ¯”ï¼Œè–„ jail åœ¨èµ„æºåˆ©ç”¨ä¸Šæ›´é«˜æ•ˆã€‚ç”±äºå®ƒä»¬å…±äº«å¤§éƒ¨åˆ†åŸºç¡€ç³»ç»Ÿï¼Œæ‰€ä»¥å ç”¨çš„ç£ç›˜ç©ºé—´å’Œå†…å­˜è¾ƒå°‘ã€‚è¿™ä½¿å¾—åœ¨åŒä¸€ç¡¬ä»¶ä¸Šè¿è¡Œæ›´å¤šçš„ jail æˆä¸ºå¯èƒ½ï¼Œè€Œä¸ä¼šæ¶ˆè€—è¿‡å¤šçš„èµ„æºã€‚Ù»Faster Deployment: Creating and launching thin jails is generally faster compared to thick jails. This can be particularly advantageous when you need to rapidly deploy multiple instances.Ù™æ›´å¿«çš„éƒ¨ç½²ï¼šåˆ›å»ºå’Œå¯åŠ¨è–„ jail é€šå¸¸æ¯”åˆ›å»ºå’Œå¯åŠ¨åš jail æ›´å¿«ã€‚å½“æ‚¨éœ€è¦å¿«é€Ÿéƒ¨ç½²å¤šä¸ªå®ä¾‹æ—¶ï¼Œè¿™å¯èƒ½ç‰¹åˆ«æœ‰ä¼˜åŠ¿ã€‚ÚSUnified Maintenance: Since thin jails share the majority of their base system with the host system, updates and maintenance of common base system components (such as libraries and binaries) only need to be done once on the host. This simplifies the maintenance process compared to maintaining an individual base system for each thick jail.Úç»Ÿä¸€ç»´æŠ¤ï¼šç”±äºè–„ jail ä¸ä¸»æœºç³»ç»Ÿå…±äº«å¤§éƒ¨åˆ†åŸºç¡€ç³»ç»Ÿï¼ˆå¦‚åº“å’ŒäºŒè¿›åˆ¶æ–‡ä»¶ï¼‰ï¼Œå› æ­¤åªéœ€è¦åœ¨ä¸»æœºä¸Šè¿›è¡Œä¸€æ¬¡æ›´æ–°å’Œç»´æŠ¤å¸¸è§çš„åŸºç¡€ç³»ç»Ÿç»„ä»¶ã€‚ä¸ä¸ºæ¯ä¸ªåš jail ç»´æŠ¤å•ç‹¬çš„åŸºç¡€ç³»ç»Ÿç›¸æ¯”ï¼Œè¿™ç®€åŒ–äº†ç»´æŠ¤è¿‡ç¨‹ã€‚ÙìShared Resources: Thin jails can more easily share common resources such as libraries and binaries with the host system. This can potentially lead to more efficient disk caching and improved performance for applications within the jail.ÙÀå…±äº«èµ„æºï¼šè–„ jail å¯ä»¥æ›´è½»æ¾åœ°ä¸ä¸»æœºç³»ç»Ÿå…±äº«å¸¸è§çš„èµ„æºï¼Œå¦‚åº“å’ŒäºŒè¿›åˆ¶æ–‡ä»¶ã€‚è¿™å¯èƒ½ä¼šå¯¼è‡´æ›´é«˜æ•ˆçš„ç£ç›˜ç¼“å­˜å’Œ jail å†…åº”ç”¨ç¨‹åºçš„æ€§èƒ½æ”¹å–„ã€‚¼Disadvantages of Thin Jails:¶è–„ Jails çš„ç¼ºç‚¹ï¼šÚ(Reduced Isolation: The primary disadvantage of thin jails is that they offer less isolation compared to thick jails. Since they share a significant portion of the template's base system, vulnerabilities or issues affecting shared components could potentially impact multiple jails simultaneously.ÙÔé™ä½çš„éš”ç¦»æ€§ï¼šè–„ jail çš„ä¸»è¦ç¼ºç‚¹æ˜¯ç›¸æ¯”äºåš jailï¼Œå®ƒä»¬æä¾›çš„éš”ç¦»æ€§è¾ƒä½ã€‚ç”±äºå®ƒä»¬å…±äº«æ¨¡æ¿åŸºç¡€ç³»ç»Ÿçš„å¤§éƒ¨åˆ†å†…å®¹ï¼Œå¯èƒ½ä¼šåŒæ—¶å½±å“å¤šä¸ª jail çš„æ¼æ´æˆ–é—®é¢˜ã€‚Ù¶Security Concerns: The reduced isolation in thin jails could pose security risks, as a compromise in one jail might have a greater potential to affect other jails or the host system.Ù¨å®‰å…¨é—®é¢˜ï¼šè–„ jail ä¸­å‡å°‘çš„éš”ç¦»æ€§å¯èƒ½ä¼šå¸¦æ¥å®‰å…¨é£é™©ï¼Œå› ä¸ºä¸€ä¸ª jail çš„å¦¥åå¯èƒ½å¯¹å…¶ä»– jail æˆ–ä¸»æœºç³»ç»Ÿäº§ç”Ÿæ›´å¤§çš„å½±å“æ½œåŠ›ã€‚ÙáDependency Conflicts: If multiple thin jails require different versions of the same libraries or software, managing dependencies can become complex. In some cases, this might require additional effort to ensure compatibility.ÙÆä¾èµ–å†²çªï¼šå¦‚æœå¤šä¸ªç‹¬ç«‹çš„å®¹å™¨éœ€è¦ä¸åŒç‰ˆæœ¬çš„ç›¸åŒåº“æˆ–è½¯ä»¶ï¼Œç®¡ç†ä¾èµ–å…³ç³»å¯èƒ½ä¼šå˜å¾—å¤æ‚ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œè¿™å¯èƒ½éœ€è¦é¢å¤–çš„åŠªåŠ›æ¥ç¡®ä¿å…¼å®¹æ€§ã€‚ÙÑCompatibility Challenges: Applications within a thin jail might encounter compatibility issues if they assume a certain base system environment that differs from the shared components provided by the template.Ù¨å…¼å®¹æ€§æŒ‘æˆ˜ï¼šåœ¨ä¸€ä¸ªè–„ jail ä¸­ï¼Œåº”ç”¨ç¨‹åºå¯èƒ½ä¼šé‡åˆ°å…¼å®¹æ€§é—®é¢˜ï¼Œå¦‚æœå®ƒä»¬å‡è®¾æŸä¸ªåŸºæœ¬ç³»ç»Ÿç¯å¢ƒä¸æ¨¡æ¿æä¾›çš„å…±äº«ç»„ä»¶ä¸åŒã€‚ªVNET JailsªVNET JailsÚsA FreeBSD VNET jail is a virtualized environment that allows for the isolation and control of network resources for processes running within it.  It provides a high level of network segmentation and security by creating a separate network stack for processes within the jail, ensuring that network traffic within the jail is isolated from the host system and other jails.Ú*FreeBSD VNET  jail æ˜¯ä¸€ç§è™šæ‹ŸåŒ–ç¯å¢ƒï¼Œå…è®¸å¯¹å…¶ä¸­è¿è¡Œçš„è¿›ç¨‹çš„ç½‘ç»œèµ„æºè¿›è¡Œéš”ç¦»å’Œæ§åˆ¶ã€‚å®ƒé€šè¿‡ä¸º jail å†…çš„è¿›ç¨‹åˆ›å»ºå•ç‹¬çš„ç½‘ç»œå †æ ˆï¼Œç¡®ä¿ jail å†…çš„ç½‘ç»œæµé‡ä¸ä¸»æœºç³»ç»Ÿå’Œå…¶ä»– jail éš”ç¦»ï¼Œä»è€Œæä¾›äº†é«˜çº§åˆ«çš„ç½‘ç»œåˆ†å‰²å’Œå®‰å…¨æ€§ã€‚Ù…In essence, FreeBSD VNET jails add a network configuration mechanism.  This means a VNET jail can be created as a Thick or Thin Jail.Ùzå®è´¨ä¸Šï¼ŒFreeBSD VNET jails æ·»åŠ äº†ä¸€ç§ç½‘ç»œé…ç½®æœºåˆ¶ã€‚è¿™æ„å‘³ç€ VNET jail å¯ä»¥åˆ›å»ºä¸ºåšæˆ–è–„ Jailã€‚ÚäA FreeBSD Linux Jail is a feature in the FreeBSD operating system that enables the use of Linux binaries and applications within a FreeBSD jail.  This functionality is achieved by incorporating a compatibility layer that allows certain Linux system calls and libraries to be translated and executed on the FreeBSD kernel.  The purpose of a Linux Jail is to facilitate the execution of Linux software on a FreeBSD system without needing a separate Linux virtual machine or environment.Ú†FreeBSD Linux Jail æ˜¯ FreeBSD æ“ä½œç³»ç»Ÿä¸­çš„ä¸€ä¸ªåŠŸèƒ½ï¼Œå®ƒå…è®¸åœ¨ FreeBSD jail ä¸­ä½¿ç”¨ Linux äºŒè¿›åˆ¶æ–‡ä»¶å’Œåº”ç”¨ç¨‹åºã€‚é€šè¿‡å¼•å…¥ä¸€ä¸ªå…¼å®¹å±‚ï¼Œè¯¥åŠŸèƒ½å¯ä»¥å®ç°å°†æŸäº› Linux ç³»ç»Ÿè°ƒç”¨å’Œåº“è½¬æ¢å¹¶åœ¨ FreeBSD å†…æ ¸ä¸Šæ‰§è¡Œã€‚Linux Jail çš„ç›®çš„æ˜¯åœ¨ä¸éœ€è¦å•ç‹¬çš„ Linux è™šæ‹Ÿæœºæˆ–ç¯å¢ƒçš„æƒ…å†µä¸‹ï¼Œåœ¨ FreeBSD ç³»ç»Ÿä¸Šæ‰§è¡Œ Linux è½¯ä»¶ã€‚²Host Configuration¬ä¸»æœºé…ç½®ÙBefore creating any jail on the host system it is necessary to perform certain configuration and obtain some information from the host system.Ùoåœ¨ä¸»æœºç³»ç»Ÿä¸Šåˆ›å»ºä»»ä½• jail ä¹‹å‰ï¼Œéœ€è¦è¿›è¡Œä¸€äº›é…ç½®å¹¶ä»ä¸»æœºç³»ç»Ÿä¸­è·å–ä¸€äº›ä¿¡æ¯ã€‚ÙêIt will be necessary to configure the man:jail[8] utility, create the necessary directories to configure and install jails, obtain information from the host's network, and check whether the host uses OpenZFS or UFS as its file system.Ù½éœ€è¦é…ç½® man:jail[8] å®ç”¨ç¨‹åºï¼Œåˆ›å»ºå¿…è¦çš„ç›®å½•æ¥é…ç½®å’Œå®‰è£… jailsï¼Œä»ä¸»æœºçš„ç½‘ç»œè·å–ä¿¡æ¯ï¼Œå¹¶æ£€æŸ¥ä¸»æœºæ˜¯å¦ä½¿ç”¨ OpenZFS æˆ– UFS ä½œä¸ºå…¶æ–‡ä»¶ç³»ç»Ÿã€‚Ù^The FreeBSD version running in the jail can not be newer than the version running in the host.ÙNåœ¨ jail ä¸­è¿è¡Œçš„ FreeBSD ç‰ˆæœ¬ä¸èƒ½æ¯”ä¸»æœºä¸­è¿è¡Œçš„ç‰ˆæœ¬æ›´æ–°ã€‚¬Jail Utility±Jail å®ç”¨å·¥å…·Ù&The man:jail[8] utility manages jails.Ù-man:jail[8] å®ç”¨ç¨‹åºç”¨äºç®¡ç† jailsã€‚ÙATo start jails when the system boots, run the following commands:Ù<è¦åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶å¯åŠ¨ jailsï¼Œè¯·è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼šÙSWith `jail_parallel_start`, all configured jails will be started in the background.ÙIä½¿ç”¨ `jail_parallel_start`ï¼Œæ‰€æœ‰é…ç½®çš„ jail å°†åœ¨åå°å¯åŠ¨ã€‚ªNetworking¦ç½‘ç»œÙFNetworking for FreeBSD jails can be configured several different ways:Ù8FreeBSD jails çš„ç½‘ç»œé…ç½®æœ‰å¤šç§ä¸åŒçš„æ–¹å¼ï¼šÙ!Host Networking Mode (IP Sharing)Ù!ä¸»æœºç½‘ç»œæ¨¡å¼ï¼ˆIP å…±äº«ï¼‰Ú/In host networking mode, a jail shares the same networking stack as the host system.  When a jail is created in host networking mode it uses the same network interface and IP address.  This means that the jail doesn't have a separate IP address, and its network traffic is associated with the host's IP.Úåœ¨ä¸»æœºç½‘ç»œæ¨¡å¼ä¸‹ï¼Œä¸€ä¸ª jail ä¸ä¸»æœºç³»ç»Ÿå…±äº«ç›¸åŒçš„ç½‘ç»œå †æ ˆã€‚å½“ä¸€ä¸ª jail åœ¨ä¸»æœºç½‘ç»œæ¨¡å¼ä¸‹åˆ›å»ºæ—¶ï¼Œå®ƒä½¿ç”¨ç›¸åŒçš„ç½‘ç»œæ¥å£å’Œ IP åœ°å€ã€‚è¿™æ„å‘³ç€ jail æ²¡æœ‰å•ç‹¬çš„ IP åœ°å€ï¼Œå®ƒçš„ç½‘ç»œæµé‡ä¸ä¸»æœºçš„ IP åœ°å€ç›¸å…³è”ã€‚·Virtual Networks (VNET)¶è™šæ‹Ÿç½‘ç»œï¼ˆVNETï¼‰ÚÁVirtual Networks are a feature of FreeBSD jails that offer more advanced and flexible networking solutions than a basic networking mode like host networking.  VNET allows the creation of isolated network stacks for each jail, providing them with their own separate IP addresses, routing tables, and network interfaces.  This offers a higher level of network isolation and allows jails to function as if they are running on separate virtual machines.Úfè™šæ‹Ÿç½‘ç»œæ˜¯ FreeBSD jails çš„ä¸€ä¸ªç‰¹æ€§ï¼Œæä¾›æ¯”ä¸»æœºç½‘ç»œç­‰åŸºæœ¬ç½‘ç»œæ¨¡å¼æ›´é«˜çº§å’Œçµæ´»çš„ç½‘ç»œè§£å†³æ–¹æ¡ˆã€‚VNET å…è®¸ä¸ºæ¯ä¸ª jail åˆ›å»ºéš”ç¦»çš„ç½‘ç»œå †æ ˆï¼Œä¸ºå®ƒä»¬æä¾›ç‹¬ç«‹çš„ IP åœ°å€ã€è·¯ç”±è¡¨å’Œç½‘ç»œæ¥å£ã€‚è¿™æä¾›äº†æ›´é«˜çº§åˆ«çš„ç½‘ç»œéš”ç¦»ï¼Œå¹¶å…è®¸ jails åƒè¿è¡Œåœ¨ç‹¬ç«‹çš„è™šæ‹Ÿæœºä¸Šä¸€æ ·è¿è¡Œã€‚³The netgraph system¯netgraph ç³»ç»ŸÙÎman:netgraph[4] is a versatile kernel framework for creating custom network configurations.  It can be used to define how network traffic flows between jails and the host system and between different jails.ÙÆman:netgraph[4] æ˜¯ä¸€ä¸ªå¤šåŠŸèƒ½çš„å†…æ ¸æ¡†æ¶ï¼Œç”¨äºåˆ›å»ºè‡ªå®šä¹‰çš„ç½‘ç»œé…ç½®ã€‚å®ƒå¯ä»¥ç”¨äºå®šä¹‰ç½‘ç»œæµé‡åœ¨ jails å’Œä¸»æœºç³»ç»Ÿä¹‹é—´ä»¥åŠä¸åŒ jails ä¹‹é—´çš„æµåŠ¨æ–¹å¼ã€‚Ù"Setting Up the Jail Directory Treeµè®¾ç½® jail ç›®å½•æ ‘Ù:There is no specific place to put the files for the jails.Ù0æ²¡æœ‰ç‰¹å®šçš„ä½ç½®æ¥æ”¾ç½® jail çš„æ–‡ä»¶ã€‚Ù·Some administrators use [.filename]#/jail#, others [.filename]#/usr/jail#, and still others [.filename]#/usr/local/jails#.  In this chapter [.filename]#/usr/local/jails# will be used.Ù›ä¸€äº›ç®¡ç†å‘˜ä½¿ç”¨ `/jail` ï¼Œå…¶ä»–äººä½¿ç”¨ `/usr/jail` ï¼Œè¿˜æœ‰ä¸€äº›äººä½¿ç”¨ `/usr/local/jails` ã€‚åœ¨æœ¬ç« ä¸­ï¼Œå°†ä½¿ç”¨ `/usr/local/jails` ã€‚ÙKApart from [.filename]#/usr/local/jails# other directories will be created:ÙOé™¤äº† [.filename]#/usr/local/jails# ç›®å½•ä¹‹å¤–ï¼Œè¿˜ä¼šåˆ›å»ºå…¶ä»–ç›®å½•ï¼šÙQ[.filename]#media# will contain the compressed files of the downloaded userlands.ÙC[.filename]#media# å°†åŒ…å«å·²ä¸‹è½½ç”¨æˆ·ç©ºé—´çš„å‹ç¼©æ–‡ä»¶ã€‚ÙH[.filename]#templates# will contain the templates when using Thin Jails.ÙKåœ¨ä½¿ç”¨è–„ Jails æ—¶ï¼Œ[.filename]#templates# æ–‡ä»¶å¤¹å°†åŒ…å«æ¨¡æ¿ã€‚Ù/[.filename]#containers# will contain the jails.Ù*[.filename]#containers# å°†åŒ…å« jail ã€‚Ù\When using OpenZFS, execute the following commands to create datasets for these directories:ÙKåœ¨ä½¿ç”¨ OpenZFS æ—¶ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ä¸ºè¿™äº›ç›®å½•åˆ›å»ºæ•°æ®é›†ï¼šÙ_In this case, `zroot` was used for the parent dataset, but other datasets could have been used.ÙYåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ`zroot` è¢«ç”¨ä½œçˆ¶æ•°æ®é›†ï¼Œä½†ä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–æ•°æ®é›†ã€‚ÙIWhen using UFS, execute the following commands to create the directories:Ù8åœ¨ä½¿ç”¨ UFS æ—¶ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ¥åˆ›å»ºç›®å½•ï¼š¸Jail Configuration Files±Jail é…ç½®æ–‡ä»¶Ù&There are two ways to configure jails.Ù"æœ‰ä¸¤ç§æ–¹æ³•æ¥é…ç½® jails ã€‚Ù¼The first one is to add an entry for each jail to the file [.filename]#/etc/jail.conf#.  The other option is to create a file for each jail in the directory [.filename]#/etc/jail.conf.d/#.ÙÁç¬¬ä¸€ç§æ–¹æ³•æ˜¯åœ¨æ–‡ä»¶ [.filename]#/etc/jail.conf# ä¸­ä¸ºæ¯ä¸ª jail æ·»åŠ ä¸€ä¸ªæ¡ç›®ã€‚å¦ä¸€ç§é€‰é¡¹æ˜¯åœ¨ç›®å½• [.filename]#/etc/jail.conf.d/# ä¸­ä¸ºæ¯ä¸ª jail åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ã€‚ÙgThere is no right or wrong option.  Each administrator must choose the one that best suits their needs.Ù]æ²¡æœ‰æ­£ç¡®æˆ–é”™è¯¯çš„é€‰æ‹©ã€‚æ¯ä¸ªç®¡ç†å‘˜å¿…é¡»é€‰æ‹©æœ€é€‚åˆä»–ä»¬éœ€æ±‚çš„é€‰é¡¹ã€‚ÚIn case a host system has few jails, an entry for each jail can be added in the file [.filename]#/etc/jail.conf#.  If the host system has many jails, it is good idea to have one configuration file for each jail in the [.filename]#/etc/jail.conf.d/# directory.Ùøå¦‚æœä¸»æœºç³»ç»Ÿåªæœ‰å‡ ä¸ª jailï¼Œå¯ä»¥åœ¨æ–‡ä»¶ [.filename]#/etc/jail.conf# ä¸­ä¸ºæ¯ä¸ª jail æ·»åŠ ä¸€ä¸ªæ¡ç›®ã€‚å¦‚æœä¸»æœºç³»ç»Ÿæœ‰å¾ˆå¤š jailï¼Œæœ€å¥½åœ¨ [.filename]#/etc/jail.conf.d/# ç›®å½•ä¸­ä¸ºæ¯ä¸ª jail æ‹¥æœ‰ä¸€ä¸ªé…ç½®æ–‡ä»¶ã€‚Ù*A typical jail entry would look like this:Ù-ä¸€ä¸ªå…¸å‹çš„ jail å…¥å£ä¼šæ˜¯è¿™æ ·çš„ï¼šÚˆ<.> `jailname` - Name of the jail.  <.> `exec.start` - Command(s) to run in the jail environment when a jail is created. A typical command to run is "/bin/sh /etc/rc".  <.> `exec.stop` - Command(s) to run in the jail environment before a jail is removed. A typical command to run is "/bin/sh /etc/rc.shutdown".  <.> `exec.consolelog` - A file to direct command output (stdout and stderr) to.  <.> `allow.raw_sockets` - Allow creating raw sockets inside the jail. Setting this parameter allows utilities like man:ping[8] and man:traceroute[8] to operate inside the jail.  <.> `exec.clean` - Run commands in a clean environment.  <.> `mount.devfs` - Mount a man:devfs[5] filesystem on the chrooted [.filename]#/dev# directory, and apply the ruleset in the devfs_ruleset parameter to restrict the devices visible inside the jail.  <.> `host.hostname` - The hostname of the jail.  <.> `path` - The directory which is to be the root of the jail. Any commands that are run inside the jail, either by jail or from man:jexec[8], are run from this directory.  <.> `ip4.addr` - IPv4 address. There are two configuration possibilities for IPv4. The first is to establish an IP or a list of IPs as has been done in the example. The other is to use `ip4` instead and set the `inherit` value to inherit the host's IP address.  <.> `ip6.addr` - IPv6 address. There are two configuration possibilities for IPv6. The first is to establish an IP or a list of IPs as has been done in the example. The other is to use `ip6` instead and set the `inherit` value to inherit the host's IP address.  <.> `interface` - A network interface to add the jail's IP addresses. Usually the host interface.Úê<.> `jailname` -  jail çš„åç§°ã€‚
<.> `exec.start` - åˆ›å»º jail æ—¶åœ¨ jail ç¯å¢ƒä¸­è¿è¡Œçš„å‘½ä»¤ã€‚é€šå¸¸è¿è¡Œçš„å‘½ä»¤æ˜¯ "/bin/sh /etc/rc"ã€‚
<.> `exec.stop` - åˆ é™¤ jail ä¹‹å‰åœ¨ jail ç¯å¢ƒä¸­è¿è¡Œçš„å‘½ä»¤ã€‚é€šå¸¸è¿è¡Œçš„å‘½ä»¤æ˜¯ "/bin/sh /etc/rc.shutdown"ã€‚
<.> `exec.consolelog` - å°†å‘½ä»¤è¾“å‡ºï¼ˆstdout å’Œ stderrï¼‰é‡å®šå‘åˆ°çš„æ–‡ä»¶ã€‚
<.> `allow.raw_sockets` - å…è®¸åœ¨ jail å†…åˆ›å»ºåŸå§‹å¥—æ¥å­—ã€‚è®¾ç½®æ­¤å‚æ•°å…è®¸åƒ man:ping[8] å’Œ man:traceroute[8] è¿™æ ·çš„å®ç”¨ç¨‹åºåœ¨ jail å†…è¿è¡Œã€‚
<.> `exec.clean` - åœ¨ä¸€ä¸ªå¹²å‡€çš„ç¯å¢ƒä¸­è¿è¡Œå‘½ä»¤ã€‚
<.> `mount.devfs` - åœ¨ chrooted [.filename]#/dev# ç›®å½•ä¸ŠæŒ‚è½½ä¸€ä¸ª man:devfs[5] æ–‡ä»¶ç³»ç»Ÿï¼Œå¹¶åº”ç”¨ devfs_ruleset å‚æ•°ä¸­çš„è§„åˆ™é›†æ¥é™åˆ¶ jail å†…å¯è§çš„è®¾å¤‡ã€‚
<.> `host.hostname` -  jail çš„ä¸»æœºåã€‚
<.> `path` - jail çš„æ ¹ç›®å½•ã€‚åœ¨ jail å†…è¿è¡Œçš„ä»»ä½•å‘½ä»¤ï¼Œæ— è®ºæ˜¯é€šè¿‡ jail è¿˜æ˜¯ man:jexec[8] è¿è¡Œï¼Œéƒ½æ˜¯ä»æ­¤ç›®å½•å¼€å§‹çš„ã€‚
<.> `ip4.addr` - IPv4 åœ°å€ã€‚ IPv4 æœ‰ä¸¤ç§é…ç½®å¯èƒ½æ€§ã€‚ç¬¬ä¸€ç§æ˜¯åƒç¤ºä¾‹ä¸­æ‰€åšçš„é‚£æ ·å»ºç«‹ä¸€ä¸ª IP æˆ– IP åˆ—è¡¨ã€‚å¦ä¸€ç§æ˜¯ä½¿ç”¨ `ip4` æ›¿ä»£ï¼Œå¹¶å°† `inherit` å€¼è®¾ç½®ä¸ºç»§æ‰¿ä¸»æœºçš„ IP åœ°å€ã€‚
<.> `ip6.addr` - IPv6 åœ°å€ã€‚ IPv6 æœ‰ä¸¤ç§é…ç½®å¯èƒ½æ€§ã€‚ç¬¬ä¸€ç§æ˜¯åƒç¤ºä¾‹ä¸­æ‰€åšçš„é‚£æ ·å»ºç«‹ä¸€ä¸ª IP æˆ– IP åˆ—è¡¨ã€‚å¦ä¸€ç§æ˜¯ä½¿ç”¨ `ip6` æ›¿ä»£ï¼Œå¹¶å°† `inherit` å€¼è®¾ç½®ä¸ºç»§æ‰¿ä¸»æœºçš„ IP åœ°å€ã€‚
<.> `interface` - æ·»åŠ  jail çš„ IP åœ°å€çš„ç½‘ç»œæ¥å£ã€‚é€šå¸¸æ˜¯ä¸»æœºæ¥å£ã€‚Ù`More information about configuration variables can be found in man:jail[8] and man:jail.conf[5].ÙXæœ‰å…³é…ç½®å˜é‡çš„æ›´å¤šä¿¡æ¯å¯ä»¥åœ¨ man:jail[8] å’Œ man:jail.conf[5] ä¸­æ‰¾åˆ°ã€‚¹Classic Jail (Thick Jail)ºç»å…¸ Jailï¼ˆåš Jail ï¼‰Ù‚These jails resemble a real FreeBSD system.  They can be managed more or less like a normal host system and updated independently.Ùè¿™äº› jail ç±»ä¼¼äºçœŸå®çš„ FreeBSD ç³»ç»Ÿã€‚å®ƒä»¬å¯ä»¥åƒæ™®é€šä¸»æœºç³»ç»Ÿä¸€æ ·è¿›è¡Œç®¡ç†ï¼Œå¹¶ä¸”å¯ä»¥ç‹¬ç«‹æ›´æ–°ã€‚·Creating a Classic Jail·åˆ›å»ºä¸€ä¸ªç»å…¸ JailÙ\In principle, a jail only needs a hostname, a root directory, an IP address, and a userland.ÙmåŸåˆ™ä¸Šï¼Œä¸€ä¸ª jail åªéœ€è¦ä¸€ä¸ªä¸»æœºåã€ä¸€ä¸ªæ ¹ç›®å½•ã€ä¸€ä¸ª IP åœ°å€å’Œä¸€ä¸ªç”¨æˆ·ç©ºé—´ã€‚ÙUThe userland for the jail can be obtained from the official FreeBSD download servers.ÙNå¯ä»¥ä»å®˜æ–¹çš„ FreeBSD ä¸‹è½½æœåŠ¡å™¨è·å–ç”¨äº jail çš„ç”¨æˆ·ç©ºé—´ã€‚Ù7Execute the following command to download the userland:Ù*æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ä»¥ä¸‹è½½ç”¨æˆ·ç©ºé—´ï¼šÙdOnce the download is complete, it will be necessary to extract the contents into the jail directory.Ù<ä¸‹è½½å®Œæˆåï¼Œéœ€è¦å°†å†…å®¹è§£å‹åˆ° jail ç›®å½•ä¸­ã€‚ÙQExecute the following commands to extract the userland into the jail's directory:Ù<æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å°†ç”¨æˆ·ç©ºé—´æå–åˆ° jail ç›®å½•ä¸­ï¼šÙrWith the userland extracted in the jail directory, it will be necessary to copy the timezone and DNS server files:ÙVåœ¨ jail ç›®å½•ä¸­æå–ç”¨æˆ·ç©ºé—´åï¼Œéœ€è¦å¤åˆ¶æ—¶åŒºå’Œ DNS æœåŠ¡å™¨æ–‡ä»¶ï¼šÙsWith the files copied, the next thing to do is update to the latest patch level by executing the following command:ÙZåœ¨å¤åˆ¶æ–‡ä»¶åï¼Œä¸‹ä¸€æ­¥æ˜¯é€šè¿‡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ›´æ–°åˆ°æœ€æ–°çš„è¡¥ä¸çº§åˆ«ï¼šÙÃThe last step is to configure the jail.  It will be necessary to add an entry to the configuration file [.filename]#/etc/jail.conf# or in [.filename]#jail.conf.d# with the parameters of the jail.Ùœæœ€åä¸€æ­¥æ˜¯é…ç½® jailã€‚éœ€è¦åœ¨é…ç½®æ–‡ä»¶ [.filename]#/etc/jail.conf# æˆ– [.filename]#jail.conf.d# ä¸­æ·»åŠ ä¸€ä¸ªæ¡ç›®ï¼ŒåŒ…å« jail çš„å‚æ•°ã€‚Ù"An example would be the following:µä¸€ä¸ªä¾‹å­å¦‚ä¸‹ï¼šÙ0Execute the following command to start the jail:Ù$æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ä»¥å¯åŠ¨ jail ï¼šÙXMore information on how to manage jails can be found in the section <<jail-management>>.ÙUæœ‰å…³å¦‚ä½•ç®¡ç† jails çš„æ›´å¤šä¿¡æ¯å¯ä»¥åœ¨ <<jail-management>> éƒ¨åˆ†æ‰¾åˆ°ã€‚Ú„Although Thin Jails use the same technology as Thick Jails, the creation procedure is different.  Thin jails can be created using OpenZFS snapshots or using templates and NullFS.  The use of OpenZFS snapshots and templates using NullFS have certain advantages over classic jails, such as being able to create them faster from snapshots or being able to update multiple jails using NullFS.ÚVå°½ç®¡ç˜¦ Jails ä½¿ç”¨ä¸èƒ– Jails ç›¸åŒçš„æŠ€æœ¯ï¼Œä½†åˆ›å»ºè¿‡ç¨‹æ˜¯ä¸åŒçš„ã€‚å¯ä»¥ä½¿ç”¨ OpenZFS å¿«ç…§æˆ–ä½¿ç”¨æ¨¡æ¿å’Œ NullFS æ¥åˆ›å»ºç˜¦ jailsã€‚ä½¿ç”¨ OpenZFS å¿«ç…§å’Œä½¿ç”¨ NullFS çš„æ¨¡æ¿ç›¸æ¯”ä¼ ç»Ÿçš„ jails å…·æœ‰ä¸€å®šçš„ä¼˜åŠ¿ï¼Œä¾‹å¦‚å¯ä»¥æ›´å¿«åœ°ä»å¿«ç…§åˆ›å»ºå®ƒä»¬ï¼Œæˆ–è€…å¯ä»¥ä½¿ç”¨ NullFS æ›´æ–°å¤šä¸ª jailsã€‚Ù,Creating a Thin Jail Using OpenZFS SnapshotsÙ)ä½¿ç”¨ OpenZFS å¿«ç…§åˆ›å»ºä¸€ä¸ªç˜¦ JailÙyDue to the good integration between FreeBSD and OpenZFS it is very easy to create new Thin Jails using OpenZFS Snapshots.Ùmç”±äº FreeBSD å’Œ OpenZFS ä¹‹é—´çš„è‰¯å¥½é›†æˆï¼Œä½¿ç”¨ OpenZFS å¿«ç…§åˆ›å»ºæ–°çš„ç˜¦ Jails éå¸¸å®¹æ˜“ã€‚ÙUTo create a Thin Jail using OpenZFS Snapshots the first step is to create a template.ÙHä½¿ç”¨ OpenZFS å¿«ç…§åˆ›å»ºç˜¦ Jail çš„ç¬¬ä¸€æ­¥æ˜¯åˆ›å»ºä¸€ä¸ªæ¨¡æ¿ã€‚Ù˜Templates will only be used to create new jails.  For this reason they are created in "read-only" mode so that jails are created with an immutable base.Ùzæ¨¡æ¿åªç”¨äºåˆ›å»ºæ–°çš„ jailã€‚å› æ­¤ï¼Œå®ƒä»¬ä»¥â€œåªè¯»â€æ¨¡å¼åˆ›å»ºï¼Œä»¥ä¾¿ jail ä»¥ä¸å¯å˜çš„åŸºç¡€åˆ›å»ºã€‚ÙFTo create the dataset for the template, execute the following command:Ù6è¦ä¸ºæ¨¡æ¿åˆ›å»ºæ•°æ®é›†ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼šÙ<Then execute the following command to download the userland:Ù0ç„¶åæ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ¥ä¸‹è½½ç”¨æˆ·ç©ºé—´ï¼šÙ‰Once the download is complete, it will be necessary to extract the contents in the template directory by executing the following command:ÙNä¸‹è½½å®Œæˆåï¼Œéœ€è¦æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å°†å†…å®¹è§£å‹åˆ°æ¨¡æ¿ç›®å½•ä¸­ï¼šÙ´With the userland extracted in the templates directory, it will be necessary to copy the timezone and DNS server files to the template directory by executing the following command:Ùƒåœ¨æ¨¡æ¿ç›®å½•ä¸­æå–ç”¨æˆ·ç©ºé—´åï¼Œéœ€è¦é€šè¿‡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å°†æ—¶åŒºå’Œ DNS æœåŠ¡å™¨æ–‡ä»¶å¤åˆ¶åˆ°æ¨¡æ¿ç›®å½•ä¸­ï¼šÙ\The next thing to do is update to the latest patch level by executing the following command:ÙNä¸‹ä¸€æ­¥è¦åšçš„æ˜¯é€šè¿‡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ›´æ–°åˆ°æœ€æ–°çš„è¡¥ä¸çº§åˆ«ï¼šÙ3Once the update is finished, the template is ready.Ù-ä¸€æ—¦æ›´æ–°å®Œæˆï¼Œæ¨¡æ¿å°±å‡†å¤‡å¥½äº†ã€‚ÙOTo create an OpenZFS Snapshot from the template, execute the following command:ÙBè¦ä»æ¨¡æ¿åˆ›å»ºä¸€ä¸ª OpenZFS å¿«ç…§ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼šÙkOnce the OpenZFS Snapshot has been created, infinite jails can be created using the OpenZFS clone function.Ù\ä¸€æ—¦åˆ›å»ºäº† OpenZFS å¿«ç…§ï¼Œå°±å¯ä»¥ä½¿ç”¨ OpenZFS å…‹éš†åŠŸèƒ½åˆ›å»ºæ— é™ä¸ª jailã€‚ÙFTo create a Thin Jail named `thinjail`, execute the following command:ÙGè¦åˆ›å»ºä¸€ä¸ªåä¸º `thinjail` çš„è–„ Jailï¼Œè¯·æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼šÙ!Creating a Thin Jail Using NullFSÙ"ä½¿ç”¨ NullFS åˆ›å»ºä¸€ä¸ªè–„ JailÙ¾A jail can be created with reduced duplication of system files by using the Thin Jail technique and using NullFS to selectively share specific directories from the host system into the jail.Ùä½¿ç”¨è–„ Jail æŠ€æœ¯å’Œä½¿ç”¨ NullFS å°†ç‰¹å®šç›®å½•ä»ä¸»æœºç³»ç»Ÿé€‰æ‹©æ€§åœ°å…±äº«åˆ° jail ä¸­ï¼Œå¯ä»¥å‡å°‘ç³»ç»Ÿæ–‡ä»¶çš„é‡å¤åˆ›å»ºã€‚ÙmThe first step is to create the dataset to save the template, execute the following command if using OpenZFS:Ù\ç¬¬ä¸€æ­¥æ˜¯åˆ›å»ºæ•°æ®é›†ä»¥ä¿å­˜æ¨¡æ¿ï¼Œå¦‚æœä½¿ç”¨ OpenZFSï¼Œè¯·æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š¹Or this one if using UFS:Ù+å¦‚æœä½¿ç”¨ UFSï¼Œåˆ™ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼šÙ·Once the userland is extracted in the templates directory, it will be necessary to copy the timezone and DNS server files to the template directory by executing the following command:Ù’ä¸€æ—¦ç”¨æˆ·ç©ºé—´åœ¨æ¨¡æ¿ç›®å½•ä¸­è¢«æå–å‡ºæ¥ï¼Œå°±éœ€è¦é€šè¿‡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å°†æ—¶åŒºå’Œ DNS æœåŠ¡å™¨æ–‡ä»¶å¤åˆ¶åˆ°æ¨¡æ¿ç›®å½•ä¸­ï¼šÙ‚With the files moved to the template, the next thing to do is update to the latest patch level by executing the following command:Ùlå°†æ–‡ä»¶ç§»åŠ¨åˆ°æ¨¡æ¿åï¼Œä¸‹ä¸€æ­¥è¦åšçš„æ˜¯é€šè¿‡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ›´æ–°åˆ°æœ€æ–°çš„è¡¥ä¸çº§åˆ«ï¼šÙ¸In addition to the base template, it is also necessary to create a directory where the `skeleton` will be located.  Some directories will be copied from the template to the `skeleton`.Ù†é™¤äº†åŸºæœ¬æ¨¡æ¿ä¹‹å¤–ï¼Œè¿˜éœ€è¦åˆ›å»ºä¸€ä¸ªç›®å½•ï¼Œç”¨äºå­˜æ”¾ `skeleton`ã€‚ä¸€äº›ç›®å½•å°†ä»æ¨¡æ¿å¤åˆ¶åˆ° `skeleton` ä¸­ã€‚Ù`Execute the following command to create the dataset for the `skeleton` in case of using OpenZFS:ÙTåœ¨ä½¿ç”¨ OpenZFS çš„æƒ…å†µä¸‹ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤åˆ›å»º `skeleton` çš„æ•°æ®é›†ï¼šÙ!Or this one in case of using UFS:Ù+å¦‚æœä½¿ç”¨ UFSï¼Œåˆ™ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼šÙqThen create the `skeleton` directories.  The `skeleton` directories will hold the local directories of the jails.ÙTç„¶ååˆ›å»º `skeleton` ç›®å½•ã€‚ `skeleton` ç›®å½•å°†ä¿å­˜ jail çš„æœ¬åœ°ç›®å½•ã€‚Ù9Execute the following commands to create the directories:Ù!æ‰§è¡Œä»¥ä¸‹å‘½ä»¤åˆ›å»ºç›®å½•ï¼šÙ^The next step is to create the symlinks to the `skeleton` by executing the following commands:ÙKä¸‹ä¸€æ­¥æ˜¯é€šè¿‡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤åˆ›å»ºåˆ° `skeleton` çš„ç¬¦å·é“¾æ¥ï¼šÙWWith the `skeleton` ready, it will be necessary to copy the data to the jail directory.ÙKå‡†å¤‡å¥½äº† `skeleton` ä¹‹åï¼Œéœ€è¦å°†æ•°æ®å¤åˆ¶åˆ° jail ç›®å½•ä¸­ã€‚ÙˆIn case of using OpenZFS, OpenZFS snapshots can be used to easily create as many jails as necessary by executing the following commands:Ùoå¦‚æœä½¿ç”¨ OpenZFSï¼Œå¯ä»¥ä½¿ç”¨ OpenZFS å¿«ç…§é€šè¿‡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤è½»æ¾åˆ›å»ºæ‰€éœ€æ•°é‡çš„ jails ï¼šÙ[In case of using UFS the man:cp[1] program can be used by executing the following commands:Ù[å¦‚æœä½¿ç”¨ UFS æ–‡ä»¶ç³»ç»Ÿï¼Œå¯ä»¥é€šè¿‡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ¥ä½¿ç”¨ man:cp[1] ç¨‹åºï¼šÙVThen create the directory in which the base template and the skeleton will be mounted:ÙBç„¶ååˆ›å»ºä¸€ä¸ªç›®å½•ï¼Œç”¨äºæŒ‚è½½åŸºæœ¬æ¨¡æ¿å’Œ skeletonï¼šÙaAdd a jail entry in [.filename]#/etc/jail.conf# or a file in [.filename]#jail.conf.d# as follows:Ùåœ¨ [.filename]#/etc/jail.conf# ä¸­æ·»åŠ ä¸€ä¸ª jail æ¡ç›®ï¼Œæˆ–è€…åœ¨ [.filename]#jail.conf.d# ç›®å½•ä¸­æ·»åŠ ä¸€ä¸ªæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼šÙ]Then the create the [.filename]#/usr/local/jails/thinjail-nullfs-base.fstab# file as follows:Ùaç„¶åæŒ‰ç…§ä»¥ä¸‹æ–¹å¼åˆ›å»º [.filename]#/usr/local/jails/thinjail-nullfs-base.fstab# æ–‡ä»¶ï¼š´Creating a VNET Jail·åˆ›å»ºä¸€ä¸ª VNET Jail Ù„FreeBSD VNET Jails have their own distinct networking stack, including interfaces, IP addresses, routing tables, and firewall rules.ÙkFreeBSD VNET Jails æ‹¥æœ‰ç‹¬ç«‹çš„ç½‘ç»œå †æ ˆï¼ŒåŒ…æ‹¬æ¥å£ã€ IP åœ°å€ã€è·¯ç”±è¡¨å’Œé˜²ç«å¢™è§„åˆ™ã€‚ÙgThe first step to create a VNET jail is to create the man:bridge[4] by executing the following command:ÙPåˆ›å»º VNET jail çš„ç¬¬ä¸€æ­¥æ˜¯é€šè¿‡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤åˆ›å»º man:bridge[4] ã€‚ÙwWith the `bridge` created, it will be necessary to attach it to the `em0` interface by executing the following command:ÙYåˆ›å»ºäº† `bridge` ä¹‹åï¼Œéœ€è¦é€šè¿‡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å°†å…¶é™„åŠ åˆ° `em0` æ¥å£ï¼šÙbTo make this setting persist across reboots, add the following lines to [.filename]#/etc/rc.conf#:Ùoè¦ä½¿æ­¤è®¾ç½®åœ¨é‡æ–°å¯åŠ¨åä¿æŒä¸å˜ï¼Œè¯·å°†ä»¥ä¸‹è¡Œæ·»åŠ åˆ° [.filename]#/etc/rc.conf# æ–‡ä»¶ä¸­ï¼šÙ7The next step is to create the jail as indicated above.Ù-ä¸‹ä¸€æ­¥æ˜¯æŒ‰ç…§ä¸Šè¿°æ‰€ç¤ºåˆ›å»º jail ã€‚Ù±Either the <<classic-jail>> procedure and the <<thin-jail>> procedure can be used.  The only thing that will change is the configuration in the [.filename]#/etc/jail.conf# file.Ù‰å¯ä»¥ä½¿ç”¨ <<classic-jail>> è¿‡ç¨‹å’Œ <<thin-jail>> è¿‡ç¨‹ã€‚å”¯ä¸€éœ€è¦æ›´æ”¹çš„æ˜¯ [.filename]#/etc/jail.conf# æ–‡ä»¶ä¸­çš„é…ç½®ã€‚ÙgThe path [.filename]#/usr/local/jails/containers/vnet# will be used as an example for the created jail.Ù\è·¯å¾„ [.filename]#/usr/local/jails/containers/vnet# å°†è¢«ç”¨ä½œåˆ›å»ºçš„ jail çš„ç¤ºä¾‹ã€‚Ù:The following is an example configuration for a VNET jail:Ù,ä»¥ä¸‹æ˜¯ä¸€ä¸ª VNET jail çš„é…ç½®ç¤ºä¾‹ï¼šÙe<.> Represents the IP of the Jail, it must be *unique*.  <.> Refers to the bridge created previously.Ùb<.> è¡¨ç¤º Jail çš„ IP åœ°å€ï¼Œå®ƒå¿…é¡»æ˜¯ *å”¯ä¸€çš„* ã€‚
<.> æŒ‡çš„æ˜¯ä¹‹å‰åˆ›å»ºçš„æ¡¥æ¥ã€‚µCreating a Linux Jail¸åˆ›å»ºä¸€ä¸ª Linux Jail Ú	FreeBSD can run Linux inside a jail using crossref:linuxemu[linuxemu,Linux Binary Compatibility] and man:debootstrap[8].  Jails do not have a kernel.  They run on the host's kernel.  Therefore it is necessary to enable Linux Binary Compatibility in the host system.ÙşFreeBSD å¯ä»¥ä½¿ç”¨ crossref:linuxemu[linuxemu, Linux äºŒè¿›åˆ¶å…¼å®¹æ€§] å’Œ man:debootstrap[8] åœ¨ jail ä¸­è¿è¡Œ Linuxã€‚jail æ²¡æœ‰å†…æ ¸ï¼Œå®ƒä»¬åœ¨ä¸»æœºçš„å†…æ ¸ä¸Šè¿è¡Œã€‚å› æ­¤ï¼Œåœ¨ä¸»æœºç³»ç»Ÿä¸­å¯ç”¨ Linux äºŒè¿›åˆ¶å…¼å®¹æ€§æ˜¯å¿…è¦çš„ã€‚ÙDTo enable the Linux ABI at boot time, execute the following command:Ù:è¦åœ¨å¯åŠ¨æ—¶å¯ç”¨ Linux ABIï¼Œè¯·æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼šÙUOnce enabled, it can be started without rebooting by executing the following command:ÙNä¸€æ—¦å¯ç”¨ï¼Œå¯ä»¥é€šè¿‡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ¥å¯åŠ¨ï¼Œæ— éœ€é‡æ–°å¯åŠ¨ï¼šÙòThe next step will be to create a jail as indicated above, for example in <<creating-thin-jail-openzfs-snapshots>>, but *without* performing the configuration.  FreeBSD Linux jails require a specific configuration that will be detailed below.ÙÑä¸‹ä¸€æ­¥å°†æ˜¯æŒ‰ç…§ä¸Šè¿°æ‰€ç¤ºåˆ›å»ºä¸€ä¸ª jail ï¼Œä¾‹å¦‚åœ¨ <<creating-thin-jail-openzfs-snapshots>> ä¸­ï¼Œä½† *ä¸è¦* æ‰§è¡Œé…ç½®ã€‚FreeBSD Linux jail éœ€è¦ç‰¹å®šçš„é…ç½®ï¼Œå°†åœ¨ä¸‹é¢è¯¦ç»†è¯´æ˜ã€‚ÙOnce the jail has been created as explained above, execute the following command to perform required configuration for the jail and start it:Ùeä¸€æ—¦æŒ‰ç…§ä¸Šè¿°è¯´æ˜åˆ›å»ºäº† jailï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤è¿›è¡Œæ‰€éœ€çš„ jail é…ç½®å¹¶å¯åŠ¨å®ƒï¼šÙSTo access the jail, it will be necessary to install package:sysutils/debootstrap[].Ù@è¦è®¿é—® jail ï¼Œéœ€è¦å®‰è£… package:sysutils/debootstrap[]ã€‚Ù?Execute the following command to access the FreeBSD Linux jail:Ù1æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ä»¥è®¿é—® FreeBSD Linux jailï¼šÙ}Inside the jail, execute the following commands to install package:sysutils/debootstrap[] and prepare the Ubuntu environment:Ùaåœ¨ jail å†…æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ¥å®‰è£… package:sysutils/debootstrap[] å¹¶å‡†å¤‡ Ubuntu ç¯å¢ƒï¼šÙÎWhen the process has finished and the message `Base system installed successfully` is displayed on the console, it will be necessary to stop the jail from the host system by executing the following command:Ùå½“è¿›ç¨‹å®Œæˆå¹¶åœ¨æ§åˆ¶å°ä¸Šæ˜¾ç¤º `successfully` æ¶ˆæ¯æ—¶ï¼Œéœ€è¦é€šè¿‡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤åœ¨ä¸»æœºç³»ç»Ÿä¸Šåœæ­¢ jailï¼šÙDThen add an entry in [.filename]#/etc/jail.conf# for the Linux jail:ÙHç„¶ååœ¨ [/etc/jail.conf] æ–‡ä»¶ä¸­æ·»åŠ ä¸€ä¸ª Linux jail çš„æ¡ç›®ï¼šÙAThen the jail can be started as usual with the following command:Ù2ç„¶åå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ­£å¸¸å¯åŠ¨ jailï¼šÙCThe Ubuntu environment can be accessed using the following command:Ù/å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è®¿é—® Ubuntu ç¯å¢ƒï¼šÙdMore information can be found in the chapter crossref:linuxemu[linuxemu,Linux Binary Compatibility].Ù^æ›´å¤šä¿¡æ¯å¯ä»¥åœ¨ç« èŠ‚ crossref:linuxemu[linuxemu, Linux äºŒè¿›åˆ¶å…¼å®¹æ€§] ä¸­æ‰¾åˆ°ã€‚¯Jail Management«Jail ç®¡ç†ÚOnce the jail is created, there are a number of operations that can be performed, like starting, rebooting or deleting the jail, installing software in it, etc.  In this section the different actions that can be done with jails from the host will be described.Ù¬ä¸€æ—¦åˆ›å»ºäº† jailï¼Œå°±å¯ä»¥æ‰§è¡Œè®¸å¤šæ“ä½œï¼Œæ¯”å¦‚å¯åŠ¨ã€é‡å¯æˆ–åˆ é™¤ jailï¼Œå®‰è£…è½¯ä»¶ç­‰ã€‚æœ¬èŠ‚å°†æè¿°å¯ä»¥åœ¨ä¸»æœºä¸Šæ‰§è¡Œçš„ä¸åŒ jail æ“ä½œã€‚²List Running Jails¸åˆ—å‡ºè¿è¡Œä¸­çš„ JailsÙZTo list the jails that are running on the host system, the command man:jls[8] can be used:ÙMè¦åˆ—å‡ºè¿è¡Œåœ¨ä¸»æœºç³»ç»Ÿä¸Šçš„ jailsï¼Œå¯ä»¥ä½¿ç”¨å‘½ä»¤ man:jls[8]ã€‚Ùman:jls[8] supports the `--libxo` argument, which through the man:libxo[3] library allows other types of formats to be displayed, such as `JSON`, `HTML`, etc.Ù}man:jls[8] æ”¯æŒ `--libxo` å‚æ•°ï¼Œé€šè¿‡ man:libxo[3] åº“å¯ä»¥æ˜¾ç¤ºå…¶ä»–ç±»å‹çš„æ ¼å¼ï¼Œä¾‹å¦‚ `JSON`ã€`HTML` ç­‰ã€‚ÙDFor example, execute the following command to get the `JSON` output:Ù5ä¾‹å¦‚ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ä»¥è·å– `JSON` è¾“å‡ºï¼š¿Start, Restart, and Stop a JailÙ)å¯åŠ¨ã€é‡æ–°å¯åŠ¨å’Œåœæ­¢ä¸€ä¸ª JailÙDman:service[8] is used to start, reboot, or stop a jail on the host.ÙGman:service[8] ç”¨äºåœ¨ä¸»æœºä¸Šå¯åŠ¨ã€é‡å¯æˆ–åœæ­¢ä¸€ä¸ª jailã€‚Ù8For example, to start a jail, run the following command:Ù8ä¾‹å¦‚ï¼Œè¦å¯åŠ¨ä¸€ä¸ª jailï¼Œè¯·è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼šÙXChange the `start` argument to `restart` or `stop` to perform other actions on the jail.ÙUå°† `start` å‚æ•°æ›´æ”¹ä¸º `restart` æˆ– `stop` ä»¥æ‰§è¡Œå…¶ä»–å¯¹ jail çš„æ“ä½œã€‚®Destroy a Jail²é”€æ¯ä¸€ä¸ª jail Ù“Destroying a jail is not as simple as stopping the jail using man:service[8] and removing the jail directory and [.filename]#/etc/jail.conf# entry.ÙŠé”€æ¯ä¸€ä¸ª jail å¹¶ä¸åƒä½¿ç”¨ man:service[8] åœæ­¢ jail å’Œåˆ é™¤ jail ç›®å½•ä»¥åŠ [.filename]#/etc/jail.conf# æ¡ç›®é‚£æ ·ç®€å•ã€‚ÙªFreeBSD takes system security very seriously.  For this reason there are certain files that not even the root user can delete.  This functionality is known as File Flags.Ù†FreeBSD éå¸¸é‡è§†ç³»ç»Ÿå®‰å…¨ã€‚å› æ­¤ï¼Œæœ‰ä¸€äº›æ–‡ä»¶å³ä½¿æ˜¯ root ç”¨æˆ·ä¹Ÿæ— æ³•åˆ é™¤ã€‚è¿™ç§åŠŸèƒ½è¢«ç§°ä¸ºæ–‡ä»¶æ ‡å¿—ã€‚ÙKThe first step is to stop the desired jail executing the following command:Ù6ç¬¬ä¸€æ­¥æ˜¯åœæ­¢æ‰€éœ€çš„ jail æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼šÙ–The second step is to remove these flags with man:chflags[1] by executing the following command, in which `classic` is the name of the jail to remove:Ù‡ç¬¬äºŒæ­¥æ˜¯ä½¿ç”¨ man:chflags[1] å‘½ä»¤æ¥ç§»é™¤è¿™äº›æ ‡å¿—ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå…¶ä¸­ `classic` æ˜¯è¦ç§»é™¤çš„ jail çš„åç§°ï¼šÙ=The third step is to delete the directory where the jail was:Ù*ç¬¬ä¸‰æ­¥æ˜¯åˆ é™¤ jail æ‰€åœ¨çš„ç›®å½•ï¼šÙuFinally, it will be necessary to remove the jail entry in [.filename]#/etc/jail.conf# or in [.filename]#jail.conf.d#.Ùdæœ€åï¼Œéœ€è¦åœ¨ [.filename]#/etc/jail.conf# æˆ– [.filename]#jail.conf.d# ä¸­åˆ é™¤ jail æ¡ç›®ã€‚¹Handle Packages in a Jail»åœ¨ Jail ä¸­å¤„ç†è½¯ä»¶åŒ…ÙeThe man:pkg[8] tool supports the `-j` argument in order to handle packages installed inside the jail.ÙPman:pkg[8] å·¥å…·æ”¯æŒ `-j` å‚æ•°ï¼Œä»¥å¤„ç†å®‰è£…åœ¨ jail å†…çš„è½¯ä»¶åŒ…ã€‚ÙkFor example, to install package:nginx-lite[] in the jail, the next command can be executed *from the host*:ÙZä¾‹å¦‚ï¼Œåœ¨ jail ä¸­å®‰è£… package:nginx-lite[]ï¼Œå¯ä»¥ä»ä¸»æœºä¸Šæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼šÙ‚For more information on working with packages in FreeBSD, see crossref:ports[ports,"Installing Applications: Packages and Ports"].Ù†æœ‰å…³åœ¨ FreeBSD ä¸­ä½¿ç”¨è½¯ä»¶åŒ…çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜… crossref:ports[ports,â€œå®‰è£…åº”ç”¨ç¨‹åºï¼šè½¯ä»¶åŒ…å’Œ Portsâ€]ã€‚­Access a Jail²è®¿é—®ä¸€ä¸ª Jail Ù}While it has been stated above that it is best to manage jails from the host system, a jail can be entered with man:jexec[8].Ùfè™½ç„¶ä¸Šé¢å·²ç»æåˆ°æœ€å¥½ä»ä¸»æœºç³»ç»Ÿç®¡ç† jailï¼Œä½†å¯ä»¥ä½¿ç”¨ man:jexec[8] è¿›å…¥ jailã€‚Ù>The jail can be entered by running man:jexec[8] from the host:Ù=å¯ä»¥é€šè¿‡åœ¨ä¸»æœºä¸Šè¿è¡Œ man:jexec[8] æ¥è¿›å…¥ jailã€‚ÙYWhen gaining access to the jail, the message configured in man:motd[5] will be displayed.ÙCå½“è®¿é—® jail æ—¶ï¼Œå°†æ˜¾ç¤ºåœ¨ man:motd[5] ä¸­é…ç½®çš„æ¶ˆæ¯ã€‚ºExecute Commands in a Jail¸åœ¨ Jail ä¸­æ‰§è¡Œå‘½ä»¤ÙQTo execute a command from the host system in a jail the man:jexec[8] can be used.ÙVè¦åœ¨ä¸€ä¸ª jail ä¸­ä»ä¸»æœºç³»ç»Ÿæ‰§è¡Œå‘½ä»¤ï¼Œå¯ä»¥ä½¿ç”¨ man:jexec[8] å‘½ä»¤ã€‚Ù[For example, to stop a service that is running inside a jail, the command will be executed:ÙHä¾‹å¦‚ï¼Œè¦åœæ­¢åœ¨ jail ä¸­è¿è¡Œçš„æœåŠ¡ï¼Œå°†æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š®Jail Upgrading«Jail å‡çº§Ù³Upgrading FreeBSD Jails ensures that the isolated environments remain secure, up-to-date, and in line with the latest features and improvements available in the FreeBSD ecosystem.ÙŠå‡çº§ FreeBSD Jails å¯ä»¥ç¡®ä¿éš”ç¦»ç¯å¢ƒä¿æŒå®‰å…¨ã€æœ€æ–°ï¼Œå¹¶ä¸ FreeBSD ç”Ÿæ€ç³»ç»Ÿä¸­çš„æœ€æ–°åŠŸèƒ½å’Œæ”¹è¿›ä¿æŒä¸€è‡´ã€‚Ù?Upgrading a Classic Jail or a Thin Jail using OpenZFS SnapshotsÙ2ä½¿ç”¨ OpenZFS å¿«ç…§å‡çº§ç»å…¸ Jail æˆ–è–„ JailÙåJails *must be updated from the host* operating system.  The default behavior in FreeBSD is to disallow the use of man:chflags[1] in a jail.  This will prevent the update of some files so updating from withing the jail will fail.ÙÖJails å¿…é¡»ä»ä¸»æœºæ“ä½œç³»ç»Ÿè¿›è¡Œæ›´æ–°ã€‚åœ¨ FreeBSD ä¸­ï¼Œé»˜è®¤è¡Œä¸ºæ˜¯ç¦æ­¢åœ¨ jail ä¸­ä½¿ç”¨ man:chflags[1] å‘½ä»¤ã€‚è¿™å°†é˜»æ­¢å¯¹æŸäº›æ–‡ä»¶çš„æ›´æ–°ï¼Œå› æ­¤åœ¨ jail å†…éƒ¨è¿›è¡Œæ›´æ–°å°†å¤±è´¥ã€‚ÙƒTo update the jail to the latest patch release of the version of FreeBSD it is running, execute the following commands on the host:Ùiè¦å°† jail æ›´æ–°åˆ°è¿è¡Œçš„ FreeBSD ç‰ˆæœ¬çš„æœ€æ–°è¡¥ä¸ç‰ˆæœ¬ï¼Œè¯·åœ¨ä¸»æœºä¸Šæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼šÚTo upgrade the jail to a new major or minor version, first upgrade the host system as described in crossref:cutting-edge[freebsdupdate-upgrade,"Performing Major and Minor Version Upgrades"].  Once the host has been upgraded and rebooted, the jail can then be upgraded.Ùøè¦å°† jail å‡çº§åˆ°æ–°çš„ä¸»è¦æˆ–æ¬¡è¦ç‰ˆæœ¬ï¼Œé¦–å…ˆæŒ‰ç…§ crossref:cutting-edge[freebsdupdate-upgrade ,â€œæ‰§è¡Œä¸»è¦å’Œæ¬¡è¦ç‰ˆæœ¬å‡çº§â€] ä¸­æè¿°çš„æ–¹æ³•å‡çº§ä¸»æœºç³»ç»Ÿã€‚ä¸€æ—¦ä¸»æœºå‡çº§å¹¶é‡æ–°å¯åŠ¨ï¼Œå°±å¯ä»¥å‡çº§ jailã€‚ÙmIn case of upgrade from one version to another, it is easier to create a new jail than to upgrade completely.Ùcå¦‚æœä»ä¸€ä¸ªç‰ˆæœ¬å‡çº§åˆ°å¦ä¸€ä¸ªç‰ˆæœ¬ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ jail æ¯”å®Œå…¨å‡çº§æ›´å®¹æ˜“ã€‚ÙeFor example to upgrade from 13.1-RELEASE to 13.2-RELEASE, execute the following commands on the host:ÙZä¾‹å¦‚ï¼Œè¦ä» 13.1-RELEASE å‡çº§åˆ° 13.2-RELEASEï¼Œè¯·åœ¨ä¸»æœºä¸Šæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼šÙ”It is necessary to execute the `install` step two times.  The first one upgrades the kernel, and the second one upgrades the rest of the components.Ù\éœ€è¦æ‰§è¡Œä¸¤æ¬¡ `install` æ­¥éª¤ã€‚ç¬¬ä¸€æ¬¡å‡çº§å†…æ ¸ï¼Œç¬¬äºŒæ¬¡å‡çº§å…¶ä»–ç»„ä»¶ã€‚ÙÉThen, if it was a major version upgrade, reinstall all installed packages and restart the jail again.  This is required because the ABI version changes when upgrading between major versions of FreeBSD.ÙÏç„¶åï¼Œå¦‚æœæ˜¯ä¸€ä¸ªä¸»è¦ç‰ˆæœ¬çš„å‡çº§ï¼Œé‡æ–°å®‰è£…æ‰€æœ‰å·²å®‰è£…çš„è½¯ä»¶åŒ…å¹¶é‡æ–°å¯åŠ¨ jailã€‚è¿™æ˜¯å¿…éœ€çš„ï¼Œå› ä¸ºåœ¨ FreeBSD çš„ä¸»è¦ç‰ˆæœ¬ä¹‹é—´å‡çº§æ—¶ï¼ŒABI ç‰ˆæœ¬ä¼šå‘ç”Ÿå˜åŒ–ã€‚®From the host:¯æ¥è‡ªä¸»æœºï¼šÙ"Upgrading a Thin Jail Using NullFS¼ä½¿ç”¨ NullFS å‡çº§è–„ JailÙÅSince Thin Jails that use NullFS share the majority of system directories, they are very easy to update.  It is enough to update the template.  This allows updating multiple jails at the same time.Ù¤ç”±äºä½¿ç”¨ NullFS çš„è–„ Jails å…±äº«äº†å¤§éƒ¨åˆ†ç³»ç»Ÿç›®å½•ï¼Œå› æ­¤å®ƒä»¬éå¸¸å®¹æ˜“æ›´æ–°ã€‚åªéœ€æ›´æ–°æ¨¡æ¿å³å¯ï¼Œè¿™æ ·å¯ä»¥åŒæ—¶æ›´æ–°å¤šä¸ª Jailã€‚Ù‡To update the template to the latest patch release of the version of FreeBSD it is running, execute the following commands on the host:Ùiè¦å°†æ¨¡æ¿æ›´æ–°åˆ°è¿è¡Œçš„ FreeBSD ç‰ˆæœ¬çš„æœ€æ–°è¡¥ä¸ç‰ˆæœ¬ï¼Œè¯·åœ¨ä¸»æœºä¸Šæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼šÚTo upgrade the template to a new major or minor version, first upgrade the host system as described in crossref:cutting-edge[freebsdupdate-upgrade,"Performing Major and Minor Version Upgrades"].  Once the host has been upgraded and rebooted, the template can then be upgraded.Ùüè¦å°†æ¨¡æ¿å‡çº§åˆ°æ–°çš„ä¸»è¦æˆ–æ¬¡è¦ç‰ˆæœ¬ï¼Œé¦–å…ˆæŒ‰ç…§ crossref:cutting-edge[freebsdupdate-upgrade ,â€œæ‰§è¡Œä¸»è¦å’Œæ¬¡è¦ç‰ˆæœ¬å‡çº§â€] ä¸­æè¿°çš„æ–¹å¼å‡çº§ä¸»æœºç³»ç»Ÿã€‚ä¸€æ—¦ä¸»æœºå‡çº§å¹¶é‡æ–°å¯åŠ¨ï¼Œç„¶åå¯ä»¥å‡çº§æ¨¡æ¿ã€‚ÙfFor example, to upgrade from 13.1-RELEASE to 13.2-RELEASE, execute the following commands on the host:Ù[ä¾‹å¦‚ï¼Œè¦ä» 13.1-RELEASE å‡çº§åˆ° 13.2-RELEASE ï¼Œè¯·åœ¨ä¸»æœºä¸Šæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š´Jail Resource Limits±Jail èµ„æºé™åˆ¶ÙControlling the resources that a jail uses from the host system is a task to be taken into account by the system administrator.ÙQç³»ç»Ÿç®¡ç†å‘˜éœ€è¦è€ƒè™‘ä»ä¸»æœºç³»ç»Ÿæ§åˆ¶ jail ä½¿ç”¨çš„èµ„æºçš„ä»»åŠ¡ã€‚ÙXman:rctl[8] allows you to manage the resources that a jail can use from the host system.ÙHman:rctl[8] å…è®¸æ‚¨ä»ä¸»æœºç³»ç»Ÿç®¡ç† jail å¯ä»¥ä½¿ç”¨çš„èµ„æºã€‚ÙRThe `kern.racct.enable` tunable must be enabled at [.filename]#/boot/loader.conf#.ÙZå¿…é¡»åœ¨ `/boot/loader.conf` æ–‡ä»¶ä¸­å¯ç”¨ `tunables` çš„ `kern.racct.enable` é€‰é¡¹ã€‚Ù:The syntax to limit the resources of a jail is as follows:Ù$é™åˆ¶ jail èµ„æºçš„è¯­æ³•å¦‚ä¸‹ï¼šÙXFor example, to limit the maximum RAM that a jail can access, run the following command:ÙOä¾‹å¦‚ï¼Œè¦é™åˆ¶ä¸€ä¸ª jail å¯ä»¥è®¿é—®çš„æœ€å¤§ RAMï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼šÙTo make the limitation persistent across reboots of the host system, it will be necessary to add the rule to the [.filename]#/etc/rctl.conf# file as follows:ÙŒä¸ºäº†ä½¿é™åˆ¶åœ¨ä¸»æœºç³»ç»Ÿé‡æ–°å¯åŠ¨åä»ç„¶æœ‰æ•ˆï¼Œéœ€è¦å°†è§„åˆ™æ·»åŠ åˆ° [.filename]#/etc/rctl.conf# æ–‡ä»¶ä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼šÙ•More information on resource limits can be found in the security chapter in the crossref:security[security-resourcelimits,"Resource Limits section"].Ù™æœ‰å…³èµ„æºé™åˆ¶çš„æ›´å¤šä¿¡æ¯å¯ä»¥åœ¨å®‰å…¨ç« èŠ‚ä¸­æ‰¾åˆ°ï¼Œå…·ä½“è¯·å‚è€ƒ crossref:security[security-resourcelimits,â€œèµ„æºé™åˆ¶éƒ¨åˆ†â€] ã€‚¼Jail Managers and Containers·Jail ç®¡ç†å™¨å’Œå®¹å™¨Ù¶As previously explained, each type of FreeBSD Jail can be created and configured manually, but FreeBSD also has third-party utilities to make configuration and administration easier.Ù•å¦‚å‰æ‰€è¿°ï¼Œæ¯ç§ç±»å‹çš„ FreeBSD Jail éƒ½å¯ä»¥æ‰‹åŠ¨åˆ›å»ºå’Œé…ç½®ï¼Œä½† FreeBSD è¿˜æœ‰ç¬¬ä¸‰æ–¹å·¥å…·å¯ä»¥ä½¿é…ç½®å’Œç®¡ç†æ›´åŠ ç®€ä¾¿ã€‚ÙCBelow is an incomplete list of the different FreeBSD Jail managers:ÙDä¸‹é¢æ˜¯ä¸€ä¸ªä¸å®Œæ•´çš„ä¸åŒ FreeBSD Jail ç®¡ç†å™¨çš„åˆ—è¡¨ï¼š­Jail Managers®Jail ç®¡ç†å™¨§License©è®¸å¯è¯­Documentation¦æ–‡æ¡£Ù>link:https://bastille.readthedocs.io/en/latest/[Documentation]Ù7link:https://bastille.readthedocs.io/en/latest/[æ–‡æ¡£]Ù-link:https://pot.pizzamig.dev/[Documentation]Ù&link:https://pot.pizzamig.dev/[æ–‡æ¡£]Ù8link:https://www.bsdstore.ru/en/docs.html[Documentation]Ù1link:https://www.bsdstore.ru/en/docs.html[æ–‡æ¡£]ÙDlink:https://github.com/DtxdF/AppJail#getting-started[Documentation]Ù=link:https://github.com/DtxdF/AppJail#getting-started[æ–‡æ¡£]Ù<link:https://iocage.readthedocs.io/en/latest/[Documentation]Ù5link:https://iocage.readthedocs.io/en/latest/[æ–‡æ¡£]Ù>link:https://erdgeist.org/arts/software/ezjail/[Documentation]Ù7link:https://erdgeist.org/arts/software/ezjail/[æ–‡æ¡£]Ù«This chapter covers how to configure the FreeBSD Kernel. When to build a custom kernel, how to take a hardware inventory, how to customize a kernel configuration file, etcÙ–æœ¬ç« ä»‹ç»äº†å¦‚ä½•é…ç½® FreeBSD å†…æ ¸ã€‚åŒ…æ‹¬ä½•æ—¶æ„å»ºè‡ªå®šä¹‰å†…æ ¸ï¼Œå¦‚ä½•è¿›è¡Œç¡¬ä»¶æ¸…æŸ¥ï¼Œå¦‚ä½•è‡ªå®šä¹‰å†…æ ¸é…ç½®æ–‡ä»¶ç­‰ç­‰ã€‚Ù*Chapter 10. Configuring the FreeBSD KernelÙ ç¬¬ 10 ç«  é…ç½® FreeBSD å†…æ ¸¾Configuring the FreeBSD Kernelµé…ç½® FreeBSD å†…æ ¸Ú%The kernel is the core of the FreeBSD operating system.  It is responsible for managing memory, enforcing security controls, networking, disk access, and much more.  While much of FreeBSD is dynamically configurable, it is still occasionally necessary to configure and compile a custom kernel.Ùáå†…æ ¸æ˜¯ FreeBSD æ“ä½œç³»ç»Ÿçš„æ ¸å¿ƒã€‚å®ƒè´Ÿè´£ç®¡ç†å†…å­˜ã€æ‰§è¡Œå®‰å…¨æ§åˆ¶ã€ç½‘ç»œã€ç£ç›˜è®¿é—®ç­‰ç­‰ã€‚å°½ç®¡ FreeBSD çš„è®¸å¤šéƒ¨åˆ†æ˜¯åŠ¨æ€å¯é…ç½®çš„ï¼Œä½†æœ‰æ—¶ä»ç„¶éœ€è¦é…ç½®å’Œç¼–è¯‘è‡ªå®šä¹‰å†…æ ¸ã€‚¾When to build a custom kernel.¾ä½•æ—¶æ„å»ºè‡ªå®šä¹‰å†…æ ¸ã€‚Ù!How to take a hardware inventory.»å¦‚ä½•è¿›è¡Œç¡¬ä»¶æ¸…æŸ¥ã€‚Ù-How to customize a kernel configuration file.Ù$å¦‚ä½•è‡ªå®šä¹‰å†…æ ¸é…ç½®æ–‡ä»¶ã€‚ÙJHow to use the kernel configuration file to create and build a new kernel.Ù9å¦‚ä½•ä½¿ç”¨å†…æ ¸é…ç½®æ–‡ä»¶åˆ›å»ºå’Œæ„å»ºæ–°å†…æ ¸ã€‚¾How to install the new kernel.¸å¦‚ä½•å®‰è£…æ–°å†…æ ¸ã€‚Ù'How to troubleshoot if things go wrong.Ù0å¦‚æœå‡ºç°é—®é¢˜ï¼Œå¦‚ä½•è¿›è¡Œæ•…éšœæ’é™¤ã€‚ÙXAll of the commands listed in the examples in this chapter should be executed as `root`.ÙMæœ¬ç« ä¸­ç¤ºä¾‹ä¸­åˆ—å‡ºçš„æ‰€æœ‰å‘½ä»¤éƒ½åº”ä»¥ `root` ç”¨æˆ·èº«ä»½æ‰§è¡Œã€‚ºWhy Build a Custom Kernel?Ù$ä¸ºä»€ä¹ˆè¦æ„å»ºè‡ªå®šä¹‰å†…æ ¸ï¼ŸÙÚTraditionally, FreeBSD used a monolithic kernel.  The kernel was one large program, supported a fixed list of devices, and in order to change the kernel's behavior, one had to compile and then reboot into a new kernel.ÙÅä¼ ç»Ÿä¸Šï¼ŒFreeBSD ä½¿ç”¨çš„æ˜¯ä¸€ä¸ªå•å†…æ ¸ã€‚å†…æ ¸æ˜¯ä¸€ä¸ªåºå¤§çš„ç¨‹åºï¼Œæ”¯æŒä¸€ç»„å›ºå®šçš„è®¾å¤‡ï¼Œå¹¶ä¸”è¦æ”¹å˜å†…æ ¸çš„è¡Œä¸ºï¼Œéœ€è¦ç¼–è¯‘å¹¶é‡æ–°å¯åŠ¨åˆ°ä¸€ä¸ªæ–°çš„å†…æ ¸ã€‚Ú;Today, most of the functionality in the FreeBSD kernel is contained in modules which can be dynamically loaded and unloaded from the kernel as necessary.  This allows the running kernel to adapt immediately to new hardware and for new functionality to be brought into the kernel.  This is known as a modular kernel.Ùøå¦‚ä»Šï¼ŒFreeBSD å†…æ ¸ä¸­çš„å¤§éƒ¨åˆ†åŠŸèƒ½éƒ½åŒ…å«åœ¨æ¨¡å—ä¸­ï¼Œè¿™äº›æ¨¡å—å¯ä»¥æ ¹æ®éœ€è¦åŠ¨æ€åŠ è½½å’Œå¸è½½ã€‚è¿™ä½¿å¾—è¿è¡Œä¸­çš„å†…æ ¸èƒ½å¤Ÿç«‹å³é€‚åº”æ–°çš„ç¡¬ä»¶ï¼Œå¹¶å°†æ–°çš„åŠŸèƒ½å¼•å…¥å†…æ ¸ä¸­ã€‚è¿™è¢«ç§°ä¸ºæ¨¡å—åŒ–å†…æ ¸ã€‚ÚYOccasionally, it is still necessary to perform static kernel configuration.  Sometimes the needed functionality is so tied to the kernel that it can not be made dynamically loadable.  Some security environments prevent the loading and unloading of kernel modules and require that only needed functionality is statically compiled into the kernel.Ùğå¶å°”ï¼Œä»ç„¶æœ‰å¿…è¦è¿›è¡Œé™æ€å†…æ ¸é…ç½®ã€‚æœ‰æ—¶æ‰€éœ€åŠŸèƒ½ä¸å†…æ ¸ç´§å¯†ç›¸å…³ï¼Œæ— æ³•ä»¥åŠ¨æ€åŠ è½½çš„æ–¹å¼å®ç°ã€‚æŸäº›å®‰å…¨ç¯å¢ƒç¦æ­¢åŠ è½½å’Œå¸è½½å†…æ ¸æ¨¡å—ï¼Œå¹¶è¦æ±‚åªå°†æ‰€éœ€åŠŸèƒ½é™æ€ç¼–è¯‘åˆ°å†…æ ¸ä¸­ã€‚ÚvBuilding a custom kernel is often a rite of passage for advanced BSD users.  This process, while time consuming, can provide benefits to the FreeBSD system.  Unlike the [.filename]#GENERIC# kernel, which must support a wide range of hardware, a custom kernel can be stripped down to only provide support for that computer's hardware.  This has a number of benefits, such as:Ú>å¯¹äºé«˜çº§ BSD ç”¨æˆ·æ¥è¯´ï¼Œæ„å»ºè‡ªå®šä¹‰å†…æ ¸é€šå¸¸æ˜¯ä¸€ç§æˆå¹´ç¤¼ã€‚å°½ç®¡è¿™ä¸ªè¿‡ç¨‹è€—æ—¶ï¼Œä½†å¯ä»¥ä¸º FreeBSD ç³»ç»Ÿå¸¦æ¥å¥½å¤„ã€‚ä¸å¿…é¡»æ”¯æŒå„ç§ç¡¬ä»¶çš„ [.filename]#GENERIC# å†…æ ¸ä¸åŒï¼Œè‡ªå®šä¹‰å†…æ ¸å¯ä»¥ç²¾ç®€ä¸ºä»…æä¾›å¯¹è¯¥è®¡ç®—æœºç¡¬ä»¶çš„æ”¯æŒã€‚è¿™æœ‰è®¸å¤šå¥½å¤„ï¼Œä¾‹å¦‚ï¼šÙFaster boot time. Since the kernel will only probe the hardware on the system, the time it takes the system to boot can decrease.Ùoæ›´å¿«çš„å¯åŠ¨æ—¶é—´ã€‚ç”±äºå†…æ ¸åªä¼šæ¢æµ‹ç³»ç»Ÿä¸Šçš„ç¡¬ä»¶ï¼Œç³»ç»Ÿå¯åŠ¨æ‰€éœ€çš„æ—¶é—´å¯ä»¥å‡å°‘ã€‚ÚvLower memory usage. A custom kernel often uses less memory than the [.filename]#GENERIC# kernel by omitting unused features and device drivers. This is important because the kernel code remains resident in physical memory at all times, preventing that memory from being used by applications. For this reason, a custom kernel is useful on a system with a small amount of RAM.ÚWè¾ƒä½çš„å†…å­˜ä½¿ç”¨é‡ã€‚è‡ªå®šä¹‰å†…æ ¸é€šå¸¸é€šè¿‡çœç•¥æœªä½¿ç”¨çš„åŠŸèƒ½å’Œè®¾å¤‡é©±åŠ¨ç¨‹åºæ¥ä½¿ç”¨è¾ƒå°‘çš„å†…å­˜ï¼Œç›¸æ¯”äº [.filename]#GENERIC# å†…æ ¸ã€‚è¿™å¾ˆé‡è¦ï¼Œå› ä¸ºå†…æ ¸ä»£ç å§‹ç»ˆé©»ç•™åœ¨ç‰©ç†å†…å­˜ä¸­ï¼Œé˜²æ­¢è¯¥å†…å­˜è¢«åº”ç”¨ç¨‹åºä½¿ç”¨ã€‚å› æ­¤ï¼Œåœ¨å†…å­˜è¾ƒå°çš„ç³»ç»Ÿä¸Šä½¿ç”¨è‡ªå®šä¹‰å†…æ ¸éå¸¸æœ‰ç”¨ã€‚Ù‚Additional hardware support. A custom kernel can add support for devices which are not present in the [.filename]#GENERIC# kernel.Ùpé¢å¤–çš„ç¡¬ä»¶æ”¯æŒã€‚è‡ªå®šä¹‰å†…æ ¸å¯ä»¥ä¸º [.filename]#GENERIC# å†…æ ¸ä¸­ä¸å­˜åœ¨çš„è®¾å¤‡æ·»åŠ æ”¯æŒã€‚Ù—Before building a custom kernel, consider the reason for doing so.  If there is a need for specific hardware support, it may already exist as a module.Ùåœ¨æ„å»ºè‡ªå®šä¹‰å†…æ ¸ä¹‹å‰ï¼Œè¯·è€ƒè™‘è¿›è¡Œæ­¤æ“ä½œçš„åŸå› ã€‚å¦‚æœéœ€è¦ç‰¹å®šçš„ç¡¬ä»¶æ”¯æŒï¼Œå¯èƒ½å·²ç»å­˜åœ¨ç›¸åº”çš„æ¨¡å—ã€‚Ú!Kernel modules exist in [.filename]#/boot/kernel# and may be dynamically loaded into the running kernel using man:kldload[8].  Most kernel drivers have a loadable module and manual page.  For example, the man:ath[4] wireless network driver has the following information in its manual page:Ú å†…æ ¸æ¨¡å—å­˜åœ¨äº [.filename]#/boot/kernel# ç›®å½•ä¸­ï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨ man:kldload[8] å‘½ä»¤åŠ¨æ€åŠ è½½åˆ°è¿è¡Œä¸­çš„å†…æ ¸ä¸­ã€‚å¤§å¤šæ•°å†…æ ¸é©±åŠ¨ç¨‹åºéƒ½æœ‰å¯åŠ è½½çš„æ¨¡å—å’Œæ‰‹å†Œé¡µã€‚ä¾‹å¦‚ï¼Œman:ath[4] æ— çº¿ç½‘ç»œé©±åŠ¨ç¨‹åºåœ¨å…¶æ‰‹å†Œé¡µä¸­åŒ…å«ä»¥ä¸‹ä¿¡æ¯ï¼šÙlAdding `if_ath_load="YES"` to [.filename]#/boot/loader.conf# will load this module dynamically at boot time.Ùlåœ¨ [.filename]#/boot/loader.conf# ä¸­æ·»åŠ  `if_ath_load ="YES"` å°†ä¼šåœ¨å¯åŠ¨æ—¶åŠ¨æ€åŠ è½½è¯¥æ¨¡å—ã€‚ÙwIn some cases, there is no associated module in [.filename]#/boot/kernel#.  This is mostly true for certain subsystems.Ùwåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œ[.filename]#/boot/kernel# ä¸­æ²¡æœ‰å…³è”çš„æ¨¡å—ã€‚è¿™åœ¨æŸäº›å­ç³»ç»Ÿä¸­æ˜¯æ™®éå­˜åœ¨çš„ã€‚»Finding the System Hardware²æŸ¥æ‰¾ç³»ç»Ÿç¡¬ä»¶Ú"Before editing the kernel configuration file, it is recommended to perform an inventory of the machine's hardware.  On a dual-boot system, the inventory can be created from the other operating system.  For example, Microsoft(R)'s Device Manager contains information about installed devices.Ùâåœ¨ç¼–è¾‘å†…æ ¸é…ç½®æ–‡ä»¶ä¹‹å‰ï¼Œå»ºè®®å…ˆå¯¹æœºå™¨çš„ç¡¬ä»¶è¿›è¡Œæ¸…æŸ¥ã€‚åœ¨åŒå¯åŠ¨ç³»ç»Ÿä¸Šï¼Œå¯ä»¥ä»å…¶ä»–æ“ä½œç³»ç»Ÿä¸­åˆ›å»ºæ¸…å•ã€‚ä¾‹å¦‚ï¼ŒMicrosoft(R) çš„è®¾å¤‡ç®¡ç†å™¨åŒ…å«æœ‰å…³å·²å®‰è£…è®¾å¤‡çš„ä¿¡æ¯ã€‚ÙgSome versions of Microsoft(R) Windows(R) have a System icon which can be used to access Device Manager.Ùgä¸€äº› Microsoft(R) Windows(R) çš„ç‰ˆæœ¬ä¸­æœ‰ä¸€ä¸ªç³»ç»Ÿå›¾æ ‡ï¼Œå¯ä»¥ç”¨æ¥è®¿é—®è®¾å¤‡ç®¡ç†å™¨ã€‚ÚIIf FreeBSD is the only installed operating system, use man:dmesg[8] to determine the hardware that was found and listed during the boot probe.  Most device drivers on FreeBSD have a manual page which lists the hardware supported by that driver.  For example, the following lines indicate that the man:psm[4] driver found a mouse:Ú<å¦‚æœ FreeBSD æ˜¯å”¯ä¸€å®‰è£…çš„æ“ä½œç³»ç»Ÿï¼Œè¯·ä½¿ç”¨ man:dmesg[8] å‘½ä»¤æ¥ç¡®å®šåœ¨å¯åŠ¨æ¢æµ‹æœŸé—´æ‰¾åˆ°å’Œåˆ—å‡ºçš„ç¡¬ä»¶ã€‚FreeBSD ä¸Šçš„å¤§å¤šæ•°è®¾å¤‡é©±åŠ¨ç¨‹åºéƒ½æœ‰ä¸€ä¸ªæ‰‹å†Œé¡µé¢ï¼Œåˆ—å‡ºäº†è¯¥é©±åŠ¨ç¨‹åºæ”¯æŒçš„ç¡¬ä»¶ã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹è¡Œè¡¨ç¤º man:psm[4] é©±åŠ¨ç¨‹åºæ‰¾åˆ°äº†ä¸€ä¸ªé¼ æ ‡ï¼šÙfSince this hardware exists, this driver should not be removed from a custom kernel configuration file.Ù]ç”±äºå­˜åœ¨è¿™ä¸ªç¡¬ä»¶ï¼Œè¿™ä¸ªé©±åŠ¨ç¨‹åºä¸åº”ä»è‡ªå®šä¹‰å†…æ ¸é…ç½®æ–‡ä»¶ä¸­åˆ é™¤ã€‚ÙIf the output of `dmesg` does not display the results of the boot probe output, instead read the contents of [.filename]#/var/run/dmesg.boot#.Ù‚å¦‚æœ `dmesg` å‘½ä»¤çš„è¾“å‡ºæ²¡æœ‰æ˜¾ç¤ºå¼•å¯¼æ¢æµ‹çš„ç»“æœï¼Œå¯ä»¥è¯»å–æ–‡ä»¶ [.filename]#/var/run/dmesg.boot# çš„å†…å®¹ã€‚ÙfAnother tool for finding hardware is man:pciconf[8], which provides more verbose output.  For example:Ù`å¦ä¸€ä¸ªç”¨äºæŸ¥æ‰¾ç¡¬ä»¶çš„å·¥å…·æ˜¯ man:pciconf[8]ï¼Œå®ƒæä¾›æ›´è¯¦ç»†çš„è¾“å‡ºã€‚ä¾‹å¦‚ï¼šÙVThis output shows that the [.filename]#ath# driver located a wireless Ethernet device.ÙWè¿™ä¸ªè¾“å‡ºæ˜¾ç¤º [.filename]#ath# é©±åŠ¨ç¨‹åºæ‰¾åˆ°äº†ä¸€ä¸ªæ— çº¿ä»¥å¤ªç½‘è®¾å¤‡ã€‚Ù¶The `-k` flag of man:man[1] can be used to provide useful information.  For example, it can be used to display a list of manual pages which contain a particular device brand or name:Ù•man:man[1] çš„ `-k` æ ‡å¿—å¯ä»¥ç”¨æ¥æä¾›æœ‰ç”¨çš„ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼Œå®ƒå¯ä»¥ç”¨æ¥æ˜¾ç¤ºåŒ…å«ç‰¹å®šè®¾å¤‡å“ç‰Œæˆ–åç§°çš„æ‰‹å†Œé¡µé¢åˆ—è¡¨ï¼šÙ¤Once the hardware inventory list is created, refer to it to ensure that drivers for installed hardware are not removed as the custom kernel configuration is edited.Ù~åˆ›å»ºç¡¬ä»¶æ¸…å•åï¼Œå‚è€ƒè¯¥æ¸…å•ä»¥ç¡®ä¿åœ¨ç¼–è¾‘è‡ªå®šä¹‰å†…æ ¸é…ç½®æ—¶ä¸è¦åˆ é™¤å·²å®‰è£…ç¡¬ä»¶çš„é©±åŠ¨ç¨‹åºã€‚¶The Configuration File¬é…ç½®æ–‡ä»¶Ù†In order to create a custom kernel configuration file and build a custom kernel, the full FreeBSD source tree must first be installed.Ù‡ä¸ºäº†åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„å†…æ ¸é…ç½®æ–‡ä»¶å¹¶æ„å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„å†…æ ¸ï¼Œé¦–å…ˆå¿…é¡»å®‰è£…å®Œæ•´çš„ FreeBSD æºä»£ç æ ‘ã€‚ÙºIf [.filename]#/usr/src/# does not exist or it is empty, source has not been installed.  Source can be installed with Git using the instructions in crossref:mirrors[git,â€œUsing Gitâ€].Ù´å¦‚æœ [.filename]#/usr/src/# ä¸å­˜åœ¨æˆ–ä¸ºç©ºï¼Œåˆ™è¡¨ç¤ºæºä»£ç æœªå®‰è£…ã€‚å¯ä»¥ä½¿ç”¨ Git å®‰è£…æºä»£ç ï¼Œå…·ä½“æ“ä½œè¯·å‚è€ƒ crossref:mirrors[git,â€œä½¿ç”¨ Gitâ€] ã€‚ÚbOnce source is installed, review the contents of [.filename]#/usr/src/sys#.  This directory contains a number of subdirectories, including those which represent the following supported architectures: [.filename]#amd64#, [.filename]#i386#, [.filename]#powerpc#, and [.filename]#sparc64#.  Everything inside a particular architecture's directory deals with that architecture only and the rest of the code is machine independent code common to all platforms.  Each supported architecture has a [.filename]#conf# subdirectory which contains the [.filename]#GENERIC# kernel configuration file for that architecture.Ú–å®‰è£…å®Œæˆåï¼Œè¯·æŸ¥çœ‹ [.filename]#/usr/src/sys# ç›®å½•çš„å†…å®¹ã€‚è¯¥ç›®å½•åŒ…å«è®¸å¤šå­ç›®å½•ï¼Œå…¶ä¸­åŒ…æ‹¬ä»¥ä¸‹æ”¯æŒçš„æ¶æ„ï¼šamd64ï¼Œi386ï¼Œpowerpc å’Œ sparc64ã€‚ç‰¹å®šæ¶æ„ç›®å½•ä¸­çš„æ‰€æœ‰å†…å®¹ä»…ä¸è¯¥æ¶æ„ç›¸å…³ï¼Œè€Œå…¶ä½™ä»£ç æ˜¯é€‚ç”¨äºæ‰€æœ‰å¹³å°çš„æœºå™¨æ— å…³ä»£ç ã€‚æ¯ä¸ªæ”¯æŒçš„æ¶æ„éƒ½æœ‰ä¸€ä¸ª conf å­ç›®å½•ï¼Œå…¶ä¸­åŒ…å«è¯¥æ¶æ„çš„ GENERIC å†…æ ¸é…ç½®æ–‡ä»¶ã€‚ÚµDo not make edits to [.filename]#GENERIC#.  Instead, copy the file to a different name and make edits to the copy.  The convention is to use a name with all capital letters.  When maintaining multiple FreeBSD machines with different hardware, it is a good idea to name it after the machine's hostname.  This example creates a copy, named [.filename]#MYKERNEL#, of the [.filename]#GENERIC# configuration file for the `amd64` architecture:Ú~ä¸è¦å¯¹ [.filename]#GENERIC# è¿›è¡Œç¼–è¾‘ã€‚ç›¸åï¼Œå°†æ–‡ä»¶å¤åˆ¶åˆ°å¦ä¸€ä¸ªåç§°å¹¶å¯¹å‰¯æœ¬è¿›è¡Œç¼–è¾‘ã€‚æƒ¯ä¾‹æ˜¯ä½¿ç”¨å…¨å¤§å†™å­—æ¯çš„åç§°ã€‚å½“ç»´æŠ¤å…·æœ‰ä¸åŒç¡¬ä»¶çš„å¤šä¸ª FreeBSD æœºå™¨æ—¶ï¼Œæœ€å¥½ä½¿ç”¨æœºå™¨çš„ä¸»æœºåæ¥å‘½åã€‚æ­¤ç¤ºä¾‹åˆ›å»ºäº†ä¸€ä¸ªåä¸º [.filename]#MYKERNEL# çš„å‰¯æœ¬ï¼Œç”¨äº `amd64` æ¶æ„çš„ [.filename]#GENERIC# é…ç½®æ–‡ä»¶ã€‚Ù¶[.filename]#MYKERNEL# can now be customized with any `ASCII` text editor.  The default editor is vi, though an easier editor for beginners, called ee, is also installed with FreeBSD.ÙÅ[.filename]#MYKERNEL# ç°åœ¨å¯ä»¥ä½¿ç”¨ä»»ä½• `ASCII` æ–‡æœ¬ç¼–è¾‘å™¨è¿›è¡Œè‡ªå®šä¹‰ã€‚é»˜è®¤ç¼–è¾‘å™¨æ˜¯ viï¼Œå°½ç®¡ FreeBSD è¿˜å®‰è£…äº†ä¸€ä¸ªæ›´é€‚åˆåˆå­¦è€…çš„ç®€åŒ–ç¼–è¾‘å™¨ï¼Œåä¸º ee ã€‚ÚªThe format of the kernel configuration file is simple.  Each line contains a keyword that represents a device or subsystem, an argument, and a brief description.  Any text after a `+#+` is considered a comment and ignored.  To remove kernel support for a device or subsystem, put a `+#+` at the beginning of the line representing that device or subsystem.  Do not add or remove a `+#+` for any line that you do not understand.Ú‚å†…æ ¸é…ç½®æ–‡ä»¶çš„æ ¼å¼å¾ˆç®€å•ã€‚æ¯ä¸€è¡ŒåŒ…å«ä¸€ä¸ªå…³é”®å­—ï¼Œä»£è¡¨ä¸€ä¸ªè®¾å¤‡æˆ–å­ç³»ç»Ÿï¼Œä¸€ä¸ªå‚æ•°å’Œä¸€ä¸ªç®€çŸ­çš„æè¿°ã€‚åœ¨ `+#+` ä¹‹åçš„ä»»ä½•æ–‡æœ¬éƒ½è¢«è§†ä¸ºæ³¨é‡Šå¹¶è¢«å¿½ç•¥ã€‚è¦ç§»é™¤å¯¹è®¾å¤‡æˆ–å­ç³»ç»Ÿçš„å†…æ ¸æ”¯æŒï¼Œè¯·åœ¨è¡¨ç¤ºè¯¥è®¾å¤‡æˆ–å­ç³»ç»Ÿçš„è¡Œçš„å¼€å¤´åŠ ä¸Š `+#+` ã€‚å¯¹äºä»»ä½•ä½ ä¸ç†è§£çš„è¡Œï¼Œè¯·ä¸è¦æ·»åŠ æˆ–åˆ é™¤ `+#+`ã€‚ÚIt is easy to remove support for a device or option and end up with a broken kernel.  For example, if the man:ata[4] driver is removed from the kernel configuration file, a system using `ATA` disk drivers may not boot.  When in doubt, just leave support in the kernel.Úåˆ é™¤è®¾å¤‡æˆ–é€‰é¡¹çš„æ”¯æŒå¹¶æœ€ç»ˆå¯¼è‡´å†…æ ¸æŸåæ˜¯å¾ˆå®¹æ˜“çš„ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä»å†…æ ¸é…ç½®æ–‡ä»¶ä¸­åˆ é™¤äº† man:ata[4] é©±åŠ¨ç¨‹åºï¼Œä½¿ç”¨ `ATA` ç£ç›˜é©±åŠ¨ç¨‹åºçš„ç³»ç»Ÿå¯èƒ½æ— æ³•å¯åŠ¨ã€‚å½“æœ‰ç–‘é—®æ—¶ï¼Œæœ€å¥½ä¿ç•™å†…æ ¸ä¸­çš„æ”¯æŒã€‚Ú'In addition to the brief descriptions provided in this file, additional descriptions are contained in [.filename]#NOTES#, which can be found in the same directory as [.filename]#GENERIC# for that architecture.  For architecture independent options, refer to [.filename]#/usr/src/sys/conf/NOTES#.Ùûé™¤äº†æœ¬æ–‡ä»¶ä¸­æä¾›çš„ç®€è¦æè¿°å¤–ï¼Œå…¶ä»–æè¿°è¿˜åŒ…å«åœ¨ä¸è¯¥æ¶æ„çš„ [.filename]#GENERIC# æ–‡ä»¶ä½äºåŒä¸€ç›®å½•ä¸­çš„ [.filename]#NOTES# æ–‡ä»¶ä¸­ã€‚å¯¹äºä¸æ¶æ„æ— å…³çš„é€‰é¡¹ï¼Œè¯·å‚è€ƒ [.filename]#/usr/src/sys/conf/NOTES# ã€‚Ù{When finished customizing the kernel configuration file, save a backup copy to a location outside of [.filename]#/usr/src#.Ùqåœ¨å®Œæˆè‡ªå®šä¹‰å†…æ ¸é…ç½®æ–‡ä»¶åï¼Œå°†å¤‡ä»½å‰¯æœ¬ä¿å­˜åˆ°ä½äº [.filename]#/usr/src# ä¹‹å¤–çš„ä½ç½®ã€‚ÙaAlternately, keep the kernel configuration file elsewhere and create a symbolic link to the file:Ùcæˆ–è€…ï¼Œå°†å†…æ ¸é…ç½®æ–‡ä»¶ä¿å­˜åœ¨å…¶ä»–ä½ç½®ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªç¬¦å·é“¾æ¥æŒ‡å‘è¯¥æ–‡ä»¶ï¼šÚ€An `include` directive is available for use in configuration files.  This allows another configuration file to be included in the current one, making it easy to maintain small changes relative to an existing file.  If only a small number of additional options or drivers are required, this allows a delta to be maintained with respect to [.filename]#GENERIC#, as seen in this example:Ú)é…ç½®æ–‡ä»¶ä¸­å¯ä»¥ä½¿ç”¨ `include` æŒ‡ä»¤ã€‚è¿™å…è®¸å°†å¦ä¸€ä¸ªé…ç½®æ–‡ä»¶åŒ…å«åœ¨å½“å‰æ–‡ä»¶ä¸­ï¼Œä»è€Œæ–¹ä¾¿åœ°å¯¹ç°æœ‰æ–‡ä»¶è¿›è¡Œå°çš„ä¿®æ”¹ã€‚å¦‚æœåªéœ€è¦å°‘é‡çš„é¢å¤–é€‰é¡¹æˆ–é©±åŠ¨ç¨‹åºï¼Œè¿™æ ·å¯ä»¥ç›¸å¯¹äº [.filename]#GENERIC# ä¿æŒå¢é‡ï¼Œå¦‚ä¸‹é¢çš„ç¤ºä¾‹æ‰€ç¤ºï¼šÚUsing this method, the local configuration file expresses local differences from a [.filename]#GENERIC# kernel.  As upgrades are performed, new features added to [.filename]#GENERIC# will also be added to the local kernel unless they are specifically prevented using `nooptions` or `nodevice`.  A comprehensive list of configuration directives and their descriptions may be found in man:config[5].ÚMä½¿ç”¨è¿™ç§æ–¹æ³•ï¼Œæœ¬åœ°é…ç½®æ–‡ä»¶è¡¨è¾¾äº†ä¸ [.filename]#GENERIC# å†…æ ¸çš„æœ¬åœ°å·®å¼‚ã€‚éšç€å‡çº§çš„è¿›è¡Œï¼Œæ·»åŠ åˆ° [.filename]#GENERIC# çš„æ–°åŠŸèƒ½ä¹Ÿå°†æ·»åŠ åˆ°æœ¬åœ°å†…æ ¸ä¸­ï¼Œé™¤éä½¿ç”¨ `nooptions` æˆ– `nodevice` æ˜ç¡®ç¦æ­¢å®ƒä»¬ã€‚æœ‰å…³é…ç½®æŒ‡ä»¤åŠå…¶æè¿°çš„è¯¦ç»†åˆ—è¡¨ï¼Œè¯·å‚é˜… man:config[5] ã€‚ÙZTo build a file which contains all available options, run the following command as `root`:Ù\è¦æ„å»ºä¸€ä¸ªåŒ…å«æ‰€æœ‰å¯ç”¨é€‰é¡¹çš„æ–‡ä»¶ï¼Œè¯·ä»¥ `root` èº«ä»½è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼šÙ'Building and Installing a Custom Kernel¾æ„å»ºå’Œå®‰è£…è‡ªå®šä¹‰å†…æ ¸ÙŠOnce the edits to the custom configuration file have been saved, the source code for the kernel can be compiled using the following steps:Ùfä¸€æ—¦è‡ªå®šä¹‰é…ç½®æ–‡ä»¶çš„ç¼–è¾‘ä¿å­˜å®Œæ¯•ï¼Œå¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤ç¼–è¯‘å†…æ ¸çš„æºä»£ç ï¼š¿*Procedure: Building a Kernel*
¸*è¿‡ç¨‹ï¼šæ„å»ºå†…æ ¸*
¹Change to this directory:¸åˆ‡æ¢åˆ°è¿™ä¸ªç›®å½•ï¼šÙVCompile the new kernel by specifying the name of the custom kernel configuration file:ÙHé€šè¿‡æŒ‡å®šè‡ªå®šä¹‰å†…æ ¸é…ç½®æ–‡ä»¶çš„åç§°æ¥ç¼–è¯‘æ–°çš„å†…æ ¸ï¼šÙÚInstall the new kernel associated with the specified kernel configuration file. This command will copy the new kernel to [.filename]#/boot/kernel/kernel# and save the old kernel to [.filename]#/boot/kernel.old/kernel#:Ù½å®‰è£…ä¸æŒ‡å®šçš„å†…æ ¸é…ç½®æ–‡ä»¶ç›¸å…³è”çš„æ–°å†…æ ¸ã€‚æ­¤å‘½ä»¤å°†æ–°å†…æ ¸å¤åˆ¶åˆ° [.filename]#/boot/kernel/kernel# å¹¶å°†æ—§å†…æ ¸ä¿å­˜åˆ° [.filename]#/boot/kernel.old/kernel# ã€‚ÙˆShutdown the system and reboot into the new kernel. If something goes wrong, refer to <<kernelconfig-noboot, The kernel does not boot>>.Ùvå…³é—­ç³»ç»Ÿå¹¶é‡æ–°å¯åŠ¨åˆ°æ–°å†…æ ¸ã€‚å¦‚æœå‡ºç°é—®é¢˜ï¼Œè¯·å‚è€ƒ <<kernelconfig-noboot,å†…æ ¸æ— æ³•å¯åŠ¨>>ã€‚ÙÏBy default, when a custom kernel is compiled, all kernel modules are rebuilt.  To update a kernel faster or to build only custom modules, edit [.filename]#/etc/make.conf# before starting to build the kernel.Ùİé»˜è®¤æƒ…å†µä¸‹ï¼Œå½“ç¼–è¯‘è‡ªå®šä¹‰å†…æ ¸æ—¶ï¼Œæ‰€æœ‰å†…æ ¸æ¨¡å—éƒ½ä¼šé‡æ–°æ„å»ºã€‚ä¸ºäº†æ›´å¿«åœ°æ›´æ–°å†…æ ¸æˆ–ä»…æ„å»ºè‡ªå®šä¹‰æ¨¡å—ï¼Œåœ¨å¼€å§‹æ„å»ºå†…æ ¸ä¹‹å‰ï¼Œè¯·ç¼–è¾‘ [.filename]#/etc/make.conf# æ–‡ä»¶ã€‚ÙwFor example, this variable specifies the list of modules to build instead of using the default of building all modules:Ùfä¾‹å¦‚ï¼Œè¿™ä¸ªå˜é‡æŒ‡å®šäº†è¦æ„å»ºçš„æ¨¡å—åˆ—è¡¨ï¼Œè€Œä¸æ˜¯ä½¿ç”¨é»˜è®¤çš„æ„å»ºæ‰€æœ‰æ¨¡å—ã€‚ÙQAlternately, this variable lists which modules to exclude from the build process:ÙEå¦å¤–ï¼Œè¿™ä¸ªå˜é‡åˆ—å‡ºäº†åœ¨æ„å»ºè¿‡ç¨‹ä¸­è¦æ’é™¤çš„æ¨¡å—ã€‚ÙKAdditional variables are available.  Refer to man:make.conf[5] for details.ÙQè¿˜æœ‰å…¶ä»–å¯ç”¨çš„å˜é‡ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… man:make.conf[5] ã€‚·If Something Goes Wrong²å¦‚æœå‡ºç°é—®é¢˜ÙRThere are four categories of trouble that can occur when building a custom kernel:Ù?æ„å»ºè‡ªå®šä¹‰å†…æ ¸æ—¶å¯èƒ½å‡ºç°çš„å››ç§æ•…éšœç±»åˆ«æœ‰ï¼š®`config` fails¯`config` å¤±è´¥Ù×If `config` fails, it will print the line number that is incorrect.  As an example, for the following message, make sure that line 17 is typed correctly by comparing it to [.filename]#GENERIC# or [.filename]#NOTES#:ÙÈå¦‚æœ `config` å¤±è´¥ï¼Œå®ƒå°†æ‰“å°å‡ºé”™è¯¯çš„è¡Œå·ã€‚ä¾‹å¦‚ï¼Œå¯¹äºä»¥ä¸‹æ¶ˆæ¯ï¼Œè¯·é€šè¿‡å°†å…¶ä¸ [.filename]#GENERIC# æˆ– [.filename]#NOTES# è¿›è¡Œæ¯”è¾ƒï¼Œç¡®ä¿ç¬¬ 17 è¡Œçš„è¾“å…¥æ­£ç¡®ã€‚¬`make` fails­`make` å¤±è´¥ÚIf `make` fails, it is usually due to an error in the kernel configuration file which is not severe enough for `config` to catch.  Review the configuration, and if the problem is not apparent, send an email to the {freebsd-questions} which contains the kernel configuration file.Ùõå¦‚æœ `make` å¤±è´¥ï¼Œé€šå¸¸æ˜¯ç”±äºå†…æ ¸é…ç½®æ–‡ä»¶ä¸­çš„é”™è¯¯ï¼Œè¿™ç§é”™è¯¯ä¸ä¸¥é‡åˆ°è¶³ä»¥è¢« `config` æ•è·ã€‚è¯·æ£€æŸ¥é…ç½®ï¼Œå¦‚æœé—®é¢˜ä¸æ˜æ˜¾ï¼Œè¯·å‘é€ä¸€å°åŒ…å«å†…æ ¸é…ç½®æ–‡ä»¶çš„ç”µå­é‚®ä»¶åˆ° {freebsd-questions}ã€‚¸The kernel does not boot²å†…æ ¸æ— æ³•å¯åŠ¨ÚÀIf the new kernel does not boot or fails to recognize devices, do not panic! Fortunately, FreeBSD has an excellent mechanism for recovering from incompatible kernels.  Simply choose the kernel to boot from at the FreeBSD boot loader.  This can be accessed when the system boot menu appears by selecting the "Escape to a loader prompt" option.  At the prompt, type `boot _kernel.old_`, or the name of any other kernel that is known to boot properly.ÚÙå¦‚æœæ–°å†…æ ¸æ— æ³•å¯åŠ¨æˆ–æ— æ³•è¯†åˆ«è®¾å¤‡ï¼Œè¯·ä¸è¦æƒŠæ…Œï¼å¹¸è¿çš„æ˜¯ï¼ŒFreeBSD æœ‰ä¸€ä¸ªå‡ºè‰²çš„æœºåˆ¶å¯ä»¥ä»ä¸å…¼å®¹çš„å†…æ ¸ä¸­æ¢å¤ã€‚åªéœ€åœ¨ FreeBSD å¼•å¯¼åŠ è½½ç¨‹åºä¸­é€‰æ‹©è¦å¼•å¯¼çš„å†…æ ¸å³å¯ã€‚å½“ç³»ç»Ÿå¯åŠ¨èœå•å‡ºç°æ—¶ï¼Œå¯ä»¥é€šè¿‡é€‰æ‹©â€œè¿›å…¥åŠ è½½ç¨‹åºæç¤ºç¬¦ï¼ˆEscape to a loader promptï¼‰â€é€‰é¡¹æ¥è®¿é—®å®ƒã€‚åœ¨æç¤ºç¬¦ä¸‹ï¼Œè¾“å…¥ `boot _kernel.old_`ï¼Œæˆ–è€…ä»»ä½•å…¶ä»–å·²çŸ¥å¯ä»¥æ­£ç¡®å¼•å¯¼çš„å†…æ ¸çš„åç§°ã€‚ÚAfter booting with a good kernel, check over the configuration file and try to build it again.  One helpful resource is [.filename]#/var/log/messages# which records the kernel messages from every successful boot.  Also, man:dmesg[8] will print the kernel messages from the current boot.Úåœ¨ä½¿ç”¨è‰¯å¥½çš„å†…æ ¸å¯åŠ¨åï¼Œæ£€æŸ¥é…ç½®æ–‡ä»¶å¹¶å°è¯•é‡æ–°æ„å»ºã€‚ä¸€ä¸ªæœ‰ç”¨çš„èµ„æºæ˜¯ [.filename]#/var/log/messages# æ–‡ä»¶ï¼Œå®ƒè®°å½•äº†æ¯æ¬¡æˆåŠŸå¯åŠ¨æ—¶çš„å†…æ ¸æ¶ˆæ¯ã€‚æ­¤å¤–ï¼Œman:dmesg[8] å‘½ä»¤å°†æ‰“å°å½“å‰å¯åŠ¨çš„å†…æ ¸æ¶ˆæ¯ã€‚Ú…When troubleshooting a kernel make sure to keep a copy of a kernel that is known to work, such as [.filename]#GENERIC#.  This is important because every time a new kernel is installed, [.filename]#kernel.old# is overwritten with the last installed kernel, which may or may not be bootable.  As soon as possible, move the working kernel by renaming the directory containing the good kernel:ÚZåœ¨æ’é™¤å†…æ ¸é—®é¢˜æ—¶ï¼Œè¯·ç¡®ä¿ä¿ç•™ä¸€ä¸ªå·²çŸ¥å¯æ­£å¸¸å·¥ä½œçš„å†…æ ¸å‰¯æœ¬ï¼Œä¾‹å¦‚ [.filename]#GENERIC#ã€‚è¿™å¾ˆé‡è¦ï¼Œå› ä¸ºæ¯æ¬¡å®‰è£…æ–°å†…æ ¸æ—¶ï¼Œ [.filename]#kernel.old# éƒ½ä¼šè¢«ä¸Šä¸€ä¸ªå®‰è£…çš„å†…æ ¸è¦†ç›–ï¼Œè¯¥å†…æ ¸å¯èƒ½æ— æ³•å¯åŠ¨ã€‚å°½å¿«å°†å·¥ä½œæ­£å¸¸çš„å†…æ ¸ç§»åŠ¨ï¼Œé€šè¿‡é‡å‘½ååŒ…å«è‰¯å¥½å†…æ ¸çš„ç›®å½•ã€‚Ù(The kernel works, but man:ps[1] does notÙ;å†…æ ¸å·¥ä½œæ­£å¸¸ï¼Œä½†æ˜¯ man:ps[1] å‘½ä»¤ä¸èµ·ä½œç”¨ã€‚ÚïIf the kernel version differs from the one that the system utilities have been built with, for example, a kernel built from -CURRENT sources is installed on a -RELEASE system, many system status commands like man:ps[1] and man:vmstat[8] will not work.  To fix this, crossref:cutting-edge[makeworld,recompile and install a world] built with the same version of the source tree as the kernel.  It is never a good idea to use a different version of the kernel than the rest of the operating system.ÚËå¦‚æœå†…æ ¸ç‰ˆæœ¬ä¸ç³»ç»Ÿå®ç”¨ç¨‹åºæ„å»ºçš„ç‰ˆæœ¬ä¸åŒï¼Œä¾‹å¦‚ï¼Œåœ¨ -RELEASE ç³»ç»Ÿä¸Šå®‰è£…äº†ä» -CURRENT æºæ„å»ºçš„å†…æ ¸ï¼Œé‚£ä¹ˆè®¸å¤šç³»ç»ŸçŠ¶æ€å‘½ä»¤ï¼ˆå¦‚ man:ps[1] å’Œ man:vmstat[8]ï¼‰å°†æ— æ³•å·¥ä½œã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œåº”è¯¥ä½¿ç”¨ä¸å†…æ ¸ç›¸åŒç‰ˆæœ¬çš„æºä»£ç æ ‘crossref:cutting-edge[makeworld,é‡æ–°ç¼–è¯‘å’Œå®‰è£…æ•´ä¸ªç³»ç»Ÿ]ã€‚åœ¨æ“ä½œç³»ç»Ÿä¸­ä½¿ç”¨ä¸å…¶ä½™éƒ¨åˆ†ä¸åŒç‰ˆæœ¬çš„å†…æ ¸ä»æ¥éƒ½ä¸æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ã€‚Ù¥FreeBSD provides binary compatibility with Linux, allowing users to install and run most Linux binaries on a FreeBSD system without having to first modify the binaryÙ¦FreeBSD æä¾›ä¸ Linux çš„äºŒè¿›åˆ¶å…¼å®¹æ€§ï¼Œå…è®¸ç”¨æˆ·åœ¨ FreeBSD ç³»ç»Ÿä¸Šå®‰è£…å’Œè¿è¡Œå¤§å¤šæ•° Linux äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè€Œæ— éœ€å…ˆä¿®æ”¹äºŒè¿›åˆ¶æ–‡ä»¶ã€‚Ù&Chapter 12. Linux Binary CompatibilityÙ#ç¬¬ 12 ç«  Linux äºŒè¿›åˆ¶å…¼å®¹æ€§ºLinux Binary Compatibility¸Linux äºŒè¿›åˆ¶å…¼å®¹æ€§Ú°FreeBSD provides *optional* binary compatibility with Linux(R), commonly referred to as Linuxulator, allowing users to install and run unmodified Linux binaries.  It is available for the x86 (both 32 and 64 bit) and AArch64 architectures.  Some Linux-specific operating system features are not yet supported; this mostly happens with functionality specific to hardware or related to system management, such as cgroups or namespaces.ÚiFreeBSD æä¾›ä¸ Linux(R) çš„äºŒè¿›åˆ¶å…¼å®¹æ€§ï¼Œé€šå¸¸ç§°ä¸º Linuxulatorï¼Œå…è®¸ç”¨æˆ·å®‰è£…å’Œè¿è¡Œæœªç»ä¿®æ”¹çš„ Linux äºŒè¿›åˆ¶æ–‡ä»¶ã€‚å®ƒé€‚ç”¨äº x86ï¼ˆ32 ä½å’Œ 64 ä½ï¼‰å’Œ AArch64 æ¶æ„ã€‚ç›®å‰è¿˜ä¸æ”¯æŒä¸€äº›ç‰¹å®šäº Linux çš„æ“ä½œç³»ç»ŸåŠŸèƒ½ï¼Œä¸»è¦æ˜¯ä¸ç¡¬ä»¶ç›¸å…³æˆ–ä¸ç³»ç»Ÿç®¡ç†ç›¸å…³çš„åŠŸèƒ½ï¼Œä¾‹å¦‚ cgroups æˆ–å‘½åç©ºé—´ã€‚ÙJKnow how to install crossref:ports[ports,additional third-party software].ÙAäº†è§£å¦‚ä½•å®‰è£… crossref:ports[ports,å…¶ä»–ç¬¬ä¸‰æ–¹è½¯ä»¶]ã€‚Ù=How to enable Linux binary compatibility on a FreeBSD system.Ù=å¦‚ä½•åœ¨ FreeBSD ç³»ç»Ÿä¸Šå¯ç”¨ Linux äºŒè¿›åˆ¶å…¼å®¹æ€§ã€‚Ù1How to install additional Linux shared libraries.Ù(å¦‚ä½•å®‰è£…é¢å¤–çš„ Linux å…±äº«åº“ã€‚Ù6How to install Linux applications on a FreeBSD system.Ù7å¦‚ä½•åœ¨ FreeBSD ç³»ç»Ÿä¸Šå®‰è£… Linux åº”ç”¨ç¨‹åºã€‚Ù=The implementation details of Linux compatibility in FreeBSD.Ù-FreeBSD ä¸­ Linux å…¼å®¹æ€§çš„å®ç°ç»†èŠ‚ã€‚Ù&Configuring Linux Binary Compatibility¿é…ç½® Linux äºŒè¿›åˆ¶å…¼å®¹æ€§Ù=By default, man:linux[4] binary compatibility is not enabled.Ù>é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸å¯ç”¨ man:linux[4] äºŒè¿›åˆ¶å…¼å®¹æ€§ã€‚ÙROnce enabled, it can be started without rebooting executing the following command:ÙNä¸€æ—¦å¯ç”¨ï¼Œå¯ä»¥é€šè¿‡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ¥å¯åŠ¨ï¼Œæ— éœ€é‡æ–°å¯åŠ¨ï¼šÙ<This is enough for statically linked Linux binaries to work.ÙFè¿™å¯¹äºé™æ€é“¾æ¥çš„ Linux äºŒè¿›åˆ¶æ–‡ä»¶æ¥è¯´å·²ç»è¶³å¤Ÿäº†ã€‚Ú,The Linux service will load necessary kernel modules and mount filesystems expected by Linux applications under [.filename]#/compat/linux#.  They can be started in the same way native FreeBSD binaries can; they behave almost exactly like native processes and can be traced and debugged the usual way.Ú=Linux æœåŠ¡å°†åŠ è½½ Linux åº”ç”¨ç¨‹åºæ‰€éœ€çš„å†…æ ¸æ¨¡å—å¹¶æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿï¼Œè¿™äº›æ–‡ä»¶ç³»ç»Ÿä½äº [.filename]#/compat/linux# ç›®å½•ä¸‹ã€‚å®ƒä»¬å¯ä»¥åƒæœ¬æœº FreeBSD äºŒè¿›åˆ¶æ–‡ä»¶ä¸€æ ·å¯åŠ¨ï¼›å®ƒä»¬çš„è¡Œä¸ºå‡ ä¹ä¸æœ¬æœºè¿›ç¨‹å®Œå…¨ç›¸åŒï¼Œå¹¶ä¸”å¯ä»¥æŒ‰ç…§é€šå¸¸çš„æ–¹å¼è¿›è¡Œè·Ÿè¸ªå’Œè°ƒè¯•ã€‚ÙaThe current content of [.filename]#/compat/linux# can be checked executing the following command:ÙUå¯ä»¥é€šè¿‡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ¥æ£€æŸ¥ [.filename]#/compat/linux# çš„å½“å‰å†…å®¹ï¼š¯Linux userlands²Linux ç”¨æˆ·ç©ºé—´Ù€Linux software requires more than just an ABI to work.  In order to run Linux software a Linux userland must be installed first.ÙLinux è½¯ä»¶éœ€è¦çš„ä¸ä»…ä»…æ˜¯ä¸€ä¸ª ABI æ‰èƒ½è¿è¡Œã€‚ä¸ºäº†è¿è¡Œ Linux è½¯ä»¶ï¼Œé¦–å…ˆå¿…é¡»å®‰è£… Linux ç”¨æˆ·ç©ºé—´ã€‚Ù¾If all that is wanted is to run some software already included in the Ports tree, it can be installed via package manager and man:pkg[8] will automatically setup the required Linux userland.Ù­å¦‚æœåªæ˜¯æƒ³è¿è¡Œå·²åŒ…å«åœ¨ Ports æ ‘ä¸­çš„ä¸€äº›è½¯ä»¶ï¼Œå¯ä»¥é€šè¿‡è½¯ä»¶åŒ…ç®¡ç†å™¨è¿›è¡Œå®‰è£…ï¼Œå¹¶ä¸” man:pkg[8] å°†è‡ªåŠ¨è®¾ç½®æ‰€éœ€çš„ Linux ç”¨æˆ·ç©ºé—´ã€‚ÙkFor example, to install Sublime Text 4, along with all the Linux libraries it depends on, run this command:Ùbä¾‹å¦‚ï¼Œè¦å®‰è£… Sublime Text 4 ä»¥åŠå®ƒæ‰€ä¾èµ–çš„æ‰€æœ‰ Linux åº“ï¼Œè¯·è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼šÙ(CentOS Base System from FreeBSD PackagesÙ5ä» FreeBSD è½¯ä»¶åŒ…ä¸­è·å–çš„ CentOS åŸºæœ¬ç³»ç»ŸÙ=To install the CentOS userland execute the following command:Ù8è¦å®‰è£… CentOS ç”¨æˆ·ç©ºé—´ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼šÙspackage:emulators/linux_base-c7[] will place the base system derived from CentOS 7 into [.filename]#/compat/linux#.Ùopackage:emulators/linux_base-c7[] å°†åŸºäº CentOS 7 çš„åŸºæœ¬ç³»ç»Ÿæ”¾ç½®åœ¨ [.filename]#/compat/linux# ä¸­ã€‚Ù¯After installing the package, the contents of [.filename]#/compat/linux# can be verified by running the following command to check that the CentOS userland has been installed:Ù–å®‰è£…å®Œè½¯ä»¶åŒ…åï¼Œå¯ä»¥é€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥éªŒè¯ [.filename]#/compat/linux# çš„å†…å®¹ï¼Œä»¥æ£€æŸ¥æ˜¯å¦å·²å®‰è£… CentOS ç”¨æˆ·ç©ºé—´ï¼šÙ,Debian / Ubuntu Base System with debootstrapÙ4ä½¿ç”¨ debootstrap åˆ›å»º Debian/Ubuntu åŸºç¡€ç³»ç»ŸÙ­An alternative way of providing Linux shared libraries is by using package:sysutils/debootstrap[].  This has the advantage of providing a full Debian or Ubuntu distribution.Ùœæä¾› Linux å…±äº«åº“çš„å¦ä¸€ç§æ–¹å¼æ˜¯ä½¿ç”¨ package:sysutils/debootstrap[]ã€‚è¿™æ ·åšçš„ä¼˜ç‚¹æ˜¯å¯ä»¥æä¾›å®Œæ•´çš„ Debian æˆ– Ubuntu å‘è¡Œç‰ˆã€‚Ù5To install debootstrap execute the following command:Ù0è¦å®‰è£… debootstrapï¼Œè¯·æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼šÙ›man:debootstrap[8] needs man:linux[4] ABI enabled.  Once enabled, execute the following command to install Ubuntu or Debian in [.filename]#/compat/ubuntu#:Ùman:debootstrap[8] éœ€è¦å¯ç”¨ man:linux[4] ABIã€‚å¯ç”¨åï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤åœ¨ [.filename]#/compat/ubuntu# ä¸­å®‰è£… Ubuntu æˆ– Debian ï¼šÚWhile it is technically possible to install into [.filename]#/compat/linux# instead, it's discouraged due to possible clashes with CentOS-based packages.  Instead, derive the directory name from the distribution or version name, e.g., [.filename]#/compat/ubuntu#.Ú è™½ç„¶ä»æŠ€æœ¯ä¸Šè®²å¯ä»¥å®‰è£…åˆ° [.filename]#/compat/linux# ç›®å½•ä¸­ï¼Œä½†ç”±äºå¯èƒ½ä¸åŸºäº CentOS çš„è½¯ä»¶åŒ…å‘ç”Ÿå†²çªï¼Œä¸å»ºè®®è¿™æ ·åšã€‚ç›¸åï¼Œåº”æ ¹æ®å‘è¡Œç‰ˆæˆ–ç‰ˆæœ¬åç§°æ´¾ç”Ÿç›®å½•åç§°ï¼Œä¾‹å¦‚ [.filename]#/compat/ubuntu#ã€‚Ù.Then set up mounts in [.filename]#/etc/fstab#.Ù7ç„¶ååœ¨ [.filename]#/etc/fstab# ä¸­è®¾ç½®æŒ‚è½½ç‚¹ã€‚ÙÔIf the contents of the home directory should be shared and to be able to run X11 applications, [.filename]#/home# and [.filename]#/tmp# should be mounted in the linux compat area using man:nullfs[5] for loopback.ÙÃå¦‚æœè¦å…±äº«ä¸»ç›®å½•çš„å†…å®¹å¹¶ä¸”èƒ½å¤Ÿè¿è¡Œ X11 åº”ç”¨ç¨‹åºï¼Œåº”è¯¥ä½¿ç”¨ man:nullfs[5] å°† [.filename]#/home# å’Œ [.filename]#/tmp# æŒ‚è½½åˆ° Linux å…¼å®¹åŒºåŸŸä¸­ï¼Œä»¥å®ç°å›ç¯ã€‚Ù>The following example can be added to [.filename]#/etc/fstab#:Ù@ä»¥ä¸‹ç¤ºä¾‹å¯ä»¥æ·»åŠ åˆ° [.filename]#/etc/fstab# æ–‡ä»¶ä¸­ï¼šºThen execute man:mount[8]:¼ç„¶åæ‰§è¡Œ man:mount[8]ï¼šÙGTo access the system using man:chroot[8] execute the following command:Ù?è¦ä½¿ç”¨ man:chroot[8] è®¿é—®ç³»ç»Ÿï¼Œè¯·æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼šÙAThen man:uname[1] can be executed to check the Linux environment:Ù?ç„¶åå¯ä»¥æ‰§è¡Œ man:uname[1] å‘½ä»¤æ¥æ£€æŸ¥ Linux ç¯å¢ƒï¼šÙ”Once inside the chroot, the system behaves as in a normal Ubuntu installation While systemd doesn't work, the man:service[8] command works as usual.Ù­ä¸€æ—¦è¿›å…¥ chroot ç¯å¢ƒï¼Œç³»ç»Ÿçš„è¡Œä¸ºå°±åƒåœ¨æ­£å¸¸çš„ Ubuntu å®‰è£…ä¸­ä¸€æ ·ã€‚è™½ç„¶ systemd ä¸èµ·ä½œç”¨ï¼Œä½† man:service[8] å‘½ä»¤ä»ç„¶åƒå¾€å¸¸ä¸€æ ·å·¥ä½œã€‚ÙuTo add the package repositories missing from defaults edit the file [.filename]#/compat/ubuntu/etc/apt/sources.list#.Ùnè¦æ·»åŠ é»˜è®¤ç¼ºå¤±çš„è½¯ä»¶åŒ…ä»“åº“ï¼Œè¯·ç¼–è¾‘æ–‡ä»¶ [.filename]#/compat/ubuntu/etc/apt/sources.list# ã€‚Ù,For amd64 the following example can be used:Ù1å¯¹äº amd64 æ¶æ„ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹ç¤ºä¾‹ï¼šÙ)For arm64 this other example can be used:Ù1å¯¹äº arm64 æ¶æ„ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹ç¤ºä¾‹ï¼šÙMA list of all Linux-related man:sysctl[8] knobs can be found in man:linux[4].ÙWæ‰€æœ‰ä¸ Linux ç›¸å…³çš„ man:sysctl[8] å‚æ•°åˆ—è¡¨å¯ä»¥åœ¨ man:linux[4] ä¸­æ‰¾åˆ°ã€‚Ù=Some applications require specific filesystems to be mounted.Ù6æœ‰äº›åº”ç”¨ç¨‹åºéœ€è¦æŒ‚è½½ç‰¹å®šçš„æ–‡ä»¶ç³»ç»Ÿã€‚Ù€This is normally handled by the [.filename]#/etc/rc.d/linux# script but can be disabled at boot executing the following command:Ùoè¿™é€šå¸¸ç”± [.filename]#/etc/rc.d/linux# è„šæœ¬å¤„ç†ï¼Œä½†å¯ä»¥é€šè¿‡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤åœ¨å¯åŠ¨æ—¶ç¦ç”¨ï¼šÙ•Filesystems mounted by the rc script will not work for Linux processes inside chroots or jails; if needed, configure them in [.filename]#/etc/fstab#:Ù é€šè¿‡ rc è„šæœ¬æŒ‚è½½çš„æ–‡ä»¶ç³»ç»Ÿåœ¨ chroots æˆ– jails ä¸­çš„ Linux è¿›ç¨‹ä¸­å°†æ— æ³•å·¥ä½œï¼›å¦‚æœéœ€è¦ï¼Œåœ¨ [.filename]#/etc/fstab# ä¸­è¿›è¡Œé…ç½®ï¼šÙËSince the Linux binary compatibility layer has gained support for running both 32- and 64-bit Linux binaries, it is no longer possible to link the emulation functionality statically into a custom kernel.Ù ç”±äº Linux äºŒè¿›åˆ¶å…¼å®¹å±‚å·²ç»æ”¯æŒè¿è¡Œ 32 ä½å’Œ 64 ä½ Linux äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå› æ­¤ä¸å†å¯èƒ½å°†ä»¿çœŸåŠŸèƒ½é™æ€é“¾æ¥åˆ°è‡ªå®šä¹‰å†…æ ¸ä¸­ã€‚Ù(Installing Additional Libraries Manually¸æ‰‹åŠ¨å®‰è£…é¢å¤–çš„åº“ÙcFor base system subdirectories created with man:debootstrap[8], use the instructions above instead.ÙYå¯¹äºä½¿ç”¨ man:debootstrap[8] åˆ›å»ºçš„åŸºæœ¬ç³»ç»Ÿå­ç›®å½•ï¼Œè¯·ä½¿ç”¨ä¸Šè¿°è¯´æ˜ã€‚ÙÀIf a Linux application complains about missing shared libraries after configuring Linux binary compatibility, determine which shared libraries the Linux binary needs and install them manually.Ù·å¦‚æœåœ¨é…ç½® Linux äºŒè¿›åˆ¶å…¼å®¹æ€§åï¼Œä¸€ä¸ª Linux åº”ç”¨ç¨‹åºæŠ±æ€¨ç¼ºå°‘å…±äº«åº“ï¼Œé‚£ä¹ˆéœ€è¦ç¡®å®š Linux äºŒè¿›åˆ¶æ–‡ä»¶éœ€è¦å“ªäº›å…±äº«åº“ï¼Œå¹¶æ‰‹åŠ¨å®‰è£…å®ƒä»¬ã€‚ÙFrom a Linux system using the same CPU architecture, `ldd` can be used to determine which shared libraries the application needs.Ùyåœ¨ä½¿ç”¨ç›¸åŒçš„ CPU æ¶æ„çš„ Linux ç³»ç»Ÿä¸Šï¼Œå¯ä»¥ä½¿ç”¨ `ldd` å‘½ä»¤æ¥ç¡®å®šåº”ç”¨ç¨‹åºéœ€è¦å“ªäº›å…±äº«åº“ã€‚Ù}For example, to check which shared libraries `linuxdoom` needs, run this command from a Linux system that has Doom installed:Ùtä¾‹å¦‚ï¼Œè¦æ£€æŸ¥ `linuxdoom` éœ€è¦å“ªäº›å…±äº«åº“ï¼Œè¯·ä»å·²å®‰è£… Doom çš„ Linux ç³»ç»Ÿä¸Šè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼šÙÌThen, copy all the files in the last column of the output from the Linux system into [.filename]#/compat/linux# on the FreeBSD system.  Once copied, create symbolic links to the names in the first column.ÙËç„¶åï¼Œå°† Linux ç³»ç»Ÿè¾“å‡ºçš„æœ€åä¸€åˆ—ä¸­çš„æ‰€æœ‰æ–‡ä»¶å¤åˆ¶åˆ° FreeBSD ç³»ç»Ÿçš„ [.filename]#/compat/linux# ç›®å½•ä¸­ã€‚å¤åˆ¶å®Œæˆåï¼Œåˆ›å»ºæŒ‡å‘ç¬¬ä¸€åˆ—ä¸­çš„æ–‡ä»¶åçš„ç¬¦å·é“¾æ¥ã€‚ÙFThis example will result in the following files on the FreeBSD system:Ù9è¿™ä¸ªä¾‹å­å°†åœ¨ FreeBSD ç³»ç»Ÿä¸Šç”Ÿæˆä»¥ä¸‹æ–‡ä»¶ï¼šÚIf a Linux shared library already exists with a matching major revision number to the first column of the `ldd` output, it does not need to be copied to the file named in the last column, as the existing library should work.  It is advisable to copy the shared library if it is a newer version, though.  The old one can be removed, as long as the symbolic link points to the new one.ÚIå¦‚æœåœ¨ `ldd` è¾“å‡ºçš„ç¬¬ä¸€åˆ—ä¸­å­˜åœ¨ä¸€ä¸ªä¸ Linux å…±äº«åº“çš„ä¸»è¦ä¿®è®¢å·åŒ¹é…çš„åº“ï¼Œåˆ™æ— éœ€å°†å…¶å¤åˆ¶åˆ°æœ€åä¸€åˆ—ä¸­æŒ‡å®šçš„æ–‡ä»¶ä¸­ï¼Œå› ä¸ºç°æœ‰åº“åº”è¯¥å¯ä»¥æ­£å¸¸å·¥ä½œã€‚ä½†æ˜¯ï¼Œå¦‚æœå…±äº«åº“æ˜¯è¾ƒæ–°ç‰ˆæœ¬ï¼Œåˆ™å»ºè®®å¤åˆ¶å®ƒã€‚åªè¦ç¬¦å·é“¾æ¥æŒ‡å‘æ–°çš„åº“ï¼Œå°±å¯ä»¥åˆ é™¤æ—§çš„åº“ã€‚ÙAFor example, these libraries already exist on the FreeBSD system:Ù6ä¾‹å¦‚ï¼Œè¿™äº›åº“å·²ç»å­˜åœ¨äº FreeBSD ç³»ç»Ÿä¸Šï¼šÙ;and `ldd` indicates that a binary requires a later version:ÙCè€Œ `ldd` æŒ‡ç¤ºä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶éœ€è¦ä¸€ä¸ªè¾ƒæ–°çš„ç‰ˆæœ¬ï¼šÙîSince the existing library is only one or two versions out of date in the last digit, the program should still work with the slightly older version.  However, it is safe to replace the existing [.filename]#libc.so# with the newer version:Ùßç”±äºç°æœ‰çš„åº“åªæ˜¯åœ¨æœ€åä¸€ä½æ•°å­—ä¸Šè¿‡æ—¶äº†ä¸€åˆ°ä¸¤ä¸ªç‰ˆæœ¬ï¼Œæ‰€ä»¥ç¨‹åºåº”è¯¥ä»ç„¶å¯ä»¥ä¸ç¨æ—§çš„ç‰ˆæœ¬ä¸€èµ·å·¥ä½œã€‚ç„¶è€Œï¼Œå°†ç°æœ‰çš„ [.filename]#libc.so# æ›¿æ¢ä¸ºæ›´æ–°çš„ç‰ˆæœ¬æ˜¯å®‰å…¨çš„ã€‚Ú>Generally, one will need to look for the shared libraries that Linux binaries depend on only the first few times that a Linux program is installed on FreeBSD.  After a while, there will be a sufficient set of Linux shared libraries on the system to be able to run newly installed Linux binaries without any extra work.Úé€šå¸¸æƒ…å†µä¸‹ï¼Œåœ¨ FreeBSD ä¸Šé¦–æ¬¡å®‰è£… Linux ç¨‹åºæ—¶ï¼Œéœ€è¦æŸ¥æ‰¾ Linux äºŒè¿›åˆ¶æ–‡ä»¶æ‰€ä¾èµ–çš„å…±äº«åº“ã€‚ç„¶è€Œï¼Œéšç€æ—¶é—´çš„æ¨ç§»ï¼Œç³»ç»Ÿä¸Šä¼šç§¯ç´¯è¶³å¤Ÿçš„ Linux å…±äº«åº“ï¼Œå¯ä»¥åœ¨å®‰è£…æ–°çš„ Linux äºŒè¿›åˆ¶æ–‡ä»¶æ—¶æ— éœ€é¢å¤–æ“ä½œå³å¯è¿è¡Œã€‚»Branding Linux ELF BinariesÙ æ ‡è®° Linux ELF å¯æ‰§è¡Œæ–‡ä»¶ÚThe FreeBSD kernel uses several methods to determine if the binary to be executed is a Linux one: it checks the brand in the ELF file header, looks for known ELF interpreter paths and checks ELF notes; finally, by default, unbranded ELF executables are assumed to be Linux anyway.ÚFreeBSD å†…æ ¸ä½¿ç”¨å¤šç§æ–¹æ³•æ¥ç¡®å®šè¦æ‰§è¡Œçš„äºŒè¿›åˆ¶æ–‡ä»¶æ˜¯å¦ä¸º Linux æ–‡ä»¶ï¼šå®ƒæ£€æŸ¥ ELF æ–‡ä»¶å¤´ä¸­çš„æ ‡è®°ï¼ŒæŸ¥æ‰¾å·²çŸ¥çš„ ELF è§£é‡Šå™¨è·¯å¾„å¹¶æ£€æŸ¥ ELF æ³¨é‡Šï¼›æœ€åï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæœªæ ‡è®°çš„ ELF å¯æ‰§è¡Œæ–‡ä»¶è¢«è®¤ä¸ºæ˜¯ Linux æ–‡ä»¶ã€‚Ù^Should all those methods fail, an attempt to execute the binary might result in error message:Ù`å¦‚æœæ‰€æœ‰è¿™äº›æ–¹æ³•éƒ½å¤±è´¥äº†ï¼Œå°è¯•æ‰§è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶å¯èƒ½ä¼šå¯¼è‡´é”™è¯¯æ¶ˆæ¯ï¼šÙlTo help the FreeBSD kernel distinguish between a FreeBSD ELF binary and a Linux binary, use man:brandelf[1]:Ù|ä¸ºäº†å¸®åŠ© FreeBSD å†…æ ¸åŒºåˆ† FreeBSD ELF äºŒè¿›åˆ¶æ–‡ä»¶å’Œ Linux äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè¯·ä½¿ç”¨ man:brandelf[1] å‘½ä»¤ã€‚Ù(Installing a Linux RPM Based ApplicationÙ&å®‰è£…åŸºäº Linux RPM çš„åº”ç”¨ç¨‹åºÙ²To install a Linux RPM-based application, first install the package:archivers/rpm4[] package or port.  Once installed, `root` can use this command to install a [.filename]#.rpm#:ÙÁè¦å®‰è£…ä¸€ä¸ªåŸºäº Linux RPM çš„åº”ç”¨ç¨‹åºï¼Œé¦–å…ˆå®‰è£… package:archivers/rpm4[] åŒ…æˆ–portã€‚å®‰è£…å®Œæˆåï¼Œ`root` ç”¨æˆ·å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥å®‰è£… [.filename]#.rpm# æ–‡ä»¶ï¼šÙdIf necessary, `brandelf` the installed ELF binaries.  Note that this will prevent a clean uninstall.Ùzå¦‚æœéœ€è¦çš„è¯ï¼Œå¯¹å·²å®‰è£…çš„ ELF äºŒè¿›åˆ¶æ–‡ä»¶è¿›è¡Œ `brandelf` å¤„ç†ã€‚è¯·æ³¨æ„ï¼Œè¿™å°†é˜»æ­¢å¹²å‡€å¸è½½ã€‚Ù!Configuring the Hostname Resolver¸é…ç½®ä¸»æœºåè§£æå™¨Ù+If DNS does not work or this error appears:Ù)å¦‚æœ DNS ä¸å·¥ä½œæˆ–å‡ºç°æ­¤é”™è¯¯ï¼šÙ>configure [.filename]#/compat/linux/etc/host.conf# as follows:Ù<å°† [.filename]#/compat/linux/etc/host.conf# é…ç½®å¦‚ä¸‹ï¼šÚrThis specifies that [.filename]#/etc/hosts# is searched first and DNS is searched second.  When [.filename]#/compat/linux/etc/host.conf# does not exist, Linux applications use [.filename]#/etc/host.conf# in the host system but they complain since that file does not exist in FreeBSD.  Remove `bind` if a name server is not configured using [.filename]#/etc/resolv.conf#.Úfè¿™æŒ‡å®šäº†é¦–å…ˆæœç´¢ [.filename]#/etc/hosts# ï¼Œå…¶æ¬¡æœç´¢ DNSã€‚å½“ [.filename]#/compat/linux/etc/host.conf# ä¸å­˜åœ¨æ—¶ï¼ŒLinux åº”ç”¨ç¨‹åºä½¿ç”¨ä¸»æœºç³»ç»Ÿä¸­çš„ [.filename]#/etc/host.conf#ï¼Œä½†å®ƒä»¬ä¼šæŠ±æ€¨å› ä¸ºåœ¨ FreeBSD ä¸­è¯¥æ–‡ä»¶ä¸å­˜åœ¨ã€‚å¦‚æœæ²¡æœ‰é…ç½®åç§°æœåŠ¡å™¨ï¼Œè¯·åˆ é™¤ `bind`ï¼Œä½¿ç”¨ [.filename]#/etc/resolv.conf#ã€‚­Miscellaneous¦æ‚é¡¹ÙMore information on how binary compatibility works with Linux(R) can be found in the article link:{linux-emulation}[Linux emulation in FreeBSD].Ù}æœ‰å…³ Linux(R) ä¸äºŒè¿›åˆ¶å…¼å®¹æ€§çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…æ–‡ç«  link:{linux-emulation}[FreeBSD ä¸­çš„ Linux æ¨¡æ‹Ÿ]ã€‚ÙÔAn introduction to the FreeBSD Booting Process, demonstrates how to customize the FreeBSD boot process, including everything that happens until the FreeBSD kernel has started, probed for devices, and started initÙ­FreeBSD å¼•å¯¼è¿‡ç¨‹ç®€ä»‹ï¼Œä»‹ç»äº†å¦‚ä½•è‡ªå®šä¹‰ FreeBSD å¼•å¯¼è¿‡ç¨‹ï¼ŒåŒ…æ‹¬ä»å¼•å¯¼å¼€å§‹ç›´åˆ° FreeBSD å†…æ ¸å¯åŠ¨ã€è®¾å¤‡æ¢æµ‹å’Œ init å¯åŠ¨çš„æ‰€æœ‰è¿‡ç¨‹ã€‚Ù'Chapter 15. The FreeBSD Booting ProcessÙ"ç¬¬ 15 ç«  FreeBSD çš„å¼•å¯¼è¿‡ç¨‹»The FreeBSD Booting Process·FreeBSD çš„å¼•å¯¼è¿‡ç¨‹Ú The process of starting a computer and loading the operating system is referred to as "the bootstrap process", or "booting".  FreeBSD's boot process provides a great deal of flexibility in customizing what happens when the system starts, including the ability to select from different operating systems installed on the same computer, different versions of the same operating system, or a different installed kernel.Ú8å¯åŠ¨è®¡ç®—æœºå¹¶åŠ è½½æ“ä½œç³»ç»Ÿçš„è¿‡ç¨‹è¢«ç§°ä¸ºâ€œå¼•å¯¼è¿‡ç¨‹â€æˆ–â€œå¼•å¯¼â€ã€‚ FreeBSD çš„å¼•å¯¼è¿‡ç¨‹æä¾›äº†å¾ˆå¤§çš„çµæ´»æ€§ï¼Œå¯ä»¥è‡ªå®šä¹‰ç³»ç»Ÿå¯åŠ¨æ—¶å‘ç”Ÿçš„äº‹æƒ…ï¼ŒåŒ…æ‹¬é€‰æ‹©åœ¨åŒä¸€å°è®¡ç®—æœºä¸Šå®‰è£…çš„ä¸åŒæ“ä½œç³»ç»Ÿã€åŒä¸€æ“ä½œç³»ç»Ÿçš„ä¸åŒç‰ˆæœ¬æˆ–ä¸åŒçš„å†…æ ¸ã€‚ÚIThis chapter details the configuration options that can be set.  It demonstrates how to customize the FreeBSD boot process, including everything that happens until the FreeBSD kernel has started, probed for devices, and started man:init[8].  This occurs when the text color of the boot messages changes from bright white to grey.Úæœ¬ç« è¯¦ç»†ä»‹ç»äº†å¯ä»¥è®¾ç½®çš„é…ç½®é€‰é¡¹ã€‚å®ƒæ¼”ç¤ºäº†å¦‚ä½•è‡ªå®šä¹‰ FreeBSD çš„å¯åŠ¨è¿‡ç¨‹ï¼ŒåŒ…æ‹¬åœ¨ FreeBSD å†…æ ¸å¯åŠ¨ã€è®¾å¤‡æ¢æµ‹å’Œ man:init[8] å¯åŠ¨ä¹‹å‰å‘ç”Ÿçš„æ‰€æœ‰äº‹æƒ…ã€‚è¿™å‘ç”Ÿåœ¨å¯åŠ¨æ¶ˆæ¯çš„æ–‡æœ¬é¢œè‰²ä»äº®ç™½è‰²å˜ä¸ºç°è‰²æ—¶ã€‚Ù/After reading this chapter, you will recognize:Ù*é˜…è¯»å®Œæœ¬ç« åï¼Œæ‚¨å°†ä¼šè®¤è¯†åˆ°ï¼šÙEThe components of the FreeBSD bootstrap system and how they interact.Ù8FreeBSD å¼•å¯¼ç³»ç»Ÿçš„ç»„ä»¶åŠå…¶ç›¸äº’ä½œç”¨æ–¹å¼ã€‚ÙoThe options that can be passed to the components in the FreeBSD bootstrap in order to control the boot process.ÙQå¯ä»¥ä¼ é€’ç»™ FreeBSD å¼•å¯¼ç¨‹åºä¸­ç»„ä»¶çš„é€‰é¡¹ï¼Œä»¥æ§åˆ¶å¼•å¯¼è¿‡ç¨‹ã€‚Ù#The basics of setting device hints.Ù$è®¾ç½®è®¾å¤‡æç¤ºçš„åŸºç¡€çŸ¥è¯†ã€‚Ù\How to boot into single- and multi-user mode and how to properly shut down a FreeBSD system.ÙZå¦‚ä½•è¿›å…¥å•ç”¨æˆ·æ¨¡å¼å’Œå¤šç”¨æˆ·æ¨¡å¼ï¼Œä»¥åŠå¦‚ä½•æ­£ç¡®å…³é—­ FreeBSD ç³»ç»Ÿã€‚ÙZThis chapter only describes the boot process for FreeBSD running on x86 and amd64 systems.ÙNæœ¬ç« ä»…æè¿°åœ¨ x86 å’Œ amd64 ç³»ç»Ÿä¸Šè¿è¡Œçš„ FreeBSD çš„å¼•å¯¼è¿‡ç¨‹ã€‚´FreeBSD Boot Process´FreeBSD å¼•å¯¼è¿‡ç¨‹Ú”Turning on a computer and starting the operating system poses an interesting dilemma.  By definition, the computer does not know how to do anything until the operating system is started.  This includes running programs from the disk.  If the computer can not run a program from the disk without the operating system, and the operating system programs are on the disk, how is the operating system started?ÚVæ‰“å¼€è®¡ç®—æœºå¹¶å¯åŠ¨æ“ä½œç³»ç»Ÿä¼šå¸¦æ¥ä¸€ä¸ªæœ‰è¶£çš„å›°å¢ƒã€‚æ ¹æ®å®šä¹‰ï¼Œè®¡ç®—æœºåœ¨å¯åŠ¨æ“ä½œç³»ç»Ÿä¹‹å‰ä¸çŸ¥é“å¦‚ä½•æ‰§è¡Œä»»ä½•æ“ä½œï¼ŒåŒ…æ‹¬ä»ç£ç›˜è¿è¡Œç¨‹åºã€‚å¦‚æœè®¡ç®—æœºæ²¡æœ‰æ“ä½œç³»ç»Ÿå°±æ— æ³•ä»ç£ç›˜è¿è¡Œç¨‹åºï¼Œè€Œæ“ä½œç³»ç»Ÿçš„ç¨‹åºåˆå­˜å‚¨åœ¨ç£ç›˜ä¸Šï¼Œé‚£ä¹ˆæ“ä½œç³»ç»Ÿæ˜¯å¦‚ä½•å¯åŠ¨çš„å‘¢ï¼ŸÚ]This problem parallels one in the book The Adventures of Baron Munchausen.  A character had fallen part way down a manhole, and pulled himself out by grabbing his bootstraps and lifting.  In the early days of computing, the term _bootstrap_ was applied to the mechanism used to load the operating system.  It has since become shortened to "booting".ÚZè¿™ä¸ªé—®é¢˜ä¸ã€Šå·´ä¼¦Â·é—¨èˆ’æ£®çš„å†’é™©ã€‹ä¸€ä¹¦ä¸­çš„ä¸€ä¸ªé—®é¢˜ç›¸ä¼¼ã€‚ä¸€ä¸ªè§’è‰²åœ¨ä¸€ä¸ªäº•ç›–ä¸Šå¡ä½äº†ä¸€åŠèº«å­ï¼Œä»–é€šè¿‡æŠ“ä½è‡ªå·±çš„é´å¸¦å¹¶æŠ¬èµ·æ¥è‡ªæ•‘ã€‚åœ¨è®¡ç®—æœºçš„æ—©æœŸï¼Œæœ¯è¯­ _å¼•å¯¼ï¼ˆbootstrapï¼‰_ è¢«ç”¨æ¥æŒ‡ä»£åŠ è½½æ“ä½œç³»ç»Ÿçš„æœºåˆ¶ã€‚åæ¥ï¼Œè¿™ä¸ªæœ¯è¯­è¢«ç¼©çŸ­ä¸ºâ€œå¼•å¯¼ï¼ˆbootingï¼‰â€ã€‚Ú¨On x86 hardware, the Basic Input/Output System (BIOS) is responsible for loading the operating system.  The BIOS looks on the hard disk for the Master Boot Record (MBR), which must be located in a specific place on the disk.  The BIOS has enough knowledge to load and run the MBR, and assumes that the MBR can then carry out the rest of the tasks involved in loading the operating system, possibly with the help of the BIOS.Ú@åœ¨ x86 ç¡¬ä»¶ä¸Šï¼ŒåŸºæœ¬è¾“å…¥/è¾“å‡ºç³»ç»Ÿï¼ˆBIOSï¼‰è´Ÿè´£åŠ è½½æ“ä½œç³»ç»Ÿã€‚BIOS åœ¨ç¡¬ç›˜ä¸ŠæŸ¥æ‰¾ä¸»å¼•å¯¼è®°å½•ï¼ˆMBRï¼‰ï¼Œè¯¥è®°å½•å¿…é¡»ä½äºç¡¬ç›˜çš„ç‰¹å®šä½ç½®ã€‚BIOS å…·æœ‰è¶³å¤Ÿçš„çŸ¥è¯†æ¥åŠ è½½å’Œè¿è¡Œ MBRï¼Œå¹¶å‡è®¾ MBR å¯ä»¥å®ŒæˆåŠ è½½æ“ä½œç³»ç»Ÿçš„å…¶ä½™ä»»åŠ¡ï¼Œå¯èƒ½éœ€è¦ BIOS çš„å¸®åŠ©ã€‚ÚmFreeBSD provides for booting from both the older MBR standard, and the newer GUID Partition Table (GPT).  GPT partitioning is often found on computers with the Unified Extensible Firmware Interface (UEFI).  However, FreeBSD can boot from GPT partitions even on machines with only a legacy BIOS with man:gptboot[8].  Work is under way to provide direct UEFI booting.ÚRFreeBSD æ”¯æŒä»æ—§çš„ MBR æ ‡å‡†å’Œæ–°çš„ GUID åˆ†åŒºè¡¨ï¼ˆGPTï¼‰è¿›è¡Œå¼•å¯¼ã€‚GPT åˆ†åŒºé€šå¸¸åœ¨å…·æœ‰ç»Ÿä¸€å¯æ‰©å±•å›ºä»¶æ¥å£ï¼ˆUEFIï¼‰çš„è®¡ç®—æœºä¸Šæ‰¾åˆ°ã€‚ç„¶è€Œï¼Œå³ä½¿åœ¨åªæœ‰ä¼ ç»Ÿ BIOS çš„æœºå™¨ä¸Šï¼ŒFreeBSD ä¹Ÿå¯ä»¥ä» GPT åˆ†åŒºå¼•å¯¼ï¼Œä½¿ç”¨ man:gptboot[8] ã€‚ç›®å‰æ­£åœ¨è¿›è¡Œç›´æ¥æ”¯æŒ UEFI å¼•å¯¼çš„å·¥ä½œã€‚ÚrThe code within the MBR is typically referred to as a _boot manager_, especially when it interacts with the user.  The boot manager usually has more code in the first track of the disk or within the file system.  Examples of boot managers include the standard FreeBSD boot manager boot0, also called Boot Easy, and GNU GRUB, which is used by many Linux(R) distributions.ÚJMBR ä¸­çš„ä»£ç é€šå¸¸è¢«ç§°ä¸ºâ€œå¼•å¯¼ç®¡ç†å™¨â€ï¼Œç‰¹åˆ«æ˜¯å½“å®ƒä¸ç”¨æˆ·äº¤äº’æ—¶ã€‚å¼•å¯¼ç®¡ç†å™¨é€šå¸¸åœ¨ç£ç›˜çš„ç¬¬ä¸€ä¸ªç£é“æˆ–æ–‡ä»¶ç³»ç»Ÿä¸­æœ‰æ›´å¤šçš„ä»£ç ã€‚å¼•å¯¼ç®¡ç†å™¨çš„ç¤ºä¾‹åŒ…æ‹¬æ ‡å‡†çš„ FreeBSD å¼•å¯¼ç®¡ç†å™¨ boot0ï¼Œä¹Ÿç§°ä¸º Boot Easyï¼Œä»¥åŠ GNU GRUBï¼Œå®ƒè¢«è®¸å¤š Linux(R) å‘è¡Œç‰ˆä½¿ç”¨ã€‚ÙtUsers of GRUB should refer to https://www.gnu.org/software/grub/grub-documentation.html[GNU-provided documentation].ÙiGRUB çš„ç”¨æˆ·åº”å‚è€ƒ https://www.gnu.org/software/grub/grub-documentation.html[GNU æä¾›çš„æ–‡æ¡£]ã€‚ÚeIf only one operating system is installed, the MBR searches for the first bootable (active) slice on the disk, and then runs the code on that slice to load the remainder of the operating system.  When multiple operating systems are present, a different boot manager can be installed to display a list of operating systems so the user can select one to boot.ÚBå¦‚æœåªå®‰è£…äº†ä¸€ä¸ªæ“ä½œç³»ç»Ÿï¼ŒMBR ä¼šæœç´¢ç£ç›˜ä¸Šç¬¬ä¸€ä¸ªå¯å¼•å¯¼ï¼ˆæ´»åŠ¨çš„ï¼‰åˆ†åŒºï¼Œå¹¶è¿è¡Œè¯¥åˆ†åŒºä¸Šçš„ä»£ç æ¥åŠ è½½æ“ä½œç³»ç»Ÿçš„å…¶ä½™éƒ¨åˆ†ã€‚å½“å­˜åœ¨å¤šä¸ªæ“ä½œç³»ç»Ÿæ—¶ï¼Œå¯ä»¥å®‰è£…ä¸åŒçš„å¼•å¯¼ç®¡ç†å™¨æ¥æ˜¾ç¤ºæ“ä½œç³»ç»Ÿåˆ—è¡¨ï¼Œä»¥ä¾¿ç”¨æˆ·å¯ä»¥é€‰æ‹©è¦å¼•å¯¼çš„æ“ä½œç³»ç»Ÿã€‚ÚThe remainder of the FreeBSD bootstrap system is divided into three stages.  The first stage knows just enough to get the computer into a specific state and run the second stage.  The second stage can do a little bit more, before running the third stage.  The third stage finishes the task of loading the operating system.  The work is split into three stages because the MBR puts limits on the size of the programs that can be run at stages one and two.  Chaining the tasks together allows FreeBSD to provide a more flexible loader.Ú·FreeBSD å¼•å¯¼ç³»ç»Ÿçš„å‰©ä½™éƒ¨åˆ†åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µã€‚ç¬¬ä¸€é˜¶æ®µåªéœ€çŸ¥é“è®©è®¡ç®—æœºè¿›å…¥ç‰¹å®šçŠ¶æ€å¹¶è¿è¡Œç¬¬äºŒé˜¶æ®µå³å¯ã€‚ç¬¬äºŒé˜¶æ®µå¯ä»¥åšæ›´å¤šçš„äº‹æƒ…ï¼Œç„¶åè¿è¡Œç¬¬ä¸‰é˜¶æ®µã€‚ç¬¬ä¸‰é˜¶æ®µå®ŒæˆåŠ è½½æ“ä½œç³»ç»Ÿçš„ä»»åŠ¡ã€‚å°†å·¥ä½œåˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µæ˜¯å› ä¸º MBR å¯¹å¯ä»¥åœ¨ç¬¬ä¸€å’Œç¬¬äºŒé˜¶æ®µè¿è¡Œçš„ç¨‹åºçš„å¤§å°æœ‰é™åˆ¶ã€‚å°†ä»»åŠ¡é“¾æ¥åœ¨ä¸€èµ·ä½¿ FreeBSD èƒ½å¤Ÿæä¾›æ›´çµæ´»çš„åŠ è½½ç¨‹åºã€‚Ú³The kernel is then started and begins to probe for devices and initialize them for use.  Once the kernel boot process is finished, the kernel passes control to the user process man:init[8], which makes sure the disks are in a usable state, starts the user-level resource configuration which mounts file systems, sets up network cards to communicate on the network, and starts the processes which have been configured to run at startup.ÚVç„¶åå¯åŠ¨å†…æ ¸ï¼Œå¹¶å¼€å§‹æ¢æµ‹è®¾å¤‡å¹¶åˆå§‹åŒ–å®ƒä»¬ä»¥ä¾›ä½¿ç”¨ã€‚ä¸€æ—¦å†…æ ¸å¼•å¯¼è¿‡ç¨‹å®Œæˆï¼Œå†…æ ¸å°†æ§åˆ¶æƒäº¤ç»™ç”¨æˆ·è¿›ç¨‹ man:init[8]ï¼Œè¯¥è¿›ç¨‹ç¡®ä¿ç£ç›˜å¤„äºå¯ç”¨çŠ¶æ€ï¼Œå¯åŠ¨ç”¨æˆ·çº§èµ„æºé…ç½®ä»¥æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿï¼Œè®¾ç½®ç½‘ç»œå¡ä»¥è¿›è¡Œç½‘ç»œé€šä¿¡ï¼Œå¹¶å¯åŠ¨å·²é…ç½®ä¸ºåœ¨å¯åŠ¨æ—¶è¿è¡Œçš„è¿›ç¨‹ã€‚ÙrThis section describes these stages in more detail and demonstrates how to interact with the FreeBSD boot process.Ù`æœ¬èŠ‚å°†æ›´è¯¦ç»†åœ°æè¿°è¿™äº›é˜¶æ®µï¼Œå¹¶æ¼”ç¤ºå¦‚ä½•ä¸ FreeBSD å¼•å¯¼è¿‡ç¨‹è¿›è¡Œäº¤äº’ã€‚°The Boot Manager¯å¼•å¯¼ç®¡ç†å™¨ÙThe boot manager code in the MBR is sometimes referred to as _stage zero_ of the boot process.  By default, FreeBSD uses the boot0 boot manager.Ù…MBR ä¸­çš„å¼•å¯¼ç®¡ç†å™¨ä»£ç æœ‰æ—¶è¢«ç§°ä¸ºå¼•å¯¼è¿‡ç¨‹çš„ _é›¶é˜¶æ®µ_ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒFreeBSD ä½¿ç”¨ boot0 å¼•å¯¼ç®¡ç†å™¨ã€‚ÚMThe MBR installed by the FreeBSD installer is based on [.filename]#/boot/boot0#.  The size and capability of boot0 is restricted to 446 bytes due to the slice table and `0x55AA` identifier at the end of the MBR.  If boot0 and multiple operating systems are installed, a message similar to this example will be displayed at boot time:ÚFreeBSD å®‰è£…ç¨‹åºå®‰è£…çš„ MBR åŸºäº [.filename]#/boot/boot0#ã€‚ç”±äº slice è¡¨å’Œ MBR æœ«å°¾çš„ 0x55AA æ ‡è¯†ç¬¦ï¼Œ boot0 çš„å¤§å°å’ŒåŠŸèƒ½è¢«é™åˆ¶ä¸º 446 å­—èŠ‚ã€‚å¦‚æœå®‰è£…äº† boot0 å’Œå¤šä¸ªæ“ä½œç³»ç»Ÿï¼Œåˆ™åœ¨å¯åŠ¨æ—¶ä¼šæ˜¾ç¤ºç±»ä¼¼äºä»¥ä¸‹ç¤ºä¾‹çš„æ¶ˆæ¯ï¼š½[.filename]#boot0# Screenshot¹[.filename]#boot0# æˆªå›¾Ù½Other operating systems will overwrite an existing MBR if they are installed after FreeBSD.  If this happens, or to replace the existing MBR with the FreeBSD MBR, use the following command:Ù¹å¦‚æœåœ¨ FreeBSD ä¹‹åå®‰è£…å…¶ä»–æ“ä½œç³»ç»Ÿï¼Œå®ƒä»¬å°†è¦†ç›–ç°æœ‰çš„ MBRã€‚å¦‚æœå‘ç”Ÿè¿™ç§æƒ…å†µï¼Œæˆ–è€…è¦ç”¨ FreeBSD çš„ MBR æ›¿æ¢ç°æœ‰çš„ MBR ï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼šÚ
where _device_ is the boot disk, such as [.filename]#ad0# for the first IDE disk, [.filename]#ad2# for the first IDE disk on a second IDE controller, or [.filename]#da0# for the first SCSI disk.  To create a custom configuration of the MBR, refer to man:boot0cfg[8].Úå…¶ä¸­ _device_ æ˜¯å¼•å¯¼ç£ç›˜ï¼Œä¾‹å¦‚ [.filename]#ad0# è¡¨ç¤ºç¬¬ä¸€ä¸ª IDE ç£ç›˜ï¼Œ[.filename]#ad2# è¡¨ç¤ºç¬¬äºŒä¸ª IDE æ§åˆ¶å™¨ä¸Šçš„ç¬¬ä¸€ä¸ª IDE ç£ç›˜ï¼Œæˆ–è€… [.filename]#da0# è¡¨ç¤ºç¬¬ä¸€ä¸ª SCSI ç£ç›˜ã€‚è¦åˆ›å»ºè‡ªå®šä¹‰çš„ MBR é…ç½®ï¼Œè¯·å‚è€ƒ man:boot0cfg[8]ã€‚·Stage One and Stage Two»ç¬¬ä¸€é˜¶æ®µå’Œç¬¬äºŒé˜¶æ®µÚ$Conceptually, the first and second stages are part of the same program on the same area of the disk.  Due to space constraints, they have been split into two, but are always installed together.  They are copied from the combined [.filename]#/boot/boot# by the FreeBSD installer or `bsdlabel`.Úä»æ¦‚å¿µä¸Šè®²ï¼Œç¬¬ä¸€é˜¶æ®µå’Œç¬¬äºŒé˜¶æ®µæ˜¯åŒä¸€ä¸ªç¨‹åºåœ¨ç£ç›˜çš„åŒä¸€ä¸ªåŒºåŸŸçš„ä¸€éƒ¨åˆ†ã€‚ç”±äºç©ºé—´é™åˆ¶ï¼Œå®ƒä»¬è¢«åˆ†æˆä¸¤éƒ¨åˆ†ï¼Œä½†æ€»æ˜¯ä¸€èµ·å®‰è£…çš„ã€‚å®ƒä»¬æ˜¯ç”± FreeBSD å®‰è£…ç¨‹åºæˆ– `bsdlabel` ä»ç»„åˆçš„ [.filename]#/boot/boot# å¤åˆ¶è€Œæ¥ã€‚ÙğThese two stages are located outside file systems, in the first track of the boot slice, starting with the first sector.  This is where boot0, or any other boot manager, expects to find a program to run which will continue the boot process.ÙÑè¿™ä¸¤ä¸ªé˜¶æ®µä½äºæ–‡ä»¶ç³»ç»Ÿä¹‹å¤–ï¼Œåœ¨å¼•å¯¼ slice çš„ç¬¬ä¸€ä¸ªç£é“ä¸Šï¼Œä»ç¬¬ä¸€ä¸ªæ‰‡åŒºå¼€å§‹ã€‚è¿™æ˜¯ boot0 æˆ–ä»»ä½•å…¶ä»–å¼•å¯¼ç®¡ç†å™¨æœŸæœ›æ‰¾åˆ°ä¸€ä¸ªç¨‹åºæ¥ç»§ç»­å¼•å¯¼è¿‡ç¨‹çš„ä½ç½®ã€‚ÙâThe first stage, [.filename]#boot1#, is very simple, since it can only be 512 bytes in size.  It knows just enough about the FreeBSD _bsdlabel_, which stores information about the slice, to find and execute [.filename]#boot2#.ÙŞç¬¬ä¸€é˜¶æ®µï¼Œ[.filename]#boot1#ï¼Œéå¸¸ç®€å•ï¼Œå› ä¸ºå®ƒçš„å¤§å°åªèƒ½æ˜¯ 512 å­—èŠ‚ã€‚å®ƒå¯¹ FreeBSD çš„ _bsdlabel_ æœ‰ä¸€å®šäº†è§£ï¼Œè¯¥æ ‡ç­¾å­˜å‚¨æœ‰å…³åˆ†åŒºçš„ä¿¡æ¯ï¼Œä»¥ä¾¿æ‰¾åˆ°å¹¶æ‰§è¡Œ [.filename]#boot2#ã€‚ÚStage two, [.filename]#boot2#, is slightly more sophisticated, and understands the FreeBSD file system enough to find files.  It can provide a simple interface to choose the kernel or loader to run.  It runs loader, which is much more sophisticated and provides a boot configuration file.  If the boot process is interrupted at stage two, the following interactive screen is displayed:Úbç¬¬äºŒé˜¶æ®µï¼Œ[.filename]#boot2#ï¼Œç¨å¾®å¤æ‚ä¸€äº›ï¼Œè¶³å¤Ÿç†è§£ FreeBSD æ–‡ä»¶ç³»ç»Ÿä»¥æ‰¾åˆ°æ–‡ä»¶ã€‚å®ƒå¯ä»¥æä¾›ä¸€ä¸ªç®€å•çš„ç•Œé¢æ¥é€‰æ‹©è¦è¿è¡Œçš„å†…æ ¸æˆ–åŠ è½½ç¨‹åºã€‚å®ƒè¿è¡ŒåŠ è½½ç¨‹åºï¼ŒåŠ è½½ç¨‹åºæ›´åŠ å¤æ‚ï¼Œå¹¶æä¾›ä¸€ä¸ªå¼•å¯¼é…ç½®æ–‡ä»¶ã€‚å¦‚æœåœ¨ç¬¬äºŒé˜¶æ®µä¸­æ–­äº†å¼•å¯¼è¿‡ç¨‹ï¼Œå°†æ˜¾ç¤ºä»¥ä¸‹äº¤äº’å¼å±å¹•ï¼š½[.filename]#boot2# Screenshot¹[.filename]#boot2# æˆªå›¾ÙÏTo replace the installed [.filename]#boot1# and [.filename]#boot2#, use `bsdlabel`, where _diskslice_ is the disk and slice to boot from, such as [.filename]#ad0s1# for the first slice on the first IDE disk:Ùçè¦æ›¿æ¢å·²å®‰è£…çš„ [.filename]#boot1# å’Œ [.filename]#boot2# ï¼Œè¯·ä½¿ç”¨ `bsdlabel` å‘½ä»¤ï¼Œå…¶ä¸­ _diskslice_ æ˜¯è¦ä»ä¸­å¼•å¯¼çš„ç£ç›˜å’Œåˆ†åŒºï¼Œä¾‹å¦‚ [.filename]#ad0s1# è¡¨ç¤ºç¬¬ä¸€ä¸ª IDE ç£ç›˜ä¸Šçš„ç¬¬ä¸€ä¸ªåˆ†åŒºã€‚ÙñIf just the disk name is used, such as [.filename]#ad0#, `bsdlabel` will create the disk in "dangerously dedicated mode", without slices.  This is probably not the desired action, so double check the _diskslice_ before pressing kbd:[Return].Úå¦‚æœåªä½¿ç”¨ç£ç›˜åç§°ï¼Œä¾‹å¦‚ [.filename]#ad0#ï¼Œ `bsdlabel` å°†ä»¥â€œå±é™©ä¸“ç”¨æ¨¡å¼ï¼ˆdangerously dedicated modeï¼‰â€åˆ›å»ºç£ç›˜ï¼Œè€Œä¸ä½¿ç”¨åˆ†åŒºã€‚è¿™å¯èƒ½ä¸æ˜¯æœŸæœ›çš„æ“ä½œï¼Œæ‰€ä»¥åœ¨æŒ‰ä¸‹ kbd:[Return] ä¹‹å‰ï¼Œè¯·ä»”ç»†æ£€æŸ¥ _diskslice_ã€‚«Stage Three¬ç¬¬ä¸‰é˜¶æ®µÙŒThe loader is the final stage of the three-stage bootstrap process.  It is located on the file system, usually as [.filename]#/boot/loader#.ÙåŠ è½½å™¨æ˜¯ä¸‰é˜¶æ®µå¼•å¯¼è¿‡ç¨‹çš„æœ€åé˜¶æ®µã€‚å®ƒä½äºæ–‡ä»¶ç³»ç»Ÿä¸Šï¼Œé€šå¸¸æ˜¯ä½œä¸º [.filename]#/boot/loader# æ–‡ä»¶ã€‚Ù¯The loader is intended as an interactive method for configuration, using a built-in command set, backed up by a more powerful interpreter which has a more complex command set.ÙŸåŠ è½½å™¨æ—¨åœ¨ä½œä¸ºä¸€ç§äº¤äº’å¼çš„é…ç½®æ–¹æ³•ï¼Œä½¿ç”¨å†…ç½®çš„å‘½ä»¤é›†ï¼Œå¹¶ç”±æ›´å¼ºå¤§çš„è§£é‡Šå™¨æ”¯æŒï¼Œè¯¥è§£é‡Šå™¨å…·æœ‰æ›´å¤æ‚çš„å‘½ä»¤é›†ã€‚Ù÷During initialization, loader will probe for a console and for disks, and figure out which disk it is booting from.  It will set variables accordingly, and an interpreter is started where user commands can be passed from a script or interactively.ÙÏåœ¨åˆå§‹åŒ–è¿‡ç¨‹ä¸­ï¼ŒåŠ è½½å™¨å°†æ¢æµ‹æ§åˆ¶å°å’Œç£ç›˜ï¼Œå¹¶ç¡®å®šæ­£åœ¨å¼•å¯¼çš„ç£ç›˜ã€‚å®ƒå°†ç›¸åº”åœ°è®¾ç½®å˜é‡ï¼Œå¹¶å¯åŠ¨ä¸€ä¸ªè§£é‡Šå™¨ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡è„šæœ¬æˆ–äº¤äº’æ–¹å¼ä¼ é€’å‘½ä»¤ã€‚Ú^The loader will then read [.filename]#/boot/loader.rc#, which by default reads in [.filename]#/boot/defaults/loader.conf# which sets reasonable defaults for variables and reads [.filename]#/boot/loader.conf# for local changes to those variables.  [.filename]#loader.rc# then acts on these variables, loading whichever modules and kernel are selected.Útç„¶åï¼ŒåŠ è½½ç¨‹åºå°†è¯»å– [.filename]#/boot/loader.rc# æ–‡ä»¶ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¼šè¯»å– [.filename]#/boot/defaults/loader.conf# æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶ä¸ºå˜é‡è®¾ç½®äº†åˆç†çš„é»˜è®¤å€¼ï¼Œå¹¶è¯»å– [.filename]#/boot/loader.conf# æ–‡ä»¶ä»¥è·å–å¯¹è¿™äº›å˜é‡çš„æœ¬åœ°æ›´æ”¹ã€‚[.filename]#loader.rc# æ–‡ä»¶ä¼šæ ¹æ®è¿™äº›å˜é‡çš„è®¾ç½®åŠ è½½æ‰€é€‰çš„æ¨¡å—å’Œå†…æ ¸ã€‚ÚÉFinally, by default, loader issues a 10 second wait for key presses, and boots the kernel if it is not interrupted.  If interrupted, the user is presented with a prompt which understands the command set, where the user may adjust variables, unload all modules, load modules, and then finally boot or reboot.  <<boot-loader-commands>> lists the most commonly used loader commands.  For a complete discussion of all available commands, refer to man:loader[8].Ú¾æœ€åï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒåŠ è½½ç¨‹åºä¼šç­‰å¾… 10 ç§’é’Ÿä»¥ç­‰å¾…æŒ‰é”®æ“ä½œï¼Œå¦‚æœæ²¡æœ‰è¢«ä¸­æ–­ï¼Œåˆ™å¯åŠ¨å†…æ ¸ã€‚å¦‚æœè¢«ä¸­æ–­ï¼Œç”¨æˆ·å°†ä¼šçœ‹åˆ°ä¸€ä¸ªç†è§£å‘½ä»¤é›†çš„æç¤ºç¬¦ï¼Œç”¨æˆ·å¯ä»¥åœ¨å…¶ä¸­è°ƒæ•´å˜é‡ã€å¸è½½æ‰€æœ‰æ¨¡å—ã€åŠ è½½æ¨¡å—ï¼Œæœ€åè¿›è¡Œå¯åŠ¨æˆ–é‡æ–°å¯åŠ¨æ“ä½œã€‚ <<boot-loader-commands>> åˆ—å‡ºäº†æœ€å¸¸ç”¨çš„åŠ è½½ç¨‹åºå‘½ä»¤ã€‚æœ‰å…³æ‰€æœ‰å¯ç”¨å‘½ä»¤çš„å®Œæ•´è®¨è®ºï¼Œè¯·å‚é˜… man:loader[8]ã€‚¸Loader Built-In CommandsµåŠ è½½å™¨å†…ç½®å‘½ä»¤Ù˜Proceeds to boot the kernel if not interrupted within the time span given, in seconds. It displays a countdown, and the default time span is 10 seconds.Ù£å¦‚æœåœ¨ç»™å®šçš„æ—¶é—´èŒƒå›´å†…ï¼ˆä»¥ç§’ä¸ºå•ä½ï¼‰æ²¡æœ‰è¢«ä¸­æ–­ï¼Œå°†ç»§ç»­å¯åŠ¨å†…æ ¸ã€‚å®ƒä¼šæ˜¾ç¤ºä¸€ä¸ªå€’è®¡æ—¶ï¼Œè€Œé»˜è®¤çš„æ—¶é—´èŒƒå›´æ˜¯ 10 ç§’ã€‚ÚKImmediately proceeds to boot the kernel, with any specified options or kernel name. Providing a kernel name on the command-line is only applicable after an `unload` has been issued. Otherwise, the previously-loaded kernel will be used. If _kernelname_ is not qualified, it will be searched under _/boot/kernel_ and _/boot/modules_.Úç«‹å³å¯åŠ¨å†…æ ¸ï¼Œä½¿ç”¨æŒ‡å®šçš„é€‰é¡¹æˆ–å†…æ ¸åç§°ã€‚åœ¨æ‰§è¡Œ `unload` å‘½ä»¤ä¹‹åï¼Œæ‰èƒ½åœ¨å‘½ä»¤è¡Œä¸Šæä¾›å†…æ ¸åç§°ã€‚å¦åˆ™ï¼Œå°†ä½¿ç”¨å…ˆå‰åŠ è½½çš„å†…æ ¸ã€‚å¦‚æœ _kernelname_ æ²¡æœ‰é™å®šï¼Œå°†åœ¨ _boot/kernel_ å’Œ _boot/modules_ ä¸‹è¿›è¡Œæœç´¢ã€‚Ù¿Goes through the same automatic configuration of modules based on specified variables, most commonly `kernel`. This only makes sense if `unload` is used first, before changing some variables.Ùæ ¹æ®æŒ‡å®šçš„å˜é‡ï¼Œè‡ªåŠ¨é…ç½®æ¨¡å—ï¼Œé€šå¸¸æ˜¯ `kernel`ã€‚åªæœ‰åœ¨å…ˆä½¿ç”¨ `unload` å¸è½½æ¨¡å—åï¼Œå†æ›´æ”¹ä¸€äº›å˜é‡æ—¶ï¼Œè¿™æ‰æœ‰æ„ä¹‰ã€‚Ù‡Shows help messages read from [.filename]#/boot/loader.help#. If the topic given is `index`, the list of available topics is displayed.Ù…æ˜¾ç¤ºä» [.filename]#/boot/loader.help# è¯»å–çš„å¸®åŠ©ä¿¡æ¯ã€‚å¦‚æœç»™å®šçš„ä¸»é¢˜æ˜¯ `index`ï¼Œåˆ™æ˜¾ç¤ºå¯ç”¨ä¸»é¢˜çš„åˆ—è¡¨ã€‚ÙbReads the specified file and interprets it line by line. An error immediately stops the `include`.Ù^è¯»å–æŒ‡å®šçš„æ–‡ä»¶ï¼Œå¹¶é€è¡Œè§£é‡Šã€‚ä¸€æ—¦å‡ºç°é”™è¯¯ï¼Œ`include` æ“ä½œç«‹å³åœæ­¢ã€‚Ù!load [-t ``_type_``] `_filename_`¡`ÙíLoads the kernel, kernel module, or file of the type given, with the specified filename. Any arguments after _filename_ are passed to the file. If _filename_ is not qualified, it will be searched under _/boot/kernel_ and _/boot/modules_.ÙæåŠ è½½ç»™å®šç±»å‹çš„å†…æ ¸ã€å†…æ ¸æ¨¡å—æˆ–æ–‡ä»¶ï¼Œä½¿ç”¨æŒ‡å®šçš„æ–‡ä»¶åã€‚_filename_ åçš„ä»»ä½•å‚æ•°éƒ½å°†ä¼ é€’ç»™è¯¥æ–‡ä»¶ã€‚å¦‚æœ _filename_ æ²¡æœ‰é™å®šï¼Œå°†åœ¨ _/boot/kernel_ å’Œ _/boot/modules_ ä¸‹è¿›è¡Œæœç´¢ã€‚Ù˜Displays a listing of files in the given path, or the root directory, if the path is not specified. If `-l` is specified, file sizes will also be shown.Ù‡æ˜¾ç¤ºç»™å®šè·¯å¾„ä¸­çš„æ–‡ä»¶åˆ—è¡¨ï¼Œå¦‚æœæœªæŒ‡å®šè·¯å¾„ï¼Œåˆ™æ˜¾ç¤ºæ ¹ç›®å½•ã€‚å¦‚æœæŒ‡å®šäº† `-l` ï¼Œè¿˜å°†æ˜¾ç¤ºæ–‡ä»¶å¤§å°ã€‚ÙwLists all of the devices from which it may be possible to load modules. If `-v` is specified, more details are printed.Ùbåˆ—å‡ºæ‰€æœ‰å¯èƒ½åŠ è½½æ¨¡å—çš„è®¾å¤‡ã€‚å¦‚æœæŒ‡å®šäº† `-v`ï¼Œåˆ™ä¼šæ‰“å°æ›´å¤šè¯¦ç»†ä¿¡æ¯ã€‚ÙFDisplays loaded modules. If `-v` is specified, more details are shown.ÙPæ˜¾ç¤ºå·²åŠ è½½çš„æ¨¡å—ã€‚å¦‚æœæŒ‡å®šäº† `-v`ï¼Œåˆ™æ˜¾ç¤ºæ›´å¤šè¯¦ç»†ä¿¡æ¯ã€‚ÙEDisplays the files specified, with a pause at each `LINES` displayed.ÙBæ˜¾ç¤ºæŒ‡å®šçš„æ–‡ä»¶ï¼Œåœ¨æ¯ä¸ªæ˜¾ç¤ºçš„ `LINES` ä¹‹é—´æš‚åœã€‚¿Immediately reboots the system.»ç«‹å³é‡æ–°å¯åŠ¨ç³»ç»Ÿã€‚Ù)Sets the specified environment variables.¾è®¾ç½®æŒ‡å®šçš„ç¯å¢ƒå˜é‡ã€‚»Removes all loaded modules.Ù!ç§»é™¤æ‰€æœ‰å·²åŠ è½½çš„æ¨¡å—ã€‚Ù`Here are some practical examples of loader usage.  To boot the usual kernel in single-user mode:ÙZä»¥ä¸‹æ˜¯ä¸€äº›åŠ è½½å™¨ä½¿ç”¨çš„å®é™…ç¤ºä¾‹ã€‚è¦ä»¥å•ç”¨æˆ·æ¨¡å¼å¯åŠ¨å¸¸è§„å†…æ ¸ï¼šÙ_To unload the usual kernel and modules and then load the previous or another, specified kernel:ÙTå¸è½½å¸¸è§„çš„å†…æ ¸å’Œæ¨¡å—ï¼Œç„¶ååŠ è½½å…ˆå‰çš„æˆ–å¦ä¸€ä¸ªæŒ‡å®šçš„å†…æ ¸ï¼šÚUse the qualified [.filename]#/boot/GENERIC/kernel# to refer to the default kernel that comes with an installation, or [.filename]#/boot/kernel.old/kernel#, to refer to the previously installed kernel before a system upgrade or before configuring a custom kernel.ÙÖä½¿ç”¨é™å®šçš„ [.filename]#/boot/GENERIC/kernel# æ¥å¼•ç”¨å®‰è£…æ—¶é»˜è®¤çš„å†…æ ¸ï¼Œæˆ–è€…ä½¿ç”¨ [.filename]#/boot/kernel.old/kernel# æ¥å¼•ç”¨åœ¨ç³»ç»Ÿå‡çº§æˆ–é…ç½®è‡ªå®šä¹‰å†…æ ¸ä¹‹å‰å…ˆå‰å®‰è£…çš„å†…æ ¸ã€‚Ù€Use the following to load the usual modules with another kernel.  Note that in this case it is not necessary the qualified name:Ù{ä½¿ç”¨ä»¥ä¸‹å†…å®¹åœ¨å¦ä¸€ä¸ªå†…æ ¸ä¸­åŠ è½½å¸¸ç”¨æ¨¡å—ã€‚è¯·æ³¨æ„ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸éœ€è¦ä½¿ç”¨é™å®šåç§°ï¼šÙ1To load an automated kernel configuration script:Ù-åŠ è½½è‡ªåŠ¨åŒ–å†…æ ¸é…ç½®è„šæœ¬çš„æ–¹æ³•ï¼šªLast Stage¬æœ€åé˜¶æ®µÚ	Once the kernel is loaded by either loader or by boot2, which bypasses loader, it examines any boot flags and adjusts its behavior as necessary.  <<boot-kernel>> lists the commonly used boot flags.  Refer to man:boot[8] for more information on the other boot flags.Úä¸€æ—¦å†…æ ¸è¢«åŠ è½½ï¼Œæ— è®ºæ˜¯ç”±å¼•å¯¼ç¨‹åºè¿˜æ˜¯ç”±ç»•è¿‡å¼•å¯¼ç¨‹åºçš„ boot2 åŠ è½½ï¼Œå®ƒéƒ½ä¼šæ£€æŸ¥ä»»ä½•å¼•å¯¼æ ‡å¿—å¹¶æ ¹æ®éœ€è¦è°ƒæ•´å…¶è¡Œä¸ºã€‚ <<boot-kernel>> åˆ—å‡ºäº†å¸¸ç”¨çš„å¼•å¯¼æ ‡å¿—ã€‚æœ‰å…³å…¶ä»–å¼•å¯¼æ ‡å¿—çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜… man:boot[8]ã€‚¾Kernel Interaction During Boot¾å¼•å¯¼è¿‡ç¨‹ä¸­çš„å†…æ ¸äº¤äº’ÙRDuring kernel initialization, ask for the device to mount as the root file system.ÙKåœ¨å†…æ ¸åˆå§‹åŒ–æœŸé—´ï¼Œè¯·æ±‚è®¾å¤‡ä½œä¸ºæ ¹æ–‡ä»¶ç³»ç»Ÿè¿›è¡ŒæŒ‚è½½ã€‚Ù'Boot the root file system from a CDROM.Ù"ä» CDROM å¼•å¯¼æ ¹æ–‡ä»¶ç³»ç»Ÿã€‚»Boot into single-user mode.¸è¿›å…¥å•ç”¨æˆ·æ¨¡å¼ã€‚Ù&Be more verbose during kernel startup.Ù6åœ¨å†…æ ¸å¯åŠ¨è¿‡ç¨‹ä¸­å¢åŠ æ›´å¤šçš„è¯¦ç»†ä¿¡æ¯ã€‚ÙùOnce the kernel has finished booting, it passes control to the user process man:init[8], which is located at [.filename]#/sbin/init#, or the program path specified in the `init_path` variable in `loader`.  This is the last stage of the boot process.ÙÛä¸€æ—¦å†…æ ¸å¯åŠ¨å®Œæˆï¼Œå®ƒå°†æ§åˆ¶æƒäº¤ç»™ç”¨æˆ·è¿›ç¨‹ man:init[8]ï¼Œè¯¥è¿›ç¨‹ä½äº [.filename]#/sbin/init# æˆ–è€…åœ¨ `loader` ä¸­çš„ `init_path` å˜é‡æŒ‡å®šçš„ç¨‹åºè·¯å¾„ã€‚è¿™æ˜¯å¼•å¯¼è¿‡ç¨‹çš„æœ€åé˜¶æ®µã€‚ÚEThe boot sequence makes sure that the file systems available on the system are consistent.  If a UFS file system is not, and `fsck` cannot fix the inconsistencies, init drops the system into single-user mode so that the system administrator can resolve the problem directly.  Otherwise, the system boots into multi-user mode.Úå¼•å¯¼åºåˆ—ç¡®ä¿ç³»ç»Ÿä¸Šå¯ç”¨çš„æ–‡ä»¶ç³»ç»Ÿæ˜¯ä¸€è‡´çš„ã€‚å¦‚æœ UFS æ–‡ä»¶ç³»ç»Ÿä¸ä¸€è‡´ï¼Œå¹¶ä¸” `fsck` æ— æ³•ä¿®å¤ä¸ä¸€è‡´æ€§ï¼Œinit ä¼šå°†ç³»ç»Ÿåˆ‡æ¢åˆ°å•ç”¨æˆ·æ¨¡å¼ï¼Œä»¥ä¾¿ç³»ç»Ÿç®¡ç†å‘˜å¯ä»¥ç›´æ¥è§£å†³é—®é¢˜ã€‚å¦åˆ™ï¼Œç³»ç»Ÿå°†å¯åŠ¨åˆ°å¤šç”¨æˆ·æ¨¡å¼ã€‚°Single-User Mode¯å•ç”¨æˆ·æ¨¡å¼ÙÙA user can specify this mode by booting with `-s` or by setting the `boot_single` variable in loader.  It can also be reached by running `shutdown now` from multi-user mode.  Single-user mode begins with this message:Ùëç”¨æˆ·å¯ä»¥é€šè¿‡ä½¿ç”¨ `-s` å‚æ•°å¯åŠ¨æˆ–åœ¨å¼•å¯¼ç¨‹åºä¸­è®¾ç½® `boot_single` å˜é‡æ¥æŒ‡å®šæ­¤æ¨¡å¼ã€‚ä¹Ÿå¯ä»¥é€šè¿‡åœ¨å¤šç”¨æˆ·æ¨¡å¼ä¸‹è¿è¡Œ `shutdown now` å‘½ä»¤æ¥è¿›å…¥æ­¤æ¨¡å¼ã€‚å•ç”¨æˆ·æ¨¡å¼ä»ä»¥ä¸‹æ¶ˆæ¯å¼€å§‹ï¼šÙ‘If the user presses kbd:[Enter], the system will enter the default Bourne shell.  To specify a different shell, input the full path to the shell.Ù‹å¦‚æœç”¨æˆ·æŒ‰ä¸‹ kbd:[Enter] é”®ï¼Œç³»ç»Ÿå°†è¿›å…¥é»˜è®¤çš„ Bourne shell ã€‚è¦æŒ‡å®šä¸åŒçš„ shellï¼Œè¯·è¾“å…¥ shell çš„å®Œæ•´è·¯å¾„ã€‚Ú~Single-user mode is usually used to repair a system that will not boot due to an inconsistent file system or an error in a boot configuration file.  It can also be used to reset the `root` password when it is unknown.  These actions are possible as the single-user mode prompt gives full, local access to the system and its configuration files.  There is no networking in this mode.ÚRå•ç”¨æˆ·æ¨¡å¼é€šå¸¸ç”¨äºä¿®å¤ç”±äºä¸ä¸€è‡´çš„æ–‡ä»¶ç³»ç»Ÿæˆ–å¼•å¯¼é…ç½®æ–‡ä»¶é”™è¯¯è€Œæ— æ³•å¯åŠ¨çš„ç³»ç»Ÿã€‚å®ƒè¿˜å¯ä»¥ç”¨äºåœ¨æœªçŸ¥æƒ…å†µä¸‹é‡ç½® `root` å¯†ç ã€‚ç”±äºå•ç”¨æˆ·æ¨¡å¼æç¤ºç¬¦æä¾›å¯¹ç³»ç»ŸåŠå…¶é…ç½®æ–‡ä»¶çš„å®Œå…¨æœ¬åœ°è®¿é—®æƒé™ï¼Œå› æ­¤å¯ä»¥æ‰§è¡Œè¿™äº›æ“ä½œã€‚åœ¨æ­¤æ¨¡å¼ä¸‹æ²¡æœ‰ç½‘ç»œè¿æ¥ã€‚ÚWhile single-user mode is useful for repairing a system, it poses a security risk unless the system is in a physically secure location.  By default, any user who can gain physical access to a system will have full control of that system after booting into single-user mode.Ùçå•ç”¨æˆ·æ¨¡å¼åœ¨ä¿®å¤ç³»ç»Ÿæ—¶éå¸¸æœ‰ç”¨ï¼Œä½†å¦‚æœç³»ç»Ÿä¸åœ¨ç‰©ç†å®‰å…¨çš„ä½ç½®ï¼Œå®ƒä¼šå¸¦æ¥å®‰å…¨é£é™©ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œä»»ä½•èƒ½å¤Ÿç‰©ç†è®¿é—®ç³»ç»Ÿçš„ç”¨æˆ·åœ¨è¿›å…¥å•ç”¨æˆ·æ¨¡å¼åå°†å®Œå…¨æ§åˆ¶è¯¥ç³»ç»Ÿã€‚ÚIf the system `console` is changed to `insecure` in [.filename]#/etc/ttys#, the system will first prompt for the `root` password before initiating single-user mode.  This adds a measure of security while removing the ability to reset the `root` password when it is unknown.Úå¦‚æœåœ¨ [.filename]#/etc/ttys# æ–‡ä»¶ä¸­å°†ç³»ç»Ÿçš„ `console` è®¾ç½®ä¸º `insecure`ï¼Œç³»ç»Ÿå°†åœ¨å¯åŠ¨å•ç”¨æˆ·æ¨¡å¼ä¹‹å‰é¦–å…ˆæç¤ºè¾“å…¥ `root` å¯†ç ã€‚è¿™æ ·åšå¯ä»¥å¢åŠ ä¸€å®šçš„å®‰å…¨æ€§ï¼Œä½†ä¹Ÿä¼šç§»é™¤åœ¨æœªçŸ¥æƒ…å†µä¸‹é‡ç½® `root` å¯†ç çš„èƒ½åŠ›ã€‚Ù9Configuring an Insecure Console in [.filename]#/etc/ttys#Ù?åœ¨ [.filename]#/etc/ttys# ä¸­é…ç½®ä¸€ä¸ªä¸å®‰å…¨çš„æ§åˆ¶å°Ù§An `insecure` console means that physical security to the console is considered to be insecure, so only someone who knows the `root` password may use single-user mode.Ù­ä¸€ä¸ª `ä¸å®‰å…¨ï¼ˆinsecureï¼‰` çš„æ§åˆ¶å°æ„å‘³ç€æ§åˆ¶å°çš„ç‰©ç†å®‰å…¨è¢«è®¤ä¸ºæ˜¯ä¸å®‰å…¨çš„ï¼Œå› æ­¤åªæœ‰çŸ¥é“ `root` å¯†ç çš„äººæ‰èƒ½ä½¿ç”¨å•ç”¨æˆ·æ¨¡å¼ã€‚¯Multi-User Mode¯å¤šç”¨æˆ·æ¨¡å¼ÙÿIf init finds the file systems to be in order, or once the user has finished their commands in single-user mode and has typed `exit` to leave single-user mode, the system enters multi-user mode, in which it starts the resource configuration of the system.ÙÈå¦‚æœ init å‘ç°æ–‡ä»¶ç³»ç»Ÿæ­£å¸¸ï¼Œæˆ–è€…ç”¨æˆ·åœ¨å•ç”¨æˆ·æ¨¡å¼ä¸‹å®Œæˆäº†ä»–ä»¬çš„å‘½ä»¤å¹¶è¾“å…¥ `exit` é€€å‡ºå•ç”¨æˆ·æ¨¡å¼ï¼Œç³»ç»Ÿå°†è¿›å…¥å¤šç”¨æˆ·æ¨¡å¼ï¼Œå¼€å§‹ç³»ç»Ÿçš„èµ„æºé…ç½®ã€‚ÚtThe resource configuration system reads in configuration defaults from [.filename]#/etc/defaults/rc.conf# and system-specific details from [.filename]#/etc/rc.conf#.  It then proceeds to mount the system file systems listed in [.filename]#/etc/fstab#.  It starts up networking services, miscellaneous system daemons, then the startup scripts of locally installed packages.ÚNèµ„æºé…ç½®ç³»ç»Ÿä» [.filename]#/etc/defaults/rc.conf# è¯»å–é…ç½®çš„é»˜è®¤å€¼ï¼Œå¹¶ä» [.filename]#/etc/rc.conf# è¯»å–ç³»ç»Ÿç‰¹å®šçš„è¯¦ç»†ä¿¡æ¯ã€‚ç„¶åï¼Œå®ƒä¼šæŒ‚è½½ [.filename]#/etc/fstab# ä¸­åˆ—å‡ºçš„ç³»ç»Ÿæ–‡ä»¶ç³»ç»Ÿã€‚å®ƒå¯åŠ¨ç½‘ç»œæœåŠ¡ã€æ‚é¡¹ç³»ç»Ÿå®ˆæŠ¤è¿›ç¨‹ï¼Œç„¶åå¯åŠ¨æœ¬åœ°å®‰è£…è½¯ä»¶åŒ…çš„å¯åŠ¨è„šæœ¬ã€‚Ù„To learn more about the resource configuration system, refer to man:rc[8] and examine the scripts located in [.filename]#/etc/rc.d#.Ù|è¦äº†è§£æ›´å¤šå…³äºèµ„æºé…ç½®ç³»ç»Ÿçš„ä¿¡æ¯ï¼Œè¯·å‚è€ƒ man:rc[8]ï¼Œå¹¶æ£€æŸ¥ä½äº [.filename]#/etc/rc.d# çš„è„šæœ¬ã€‚¬Device Hints¬è®¾å¤‡æç¤ºÚDuring initial system startup, the boot man:loader[8] reads man:device.hints[5].  This file stores kernel boot information known as variables, sometimes referred to as "device hints".  These "device hints" are used by device drivers for device configuration.Úåœ¨ç³»ç»Ÿåˆå§‹å¯åŠ¨æ—¶ï¼Œå¼•å¯¼ç®¡ç†ç¨‹åº boot man:loader[8] ä¼šè¯»å– man:device.hints[5] æ–‡ä»¶ã€‚è¯¥æ–‡ä»¶å­˜å‚¨äº†å†…æ ¸å¼•å¯¼ä¿¡æ¯ï¼Œä¹Ÿè¢«ç§°ä¸º â€œè®¾å¤‡æç¤ºï¼ˆdevice hintsï¼‰â€ã€‚è¿™äº› â€œè®¾å¤‡æç¤ºâ€ è¢«è®¾å¤‡é©±åŠ¨ç¨‹åºç”¨äºè®¾å¤‡é…ç½®ã€‚ÚhDevice hints may also be specified at the Stage 3 boot loader prompt, as demonstrated in <<boot-loader>>.  Variables can be added using `set`, removed with `unset`, and viewed `show`.  Variables set in [.filename]#/boot/device.hints# can also be overridden.  Device hints entered at the boot loader are not permanent and will not be applied on the next reboot.Úvè®¾å¤‡æç¤ºä¹Ÿå¯ä»¥åœ¨ç¬¬ä¸‰é˜¶æ®µçš„å¼•å¯¼åŠ è½½ç¨‹åºæç¤ºç¬¦ä¸­æŒ‡å®šï¼Œå¦‚ <<boot-loader>> ä¸­æ‰€ç¤ºã€‚å¯ä»¥ä½¿ç”¨ `set` æ·»åŠ å˜é‡ï¼Œä½¿ç”¨ `unset` åˆ é™¤å˜é‡ï¼Œå¹¶ä½¿ç”¨ `show` æŸ¥çœ‹å˜é‡ã€‚åœ¨ [.filename]#/boot/device.hints# ä¸­è®¾ç½®çš„å˜é‡ä¹Ÿå¯ä»¥è¢«è¦†ç›–ã€‚åœ¨å¼•å¯¼åŠ è½½ç¨‹åºä¸­è¾“å…¥çš„è®¾å¤‡æç¤ºä¸æ˜¯æ°¸ä¹…çš„ï¼Œä¸‹æ¬¡é‡å¯æ—¶ä¸ä¼šåº”ç”¨ã€‚ÙPOnce the system is booted, man:kenv[1] can be used to dump all of the variables.ÙOä¸€æ—¦ç³»ç»Ÿå¯åŠ¨ï¼Œå¯ä»¥ä½¿ç”¨ man:kenv[1] å‘½ä»¤æ¥è½¬å‚¨æ‰€æœ‰çš„å˜é‡ã€‚Ù’The syntax for [.filename]#/boot/device.hints# is one variable per line, using the hash "#" as comment markers.  Lines are constructed as follows:Ù€[.filename]#/boot/device.hints# çš„è¯­æ³•æ˜¯æ¯è¡Œä¸€ä¸ªå˜é‡ï¼Œä½¿ç”¨äº•å· â€œ#â€ ä½œä¸ºæ³¨é‡Šæ ‡è®°ã€‚è¡Œçš„æ„é€ å¦‚ä¸‹ï¼šÙ*The syntax for the Stage 3 boot loader is:Ù-ç¬¬ä¸‰é˜¶æ®µå¼•å¯¼åŠ è½½ç¨‹åºçš„è¯­æ³•æ˜¯ï¼šÙ¨where `driver` is the device driver name, `unit` is the device driver unit number, and `keyword` is the hint keyword.  The keyword may consist of the following options:ÙŸå…¶ä¸­ `driver` æ˜¯è®¾å¤‡é©±åŠ¨ç¨‹åºçš„åç§°ï¼Œ`unit` æ˜¯è®¾å¤‡é©±åŠ¨ç¨‹åºçš„å•å…ƒå·ï¼Œ`keyword` æ˜¯æç¤ºå…³é”®å­—ã€‚å…³é”®å­—å¯ä»¥åŒ…å«ä»¥ä¸‹é€‰é¡¹ï¼šÙ8`at`: specifies the bus which the device is attached to.Ù(`at`ï¼šæŒ‡å®šè®¾å¤‡æ‰€è¿æ¥çš„æ€»çº¿ã€‚Ù:`port`: specifies the start address of the I/O to be used.Ù2`port`ï¼šæŒ‡å®šè¦ä½¿ç”¨çš„ I/O çš„èµ·å§‹åœ°å€ã€‚Ù9`irq`: specifies the interrupt request number to be used.Ù,`irq`ï¼šæŒ‡å®šè¦ä½¿ç”¨çš„ä¸­æ–­è¯·æ±‚å·ã€‚Ù(`drq`: specifies the DMA channel number.¿`drq`ï¼šæŒ‡å®š DMA é€šé“å·ã€‚ÙF`maddr`: specifies the physical memory address occupied by the device.Ù4`maddr`ï¼šæŒ‡å®šè®¾å¤‡å ç”¨çš„ç‰©ç†å†…å­˜åœ°å€ã€‚Ù/`flags`: sets various flag bits for the device.Ù+`flags`ï¼šä¸ºè®¾å¤‡è®¾ç½®å„ç§æ ‡å¿—ä½ã€‚Ù1`disabled`: if set to `1` the device is disabled.Ù8`disabled`: å¦‚æœè®¾ç½®ä¸º `1` ï¼Œåˆ™è®¾å¤‡è¢«ç¦ç”¨ã€‚ÙŞSince device drivers may accept or require more hints not listed here, viewing a driver's manual page is recommended.  For more information, refer to man:device.hints[5], man:kenv[1], man:loader.conf[5], and man:loader[8].Ùäç”±äºè®¾å¤‡é©±åŠ¨ç¨‹åºå¯èƒ½æ¥å—æˆ–éœ€è¦æ›´å¤šæœªåœ¨æ­¤å¤„åˆ—å‡ºçš„æç¤ºï¼Œå»ºè®®æŸ¥çœ‹é©±åŠ¨ç¨‹åºçš„æ‰‹å†Œé¡µã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜… man:device.hints[5] ã€ man:kenv[1]ã€man:loader.conf[5] å’Œ man:loader[8]ã€‚±Shutdown Sequence¬å…³æœºåºåˆ—ÚUpon controlled shutdown using man:shutdown[8], man:init[8] will attempt to run the script [.filename]#/etc/rc.shutdown#, and then proceed to send all processes the `TERM` signal, and subsequently the `KILL` signal to any that do not terminate in a timely manner.Ùæåœ¨ä½¿ç”¨ man:shutdown[8] è¿›è¡Œæ§åˆ¶å…³é—­æ—¶ï¼Œ man:init[8] å°†å°è¯•è¿è¡Œè„šæœ¬ [.filename]#/etc/rc.shutdown# ï¼Œç„¶åç»§ç»­å‘æ‰€æœ‰è¿›ç¨‹å‘é€ `TERM` ä¿¡å·ï¼Œéšåå¯¹äºæœªèƒ½åŠæ—¶ç»ˆæ­¢çš„è¿›ç¨‹å‘é€ `KILL` ä¿¡å·ã€‚Ú’To power down a FreeBSD machine on architectures and systems that support power management, use `shutdown -p now` to turn the power off immediately.  To reboot a FreeBSD system, use `shutdown -r now`.  One must be `root` or a member of `operator` in order to run man:shutdown[8].  One can also use man:halt[8] and man:reboot[8].  Refer to their manual pages and to man:shutdown[8] for more information.Ú‰åœ¨æ”¯æŒç”µæºç®¡ç†çš„æ¶æ„å’Œç³»ç»Ÿä¸Šï¼Œè¦å…³é—­ FreeBSD æœºå™¨ï¼Œå¯ä»¥ä½¿ç”¨ `shutdown -p now` ç«‹å³å…³é—­ç”µæºã€‚è¦é‡æ–°å¯åŠ¨ FreeBSD ç³»ç»Ÿï¼Œå¯ä»¥ä½¿ç”¨ `shutdown -r now` ã€‚è¦è¿è¡Œ man:shutdown[8]ï¼Œå¿…é¡»æ˜¯ `root` ç”¨æˆ·æˆ– `operator` ç»„çš„æˆå‘˜ã€‚è¿˜å¯ä»¥ä½¿ç”¨ man:halt[8] å’Œ man:reboot[8]ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è€ƒå®ƒä»¬çš„æ‰‹å†Œé¡µé¢å’Œ man:shutdown[8]ã€‚ÙqModify group membership by referring to crossref:basics[users-synopsis,â€œUsers and Basic Account Managementâ€].Ùjé€šè¿‡å¼•ç”¨ crossref:basics[users-synopsis,â€œç”¨æˆ·å’ŒåŸºæœ¬è´¦æˆ·ç®¡ç†â€] æ¥ä¿®æ”¹ç»„æˆå‘˜èº«ä»½ã€‚ÙkPower management requires man:acpi[4] to be loaded as a module or statically compiled into a custom kernel.ÙXç”µæºç®¡ç†éœ€è¦å°† man:acpi[4] åŠ è½½ä¸ºæ¨¡å—æˆ–é™æ€ç¼–è¯‘åˆ°è‡ªå®šä¹‰å†…æ ¸ä¸­ã€‚Ù”This chapter focuses on the MAC framework and the set of pluggable security policy modules FreeBSD provides for enabling various security mechanismsÙzæœ¬ç« é‡ç‚¹ä»‹ç» MAC æ¡†æ¶ä»¥åŠ FreeBSD æä¾›çš„ä¸€ç»„å¯æ’æ‹”å®‰å…¨ç­–ç•¥æ¨¡å—ï¼Œç”¨äºå¯ç”¨å„ç§å®‰å…¨æœºåˆ¶ã€‚Ù$Chapter 18. Mandatory Access Control½ç¬¬ 18 ç«  å¼ºåˆ¶è®¿é—®æ§åˆ¶¸Mandatory Access Control²å¼ºåˆ¶è®¿é—®æ§åˆ¶Ú
FreeBSD supports security extensions based on the POSIX(R).1e draft.  These security mechanisms include file system Access Control Lists (crossref:security[fs-acl,â€œAccess Control Listsâ€]) and Mandatory Access Control (MAC).  MAC allows access control modules to be loaded in order to implement security policies.  Some modules provide protections for a narrow subset of the system, hardening a particular service.  Others provide comprehensive labeled security across all subjects and objects.  The mandatory part of the definition indicates that enforcement of controls is performed by administrators and the operating system.  This is in contrast to the default security mechanism of Discretionary Access Control (DAC) where enforcement is left to the discretion of users.ÚXFreeBSD æ”¯æŒåŸºäº POSIX(R).1e è‰æ¡ˆçš„å®‰å…¨æ‰©å±•ã€‚è¿™äº›å®‰å…¨æœºåˆ¶åŒ…æ‹¬æ–‡ä»¶ç³»ç»Ÿè®¿é—®æ§åˆ¶åˆ—è¡¨ï¼ˆcrossref:security[fs-acl,â€œè®¿é—®æ§åˆ¶åˆ—è¡¨â€]ï¼‰å’Œå¼ºåˆ¶è®¿é—®æ§åˆ¶ï¼ˆMACï¼‰ã€‚MAC å…è®¸åŠ è½½è®¿é—®æ§åˆ¶æ¨¡å—ä»¥å®æ–½å®‰å…¨ç­–ç•¥ã€‚ä¸€äº›æ¨¡å—ä¸ºç³»ç»Ÿçš„ä¸€å°éƒ¨åˆ†æä¾›ä¿æŠ¤ï¼ŒåŠ å›ºç‰¹å®šæœåŠ¡ã€‚å…¶ä»–æ¨¡å—æä¾›å…¨é¢çš„æ ‡è®°å®‰å…¨æ€§ï¼Œæ¶µç›–æ‰€æœ‰ä¸»ä½“å’Œå¯¹è±¡ã€‚å®šä¹‰ä¸­çš„å¼ºåˆ¶éƒ¨åˆ†è¡¨ç¤ºæ§åˆ¶çš„æ‰§è¡Œç”±ç®¡ç†å‘˜å’Œæ“ä½œç³»ç»Ÿæ‰§è¡Œã€‚è¿™ä¸é»˜è®¤çš„è‡ªä¸»è®¿é—®æ§åˆ¶ï¼ˆDACï¼‰å®‰å…¨æœºåˆ¶å½¢æˆå¯¹æ¯”ï¼Œåè€…å°†æ‰§è¡Œæƒç•™ç»™ç”¨æˆ·è‡ªè¡Œå†³å®šã€‚Ù•This chapter focuses on the MAC framework and the set of pluggable security policy modules FreeBSD provides for enabling various security mechanisms.Ùzæœ¬ç« é‡ç‚¹ä»‹ç» MAC æ¡†æ¶ä»¥åŠ FreeBSD æä¾›çš„ä¸€ç»„å¯æ’æ‹”å®‰å…¨ç­–ç•¥æ¨¡å—ï¼Œç”¨äºå¯ç”¨å„ç§å®‰å…¨æœºåˆ¶ã€‚Ù2The terminology associated with the MAC framework.Ù ä¸ MAC æ¡†æ¶ç›¸å…³çš„æœ¯è¯­ã€‚ÙsThe capabilities of MAC security policy modules as well as the difference between a labeled and non-labeled policy.ÙOMAC å®‰å…¨ç­–ç•¥æ¨¡å—çš„åŠŸèƒ½ä»¥åŠæ ‡è®°å’Œéæ ‡è®°ç­–ç•¥ä¹‹é—´çš„åŒºåˆ«ã€‚Ù]The considerations to take into account before configuring a system to use the MAC framework.Ù>åœ¨é…ç½®ç³»ç»Ÿä½¿ç”¨ MAC æ¡†æ¶ä¹‹å‰éœ€è¦è€ƒè™‘çš„å› ç´ ã€‚ÙTWhich MAC security policy modules are included in FreeBSD and how to configure them.ÙIFreeBSD ä¸­åŒ…å«å“ªäº› MAC å®‰å…¨ç­–ç•¥æ¨¡å—ä»¥åŠå¦‚ä½•é…ç½®å®ƒä»¬ã€‚ÙCHow to implement a more secure environment using the MAC framework.Ù2å¦‚ä½•ä½¿ç”¨ MAC æ¡†æ¶å®ç°æ›´å®‰å…¨çš„ç¯å¢ƒã€‚ÙXHow to test the MAC configuration to ensure the framework has been properly implemented.Ù;å¦‚ä½•æµ‹è¯• MAC é…ç½®ä»¥ç¡®ä¿æ¡†æ¶å·²ç»æ­£ç¡®å®æ–½ã€‚ÙOUnderstand UNIX(R) and FreeBSD basics (crossref:basics[basics,FreeBSD Basics]).ÙJäº†è§£ UNIX(R) å’Œ FreeBSD crossref:basics[basics,FreeBSD åŸºç¡€çŸ¥è¯†]ã€‚ÙjHave some familiarity with security and how it pertains to FreeBSD (crossref:security[security,Security]).Ùpå¯¹äºå®‰å…¨æ€§ä»¥åŠå®ƒä¸ FreeBSD çš„ç›¸å…³æ€§æœ‰ä¸€å®šçš„äº†è§£ï¼ˆcrossref:security[security,å®‰å…¨æ€§]ï¼‰ã€‚Ú€Improper MAC configuration may cause loss of system access, aggravation of users, or inability to access the features provided by Xorg.  More importantly, MAC should not be relied upon to completely secure a system.  The MAC framework only augments an existing security policy.  Without sound security practices and regular security checks, the system will never be completely secure.Ú>ä¸æ­£ç¡®çš„ MAC é…ç½®å¯èƒ½å¯¼è‡´ç³»ç»Ÿè®¿é—®ä¸¢å¤±ï¼Œç”¨æˆ·å—åˆ°å›°æ‰°ï¼Œæˆ–æ— æ³•è®¿é—® Xorg æä¾›çš„åŠŸèƒ½ã€‚æ›´é‡è¦çš„æ˜¯ï¼Œä¸èƒ½ä»…ä¾èµ– MAC æ¥å®Œå…¨ä¿æŠ¤ç³»ç»Ÿã€‚ MAC æ¡†æ¶åªæ˜¯å¢å¼ºç°æœ‰å®‰å…¨ç­–ç•¥ã€‚å¦‚æœæ²¡æœ‰å¥å…¨çš„å®‰å…¨å®è·µå’Œå®šæœŸçš„å®‰å…¨æ£€æŸ¥ï¼Œç³»ç»Ÿå°†æ°¸è¿œæ— æ³•å®Œå…¨å®‰å…¨ã€‚ÚThe examples contained within this chapter are for demonstration purposes and the example settings should _not_ be implemented on a production system.  Implementing any security policy takes a good deal of understanding, proper design, and thorough testing.Ù¯æœ¬ç« ä¸­åŒ…å«çš„ç¤ºä¾‹ä»…ç”¨äºæ¼”ç¤ºç›®çš„ï¼Œç¤ºä¾‹è®¾ç½® _ä¸åº”_ åœ¨ç”Ÿäº§ç³»ç»Ÿä¸Šå®æ–½ã€‚å®æ–½ä»»ä½•å®‰å…¨ç­–ç•¥éƒ½éœ€è¦å……åˆ†ç†è§£ã€æ­£ç¡®è®¾è®¡å’Œå½»åº•æµ‹è¯•ã€‚ÚâWhile this chapter covers a broad range of security issues relating to the MAC framework, the development of new MAC security policy modules will not be covered.  A number of security policy modules included with the MAC framework have specific characteristics which are provided for both testing and new module development.  Refer to man:mac_test[4], man:mac_stub[4] and man:mac_none[4] for more information on these security policy modules and the various mechanisms they provide.Úqå°½ç®¡æœ¬ç« æ¶µç›–äº†ä¸ MAC æ¡†æ¶ç›¸å…³çš„å¹¿æ³›å®‰å…¨é—®é¢˜ï¼Œä½†ä¸åŒ…æ‹¬å¼€å‘æ–°çš„ MAC å®‰å…¨ç­–ç•¥æ¨¡å—ã€‚ MAC æ¡†æ¶é™„å¸¦çš„ä¸€äº›å®‰å…¨ç­–ç•¥æ¨¡å—å…·æœ‰ç‰¹å®šç‰¹æ€§ï¼Œæ—¢ç”¨äºæµ‹è¯•ï¼Œä¹Ÿç”¨äºæ–°æ¨¡å—çš„å¼€å‘ã€‚æœ‰å…³è¿™äº›å®‰å…¨ç­–ç•¥æ¨¡å—åŠå…¶æä¾›çš„å„ç§æœºåˆ¶çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜… man:mac_test[4]ï¼Œman:mac_stub[4] å’Œ man:mac_none[4]ã€‚©Key Terms¬å…³é”®æœ¯è¯­ÙEThe following key terms are used when referring to the MAC framework:Ù5åœ¨æåˆ° MAC æ¡†æ¶æ—¶ï¼Œä½¿ç”¨ä»¥ä¸‹å…³é”®æœ¯è¯­ï¼šÚ=_compartment_: a set of programs and data to be partitioned or separated, where users are given explicit access to specific component of a system. A compartment represents a grouping, such as a work group, department, project, or topic. Compartments make it possible to implement a need-to-know-basis security policy.Ú_éš”ç¦»åŒºï¼ˆcompartmentï¼‰_ï¼šä¸€ç»„è¦è¿›è¡Œåˆ†åŒºæˆ–åˆ†ç¦»çš„ç¨‹åºå’Œæ•°æ®ï¼Œç”¨æˆ·è¢«æˆäºˆå¯¹ç³»ç»Ÿç‰¹å®šç»„ä»¶çš„æ˜ç¡®è®¿é—®æƒé™ã€‚éš”ç¦»åŒºè¡¨ç¤ºä¸€ç§åˆ†ç»„ï¼Œä¾‹å¦‚å·¥ä½œç»„ã€éƒ¨é—¨ã€é¡¹ç›®æˆ–ä¸»é¢˜ã€‚éš”ç¦»åŒºä½¿å¾—å®æ–½éœ€è¦çŸ¥é“çš„å®‰å…¨ç­–ç•¥æˆä¸ºå¯èƒ½ã€‚Ù_integrity_: the level of trust which can be placed on data. As the integrity of the data is elevated, so does the ability to trust that data.Ù’_å®Œæ•´æ€§ï¼ˆintegrityï¼‰_ï¼šå¯ä»¥å¯¹æ•°æ®æ”¾ç½®çš„ä¿¡ä»»çº§åˆ«ã€‚éšç€æ•°æ®çš„å®Œæ•´æ€§æé«˜ï¼Œå¯¹è¯¥æ•°æ®çš„ä¿¡ä»»èƒ½åŠ›ä¹Ÿéšä¹‹å¢å¼ºã€‚Ù‹_level_: the increased or decreased setting of a security attribute. As the level increases, its security is considered to elevate as well.Ùu_çº§åˆ«ï¼ˆlevelï¼‰_: å®‰å…¨å±æ€§çš„å¢åŠ æˆ–å‡å°‘è®¾ç½®ã€‚éšç€çº§åˆ«çš„æé«˜ï¼Œå…¶å®‰å…¨æ€§ä¹Ÿè¢«è®¤ä¸ºæå‡ã€‚Ú-_label_: a security attribute which can be applied to files, directories, or other items in the system. It could be considered a confidentiality stamp. When a label is placed on a file, it describes the security properties of that file and will only permit access by files, users, and resources with a similar security setting. The meaning and interpretation of label values depends on the policy configuration. Some policies treat a label as representing the integrity or secrecy of an object while other policies might use labels to hold rules for access.Úá_æ ‡ç­¾ï¼ˆlabelï¼‰_ï¼šä¸€ä¸ªå¯ä»¥åº”ç”¨äºç³»ç»Ÿä¸­çš„æ–‡ä»¶ã€ç›®å½•æˆ–å…¶ä»–é¡¹ç›®çš„å®‰å…¨å±æ€§ã€‚å®ƒå¯ä»¥è¢«è§†ä¸ºä¸€ä¸ªæœºå¯†æ€§æ ‡è®°ã€‚å½“ä¸€ä¸ªæ ‡ç­¾è¢«æ”¾ç½®åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸Šæ—¶ï¼Œå®ƒæè¿°äº†è¯¥æ–‡ä»¶çš„å®‰å…¨å±æ€§ï¼Œå¹¶ä¸”åªå…è®¸å…·æœ‰ç›¸ä¼¼å®‰å…¨è®¾ç½®çš„æ–‡ä»¶ã€ç”¨æˆ·å’Œèµ„æºè®¿é—®ã€‚æ ‡ç­¾å€¼çš„å«ä¹‰å’Œè§£é‡Šå–å†³äºç­–ç•¥é…ç½®ã€‚ä¸€äº›ç­–ç•¥å°†æ ‡ç­¾è§†ä¸ºè¡¨ç¤ºå¯¹è±¡çš„å®Œæ•´æ€§æˆ–ä¿å¯†æ€§ï¼Œè€Œå…¶ä»–ç­–ç•¥å¯èƒ½ä½¿ç”¨æ ‡ç­¾æ¥ä¿å­˜è®¿é—®è§„åˆ™ã€‚Ú__multilabel_: this property is a file system option which can be set in single-user mode using man:tunefs[8], during boot using man:fstab[5], or during the creation of a new file system. This option permits an administrator to apply different MAC labels on different objects. This option only applies to security policy modules which support labeling.ÚT_å¤šæ ‡ç­¾ï¼ˆmultilabelï¼‰_ï¼šè¿™ä¸ªå±æ€§æ˜¯ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿé€‰é¡¹ï¼Œå¯ä»¥åœ¨å•ç”¨æˆ·æ¨¡å¼ä¸‹ä½¿ç”¨ man:tunefs[8] è®¾ç½®ï¼Œåœ¨å¯åŠ¨æ—¶ä½¿ç”¨ man:fstab[5] è®¾ç½®ï¼Œæˆ–åœ¨åˆ›å»ºæ–°æ–‡ä»¶ç³»ç»Ÿæ—¶è®¾ç½®ã€‚æ­¤é€‰é¡¹å…è®¸ç®¡ç†å‘˜åœ¨ä¸åŒçš„å¯¹è±¡ä¸Šåº”ç”¨ä¸åŒçš„ MAC æ ‡ç­¾ã€‚æ­¤é€‰é¡¹ä»…é€‚ç”¨äºæ”¯æŒæ ‡ç­¾çš„å®‰å…¨ç­–ç•¥æ¨¡å—ã€‚ÙÉ_single label_: a policy where the entire file system uses one label to enforce access control over the flow of data. Whenever `multilabel` is not set, all files will conform to the same label setting.ÙË_å•æ ‡ç­¾ï¼ˆsingle labelï¼‰_ï¼šä¸€ç§ç­–ç•¥ï¼Œæ•´ä¸ªæ–‡ä»¶ç³»ç»Ÿä½¿ç”¨ä¸€ä¸ªæ ‡ç­¾æ¥å¼ºåˆ¶å¯¹æ•°æ®æµè¿›è¡Œè®¿é—®æ§åˆ¶ã€‚åªè¦æœªè®¾ç½® `å¤šæ ‡ç­¾`ï¼Œæ‰€æœ‰æ–‡ä»¶éƒ½å°†ç¬¦åˆç›¸åŒçš„æ ‡ç­¾è®¾ç½®ã€‚ÚR_object_: an entity through which information flows under the direction of a _subject_. This includes directories, files, fields, screens, keyboards, memory, magnetic storage, printers or any other data storage or moving device. An object is a data container or a system resource. Access to an object effectively means access to its data.Ú,_å¯¹è±¡ï¼ˆobjectï¼‰_ï¼šåœ¨ _ä¸»ä½“_ çš„æŒ‡å¯¼ä¸‹ï¼Œä¿¡æ¯æµç»è¿‡çš„å®ä½“ã€‚è¿™åŒ…æ‹¬ç›®å½•ã€æ–‡ä»¶ã€å­—æ®µã€å±å¹•ã€é”®ç›˜ã€å†…å­˜ã€ç£å­˜å‚¨ã€æ‰“å°æœºæˆ–ä»»ä½•å…¶ä»–æ•°æ®å­˜å‚¨æˆ–ç§»åŠ¨è®¾å¤‡ã€‚å¯¹è±¡æ˜¯ä¸€ä¸ªæ•°æ®å®¹å™¨æˆ–ç³»ç»Ÿèµ„æºã€‚è®¿é—®å¯¹è±¡å®é™…ä¸Šæ„å‘³ç€è®¿é—®å…¶æ•°æ®ã€‚ÙÓ_subject_: any active entity that causes information to flow between _objects_ such as a user, user process, or system process. On FreeBSD, this is almost always a thread acting in a process on behalf of a user.ÙÈ_ä¸»ä½“ï¼ˆsubjectï¼‰_: ä»»ä½•èƒ½å¤Ÿåœ¨å¯¹è±¡ä¹‹é—´ä¼ é€’ä¿¡æ¯çš„æ´»åŠ¨å®ä½“ï¼Œä¾‹å¦‚ç”¨æˆ·ã€ç”¨æˆ·è¿›ç¨‹æˆ–ç³»ç»Ÿè¿›ç¨‹ã€‚åœ¨ FreeBSD ä¸Šï¼Œè¿™å‡ ä¹æ€»æ˜¯ä¸€ä¸ªä»£è¡¨ç”¨æˆ·çš„è¿›ç¨‹ä¸­çš„çº¿ç¨‹ã€‚Ú5_policy_: a collection of rules which defines how objectives are to be achieved. A policy usually documents how certain items are to be handled. This chapter considers a policy to be a collection of rules which controls the flow of data and information and defines who has access to that data and information.Ùò_ç­–ç•¥ï¼ˆpolicyï¼‰_ï¼šä¸€ç³»åˆ—è§„åˆ™çš„é›†åˆï¼Œå®šä¹‰äº†å¦‚ä½•å®ç°ç›®æ ‡ã€‚ç­–ç•¥é€šå¸¸è®°å½•äº†å¦‚ä½•å¤„ç†ç‰¹å®šäº‹é¡¹ã€‚æœ¬ç« å°†ç­–ç•¥è§†ä¸ºä¸€ç³»åˆ—æ§åˆ¶æ•°æ®å’Œä¿¡æ¯æµåŠ¨å¹¶å®šä¹‰è°å¯ä»¥è®¿é—®è¿™äº›æ•°æ®å’Œä¿¡æ¯çš„è§„åˆ™ã€‚Ú_high-watermark_: this type of policy permits the raising of security levels for the purpose of accessing higher level information. In most cases, the original level is restored after the process is complete. Currently, the FreeBSD MAC framework does not include this type of policy.Ùå_é«˜æ°´ä½çº¿ï¼ˆhigh-watermarkï¼‰_ï¼šè¿™ç§ç­–ç•¥å…è®¸æé«˜å®‰å…¨çº§åˆ«ä»¥è®¿é—®æ›´é«˜çº§åˆ«çš„ä¿¡æ¯ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå®Œæˆè¿›ç¨‹åä¼šæ¢å¤åŸå§‹çº§åˆ«ã€‚ç›®å‰ï¼ŒFreeBSD MAC æ¡†æ¶ä¸åŒ…æ‹¬è¿™ç§ç±»å‹çš„ç­–ç•¥ã€‚Ú2_low-watermark_: this type of policy permits lowering security levels for the purpose of accessing information which is less secure. In most cases, the original security level of the user is restored after the process is complete. The only security policy module in FreeBSD to use this is man:mac_lomac[4].Ú_ä½æ°´ä½çº¿ï¼ˆlow-watermarkï¼‰_ï¼šè¿™ç§ç±»å‹çš„ç­–ç•¥å…è®¸é™ä½å®‰å…¨çº§åˆ«ä»¥è®¿é—®è¾ƒä¸å®‰å…¨çš„ä¿¡æ¯ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå®Œæˆè¿‡ç¨‹åï¼Œç”¨æˆ·çš„åŸå§‹å®‰å…¨çº§åˆ«å°†æ¢å¤ã€‚åœ¨ FreeBSD ä¸­ï¼Œå”¯ä¸€ä½¿ç”¨æ­¤ç­–ç•¥çš„å®‰å…¨ç­–ç•¥æ¨¡å—æ˜¯ man:mac_lomac[4]ã€‚Ùü_sensitivity_: usually used when discussing Multilevel Security (MLS). A sensitivity level describes how important or secret the data should be. As the sensitivity level increases, so does the importance of the secrecy, or confidentiality, of the data.Ùâ_æ•æ„Ÿæ€§ï¼ˆsensitivityï¼‰_ï¼šé€šå¸¸åœ¨è®¨è®ºå¤šçº§å®‰å…¨æ€§ï¼ˆMLSï¼‰æ—¶ä½¿ç”¨ã€‚æ•æ„Ÿæ€§çº§åˆ«æè¿°äº†æ•°æ®çš„é‡è¦æ€§æˆ–æœºå¯†æ€§ã€‚éšç€æ•æ„Ÿæ€§çº§åˆ«çš„æé«˜ï¼Œæ•°æ®çš„ä¿å¯†æ€§æˆ–æœºå¯†æ€§çš„é‡è¦æ€§ä¹Ÿå¢åŠ ã€‚¸Understanding MAC Labels±ç†è§£ MAC æ ‡ç­¾Ú€A MAC label is a security attribute which may be applied to subjects and objects throughout the system.  When setting a label, the administrator must understand its implications in order to prevent unexpected or undesired behavior of the system.  The attributes available on an object depend on the loaded policy module, as policy modules interpret their attributes in different ways.Ú'MAC æ ‡ç­¾æ˜¯ä¸€ç§å®‰å…¨å±æ€§ï¼Œå¯ä»¥åº”ç”¨äºç³»ç»Ÿä¸­çš„ä¸»ä½“å’Œå¯¹è±¡ã€‚åœ¨è®¾ç½®æ ‡ç­¾æ—¶ï¼Œç®¡ç†å‘˜å¿…é¡»ç†è§£å…¶å½±å“ï¼Œä»¥é˜²æ­¢ç³»ç»Ÿå‡ºç°æ„å¤–æˆ–ä¸å¸Œæœ›çš„è¡Œä¸ºã€‚å¯¹è±¡ä¸Šå¯ç”¨çš„å±æ€§å–å†³äºåŠ è½½çš„ç­–ç•¥æ¨¡å—ï¼Œå› ä¸ºç­–ç•¥æ¨¡å—ä»¥ä¸åŒçš„æ–¹å¼è§£é‡Šå…¶å±æ€§ã€‚ÚThe security label on an object is used as a part of a security access control decision by a policy.  With some policies, the label contains all of the information necessary to make a decision.  In other policies, the labels may be processed as part of a larger rule set.Ùçå¯¹è±¡ä¸Šçš„å®‰å…¨æ ‡ç­¾æ˜¯å®‰å…¨è®¿é—®æ§åˆ¶å†³ç­–ä¸­çš„ä¸€éƒ¨åˆ†ã€‚åœ¨æŸäº›ç­–ç•¥ä¸­ï¼Œæ ‡ç­¾åŒ…å«äº†åšå‡ºå†³ç­–æ‰€éœ€çš„æ‰€æœ‰ä¿¡æ¯ã€‚åœ¨å…¶ä»–ç­–ç•¥ä¸­ï¼Œæ ‡ç­¾å¯èƒ½ä½œä¸ºä¸€ä¸ªæ›´å¤§çš„è§„åˆ™é›†çš„ä¸€éƒ¨åˆ†è¿›è¡Œå¤„ç†ã€‚ÚThere are two types of label policies: single label and multi label.  By default, the system will use single label.  The administrator should be aware of the pros and cons of each in order to implement policies which meet the requirements of the system's security model.ÙÌæœ‰ä¸¤ç§ç±»å‹çš„æ ‡ç­¾ç­–ç•¥ï¼šå•æ ‡ç­¾å’Œå¤šæ ‡ç­¾ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œç³»ç»Ÿå°†ä½¿ç”¨å•æ ‡ç­¾ã€‚ç®¡ç†å‘˜åº”è¯¥äº†è§£æ¯ç§ç±»å‹çš„ä¼˜ç¼ºç‚¹ï¼Œä»¥ä¾¿å®æ–½ç¬¦åˆç³»ç»Ÿå®‰å…¨æ¨¡å‹è¦æ±‚çš„ç­–ç•¥ã€‚Ú{A single label security policy only permits one label to be used for every subject or object.  Since a single label policy enforces one set of access permissions across the entire system, it provides lower administration overhead, but decreases the flexibility of policies which support labeling.  However, in many environments, a single label policy may be all that is required.Ú5å•æ ‡ç­¾å®‰å…¨ç­–ç•¥åªå…è®¸æ¯ä¸ªä¸»ä½“æˆ–å¯¹è±¡ä½¿ç”¨ä¸€ä¸ªæ ‡ç­¾ã€‚ç”±äºå•æ ‡ç­¾ç­–ç•¥åœ¨æ•´ä¸ªç³»ç»Ÿä¸Šå¼ºåˆ¶æ‰§è¡Œä¸€ç»„è®¿é—®æƒé™ï¼Œå› æ­¤å®ƒæä¾›äº†è¾ƒä½çš„ç®¡ç†å¼€é”€ï¼Œä½†é™ä½äº†æ”¯æŒæ ‡è®°çš„ç­–ç•¥çš„çµæ´»æ€§ã€‚ç„¶è€Œï¼Œåœ¨è®¸å¤šç¯å¢ƒä¸­ï¼Œå•æ ‡ç­¾ç­–ç•¥å¯èƒ½å°±æ˜¯æ‰€éœ€çš„å…¨éƒ¨ã€‚ÚbA single label policy is somewhat similar to DAC as `root` configures the policies so that users are placed in the appropriate categories and access levels.  A notable difference is that many policy modules can also restrict `root`.  Basic control over objects will then be released to the group, but `root` may revoke or modify the settings at any time.Ú,å•æ ‡ç­¾ç­–ç•¥åœ¨æŸç§ç¨‹åº¦ä¸Šç±»ä¼¼äº DACï¼Œå› ä¸º `root` é…ç½®ç­–ç•¥ä»¥ä¾¿å°†ç”¨æˆ·æ”¾ç½®åœ¨é€‚å½“çš„ç±»åˆ«å’Œè®¿é—®çº§åˆ«ä¸­ã€‚ä¸€ä¸ªæ˜¾è‘—çš„åŒºåˆ«æ˜¯è®¸å¤šç­–ç•¥æ¨¡å—ä¹Ÿå¯ä»¥é™åˆ¶ `root`ã€‚ç„¶åï¼Œå¯¹å¯¹è±¡çš„åŸºæœ¬æ§åˆ¶å°†é‡Šæ”¾ç»™ç»„ï¼Œä½† `root` å¯ä»¥éšæ—¶æ’¤é”€æˆ–ä¿®æ”¹è®¾ç½®ã€‚ÚËWhen appropriate, a multi label policy can be set on a UFS file system by passing `multilabel` to man:tunefs[8].  A multi label policy permits each subject or object to have its own independent MAC label.  The decision to use a multi label or single label policy is only required for policies which implement the labeling feature, such as `biba`, `lomac`, and `mls`.  Some policies, such as `seeotheruids`, `portacl` and `partition`, do not use labels at all.Ú¬åœ¨é€‚å½“çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥é€šè¿‡å°† `multilabel` ä¼ é€’ç»™ `tunefs[8]` åœ¨ UFS æ–‡ä»¶ç³»ç»Ÿä¸Šè®¾ç½®å¤šæ ‡ç­¾ç­–ç•¥ã€‚å¤šæ ‡ç­¾ç­–ç•¥å…è®¸æ¯ä¸ªä¸»ä½“æˆ–å¯¹è±¡æ‹¥æœ‰è‡ªå·±ç‹¬ç«‹çš„ MAC æ ‡ç­¾ã€‚å¯¹äºå®ç°æ ‡ç­¾åŠŸèƒ½çš„ç­–ç•¥ï¼ˆå¦‚ `biba`ã€`lomac` å’Œ `mls`ï¼‰ï¼Œåªæœ‰åœ¨ä½¿ç”¨å¤šæ ‡ç­¾æˆ–å•æ ‡ç­¾ç­–ç•¥æ—¶æ‰éœ€è¦åšå‡ºå†³ç­–ã€‚ä¸€äº›ç­–ç•¥ï¼Œå¦‚ `seeotheruids`ã€`portacl` å’Œ `partition ï¼Œæ ¹æœ¬ä¸ä½¿ç”¨æ ‡ç­¾ã€‚ÙåUsing a multi label policy on a partition and establishing a multi label security model can increase administrative overhead as everything in that file system has a label.  This includes directories, files, and even device nodes.Ùºåœ¨åˆ†åŒºä¸Šä½¿ç”¨å¤šæ ‡ç­¾ç­–ç•¥å¹¶å»ºç«‹å¤šæ ‡ç­¾å®‰å…¨æ¨¡å‹å¯èƒ½ä¼šå¢åŠ ç®¡ç†å¼€é”€ï¼Œå› ä¸ºæ–‡ä»¶ç³»ç»Ÿä¸­çš„æ‰€æœ‰å†…å®¹éƒ½æœ‰æ ‡ç­¾ï¼ŒåŒ…æ‹¬ç›®å½•ã€æ–‡ä»¶ç”šè‡³è®¾å¤‡èŠ‚ç‚¹ã€‚Ù«The following command will set `multilabel` on the specified UFS file system.  This may only be done in single-user mode and is not a requirement for the swap file system:Ù¥ä»¥ä¸‹å‘½ä»¤å°†åœ¨æŒ‡å®šçš„ UFS æ–‡ä»¶ç³»ç»Ÿä¸Šè®¾ç½® `multilabel`ã€‚è¿™åªèƒ½åœ¨å•ç”¨æˆ·æ¨¡å¼ä¸‹æ‰§è¡Œï¼Œå¹¶ä¸”å¯¹äºäº¤æ¢æ–‡ä»¶ç³»ç»Ÿæ¥è¯´å¹¶ä¸æ˜¯å¿…éœ€çš„ã€‚Ù˜Some users have experienced problems with setting the `multilabel` flag on the root partition.  If this is the case, please review <<mac-troubleshoot>>.Ùä¸€äº›ç”¨æˆ·åœ¨è®¾ç½®æ ¹åˆ†åŒºçš„ `multilabel` æ ‡å¿—æ—¶é‡åˆ°äº†é—®é¢˜ã€‚å¦‚æœæ˜¯è¿™ç§æƒ…å†µï¼Œè¯·å‚è€ƒ <<mac-troubleshoot>> è¿›è¡Œæ’æŸ¥ã€‚ÚáSince the multi label policy is set on a per-file system basis, a multi label policy may not be needed if the file system layout is well designed.  Consider an example security MAC model for a FreeBSD web server.  This machine uses the single label, `biba/high`, for everything in the default file systems.  If the web server needs to run at `biba/low` to prevent write up capabilities, it could be installed to a separate UFS [.filename]#/usr/local# file system set at `biba/low`.Ú¼ç”±äºå¤šæ ‡ç­¾ç­–ç•¥æ˜¯åŸºäºæ¯ä¸ªæ–‡ä»¶ç³»ç»Ÿçš„è®¾ç½®ï¼Œå¦‚æœæ–‡ä»¶ç³»ç»Ÿå¸ƒå±€è®¾è®¡è‰¯å¥½ï¼Œåˆ™å¯èƒ½ä¸éœ€è¦å¤šæ ‡ç­¾ç­–ç•¥ã€‚ä»¥ FreeBSD Web æœåŠ¡å™¨ä¸ºä¾‹ï¼Œè€ƒè™‘ä¸€ä¸ªå®‰å…¨çš„ MAC æ¨¡å‹ã€‚è¯¥æœºå™¨åœ¨é»˜è®¤æ–‡ä»¶ç³»ç»Ÿä¸­ä½¿ç”¨å•ä¸ªæ ‡ç­¾ `biba/high`ã€‚å¦‚æœ Web æœåŠ¡å™¨éœ€è¦ä»¥ `biba/low` è¿è¡Œä»¥é˜²æ­¢å†™å…¥æƒé™ï¼Œå¯ä»¥å°†å…¶å®‰è£…åˆ°ä¸€ä¸ªå•ç‹¬çš„ UFS [.filename]#/usr/local# æ–‡ä»¶ç³»ç»Ÿï¼Œè®¾ç½®ä¸º `biba/low`ã€‚³Label Configuration¬æ ‡ç­¾é…ç½®Ù÷Virtually all aspects of label policy module configuration will be performed using the base system utilities.  These commands provide a simple interface for object or subject configuration or the manipulation and verification of the configuration.ÙÏå‡ ä¹æ‰€æœ‰æ ‡ç­¾ç­–ç•¥æ¨¡å—é…ç½®çš„æ–¹é¢éƒ½å¯ä»¥ä½¿ç”¨åŸºæœ¬ç³»ç»Ÿå·¥å…·æ¥å®Œæˆã€‚è¿™äº›å‘½ä»¤æä¾›äº†ä¸€ä¸ªç®€å•çš„ç•Œé¢ï¼Œç”¨äºå¯¹è±¡æˆ–ä¸»ä½“çš„é…ç½®ï¼Œæˆ–è€…ç”¨äºé…ç½®çš„æ“ä½œå’ŒéªŒè¯ã€‚ÙîAll configuration may be done using `setfmac`, which is used to set MAC labels on system objects, and `setpmac`, which is used to set the labels on system subjects.  For example, to set the `biba` MAC label to `high` on [.filename]#test#:Ú	æ‰€æœ‰çš„é…ç½®éƒ½å¯ä»¥ä½¿ç”¨ `setfmac` æ¥å®Œæˆï¼Œ `setfmac` ç”¨äºåœ¨ç³»ç»Ÿå¯¹è±¡ä¸Šè®¾ç½® MAC æ ‡ç­¾ï¼Œè€Œ `setpmac` ç”¨äºåœ¨ç³»ç»Ÿä¸»ä½“ä¸Šè®¾ç½®æ ‡ç­¾ã€‚ä¾‹å¦‚ï¼Œè¦åœ¨ [.filename]#test# ä¸Šå°† `biba` MAC æ ‡ç­¾è®¾ç½®ä¸º `high`ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼šÚ5If the configuration is successful, the prompt will be returned without error.  A common error is `Permission denied` which usually occurs when the label is being set or modified on a restricted object.  Other conditions may produce different failures.  For instance, the file may not be owned by the user attempting to relabel the object, the object may not exist, or the object may be read-only.  A mandatory policy will not allow the process to relabel the file, maybe because of a property of the file, a property of the process, or a property of the proposed new label value.  For example, if a user running at low integrity tries to change the label of a high integrity file, or a user running at low integrity tries to change the label of a low integrity file to a high integrity label, these operations will fail.Úœå¦‚æœé…ç½®æˆåŠŸï¼Œå°†è¿”å›æ— é”™è¯¯çš„æç¤ºã€‚å¸¸è§çš„é”™è¯¯æ˜¯ `Permission denied`ï¼Œé€šå¸¸å‘ç”Ÿåœ¨å¯¹å—é™å¯¹è±¡è®¾ç½®æˆ–ä¿®æ”¹æ ‡ç­¾æ—¶ã€‚å…¶ä»–æƒ…å†µå¯èƒ½å¯¼è‡´ä¸åŒçš„å¤±è´¥ã€‚ä¾‹å¦‚ï¼Œæ–‡ä»¶å¯èƒ½ä¸æ˜¯å°è¯•é‡æ–°æ ‡è®°å¯¹è±¡çš„ç”¨æˆ·æ‹¥æœ‰çš„ï¼Œå¯¹è±¡å¯èƒ½ä¸å­˜åœ¨ï¼Œæˆ–è€…å¯¹è±¡å¯èƒ½æ˜¯åªè¯»çš„ã€‚å¼ºåˆ¶ç­–ç•¥å°†ä¸å…è®¸è¿›ç¨‹é‡æ–°æ ‡è®°æ–‡ä»¶ï¼Œå¯èƒ½æ˜¯å› ä¸ºæ–‡ä»¶çš„å±æ€§ã€è¿›ç¨‹çš„å±æ€§æˆ–å»ºè®®çš„æ–°æ ‡ç­¾å€¼çš„å±æ€§ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä»¥ä½å®Œæ•´æ€§è¿è¡Œçš„ç”¨æˆ·å°è¯•æ›´æ”¹é«˜å®Œæ•´æ€§æ–‡ä»¶çš„æ ‡ç­¾ï¼Œæˆ–è€…ä»¥ä½å®Œæ•´æ€§è¿è¡Œçš„ç”¨æˆ·å°è¯•å°†ä½å®Œæ•´æ€§æ–‡ä»¶çš„æ ‡ç­¾æ›´æ”¹ä¸ºé«˜å®Œæ•´æ€§æ ‡ç­¾ï¼Œè¿™äº›æ“ä½œå°†å¤±è´¥ã€‚ÙŠThe system administrator may use `setpmac` to override the policy module's settings by assigning a different label to the invoked process:Ùzç³»ç»Ÿç®¡ç†å‘˜å¯ä»¥ä½¿ç”¨ `setpmac` å‘½ä»¤é€šè¿‡ä¸ºè°ƒç”¨çš„è¿›ç¨‹åˆ†é…ä¸åŒçš„æ ‡ç­¾æ¥è¦†ç›–ç­–ç•¥æ¨¡å—çš„è®¾ç½®ï¼šÚ>For currently running processes, such as sendmail, `getpmac` is usually used instead.  This command takes a process ID (PID) in place of a command name.  If users attempt to manipulate a file not in their access, subject to the rules of the loaded policy modules, the `Operation not permitted` error will be displayed.Ú;å¯¹äºå½“å‰æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹ï¼Œä¾‹å¦‚ sendmail ï¼Œé€šå¸¸ä½¿ç”¨ `getpmac` å‘½ä»¤ã€‚è¯¥å‘½ä»¤ä½¿ç”¨è¿›ç¨‹ IDï¼ˆPIDï¼‰ä»£æ›¿å‘½ä»¤åç§°ã€‚å¦‚æœç”¨æˆ·å°è¯•æ“ä½œä¸åœ¨å…¶è®¿é—®æƒé™èŒƒå›´å†…çš„æ–‡ä»¶ï¼Œæ ¹æ®åŠ è½½çš„ç­–ç•¥æ¨¡å—çš„è§„åˆ™ï¼Œå°†æ˜¾ç¤º `æ“ä½œä¸å…è®¸ï¼ˆOperation not permittedï¼‰` çš„é”™è¯¯ã€‚±Predefined Labels¯é¢„å®šä¹‰æ ‡ç­¾ÙA few FreeBSD policy modules which support the labeling feature offer three predefined labels: `low`, `equal`, and `high`, where:Ùwä¸€äº›æ”¯æŒæ ‡ç­¾åŠŸèƒ½çš„ FreeBSD ç­–ç•¥æ¨¡å—æä¾›äº†ä¸‰ä¸ªé¢„å®šä¹‰æ ‡ç­¾ï¼š`low`ã€`equal` å’Œ `high`ï¼Œå…¶ä¸­ï¼šÙ§`low` is considered the lowest label setting an object or subject may have. Setting this on objects or subjects blocks their access to objects or subjects marked high.ÙŸ`low` è¢«è®¤ä¸ºæ˜¯å¯¹è±¡æˆ–ä¸»ä½“å¯èƒ½å…·æœ‰çš„æœ€ä½æ ‡ç­¾è®¾ç½®ã€‚å°†å…¶è®¾ç½®åœ¨å¯¹è±¡æˆ–ä¸»ä½“ä¸Šä¼šé˜»æ­¢å®ƒä»¬è®¿é—®è¢«æ ‡è®°ä¸ºé«˜çš„å¯¹è±¡æˆ–ä¸»ä½“ã€‚Ù`equal` sets the subject or object to be disabled or unaffected and should only be placed on objects considered to be exempt from the policy.Ùt`equal` å°†ä¸»é¢˜æˆ–å¯¹è±¡è®¾ç½®ä¸ºç¦ç”¨æˆ–ä¸å—å½±å“ï¼Œå¹¶ä¸”åªåº”æ”¾ç½®åœ¨è¢«è§†ä¸ºè±å…æ”¿ç­–çš„å¯¹è±¡ä¸Šã€‚Ùd`high` grants an object or subject the highest setting available in the Biba and MLS policy modules.ÙQ`high` åœ¨ Biba å’Œ MLS ç­–ç•¥æ¨¡å—ä¸­ä¸ºå¯¹è±¡æˆ–ä¸»ä½“æˆäºˆæœ€é«˜çš„è®¾ç½®ã€‚Ú	Such policy modules include man:mac_biba[4], man:mac_mls[4] and man:mac_lomac[4].  Each of the predefined labels establishes a different information flow directive.  Refer to the manual page of the module to determine the traits of the generic label configurations.ÙÒè¿™äº›ç­–ç•¥æ¨¡å—åŒ…æ‹¬ man:mac_biba[4]ã€man:mac_mls[4] å’Œ man:mac_lomac[4]ã€‚æ¯ä¸ªé¢„å®šä¹‰æ ‡ç­¾éƒ½å»ºç«‹äº†ä¸åŒçš„ä¿¡æ¯æµæŒ‡ä»¤ã€‚è¯·å‚è€ƒæ¨¡å—çš„æ‰‹å†Œé¡µé¢ä»¥ç¡®å®šé€šç”¨æ ‡ç­¾é…ç½®çš„ç‰¹æ€§ã€‚®Numeric Labels¬æ•°å­—æ ‡ç­¾Ú1The Biba and MLS policy modules support a numeric label which may be set to indicate the precise level of hierarchical control.  This numeric level is used to partition or sort information into different groups of classification, only permitting access to that group or a higher group level.  For example:ÙèBiba å’Œ MLS ç­–ç•¥æ¨¡å—æ”¯æŒä¸€ä¸ªæ•°å­—æ ‡ç­¾ï¼Œå¯ä»¥è®¾ç½®ä¸ºæŒ‡ç¤ºç²¾ç¡®çš„å±‚æ¬¡æ§åˆ¶çº§åˆ«ã€‚è¿™ä¸ªæ•°å­—çº§åˆ«ç”¨äºå°†ä¿¡æ¯åˆ†åŒºæˆ–åˆ†ç±»åˆ°ä¸åŒçš„åˆ†ç±»ç»„ä¸­ï¼Œåªå…è®¸è®¿é—®è¯¥ç»„æˆ–æ›´é«˜çº§åˆ«çš„ç»„ã€‚ä¾‹å¦‚ï¼šÙYmay be interpreted as "Biba Policy Label/Grade 10:Compartments 2, 3 and 6: (grade 5 ...")Ù\å¯ä»¥è§£é‡Šä¸º â€œBiba ç­–ç•¥æ ‡ç­¾/ç­‰çº§ 10ï¼šéš”é—´ 2ï¼Œ3 å’Œ 6ï¼šï¼ˆç­‰çº§ 5 ... ï¼‰â€Ú%In this example, the first grade would be considered the effective grade with effective compartments, the second grade is the low grade, and the last one is the high grade.  In most configurations, such fine-grained settings are not needed as they are considered to be advanced configurations.Ùğåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œç¬¬ä¸€ç­‰çº§è¢«è®¤ä¸ºæ˜¯å…·æœ‰æœ‰æ•ˆéš”é—´çš„æœ‰æ•ˆç­‰çº§ï¼Œç¬¬äºŒç­‰çº§æ˜¯ä½ç­‰çº§ï¼Œæœ€åä¸€ä¸ªæ˜¯é«˜ç­‰çº§ã€‚åœ¨å¤§å¤šæ•°é…ç½®ä¸­ï¼Œè¿™æ ·ç»†ç²’åº¦çš„è®¾ç½®æ˜¯ä¸éœ€è¦çš„ï¼Œå› ä¸ºå®ƒä»¬è¢«è®¤ä¸ºæ˜¯é«˜çº§é…ç½®ã€‚Ù¿System objects only have a current grade and compartment.  System subjects reflect the range of available rights in the system, and network interfaces, where they are used for access control.Ùç³»ç»Ÿå¯¹è±¡åªæœ‰å½“å‰ç­‰çº§å’Œéš”é—´ã€‚ç³»ç»Ÿä¸»ä½“åæ˜ äº†ç³»ç»Ÿä¸­å¯ç”¨æƒé™çš„èŒƒå›´ï¼Œä»¥åŠç½‘ç»œæ¥å£ï¼Œå®ƒä»¬ç”¨äºè®¿é—®æ§åˆ¶ã€‚ÚmThe grade and compartments in a subject and object pair are used to construct a relationship known as _dominance_, in which a subject dominates an object, the object dominates the subject, neither dominates the other, or both dominate each other.  The "both dominate" case occurs when the two labels are equal.  Due to the information flow nature of Biba, a user has rights to a set of compartments that might correspond to projects, but objects also have a set of compartments.  Users may have to subset their rights using `su` or `setpmac` in order to access objects in a compartment from which they are not restricted.Ú	åœ¨ä¸€ä¸ªä¸»ä½“å’Œå¯¹è±¡å¯¹ä¸­ï¼Œç­‰çº§å’Œéš”é—´è¢«ç”¨æ¥æ„å»ºä¸€ç§è¢«ç§°ä¸ºâ€œä¼˜åŠ¿â€çš„å…³ç³»ï¼Œå…¶ä¸­ä¸»ä½“ä¼˜åŠ¿äºå¯¹è±¡ï¼Œå¯¹è±¡ä¼˜åŠ¿äºä¸»ä½“ï¼Œä¸¤è€…äº’ä¸ä¼˜åŠ¿ï¼Œæˆ–è€…ä¸¤è€…äº’ç›¸ä¼˜åŠ¿ã€‚å½“ä¸¤ä¸ªæ ‡ç­¾ç›¸ç­‰æ—¶ï¼Œä¼šå‡ºç°â€œä¸¤è€…äº’ç›¸ä¼˜åŠ¿â€çš„æƒ…å†µã€‚ç”±äº Biba çš„ä¿¡æ¯æµç‰¹æ€§ï¼Œç”¨æˆ·å¯¹ä¸€ç»„å¯èƒ½å¯¹åº”äºé¡¹ç›®çš„éš”é—´æ‹¥æœ‰æƒé™ï¼Œä½†å¯¹è±¡ä¹Ÿæœ‰ä¸€ç»„éš”é—´ã€‚ç”¨æˆ·å¯èƒ½éœ€è¦ä½¿ç”¨ `su` æˆ– `setpmac` æ¥å¯¹å…¶æƒé™è¿›è¡Œå­é›†åŒ–ï¼Œä»¥ä¾¿ä»å—é™åˆ¶çš„éš”é—´ä¸­è®¿é—®å¯¹è±¡ã€‚«User Labels¬ç”¨æˆ·æ ‡ç­¾ÚUsers are required to have labels so that their files and processes properly interact with the security policy defined on the system.  This is configured in [.filename]#/etc/login.conf# using login classes.  Every policy module that uses labels will implement the user class setting.Ùÿç”¨æˆ·éœ€è¦å…·æœ‰æ ‡ç­¾ï¼Œä»¥ä¾¿ä»–ä»¬çš„æ–‡ä»¶å’Œè¿›ç¨‹èƒ½å¤Ÿä¸ç³»ç»Ÿä¸Šå®šä¹‰çš„å®‰å…¨ç­–ç•¥æ­£ç¡®äº¤äº’ã€‚è¿™æ˜¯é€šè¿‡åœ¨ [.filename]#/etc/login.conf# ä¸­ä½¿ç”¨ç™»å½•ç±»è¿›è¡Œé…ç½®çš„ã€‚æ¯ä¸ªä½¿ç”¨æ ‡ç­¾çš„ç­–ç•¥æ¨¡å—éƒ½ä¼šå®ç°ç”¨æˆ·ç±»è®¾ç½®ã€‚ÚhTo set the user class default label which will be enforced by MAC, add a `label` entry.  An example `label` entry containing every policy module is displayed below.  Note that in a real configuration, the administrator would never enable every policy module.  It is recommended that the rest of this chapter be reviewed before any configuration is implemented.ÚCè¦è®¾ç½®ç”¨æˆ·ç±»çš„é»˜è®¤æ ‡ç­¾ï¼Œè¯¥æ ‡ç­¾å°†ç”± MAC å¼ºåˆ¶æ‰§è¡Œï¼Œè¯·æ·»åŠ ä¸€ä¸ª `label` æ¡ç›®ã€‚ä¸‹é¢æ˜¾ç¤ºäº†ä¸€ä¸ªåŒ…å«æ¯ä¸ªç­–ç•¥æ¨¡å—çš„ç¤ºä¾‹ `label` æ¡ç›®ã€‚è¯·æ³¨æ„ï¼Œåœ¨å®é™…é…ç½®ä¸­ï¼Œç®¡ç†å‘˜æ°¸è¿œä¸ä¼šå¯ç”¨æ¯ä¸ªç­–ç•¥æ¨¡å—ã€‚å»ºè®®åœ¨å®æ–½ä»»ä½•é…ç½®ä¹‹å‰å…ˆé˜…è¯»æœ¬ç« çš„å…¶ä½™éƒ¨åˆ†ã€‚Ú»While users can not modify the default value, they may change their label after they login, subject to the constraints of the policy.  The example above tells the Biba policy that a process's minimum integrity is `5`, its maximum is `15`, and the default effective label is `10`.  The process will run at `10` until it chooses to change label, perhaps due to the user using `setpmac`, which will be constrained by Biba to the configured range.Úzç”¨æˆ·æ— æ³•ä¿®æ”¹é»˜è®¤å€¼ï¼Œä½†ä»–ä»¬å¯ä»¥åœ¨ç™»å½•åæ›´æ”¹æ ‡ç­¾ï¼Œä½†å¿…é¡»ç¬¦åˆç­–ç•¥çš„é™åˆ¶ã€‚ä¸Šé¢çš„ç¤ºä¾‹å‘Šè¯‰ Biba ç­–ç•¥ï¼Œè¿›ç¨‹çš„æœ€å°å®Œæ•´æ€§ä¸º `5`ï¼Œæœ€å¤§å®Œæ•´æ€§ä¸º `15`ï¼Œé»˜è®¤æœ‰æ•ˆæ ‡ç­¾ä¸º `10`ã€‚è¿›ç¨‹å°†åœ¨ `10` ä¸Šè¿è¡Œï¼Œç›´åˆ°å®ƒé€‰æ‹©æ›´æ”¹æ ‡ç­¾ï¼Œå¯èƒ½æ˜¯ç”±äºç”¨æˆ·ä½¿ç”¨ `setpmac`ï¼Œè¯¥æ“ä½œå°†å—åˆ° Biba é…ç½®èŒƒå›´çš„é™åˆ¶ã€‚ÙrAfter any change to [.filename]#login.conf#, the login class capability database must be rebuilt using `cap_mkdb`.Ùpå¯¹äº [.filename]#login.conf# çš„ä»»ä½•æ›´æ”¹ï¼Œå¿…é¡»ä½¿ç”¨ `cap_mkdb` é‡æ–°æ„å»ºç™»å½•ç±»èƒ½åŠ›æ•°æ®åº“ã€‚Ù˜Many sites have a large number of users requiring several different user classes.  In depth planning is required as this can become difficult to manage.ÙŠè®¸å¤šç½‘ç«™æ‹¥æœ‰å¤§é‡ç”¨æˆ·ï¼Œéœ€è¦å¤šä¸ªä¸åŒçš„ç”¨æˆ·ç±»åˆ«ã€‚è¿™éœ€è¦è¿›è¡Œæ·±å…¥çš„è§„åˆ’ï¼Œå› ä¸ºè¿™å¯èƒ½å˜å¾—éš¾ä»¥ç®¡ç†ã€‚¸Network Interface Labels²ç½‘ç»œæ¥å£æ ‡ç­¾ÚFLabels may be set on network interfaces to help control the flow of data across the network.  Policies using network interface labels function in the same way that policies function with respect to objects.  Users at high settings in Biba, for example, will not be permitted to access network interfaces with a label of `low`.Úå¯ä»¥åœ¨ç½‘ç»œæ¥å£ä¸Šè®¾ç½®æ ‡ç­¾æ¥å¸®åŠ©æ§åˆ¶æ•°æ®åœ¨ç½‘ç»œä¸­çš„æµåŠ¨ã€‚ä½¿ç”¨ç½‘ç»œæ¥å£æ ‡ç­¾çš„ç­–ç•¥ä¸å¯¹è±¡ç›¸å…³çš„ç­–ç•¥çš„åŠŸèƒ½ç›¸åŒã€‚ä¾‹å¦‚ï¼Œåœ¨ Biba ä¸­è®¾ç½®ä¸ºé«˜çº§åˆ«çš„ç”¨æˆ·å°†ä¸è¢«å…è®¸è®¿é—®æ ‡ç­¾ä¸º `ä½ï¼ˆlowï¼‰` çš„ç½‘ç»œæ¥å£ã€‚ÙYWhen setting the MAC label on network interfaces, `maclabel` may be passed to `ifconfig`:Ù\åœ¨è®¾ç½®ç½‘ç»œæ¥å£çš„ MAC æ ‡ç­¾æ—¶ï¼Œå¯ä»¥é€šè¿‡ `ifconfig` ä¼ é€’ `maclabel` å‚æ•°ï¼šÙÏThis example will set the MAC label of `biba/equal` on the `bge0` interface.  When using a setting similar to `biba/high(low-high)`, the entire label should be quoted to prevent an error from being returned.ÙÂè¿™ä¸ªç¤ºä¾‹å°†åœ¨ `bge0` æ¥å£ä¸Šè®¾ç½® `biba/equal` çš„ MAC æ ‡ç­¾ã€‚å½“ä½¿ç”¨ç±»ä¼¼äº `biba/high(low-high)` çš„è®¾ç½®æ—¶ï¼Œåº”è¯¥å°†æ•´ä¸ªæ ‡ç­¾ç”¨å¼•å·æ‹¬èµ·æ¥ï¼Œä»¥é˜²æ­¢è¿”å›é”™è¯¯ã€‚ÚEEach policy module which supports labeling has a tunable which may be used to disable the MAC label on network interfaces.  Setting the label to `equal` will have a similar effect.  Review the output of `sysctl`, the policy manual pages, and the information in the rest of this chapter for more information on those tunables.Ú,æ¯ä¸ªæ”¯æŒæ ‡ç­¾çš„ç­–ç•¥æ¨¡å—éƒ½æœ‰ä¸€ä¸ªå¯è°ƒèŠ‚é¡¹ï¼Œå¯ä»¥ç”¨æ¥ç¦ç”¨ç½‘ç»œæ¥å£ä¸Šçš„ MAC æ ‡ç­¾ã€‚å°†æ ‡ç­¾è®¾ç½®ä¸º `equal` å°†äº§ç”Ÿç±»ä¼¼çš„æ•ˆæœã€‚è¯·æŸ¥çœ‹ `sysctl` çš„è¾“å‡ºã€ç­–ç•¥æ‰‹å†Œé¡µé¢ä»¥åŠæœ¬ç« èŠ‚ä¸­çš„å…¶ä»–ä¿¡æ¯ï¼Œä»¥è·å–æœ‰å…³è¿™äº›å¯è°ƒèŠ‚é¡¹çš„æ›´å¤šä¿¡æ¯ã€‚Ù#Planning the Security Configuration²è§„åˆ’å®‰å…¨é…ç½®Ù¸Before implementing any MAC policies, a planning phase is recommended.  During the planning stages, an administrator should consider the implementation requirements and goals, such as:Ù€åœ¨å®æ–½ä»»ä½• MAC ç­–ç•¥ä¹‹å‰ï¼Œå»ºè®®å…ˆè¿›è¡Œè§„åˆ’ã€‚åœ¨è§„åˆ’é˜¶æ®µï¼Œç®¡ç†å‘˜åº”è€ƒè™‘å®æ–½è¦æ±‚å’Œç›®æ ‡ï¼Œä¾‹å¦‚ï¼šÙJHow to classify information and resources available on the target systems.Ù9å¦‚ä½•å¯¹ç›®æ ‡ç³»ç»Ÿä¸Šçš„ä¿¡æ¯å’Œèµ„æºè¿›è¡Œåˆ†ç±»ã€‚ÙpWhich information or resources to restrict access to along with the type of restrictions that should be applied.ÙEåº”é™åˆ¶è®¿é—®çš„ä¿¡æ¯æˆ–èµ„æºä»¥åŠåº”è¯¥åº”ç”¨çš„é™åˆ¶ç±»å‹ã€‚Ù8Which MAC modules will be required to achieve this goal.Ù5ä¸ºå®ç°è¿™ä¸ªç›®æ ‡ï¼Œå°†éœ€è¦å“ªäº› MAC æ¨¡å—ï¼ŸÚ,A trial run of the trusted system and its configuration should occur _before_ a MAC implementation is used on production systems.  Since different environments have different needs and requirements, establishing a complete security profile will decrease the need of changes once the system goes live.Ùãåœ¨å°† MAC å®æ–½åˆ°ç”Ÿäº§ç³»ç»Ÿ _ä¹‹å‰_ï¼Œåº”è¿›è¡Œå¯ä¿¡ç³»ç»ŸåŠå…¶é…ç½®çš„è¯•è¿è¡Œã€‚ç”±äºä¸åŒçš„ç¯å¢ƒå…·æœ‰ä¸åŒçš„éœ€æ±‚å’Œè¦æ±‚ï¼Œå»ºç«‹å®Œæ•´çš„å®‰å…¨é…ç½®æ–‡ä»¶å°†å‡å°‘ç³»ç»ŸæŠ•å…¥ä½¿ç”¨åçš„æ›´æ”¹éœ€æ±‚ã€‚ÚNConsider how the MAC framework augments the security of the system as a whole.  The various security policy modules provided by the MAC framework could be used to protect the network and file systems or to block users from accessing certain ports and sockets.  Perhaps the best use of the policy modules is to load several security policy modules at a time in order to provide a MLS environment.  This approach differs from a hardening policy, which typically hardens elements of a system which are used only for specific purposes.  The downside to MLS is increased administrative overhead.ÚÌè€ƒè™‘ MAC æ¡†æ¶å¦‚ä½•å¢å¼ºæ•´ä¸ªç³»ç»Ÿçš„å®‰å…¨æ€§ã€‚MAC æ¡†æ¶æä¾›çš„å„ç§å®‰å…¨ç­–ç•¥æ¨¡å—å¯ä»¥ç”¨äºä¿æŠ¤ç½‘ç»œå’Œæ–‡ä»¶ç³»ç»Ÿï¼Œæˆ–è€…é˜»æ­¢ç”¨æˆ·è®¿é—®ç‰¹å®šçš„ç«¯å£å’Œå¥—æ¥å­—ã€‚ä¹Ÿè®¸æœ€å¥½çš„ä½¿ç”¨ç­–ç•¥æ¨¡å—çš„æ–¹å¼æ˜¯åŒæ—¶åŠ è½½å¤šä¸ªå®‰å…¨ç­–ç•¥æ¨¡å—ï¼Œä»¥æä¾› MLS ç¯å¢ƒã€‚è¿™ç§æ–¹æ³•ä¸ç¡¬åŒ–ç­–ç•¥ä¸åŒï¼Œç¡¬åŒ–ç­–ç•¥é€šå¸¸åªé’ˆå¯¹ç³»ç»Ÿä¸­ä»…ç”¨äºç‰¹å®šç›®çš„çš„å…ƒç´ è¿›è¡Œç¡¬åŒ–ã€‚ MLS çš„ç¼ºç‚¹æ˜¯å¢åŠ äº†ç®¡ç†å¼€é”€ã€‚ÚThe overhead is minimal when compared to the lasting effect of a framework which provides the ability to pick and choose which policies are required for a specific configuration and which keeps performance overhead down.  The reduction of support for unneeded policies can increase the overall performance of the system as well as offer flexibility of choice.  A good implementation would consider the overall security requirements and effectively implement the various security policy modules offered by the framework.Ú>ä¸æä¾›é€‰æ‹©ç‰¹å®šé…ç½®æ‰€éœ€çš„ç­–ç•¥å¹¶é™ä½æ€§èƒ½å¼€é”€çš„æ¡†æ¶ç›¸æ¯”ï¼Œå¼€é”€æ˜¯æœ€å°çš„ã€‚å‡å°‘å¯¹ä¸éœ€è¦çš„ç­–ç•¥çš„æ”¯æŒå¯ä»¥æé«˜ç³»ç»Ÿçš„æ•´ä½“æ€§èƒ½ï¼Œå¹¶æä¾›é€‰æ‹©çš„çµæ´»æ€§ã€‚ä¸€ä¸ªè‰¯å¥½çš„å®ç°åº”è¯¥è€ƒè™‘æ•´ä½“å®‰å…¨è¦æ±‚ï¼Œå¹¶æœ‰æ•ˆåœ°å®æ–½æ¡†æ¶æä¾›çš„å„ç§å®‰å…¨ç­–ç•¥æ¨¡å—ã€‚ÚLA system utilizing MAC guarantees that a user will not be permitted to change security attributes at will.  All user utilities, programs, and scripts must work within the constraints of the access rules provided by the selected security policy modules and control of the MAC access rules is in the hands of the system administrator.Ùîä½¿ç”¨ MAC çš„ç³»ç»Ÿå¯ä»¥ç¡®ä¿ç”¨æˆ·ä¸èƒ½éšæ„æ›´æ”¹å®‰å…¨å±æ€§ã€‚æ‰€æœ‰ç”¨æˆ·å·¥å…·ã€ç¨‹åºå’Œè„šæœ¬å¿…é¡»åœ¨æ‰€é€‰å®‰å…¨ç­–ç•¥æ¨¡å—æä¾›çš„è®¿é—®è§„åˆ™çº¦æŸä¸‹è¿è¡Œï¼Œè€Œ MAC è®¿é—®è§„åˆ™çš„æ§åˆ¶åˆ™ç”±ç³»ç»Ÿç®¡ç†å‘˜è´Ÿè´£ã€‚Ú°It is the duty of the system administrator to carefully select the correct security policy modules.  For an environment that needs to limit access control over the network, the man:mac_portacl[4], man:mac_ifoff[4], and man:mac_biba[4] policy modules make good starting points.  For an environment where strict confidentiality of file system objects is required, consider the man:mac_bsdextended[4] and man:mac_mls[4] policy modules.ÚOç³»ç»Ÿç®¡ç†å‘˜æœ‰è´£ä»»ä»”ç»†é€‰æ‹©æ­£ç¡®çš„å®‰å…¨ç­–ç•¥æ¨¡å—ã€‚å¯¹äºéœ€è¦é™åˆ¶ç½‘ç»œè®¿é—®æ§åˆ¶çš„ç¯å¢ƒï¼Œman:mac_portacl[4]ã€man:mac_ifoff[4] å’Œ man:mac_biba[4] ç­–ç•¥æ¨¡å—æ˜¯å¾ˆå¥½çš„èµ·ç‚¹ã€‚å¯¹äºéœ€è¦ä¸¥æ ¼ä¿å¯†æ–‡ä»¶ç³»ç»Ÿå¯¹è±¡çš„ç¯å¢ƒï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ man:mac_bsdextended[4] å’Œ man:mac_mls[4] ç­–ç•¥æ¨¡å—ã€‚ÚâPolicy decisions could be made based on network configuration.  If only certain users should be permitted access to man:ssh[1], the man:mac_portacl[4] policy module is a good choice.  In the case of file systems, access to objects might be considered confidential to some users, but not to others.  As an example, a large development team might be broken off into smaller projects where developers in project A might not be permitted to access objects written by developers in project B.  Yet both projects might need to access objects created by developers in project C.  Using the different security policy modules provided by the MAC framework, users could be divided into these groups and then given access to the appropriate objects.Ú›åŸºäºç½‘ç»œé…ç½®å¯ä»¥åšå‡ºæ”¿ç­–å†³ç­–ã€‚å¦‚æœåªå…è®¸ç‰¹å®šç”¨æˆ·è®¿é—® man:ssh[1] ï¼Œé‚£ä¹ˆ man:mac_portacl[4] ç­–ç•¥æ¨¡å—æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚åœ¨æ–‡ä»¶ç³»ç»Ÿçš„æƒ…å†µä¸‹ï¼Œå¯¹äºæŸäº›ç”¨æˆ·æ¥è¯´ï¼Œå¯¹å¯¹è±¡çš„è®¿é—®å¯èƒ½è¢«è§†ä¸ºæœºå¯†ï¼Œè€Œå¯¹å…¶ä»–ç”¨æˆ·æ¥è¯´åˆ™ä¸æ˜¯ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªå¤§å‹å¼€å‘å›¢é˜Ÿå¯èƒ½ä¼šè¢«åˆ†æˆè¾ƒå°çš„é¡¹ç›®ï¼Œé¡¹ç›® A çš„å¼€å‘äººå‘˜å¯èƒ½ä¸è¢«å…è®¸è®¿é—®é¡¹ç›® B çš„å¼€å‘äººå‘˜ç¼–å†™çš„å¯¹è±¡ã€‚ç„¶è€Œï¼Œè¿™ä¸¤ä¸ªé¡¹ç›®å¯èƒ½éœ€è¦è®¿é—®é¡¹ç›® C çš„å¼€å‘äººå‘˜åˆ›å»ºçš„å¯¹è±¡ã€‚ä½¿ç”¨ MAC æ¡†æ¶æä¾›çš„ä¸åŒå®‰å…¨ç­–ç•¥æ¨¡å—ï¼Œå¯ä»¥å°†ç”¨æˆ·åˆ†æˆè¿™äº›ç»„ï¼Œå¹¶ä¸ºå…¶æä¾›å¯¹åº”å¯¹è±¡çš„è®¿é—®æƒé™ã€‚ÚqEach security policy module has a unique way of dealing with the overall security of a system.  Module selection should be based on a well thought out security policy which may require revision and reimplementation.  Understanding the different security policy modules offered by the MAC framework will help administrators choose the best policies for their situations.Ú%æ¯ä¸ªå®‰å…¨ç­–ç•¥æ¨¡å—éƒ½æœ‰ä¸€ç§ç‹¬ç‰¹çš„å¤„ç†ç³»ç»Ÿæ•´ä½“å®‰å…¨çš„æ–¹å¼ã€‚æ¨¡å—çš„é€‰æ‹©åº”è¯¥åŸºäºç»è¿‡æ·±æ€ç†Ÿè™‘çš„å®‰å…¨ç­–ç•¥ï¼Œå¯èƒ½éœ€è¦è¿›è¡Œä¿®è®¢å’Œé‡æ–°å®æ–½ã€‚äº†è§£ MAC æ¡†æ¶æä¾›çš„ä¸åŒå®‰å…¨ç­–ç•¥æ¨¡å—å°†å¸®åŠ©ç®¡ç†å‘˜ä¸ºä»–ä»¬çš„æƒ…å†µé€‰æ‹©æœ€ä½³ç­–ç•¥ã€‚Ù›The rest of this chapter covers the available modules, describes their use and configuration, and in some cases, provides insight on applicable situations.ÙŠæœ¬ç« çš„å…¶ä½™éƒ¨åˆ†ä»‹ç»äº†å¯ç”¨çš„æ¨¡å—ï¼Œæè¿°äº†å®ƒä»¬çš„ä½¿ç”¨å’Œé…ç½®ï¼Œå¹¶åœ¨æŸäº›æƒ…å†µä¸‹æä¾›äº†é€‚ç”¨æƒ…å†µçš„è§è§£ã€‚Ú-Implementing MAC is much like implementing a firewall since care must be taken to prevent being completely locked out of the system.  The ability to revert back to a previous configuration should be considered and the implementation of MAC over a remote connection should be done with extreme caution.Ù¾å®æ–½ MAC ä¸å®æ–½é˜²ç«å¢™éå¸¸ç›¸ä¼¼ï¼Œå› ä¸ºå¿…é¡»å°å¿ƒé˜²æ­¢å®Œå…¨è¢«ç³»ç»Ÿé”å®šã€‚åº”è€ƒè™‘èƒ½å¤Ÿæ¢å¤åˆ°å…ˆå‰çš„é…ç½®ï¼Œå¹¶ä¸”åœ¨è¿œç¨‹è¿æ¥ä¸Šå®æ–½ MAC æ—¶åº”æåº¦è°¨æ…ã€‚¶Available MAC Policies´å¯ç”¨çš„ MAC ç­–ç•¥ÚThe default FreeBSD kernel includes `options MAC`.  This means that every module included with the MAC framework can be loaded with `kldload` as a run-time kernel module.  After testing the module, add the module name to [.filename]#/boot/loader.conf# so that it will load during boot.  Each module also provides a kernel option for those administrators who choose to compile their own custom kernel.Úmé»˜è®¤çš„ FreeBSD å†…æ ¸åŒ…å« `options MAC`ã€‚è¿™æ„å‘³ç€ MAC æ¡†æ¶ä¸­åŒ…å«çš„æ¯ä¸ªæ¨¡å—éƒ½å¯ä»¥ä½œä¸ºè¿è¡Œæ—¶å†…æ ¸æ¨¡å—ä½¿ç”¨ `kldload` åŠ è½½ã€‚åœ¨æµ‹è¯•å®Œæ¨¡å—åï¼Œå°†æ¨¡å—åç§°æ·»åŠ åˆ° [.filename]#/boot/loader.conf# ï¼Œä»¥ä¾¿åœ¨å¯åŠ¨æ—¶åŠ è½½ã€‚å¯¹äºé‚£äº›é€‰æ‹©ç¼–è¯‘è‡ªå®šä¹‰å†…æ ¸çš„ç®¡ç†å‘˜ï¼Œæ¯ä¸ªæ¨¡å—è¿˜æä¾›äº†ä¸€ä¸ªå†…æ ¸é€‰é¡¹ã€‚ÙÉFreeBSD includes a group of policies that will cover most security requirements. Each policy is summarized below.  The last three policies support integer settings in place of the three default labels.Ù­FreeBSD åŒ…å«ä¸€ç»„ç­–ç•¥ï¼Œå¯ä»¥æ»¡è¶³å¤§å¤šæ•°å®‰å…¨éœ€æ±‚ã€‚ä¸‹é¢å¯¹æ¯ä¸ªç­–ç•¥è¿›è¡Œäº†æ€»ç»“ã€‚æœ€åä¸‰ä¸ªç­–ç•¥æ”¯æŒä½¿ç”¨æ•´æ•°è®¾ç½®æ›¿ä»£ä¸‰ä¸ªé»˜è®¤æ ‡ç­¾ã€‚½The MAC See Other UIDs Policy»MAC æŸ¥çœ‹å…¶ä»– UID ç­–ç•¥Ù-Module name: [.filename]#mac_seeotheruids.ko#Ù/æ¨¡å—åç§°ï¼š[.filename]#mac_seeotheruids.ko#Ù5Kernel configuration line: `options MAC_SEEOTHERUIDS`Ù,å†…æ ¸é…ç½®è¡Œï¼š`options MAC_SEEOTHERUIDS`Ù*Boot option: `mac_seeotheruids_load="YES"`Ù-å¯åŠ¨é€‰é¡¹ï¼š`mac_seeotheruids_load ="YES"`ÙùThe man:mac_seeotheruids[4] module extends the `security.bsd.see_other_uids` and `security.bsd.see_other_gids sysctl` tunables.  This option does not require any labels to be set before configuration and can operate transparently with other modules.Ùêman:mac_seeotheruids[4] æ¨¡å—æ‰©å±•äº† `security.bsd.see_other_uids` å’Œ `security.bsd.see_other_gids sysctl` å¯è°ƒæ•´å‚æ•°ã€‚è¯¥é€‰é¡¹åœ¨é…ç½®ä¹‹å‰ä¸éœ€è¦è®¾ç½®ä»»ä½•æ ‡ç­¾ï¼Œå¹¶ä¸”å¯ä»¥ä¸å…¶ä»–æ¨¡å—é€æ˜åœ°ååŒå·¥ä½œã€‚Ù^After loading the module, the following `sysctl` tunables may be used to control its features:ÙOåŠ è½½æ¨¡å—åï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹ `sysctl` å¯è°ƒæ•´é¡¹æ¥æ§åˆ¶å…¶åŠŸèƒ½ï¼šÙ«`security.mac.seeotheruids.enabled` enables the module and implements the default settings which deny users the ability to view processes and sockets owned by other users.Ù‡`security.mac.seeotheruids.enabled` å¯ç”¨è¯¥æ¨¡å—å¹¶å®ç°é»˜è®¤è®¾ç½®ï¼Œç¦æ­¢ç”¨æˆ·æŸ¥çœ‹å…¶ä»–ç”¨æˆ·æ‹¥æœ‰çš„è¿›ç¨‹å’Œå¥—æ¥å­—ã€‚Ú`security.mac.seeotheruids.specificgid_enabled` allows specified groups to be exempt from this policy. To exempt specific groups, use the `security.mac.seeotheruids.specificgid=_XXX_ sysctl` tunable, replacing _XXX_ with the numeric group ID to be exempted.Ùì`security.mac.seeotheruids.specificgid_enabled` å…è®¸æŒ‡å®šçš„ç»„å…é™¤æ­¤ç­–ç•¥ã€‚è¦å…é™¤ç‰¹å®šçš„ç»„ï¼Œè¯·ä½¿ç”¨ `security.mac.seeotheruids.specificgid =_XXX_ sysctl` å¯è°ƒèŠ‚å‚æ•°ï¼Œå°† _XXX_ æ›¿æ¢ä¸ºè¦å…é™¤çš„æ•°å­—ç»„ IDã€‚ÙÅ`security.mac.seeotheruids.primarygroup_enabled` is used to exempt specific primary groups from this policy. When using this tunable, `security.mac.seeotheruids.specificgid_enabled` may not be set.ÙÈ`security.mac.seeotheruids.primarygroup_enabled` ç”¨äºå…é™¤ç‰¹å®šçš„ä¸»è¦ç»„å…å—æ­¤ç­–ç•¥çš„å½±å“ã€‚å½“ä½¿ç”¨æ­¤å¯è°ƒæ•´é¡¹æ—¶ï¼Œä¸å¾—è®¾ç½® `security.mac.seeotheruids.specificgid_enabled` ã€‚»The MAC BSD Extended Policy´MAC BSD æ‰©å±•ç­–ç•¥Ù,Module name: [.filename]#mac_bsdextended.ko#Ù.æ¨¡å—åç§°ï¼š[.filename]#mac_bsdextended.ko#Ù4Kernel configuration line: `options MAC_BSDEXTENDED`Ù+å†…æ ¸é…ç½®è¡Œï¼š`options MAC_BSDEXTENDED`Ù)Boot option: `mac_bsdextended_load="YES"`Ù,å¯åŠ¨é€‰é¡¹ï¼š`mac_bsdextended_load ="YES"`Ú¦The man:mac_bsdextended[4] module enforces a file system firewall.  It provides an extension to the standard file system permissions model, permitting an administrator to create a firewall-like ruleset to protect files, utilities, and directories in the file system hierarchy.  When access to a file system object is attempted, the list of rules is iterated until either a matching rule is located or the end is reached.  This behavior may be changed using `security.mac.bsdextended.firstmatch_enabled`.  Similar to other firewall modules in FreeBSD, a file containing the access control rules can be created and read by the system at boot time using an man:rc.conf[5] variable.ÚKman:mac_bsdextended[4] æ¨¡å—å®æ–½äº†ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿé˜²ç«å¢™ã€‚å®ƒä¸ºæ ‡å‡†æ–‡ä»¶ç³»ç»Ÿæƒé™æ¨¡å‹æä¾›äº†æ‰©å±•ï¼Œå…è®¸ç®¡ç†å‘˜åˆ›å»ºç±»ä¼¼é˜²ç«å¢™çš„è§„åˆ™é›†æ¥ä¿æŠ¤æ–‡ä»¶ç³»ç»Ÿå±‚æ¬¡ç»“æ„ä¸­çš„æ–‡ä»¶ã€å®ç”¨ç¨‹åºå’Œç›®å½•ã€‚å½“å°è¯•è®¿é—®æ–‡ä»¶ç³»ç»Ÿå¯¹è±¡æ—¶ï¼Œå°†è¿­ä»£è§„åˆ™åˆ—è¡¨ï¼Œç›´åˆ°æ‰¾åˆ°åŒ¹é…çš„è§„åˆ™æˆ–åˆ°è¾¾æœ«å°¾ä¸ºæ­¢ã€‚å¯ä»¥ä½¿ç”¨ `security.mac.bsdextended.firstmatch_enabled` æ¥æ›´æ”¹æ­¤è¡Œä¸ºã€‚ä¸ FreeBSD ä¸­çš„å…¶ä»–é˜²ç«å¢™æ¨¡å—ç±»ä¼¼ï¼Œå¯ä»¥ä½¿ç”¨ man:rc.conf[5] å˜é‡åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶åˆ›å»ºå’Œè¯»å–åŒ…å«è®¿é—®æ§åˆ¶è§„åˆ™çš„æ–‡ä»¶ã€‚Ù®The rule list may be entered using man:ugidfw[8] which has a syntax similar to man:ipfw[8].  More tools can be written by using the functions in the man:libugidfw[3] library.ÙŸè§„åˆ™åˆ—è¡¨å¯ä»¥ä½¿ç”¨ man:ugidfw[8] è¾“å…¥ï¼Œå…¶è¯­æ³•ç±»ä¼¼äº man:ipfw[8]ã€‚é€šè¿‡ä½¿ç”¨ man:libugidfw[3] åº“ä¸­çš„å‡½æ•°ï¼Œå¯ä»¥ç¼–å†™æ›´å¤šçš„å·¥å…·ã€‚Ù‚After the man:mac_bsdextended[4] module has been loaded, the following command may be used to list the current rule configuration:Ùiåœ¨åŠ è½½äº† man:mac_bsdextended[4] æ¨¡å—ä¹‹åï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆ—å‡ºå½“å‰çš„è§„åˆ™é…ç½®ï¼šÙšBy default, no rules are defined and everything is completely accessible.  To create a rule which blocks all access by users but leaves `root` unaffected:Ù§é»˜è®¤æƒ…å†µä¸‹ï¼Œæ²¡æœ‰å®šä¹‰ä»»ä½•è§„åˆ™ï¼Œæ‰€æœ‰å†…å®¹éƒ½æ˜¯å®Œå…¨å¯è®¿é—®çš„ã€‚è¦åˆ›å»ºä¸€ä¸ªè§„åˆ™ï¼Œé˜»æ­¢ç”¨æˆ·çš„æ‰€æœ‰è®¿é—®ï¼Œä½†ä¸å½±å“ `root` ç”¨æˆ·ï¼šÙãWhile this rule is simple to implement, it is a very bad idea as it blocks all users from issuing any commands.  A more realistic example blocks `user1` all access, including directory listings, to ``_user2_``'s home directory:Ùİè™½ç„¶è¿™ä¸ªè§„åˆ™å¾ˆå®¹æ˜“å®ç°ï¼Œä½†å®ƒæ˜¯ä¸€ä¸ªéå¸¸ç³Ÿç³•çš„æƒ³æ³•ï¼Œå› ä¸ºå®ƒä¼šé˜»æ­¢æ‰€æœ‰ç”¨æˆ·å‘å‡ºä»»ä½•å‘½ä»¤ã€‚ä¸€ä¸ªæ›´ç°å®çš„ä¾‹å­æ˜¯é˜»æ­¢ `user1` è®¿é—® `_user2_` çš„ä¸»ç›®å½•ï¼ŒåŒ…æ‹¬ç›®å½•åˆ—è¡¨ã€‚Ù«Instead of `user1`, `not uid _user2_` could be used in order to enforce the same access restrictions for all users.  However, the `root` user is unaffected by these rules.Ù•å¯ä»¥ä½¿ç”¨ `not uid _user2_` æ¥ä»£æ›¿ `user1`ï¼Œä»¥ä¾¿ä¸ºæ‰€æœ‰ç”¨æˆ·å¼ºåˆ¶ç›¸åŒçš„è®¿é—®é™åˆ¶ã€‚ç„¶è€Œï¼Œè¿™äº›è§„åˆ™å¯¹ `root` ç”¨æˆ·æ— æ•ˆã€‚Ù†Extreme caution should be taken when working with this module as incorrect use could block access to certain parts of the file system.Ùuåœ¨ä½¿ç”¨è¯¥æ¨¡å—æ—¶åº”æåº¦è°¨æ…ï¼Œå› ä¸ºé”™è¯¯çš„ä½¿ç”¨å¯èƒ½ä¼šé˜»æ­¢å¯¹æ–‡ä»¶ç³»ç»Ÿçš„æŸäº›éƒ¨åˆ†çš„è®¿é—®ã€‚Ù"The MAC Interface Silencing Policy¶MAC æ¥å£ç¦æ­¢ç­–ç•¥Ù&Module name: [.filename]#mac_ifoff.ko#Ù(æ¨¡å—åç§°ï¼š[.filename]#mac_ifoff.ko#Ù.Kernel configuration line: `options MAC_IFOFF`Ù%å†…æ ¸é…ç½®è¡Œï¼š`options MAC_IFOFF`Ù#Boot option: `mac_ifoff_load="YES"`Ù&å¯åŠ¨é€‰é¡¹ï¼š`mac_ifoff_load ="YES"`ÙÛThe man:mac_ifoff[4] module is used to disable network interfaces on the fly and to keep network interfaces from being brought up during system boot.  It does not use labels and does not depend on any other MAC modules.Ù©man:mac_ifoff[4] æ¨¡å—ç”¨äºåŠ¨æ€ç¦ç”¨ç½‘ç»œæ¥å£ï¼Œå¹¶é˜²æ­¢åœ¨ç³»ç»Ÿå¯åŠ¨æœŸé—´å¯ç”¨ç½‘ç»œæ¥å£ã€‚å®ƒä¸ä½¿ç”¨æ ‡ç­¾ï¼Œä¹Ÿä¸ä¾èµ–äºä»»ä½•å…¶ä»– MAC æ¨¡å—ã€‚ÙKMost of this module's control is performed through these `sysctl` tunables:ÙLå¤§éƒ¨åˆ†è¯¥æ¨¡å—çš„æ§åˆ¶æ˜¯é€šè¿‡è¿™äº› `sysctl` å¯è°ƒå‚æ•°è¿›è¡Œçš„ï¼šÙf`security.mac.ifoff.lo_enabled` enables or disables all traffic on the loopback, man:lo[4], interface.Ùy`security.mac.ifoff.lo_enabled` ç”¨äºå¯ç”¨æˆ–ç¦ç”¨å›ç¯ï¼ˆloopbackï¼‰æ¥å£ä¸Šçš„æ‰€æœ‰æµé‡ï¼Œå‚è€ƒï¼šman:lo[4]ã€‚Ùy`security.mac.ifoff.bpfrecv_enabled` enables or disables all traffic on the Berkeley Packet Filter interface, man:bpf[4].Ù†`security.mac.ifoff.bpfrecv_enabled` ç”¨äºå¯ç”¨æˆ–ç¦ç”¨ Berkeley æ•°æ®åŒ…è¿‡æ»¤å™¨æ¥å£ä¸Šçš„æ‰€æœ‰æµé‡ï¼Œå‚è§ man:bpf[4] ã€‚ÙW`security.mac.ifoff.other_enabled` enables or disables traffic on all other interfaces.ÙY`security.mac.ifoff.other_enabled` ç”¨äºå¯ç”¨æˆ–ç¦ç”¨æ‰€æœ‰å…¶ä»–æ¥å£ä¸Šçš„æµé‡ã€‚ÚcOne of the most common uses of man:mac_ifoff[4] is network monitoring in an environment where network traffic should not be permitted during the boot sequence.  Another use would be to write a script which uses an application such as package:security/aide[] to automatically block network traffic if it finds new or altered files in protected directories.Ú)man:mac_ifoff[4] çš„æœ€å¸¸è§ç”¨é€”ä¹‹ä¸€æ˜¯åœ¨å¯åŠ¨åºåˆ—æœŸé—´ä¸å…è®¸ç½‘ç»œæµé‡çš„ç¯å¢ƒä¸­è¿›è¡Œç½‘ç»œç›‘æ§ã€‚å¦ä¸€ä¸ªç”¨é€”æ˜¯ç¼–å†™ä¸€ä¸ªè„šæœ¬ï¼Œä½¿ç”¨ç±»ä¼¼ package:security/aide[] çš„åº”ç”¨ç¨‹åºï¼Œåœ¨å—ä¿æŠ¤çš„ç›®å½•ä¸­å‘ç°æ–°æ–‡ä»¶æˆ–æ›´æ”¹æ–‡ä»¶æ—¶è‡ªåŠ¨é˜»æ­¢ç½‘ç»œæµé‡ã€‚Ù'The MAC Port Access Control List PolicyÙ"MAC ç«¯å£è®¿é—®æ§åˆ¶åˆ—è¡¨ç­–ç•¥Ù(Module name: [.filename]#mac_portacl.ko#Ù*æ¨¡å—åç§°ï¼š[.filename]#mac_portacl.ko#Ù(Kernel configuration line: `MAC_PORTACL`¿å†…æ ¸é…ç½®è¡Œï¼š`MAC_PORTACL`Ù%Boot option: `mac_portacl_load="YES"`Ù(å¼•å¯¼é€‰é¡¹ï¼š`mac_portacl_load ="YES"`Ù±The man:mac_portacl[4] module is used to limit binding to local TCP and UDP ports, making it possible to allow non-`root` users to bind to specified privileged ports below 1024.Ù–man:mac_portacl[4] æ¨¡å—ç”¨äºé™åˆ¶ç»‘å®šåˆ°æœ¬åœ° TCP å’Œ UDP ç«¯å£ï¼Œä½¿é `root` ç”¨æˆ·èƒ½å¤Ÿç»‘å®šåˆ°æŒ‡å®šçš„ç‰¹æƒç«¯å£ï¼ˆä½äº 1024ï¼‰ã€‚ÙfOnce loaded, this module enables the MAC policy on all sockets.  The following tunables are available:Ù_ä¸€æ—¦åŠ è½½ï¼Œè¯¥æ¨¡å—å°†åœ¨æ‰€æœ‰å¥—æ¥å­—ä¸Šå¯ç”¨ MAC ç­–ç•¥ã€‚ä»¥ä¸‹å¯è°ƒæ•´é¡¹å¯ç”¨ï¼šÙI`security.mac.portacl.enabled` enables or disables the policy completely.Ù@`security.mac.portacl.enabled` ç”¨äºå¯ç”¨æˆ–ç¦ç”¨è¯¥ç­–ç•¥ã€‚Ù_`security.mac.portacl.port_high` sets the highest port number that man:mac_portacl[4] protects.ÙY`security.mac.portacl.port_high` è®¾ç½®äº† man:mac_portacl[4] ä¿æŠ¤çš„æœ€é«˜ç«¯å£å·ã€‚Ùl`security.mac.portacl.suser_exempt`, when set to a non-zero value, exempts the `root` user from this policy.Ùfå½“ `security.mac.portacl.suser_exempt` è®¾ç½®ä¸ºéé›¶å€¼æ—¶ï¼Œå…é™¤ `root` ç”¨æˆ·éµå®ˆæ­¤ç­–ç•¥ã€‚Ú½`security.mac.portacl.rules` specifies the policy as a text string of the form `rule[,rule,...]`, with as many rules as needed, and where each rule is of the form `idtype:id:protocol:port`. The `idtype` is either `uid` or `gid`. The `protocol` parameter can be `tcp` or `udp`. The `port` parameter is the port number to allow the specified user or group to bind to. Only numeric values can be used for the user ID, group ID, and port parameters.Ú€`security.mac.portacl.rules` æŒ‡å®šäº†ç­–ç•¥ï¼Œå…¶æ ¼å¼ä¸º `rule[,rule,...]` çš„æ–‡æœ¬å­—ç¬¦ä¸²ï¼Œå¯ä»¥åŒ…å«å¤šä¸ªè§„åˆ™ï¼Œæ¯ä¸ªè§„åˆ™çš„æ ¼å¼ä¸º `idtype:id:protocol:port`ã€‚ `idtype` å¯ä»¥æ˜¯ `uid` æˆ– `gid`ã€‚`protocol` å‚æ•°å¯ä»¥æ˜¯ `tcp` æˆ– `udp`ã€‚`port` å‚æ•°æ˜¯å…è®¸æŒ‡å®šçš„ç”¨æˆ·æˆ–ç»„ç»‘å®šçš„ç«¯å£å·ã€‚ç”¨æˆ· IDã€ç»„ ID å’Œç«¯å£å‚æ•°åªèƒ½ä½¿ç”¨æ•°å­—å€¼ã€‚ÙØBy default, ports below 1024 can only be used by privileged processes which run as `root`.  For man:mac_portacl[4] to allow non-privileged processes to bind to ports below 1024, set the following tunables as follows:Ùåé»˜è®¤æƒ…å†µä¸‹ï¼Œåªæœ‰ä»¥ `root` èº«ä»½è¿è¡Œçš„ç‰¹æƒè¿›ç¨‹æ‰èƒ½ä½¿ç”¨å°äº 1024 çš„ç«¯å£ã€‚è¦å…è®¸éç‰¹æƒè¿›ç¨‹ç»‘å®šåˆ°å°äº 1024 çš„ç«¯å£ï¼Œå¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ–¹å¼è®¾ç½® man:mac_portacl[4] ä¸­çš„å¯è°ƒæ•´å‚æ•°ï¼šÙ{To prevent the `root` user from being affected by this policy, set `security.mac.portacl.suser_exempt` to a non-zero value.Ùuä¸ºäº†é˜²æ­¢ `root` ç”¨æˆ·å—åˆ°æ­¤ç­–ç•¥çš„å½±å“ï¼Œè¯·å°† `security.mac.portacl.suser_exempt` è®¾ç½®ä¸ºéé›¶å€¼ã€‚Ù]To allow the `www` user with UID 80 to bind to port 80 without ever needing `root` privilege:Ùcä¸ºäº†å…è®¸ UID ä¸º 80 çš„ `www` ç”¨æˆ·åœ¨ä¸éœ€è¦ `root` æƒé™çš„æƒ…å†µä¸‹ç»‘å®šåˆ°ç«¯å£ 80ï¼šÙhThis next example permits the user with the UID of 1001 to bind to TCP ports 110 (POP3) and 995 (POP3s):Ùiä¸‹é¢çš„ç¤ºä¾‹å…è®¸å…·æœ‰ UID ä¸º 1001 çš„ç”¨æˆ·ç»‘å®šåˆ° TCP ç«¯å£ 110ï¼ˆPOP3ï¼‰å’Œ 995ï¼ˆPOP3sï¼‰ï¼š¸The MAC Partition Policy°MAC åˆ†åŒºç­–ç•¥Ù*Module name: [.filename]#mac_partition.ko#Ù,æ¨¡å—åç§°ï¼š[.filename]#mac_partition.ko#Ù2Kernel configuration line: `options MAC_PARTITION`Ù)å†…æ ¸é…ç½®è¡Œï¼š`options MAC_PARTITION`Ù'Boot option: `mac_partition_load="YES"`Ù*å¯åŠ¨é€‰é¡¹ï¼š`mac_partition_load ="YES"`ÙÚThe man:mac_partition[4] policy drops processes into specific "partitions" based on their MAC label.  Most configuration for this policy is done using man:setpmac[8].  One `sysctl` tunable is available for this policy:ÙÓman:mac_partition[4] ç­–ç•¥æ ¹æ®è¿›ç¨‹çš„ MAC æ ‡ç­¾å°†å…¶åˆ†é…åˆ°ç‰¹å®šçš„â€œåˆ†åŒºâ€ä¸­ã€‚å¤§éƒ¨åˆ†è¯¥ç­–ç•¥çš„é…ç½®éƒ½æ˜¯ä½¿ç”¨ man:setpmac[8] å®Œæˆçš„ã€‚è¯¥ç­–ç•¥æœ‰ä¸€ä¸ªå¯è°ƒæ•´çš„ `sysctl` å‚æ•°ã€‚ÙS`security.mac.partition.enabled` enables the enforcement of MAC process partitions.ÙM`security.mac.partition.enabled` å¯ç”¨äº† MAC è¿›ç¨‹åˆ†åŒºçš„å¼ºåˆ¶æ‰§è¡Œã€‚Ú\When this policy is enabled, users will only be permitted to see their processes, and any others within their partition, but will not be permitted to work with utilities outside the scope of this partition.  For instance, a user in the `insecure` class will not be permitted to access `top` as well as many other commands that must spawn a process.Úå½“å¯ç”¨æ­¤ç­–ç•¥æ—¶ï¼Œç”¨æˆ·åªèƒ½æŸ¥çœ‹ä»–ä»¬è‡ªå·±çš„è¿›ç¨‹ä»¥åŠå…¶æ‰€åœ¨åˆ†åŒºçš„å…¶ä»–è¿›ç¨‹ï¼Œä½†ä¸å…è®¸ä½¿ç”¨è¶…å‡ºè¯¥åˆ†åŒºèŒƒå›´çš„å®ç”¨å·¥å…·ã€‚ä¾‹å¦‚ï¼Œå±äº `ä¸å®‰å…¨ï¼ˆinsecureï¼‰` ç±»åˆ«çš„ç”¨æˆ·å°†æ— æ³•è®¿é—® `top` ä»¥åŠè®¸å¤šå…¶ä»–éœ€è¦ç”Ÿæˆè¿›ç¨‹çš„å‘½ä»¤ã€‚Ù©This example adds `top` to the label set on users in the `insecure` class.  All processes spawned by users in the `insecure` class will stay in the `partition/13` label.Ù°è¿™ä¸ªä¾‹å­å°† `top` æ·»åŠ åˆ° `insecure` ç±»åˆ«ä¸­çš„ç”¨æˆ·æ ‡ç­¾é›†åˆä¸­ã€‚æ‰€æœ‰ç”± `insecure` ç±»åˆ«ä¸­çš„ç”¨æˆ·ç”Ÿæˆçš„è¿›ç¨‹éƒ½å°†ä¿æŒåœ¨ `partition/13` æ ‡ç­¾ä¸­ã€‚Ù?This command displays the partition label and the process list:Ù-è¯¥å‘½ä»¤æ˜¾ç¤ºåˆ†åŒºæ ‡ç­¾å’Œè¿›ç¨‹åˆ—è¡¨ï¼šÙiThis command displays another user's process partition label and that user's currently running processes:Ù`è¯¥å‘½ä»¤æ˜¾ç¤ºå¦ä¸€ä¸ªç”¨æˆ·çš„è¿›ç¨‹åˆ†åŒºæ ‡ç­¾ä»¥åŠè¯¥ç”¨æˆ·å½“å‰æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹ï¼šÙ`Users can see processes in ``root``'s label unless the man:mac_seeotheruids[4] policy is loaded.Ùfé™¤éåŠ è½½äº† man:mac_seeotheruids[4] ç­–ç•¥ï¼Œå¦åˆ™ç”¨æˆ·å¯ä»¥çœ‹åˆ° `root` æ ‡ç­¾ä¸‹çš„è¿›ç¨‹ã€‚Ù#The MAC Multi-Level Security Module¶MAC å¤šçº§å®‰å…¨æ¨¡å—Ù$Module name: [.filename]#mac_mls.ko#Ù&æ¨¡å—åç§°ï¼š[.filename]#mac_mls.ko#Ù,Kernel configuration line: `options MAC_MLS`Ù#å†…æ ¸é…ç½®è¡Œï¼š`options MAC_MLS`Ù!Boot option: `mac_mls_load="YES"`Ù$å¯åŠ¨é€‰é¡¹ï¼š`mac_mls_load ="YES"`ÙƒThe man:mac_mls[4] policy controls access between subjects and objects in the system by enforcing a strict information flow policy.Ùlman:mac_mls[4] ç­–ç•¥é€šè¿‡æ‰§è¡Œä¸¥æ ¼çš„ä¿¡æ¯æµç­–ç•¥æ¥æ§åˆ¶ç³»ç»Ÿä¸­ä¸»ä½“å’Œå¯¹è±¡ä¹‹é—´çš„è®¿é—®ã€‚ÚŒIn MLS environments, a "clearance" level is set in the label of each subject or object, along with compartments.  Since these clearance levels can reach numbers greater than several thousand, it would be a daunting task to thoroughly configure every subject or object.  To ease this administrative overhead, three labels are included in this policy: `mls/low`, `mls/equal`, and `mls/high`, where:Úmåœ¨ MLS ç¯å¢ƒä¸­ï¼Œæ¯ä¸ªä¸»ä½“æˆ–å¯¹è±¡çš„æ ‡ç­¾ä¸­éƒ½è®¾ç½®äº†ä¸€ä¸ªâ€œè®¸å¯ï¼ˆclearanceï¼‰â€çº§åˆ«ï¼Œä»¥åŠéš”é—´ã€‚ç”±äºè¿™äº›è®¸å¯çº§åˆ«å¯ä»¥è¾¾åˆ°å‡ åƒä»¥ä¸Šçš„æ•°å­—ï¼Œå½»åº•é…ç½®æ¯ä¸ªä¸»ä½“æˆ–å¯¹è±¡å°†æ˜¯ä¸€é¡¹è‰°å·¨çš„ä»»åŠ¡ã€‚ä¸ºäº†å‡è½»è¿™ç§ç®¡ç†è´Ÿæ‹…ï¼Œè¯¥ç­–ç•¥ä¸­åŒ…æ‹¬äº†ä¸‰ä¸ªæ ‡ç­¾ï¼š `mls/low`ï¼Œ`mls/equal` å’Œ `mls/high`ï¼Œå…¶ä¸­ï¼šÙğAnything labeled with `mls/low` will have a low clearance level and not be permitted to access information of a higher level. This label also prevents objects of a higher clearance level from writing or passing information to a lower level.Ù³ä»»ä½•æ ‡è®°ä¸º `mls/low` çš„å†…å®¹éƒ½å…·æœ‰ä½è®¸å¯çº§åˆ«ï¼Œä¸å…è®¸è®¿é—®æ›´é«˜çº§åˆ«çš„ä¿¡æ¯ã€‚è¯¥æ ‡ç­¾è¿˜é˜»æ­¢é«˜è®¸å¯çº§åˆ«çš„å¯¹è±¡å‘ä½çº§åˆ«å†™å…¥æˆ–ä¼ é€’ä¿¡æ¯ã€‚ÙO`mls/equal` should be placed on objects which should be exempt from the policy.ÙB`mls/equal` åº”è¯¥è¢«æ”¾ç½®åœ¨åº”è¯¥è¢«è±å…æ”¿ç­–çš„å¯¹è±¡ä¸Šã€‚Ùâ`mls/high` is the highest level of clearance possible. Objects assigned this label will hold dominance over all other objects in the system; however, they will not permit the leaking of information to objects of a lower class.Ù­`mls/high` æ˜¯æœ€é«˜çº§åˆ«çš„è®¸å¯çº§åˆ«ã€‚è¢«åˆ†é…æ­¤æ ‡ç­¾çš„å¯¹è±¡å°†åœ¨ç³»ç»Ÿä¸­å…·æœ‰æœ€é«˜æƒé™ï¼›ç„¶è€Œï¼Œå®ƒä»¬ä¸ä¼šå…è®¸ä¿¡æ¯æ³„æ¼ç»™è¾ƒä½çº§åˆ«çš„å¯¹è±¡ã€‚­MLS provides:¹MLS æä¾›ä»¥ä¸‹åŠŸèƒ½ï¼šÙHA hierarchical security level with a set of non-hierarchical categories.Ù<ä¸€ä¸ªå…·æœ‰ä¸€ç»„éå±‚æ¬¡åŒ–ç±»åˆ«çš„åˆ†å±‚å®‰å…¨çº§åˆ«ã€‚ÙñFixed rules of `no read up, no write down`. This means that a subject can have read access to objects on its own level or below, but not above. Similarly, a subject can have write access to objects on its own level or above, but not beneath.Ú}å›ºå®šçš„è§„åˆ™æ˜¯ `ä¸å¯å‘ä¸Šè¯»å–ï¼Œä¸å¯å‘ä¸‹å†™å…¥`ã€‚è¿™æ„å‘³ç€ä¸€ä¸ªä¸»ä½“å¯ä»¥å¯¹å…¶è‡ªèº«çº§åˆ«æˆ–ä»¥ä¸‹çº§åˆ«çš„å¯¹è±¡å…·æœ‰è¯»å–è®¿é—®æƒé™ï¼Œä½†ä¸èƒ½å¯¹ä»¥ä¸Šçº§åˆ«çš„å¯¹è±¡å…·æœ‰è¯»å–è®¿é—®æƒé™ã€‚åŒæ ·åœ°ï¼Œä¸€ä¸ªä¸»ä½“å¯ä»¥å¯¹å…¶è‡ªèº«çº§åˆ«æˆ–ä»¥ä¸Šçº§åˆ«çš„å¯¹è±¡å…·æœ‰å†™å…¥è®¿é—®æƒé™ï¼Œä½†ä¸èƒ½å¯¹ä»¥ä¸‹çº§åˆ«çš„å¯¹è±¡å…·æœ‰å†™å…¥è®¿é—®æƒé™ã€‚Ù?Secrecy, or the prevention of inappropriate disclosure of data.Ù?ä¿å¯†æ€§ï¼Œæˆ–è€…è¯´æ˜¯é˜²æ­¢æ•°æ®ä¸é€‚å½“æŠ«éœ²çš„æªæ–½ã€‚Ù›A basis for the design of systems that concurrently handle data at multiple sensitivity levels without leaking information between secret and confidential.Ùrè®¾è®¡èƒ½å¤ŸåŒæ—¶å¤„ç†å¤šä¸ªæ•æ„Ÿçº§åˆ«æ•°æ®çš„ç³»ç»ŸåŸºç¡€ï¼Œè€Œä¸ä¼šåœ¨ç§˜å¯†å’Œæœºå¯†ä¹‹é—´æ³„éœ²ä¿¡æ¯ã€‚Ù.The following `sysctl` tunables are available:Ù.ä»¥ä¸‹æ˜¯å¯ç”¨çš„ `sysctl` å¯è°ƒæ•´å‚æ•°ï¼šÙG`security.mac.mls.enabled` is used to enable or disable the MLS policy.Ù>`security.mac.mls.enabled` ç”¨äºå¯ç”¨æˆ–ç¦ç”¨ MLS ç­–ç•¥ã€‚Ù[`security.mac.mls.ptys_equal` labels all man:pty[4] devices as `mls/equal` during creation.Ùe`security.mac.mls.ptys_equal` åœ¨åˆ›å»ºè¿‡ç¨‹ä¸­å°†æ‰€æœ‰ `man:pty[4]` è®¾å¤‡æ ‡è®°ä¸º `mls/equal`ã€‚Ùv`security.mac.mls.revocation_enabled` revokes access to objects after their label changes to a label of a lower grade.Ù}`security.mac.mls.revocation_enabled` åœ¨å¯¹è±¡çš„æ ‡ç­¾å˜ä¸ºè¾ƒä½ç­‰çº§çš„æ ‡ç­¾åï¼Œæ’¤é”€å¯¹è¯¥å¯¹è±¡çš„è®¿é—®æƒé™ã€‚Ùf`security.mac.mls.max_compartments` sets the maximum number of compartment levels allowed on a system.ÙT`security.mac.mls.max_compartments` è®¾ç½®ç³»ç»Ÿå…è®¸çš„æœ€å¤§éš”ç¦»çº§åˆ«æ•°é‡ã€‚ÙMTo manipulate MLS labels, use man:setfmac[8]. To assign a label to an object:ÙSè¦æ“ä½œ MLS æ ‡ç­¾ï¼Œè¯·ä½¿ç”¨ man:setfmac[8]ã€‚è¦ä¸ºå¯¹è±¡åˆ†é…ä¸€ä¸ªæ ‡ç­¾ï¼šÙ4To get the MLS label for the file [.filename]#test#:Ù0è·å–æ–‡ä»¶ [.filename]#test# çš„ MLS æ ‡ç­¾ï¼šÙ—Another approach is to create a master policy file in [.filename]#/etc/# which specifies the MLS policy information and to feed that file to `setfmac`.Ù¢å¦ä¸€ç§æ–¹æ³•æ˜¯åœ¨ [.filename]#/etc/# ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªä¸»ç­–ç•¥æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶æŒ‡å®šäº† MLS ç­–ç•¥ä¿¡æ¯ï¼Œå¹¶å°†è¯¥æ–‡ä»¶æä¾›ç»™ `setfmac` å‘½ä»¤ã€‚ÚWhen using the MLS policy module, an administrator plans to control the flow of sensitive information.  The default `block read up block write down` sets everything to a low state.  Everything is accessible and an administrator slowly augments the confidentiality of the information.Ùêå½“ä½¿ç”¨ MLS ç­–ç•¥æ¨¡å—æ—¶ï¼Œç®¡ç†å‘˜è®¡åˆ’æ§åˆ¶æ•æ„Ÿä¿¡æ¯çš„æµåŠ¨ã€‚é»˜è®¤çš„ `block read up block write down` å°†æ‰€æœ‰å†…å®¹è®¾ç½®ä¸ºä½çŠ¶æ€ã€‚æ‰€æœ‰å†…å®¹éƒ½æ˜¯å¯è®¿é—®çš„ï¼Œç®¡ç†å‘˜ä¼šé€æ¸å¢åŠ ä¿¡æ¯çš„æœºå¯†æ€§ã€‚ÚñBeyond the three basic label options, an administrator may group users and groups as required to block the information flow between them.  It might be easier to look at the information in clearance levels using descriptive words, such as classifications of `Confidential`, `Secret`, and `Top Secret`.  Some administrators instead create different groups based on project levels.  Regardless of the classification method, a well thought out plan must exist before implementing a restrictive policy.Úœé™¤äº†ä¸‰ç§åŸºæœ¬çš„æ ‡ç­¾é€‰é¡¹ä¹‹å¤–ï¼Œç®¡ç†å‘˜è¿˜å¯ä»¥æ ¹æ®éœ€è¦å°†ç”¨æˆ·å’Œç»„è¿›è¡Œåˆ†ç»„ï¼Œä»¥é˜»æ­¢å®ƒä»¬ä¹‹é—´çš„ä¿¡æ¯æµåŠ¨ã€‚ä½¿ç”¨æè¿°æ€§è¯è¯­ï¼Œå¦‚ `æœºå¯†`ã€`ç§˜å¯†` å’Œ `ç»å¯†` æ¥æŸ¥çœ‹æ¸…é™¤çº§åˆ«çš„ä¿¡æ¯å¯èƒ½æ›´å®¹æ˜“ã€‚ä¸€äº›ç®¡ç†å‘˜æ ¹æ®é¡¹ç›®çº§åˆ«åˆ›å»ºä¸åŒçš„ç»„ã€‚æ— è®ºåˆ†ç±»æ–¹æ³•å¦‚ä½•ï¼Œéƒ½å¿…é¡»åœ¨å®æ–½é™åˆ¶æ€§æ”¿ç­–ä¹‹å‰åˆ¶å®šä¸€ä¸ªç»è¿‡æ·±æ€ç†Ÿè™‘çš„è®¡åˆ’ã€‚Ù¯Some example situations for the MLS policy module include an e-commerce web server, a file server holding critical company information, and financial institution environments.Ù‹MLS ç­–ç•¥æ¨¡å—çš„ä¸€äº›ç¤ºä¾‹æƒ…å†µåŒ…æ‹¬ç”µå­å•†åŠ¡ç½‘ç«™æœåŠ¡å™¨ã€å­˜å‚¨å…³é”®å…¬å¸ä¿¡æ¯çš„æ–‡ä»¶æœåŠ¡å™¨å’Œé‡‘èæœºæ„ç¯å¢ƒã€‚³The MAC Biba Module¯MAC Biba æ¨¡å—Ù%Module name: [.filename]#mac_biba.ko#ºæ¨¡å—åç§°ï¼šmac_biba.koÙ-Kernel configuration line: `options MAC_BIBA`Ù$å†…æ ¸é…ç½®è¡Œï¼š`options MAC_BIBA`Ù"Boot option: `mac_biba_load="YES"`Ù%å¯åŠ¨é€‰é¡¹ï¼š`mac_biba_load ="YES"`Ú6The man:mac_biba[4] module loads the MAC Biba policy.  This policy is similar to the MLS policy with the exception that the rules for information flow are slightly reversed.  This is to prevent the downward flow of sensitive information whereas the MLS policy prevents the upward flow of sensitive information.ÙÛman:mac_biba[4] æ¨¡å—åŠ è½½äº† MAC Biba ç­–ç•¥ã€‚è¯¥ç­–ç•¥ä¸ MLS ç­–ç•¥ç±»ä¼¼ï¼Œä½†ä¿¡æ¯æµåŠ¨è§„åˆ™ç•¥æœ‰ä¸åŒã€‚è¿™æ˜¯ä¸ºäº†é˜²æ­¢æ•æ„Ÿä¿¡æ¯çš„å‘ä¸‹æµåŠ¨ï¼Œè€Œ MLS ç­–ç•¥åˆ™é˜²æ­¢æ•æ„Ÿä¿¡æ¯çš„å‘ä¸ŠæµåŠ¨ã€‚ÙÊIn Biba environments, an "integrity" label is set on each subject or object.  These labels are made up of hierarchical grades and non-hierarchical components.  As a grade ascends, so does its integrity.ÙÃåœ¨ Biba ç¯å¢ƒä¸­ï¼Œæ¯ä¸ªä¸»ä½“æˆ–å¯¹è±¡éƒ½ä¼šè®¾ç½®ä¸€ä¸ªâ€œå®Œæ•´æ€§ï¼ˆintegrityï¼‰â€æ ‡ç­¾ã€‚è¿™äº›æ ‡ç­¾ç”±å±‚æ¬¡ç­‰çº§å’Œéå±‚æ¬¡ç»„æˆã€‚éšç€ç­‰çº§çš„æå‡ï¼Œå®Œæ•´æ€§ä¹Ÿä¼šæé«˜ã€‚ÙFSupported labels are `biba/low`, `biba/equal`, and `biba/high`, where:ÙHæ”¯æŒçš„æ ‡ç­¾æœ‰ `biba/low`ã€`biba/equal` å’Œ `biba/high`ï¼Œå…¶ä¸­ï¼šÙÚ`biba/low` is considered the lowest integrity an object or subject may have. Setting this on objects or subjects blocks their write access to objects or subjects marked as `biba/high`, but will not prevent read access.ÙÌ`biba/low` è¢«è®¤ä¸ºæ˜¯å¯¹è±¡æˆ–ä¸»ä½“å¯èƒ½å…·æœ‰çš„æœ€ä½å®Œæ•´æ€§ã€‚å°†å…¶è®¾ç½®åœ¨å¯¹è±¡æˆ–ä¸»ä½“ä¸Šä¼šé˜»æ­¢å®ƒä»¬å¯¹æ ‡è®°ä¸º `biba/high` çš„å¯¹è±¡æˆ–ä¸»ä½“çš„å†™è®¿é—®ï¼Œä½†ä¸ä¼šé˜»æ­¢è¯»è®¿é—®ã€‚ÙV`biba/equal` should only be placed on objects considered to be exempt from the policy.ÙF`biba/equal` åº”è¯¥åªè¢«åº”ç”¨äºè¢«è®¤ä¸ºç¬¦åˆæ”¿ç­–çš„å¯¹è±¡ä¸Šã€‚ÙÌ`biba/high` permits writing to objects set at a lower label, but does not permit reading that object. It is recommended that this label be placed on objects that affect the integrity of the entire system.Ù¨`biba/high` å…è®¸å¯¹è®¾ç½®åœ¨è¾ƒä½æ ‡ç­¾çš„å¯¹è±¡è¿›è¡Œå†™æ“ä½œï¼Œä½†ä¸å…è®¸è¯»å–è¯¥å¯¹è±¡ã€‚å»ºè®®å°†æ­¤æ ‡ç­¾æ”¾ç½®åœ¨å½±å“æ•´ä¸ªç³»ç»Ÿå®Œæ•´æ€§çš„å¯¹è±¡ä¸Šã€‚®Biba provides:®Biba æä¾›ï¼šÙRHierarchical integrity levels with a set of non-hierarchical integrity categories.ÙBå…·æœ‰ä¸€ç»„éå±‚æ¬¡åŒ–å®Œæ•´æ€§ç±»åˆ«çš„å±‚æ¬¡å®Œæ•´æ€§çº§åˆ«ã€‚ÙõFixed rules are `no write up, no read down`, the opposite of MLS. A subject can have write access to objects on its own level or below, but not above. Similarly, a subject can have read access to objects on its own level or above, but not below.Úaå›ºå®šè§„åˆ™æ˜¯ `ä¸å¯å‘ä¸Šå†™å…¥ï¼Œä¸å¯å‘ä¸‹è¯»å–`ï¼Œä¸ MLS ç›¸åã€‚ä¸»ä½“å¯ä»¥å¯¹å…¶è‡ªèº«çº§åˆ«æˆ–ä»¥ä¸‹çš„å¯¹è±¡å…·æœ‰å†™å…¥è®¿é—®æƒé™ï¼Œä½†ä¸èƒ½å¯¹å…¶ä»¥ä¸Šçš„å¯¹è±¡å…·æœ‰å†™å…¥è®¿é—®æƒé™ã€‚åŒæ ·åœ°ï¼Œä¸»ä½“å¯ä»¥å¯¹å…¶è‡ªèº«çº§åˆ«æˆ–ä»¥ä¸Šçš„å¯¹è±¡å…·æœ‰è¯»å–è®¿é—®æƒé™ï¼Œä½†ä¸èƒ½å¯¹å…¶ä»¥ä¸‹çš„å¯¹è±¡å…·æœ‰è¯»å–è®¿é—®æƒé™ã€‚Ù;Integrity by preventing inappropriate modification of data.Ù9é€šè¿‡é˜²æ­¢æ•°æ®çš„ä¸é€‚å½“ä¿®æ”¹æ¥ä¿æŒå®Œæ•´æ€§ã€‚Ù3Integrity levels instead of MLS sensitivity levels.Ù,å®Œæ•´æ€§çº§åˆ«è€Œä¸æ˜¯ MLS æ•æ„Ÿçº§åˆ«ã€‚ÙAThe following tunables can be used to manipulate the Biba policy:Ù0ä»¥ä¸‹å¯è°ƒæ•´é¡¹å¯ç”¨äºæ“ä½œ Biba ç­–ç•¥ï¼šÙn`security.mac.biba.enabled` is used to enable or disable enforcement of the Biba policy on the target machine.Ù[`security.mac.biba.enabled` ç”¨äºåœ¨ç›®æ ‡æœºå™¨ä¸Šå¯ç”¨æˆ–ç¦ç”¨ Biba ç­–ç•¥çš„æ‰§è¡Œã€‚ÙX`security.mac.biba.ptys_equal` is used to disable the Biba policy on man:pty[4] devices.ÙX`security.mac.biba.ptys_equal` ç”¨äºç¦ç”¨ Biba ç­–ç•¥å¯¹ man:pty[4] è®¾å¤‡çš„åº”ç”¨ã€‚Ù‚`security.mac.biba.revocation_enabled` forces the revocation of access to objects if the label is changed to dominate the subject.Ùyå¦‚æœæ ‡ç­¾è¢«æ›´æ”¹ä¸ºæ”¯é…ä¸»ä½“ï¼Œåˆ™ `security.mac.biba.revocation_enabled` å¼ºåˆ¶æ’¤é”€å¯¹å¯¹è±¡çš„è®¿é—®æƒé™ã€‚ÙQTo access the Biba policy setting on system objects, use `setfmac` and `getfmac`:Ù[è¦è®¿é—®ç³»ç»Ÿå¯¹è±¡ä¸Šçš„ Biba ç­–ç•¥è®¾ç½®ï¼Œè¯·ä½¿ç”¨ `setfmac` å’Œ `getfmac` å‘½ä»¤ï¼šÚ	Integrity, which is different from sensitivity, is used to guarantee that information is not manipulated by untrusted parties.  This includes information passed between subjects and objects.  It ensures that users will only be able to modify or access information they have been given explicit access to.  The man:mac_biba[4] security policy module permits an administrator to configure which files and programs a user may see and invoke while assuring that the programs and files are trusted by the system for that user.Úså®Œæ•´æ€§ä¸æ•æ„Ÿæ€§ä¸åŒï¼Œç”¨äºç¡®ä¿ä¿¡æ¯ä¸è¢«ä¸å—ä¿¡ä»»çš„æ–¹è¿›è¡Œç¯¡æ”¹ã€‚è¿™åŒ…æ‹¬ä¸»ä½“å’Œå¯¹è±¡ä¹‹é—´ä¼ é€’çš„ä¿¡æ¯ã€‚å®ƒç¡®ä¿ç”¨æˆ·åªèƒ½ä¿®æ”¹æˆ–è®¿é—®ä»–ä»¬è¢«æ˜ç¡®æˆæƒçš„ä¿¡æ¯ã€‚ man:mac_biba[4] å®‰å…¨ç­–ç•¥æ¨¡å—å…è®¸ç®¡ç†å‘˜é…ç½®ç”¨æˆ·å¯ä»¥æŸ¥çœ‹å’Œè°ƒç”¨å“ªäº›æ–‡ä»¶å’Œç¨‹åºï¼ŒåŒæ—¶ç¡®ä¿è¿™äº›ç¨‹åºå’Œæ–‡ä»¶å¯¹è¯¥ç”¨æˆ·æ˜¯å¯ä¿¡çš„ã€‚Ú„During the initial planning phase, an administrator must be prepared to partition users into grades, levels, and areas.  The system will default to a high label once this policy module is enabled, and it is up to the administrator to configure the different grades and levels for users.  Instead of using clearance levels, a good planning method could include topics.  For instance, only allow developers modification access to the source code repository, source code compiler, and other development utilities.  Other users would be grouped into other categories such as testers, designers, or end users and would only be permitted read access.Úåœ¨åˆå§‹è§„åˆ’é˜¶æ®µï¼Œç®¡ç†å‘˜å¿…é¡»å‡†å¤‡å¥½å°†ç”¨æˆ·åˆ†æˆç­‰çº§ã€çº§åˆ«å’Œé¢†åŸŸã€‚ä¸€æ—¦å¯ç”¨äº†è¯¥ç­–ç•¥æ¨¡å—ï¼Œç³»ç»Ÿå°†é»˜è®¤ä¸ºé«˜çº§åˆ«ï¼Œå¹¶ç”±ç®¡ç†å‘˜é…ç½®ç”¨æˆ·çš„ä¸åŒç­‰çº§å’Œçº§åˆ«ã€‚ä¸ä½¿ç”¨è®¸å¯çº§åˆ«ä¸åŒï¼Œä¸€ä¸ªå¥½çš„è§„åˆ’æ–¹æ³•å¯ä»¥åŒ…æ‹¬ä¸»é¢˜ã€‚ä¾‹å¦‚ï¼Œåªå…è®¸å¼€å‘äººå‘˜å¯¹æºä»£ç ä»“åº“ã€æºä»£ç ç¼–è¯‘å™¨å’Œå…¶ä»–å¼€å‘å·¥å…·è¿›è¡Œä¿®æ”¹è®¿é—®ã€‚å…¶ä»–ç”¨æˆ·å°†è¢«åˆ†ç»„åˆ°å…¶ä»–ç±»åˆ«ï¼Œå¦‚æµ‹è¯•äººå‘˜ã€è®¾è®¡å¸ˆæˆ–æœ€ç»ˆç”¨æˆ·ï¼Œå¹¶ä¸”åªå…è®¸è¯»å–è®¿é—®æƒé™ã€‚ÚA lower integrity subject is unable to write to a higher integrity subject and a higher integrity subject cannot list or read a lower integrity object.  Setting a label at the lowest possible grade could make it inaccessible to subjects.  Some prospective environments for this security policy module would include a constrained web server, a development and test machine, and a source code repository.  A less useful implementation would be a personal workstation, a machine used as a router, or a network firewall.Ú£è¾ƒä½å®Œæ•´æ€§çš„ä¸»ä½“æ— æ³•å‘è¾ƒé«˜å®Œæ•´æ€§çš„ä¸»ä½“å†™å…¥ï¼Œè€Œè¾ƒé«˜å®Œæ•´æ€§çš„ä¸»ä½“æ— æ³•åˆ—å‡ºæˆ–è¯»å–è¾ƒä½å®Œæ•´æ€§çš„å¯¹è±¡ã€‚å°†æ ‡ç­¾è®¾ç½®ä¸ºæœ€ä½ç­‰çº§å¯èƒ½ä¼šä½¿ä¸»ä½“æ— æ³•è®¿é—®ã€‚æ­¤å®‰å…¨ç­–ç•¥æ¨¡å—çš„ä¸€äº›æ½œåœ¨ç¯å¢ƒåŒ…æ‹¬å—é™çš„ Web æœåŠ¡å™¨ã€å¼€å‘å’Œæµ‹è¯•æœºå™¨ä»¥åŠæºä»£ç å­˜å‚¨åº“ã€‚è¾ƒå°‘æœ‰ç”¨çš„å®ç°å¯èƒ½æ˜¯ä¸ªäººå·¥ä½œç«™ã€ç”¨ä½œè·¯ç”±å™¨çš„æœºå™¨æˆ–ç½‘ç»œé˜²ç«å¢™ã€‚¼The MAC Low-watermark Module¹MAC ä½æ°´ä½æ ‡è®°æ¨¡å—Ù&Module name: [.filename]#mac_lomac.ko#Ù(æ¨¡å—åç§°ï¼š[.filename]#mac_lomac.ko#Ù.Kernel configuration line: `options MAC_LOMAC`Ù%å†…æ ¸é…ç½®è¡Œï¼š`options MAC_LOMAC`Ù#Boot option: `mac_lomac_load="YES"`Ù&å¯åŠ¨é€‰é¡¹ï¼š`mac_lomac_load ="YES"`Ù¯Unlike the MAC Biba policy, the man:mac_lomac[4] policy permits access to lower integrity objects only after decreasing the integrity level to not disrupt any integrity rules.Ùä¸ MAC Biba ç­–ç•¥ä¸åŒï¼Œ man:mac_lomac[4] ç­–ç•¥å…è®¸åœ¨é™ä½å®Œæ•´æ€§çº§åˆ«ä»¥ä¸ç ´åä»»ä½•å®Œæ•´æ€§è§„åˆ™çš„æƒ…å†µä¸‹è®¿é—®è¾ƒä½å®Œæ•´æ€§å¯¹è±¡ã€‚Ú[The Low-watermark integrity policy works almost identically to Biba, with the exception of using floating labels to support subject demotion via an auxiliary grade compartment.  This secondary compartment takes the form `[auxgrade]`.  When assigning a policy with an auxiliary grade, use the syntax `lomac/10[2]`, where `2` is the auxiliary grade.Ú&ä½æ°´ä½å®Œæ•´æ€§ç­–ç•¥ä¸ Biba å‡ ä¹å®Œå…¨ç›¸åŒï¼Œå”¯ä¸€çš„åŒºåˆ«æ˜¯ä½¿ç”¨æµ®åŠ¨æ ‡ç­¾æ¥æ”¯æŒé€šè¿‡è¾…åŠ©ç­‰çº§éš”ç¦»ä¸»ä½“ã€‚è¿™ä¸ªè¾…åŠ©ç­‰çº§éš”ç¦»é‡‡ç”¨ `[auxgrade]` çš„å½¢å¼ã€‚å½“åˆ†é…ä¸€ä¸ªå¸¦æœ‰è¾…åŠ©ç­‰çº§çš„ç­–ç•¥æ—¶ï¼Œä½¿ç”¨è¯­æ³• `lomac/10[2]`ï¼Œå…¶ä¸­ `2` æ˜¯è¾…åŠ©ç­‰çº§ã€‚ÚfThis policy relies on the ubiquitous labeling of all system objects with integrity labels, permitting subjects to read from low integrity objects and then downgrading the label on the subject to prevent future writes to high integrity objects using `[auxgrade]`.  The policy may provide greater compatibility and require less initial configuration than Biba.Ú=è¯¥ç­–ç•¥ä¾èµ–äºå¯¹æ‰€æœ‰ç³»ç»Ÿå¯¹è±¡è¿›è¡Œæ™®éæ ‡è®°çš„å®Œæ•´æ€§æ ‡ç­¾ï¼Œå…è®¸ä¸»ä½“ä»ä½å®Œæ•´æ€§å¯¹è±¡è¯»å–ï¼Œå¹¶é€šè¿‡ `[auxgrade]` å°†ä¸»ä½“çš„æ ‡ç­¾é™çº§ï¼Œä»¥é˜²æ­¢å°†æ¥å¯¹é«˜å®Œæ•´æ€§å¯¹è±¡è¿›è¡Œå†™å…¥ã€‚ä¸ Biba ç›¸æ¯”ï¼Œè¯¥ç­–ç•¥å¯èƒ½æä¾›æ›´é«˜çš„å…¼å®¹æ€§ï¼Œå¹¶ä¸”éœ€è¦è¾ƒå°‘çš„åˆå§‹é…ç½®ã€‚ÙcLike the Biba and MLS policies, `setfmac` and `setpmac` are used to place labels on system objects:Ù\ä¸ Biba å’Œ MLS ç­–ç•¥ç±»ä¼¼ï¼Œ`setfmac` å’Œ `setpmac` ç”¨äºç»™ç³»ç»Ÿå¯¹è±¡æ‰“ä¸Šæ ‡ç­¾ï¼šÙLThe auxiliary grade `low` is a feature provided only by the MACLOMAC policy.ÙDè¾…åŠ©ç­‰çº§ `low` æ˜¯ä»…ç”± MACLOMAC ç­–ç•¥æä¾›çš„ä¸€ä¸ªç‰¹æ€§ã€‚®User Lock Down¬ç”¨æˆ·é”å®šÙ¯This example considers a relatively small storage system with fewer than fifty users.  Users will have login capabilities and are permitted to store data and access resources.Ùè¿™ä¸ªä¾‹å­è€ƒè™‘äº†ä¸€ä¸ªç›¸å¯¹è¾ƒå°çš„å­˜å‚¨ç³»ç»Ÿï¼Œç”¨æˆ·æ•°é‡å°‘äº 50 äººã€‚ç”¨æˆ·å°†å…·æœ‰ç™»å½•åŠŸèƒ½ï¼Œå¹¶è¢«å…è®¸å­˜å‚¨æ•°æ®å’Œè®¿é—®èµ„æºã€‚Ù§For this scenario, the man:mac_bsdextended[4] and man:mac_seeotheruids[4] policy modules could co-exist and block access to system objects while hiding user processes.Ù«å¯¹äºè¿™ç§æƒ…å†µï¼Œman:mac_bsdextended[4] å’Œ man:mac_seeotheruids[4] ç­–ç•¥æ¨¡å—å¯ä»¥å…±å­˜ï¼Œå¹¶ä¸”å¯ä»¥é˜»æ­¢å¯¹ç³»ç»Ÿå¯¹è±¡çš„è®¿é—®ï¼ŒåŒæ—¶éšè—ç”¨æˆ·è¿›ç¨‹ã€‚ÙEBegin by adding the following line to [.filename]#/boot/loader.conf#:ÙGé¦–å…ˆï¼Œåœ¨ [.filename]#/boot/loader.conf# æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹è¡Œï¼šÙtThe man:mac_bsdextended[4] security policy module may be activated by adding this line to [.filename]#/etc/rc.conf#:Ùqé€šè¿‡å°†ä»¥ä¸‹è¡Œæ·»åŠ åˆ° [.filename]#/etc/rc.conf#ï¼Œå¯ä»¥æ¿€æ´» man:mac_bsdextended[4] å®‰å…¨ç­–ç•¥æ¨¡å—ï¼šÚSDefault rules stored in [.filename]#/etc/rc.bsdextended# will be loaded at system initialization.  However, the default entries may need modification.  Since this machine is expected only to service users, everything may be left commented out except the last two lines in order to force the loading of user owned system objects by default.Ú<ç³»ç»Ÿåˆå§‹åŒ–æ—¶å°†åŠ è½½å­˜å‚¨åœ¨ [.filename]#/etc/rc.bsdextended# æ–‡ä»¶ä¸­çš„é»˜è®¤è§„åˆ™ã€‚ç„¶è€Œï¼Œé»˜è®¤æ¡ç›®å¯èƒ½éœ€è¦ä¿®æ”¹ã€‚ç”±äºæ­¤æœºå™¨é¢„è®¡åªä¸ºç”¨æˆ·æä¾›æœåŠ¡ï¼Œå› æ­¤é™¤äº†æœ€åä¸¤è¡Œå¤–ï¼Œå¯ä»¥å°†æ‰€æœ‰å†…å®¹éƒ½æ³¨é‡Šæ‰ï¼Œä»¥ä¾¿é»˜è®¤æƒ…å†µä¸‹å¼ºåˆ¶åŠ è½½ç”¨æˆ·æ‹¥æœ‰çš„ç³»ç»Ÿå¯¹è±¡ã€‚ÚAdd the required users to this machine and reboot.  For testing purposes, try logging in as a different user across two consoles.  Run `ps aux` to see if processes of other users are visible.  Verify that running man:ls[1] on another user's home directory fails.Úå°†æ‰€éœ€çš„ç”¨æˆ·æ·»åŠ åˆ°è¯¥æœºå™¨å¹¶é‡æ–°å¯åŠ¨ã€‚ä¸ºäº†æµ‹è¯•ç›®çš„ï¼Œå°è¯•åœ¨ä¸¤ä¸ªæ§åˆ¶å°ä¸Šä½¿ç”¨ä¸åŒçš„ç”¨æˆ·ç™»å½•ã€‚è¿è¡Œ `ps aux` å‘½ä»¤æŸ¥çœ‹å…¶ä»–ç”¨æˆ·çš„è¿›ç¨‹æ˜¯å¦å¯è§ã€‚éªŒè¯åœ¨å¦ä¸€ä¸ªç”¨æˆ·çš„ä¸»ç›®å½•ä¸Šè¿è¡Œ man:ls[1] å‘½ä»¤æ˜¯å¦å¤±è´¥ã€‚ÙvDo not try to test with the `root` user unless the specific ``sysctl``s have been modified to block super user access.Ùxé™¤éç‰¹å®šçš„ `sysctl` å·²è¢«ä¿®æ”¹ä»¥é˜»æ­¢è¶…çº§ç”¨æˆ·è®¿é—®ï¼Œå¦åˆ™ä¸è¦å°è¯•ä½¿ç”¨ `root` ç”¨æˆ·è¿›è¡Œæµ‹è¯•ã€‚ÙİWhen a new user is added, their man:mac_bsdextended[4] rule will not be in the ruleset list.  To update the ruleset quickly, unload the security policy module and reload it again using man:kldunload[8] and man:kldload[8].Ùëå½“æ·»åŠ ä¸€ä¸ªæ–°ç”¨æˆ·æ—¶ï¼Œä»–ä»¬çš„ man:mac_bsdextended[4] è§„åˆ™å°†ä¸ä¼šå‡ºç°åœ¨è§„åˆ™é›†åˆ—è¡¨ä¸­ã€‚ä¸ºäº†å¿«é€Ÿæ›´æ–°è§„åˆ™é›†ï¼Œå¯ä»¥ä½¿ç”¨ man:kldunload[8] å’Œ man:kldload[8] å‘½ä»¤å¸è½½å’Œé‡æ–°åŠ è½½å®‰å…¨ç­–ç•¥æ¨¡å—ã€‚´Nagios in a MAC Jailºåœ¨ MAC Jail ä¸­çš„ NagiosÚ<This section demonstrates the steps that are needed to implement the Nagios network monitoring system in a MAC environment.  This is meant as an example which still requires the administrator to test that the implemented policy meets the security requirements of the network before using in a production environment.ÙÓæœ¬èŠ‚æ¼”ç¤ºäº†åœ¨ MAC ç¯å¢ƒä¸­å®æ–½ Nagios ç½‘ç»œç›‘æ§ç³»ç»Ÿæ‰€éœ€çš„æ­¥éª¤ã€‚è¿™ä»…ä½œä¸ºä¸€ä¸ªç¤ºä¾‹ï¼Œç®¡ç†å‘˜åœ¨å°†è¯¥ç­–ç•¥åº”ç”¨äºç”Ÿäº§ç¯å¢ƒä¹‹å‰éœ€è¦æµ‹è¯•å…¶æ˜¯å¦ç¬¦åˆç½‘ç»œçš„å®‰å…¨è¦æ±‚ã€‚ÚThis example requires `multilabel` to be set on each file system.  It also assumes that package:net-mgmt/nagios-plugins[], package:net-mgmt/nagios[], and package:www/apache22[] are all installed, configured, and working correctly before attempting the integration into the MAC framework.Úåœ¨è¿›è¡Œæ­¤ç¤ºä¾‹ä¹‹å‰ï¼Œéœ€è¦åœ¨æ¯ä¸ªæ–‡ä»¶ç³»ç»Ÿä¸Šè®¾ç½® `multilabel`ã€‚åŒæ—¶ï¼Œè¿˜å‡è®¾åœ¨å°†å…¶é›†æˆåˆ° MAC æ¡†æ¶ä¹‹å‰ï¼Œå·²ç»å®‰è£…ã€é…ç½®å¹¶æ­£ç¡®è¿è¡Œäº† `package:net-mgmt/nagios-plugins[]` ã€`package:net-mgmt/nagios[]` å’Œ `package:www/apache22[]` ã€‚½Create an Insecure User ClassÙ!åˆ›å»ºä¸€ä¸ªä¸å®‰å…¨çš„ç”¨æˆ·ç±»ÙWBegin the procedure by adding the following user class to [.filename]#/etc/login.conf#:ÙQåœ¨ [.filename]#/etc/login.conf# ä¸­æ·»åŠ ä»¥ä¸‹ç”¨æˆ·ç±»åˆ«ï¼Œå¼€å§‹è¯¥è¿‡ç¨‹ï¼šÙ?Then, add the following line to the default user class section:Ù3ç„¶åï¼Œåœ¨é»˜è®¤ç”¨æˆ·ç±»éƒ¨åˆ†æ·»åŠ ä»¥ä¸‹è¡Œï¼šÙGSave the edits and issue the following command to rebuild the database:Ù6ä¿å­˜ä¿®æ”¹å¹¶æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ä»¥é‡å»ºæ•°æ®åº“ï¼š¯Configure Users¬é…ç½®ç”¨æˆ·Ù/Set the `root` user to the default class using:Ù8ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å°† `root` ç”¨æˆ·è®¾ç½®ä¸ºé»˜è®¤ç±»ï¼šÙÎAll user accounts that are not `root` will now require a login class.  The login class is required, otherwise users will be refused access to common commands.  The following `sh` script should do the trick:Ù¡æ‰€æœ‰ä¸æ˜¯ `root` çš„ç”¨æˆ·å¸æˆ·ç°åœ¨éƒ½éœ€è¦ä¸€ä¸ªç™»å½•ç±»ã€‚å¦åˆ™ï¼Œç”¨æˆ·å°†è¢«æ‹’ç»è®¿é—®å¸¸ç”¨å‘½ä»¤ã€‚ä¸‹é¢çš„ `sh` è„šæœ¬åº”è¯¥èƒ½è§£å†³é—®é¢˜ï¼šÙCNext, drop the `nagios` and `www` accounts into the insecure class:ÙGæ¥ä¸‹æ¥ï¼Œå°† `nagios` å’Œ `www` è´¦æˆ·æ·»åŠ åˆ°ä¸å®‰å…¨ç±»åˆ«ä¸­ï¼š¸Create the Contexts Fileµåˆ›å»ºä¸Šä¸‹æ–‡æ–‡ä»¶ÙKA contexts file should now be created as [.filename]#/etc/policy.contexts#:ÙNç°åœ¨åº”è¯¥åˆ›å»ºä¸€ä¸ªä¸Šä¸‹æ–‡æ–‡ä»¶ï¼Œè·¯å¾„ä¸º `/etc/policy.contexts` ã€‚ÚThis policy enforces security by setting restrictions on the flow of information.  In this specific configuration, users, including `root`, should never be allowed to access Nagios.  Configuration files and processes that are a part of Nagios will be completely self contained or jailed.Ùäè¯¥ç­–ç•¥é€šè¿‡å¯¹ä¿¡æ¯æµåŠ¨è®¾ç½®é™åˆ¶æ¥å¼ºåˆ¶æ‰§è¡Œå®‰å…¨æ€§ã€‚åœ¨è¿™ä¸ªç‰¹å®šçš„é…ç½®ä¸­ï¼ŒåŒ…æ‹¬ `root` åœ¨å†…çš„ç”¨æˆ·ä¸åº”è¯¥è¢«å…è®¸è®¿é—® Nagios ã€‚ Nagios çš„é…ç½®æ–‡ä»¶å’Œè¿›ç¨‹å°†å®Œå…¨è‡ªåŒ…å«æˆ–è¢«éš”ç¦»ã€‚Ù|This file will be read after running `setfsmac` on every file system.  This example sets the policy on the root file system:Ùuåœ¨å¯¹æ¯ä¸ªæ–‡ä»¶ç³»ç»Ÿè¿è¡Œ `setfsmac` ä¹‹åï¼Œå°†è¯»å–æ­¤æ–‡ä»¶ã€‚æ­¤ç¤ºä¾‹è®¾ç½®äº†æ ¹æ–‡ä»¶ç³»ç»Ÿçš„ç­–ç•¥ï¼šÙHNext, add these edits to the main section of [.filename]#/etc/mac.conf#:ÙUæ¥ä¸‹æ¥ï¼Œå°†è¿™äº›ç¼–è¾‘æ·»åŠ åˆ°ä¸»è¦éƒ¨åˆ†çš„ [.filename]#/etc/mac.conf# ä¸­ï¼š´Loader Configuration¯åŠ è½½å™¨é…ç½®ÙWTo finish the configuration, add the following lines to [.filename]#/boot/loader.conf#:ÙPè¦å®Œæˆé…ç½®ï¼Œè¯·å°†ä»¥ä¸‹è¡Œæ·»åŠ åˆ° [.filename]#/boot/loader.conf# ä¸­ï¼šÙÖAnd the following line to the network card configuration stored in [.filename]#/etc/rc.conf#.  If the primary network configuration is done via DHCP, this may need to be configured manually after every system boot:ÙÃå°†ä»¥ä¸‹è¡Œæ·»åŠ åˆ°å­˜å‚¨åœ¨ [.filename]#/etc/rc.conf# ä¸­çš„ç½‘ç»œå¡é…ç½®ä¸­ã€‚å¦‚æœä¸»è¦ç½‘ç»œé…ç½®æ˜¯é€šè¿‡ DHCP å®Œæˆçš„ï¼Œåˆ™å¯èƒ½éœ€è¦åœ¨æ¯æ¬¡ç³»ç»Ÿå¯åŠ¨åæ‰‹åŠ¨é…ç½®æ­¤é¡¹ï¼š¹Testing the Configuration¬æµ‹è¯•é…ç½®ÚQFirst, ensure that the web server and Nagios will not be started on system initialization and reboot.  Ensure that `root` cannot access any of the files in the Nagios configuration directory.  If `root` can list the contents of [.filename]#/var/spool/nagios#, something is wrong.  Instead, a "permission denied" error should be returned.Ú@é¦–å…ˆï¼Œç¡®ä¿åœ¨ç³»ç»Ÿåˆå§‹åŒ–å’Œé‡å¯æ—¶ä¸ä¼šå¯åŠ¨ Web æœåŠ¡å™¨å’Œ Nagios ã€‚ç¡®ä¿ `root` æ— æ³•è®¿é—® Nagios é…ç½®ç›®å½•ä¸­çš„ä»»ä½•æ–‡ä»¶ã€‚å¦‚æœ `root` å¯ä»¥åˆ—å‡º `.filename`#/var/spool/nagios# çš„å†…å®¹ï¼Œåˆ™è¡¨ç¤ºå‡ºç°äº†é—®é¢˜ã€‚ç›¸åï¼Œåº”è¿”å›â€œæƒé™è¢«æ‹’ç»ï¼ˆpermission deniedï¼‰â€é”™è¯¯ã€‚ÙCIf all seems well, Nagios, Apache, and Sendmail can now be started:ÙGå¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œç°åœ¨å¯ä»¥å¯åŠ¨ Nagiosã€Apache å’Œ Sendmailï¼šÙìDouble check to ensure that everything is working properly.  If not, check the log files for error messages.  If needed, use man:sysctl[8] to disable the man:mac_biba[4] security policy module and try starting everything again as usual.Ùşè¯·ä»”ç»†æ£€æŸ¥ä»¥ç¡®ä¿ä¸€åˆ‡æ­£å¸¸è¿è¡Œã€‚å¦‚æœä¸æ­£å¸¸ï¼Œè¯·æ£€æŸ¥æ—¥å¿—æ–‡ä»¶ä»¥æŸ¥æ‰¾é”™è¯¯ä¿¡æ¯ã€‚å¦‚æœéœ€è¦ï¼Œä½¿ç”¨ man:sysctl[8] å‘½ä»¤ç¦ç”¨ man:mac_biba[4] å®‰å…¨ç­–ç•¥æ¨¡å—ï¼Œç„¶åå°è¯•æŒ‰ç…§é€šå¸¸çš„æ–¹å¼é‡æ–°å¯åŠ¨æ‰€æœ‰å†…å®¹ã€‚ÙÑThe `root` user can still change the security enforcement and edit its configuration files.  The following command will permit the degradation of the security policy to a lower grade for a newly spawned shell:Ù˜`root` ç”¨æˆ·ä»ç„¶å¯ä»¥æ›´æ”¹å®‰å…¨æ‰§è¡Œå’Œç¼–è¾‘å…¶é…ç½®æ–‡ä»¶ã€‚ä»¥ä¸‹å‘½ä»¤å°†å…è®¸å°†å®‰å…¨ç­–ç•¥é™çº§ä¸ºæ–°ç”Ÿæˆçš„ shell çš„è¾ƒä½çº§åˆ«ï¼šÚTo block this from happening, force the user into a range using man:login.conf[5].  If man:setpmac[8] attempts to run a command outside of the compartment's range, an error will be returned and the command will not be executed.  In this case, set root to `biba/high(high-high)`.Úä¸ºäº†é˜»æ­¢è¿™ç§æƒ…å†µå‘ç”Ÿï¼Œå¯ä»¥ä½¿ç”¨ man:login.conf[5] å¼ºåˆ¶ç”¨æˆ·è¿›å…¥ä¸€ä¸ªèŒƒå›´ã€‚å¦‚æœ man:setpmac[8] å°è¯•åœ¨éš”ç¦»åŒºåŸŸèŒƒå›´ä¹‹å¤–è¿è¡Œå‘½ä»¤ï¼Œå°†è¿”å›é”™è¯¯å¹¶ä¸”ä¸æ‰§è¡Œè¯¥å‘½ä»¤ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå°† root è®¾ç½®ä¸º `biba/high(high-high)` ã€‚Ù!Troubleshooting the MAC Frameworkºè§£å†³ MAC æ¡†æ¶çš„é—®é¢˜ÙKThis section discusses common configuration errors and how to resolve them.Ù<æœ¬èŠ‚è®¨è®ºå¸¸è§çš„é…ç½®é”™è¯¯ä»¥åŠå¦‚ä½•è§£å†³å®ƒä»¬ã€‚ÙRThe `multilabel` flag does not stay enabled on the root ([.filename]#/#) partitionÙR`multilabel` æ ‡å¿—åœ¨æ ¹ï¼ˆ[.filename]#/# ï¼‰åˆ†åŒºä¸Šæ— æ³•ä¿æŒå¯ç”¨çŠ¶æ€ã€‚Ù5The following steps may resolve this transient error:Ù*ä»¥ä¸‹æ­¥éª¤å¯èƒ½è§£å†³æ­¤ä¸´æ—¶é”™è¯¯ï¼šÙNEdit [.filename]#/etc/fstab# and set the root partition to `ro` for read-only.Ù`ç¼–è¾‘ [.filename]#/etc/fstab# æ–‡ä»¶ï¼Œå¹¶å°†æ ¹åˆ†åŒºè®¾ç½®ä¸º `ro`ï¼Œä»¥å®ç°åªè¯»æ¨¡å¼ã€‚½Reboot into single user mode.Ù$é‡æ–°å¯åŠ¨è¿›å…¥å•ç”¨æˆ·æ¨¡å¼ã€‚Ù)Run `tunefs -l enable` on [.filename]#/#.Ù3åœ¨ [.filename]#/# ä¸Šè¿è¡Œ `tunefs -l enable` ã€‚²Reboot the system.¯é‡å¯ç³»ç»Ÿã€‚ÙwRun `mount -urw`[.filename]#/# and change the `ro` back to `rw` in [.filename]#/etc/fstab# and reboot the system again.Ùlè¿è¡Œ `mount -urw` å‘½ä»¤ï¼Œå¹¶åœ¨ `/etc/fstab` æ–‡ä»¶ä¸­å°† `ro` æ”¹å› `rw`ï¼Œç„¶åå†æ¬¡é‡å¯ç³»ç»Ÿã€‚ÙoDouble-check the output from `mount` to ensure that `multilabel` has been properly set on the root file system.Ùeè¯·ä»”ç»†æ£€æŸ¥ `mount` å‘½ä»¤çš„è¾“å‡ºï¼Œç¡®ä¿æ ¹æ–‡ä»¶ç³»ç»Ÿä¸Šçš„ `multilabel` å·²æ­£ç¡®è®¾ç½®ã€‚ÙGAfter establishing a secure environment with MAC, Xorg no longer startsÙ@åœ¨ä½¿ç”¨ MAC å»ºç«‹äº†å®‰å…¨ç¯å¢ƒä¹‹åï¼ŒXorg ä¸å†å¯åŠ¨ã€‚Ù‰This could be caused by the MAC `partition` policy or by a mislabeling in one of the MAC labeling policies.  To debug, try the following:Ù‚è¿™å¯èƒ½æ˜¯ç”± MAC `åˆ†åŒº` ç­–ç•¥æˆ– MAC æ ‡ç­¾ç­–ç•¥ä¸­çš„ä¸€ä¸ªæ ‡ç­¾é”™è¯¯å¼•èµ·çš„ã€‚ä¸ºäº†è°ƒè¯•ï¼Œè¯·å°è¯•ä»¥ä¸‹æ“ä½œï¼šÚCheck the error message. If the user is in the `insecure` class, the `partition` policy may be the culprit. Try setting the user's class back to the `default` class and rebuild the database with `cap_mkdb`. If this does not alleviate the problem, go to step two.Ùöæ£€æŸ¥é”™è¯¯æ¶ˆæ¯ã€‚å¦‚æœç”¨æˆ·åœ¨ `insecure` ç±»ä¸­ï¼Œ `partition` ç­–ç•¥å¯èƒ½æ˜¯é—®é¢˜çš„åŸå› ã€‚å°è¯•å°†ç”¨æˆ·çš„ç±»è®¾ç½®å› `default` ç±»ï¼Œå¹¶ä½¿ç”¨ `cap_mkdb` é‡æ–°æ„å»ºæ•°æ®åº“ã€‚å¦‚æœè¿™ä¸èƒ½è§£å†³é—®é¢˜ï¼Œè¯·è¿›è¡Œç¬¬äºŒæ­¥ã€‚ÙmDouble-check that the label policies are set correctly for the user, Xorg, and the [.filename]#/dev# entries.Ù]è¯·ä»”ç»†æ£€æŸ¥ç”¨æˆ·ã€Xorg å’Œ [.filename]#/dev# æ¡ç›®çš„æ ‡ç­¾ç­–ç•¥æ˜¯å¦è®¾ç½®æ­£ç¡®ã€‚Ù€If neither of these resolve the problem, send the error message and a description of the environment to the {freebsd-questions}.Ùrå¦‚æœä»¥ä¸Šä¸¤ç§æ–¹æ³•éƒ½ä¸èƒ½è§£å†³é—®é¢˜ï¼Œè¯·å°†é”™è¯¯ä¿¡æ¯å’Œç¯å¢ƒæè¿°å‘é€åˆ° {freebsd-questions} ã€‚Ù<The `_secure_path: unable to stat .login_conf` error appearsÙ<å‡ºç°äº† `_secure_path: æ— æ³•ç»Ÿè®¡ .login_conf` é”™è¯¯ã€‚ÚThis error can appear when a user attempts to switch from the `root` user to another user in the system.  This message usually occurs when the user has a higher label setting than that of the user they are attempting to become.  For instance, if `joe` has a default label of `biba/low` and `root` has a label of `biba/high`, `root` cannot view ``joe``'s home directory.  This will happen whether or not `root` has used `su` to become `joe` as the Biba integrity model will not permit `root` to view objects set at a lower integrity level.Úå½“ç”¨æˆ·å°è¯•ä» `root` ç”¨æˆ·åˆ‡æ¢åˆ°ç³»ç»Ÿä¸­çš„å¦ä¸€ä¸ªç”¨æˆ·æ—¶ï¼Œå¯èƒ½ä¼šå‡ºç°æ­¤é”™è¯¯ã€‚å½“ç”¨æˆ·çš„æ ‡ç­¾è®¾ç½®æ¯”ä»–ä»¬å°è¯•æˆä¸ºçš„ç”¨æˆ·çš„æ ‡ç­¾è®¾ç½®æ›´é«˜æ—¶ï¼Œé€šå¸¸ä¼šå‡ºç°æ­¤æ¶ˆæ¯ã€‚ä¾‹å¦‚ï¼Œå¦‚æœ `joe` çš„é»˜è®¤æ ‡ç­¾æ˜¯â€œ biba/low â€ï¼Œè€Œ `root` çš„æ ‡ç­¾æ˜¯ `biba/high`ï¼Œåˆ™ `root` æ— æ³•æŸ¥çœ‹ `joe` çš„ä¸»ç›®å½•ã€‚æ— è®º `root` æ˜¯å¦ä½¿ç”¨ `su` æˆä¸º `joe`ï¼Œéƒ½ä¼šå‘ç”Ÿè¿™ç§æƒ…å†µï¼Œå› ä¸º Biba å®Œæ•´æ€§æ¨¡å‹ä¸å…è®¸ `root` æŸ¥çœ‹è®¾ç½®åœ¨è¾ƒä½å®Œæ•´æ€§çº§åˆ«çš„å¯¹è±¡ã€‚Ù&The system no longer recognizes `root`¼ç³»ç»Ÿä¸å†è¯†åˆ« `root`ã€‚ÙGWhen this occurs, `whoami` returns `0` and `su` returns `who are you?`.ÙRå½“å‘ç”Ÿè¿™ç§æƒ…å†µæ—¶ï¼Œ`whoami` è¿”å› `0`ï¼Œè€Œ `su` è¿”å› `who are you?`ã€‚ÚJThis can happen if a labeling policy has been disabled by man:sysctl[8] or the policy module was unloaded.  If the policy is disabled, the login capabilities database needs to be reconfigured.  Double check [.filename]#/etc/login.conf# to ensure that all `label` options have been removed and rebuild the database with `cap_mkdb`.Ú:å¦‚æœä¸€ä¸ªæ ‡ç­¾ç­–ç•¥è¢« man:sysctl[8] ç¦ç”¨æˆ–è€…ç­–ç•¥æ¨¡å—è¢«å¸è½½ï¼Œå°±ä¼šå‘ç”Ÿè¿™ç§æƒ…å†µã€‚å¦‚æœç­–ç•¥è¢«ç¦ç”¨ï¼Œç™»å½•èƒ½åŠ›æ•°æ®åº“éœ€è¦é‡æ–°é…ç½®ã€‚è¯·ä»”ç»†æ£€æŸ¥ [.filename]#/etc/login.conf#ï¼Œç¡®ä¿æ‰€æœ‰çš„ `label` é€‰é¡¹éƒ½å·²ç»è¢«ç§»é™¤ï¼Œå¹¶ä½¿ç”¨ `cap_mkdb` é‡æ–°æ„å»ºæ•°æ®åº“ã€‚ÚµThis may also happen if a policy restricts access to [.filename]#master.passwd#.  This is usually caused by an administrator altering the file under a label which conflicts with the general policy being used by the system.  In these cases, the user information would be read by the system and access would be blocked as the file has inherited the new label.  Disable the policy using man:sysctl[8] and everything should return to normal.Ú{å¦‚æœç­–ç•¥é™åˆ¶å¯¹ [.filename]#master.passwd# çš„è®¿é—®ï¼Œä¹Ÿå¯èƒ½å‘ç”Ÿè¿™ç§æƒ…å†µã€‚è¿™é€šå¸¸æ˜¯ç”±äºç®¡ç†å‘˜åœ¨ä¸ç³»ç»Ÿä½¿ç”¨çš„é€šç”¨ç­–ç•¥å†²çªçš„æ ‡ç­¾ä¸‹æ›´æ”¹äº†æ–‡ä»¶è€Œå¼•èµ·çš„ã€‚åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œç³»ç»Ÿä¼šè¯»å–ç”¨æˆ·ä¿¡æ¯ï¼Œå¹¶ä¸”ç”±äºæ–‡ä»¶ç»§æ‰¿äº†æ–°çš„æ ‡ç­¾ï¼Œè®¿é—®å°†è¢«é˜»æ­¢ã€‚ä½¿ç”¨ man:sysctl[8] ç¦ç”¨è¯¥ç­–ç•¥ï¼Œä¸€åˆ‡åº”è¯¥æ¢å¤æ­£å¸¸ã€‚ÙÖFreeBSD has three firewalls built into the base system: PF, IPFW, and IPFILTER. This chapter covers how to define packet filtering rules, the differences between the firewalls built into FreeBSD and how to use themÙ¹FreeBSD åŸºæœ¬ç³»ç»Ÿå†…ç½®äº†ä¸‰ä¸ªé˜²ç«å¢™ï¼šPFã€IPFW å’Œ IPFILTERã€‚æœ¬ç« ä»‹ç»å¦‚ä½•å®šä¹‰æ•°æ®åŒ…è¿‡æ»¤è§„åˆ™ï¼ŒFreeBSD å†…ç½®é˜²ç«å¢™ä¹‹é—´çš„åŒºåˆ«ä»¥åŠå¦‚ä½•ä½¿ç”¨å®ƒä»¬ã€‚¹IV. Network Communication»ç¬¬å››éƒ¨åˆ†ï¼šç½‘ç»œé€šä¿¡µChapter 33. Firewalls´ç¬¬ 33 ç«  é˜²ç«å¢™ÚÂFirewalls make it possible to filter the incoming and outgoing traffic that flows through a system.  A firewall can use one or more sets of "rules" to inspect network packets as they come in or go out of network connections and either allows the traffic through or blocks it.  The rules of a firewall can inspect one or more characteristics of the packets such as the protocol type, source or destination host address, and source or destination port.ÚSé˜²ç«å¢™ä½¿å¾—è¿‡æ»¤é€šè¿‡ç³»ç»ŸæµåŠ¨çš„è¿›å‡ºæµé‡æˆä¸ºå¯èƒ½ã€‚é˜²ç«å¢™å¯ä»¥ä½¿ç”¨ä¸€ä¸ªæˆ–å¤šä¸ªâ€œè§„åˆ™â€é›†æ¥æ£€æŸ¥è¿›å‡ºç½‘ç»œè¿æ¥çš„ç½‘ç»œæ•°æ®åŒ…ï¼Œå¹¶å…è®¸æµé‡é€šè¿‡æˆ–é˜»æ­¢å®ƒã€‚é˜²ç«å¢™çš„è§„åˆ™å¯ä»¥æ£€æŸ¥æ•°æ®åŒ…çš„ä¸€ä¸ªæˆ–å¤šä¸ªç‰¹å¾ï¼Œå¦‚åè®®ç±»å‹ã€æºæˆ–ç›®æ ‡ä¸»æœºåœ°å€ä»¥åŠæºæˆ–ç›®æ ‡ç«¯å£ã€‚ÙpFirewalls can enhance the security of a host or a network.  They can be used to do one or more of the following:Ùié˜²ç«å¢™å¯ä»¥å¢å¼ºä¸»æœºæˆ–ç½‘ç»œçš„å®‰å…¨æ€§ã€‚å®ƒä»¬å¯ä»¥ç”¨äºæ‰§è¡Œä»¥ä¸‹ä¸€é¡¹æˆ–å¤šé¡¹åŠŸèƒ½ï¼šÙ„Protect and insulate the applications, services, and machines of an internal network from unwanted traffic from the public Internet.Ùxä¿æŠ¤å’Œéš”ç¦»å†…éƒ¨ç½‘ç»œä¸­çš„åº”ç”¨ç¨‹åºã€æœåŠ¡å’Œæœºå™¨ï¼Œä»¥é˜²æ­¢æ¥è‡ªå…¬å…±äº’è”ç½‘çš„ä¸å¿…è¦çš„æµé‡ã€‚Ù^Limit or disable access from hosts of the internal network to services of the public Internet.ÙBé™åˆ¶æˆ–ç¦æ­¢å†…éƒ¨ç½‘ç»œä¸»æœºè®¿é—®å…¬å…±äº’è”ç½‘çš„æœåŠ¡ã€‚ÙúSupport network address translation (NAT), which allows an internal network to use private IP addresses and share a single connection to the public Internet using either a single IP address or a shared pool of automatically assigned public addresses.Ù¹æ”¯æŒç½‘ç»œåœ°å€è½¬æ¢ï¼ˆNATï¼‰ï¼Œå…è®¸å†…éƒ¨ç½‘ç»œä½¿ç”¨ç§æœ‰ IP åœ°å€ï¼Œå¹¶ä½¿ç”¨å•ä¸ª IP åœ°å€æˆ–å…±äº«çš„è‡ªåŠ¨åˆ†é…çš„å…¬å…±åœ°å€æ± ä¸å…¬å…±äº’è”ç½‘å»ºç«‹å•ä¸€è¿æ¥ã€‚ÚÄFreeBSD has three firewalls built into the base system: PF, IPFW, and IPFILTER, also known as IPF.  FreeBSD also provides two traffic shapers for controlling bandwidth usage: man:altq[4] and man:dummynet[4].  ALTQ has traditionally been closely tied with PF and dummynet with IPFW.  Each firewall uses rules to control the access of packets to and from a FreeBSD system, although they go about it in different ways and each has a different rule syntax.Ú¦FreeBSD åŸºæœ¬ç³»ç»Ÿå†…ç½®äº†ä¸‰ä¸ªé˜²ç«å¢™ï¼šPFã€IPFW å’Œ IPFILTERï¼ˆä¹Ÿç§°ä¸º IPFï¼‰ã€‚FreeBSD è¿˜æä¾›äº†ä¸¤ä¸ªæµé‡æ•´å½¢å™¨ï¼Œç”¨äºæ§åˆ¶å¸¦å®½ä½¿ç”¨ï¼šman:altq[4] å’Œ man:dummynet[4]ã€‚ALTQ é€šå¸¸ä¸ PF ç´§å¯†å…³è”ï¼Œè€Œ dummynet ä¸ IPFW å…³è”ã€‚æ¯ä¸ªé˜²ç«å¢™ä½¿ç”¨è§„åˆ™æ¥æ§åˆ¶æ•°æ®åŒ…å¯¹ FreeBSD ç³»ç»Ÿçš„è®¿é—®ï¼Œå°½ç®¡å®ƒä»¬çš„å®ç°æ–¹å¼ä¸åŒï¼Œå¹¶ä¸”æ¯ä¸ªé˜²ç«å¢™éƒ½æœ‰ä¸åŒçš„è§„åˆ™è¯­æ³•ã€‚Ù¾FreeBSD provides multiple firewalls in order to meet the different requirements and preferences for a wide variety of users.  Each user should evaluate which firewall best meets their needs.Ù’FreeBSD æä¾›å¤šä¸ªé˜²ç«å¢™ï¼Œä»¥æ»¡è¶³å„ç§ç”¨æˆ·çš„ä¸åŒéœ€æ±‚å’Œåå¥½ã€‚æ¯ä¸ªç”¨æˆ·åº”è¯¥è¯„ä¼°å“ªä¸ªé˜²ç«å¢™æœ€é€‚åˆä»–ä»¬çš„éœ€æ±‚ã€‚Ù%How to define packet filtering rules.Ù$å¦‚ä½•å®šä¹‰æ•°æ®åŒ…è¿‡æ»¤è§„åˆ™ã€‚Ù9The differences between the firewalls built into FreeBSD.Ù#FreeBSD å†…ç½®é˜²ç«å¢™çš„åŒºåˆ«ã€‚Ù)How to use and configure the PF firewall.Ù%å¦‚ä½•ä½¿ç”¨å’Œé…ç½® PF é˜²ç«å¢™ã€‚Ù+How to use and configure the IPFW firewall.Ù'å¦‚ä½•ä½¿ç”¨å’Œé…ç½® IPFW é˜²ç«å¢™ã€‚Ù/How to use and configure the IPFILTER firewall.Ù+å¦‚ä½•ä½¿ç”¨å’Œé…ç½® IPFILTER é˜²ç«å¢™ã€‚Ù/Understand basic FreeBSD and Internet concepts.Ù-äº†è§£åŸºæœ¬çš„ FreeBSD å’Œäº’è”ç½‘æ¦‚å¿µã€‚Ú|Since all firewalls are based on inspecting the values of selected packet control fields, the creator of the firewall ruleset must have an understanding of how TCP/IP works, what the different values in the packet control fields are, and how these values are used in a normal session conversation.  For a good introduction, refer to http://www.ipprimer.com[Daryl's TCP/IP Primer].ÚWç”±äºæ‰€æœ‰é˜²ç«å¢™éƒ½æ˜¯åŸºäºæ£€æŸ¥é€‰å®šæ•°æ®åŒ…æ§åˆ¶å­—æ®µçš„å€¼ï¼Œå› æ­¤é˜²ç«å¢™è§„åˆ™é›†çš„åˆ›å»ºè€…å¿…é¡»äº†è§£ TCP/IP çš„å·¥ä½œåŸç†ï¼Œæ•°æ®åŒ…æ§åˆ¶å­—æ®µä¸­ä¸åŒå€¼çš„å«ä¹‰ï¼Œä»¥åŠè¿™äº›å€¼åœ¨æ­£å¸¸ä¼šè¯ä¸­çš„ä½¿ç”¨æ–¹å¼ã€‚å¯¹äºä¸€ä¸ªå¾ˆå¥½çš„ä»‹ç»ï¼Œè¯·å‚è€ƒ http://www.ipprimer.com[Daryl çš„ TCP/IP å…¥é—¨æŒ‡å—] ã€‚±Firewall Concepts¯é˜²ç«å¢™æ¦‚å¿µÚºA ruleset contains a group of rules which pass or block packets based on the values contained in the packet.  The bi-directional exchange of packets between hosts comprises a session conversation.  The firewall ruleset processes both the packets arriving from the public Internet, as well as the packets produced by the system as a response to them.  Each TCP/IP service is predefined by its protocol and listening port.  Packets destined for a specific service originate from the source address using an unprivileged port and target the specific service port on the destination address.  All the above parameters can be used as selection criteria to create rules which will pass or block services.Úä¸€ä¸ªè§„åˆ™é›†åŒ…å«ä¸€ç»„è§„åˆ™ï¼Œæ ¹æ®æ•°æ®åŒ…ä¸­åŒ…å«çš„å€¼æ¥é€šè¿‡æˆ–é˜»æ­¢æ•°æ®åŒ…ã€‚ä¸»æœºä¹‹é—´çš„åŒå‘æ•°æ®åŒ…äº¤æ¢æ„æˆä¸€ä¸ªä¼šè¯å¯¹è¯ã€‚é˜²ç«å¢™è§„åˆ™é›†å¤„ç†æ¥è‡ªå…¬å…±äº’è”ç½‘çš„æ•°æ®åŒ…ä»¥åŠç³»ç»Ÿä½œä¸ºå¯¹å…¶å“åº”è€Œäº§ç”Ÿçš„æ•°æ®åŒ…ã€‚æ¯ä¸ª TCP/IP æœåŠ¡éƒ½ç”±å…¶åè®®å’Œç›‘å¬ç«¯å£é¢„å®šä¹‰ã€‚ç›®æ ‡ä¸ºç‰¹å®šæœåŠ¡çš„æ•°æ®åŒ…æºè‡ªæºåœ°å€ä½¿ç”¨éç‰¹æƒç«¯å£ï¼Œå¹¶ä¸”ç›®æ ‡åœ°å€ä¸Šçš„ç‰¹å®šæœåŠ¡ç«¯å£ã€‚æ‰€æœ‰ä¸Šè¿°å‚æ•°éƒ½å¯ä»¥ç”¨ä½œé€‰æ‹©æ¡ä»¶æ¥åˆ›å»ºå°†é€šè¿‡æˆ–é˜»æ­¢æœåŠ¡çš„è§„åˆ™ã€‚Ú$To lookup unknown port numbers, refer to [.filename]#/etc/services#.  Alternatively, visit http://en.wikipedia.org/wiki/List_of_TCP_and_UDP_port_numbers[http://en.wikipedia.org/wiki/List_of_TCP_and_UDP_port_numbers] and do a port number lookup to find the purpose of a particular port number.Úè¦æŸ¥æ‰¾æœªçŸ¥çš„ç«¯å£å·ï¼Œè¯·å‚è€ƒ [.filename]#/etc/services#ã€‚æˆ–è€…ï¼Œè®¿é—® [http://en.wikipedia.org/wiki/List_of_TCP_and_UDP_port_numbers](http://en.wikipedia.org/wiki/List_of_TCP_and_UDP_port_numbers)ï¼Œè¿›è¡Œç«¯å£å·æŸ¥æ‰¾ä»¥æ‰¾åˆ°ç‰¹å®šç«¯å£å·çš„ç”¨é€”ã€‚ÙšCheck out this link for http://web.archive.org/web/20150803024617/http://www.sans.org/security-resources/idfaq/oddports.php[port numbers used by Trojans].Ùè¯·æŸ¥çœ‹æ­¤é“¾æ¥ï¼Œäº†è§£ http://web.archive.org/web/20150803024617/http://www.sans.org/security-resources/idfaq/oddports.php[Trojans ä½¿ç”¨çš„ç«¯å£å·]ã€‚ÚYFTP has two modes: active mode and passive mode.  The difference is in how the data channel is acquired.  Passive mode is more secure as the data channel is acquired by the ordinal ftp session requester.  For a good explanation of FTP and the different modes, see http://www.slacksite.com/other/ftp.html[http://www.slacksite.com/other/ftp.html].ÚIFTP æœ‰ä¸¤ç§æ¨¡å¼ï¼šä¸»åŠ¨æ¨¡å¼å’Œè¢«åŠ¨æ¨¡å¼ã€‚å®ƒä»¬çš„åŒºåˆ«åœ¨äºæ•°æ®é€šé“çš„è·å–æ–¹å¼ã€‚è¢«åŠ¨æ¨¡å¼æ›´å®‰å…¨ï¼Œå› ä¸ºæ•°æ®é€šé“æ˜¯ç”±åŸå§‹çš„ FTP ä¼šè¯è¯·æ±‚è€…è·å–çš„ã€‚å…³äº FTP å’Œä¸åŒæ¨¡å¼çš„è¯¦ç»†è§£é‡Šï¼Œè¯·å‚è§ http://www.slacksite.com/other/ftp.html[http://www.slacksite.com/other/ftp.html]ã€‚ÚA firewall ruleset can be either "exclusive" or "inclusive".  An exclusive firewall allows all traffic through except for the traffic matching the ruleset.  An inclusive firewall does the reverse as it only allows traffic matching the rules through and blocks everything else.Úé˜²ç«å¢™è§„åˆ™é›†å¯ä»¥æ˜¯â€œæ’ä»–æ€§ï¼ˆexclusiveï¼‰â€æˆ–â€œåŒ…å®¹æ€§ï¼ˆinclusiveï¼‰â€ã€‚æ’ä»–æ€§é˜²ç«å¢™å…è®¸æ‰€æœ‰æµé‡é€šè¿‡ï¼Œé™¤äº†ä¸è§„åˆ™é›†åŒ¹é…çš„æµé‡ã€‚è€ŒåŒ…å®¹æ€§é˜²ç«å¢™åˆ™ç›¸åï¼Œå®ƒåªå…è®¸ä¸è§„åˆ™åŒ¹é…çš„æµé‡é€šè¿‡ï¼Œé˜»æ­¢å…¶ä»–æ‰€æœ‰æµé‡ã€‚ÚÙAn inclusive firewall offers better control of the outgoing traffic, making it a better choice for systems that offer services to the public Internet.  It also controls the type of traffic originating from the public Internet that can gain access to a private network.  All traffic that does not match the rules is blocked and logged.  Inclusive firewalls are generally safer than exclusive firewalls because they significantly reduce the risk of allowing unwanted traffic.Úä¸€ä¸ªåŒ…å®¹æ€§é˜²ç«å¢™å¯ä»¥æ›´å¥½åœ°æ§åˆ¶å‡ºç«™æµé‡ï¼Œå› æ­¤å¯¹äºå‘å…¬å…±äº’è”ç½‘æä¾›æœåŠ¡çš„ç³»ç»Ÿæ¥è¯´æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚å®ƒè¿˜å¯ä»¥æ§åˆ¶æ¥è‡ªå…¬å…±äº’è”ç½‘çš„æµé‡ç±»å‹ï¼Œä»¥ä¾¿è®¿é—®ç§æœ‰ç½‘ç»œã€‚æ‰€æœ‰ä¸ç¬¦åˆè§„åˆ™çš„æµé‡éƒ½ä¼šè¢«é˜»æ­¢å¹¶è®°å½•ã€‚åŒ…å®¹æ€§é˜²ç«å¢™é€šå¸¸æ¯”æ’ä»–æ€§é˜²ç«å¢™æ›´å®‰å…¨ï¼Œå› ä¸ºå®ƒä»¬æ˜¾è‘—é™ä½äº†å…è®¸ä¸éœ€è¦çš„æµé‡çš„é£é™©ã€‚ÙrUnless noted otherwise, all configuration and example rulesets in this chapter create inclusive firewall rulesets.Ùfé™¤éå¦æœ‰è¯´æ˜ï¼Œæœ¬ç« ä¸­çš„æ‰€æœ‰é…ç½®å’Œç¤ºä¾‹è§„åˆ™é›†éƒ½åˆ›å»ºåŒ…å®¹æ€§é˜²ç«å¢™è§„åˆ™é›†ã€‚ÙİSecurity can be tightened further using a "stateful firewall".  This type of firewall keeps track of open connections and only allows traffic which either matches an existing connection or opens a new, allowed connection.ÙÚå¯ä»¥ä½¿ç”¨â€œæœ‰çŠ¶æ€é˜²ç«å¢™ï¼ˆstateful firewallï¼‰â€è¿›ä¸€æ­¥åŠ å¼ºå®‰å…¨æ€§ã€‚è¿™ç§ç±»å‹çš„é˜²ç«å¢™ä¼šè·Ÿè¸ªæ‰“å¼€çš„è¿æ¥ï¼Œå¹¶ä¸”åªå…è®¸ä¸ç°æœ‰è¿æ¥åŒ¹é…æˆ–æ‰“å¼€æ–°çš„å…è®¸è¿æ¥çš„æµé‡é€šè¿‡ã€‚Ú®Stateful filtering treats traffic as a bi-directional exchange of packets comprising a session.  When state is specified on a matching rule the firewall dynamically generates internal rules for each anticipated packet being exchanged during the session.  It has sufficient matching capabilities to determine if a packet is valid for a session.  Any packets that do not properly fit the session template are automatically rejected.ÚDæœ‰çŠ¶æ€è¿‡æ»¤å°†æµé‡è§†ä¸ºä¼šè¯ä¸­çš„åŒå‘æ•°æ®åŒ…äº¤æ¢ã€‚å½“åœ¨åŒ¹é…è§„åˆ™ä¸ŠæŒ‡å®šçŠ¶æ€æ—¶ï¼Œé˜²ç«å¢™ä¼šåŠ¨æ€ç”Ÿæˆæ¯ä¸ªä¼šè¯æœŸé—´é¢„æœŸäº¤æ¢çš„æ•°æ®åŒ…çš„å†…éƒ¨è§„åˆ™ã€‚å®ƒå…·æœ‰è¶³å¤Ÿçš„åŒ¹é…èƒ½åŠ›æ¥ç¡®å®šæ•°æ®åŒ…æ˜¯å¦é€‚ç”¨äºä¼šè¯ã€‚ä»»ä½•ä¸ç¬¦åˆä¼šè¯æ¨¡æ¿çš„æ•°æ®åŒ…éƒ½ä¼šè¢«è‡ªåŠ¨æ‹’ç»ã€‚ÙGWhen the session completes, it is removed from the dynamic state table.Ù9å½“ä¼šè¯å®Œæˆæ—¶ï¼Œå®ƒå°†ä»åŠ¨æ€çŠ¶æ€è¡¨ä¸­ç§»é™¤ã€‚Ú®Stateful filtering allows one to focus on blocking/passing new sessions.  If the new session is passed, all its subsequent packets are allowed automatically and any impostor packets are automatically rejected.  If a new session is blocked, none of its subsequent packets are allowed.  Stateful filtering provides advanced matching abilities capable of defending against the flood of different attack methods employed by attackers.Úiæœ‰çŠ¶æ€è¿‡æ»¤å…è®¸æˆ‘ä»¬ä¸“æ³¨äºé˜»æ­¢/é€šè¿‡æ–°çš„ä¼šè¯ã€‚å¦‚æœæ–°çš„ä¼šè¯è¢«é€šè¿‡ï¼Œæ‰€æœ‰åç»­çš„æ•°æ®åŒ…å°†è‡ªåŠ¨è¢«å…è®¸é€šè¿‡ï¼Œä»»ä½•å†’å……çš„æ•°æ®åŒ…å°†è‡ªåŠ¨è¢«æ‹’ç»ã€‚å¦‚æœæ–°çš„ä¼šè¯è¢«é˜»æ­¢ï¼Œå®ƒçš„æ‰€æœ‰åç»­æ•°æ®åŒ…éƒ½å°†è¢«ç¦æ­¢ã€‚æœ‰çŠ¶æ€è¿‡æ»¤æä¾›äº†é«˜çº§åŒ¹é…èƒ½åŠ›ï¼Œèƒ½å¤ŸæŠµå¾¡æ”»å‡»è€…ä½¿ç”¨çš„å„ç§æ”»å‡»æ–¹æ³•ã€‚ÚLNAT stands for _Network Address Translation_.  NAT function enables the private LAN behind the firewall to share a single ISP-assigned IP address, even if that address is dynamically assigned.  NAT allows each computer in the LAN to have Internet access, without having to pay the ISP for multiple Internet accounts or IP addresses.Ú&NAT ä»£è¡¨ç½‘ç»œåœ°å€è½¬æ¢ã€‚NAT åŠŸèƒ½ä½¿å¾—é˜²ç«å¢™åé¢çš„ç§æœ‰å±€åŸŸç½‘èƒ½å¤Ÿå…±äº«ä¸€ä¸ªç”± ISP åˆ†é…çš„ IP åœ°å€ï¼Œå³ä½¿è¯¥åœ°å€æ˜¯åŠ¨æ€åˆ†é…çš„ã€‚NAT å…è®¸å±€åŸŸç½‘ä¸­çš„æ¯å°è®¡ç®—æœºéƒ½èƒ½å¤Ÿè®¿é—®äº’è”ç½‘ï¼Œè€Œæ— éœ€ä¸ºå¤šä¸ªäº’è”ç½‘è´¦æˆ·æˆ– IP åœ°å€å‘ ISP ä»˜è´¹ã€‚ÙóNAT will automatically translate the private LAN IP address for each system on the LAN to the single public IP address as packets exit the firewall bound for the public Internet.  It also performs the reverse translation for returning packets.ÙßNAT ä¼šè‡ªåŠ¨å°†å±€åŸŸç½‘ä¸Šæ¯ä¸ªç³»ç»Ÿçš„ç§æœ‰ LAN IP åœ°å€è½¬æ¢ä¸ºå•ä¸ªå…¬å…± IP åœ°å€ï¼Œä»¥ä¾¿åœ¨é€šè¿‡é˜²ç«å¢™å‘é€åˆ°å…¬å…±äº’è”ç½‘çš„æ•°æ®åŒ…ä¸­ä½¿ç”¨ã€‚å®ƒè¿˜ä¼šå¯¹è¿”å›çš„æ•°æ®åŒ…æ‰§è¡Œç›¸åçš„è½¬æ¢ã€‚ÙÂAccording to RFC 1918, the following IP address ranges are reserved for private networks which will never be routed directly to the public Internet, and therefore are available for use with NAT:Ù¢æ ¹æ® RFC 1918ï¼Œä»¥ä¸‹ IP åœ°å€èŒƒå›´è¢«ä¿ç•™ç”¨äºç§æœ‰ç½‘ç»œï¼Œè¿™äº›åœ°å€å°†ä¸ä¼šç›´æ¥è·¯ç”±åˆ°å…¬å…±äº’è”ç½‘ï¼Œå› æ­¤å¯ç”¨äºä¸ NAT ä¸€èµ·ä½¿ç”¨ï¼š­`10.0.0.0/8`.¯`10.0.0.0/8`ã€‚°`172.16.0.0/12`.²`172.16.0.0/12`ã€‚±`192.168.0.0/16`.³`192.168.0.0/16`ã€‚ÚWhen working with the firewall rules, be _very careful_.  Some configurations _can lock the administrator out_ of the server.  To be on the safe side, consider performing the initial firewall configuration from the local console rather than doing it remotely over ssh.ÙÔåœ¨å¤„ç†é˜²ç«å¢™è§„åˆ™æ—¶ï¼Œè¯·éå¸¸å°å¿ƒã€‚æŸäº›é…ç½®å¯èƒ½ä¼šå°†ç®¡ç†å‘˜é”åœ¨æœåŠ¡å™¨å¤–ã€‚ä¸ºäº†å®‰å…¨èµ·è§ï¼Œè€ƒè™‘ä»æœ¬åœ°æ§åˆ¶å°æ‰§è¡Œåˆå§‹é˜²ç«å¢™é…ç½®ï¼Œè€Œä¸æ˜¯é€šè¿‡ ssh è¿œç¨‹æ‰§è¡Œã€‚ÚSince FreeBSD 5.3, a ported version of OpenBSD's PF firewall has been included as an integrated part of the base system.  PF is a complete, full-featured firewall that has optional support for ALTQ (Alternate Queuing), which provides Quality of Service (QoS).Úè‡ªä» FreeBSD 5.3 ç‰ˆæœ¬ä»¥æ¥ï¼ŒOpenBSD çš„ PF é˜²ç«å¢™çš„ç§»æ¤ç‰ˆæœ¬å·²ç»ä½œä¸ºåŸºæœ¬ç³»ç»Ÿçš„ä¸€éƒ¨åˆ†åŒ…å«åœ¨å…¶ä¸­ã€‚PF æ˜¯ä¸€ä¸ªå®Œæ•´çš„ã€åŠŸèƒ½é½å…¨çš„é˜²ç«å¢™ï¼Œå¯é€‰æ‹©æ€§åœ°æ”¯æŒ ALTQï¼ˆAlternate Queuing ï¼‰ï¼Œæä¾›äº†æœåŠ¡è´¨é‡ï¼ˆQoSï¼‰åŠŸèƒ½ã€‚ÙáThe OpenBSD Project maintains the definitive reference for PF in the http://www.openbsd.org/faq/pf/[PF FAQ].  Peter Hansteen maintains a thorough PF tutorial at http://home.nuug.no/\~peter/pf/[http://home.nuug.no/~peter/pf/].Ù×OpenBSD é¡¹ç›®åœ¨ http://www.openbsd.org/faq/pf/[PF FAQ] ä¸­ç»´æŠ¤äº† PF çš„æƒå¨å‚è€ƒã€‚Peter Hansteen åœ¨ http://home.nuug.no/\~ peter/pf/[http://home.nuug.no/~peter/pf/] ä¸Šç»´æŠ¤äº†ä¸€ä¸ªè¯¦å°½çš„ PF æ•™ç¨‹ã€‚ÚWhen reading the http://www.openbsd.org/faq/pf/[PF FAQ], keep in mind that FreeBSD's version of PF has diverged substantially from the upstream OpenBSD version over the years.  Not all features work the same way on FreeBSD as they do in OpenBSD and vice versa.Ùîé˜…è¯» http://www.openbsd.org/faq/pf/[PF FAQ] æ—¶ï¼Œè¯·è®°ä½å¤šå¹´æ¥ï¼ŒFreeBSD çš„ PF ç‰ˆæœ¬ä¸ä¸Šæ¸¸çš„ OpenBSD ç‰ˆæœ¬æœ‰å¾ˆå¤§çš„å·®å¼‚ã€‚åœ¨ FreeBSD ä¸Šï¼Œä¸æ˜¯æ‰€æœ‰çš„åŠŸèƒ½éƒ½ä¸ OpenBSD ä¸Šçš„å·¥ä½œæ–¹å¼ç›¸åŒï¼Œåä¹‹äº¦ç„¶ã€‚ÙÀThe {freebsd-pf} is a good place to ask questions about configuring and running the PF firewall.  Check the mailing list archives before asking a question as it may have already been answered.Ù¿{freebsd-pf} æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„åœ°æ–¹ï¼Œå¯ä»¥è¯¢é—®æœ‰å…³é…ç½®å’Œè¿è¡Œ PF é˜²ç«å¢™çš„é—®é¢˜ã€‚åœ¨æé—®ä¹‹å‰ï¼Œè¯·å…ˆæŸ¥çœ‹é‚®ä»¶åˆ—è¡¨çš„å­˜æ¡£ï¼Œå› ä¸ºå¯èƒ½å·²ç»æœ‰äººå›ç­”è¿‡äº†ã€‚Ù¿This section of the Handbook focuses on PF as it pertains to FreeBSD.  It demonstrates how to enable PF and ALTQ.  It also provides several examples for creating rulesets on a FreeBSD system.Ù«æœ¬æ‰‹å†Œçš„è¿™ä¸€éƒ¨åˆ†é‡ç‚¹ä»‹ç»äº†ä¸ FreeBSD ç›¸å…³çš„ PFã€‚å®ƒæ¼”ç¤ºäº†å¦‚ä½•å¯ç”¨ PF å’Œ ALTQã€‚è¿˜æä¾›äº†åœ¨ FreeBSD ç³»ç»Ÿä¸Šåˆ›å»ºè§„åˆ™é›†çš„å‡ ä¸ªç¤ºä¾‹ã€‚«Enabling PF©å¯ç”¨ PFÙ“To use PF, its kernel module must be first loaded.  This section describes the entries that can be added to [.filename]#/etc/rc.conf# to enable PF.Ùè¦ä½¿ç”¨ PFï¼Œé¦–å…ˆå¿…é¡»åŠ è½½å…¶å†…æ ¸æ¨¡å—ã€‚æœ¬èŠ‚æè¿°äº†å¯ä»¥æ·»åŠ åˆ° [.filename]#/etc/rc.conf# æ–‡ä»¶ä¸­ä»¥å¯ç”¨ PF çš„æ¡ç›®ã€‚Ù=Start by adding `pf_enable=yes` to [.filename]#/etc/rc.conf#:ÙCé¦–å…ˆï¼Œåœ¨ [.filename]#/etc/rc.conf# ä¸­æ·»åŠ  `pf_enable=yes`ã€‚ÙËAdditional options, described in man:pfctl[8], can be passed to PF when it is started.  Add or change this entry in [.filename]#/etc/rc.conf# and specify any required flags between the two quotes (`""`):ÙÇå½“å¯åŠ¨ PF æ—¶ï¼Œå¯ä»¥ä¼ é€’åœ¨ man:pfctl[8] ä¸­æè¿°çš„å…¶ä»–é€‰é¡¹ã€‚åœ¨ [.filename]#/etc/rc.conf# ä¸­æ·»åŠ æˆ–æ›´æ”¹æ­¤æ¡ç›®ï¼Œå¹¶åœ¨ä¸¤ä¸ªå¼•å·ï¼ˆ`""`ï¼‰ä¹‹é—´æŒ‡å®šä»»ä½•æ‰€éœ€çš„æ ‡å¿—ã€‚ÚoPF will not start if it cannot find its ruleset configuration file.  By default, FreeBSD does not ship with a ruleset and there is no [.filename]#/etc/pf.conf#.  Example rulesets can be found in [.filename]#/usr/share/examples/pf/#.  If a custom ruleset has been saved somewhere else, add a line to [.filename]#/etc/rc.conf# which specifies the full path to the file:Ú|å¦‚æœ PF æ— æ³•æ‰¾åˆ°å…¶è§„åˆ™é›†é…ç½®æ–‡ä»¶ï¼Œåˆ™ä¸ä¼šå¯åŠ¨ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒFreeBSD ä¸æä¾›è§„åˆ™é›†ï¼Œå¹¶ä¸”æ²¡æœ‰ [.filename]#/etc/pf.conf# æ–‡ä»¶ã€‚ç¤ºä¾‹è§„åˆ™é›†å¯ä»¥åœ¨ [.filename]#/usr/share/examples/pf/# ä¸­æ‰¾åˆ°ã€‚å¦‚æœå·²ç»å°†è‡ªå®šä¹‰è§„åˆ™é›†ä¿å­˜åœ¨å…¶ä»–ä½ç½®ï¼Œè¯·åœ¨ [.filename]#/etc/rc.conf# æ–‡ä»¶ä¸­æ·»åŠ ä¸€è¡Œï¼ŒæŒ‡å®šæ–‡ä»¶çš„å®Œæ•´è·¯å¾„ï¼šÙ„Logging support for PF is provided by man:pflog[4].  To enable logging support, add `pflog_enable=yes` to [.filename]#/etc/rc.conf#:Ù¯PF æä¾›äº†æ—¥å¿—è®°å½•æ”¯æŒï¼Œå¯ä»¥é€šè¿‡ man:pflog[4] æ¥æŸ¥çœ‹ã€‚è¦å¯ç”¨æ—¥å¿—è®°å½•æ”¯æŒï¼Œè¯·å°† `pflog_enable=yes` æ·»åŠ åˆ° [.filename]#/etc/rc.conf# æ–‡ä»¶ä¸­ã€‚Ù£The following lines can also be added to change the default location of the log file or to specify any additional flags to pass to man:pflog[4] when it is started:Ùƒè¿˜å¯ä»¥æ·»åŠ ä»¥ä¸‹è¡Œæ¥æ›´æ”¹æ—¥å¿—æ–‡ä»¶çš„é»˜è®¤ä½ç½®ï¼Œæˆ–è€…æŒ‡å®šåœ¨å¯åŠ¨ man:pflog[4] æ—¶ä¼ é€’çš„ä»»ä½•å…¶ä»–æ ‡å¿—ï¼šÙFinally, if there is a LAN behind the firewall and packets need to be forwarded for the computers on the LAN, or NAT is required, enable the following option:Ù´æœ€åï¼Œå¦‚æœé˜²ç«å¢™åé¢æœ‰ä¸€ä¸ªå±€åŸŸç½‘ï¼Œå¹¶ä¸”éœ€è¦è½¬å‘å±€åŸŸç½‘ä¸Šçš„è®¡ç®—æœºçš„æ•°æ®åŒ…ï¼Œæˆ–è€…éœ€è¦è¿›è¡Œç½‘ç»œåœ°å€è½¬æ¢ï¼ˆNATï¼‰ï¼Œè¯·å¯ç”¨ä»¥ä¸‹é€‰é¡¹ï¼šÙPAfter saving the needed edits, PF can be started with logging support by typing:ÙZä¿å­˜æ‰€éœ€çš„ç¼–è¾‘åï¼Œå¯ä»¥é€šè¿‡è¾“å…¥ä»¥ä¸‹å‘½ä»¤å¯åŠ¨å¸¦æœ‰æ—¥å¿—æ”¯æŒçš„ PFï¼šÚtBy default, PF reads its configuration rules from [.filename]#/etc/pf.conf# and modifies, drops, or passes packets according to the rules or definitions specified in this file.  The FreeBSD installation includes several sample files located in [.filename]#/usr/share/examples/pf/#.  Refer to the http://www.openbsd.org/faq/pf/[PF FAQ] for complete coverage of PF rulesets.ÚSé»˜è®¤æƒ…å†µä¸‹ï¼ŒPF ä» [.filename]#/etc/pf.conf# è¯»å–å…¶é…ç½®è§„åˆ™ï¼Œå¹¶æ ¹æ®è¯¥æ–‡ä»¶ä¸­æŒ‡å®šçš„è§„åˆ™æˆ–å®šä¹‰ä¿®æ”¹ã€ä¸¢å¼ƒæˆ–é€šè¿‡æ•°æ®åŒ…ã€‚FreeBSD å®‰è£…åŒ…å«ä½äº [.filename]#/usr/share/examples/pf/# çš„å‡ ä¸ªç¤ºä¾‹æ–‡ä»¶ã€‚è¯·å‚è€ƒ http://www.openbsd.org/faq/pf/[PF FAQ] ä»¥è·å–å®Œæ•´çš„ PF è§„åˆ™é›†è¦†ç›–èŒƒå›´ã€‚Ù™To control PF, use `pfctl`.  <<pfctl>> summarizes some useful options to this command.  Refer to man:pfctl[8] for a description of all available options:Ùè¦æ§åˆ¶ PFï¼Œè¯·ä½¿ç”¨ `pfctl` å‘½ä»¤ã€‚<<pfctl>> æ€»ç»“äº†ä¸€äº›å¯¹è¯¥å‘½ä»¤æœ‰ç”¨çš„é€‰é¡¹ã€‚æœ‰å…³æ‰€æœ‰å¯ç”¨é€‰é¡¹çš„æè¿°ï¼Œè¯·å‚é˜… man:pfctl[8]ã€‚¶Useful `pfctl` Options¸æœ‰ç”¨çš„ `pfctl` é€‰é¡¹§Purpose¦ç›®çš„ªEnable PF.­å¯ç”¨ PF ã€‚«Disable PF.­ç¦ç”¨ PF ã€‚ÙSFlush all NAT, filter, state, and table rules and reload [.filename]#/etc/pf.conf#.Ùgæ¸…é™¤æ‰€æœ‰çš„ NATã€è¿‡æ»¤ã€çŠ¶æ€å’Œè¡¨è§„åˆ™ï¼Œå¹¶é‡æ–°åŠ è½½ [.filename]#/etc/pf.conf# æ–‡ä»¶ã€‚Ù6Report on the filter rules, NAT rules, or state table.Ù8å…³äºè¿‡æ»¤è§„åˆ™ã€ NAT è§„åˆ™æˆ–çŠ¶æ€è¡¨çš„æŠ¥å‘Šã€‚ÙDCheck [.filename]#/etc/pf.conf# for errors, but do not load ruleset.ÙNæ£€æŸ¥ [.filename]#/etc/pf.conf# æ˜¯å¦æœ‰é”™è¯¯ï¼Œä½†ä¸è¦åŠ è½½è§„åˆ™é›†ã€‚Ù•package:security/sudo[] is useful for running commands like `pfctl` that require elevated privileges.  It can be installed from the Ports Collection.Ù}package:security/sudo[] æ˜¯ç”¨äºè¿è¡Œéœ€è¦æå‡æƒé™çš„å‘½ä»¤ï¼Œä¾‹å¦‚ `pfctl`ã€‚å®ƒå¯ä»¥ä» Ports Collection å®‰è£…ã€‚ÙøTo keep an eye on the traffic that passes through the PF firewall, consider installing the package:sysutils/pftop[] package or port.  Once installed, pftop can be run to view a running snapshot of traffic in a format which is similar to man:top[1].ÙÆè¦ç›‘è§†é€šè¿‡ PF é˜²ç«å¢™çš„æµé‡ï¼Œè¯·è€ƒè™‘å®‰è£… package:sysutils/pftop[] åŒ…æˆ– portã€‚å®‰è£…å®Œæˆåï¼Œå¯ä»¥è¿è¡Œ pftop ä»¥æŸ¥çœ‹ç±»ä¼¼äº man:top[1] çš„æ ¼å¼çš„æµé‡çš„å®æ—¶å¿«ç…§ã€‚«PF Rulesets¬PF è§„åˆ™é›†ÙÑThis section demonstrates how to create a customized ruleset.  It starts with the simplest of rulesets and builds upon its concepts using several examples to demonstrate real-world usage of PF's many features.Ùµæœ¬èŠ‚æ¼”ç¤ºå¦‚ä½•åˆ›å»ºè‡ªå®šä¹‰è§„åˆ™é›†ã€‚å®ƒä»æœ€ç®€å•çš„è§„åˆ™é›†å¼€å§‹ï¼Œå¹¶é€šè¿‡å¤šä¸ªç¤ºä¾‹æ¥æ„å»ºå…¶æ¦‚å¿µï¼Œä»¥å±•ç¤º PF çš„è®¸å¤šåŠŸèƒ½åœ¨å®é™…åº”ç”¨ä¸­çš„ç”¨æ³•ã€‚ÙíThe simplest possible ruleset is for a single machine that does not run any services and which needs access to one network, which may be the Internet.  To create this minimal ruleset, edit [.filename]#/etc/pf.conf# so it looks like this:ÙŞæœ€ç®€å•çš„è§„åˆ™é›†é€‚ç”¨äºä¸è¿è¡Œä»»ä½•æœåŠ¡ä¸”éœ€è¦è®¿é—®ä¸€ä¸ªç½‘ç»œï¼ˆå¯èƒ½æ˜¯äº’è”ç½‘ï¼‰çš„å•å°æœºå™¨ã€‚è¦åˆ›å»ºè¿™ä¸ªæœ€å°çš„è§„åˆ™é›†ï¼Œè¯·ç¼–è¾‘ [.filename]#/etc/pf.conf# æ–‡ä»¶ï¼Œä½¿å…¶å¦‚ä¸‹æ‰€ç¤ºï¼šÚaThe first rule denies all incoming traffic by default.  The second rule allows connections created by this system to pass out, while retaining state information on those connections.  This state information allows return traffic for those connections to pass back and should only be used on machines that can be trusted.  The ruleset can be loaded with:Ú#ç¬¬ä¸€æ¡è§„åˆ™é»˜è®¤æ‹’ç»æ‰€æœ‰ä¼ å…¥æµé‡ã€‚ç¬¬äºŒæ¡è§„åˆ™å…è®¸ç”±è¯¥ç³»ç»Ÿåˆ›å»ºçš„è¿æ¥é€šè¿‡ï¼Œå¹¶ä¿ç•™è¿™äº›è¿æ¥çš„çŠ¶æ€ä¿¡æ¯ã€‚è¿™äº›çŠ¶æ€ä¿¡æ¯å…è®¸è¿™äº›è¿æ¥çš„è¿”å›æµé‡é€šè¿‡ï¼Œå¹¶ä¸”åªåº”åœ¨å¯ä¿¡ä»»çš„æœºå™¨ä¸Šä½¿ç”¨ã€‚å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åŠ è½½è§„åˆ™é›†ï¼šÙğIn addition to keeping state, PF provides _lists_ and _macros_ which can be defined for use when creating rules.  Macros can include lists and need to be defined before use.  As an example, insert these lines at the very top of the ruleset:ÙÙé™¤äº†ä¿æŒçŠ¶æ€ï¼ŒPF è¿˜æä¾›äº†å¯ä»¥åœ¨åˆ›å»ºè§„åˆ™æ—¶å®šä¹‰å’Œä½¿ç”¨çš„ _åˆ—è¡¨_ å’Œ _å®_ã€‚å®å¯ä»¥åŒ…å«åˆ—è¡¨ï¼Œå¹¶ä¸”éœ€è¦åœ¨ä½¿ç”¨ä¹‹å‰è¿›è¡Œå®šä¹‰ã€‚ä¾‹å¦‚ï¼Œåœ¨è§„åˆ™é›†çš„æœ€é¡¶éƒ¨æ’å…¥ä»¥ä¸‹è¡Œï¼šÚ¶PF understands port names as well as port numbers, as long as the names are listed in [.filename]#/etc/services#.  This example creates two macros.  The first is a list of seven TCP port names and the second is one UDP port name.  Once defined, macros can be used in rules.  In this example, all traffic is blocked except for the connections initiated by this system for the seven specified TCP services and the one specified UDP service:ÚàPF ä¸ä»…å¯ä»¥è¯†åˆ«ç«¯å£å·ï¼Œè¿˜å¯ä»¥è¯†åˆ«ç«¯å£åç§°ï¼Œåªè¦è¿™äº›åç§°åœ¨ [.filename]#/etc/services# æ–‡ä»¶ä¸­åˆ—å‡ºã€‚è¿™ä¸ªä¾‹å­åˆ›å»ºäº†ä¸¤ä¸ªå®ã€‚ç¬¬ä¸€ä¸ªå®æ˜¯ä¸€ä¸ªåŒ…å«ä¸ƒä¸ª TCP ç«¯å£åç§°çš„åˆ—è¡¨ï¼Œç¬¬äºŒä¸ªå®æ˜¯ä¸€ä¸ª UDP ç«¯å£åç§°ã€‚ä¸€æ—¦å®šä¹‰äº†å®ï¼Œå°±å¯ä»¥åœ¨è§„åˆ™ä¸­ä½¿ç”¨å®ƒä»¬ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œé™¤äº†ç”±è¯¥ç³»ç»Ÿå‘èµ·çš„ä¸ä¸ƒä¸ªæŒ‡å®šçš„ TCP æœåŠ¡å’Œä¸€ä¸ªæŒ‡å®šçš„ UDP æœåŠ¡ç›¸å…³çš„è¿æ¥ä¹‹å¤–ï¼Œæ‰€æœ‰æµé‡éƒ½è¢«é˜»æ­¢ã€‚ÙîEven though UDP is considered to be a stateless protocol, PF is able to track some state information.  For example, when a UDP request is passed which asks a name server about a domain name, PF will watch for the response to pass it back.ÙËå°½ç®¡ UDP è¢«è®¤ä¸ºæ˜¯ä¸€ç§æ— çŠ¶æ€åè®®ï¼Œä½† PF èƒ½å¤Ÿè·Ÿè¸ªä¸€äº›çŠ¶æ€ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼Œå½“ä¼ é€’ä¸€ä¸ª UDP è¯·æ±‚æ¥è¯¢é—®åŸŸåæœåŠ¡å™¨çš„åŸŸåæ—¶ï¼ŒPF ä¼šç›‘è§†å“åº”å¹¶å°†å…¶ä¼ é€’å›å»ã€‚ÙXWhenever an edit is made to a ruleset, the new rules must be loaded so they can be used:ÙZæ¯å½“å¯¹è§„åˆ™é›†è¿›è¡Œç¼–è¾‘æ—¶ï¼Œå¿…é¡»åŠ è½½æ–°çš„è§„åˆ™ï¼Œä»¥ä¾¿å¯ä»¥ä½¿ç”¨å®ƒä»¬ï¼šÙ“If there are no syntax errors, `pfctl` will not output any messages during the rule load.  Rules can also be tested before attempting to load them:Ùå¦‚æœæ²¡æœ‰è¯­æ³•é”™è¯¯ï¼Œ`pfctl` åœ¨åŠ è½½è§„åˆ™æ—¶ä¸ä¼šè¾“å‡ºä»»ä½•æ¶ˆæ¯ã€‚åœ¨å°è¯•åŠ è½½è§„åˆ™ä¹‹å‰ï¼Œä¹Ÿå¯ä»¥å¯¹è§„åˆ™è¿›è¡Œæµ‹è¯•ï¼šÙòIncluding `-n` causes the rules to be interpreted only, but not loaded.  This provides an opportunity to correct any errors.  At all times, the last valid ruleset loaded will be enforced until either PF is disabled or a new ruleset is loaded.ÙÜåŒ…æ‹¬ `-n` ä¼šå¯¼è‡´è§„åˆ™ä»…è¢«è§£é‡Šè€Œä¸è¢«åŠ è½½ã€‚è¿™æä¾›äº†çº æ­£ä»»ä½•é”™è¯¯çš„æœºä¼šã€‚åœ¨ä»»ä½•æ—¶å€™ï¼Œåªæœ‰æœ€åä¸€ä¸ªæœ‰æ•ˆçš„è§„åˆ™é›†è¢«åŠ è½½ï¼Œç›´åˆ° PF è¢«ç¦ç”¨æˆ–åŠ è½½äº†ä¸€ä¸ªæ–°çš„è§„åˆ™é›†ã€‚Ù¨Adding `-v` to a `pfctl` ruleset verify or load will display the fully parsed rules exactly the way they will be loaded.  This is extremely useful when debugging rules.Ù®åœ¨ `pfctl` è§„åˆ™é›†çš„éªŒè¯æˆ–åŠ è½½å‘½ä»¤åæ·»åŠ  `-v` å‚æ•°ï¼Œå°†ä¼šæ˜¾ç¤ºå®Œå…¨è§£æçš„è§„åˆ™ï¼Œè¿™äº›è§„åˆ™å°†ä¼šè¢«åŠ è½½ã€‚åœ¨è°ƒè¯•è§„åˆ™æ—¶ï¼Œè¿™éå¸¸æœ‰ç”¨ã€‚¹A Simple Gateway with NATÙ ä¸€ä¸ªå¸¦æœ‰ NAT çš„ç®€å•ç½‘å…³ÚOThis section demonstrates how to configure a FreeBSD system running PF to act as a gateway for at least one other machine.  The gateway needs at least two network interfaces, each connected to a separate network.  In this example, [.filename]#xl0# is connected to the Internet and [.filename]#xl1# is connected to the internal network.Úæœ¬èŠ‚æ¼”ç¤ºäº†å¦‚ä½•é…ç½®è¿è¡Œ PF çš„ FreeBSD ç³»ç»Ÿï¼Œä½¿å…¶å……å½“è‡³å°‘ä¸€å°å…¶ä»–è®¡ç®—æœºçš„ç½‘å…³ã€‚ç½‘å…³éœ€è¦è‡³å°‘ä¸¤ä¸ªç½‘ç»œæ¥å£ï¼Œæ¯ä¸ªæ¥å£è¿æ¥åˆ°ä¸åŒçš„ç½‘ç»œã€‚åœ¨æœ¬ç¤ºä¾‹ä¸­ï¼Œ[.filename]#xl0# è¿æ¥åˆ°äº’è”ç½‘ï¼Œ [.filename]#xl1# è¿æ¥åˆ°å†…éƒ¨ç½‘ç»œã€‚Ù«First, enable the gateway to let the machine forward the network traffic it receives on one interface to another interface.  This sysctl setting will forward IPv4 packets:Ù˜é¦–å…ˆï¼Œå¯ç”¨ç½‘å…³ä»¥ä½¿æœºå™¨å°†å…¶æ¥æ”¶åˆ°çš„ç½‘ç»œæµé‡ä»ä¸€ä¸ªæ¥å£è½¬å‘åˆ°å¦ä¸€ä¸ªæ¥å£ã€‚è¿™ä¸ª sysctl è®¾ç½®å°†è½¬å‘ IPv4 æ•°æ®åŒ…ï¼š½To forward IPv6 traffic, use:Ù$è¦è½¬å‘ IPv6 æµé‡ï¼Œè¯·ä½¿ç”¨ï¼šÙcTo enable these settings at system boot, use man:sysrc[8] to add them to [.filename]#/etc/rc.conf#:Ùzè¦åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶å¯ç”¨è¿™äº›è®¾ç½®ï¼Œè¯·ä½¿ç”¨ man:sysrc[8] å°†å®ƒä»¬æ·»åŠ åˆ° [.filename]#/etc/rc.conf# æ–‡ä»¶ä¸­ã€‚ÙFVerify with `ifconfig` that both of the interfaces are up and running.ÙHä½¿ç”¨ `ifconfig` å‘½ä»¤éªŒè¯ä¸¤ä¸ªæ¥å£æ˜¯å¦éƒ½å·²å¯åŠ¨å¹¶è¿è¡Œã€‚Ú Next, create the PF rules to allow the gateway to pass traffic.  While the following rule allows stateful traffic from hosts of the internal network to pass to the gateway, the `to` keyword does not guarantee passage all the way from source to destination:ÙÍæ¥ä¸‹æ¥ï¼Œåˆ›å»º PF è§„åˆ™ä»¥å…è®¸ç½‘å…³ä¼ é€’æµé‡ã€‚è™½ç„¶ä»¥ä¸‹è§„åˆ™å…è®¸æ¥è‡ªå†…éƒ¨ç½‘ç»œä¸»æœºçš„æœ‰çŠ¶æ€æµé‡é€šè¿‡ç½‘å…³ï¼Œä½† `to` å…³é”®å­—ä¸èƒ½ä¿è¯ä»æºåˆ°ç›®çš„åœ°çš„å®Œå…¨é€šè¿‡ï¼šÙŒThat rule only lets the traffic pass in to the gateway on the internal interface.  To let the packets go further, a matching rule is needed:Ùuè¯¥è§„åˆ™åªå…è®¸æµé‡é€šè¿‡å†…éƒ¨æ¥å£è¿›å…¥ç½‘å…³ã€‚è¦è®©æ•°æ®åŒ…ç»§ç»­ä¼ é€’ï¼Œéœ€è¦ä¸€ä¸ªåŒ¹é…çš„è§„åˆ™ï¼šÚ1While these two rules will work, rules this specific are rarely needed.  For a busy network admin, a readable ruleset is a safer ruleset.  The remainder of this section demonstrates how to keep the rules as simple as possible for readability.  For example, those two rules could be replaced with one rule:Ú,è™½ç„¶è¿™ä¸¤ä¸ªè§„åˆ™å¯ä»¥å·¥ä½œï¼Œä½†è¿™æ ·å…·ä½“çš„è§„åˆ™å¾ˆå°‘éœ€è¦ã€‚å¯¹äºå¿™ç¢Œçš„ç½‘ç»œç®¡ç†å‘˜æ¥è¯´ï¼Œä¸€ä¸ªå¯è¯»çš„è§„åˆ™é›†æ˜¯æ›´å®‰å…¨çš„è§„åˆ™é›†ã€‚æœ¬èŠ‚çš„å…¶ä½™éƒ¨åˆ†æ¼”ç¤ºäº†å¦‚ä½•å°½å¯èƒ½ç®€åŒ–è§„åˆ™ä»¥æé«˜å¯è¯»æ€§ã€‚ä¾‹å¦‚ï¼Œè¿™ä¸¤ä¸ªè§„åˆ™å¯ä»¥ç”¨ä¸€æ¡è§„åˆ™æ¥æ›¿ä»£ï¼šÚ›The `interface:network` notation can be replaced with a macro to make the ruleset even more readable.  For example, a `$localnet` macro could be defined as the network directly attached to the internal interface (`$xl1:network`).  Alternatively, the definition of `$localnet` could be changed to an _IP address/netmask_ notation to denote a network, such as `192.168.100.1/24` for a subnet of private addresses.Úaå¯ä»¥ä½¿ç”¨å®æ¥æ›¿ä»£ `interface:network` è¡¨ç¤ºæ³•ï¼Œä½¿è§„åˆ™é›†æ›´æ˜“è¯»ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥å®šä¹‰ä¸€ä¸ª `$localnet` å®ï¼Œè¡¨ç¤ºç›´æ¥è¿æ¥åˆ°å†…éƒ¨æ¥å£çš„ç½‘ç»œï¼ˆ`$xl1:network`ï¼‰ã€‚å¦å¤–ï¼Œä¹Ÿå¯ä»¥å°† `$localnet` çš„å®šä¹‰æ›´æ”¹ä¸º _IP åœ°å€/å­ç½‘æ©ç _ è¡¨ç¤ºæ³•æ¥è¡¨ç¤ºç½‘ç»œï¼Œä¾‹å¦‚ `192.168.100.1/24` è¡¨ç¤ºç§æœ‰åœ°å€çš„å­ç½‘ã€‚Ù¶If required, `$localnet` could even be defined as a list of networks.  Whatever the specific needs, a sensible `$localnet` definition could be used in a typical pass rule as follows:ÙÄå¦‚æœéœ€è¦çš„è¯ï¼Œ`$localnet` ç”šè‡³å¯ä»¥è¢«å®šä¹‰ä¸ºä¸€ä¸ªç½‘ç»œåˆ—è¡¨ã€‚æ— è®ºå…·ä½“éœ€æ±‚å¦‚ä½•ï¼Œä¸€ä¸ªåˆç†çš„ `$localnet` å®šä¹‰å¯ä»¥åœ¨å…¸å‹çš„é€šè¿‡è§„åˆ™ä¸­ä½¿ç”¨ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼šÙÂThe following sample ruleset allows all traffic initiated by machines on the internal network.  It first defines two macros to represent the external and internal 3COM interfaces of the gateway.Ùœä»¥ä¸‹ç¤ºä¾‹è§„åˆ™é›†å…è®¸å†…éƒ¨ç½‘ç»œä¸Šçš„æœºå™¨å‘èµ·çš„æ‰€æœ‰æµé‡ã€‚å®ƒé¦–å…ˆå®šä¹‰äº†ä¸¤ä¸ªå®ï¼Œç”¨äºè¡¨ç¤ºç½‘å…³çš„å¤–éƒ¨å’Œå†…éƒ¨ 3COM æ¥å£ã€‚ÙëFor dialup users, the external interface will use [.filename]#tun0#.  For an ADSL connection, specifically those using PPP over Ethernet (PPPoE), the correct external interface is [.filename]#tun0#, not the physical Ethernet interface.ÙÛå¯¹äºæ‹¨å·ç”¨æˆ·ï¼Œå¤–éƒ¨æ¥å£å°†ä½¿ç”¨ [.filename]#tun0#ã€‚å¯¹äº ADSL è¿æ¥ï¼Œç‰¹åˆ«æ˜¯ä½¿ç”¨ä»¥å¤ªç½‘ä¸Šçš„ PPPï¼ˆPPPoEï¼‰çš„è¿æ¥ï¼Œæ­£ç¡®çš„å¤–éƒ¨æ¥å£æ˜¯ [.filename]#tun0#ï¼Œè€Œä¸æ˜¯ç‰©ç†ä»¥å¤ªç½‘æ¥å£ã€‚Ú×This ruleset introduces the `nat` rule which is used to handle the network address translation from the non-routable addresses inside the internal network to the IP address assigned to the external interface.  The parentheses surrounding the last part of the nat rule `($ext_if)` is included when the IP address of the external interface is dynamically assigned.  It ensures that network traffic runs without serious interruptions even if the external IP address changes.Útè¿™ä¸ªè§„åˆ™é›†å¼•å…¥äº† `nat` è§„åˆ™ï¼Œç”¨äºå¤„ç†å†…éƒ¨ç½‘ç»œä¸­ä¸å¯è·¯ç”±çš„åœ°å€åˆ°åˆ†é…ç»™å¤–éƒ¨æ¥å£çš„ IP åœ°å€çš„ç½‘ç»œåœ°å€è½¬æ¢ã€‚nat è§„åˆ™çš„æœ€åéƒ¨åˆ†å‘¨å›´çš„æ‹¬å· `($ext_if)` æ˜¯åœ¨å¤–éƒ¨æ¥å£çš„ IP åœ°å€æ˜¯åŠ¨æ€åˆ†é…æ—¶åŒ…å«çš„ã€‚å®ƒç¡®ä¿å³ä½¿å¤–éƒ¨ IP åœ°å€å‘ç”Ÿå˜åŒ–ï¼Œç½‘ç»œæµé‡ä¹Ÿèƒ½å¤Ÿæ­£å¸¸è¿è¡Œè€Œä¸ä¼šæœ‰ä¸¥é‡çš„ä¸­æ–­ã€‚ÙNote that this ruleset probably allows more traffic to pass out of the network than is needed.  One reasonable setup could create this macro:Ùœè¯·æ³¨æ„ï¼Œè¿™ä¸ªè§„åˆ™é›†å¯èƒ½å…è®¸æ›´å¤šçš„æµé‡ä»ç½‘ç»œä¸­é€šè¿‡ï¼Œè€Œå®é™…ä¸Šå¹¶ä¸éœ€è¦è¿™ä¹ˆå¤šã€‚ä¸€ä¸ªåˆç†çš„è®¾ç½®å¯ä»¥åˆ›å»ºè¿™ä¸ªå®ï¼š½to use in the main pass rule:¾ç”¨äºä¸»è¦é€šè¡Œè§„åˆ™ä¸­ï¼šÙVA few other pass rules may be needed.  This one enables SSH on the external interface:Ù_å¯èƒ½è¿˜éœ€è¦ä¸€äº›å…¶ä»–çš„é€šè¡Œè§„åˆ™ã€‚è¿™ä¸ªè§„åˆ™å…è®¸åœ¨å¤–éƒ¨æ¥å£ä¸Šä½¿ç”¨ SSH ï¼šÙGThis macro definition and rule allows DNS and NTP for internal clients:ÙIè¿™ä¸ªå®å®šä¹‰å’Œè§„åˆ™å…è®¸å†…éƒ¨å®¢æˆ·ç«¯ä½¿ç”¨ DNS å’Œ NTP æœåŠ¡ã€‚ÚBNote the `quick` keyword in this rule.  Since the ruleset consists of several rules, it is important to understand the relationships between the rules in a ruleset.  Rules are evaluated from top to bottom, in the sequence they are written.  For each packet or connection evaluated by PF, _the last matching rule_ in the ruleset is the one which is applied.  However, when a packet matches a rule which contains the `quick` keyword, the rule processing stops and the packet is treated according to that rule.  This is very useful when an exception to the general rules is needed.Úè¯·æ³¨æ„è¿™æ¡è§„åˆ™ä¸­çš„ `quick` å…³é”®å­—ã€‚ç”±äºè§„åˆ™é›†åŒ…å«å¤šä¸ªè§„åˆ™ï¼Œå› æ­¤äº†è§£è§„åˆ™é›†ä¸­è§„åˆ™ä¹‹é—´çš„å…³ç³»éå¸¸é‡è¦ã€‚è§„åˆ™æŒ‰ç…§ä»ä¸Šåˆ°ä¸‹çš„é¡ºåºè¿›è¡Œè¯„ä¼°ï¼ŒæŒ‰ç…§å®ƒä»¬ç¼–å†™çš„é¡ºåºè¿›è¡Œã€‚å¯¹äºæ¯ä¸ªç”± PF è¯„ä¼°çš„æ•°æ®åŒ…æˆ–è¿æ¥ï¼Œè§„åˆ™é›†ä¸­çš„ _æœ€åä¸€ä¸ªåŒ¹é…çš„è§„åˆ™_ æ˜¯åº”ç”¨çš„è§„åˆ™ã€‚ç„¶è€Œï¼Œå½“ä¸€ä¸ªæ•°æ®åŒ…åŒ¹é…åŒ…å« `quick` å…³é”®å­—çš„è§„åˆ™æ—¶ï¼Œè§„åˆ™å¤„ç†åœæ­¢ï¼Œæ•°æ®åŒ…æ ¹æ®è¯¥è§„åˆ™è¿›è¡Œå¤„ç†ã€‚å½“éœ€è¦å¯¹ä¸€èˆ¬è§„åˆ™è¿›è¡Œå¼‚å¸¸å¤„ç†æ—¶ï¼Œè¿™éå¸¸æœ‰ç”¨ã€‚µCreating an FTP Proxy·åˆ›å»ºä¸€ä¸ª FTP ä»£ç†ÙÕConfiguring working FTP rules can be problematic due to the nature of the FTP protocol.  FTP pre-dates firewalls by several decades and is insecure in its design.  The most common points against using FTP include:ÙÑç”±äº FTP åè®®çš„ç‰¹æ€§ï¼Œé…ç½®å·¥ä½œä¸­çš„ FTP è§„åˆ™å¯èƒ½ä¼šå‡ºç°é—®é¢˜ã€‚ FTP åœ¨é˜²ç«å¢™å‡ºç°å‡ åå¹´ä¹‹å‰å°±å­˜åœ¨ï¼Œå¹¶ä¸”åœ¨è®¾è®¡ä¸Šå­˜åœ¨ä¸å®‰å…¨æ€§ã€‚ä½¿ç”¨ FTP çš„æœ€å¸¸è§é—®é¢˜åŒ…æ‹¬ï¼šÙ'Passwords are transferred in the clear.¾å¯†ç ä»¥æ˜æ–‡å½¢å¼ä¼ è¾“ã€‚ÙbThe protocol demands the use of at least two TCP connections (control and data) on separate ports.Ùtè¯¥åè®®è¦æ±‚ä½¿ç”¨è‡³å°‘ä¸¤ä¸ª TCP è¿æ¥ï¼ˆæ§åˆ¶å’Œæ•°æ®ï¼‰ï¼Œå¹¶ä¸”è¿™ä¸¤ä¸ªè¿æ¥è¦ä½¿ç”¨ä¸åŒçš„ç«¯å£ã€‚ÙRWhen a session is established, data is communicated using randomly selected ports.ÙEå½“å»ºç«‹ä¼šè¯æ—¶ï¼Œæ•°æ®ä½¿ç”¨éšæœºé€‰æ‹©çš„ç«¯å£è¿›è¡Œé€šä¿¡ã€‚Ú.All of these points present security challenges, even before considering any potential security weaknesses in client or server software.  More secure alternatives for file transfer exist, such as man:sftp[1] or man:scp[1], which both feature authentication and data transfer over encrypted connections.Úåœ¨è€ƒè™‘å®¢æˆ·ç«¯æˆ–æœåŠ¡å™¨è½¯ä»¶çš„æ½œåœ¨å®‰å…¨å¼±ç‚¹ä¹‹å‰ï¼Œæ‰€æœ‰è¿™äº›è¦ç‚¹éƒ½æå‡ºäº†å®‰å…¨æŒ‘æˆ˜ã€‚å­˜åœ¨æ›´å®‰å…¨çš„æ–‡ä»¶ä¼ è¾“æ›¿ä»£æ–¹æ¡ˆï¼Œä¾‹å¦‚ man:sftp[1] æˆ– man:scp[1]ï¼Œå®ƒä»¬éƒ½å…·æœ‰èº«ä»½éªŒè¯å’ŒåŠ å¯†è¿æ¥ä¸Šçš„æ•°æ®ä¼ è¾“åŠŸèƒ½ã€‚Ú>For those situations when FTP is required, PF provides redirection of FTP traffic to a small proxy program called man:ftp-proxy[8], which is included in the base system of FreeBSD.  The role of the proxy is to dynamically insert and delete rules in the ruleset, using a set of anchors, to correctly handle FTP traffic.Úå¯¹äºéœ€è¦ä½¿ç”¨ FTP çš„æƒ…å†µï¼ŒPF æä¾›äº†å°† FTP æµé‡é‡å®šå‘åˆ°ä¸€ä¸ªåä¸º man:ftp-proxy[8] çš„å°å‹ä»£ç†ç¨‹åºï¼Œè¯¥ç¨‹åºåŒ…å«åœ¨ FreeBSD çš„åŸºæœ¬ç³»ç»Ÿä¸­ã€‚ä»£ç†çš„ä½œç”¨æ˜¯ä½¿ç”¨ä¸€ç»„é”šç‚¹åŠ¨æ€æ’å…¥å’Œåˆ é™¤è§„åˆ™ï¼Œä»¥æ­£ç¡®å¤„ç† FTP æµé‡ã€‚ÙDTo enable the FTP proxy, add this line to [.filename]#/etc/rc.conf#:ÙVè¦å¯ç”¨ FTP ä»£ç†ï¼Œè¯·å°†ä»¥ä¸‹è¡Œæ·»åŠ åˆ° [.filename]#/etc/rc.conf# æ–‡ä»¶ä¸­ï¼šÙ Then start the proxy by running:Ù-ç„¶åé€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤å¯åŠ¨ä»£ç†ï¼šÙ¼For a basic configuration, three elements need to be added to [.filename]#/etc/pf.conf#.  First, the anchors which the proxy will use to insert the rules it generates for the FTP sessions:Ùå¯¹äºåŸºæœ¬é…ç½®ï¼Œéœ€è¦å°†ä¸‰ä¸ªå…ƒç´ æ·»åŠ åˆ° [.filename]#/etc/pf.conf# æ–‡ä»¶ä¸­ã€‚é¦–å…ˆæ˜¯ä»£ç†å°†ç”¨äºæ’å…¥ç”Ÿæˆçš„ FTP ä¼šè¯è§„åˆ™çš„é”šç‚¹ï¼šÙCSecond, a pass rule is needed to allow FTP traffic in to the proxy.ÙMå…¶æ¬¡ï¼Œéœ€è¦ä¸€ä¸ªé€šè¿‡è§„åˆ™æ¥å…è®¸ FTP æµé‡è¿›å…¥ä»£ç†æœåŠ¡å™¨ã€‚Ù‰Third, redirection and NAT rules need to be defined before the filtering rules.  Insert this `rdr` rule immediately after the `nat` rule:Ù|ç¬¬ä¸‰ï¼Œé‡å®šå‘å’Œ NAT è§„åˆ™éœ€è¦åœ¨è¿‡æ»¤è§„åˆ™ä¹‹å‰å®šä¹‰ã€‚åœ¨ `nat` è§„åˆ™ä¹‹åç«‹å³æ’å…¥ä»¥ä¸‹ `rdr` è§„åˆ™ï¼šÙ.Finally, allow the redirected traffic to pass:Ù*æœ€åï¼Œå…è®¸é‡å®šå‘çš„æµé‡é€šè¿‡ã€‚ÙCwhere `$proxy` expands to the address the proxy daemon is bound to.Ù?`$proxy` æ˜¯ä»£ç†å®ˆæŠ¤ç¨‹åºç»‘å®šçš„åœ°å€çš„å±•å¼€å½¢å¼ã€‚ÙnSave [.filename]#/etc/pf.conf#, load the new rules, and verify from a client that FTP connections are working:Ùtä¿å­˜ [.filename]#/etc/pf.conf# æ–‡ä»¶ï¼ŒåŠ è½½æ–°çš„è§„åˆ™ï¼Œå¹¶ä»å®¢æˆ·ç«¯éªŒè¯ FTP è¿æ¥æ˜¯å¦æ­£å¸¸å·¥ä½œï¼šÚ(This example covers a basic setup where the clients in the local network need to contact FTP servers elsewhere.  This basic configuration should work well with most combinations of FTP clients and servers.  As shown in man:ftp-proxy[8], the proxy's behavior can be changed in various ways by adding options to the `ftpproxy_flags=` line.  Some clients or servers may have specific quirks that must be compensated for in the configuration, or there may be a need to integrate the proxy in specific ways such as assigning FTP traffic to a specific queue.Úğè¿™ä¸ªä¾‹å­æ¶µç›–äº†ä¸€ä¸ªåŸºæœ¬çš„è®¾ç½®ï¼Œå…¶ä¸­æœ¬åœ°ç½‘ç»œä¸­çš„å®¢æˆ·ç«¯éœ€è¦è”ç³»å…¶ä»–åœ°æ–¹çš„ FTP æœåŠ¡å™¨ã€‚è¿™ä¸ªåŸºæœ¬é…ç½®åº”è¯¥é€‚ç”¨äºå¤§å¤šæ•° FTP å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨çš„ç»„åˆã€‚å¦‚ man:ftp-proxy[8] æ‰€ç¤ºï¼Œé€šè¿‡åœ¨ `ftpproxy_flags=` è¡Œä¸­æ·»åŠ é€‰é¡¹ï¼Œå¯ä»¥æ”¹å˜ä»£ç†çš„è¡Œä¸ºã€‚ä¸€äº›å®¢æˆ·ç«¯æˆ–æœåŠ¡å™¨å¯èƒ½æœ‰ç‰¹å®šçš„é—®é¢˜ï¼Œåœ¨é…ç½®ä¸­å¿…é¡»è¿›è¡Œè¡¥å¿ï¼Œæˆ–è€…å¯èƒ½éœ€è¦ä»¥ç‰¹å®šçš„æ–¹å¼é›†æˆä»£ç†ï¼Œä¾‹å¦‚å°† FTP æµé‡åˆ†é…ç»™ç‰¹å®šçš„é˜Ÿåˆ—ã€‚Ù¸For ways to run an FTP server protected by PF and man:ftp-proxy[8], configure a separate `ftp-proxy` in reverse mode, using `-R`, on a separate port with its own redirecting pass rule.Ùâè¦ä»¥ PF å’Œ man:ftp-proxy[8] ä¿æŠ¤çš„æ–¹å¼è¿è¡Œ FTP æœåŠ¡å™¨ï¼Œå¯ä»¥é…ç½®ä¸€ä¸ªç‹¬ç«‹çš„ `ftp-proxy` ä»¥åå‘æ¨¡å¼è¿è¡Œï¼Œä½¿ç”¨ `-R` é€‰é¡¹ï¼Œåœ¨ä¸€ä¸ªç‹¬ç«‹çš„ç«¯å£ä¸Šï¼Œå¹¶å…·æœ‰è‡ªå·±çš„é‡å®šå‘é€šè¿‡è§„åˆ™ã€‚­Managing ICMP«ç®¡ç† ICMPÙ¶Many of the tools used for debugging or troubleshooting a TCP/IP network rely on the Internet Control Message Protocol (ICMP), which was designed specifically with debugging in mind.Ùè®¸å¤šç”¨äºè°ƒè¯•æˆ–æ•…éšœæ’é™¤ TCP/IP ç½‘ç»œçš„å·¥å…·ä¾èµ–äº Internet æ§åˆ¶æ¶ˆæ¯åè®®ï¼ˆICMPï¼‰ï¼Œè¯¥åè®®ä¸“é—¨è®¾è®¡ç”¨äºè°ƒè¯•ã€‚ÚFThe ICMP protocol sends and receives _control messages_ between hosts and gateways, mainly to provide feedback to a sender about any unusual or difficult conditions enroute to the target host.  Routers use ICMP to negotiate packet sizes and other transmission parameters in a process often referred to as _path MTU discovery_.ÚHICMP åè®®åœ¨ä¸»æœºå’Œç½‘å…³ä¹‹é—´å‘é€å’Œæ¥æ”¶ _æ§åˆ¶æ¶ˆæ¯ï¼ˆontrol messagesï¼‰_ï¼Œä¸»è¦æ˜¯ä¸ºäº†å‘å‘é€æ–¹æä¾›æœ‰å…³åˆ°ç›®æ ‡ä¸»æœºçš„ä»»ä½•å¼‚å¸¸æˆ–å›°éš¾æ¡ä»¶çš„åé¦ˆã€‚è·¯ç”±å™¨ä½¿ç”¨ ICMP æ¥åå•†æ•°æ®åŒ…å¤§å°å’Œå…¶ä»–ä¼ è¾“å‚æ•°ï¼Œè¿™ä¸ªè¿‡ç¨‹é€šå¸¸è¢«ç§°ä¸º _è·¯å¾„ MTU å‘ç°ï¼ˆpath MTU discoveryï¼‰_ã€‚Ú>From a firewall perspective, some ICMP control messages are vulnerable to known attack vectors.  Also, letting all diagnostic traffic pass unconditionally makes debugging easier, but it also makes it easier for others to extract information about the network.  For these reasons, the following rule may not be optimal:Úä»é˜²ç«å¢™çš„è§’åº¦æ¥çœ‹ï¼Œä¸€äº› ICMP æ§åˆ¶æ¶ˆæ¯å®¹æ˜“å—åˆ°å·²çŸ¥çš„æ”»å‡»å‘é‡çš„æ”»å‡»ã€‚æ­¤å¤–ï¼Œæ— æ¡ä»¶åœ°å…è®¸æ‰€æœ‰è¯Šæ–­æµé‡é€šè¿‡å¯ä»¥ä½¿è°ƒè¯•æ›´å®¹æ˜“ï¼Œä½†ä¹Ÿä¼šä½¿ä»–äººæ›´å®¹æ˜“æå–æœ‰å…³ç½‘ç»œçš„ä¿¡æ¯ã€‚å› æ­¤ï¼Œä»¥ä¸‹è§„åˆ™å¯èƒ½ä¸æ˜¯æœ€ä½³é€‰æ‹©ï¼šÙzOne solution is to let all ICMP traffic from the local network through while stopping all probes from outside the network:Ùxä¸€ç§è§£å†³æ–¹æ¡ˆæ˜¯å…è®¸æœ¬åœ°ç½‘ç»œä¸­çš„æ‰€æœ‰ ICMP æµé‡é€šè¿‡ï¼ŒåŒæ—¶é˜»æ­¢æ¥è‡ªç½‘ç»œå¤–éƒ¨çš„æ‰€æœ‰æ¢æµ‹ã€‚ÙÿAdditional options are available which demonstrate some of PF's flexibility.  For example, rather than allowing all ICMP messages, one can specify the messages used by man:ping[8] and man:traceroute[8].  Start by defining a macro for that type of message:Ùğè¿˜æœ‰å…¶ä»–å¯ç”¨çš„é€‰é¡¹ï¼Œè¿™äº›é€‰é¡¹å±•ç¤ºäº† PF çš„ä¸€äº›çµæ´»æ€§ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥æŒ‡å®š man:ping[8] å’Œ man:traceroute[8] ä½¿ç”¨çš„æ¶ˆæ¯ï¼Œè€Œä¸æ˜¯å…è®¸æ‰€æœ‰çš„ ICMP æ¶ˆæ¯ã€‚é¦–å…ˆï¼Œå®šä¹‰ä¸€ä¸ªç”¨äºè¯¥ç±»å‹æ¶ˆæ¯çš„å®ï¼šÙ and a rule which uses the macro:¾å’Œä¸€ä¸ªä½¿ç”¨å®çš„è§„åˆ™ï¼šÚ†If other types of ICMP packets are needed, expand `icmp_types` to a list of those packet types.  Type `more /usr/src/sbin/pfctl/pfctl_parser.c` to see the list of ICMP message types supported by PF.  Refer to http://www.iana.org/assignments/icmp-parameters/icmp-parameters.xhtml[http://www.iana.org/assignments/icmp-parameters/icmp-parameters.xhtml] for an explanation of each message type.Ú‹å¦‚æœéœ€è¦å…¶ä»–ç±»å‹çš„ ICMP æ•°æ®åŒ…ï¼Œè¯·å°† `icmp_types` æ‰©å±•ä¸ºè¿™äº›æ•°æ®åŒ…ç±»å‹çš„åˆ—è¡¨ã€‚è¾“å…¥ `more /usr/src/sbin/pfctl/pfctl_parser.c` ä»¥æŸ¥çœ‹ PF æ”¯æŒçš„ ICMP æ¶ˆæ¯ç±»å‹åˆ—è¡¨ã€‚è¯·å‚è€ƒ http://www.iana.org/assignments/icmp-parameters/icmp-parameters.xhtml[http://www.iana.org/assignments/icmp-parameters/icmp-parameters.xhtml] ä»¥äº†è§£æ¯ä¸ªæ¶ˆæ¯ç±»å‹çš„è§£é‡Šã€‚Ù_Since Unix `traceroute` uses UDP by default, another rule is needed to allow Unix `traceroute`:Ùsç”±äº Unix çš„ `traceroute` é»˜è®¤ä½¿ç”¨ UDPï¼Œå› æ­¤éœ€è¦æ·»åŠ å¦ä¸€æ¡è§„åˆ™æ¥å…è®¸ Unix çš„ `traceroute`ã€‚ÚLSince `TRACERT.EXE` on Microsoft Windows systems uses ICMP echo request messages, only the first rule is needed to allow network traces from those systems.  Unix `traceroute` can be instructed to use other protocols as well, and will use ICMP echo request messages if `-I` is used.  Check the man:traceroute[8] man page for details.Úbç”±äº Microsoft Windows ç³»ç»Ÿä¸Šçš„ `TRACERT.EXE` ä½¿ç”¨ ICMP å›æ˜¾è¯·æ±‚æ¶ˆæ¯ï¼Œå› æ­¤åªéœ€è¦ç¬¬ä¸€ä¸ªè§„åˆ™æ¥å…è®¸æ¥è‡ªè¿™äº›ç³»ç»Ÿçš„ç½‘ç»œè·Ÿè¸ªã€‚Unix çš„ `traceroute` ä¹Ÿå¯ä»¥æŒ‡ç¤ºä½¿ç”¨å…¶ä»–åè®®ï¼Œå¹¶ä¸”å¦‚æœä½¿ç”¨äº† `-I` é€‰é¡¹ï¼Œå®ƒå°†ä½¿ç”¨ ICMP å›æ˜¾è¯·æ±‚æ¶ˆæ¯ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… man:traceroute[8] æ‰‹å†Œé¡µã€‚²Path MTU Discovery±è·¯å¾„ MTU å‘ç°Ú’Internet protocols are designed to be device independent, and one consequence of device independence is that the optimal packet size for a given connection cannot always be predicted reliably.  The main constraint on packet size is the _Maximum Transmission Unit_ (MTU) which sets the upper limit on the packet size for an interface.  Type `ifconfig` to view the MTUs for a system's network interfaces.Ú=Internet åè®®è¢«è®¾è®¡ä¸ºä¸è®¾å¤‡æ— å…³ï¼Œè®¾å¤‡æ— å…³çš„ä¸€ä¸ªç»“æœæ˜¯æ— æ³•å¯é åœ°é¢„æµ‹ç»™å®šè¿æ¥çš„æœ€ä½³æ•°æ®åŒ…å¤§å°ã€‚æ•°æ®åŒ…å¤§å°çš„ä¸»è¦é™åˆ¶æ˜¯ _æœ€å¤§ä¼ è¾“å•å…ƒ_ï¼ˆMTUï¼‰ï¼Œå®ƒè®¾ç½®äº†æ¥å£çš„æ•°æ®åŒ…å¤§å°çš„ä¸Šé™ã€‚è¾“å…¥ `ifconfig` å‘½ä»¤å¯ä»¥æŸ¥çœ‹ç³»ç»Ÿç½‘ç»œæ¥å£çš„ MTU å€¼ã€‚ÚTCP/IP uses a process known as path MTU discovery to determine the right packet size for a connection.  This process sends packets of varying sizes with the "Do not fragment" flag set, expecting an ICMP return packet of "type 3, code 4" when the upper limit has been reached.  Type 3 means "destination unreachable", and code 4 is short for "fragmentation needed, but the do-not-fragment flag is set".  To allow path MTU discovery in order to support connections to other MTUs, add the `destination unreachable` type to the `icmp_types` macro:ÚiTCP/IP ä½¿ç”¨ä¸€ç§ç§°ä¸ºè·¯å¾„ MTU å‘ç°çš„è¿‡ç¨‹æ¥ç¡®å®šè¿æ¥çš„æ­£ç¡®æ•°æ®åŒ…å¤§å°ã€‚è¯¥è¿‡ç¨‹å‘é€å¤§å°ä¸åŒçš„æ•°æ®åŒ…ï¼Œå¹¶è®¾ç½®â€œä¸åˆ†ç‰‡ï¼ˆDo not fragmentï¼‰â€æ ‡å¿—ï¼ŒæœŸæœ›åœ¨è¾¾åˆ°ä¸Šé™æ—¶æ”¶åˆ°ä¸€ä¸ª ICMP è¿”å›æ•°æ®åŒ…ï¼Œå…¶ç±»å‹ä¸ºâ€œtype 3, code 4â€ã€‚Type 3 è¡¨ç¤ºâ€œç›®æ ‡ä¸å¯è¾¾ï¼ˆdestination unreachableï¼‰â€ï¼ŒCode 4 è¡¨ç¤ºâ€œéœ€è¦åˆ†ç‰‡ï¼Œä½†è®¾ç½®äº†ä¸åˆ†ç‰‡æ ‡å¿—ï¼ˆfragmentation needed,but the do-not-fragment flag is setï¼‰â€ã€‚ä¸ºäº†æ”¯æŒä¸å…¶ä»– MTU çš„è¿æ¥ï¼Œå¯ä»¥å°† `destination unreachable` ç±»å‹æ·»åŠ åˆ° `icmp_types` å®ä¸­ï¼Œä»¥å…è®¸è·¯å¾„ MTU å‘ç°ã€‚ÙjSince the pass rule already uses that macro, it does not need to be modified to support the new ICMP type:Ùiç”±äº pass è§„åˆ™å·²ç»ä½¿ç”¨äº†è¯¥å®ï¼Œæ‰€ä»¥ä¸éœ€è¦ä¿®æ”¹ pass è§„åˆ™æ¥æ”¯æŒæ–°çš„ ICMP ç±»å‹ã€‚Ù”PF allows filtering on all variations of ICMP types and codes.  The list of possible types and codes are documented in man:icmp[4] and man:icmp6[4].ÙPF å…è®¸å¯¹æ‰€æœ‰ ICMP ç±»å‹å’Œä»£ç è¿›è¡Œè¿‡æ»¤ã€‚å¯èƒ½çš„ç±»å‹å’Œä»£ç çš„åˆ—è¡¨åœ¨ man:icmp[4] å’Œ man:icmp6[4] ä¸­æœ‰æ–‡æ¡£è®°å½•ã€‚¬Using Tables¬ä½¿ç”¨è¡¨æ ¼ÚnSome types of data are relevant to filtering and redirection at a given time, but their definition is too long to be included in the ruleset file.  PF supports the use of tables, which are defined lists that can be manipulated without needing to reload the entire ruleset, and which can provide fast lookups.  Table names are always enclosed within `< >`, like this:ÚaæŸäº›ç±»å‹çš„æ•°æ®åœ¨ç‰¹å®šæ—¶é—´å¯¹è¿‡æ»¤å’Œé‡å®šå‘å¾ˆé‡è¦ï¼Œä½†å®ƒä»¬çš„å®šä¹‰å¤ªé•¿äº†ï¼Œæ— æ³•åŒ…å«åœ¨è§„åˆ™é›†æ–‡ä»¶ä¸­ã€‚ PF æ”¯æŒä½¿ç”¨è¡¨æ ¼ï¼Œè¿™äº›è¡¨æ ¼æ˜¯å®šä¹‰çš„åˆ—è¡¨ï¼Œå¯ä»¥åœ¨ä¸éœ€è¦é‡æ–°åŠ è½½æ•´ä¸ªè§„åˆ™é›†çš„æƒ…å†µä¸‹è¿›è¡Œæ“ä½œï¼Œå¹¶ä¸”å¯ä»¥æä¾›å¿«é€ŸæŸ¥æ‰¾ã€‚è¡¨æ ¼åç§°å§‹ç»ˆç”¨ `< >` æ‹¬èµ·æ¥ï¼Œå°±åƒè¿™æ ·ï¼šÚIn this example, the `192.168.2.0/24` network is part of the table, except for the address `192.168.2.5`, which is excluded using the `!` operator.  It is also possible to load tables from files where each item is on a separate line, as seen in this example [.filename]#/etc/clients#:Úåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ`192.168.2.0/24` ç½‘ç»œæ˜¯è¡¨çš„ä¸€éƒ¨åˆ†ï¼Œé™¤äº†åœ°å€ `192.168.2.5`ï¼Œå®ƒä½¿ç”¨ `!` è¿ç®—ç¬¦è¢«æ’é™¤åœ¨å¤–ã€‚è¿˜å¯ä»¥ä»æ–‡ä»¶ä¸­åŠ è½½è¡¨ï¼Œå…¶ä¸­æ¯ä¸ªé¡¹ç›®éƒ½åœ¨å•ç‹¬çš„è¡Œä¸Šï¼Œå°±åƒåœ¨è¿™ä¸ªä¾‹å­ä¸­çœ‹åˆ°çš„é‚£æ · [.filename]#/etc/clients#ï¼šÙ1To refer to the file, define the table like this:Ù9è¦å¼•ç”¨è¯¥æ–‡ä»¶ï¼Œè¯·æŒ‰ç…§ä»¥ä¸‹æ–¹å¼å®šä¹‰è¡¨æ ¼ï¼šÙ:Once the table is defined, it can be referenced by a rule:Ù9ä¸€æ—¦è¡¨è¢«å®šä¹‰ï¼Œå°±å¯ä»¥é€šè¿‡è§„åˆ™è¿›è¡Œå¼•ç”¨ï¼šÙkA table's contents can be manipulated live, using `pfctl`.  This example adds another network to the table:Ù`å¯ä»¥ä½¿ç”¨ `pfctl` å®æ—¶æ“ä½œè¡¨çš„å†…å®¹ã€‚ä»¥ä¸‹ç¤ºä¾‹å°†å¦ä¸€ä¸ªç½‘ç»œæ·»åŠ åˆ°è¡¨ä¸­ï¼šÚ*Note that any changes made this way will take affect now, making them ideal for testing, but will not survive a power failure or reboot.  To make the changes permanent, modify the definition of the table in the ruleset or edit the file that the table refers to.  One can maintain the on-disk copy of the table using a man:cron[8] job which dumps the table's contents to disk at regular intervals, using a command such as `pfctl -t clients -T show >/etc/clients`.  Alternatively, [.filename]#/etc/clients# can be updated with the in-memory table contents:Úóè¯·æ³¨æ„ï¼Œé€šè¿‡è¿™ç§æ–¹å¼è¿›è¡Œçš„ä»»ä½•æ›´æ”¹å°†ç«‹å³ç”Ÿæ•ˆï¼Œè¿™ä½¿å®ƒä»¬éå¸¸é€‚åˆæµ‹è¯•ï¼Œä½†åœ¨æ–­ç”µæˆ–é‡å¯åå°†ä¸ä¼šä¿ç•™ã€‚è¦ä½¿æ›´æ”¹æ°¸ä¹…ç”Ÿæ•ˆï¼Œå¯ä»¥ä¿®æ”¹è§„åˆ™é›†ä¸­è¡¨çš„å®šä¹‰æˆ–ç¼–è¾‘è¡¨æ‰€å¼•ç”¨çš„æ–‡ä»¶ã€‚å¯ä»¥ä½¿ç”¨ man:cron[8] ä½œä¸šæ¥ç»´æŠ¤è¡¨çš„ç£ç›˜å‰¯æœ¬ï¼Œè¯¥ä½œä¸šå®šæœŸå°†è¡¨çš„å†…å®¹è½¬å‚¨åˆ°ç£ç›˜ä¸Šï¼Œä½¿ç”¨ç±»ä¼¼ `pfctl -t clients -T show >/etc/clients` çš„å‘½ä»¤ã€‚æˆ–è€…ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ [.filename]#/etc/clients# æ›´æ–°å†…å­˜ä¸­çš„è¡¨å†…å®¹ï¼šÙ$Using Overload Tables to Protect SSH¹ä½¿ç”¨è¿‡è½½è¡¨ä¿æŠ¤ SSHÙmThose who run SSH on an external interface have probably seen something like this in the authentication logs:Ùné‚£äº›åœ¨å¤–éƒ¨æ¥å£ä¸Šè¿è¡Œ SSH çš„äººå¯èƒ½åœ¨èº«ä»½éªŒè¯æ—¥å¿—ä¸­çœ‹åˆ°ç±»ä¼¼äºä»¥ä¸‹å†…å®¹çš„ä¿¡æ¯ï¼šÙŸThis is indicative of a brute force attack where somebody or some program is trying to discover the user name and password which will let them into the system.Ù„è¿™è¡¨æ˜æ­£åœ¨è¿›è¡Œä¸€æ¬¡æš´åŠ›æ”»å‡»ï¼ŒæŸäººæˆ–æŸä¸ªç¨‹åºæ­£åœ¨å°è¯•å‘ç°èƒ½å¤Ÿè®©ä»–ä»¬è¿›å…¥ç³»ç»Ÿçš„ç”¨æˆ·åå’Œå¯†ç ã€‚Ú If external SSH access is needed for legitimate users, changing the default port used by SSH can offer some protection.  However, PF provides a more elegant solution.  Pass rules can contain limits on what connecting hosts can do and violators can be banished to a table of addresses which are denied some or all access.  It is even possible to drop all existing connections from machines which overreach the limits.Úcå¦‚æœéœ€è¦åˆæ³•ç”¨æˆ·è¿›è¡Œå¤–éƒ¨ SSH è®¿é—®ï¼Œæ›´æ”¹ SSH ä½¿ç”¨çš„é»˜è®¤ç«¯å£å¯ä»¥æä¾›ä¸€å®šçš„ä¿æŠ¤ã€‚ç„¶è€Œï¼ŒPF æä¾›äº†ä¸€ç§æ›´ä¼˜é›…çš„è§£å†³æ–¹æ¡ˆã€‚é€šè¿‡ Pass è§„åˆ™ï¼Œå¯ä»¥é™åˆ¶è¿æ¥ä¸»æœºçš„æ“ä½œï¼Œå¹¶å°†è¿è§„è€…æ”¾å…¥è¢«æ‹’ç»æŸäº›æˆ–å…¨éƒ¨è®¿é—®çš„åœ°å€è¡¨ä¸­ã€‚ç”šè‡³å¯ä»¥æ–­å¼€è¶…å‡ºé™åˆ¶çš„æœºå™¨çš„æ‰€æœ‰ç°æœ‰è¿æ¥ã€‚ÙJTo configure this, create this table in the tables section of the ruleset:ÙBè¦è¿›è¡Œé…ç½®ï¼Œè¯·åœ¨è§„åˆ™é›†çš„è¡¨æ ¼éƒ¨åˆ†åˆ›å»ºæ­¤è¡¨æ ¼ã€‚ÙgThen, somewhere early in the ruleset, add rules to block brute access while allowing legitimate access:Ùfç„¶åï¼Œåœ¨è§„åˆ™é›†çš„æ—©æœŸä½ç½®æ·»åŠ è§„åˆ™ï¼Œä»¥é˜»æ­¢æš´åŠ›è®¿é—®ï¼ŒåŒæ—¶å…è®¸åˆæ³•è®¿é—®ï¼šÙ„The part in parentheses defines the limits and the numbers should be changed to meet local requirements.  It can be read as follows:Ùræ‹¬å·ä¸­çš„éƒ¨åˆ†å®šä¹‰äº†é™åˆ¶æ¡ä»¶ï¼Œæ•°å­—åº”æ ¹æ®å½“åœ°è¦æ±‚è¿›è¡Œæ›´æ”¹ã€‚å¯ä»¥æŒ‰ä»¥ä¸‹æ–¹å¼é˜…è¯»ï¼šÙO`max-src-conn` is the number of simultaneous connections allowed from one host.ÙB`max-src-conn` æ˜¯æŒ‡å…è®¸æ¥è‡ªä¸€ä¸ªä¸»æœºçš„åŒæ—¶è¿æ¥æ•°ã€‚Ùs`max-src-conn-rate` is the rate of new connections allowed from any single host (_15_) per number of seconds (_5_).Ùi`max-src-conn-rate` æ˜¯æ¯ç§’é’Ÿï¼ˆ_5_ï¼‰å…è®¸æ¥è‡ªä»»ä½•å•ä¸ªä¸»æœºçš„æ–°è¿æ¥çš„é€Ÿç‡ï¼ˆ_15_ï¼‰ã€‚ÙÂ`overload <bruteforce>` means that any host which exceeds these limits gets its address added to the `bruteforce` table.  The ruleset blocks all traffic from addresses in the `bruteforce` table.Ù»`overload <bruteforce>` çš„æ„æ€æ˜¯ä»»ä½•è¶…è¿‡è¿™äº›é™åˆ¶çš„ä¸»æœºéƒ½ä¼šå°†å…¶åœ°å€æ·»åŠ åˆ° `bruteforce` è¡¨ä¸­ã€‚è§„åˆ™é›†ä¼šé˜»æ­¢æ¥è‡ª `bruteforce` è¡¨ä¸­åœ°å€çš„æ‰€æœ‰æµé‡ã€‚ÙFinally, `flush global` says that when a host reaches the limit, that all (`global`) of that host's connections will be terminated (`flush`).Ù}æœ€åï¼Œ`flush global` è¡¨ç¤ºå½“ä¸€ä¸ªä¸»æœºè¾¾åˆ°é™åˆ¶æ—¶ï¼Œè¯¥ä¸»æœºçš„æ‰€æœ‰è¿æ¥ (`global`) å°†è¢«ç»ˆæ­¢ (`flush`) ã€‚Ù”These rules will _not_ block slow bruteforcers, as described in http://home.nuug.no/\~peter/hailmary2013/[http://home.nuug.no/~peter/hailmary2013/].Ù¡è¿™äº›è§„åˆ™å°† _ä¸ä¼š_ é˜»æ­¢æ…¢é€Ÿæš´åŠ›ç ´è§£è€…ï¼Œå¦‚ http://home.nuug.no/\~peter/hailmary2013/[http://home.nuug.no/~peter/hailmary2013/] ä¸­æ‰€æè¿°çš„ã€‚ÚThis example ruleset is intended mainly as an illustration.  For example, if a generous number of connections in general are wanted, but the desire is to be more restrictive when it comes to ssh, supplement the rule above with something like the one below, early on in the rule set:ÙÎè¿™ä¸ªç¤ºä¾‹è§„åˆ™é›†ä¸»è¦æ˜¯ä¸ºäº†è¯´æ˜ã€‚ä¾‹å¦‚ï¼Œå¦‚æœå¸Œæœ›æœ‰å¤§é‡çš„è¿æ¥ï¼Œä½†å¯¹äº ssh çš„è¦æ±‚æ›´åŠ ä¸¥æ ¼ï¼Œå¯ä»¥åœ¨è§„åˆ™é›†çš„æ—©æœŸæ·»åŠ ä»¥ä¸‹ç±»ä¼¼çš„è§„åˆ™æ¥è¡¥å……ä¸Šé¢çš„è§„åˆ™ï¼šÙ6*It May Not be Necessary to Block All Overloaders:* +
Ù,*ä¸ä¸€å®šéœ€è¦é˜»æ­¢æ‰€æœ‰è¶…è½½å™¨ï¼š* +
Ù¹It is worth noting that the overload mechanism is a general technique which does not apply exclusively to SSH, and it is not always optimal to entirely block all traffic from offenders.Ùå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¿‡è½½æœºåˆ¶æ˜¯ä¸€ç§é€šç”¨æŠ€æœ¯ï¼Œä¸ä»…é€‚ç”¨äº SSHï¼Œå¹¶ä¸”å®Œå…¨é˜»æ­¢æ¥è‡ªè¿è§„è€…çš„æ‰€æœ‰æµé‡å¹¶ä¸æ€»æ˜¯æœ€ä¼˜çš„é€‰æ‹©ã€‚ÙğFor example, an overload rule could be used to protect a mail service or a web service, and the overload table could be used in a rule to assign offenders to a queue with a minimal bandwidth allocation or to redirect to a specific web page.ÙÒä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨è¿‡è½½è§„åˆ™æ¥ä¿æŠ¤é‚®ä»¶æœåŠ¡æˆ–ç½‘ç»œæœåŠ¡ï¼Œå¹¶ä¸”å¯ä»¥åœ¨è§„åˆ™ä¸­ä½¿ç”¨è¿‡è½½è¡¨æ¥å°†è¿è§„è€…åˆ†é…åˆ°å¸¦æœ‰æœ€å°å¸¦å®½åˆ†é…çš„é˜Ÿåˆ—ä¸­ï¼Œæˆ–è€…é‡å®šå‘åˆ°ç‰¹å®šçš„ç½‘é¡µã€‚Ú-Over time, tables will be filled by overload rules and their size will grow incrementally, taking up more memory.  Sometimes an IP address that is blocked is a dynamically assigned one, which has since been assigned to a host who has a legitimate reason to communicate with hosts in the local network.Úéšç€æ—¶é—´çš„æ¨ç§»ï¼Œè¡¨æ ¼å°†è¢«è¿‡è½½è§„åˆ™å¡«æ»¡ï¼Œå…¶å¤§å°å°†é€æ¸å¢é•¿ï¼Œå ç”¨æ›´å¤šçš„å†…å­˜ã€‚æœ‰æ—¶ï¼Œè¢«é˜»æ­¢çš„ IP åœ°å€æ˜¯ä¸€ä¸ªåŠ¨æ€åˆ†é…çš„åœ°å€ï¼Œåæ¥è¢«åˆ†é…ç»™äº†ä¸€ä¸ªæœ‰åˆæ³•ç†ç”±ä¸æœ¬åœ°ç½‘ç»œä¸­çš„ä¸»æœºé€šä¿¡çš„ä¸»æœºã€‚ÙÆFor situations like these, pfctl provides the ability to expire table entries.  For example, this command will remove `<bruteforce>` table entries which have not been referenced for `86400` seconds:Ù—å¯¹äºè¿™ç§æƒ…å†µï¼Œpfctl æä¾›äº†è¿‡æœŸè¡¨é¡¹çš„åŠŸèƒ½ã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹å‘½ä»¤å°†åˆ é™¤åœ¨ `86400` ç§’å†…æ²¡æœ‰è¢«å¼•ç”¨çš„ `<bruteforce>` è¡¨é¡¹ï¼šÙSimilar functionality is provided by package:security/expiretable[], which removes table entries which have not been accessed for a specified period of time.Ùwç±»ä¼¼çš„åŠŸèƒ½ç”± package:security/expiretable[] æä¾›ï¼Œè¯¥åŒ…ä¼šåˆ é™¤åœ¨æŒ‡å®šæ—¶é—´å†…æœªè¢«è®¿é—®çš„è¡¨æ¡ç›®ã€‚Ù Once installed, expiretable can be run to remove `<bruteforce>` table entries older than a specified age.  This example removes all entries older than 24 hours:Ùœå®‰è£…å®Œæˆåï¼Œå¯ä»¥è¿è¡Œ expiretable æ¥åˆ é™¤æŒ‡å®šæ—¶é™ä¹‹å‰çš„ `<bruteforce>` è¡¨æ¡ç›®ã€‚ä»¥ä¸‹ç¤ºä¾‹å°†åˆ é™¤æ‰€æœ‰ 24 å°æ—¶ä¹‹å‰çš„æ¡ç›®ï¼š·Protecting Against SPAMÙ!é˜²æ­¢åƒåœ¾é‚®ä»¶çš„ä¿æŠ¤æªæ–½ÙñNot to be confused with the spamd daemon which comes bundled with spamassassin, package:mail/spamd[] can be configured with PF to provide an outer defense against SPAM.  This spamd hooks into the PF configuration using a set of redirections.ÙÌä¸è¦å°†å…¶ä¸ spamassassin æ†ç»‘çš„ spamd å®ˆæŠ¤ç¨‹åºæ··æ·†ï¼Œpackage:mail/spamd[] å¯ä»¥é€šè¿‡é…ç½® PF æ¥æä¾›å¯¹åƒåœ¾é‚®ä»¶çš„å¤–éƒ¨é˜²å¾¡ã€‚è¿™ä¸ª spamd é€šè¿‡ä¸€ç»„é‡å®šå‘é’©å…¥ PF é…ç½®ã€‚ÙÒSpammers tend to send a large number of messages, and SPAM is mainly sent from a few spammer friendly networks and a large number of hijacked machines, both of which are reported to _blocklists_ fairly quickly.Ù·åƒåœ¾é‚®ä»¶å‘é€è€…å¾€å¾€å‘é€å¤§é‡çš„æ¶ˆæ¯ï¼Œåƒåœ¾é‚®ä»¶ä¸»è¦æ¥è‡ªä¸€äº›å‹å¥½çš„åƒåœ¾é‚®ä»¶ç½‘ç»œå’Œå¤§é‡è¢«åŠ«æŒçš„æœºå™¨ï¼Œè¿™äº›éƒ½ä¼šè¢«è¿…é€ŸæŠ¥å‘Šç»™å°é”åˆ—è¡¨ã€‚Ú‰When an SMTP connection from an address in a blocklist is received, spamd presents its banner and immediately switches to a mode where it answers SMTP traffic one byte at a time.  This technique, which is intended to waste as much time as possible on the spammer's end, is called _tarpitting_.  The specific implementation which uses one byte SMTP replies is often referred to as _stuttering_.Úaå½“æ¥æ”¶åˆ°æ¥è‡ªé»‘åå•ä¸­åœ°å€çš„ SMTP è¿æ¥æ—¶ï¼Œspamd ä¼šå‘ˆç°å…¶æ¨ªå¹…ï¼Œå¹¶ç«‹å³åˆ‡æ¢åˆ°ä¸€ç§æ¨¡å¼ï¼Œä»¥é€å­—èŠ‚åœ°å›ç­” SMTP æµé‡ã€‚è¿™ç§æŠ€æœ¯æ—¨åœ¨å°½å¯èƒ½æµªè´¹åƒåœ¾é‚®ä»¶å‘é€è€…çš„æ—¶é—´ï¼Œè¢«ç§°ä¸ºâ€œèœ¿èœ’ï¼ˆtarpittingï¼‰â€ã€‚å…·ä½“å®ç°ä½¿ç”¨é€å­—èŠ‚ SMTP å›å¤çš„æ–¹æ³•é€šå¸¸è¢«ç§°ä¸ºâ€œå£åƒï¼ˆstutteringï¼‰â€ã€‚ÙÅThis example demonstrates the basic procedure for setting up spamd with automatically updated blocklists.  Refer to the man pages which are installed with package:mail/spamd[] for more information.Ù¦è¿™ä¸ªç¤ºä¾‹æ¼”ç¤ºäº†ä½¿ç”¨è‡ªåŠ¨æ›´æ–°çš„å±è”½åˆ—è¡¨è®¾ç½® spamd çš„åŸºæœ¬æ­¥éª¤ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è€ƒå®‰è£…åœ¨ package:mail/spamd[] ä¸­çš„ man é¡µé¢ã€‚¼Procedure: Configuring spamd³é…ç½® spamd è¿‡ç¨‹ÙÁInstall the package:mail/spamd[] package or port. To use spamd's greylisting features, man:fdescfs[5] must be mounted at [.filename]#/dev/fd#. Add the following line to [.filename]#/etc/fstab#:Ù¹å®‰è£… package:mail/spamd[] åŒ…æˆ– portã€‚è¦ä½¿ç”¨ spamd çš„ç°åå•åŠŸèƒ½ï¼Œå¿…é¡»åœ¨ [.filename]#/dev/fd# ä¸ŠæŒ‚è½½ man:fdescfs[5]ã€‚å°†ä»¥ä¸‹è¡Œæ·»åŠ åˆ° [.filename]#/etc/fstab#ï¼š»Then, mount the filesystem:¾ç„¶åï¼ŒæŒ‚è½½æ–‡ä»¶ç³»ç»Ÿï¼šÙ%Next, edit the PF ruleset to include:Ù7æ¥ä¸‹æ¥ï¼Œç¼–è¾‘ PF è§„åˆ™é›†ä»¥åŒ…å«ä»¥ä¸‹å†…å®¹ï¼šÙÂThe two tables `<spamd>` and `<spamd-white>` are essential.  SMTP traffic from an address listed in `<spamd>` but not in `<spamd-white>` is redirected to the spamd daemon listening at port 8025.ÙÏä¸¤ä¸ªè¡¨ `<spamd>` å’Œ `<spamd-white>` æ˜¯å¿…éœ€çš„ã€‚æ¥è‡ªåœ¨ `<spamd>` ä¸­åˆ—å‡ºä½†ä¸åœ¨ `<spamd-white>` ä¸­åˆ—å‡ºçš„åœ°å€çš„ SMTP æµé‡å°†è¢«é‡å®šå‘åˆ°ç›‘å¬åœ¨ç«¯å£ 8025 çš„ spamd å®ˆæŠ¤è¿›ç¨‹ã€‚Ù~The next step is to configure spamd in [.filename]#/usr/local/etc/spamd.conf# and to add some [.filename]#rc.conf# parameters.Ùwä¸‹ä¸€æ­¥æ˜¯åœ¨ [.filename]#/usr/local/etc/spamd.conf# ä¸­é…ç½® spamdï¼Œå¹¶æ·»åŠ ä¸€äº› [.filename]#rc.conf# å‚æ•°ã€‚ÚThe installation of package:mail/spamd[] includes a sample configuration file ([.filename]#/usr/local/etc/spamd.conf.sample#) and a man page for [.filename]#spamd.conf#.  Refer to these for additional configuration options beyond those shown in this example.Ùüpackage:mail/spamd[] å®‰è£…åŒ…æ‹¬ä¸€ä¸ªç¤ºä¾‹é…ç½®æ–‡ä»¶ï¼ˆ[.filename]#/usr/local/etc/spamd.conf.sample#ï¼‰å’Œä¸€ä¸ªç”¨äº [.filename]#spamd.conf# çš„ man é¡µé¢ã€‚è¯·å‚è€ƒè¿™äº›å†…å®¹ä»¥è·å–è¶…å‡ºæœ¬ç¤ºä¾‹æ‰€ç¤ºé…ç½®é€‰é¡¹çš„å…¶ä»–é…ç½®é€‰é¡¹ã€‚Ù±One of the first lines in the configuration file that does not begin with a `+#+` comment sign contains the block which defines the `all` list, which specifies the lists to use:Ù†é…ç½®æ–‡ä»¶ä¸­ç¬¬ä¸€è¡Œä¸ä»¥ `+#+` æ³¨é‡Šç¬¦å·å¼€å¤´çš„è¡ŒåŒ…å«äº†å®šä¹‰ `all` åˆ—è¡¨çš„å—ï¼Œè¯¥åˆ—è¡¨æŒ‡å®šè¦ä½¿ç”¨çš„åˆ—è¡¨ï¼šÙóThis entry adds the desired blocklists, separated by colons (`:`).  To use an allowlist to subtract addresses from a blocklist, add the name of the allowlist _immediately_ after the name of that blocklist. For example: `:blocklist:allowlist:`.Ùëæ­¤æ¡ç›®æ·»åŠ äº†æ‰€éœ€çš„é˜»æ­¢åˆ—è¡¨ï¼Œç”¨å†’å·ï¼ˆ`:`ï¼‰åˆ†éš”ã€‚è¦ä½¿ç”¨å…è®¸åˆ—è¡¨ä»é˜»æ­¢åˆ—è¡¨ä¸­å‡å»åœ°å€ï¼Œè¯·åœ¨è¯¥é˜»æ­¢åˆ—è¡¨çš„åç§°ä¹‹å _ç«‹å³_ æ·»åŠ å…è®¸åˆ—è¡¨çš„åç§°ã€‚ä¾‹å¦‚ï¼š`:blocklist:allowlist:` ã€‚Ù9This is followed by the specified blocklist's definition:Ù'æ¥ä¸‹æ¥æ˜¯æŒ‡å®šå—åˆ—è¡¨çš„å®šä¹‰ï¼šÚÍwhere the first line is the name of the blocklist and the second line specifies the list type.  The `msg` field contains the message to display to blocklisted senders during the SMTP dialogue.  The `method` field specifies how spamd-setup fetches the list data; supported methods are `http`, `ftp`, from a `file` in a mounted file system, and via `exec` of an external program.  Finally, the `file` field specifies the name of the file spamd expects to receive.Ú›ç¬¬ä¸€è¡Œæ˜¯å—åˆ—è¡¨çš„åç§°ï¼Œç¬¬äºŒè¡ŒæŒ‡å®šäº†åˆ—è¡¨ç±»å‹ã€‚`msg` å­—æ®µåŒ…å«åœ¨ SMTP å¯¹è¯æœŸé—´æ˜¾ç¤ºç»™è¢«åˆ—å…¥å—åˆ—è¡¨çš„å‘ä»¶äººçš„æ¶ˆæ¯ã€‚`method` å­—æ®µæŒ‡å®šäº† spamd-setup è·å–åˆ—è¡¨æ•°æ®çš„æ–¹å¼ï¼›æ”¯æŒçš„æ–¹æ³•æœ‰ `http`ã€`ftp`ã€ä»æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿä¸­çš„ `file` æ–‡ä»¶å’Œé€šè¿‡æ‰§è¡Œå¤–éƒ¨ç¨‹åºçš„ `exec`ã€‚æœ€åï¼Œ`file` å­—æ®µæŒ‡å®šäº† spamd æœŸæœ›æ¥æ”¶çš„æ–‡ä»¶çš„åç§°ã€‚ÙnThe definition of the specified allowlist is similar, but omits the `msg` field since a message is not needed:ÙXæŒ‡å®šå…è®¸åˆ—è¡¨çš„å®šä¹‰ç±»ä¼¼ï¼Œä½†çœç•¥äº† `msg` å­—æ®µï¼Œå› ä¸ºä¸éœ€è¦æ¶ˆæ¯ã€‚Ù#*Choose Data Sources with Care:* +
»*è°¨æ…é€‰æ‹©æ•°æ®æº:* +
ÙûUsing all the blocklists in the sample [.filename]#spamd.conf# will block large blocks of the Internet.  Administrators need to edit the file to create an optimal configuration which uses applicable data sources and, when necessary, uses custom lists.Ùåä½¿ç”¨æ ·æœ¬ä¸­çš„æ‰€æœ‰å±è”½åˆ—è¡¨ [.filename]#spamd.conf# å°†ä¼šå±è”½å¤§é‡çš„äº’è”ç½‘åŒºå—ã€‚ç®¡ç†å‘˜éœ€è¦ç¼–è¾‘è¯¥æ–‡ä»¶ï¼Œä»¥åˆ›å»ºä¸€ä¸ªæœ€ä½³é…ç½®ï¼Œä½¿ç”¨é€‚ç”¨çš„æ•°æ®æºï¼Œå¹¶åœ¨å¿…è¦æ—¶ä½¿ç”¨è‡ªå®šä¹‰åˆ—è¡¨ã€‚Ù|Next, add this entry to [.filename]#/etc/rc.conf#.  Additional flags are described in the man page specified by the comment:Ùƒæ¥ä¸‹æ¥ï¼Œå°†æ­¤æ¡ç›®æ·»åŠ åˆ° [.filename]#/etc/rc.conf# æ–‡ä»¶ä¸­ã€‚å…¶ä»–æ ‡å¿—åœ¨ç”±æ³¨é‡ŠæŒ‡å®šçš„ man é¡µé¢ä¸­æœ‰æè¿°ã€‚ÙğWhen finished, reload the ruleset, start spamd by typing `service obspamd start`, and complete the configuration using `spamd-setup`.  Finally, create a man:cron[8] job which calls `spamd-setup` to update the tables at reasonable intervals.Ù×å®Œæˆåï¼Œé‡æ–°åŠ è½½è§„åˆ™é›†ï¼Œé€šè¿‡è¾“å…¥ `service obspamd start` å¯åŠ¨ spamdï¼Œå¹¶ä½¿ç”¨ `spamd-setup` å®Œæˆé…ç½®ã€‚æœ€åï¼Œåˆ›å»ºä¸€ä¸ª man:cron[8] ä»»åŠ¡ï¼Œå®šæœŸè°ƒç”¨ `spamd-setup` æ¥æ›´æ–°è¡¨æ ¼ã€‚Ù~On a typical gateway in front of a mail server, hosts will soon start getting trapped within a few seconds to several minutes.Ùcåœ¨é‚®ä»¶æœåŠ¡å™¨å‰çš„å…¸å‹ç½‘å…³ä¸Šï¼Œä¸»æœºå¾ˆå¿«å°±ä¼šåœ¨å‡ ç§’é’Ÿåˆ°å‡ åˆ†é’Ÿå†…è¢«å›°ä½ã€‚Ú>PF also supports _greylisting_, which temporarily rejects messages from unknown hosts with _45n_ codes.  Messages from greylisted hosts which try again within a reasonable time are let through.  Traffic from senders which are set up to behave within the limits set by RFC 1123 and RFC 2821 are immediately let through.Ú
PF è¿˜æ”¯æŒ _ç°åå•ï¼ˆgreylistingï¼‰_ï¼Œå®ƒä¼šæš‚æ—¶æ‹’ç»æ¥è‡ªæœªçŸ¥ä¸»æœºçš„å¸¦æœ‰ _45n_ ä»£ç çš„æ¶ˆæ¯ã€‚åœ¨åˆç†çš„æ—¶é—´å†…å†æ¬¡å°è¯•çš„ç°åå•ä¸»æœºçš„æ¶ˆæ¯å°†è¢«æ”¾è¡Œã€‚ç¬¦åˆ RFC 1123 å’Œ RFC 2821 è§„å®šçš„å‘ä»¶äººçš„æµé‡å°†ç«‹å³è¢«æ”¾è¡Œã€‚Ú/More information about greylisting as a technique can be found at the http://www.greylisting.org/[greylisting.org] web site.  The most amazing thing about greylisting, apart from its simplicity, is that it still works.  Spammers and malware writers have been very slow to adapt to bypass this technique.Ú!å…³äºç°åå•æŠ€æœ¯çš„æ›´å¤šä¿¡æ¯å¯ä»¥åœ¨ http://www.greylisting.org/[greylisting.org] ç½‘ç«™ä¸Šæ‰¾åˆ°ã€‚ç°åå•æœ€ä»¤äººæƒŠè®¶çš„äº‹æƒ…ä¹‹ä¸€ï¼Œé™¤äº†å®ƒçš„ç®€å•æ€§ï¼Œå°±æ˜¯å®ƒä»ç„¶æœ‰æ•ˆã€‚åƒåœ¾é‚®ä»¶å‘é€è€…å’Œæ¶æ„è½¯ä»¶ç¼–å†™è€…ä¸€ç›´éå¸¸æ…¢åœ°é€‚åº”ç»•è¿‡è¿™ç§æŠ€æœ¯ã€‚Ù>The basic procedure for configuring greylisting is as follows:Ù'é…ç½®ç°åå•çš„åŸºæœ¬æ­¥éª¤å¦‚ä¸‹ï¼šÙ"Procedure: Configuring Greylistingµé…ç½®ç°åå•è¿‡ç¨‹ÙZMake sure that man:fdescfs[5] is mounted as described in Step 1 of the previous Procedure.ÙIç¡®ä¿æŒ‰ç…§ä¸Šä¸€ä¸ªæ­¥éª¤çš„è¯´æ˜ï¼Œå°† man:fdescfs[5] æŒ‚è½½èµ·æ¥ã€‚ÙMTo run spamd in greylisting mode, add this line to [.filename]#/etc/rc.conf#:Ùcè¦ä»¥ç°åå•æ¨¡å¼è¿è¡Œ spamdï¼Œè¯·å°†ä»¥ä¸‹è¡Œæ·»åŠ åˆ° [.filename]#/etc/rc.conf# æ–‡ä»¶ä¸­ï¼šÙNRefer to the spamd man page for descriptions of additional related parameters.Ù=è¯·å‚è€ƒ spamd æ‰‹å†Œï¼Œäº†è§£å…¶ä»–ç›¸å…³å‚æ•°çš„æè¿°ã€‚Ù"To complete the greylisting setup:Ù!å®Œæˆç°åå•è®¾ç½®çš„æ­¥éª¤ï¼šÚ Behind the scenes, the spamdb database tool and the spamlogd whitelist updater perform essential functions for the greylisting feature.  spamdb is the administrator's main interface to managing the block, grey, and allow lists via the contents of the [.filename]#/var/db/spamdb# database.Ùïåœ¨å¹•åï¼Œspamdb æ•°æ®åº“å·¥å…·å’Œ spamlogd ç™½åå•æ›´æ–°ç¨‹åºä¸ºç°åå•åŠŸèƒ½æ‰§è¡Œé‡è¦åŠŸèƒ½ã€‚spamdb æ˜¯ç®¡ç†å‘˜é€šè¿‡ [.filename]#/var/db/spamdb# æ•°æ®åº“çš„å†…å®¹æ¥ç®¡ç†é˜»æ­¢ã€ç°åå•å’Œå…è®¸åå•çš„ä¸»è¦ç•Œé¢ã€‚¯Network Hygiene¬ç½‘ç»œç»´æŠ¤ÙrThis section describes how `block-policy`, `scrub`, and `antispoof` can be used to make the ruleset behave sanely.Ùfæœ¬èŠ‚ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨ `block-policy`ã€`scrub` å’Œ `antispoof` æ¥ä½¿è§„åˆ™é›†çš„è¡Œä¸ºæ­£å¸¸ã€‚Ú}The `block-policy` is an option which can be set in the `options` part of the ruleset, which precedes the redirection and filtering rules.  This option determines which feedback, if any, PF sends to hosts that are blocked by a rule.  The option has two possible values: `drop` drops blocked packets with no feedback, and `return` returns a status code such as `Connection refused`.Ú{`block-policy` æ˜¯ä¸€ä¸ªé€‰é¡¹ï¼Œå¯ä»¥åœ¨è§„åˆ™é›†çš„ `options` éƒ¨åˆ†ä¸­è®¾ç½®ï¼Œè¯¥éƒ¨åˆ†ä½äºé‡å®šå‘å’Œè¿‡æ»¤è§„åˆ™ä¹‹å‰ã€‚è¯¥é€‰é¡¹ç¡®å®šäº† PF åœ¨è§„åˆ™é˜»æ­¢ä¸»æœºæ—¶å‘é€çš„åé¦ˆä¿¡æ¯ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ã€‚è¯¥é€‰é¡¹æœ‰ä¸¤ä¸ªå¯èƒ½çš„å€¼ï¼š`drop` ä¼šä¸¢å¼ƒè¢«é˜»æ­¢çš„æ•°æ®åŒ…è€Œä¸æä¾›åé¦ˆï¼Œ`return` ä¼šè¿”å›ä¸€ä¸ªçŠ¶æ€ç ï¼Œä¾‹å¦‚ `Connection refused`ã€‚ÙcIf not set, the default policy is `drop`.  To change the `block-policy`, specify the desired value:Ù^å¦‚æœæœªè®¾ç½®ï¼Œé»˜è®¤ç­–ç•¥ä¸º `drop`ã€‚è¦æ›´æ”¹ `block-policy`ï¼Œè¯·æŒ‡å®šæ‰€éœ€çš„å€¼ï¼šÚ“In PF, `scrub` is a keyword which enables network packet normalization.  This process reassembles fragmented packets and drops TCP packets that have invalid flag combinations.  Enabling `scrub` provides a measure of protection against certain kinds of attacks based on incorrect handling of packet fragments.  A number of options are available, but the simplest form is suitable for most configurations:Úyåœ¨ PF ä¸­ï¼Œ`scrub` æ˜¯ä¸€ä¸ªå…³é”®å­—ï¼Œå®ƒå¯ä»¥å¯ç”¨ç½‘ç»œæ•°æ®åŒ…çš„è§„èŒƒåŒ–ã€‚è¯¥è¿‡ç¨‹ä¼šé‡æ–°ç»„è£…åˆ†æ®µçš„æ•°æ®åŒ…ï¼Œå¹¶ä¸”ä¸¢å¼ƒå…·æœ‰æ— æ•ˆæ ‡å¿—ç»„åˆçš„ TCP æ•°æ®åŒ…ã€‚å¯ç”¨ `scrub` å¯ä»¥æä¾›ä¸€å®šç¨‹åº¦çš„ä¿æŠ¤ï¼Œé˜²æ­¢åŸºäºæ•°æ®åŒ…ç‰‡æ®µå¤„ç†ä¸æ­£ç¡®çš„æŸäº›æ”»å‡»ã€‚æœ‰è®¸å¤šé€‰é¡¹å¯ä¾›é€‰æ‹©ï¼Œä½†æœ€ç®€å•çš„å½¢å¼é€‚ç”¨äºå¤§å¤šæ•°é…ç½®ï¼šÙÃSome services, such as NFS, require specific fragment handling options.  Refer to https://home.nuug.no/\~peter/pf/en/scrub.html[https://home.nuug.no/~peter/pf/en/scrub.html] for more information.Ù·ä¸€äº›æœåŠ¡ï¼Œå¦‚ NFSï¼Œéœ€è¦ç‰¹å®šçš„ç‰‡æ®µå¤„ç†é€‰é¡¹ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜… https://home.nuug.no/\~peter/pf/en/scrub.html[https://home.nuug.no/~peter/pf/en/scrub.html]ÙvThis example reassembles fragments, clears the "do not fragment" bit, and sets the maximum segment size to 1440 bytes:Ùè¿™ä¸ªä¾‹å­é‡æ–°ç»„è£…ç‰‡æ®µï¼Œæ¸…é™¤â€œä¸åˆ†æ®µï¼ˆdo not fragmentï¼‰â€ä½ï¼Œå¹¶å°†æœ€å¤§åˆ†æ®µå¤§å°è®¾ç½®ä¸º 1440 å­—èŠ‚ï¼šÙ¿The `antispoof` mechanism protects against activity from spoofed or forged IP addresses, mainly by blocking packets appearing on interfaces and in directions which are logically not possible.Ù `antispoof` æœºåˆ¶é€šè¿‡é˜»æ­¢å‡ºç°åœ¨é€»è¾‘ä¸Šä¸å¯èƒ½çš„æ¥å£å’Œæ–¹å‘ä¸Šçš„æ•°æ®åŒ…ï¼Œä¸»è¦ä¿æŠ¤å…å—ä¼ªé€ æˆ–ä¼ªè£…çš„ IP åœ°å€çš„æ´»åŠ¨çš„å½±å“ã€‚ÙThese rules weed out spoofed traffic coming in from the rest of the world as well as any spoofed packets which originate in the local network:Ùxè¿™äº›è§„åˆ™å¯ä»¥è¿‡æ»¤æ‰æ¥è‡ªä¸–ç•Œå…¶ä»–åœ°æ–¹çš„ä¼ªé€ æµé‡ï¼Œä»¥åŠæºè‡ªæœ¬åœ°ç½‘ç»œçš„ä»»ä½•ä¼ªé€ æ•°æ®åŒ…ã€‚¿Handling Non-Routable Addresses¸å¤„ç†éå¯è·¯ç”±åœ°å€ÚÇEven with a properly configured gateway to handle network address translation, one may have to compensate for other people's misconfigurations.  A common misconfiguration is to let traffic with non-routable addresses out to the Internet.  Since traffic from non-routeable addresses can play a part in several DoS attack techniques, consider explicitly blocking traffic from non-routeable addresses from entering the network through the external interface.Úkå³ä½¿æœ‰ä¸€ä¸ªæ­£ç¡®é…ç½®çš„ç½‘å…³æ¥å¤„ç†ç½‘ç»œåœ°å€è½¬æ¢ï¼Œäººä»¬å¯èƒ½ä»ç„¶éœ€è¦å¼¥è¡¥å…¶ä»–äººçš„é”™è¯¯é…ç½®ã€‚å¸¸è§çš„é”™è¯¯é…ç½®æ˜¯å…è®¸éå¯è·¯ç”±åœ°å€çš„æµé‡è¿›å…¥äº’è”ç½‘ã€‚ç”±äºæ¥è‡ªéå¯è·¯ç”±åœ°å€çš„æµé‡å¯èƒ½å‚ä¸å¤šç§æ‹’ç»æœåŠ¡æ”»å‡»æŠ€æœ¯ï¼Œå»ºè®®é€šè¿‡å¤–éƒ¨æ¥å£æ˜ç¡®åœ°é˜»æ­¢éå¯è·¯ç”±åœ°å€çš„æµé‡è¿›å…¥ç½‘ç»œã€‚ÙÀIn this example, a macro containing non-routable addresses is defined, then used in blocking rules.  Traffic to and from these addresses is quietly dropped on the gateway's external interface.Ù«åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå®šä¹‰äº†ä¸€ä¸ªåŒ…å«éå¯è·¯ç”±åœ°å€çš„å®ï¼Œç„¶ååœ¨é˜»æ­¢è§„åˆ™ä¸­ä½¿ç”¨ã€‚å¯¹è¿™äº›åœ°å€çš„æµé‡åœ¨ç½‘å…³çš„å¤–éƒ¨æ¥å£ä¸Šè¢«é™é»˜ä¸¢å¼ƒã€‚­Enabling ALTQ«å¯ç”¨ ALTQÙÂOn FreeBSD, ALTQ can be used with PF to provide Quality of Service (QOS).  Once ALTQ is enabled, queues can be defined in the ruleset which determine the processing priority of outbound packets.Ù±åœ¨ FreeBSD ä¸Šï¼Œå¯ä»¥ä½¿ç”¨ ALTQ ä¸ PF ä¸€èµ·æä¾›æœåŠ¡è´¨é‡ï¼ˆQoSï¼‰ã€‚ä¸€æ—¦å¯ç”¨ ALTQï¼Œå¯ä»¥åœ¨è§„åˆ™é›†ä¸­å®šä¹‰é˜Ÿåˆ—ï¼Œç¡®å®šå‡ºç«™æ•°æ®åŒ…çš„å¤„ç†ä¼˜å…ˆçº§ã€‚Ù€Before enabling ALTQ, refer to man:altq[4] to determine if the drivers for the network cards installed on the system support it.Ùpåœ¨å¯ç”¨ ALTQ ä¹‹å‰ï¼Œè¯·å‚è€ƒ man:altq[4] ä»¥ç¡®å®šç³»ç»Ÿä¸Šå®‰è£…çš„ç½‘ç»œå¡é©±åŠ¨ç¨‹åºæ˜¯å¦æ”¯æŒå®ƒã€‚Ú€ALTQ is not available as a loadable kernel module.  If the system's interfaces support ALTQ, create a custom kernel using the instructions in crossref:kernelconfig[kernelconfig,Configuring the FreeBSD Kernel].  The following kernel options are available.  The first is needed to enable ALTQ.  At least one of the other options is necessary to specify the queueing scheduler algorithm:Ú4ALTQ ä¸å¯ç”¨ä½œå¯åŠ è½½çš„å†…æ ¸æ¨¡å—ã€‚å¦‚æœç³»ç»Ÿçš„æ¥å£æ”¯æŒ ALTQï¼Œè¯·æŒ‰ç…§ crossref:kernelconfig[kernelconfig,é…ç½® FreeBSD å†…æ ¸] ä¸­çš„è¯´æ˜åˆ›å»ºè‡ªå®šä¹‰å†…æ ¸ã€‚ä»¥ä¸‹å†…æ ¸é€‰é¡¹å¯ç”¨ã€‚ç¬¬ä¸€ä¸ªé€‰é¡¹ç”¨äºå¯ç”¨ ALTQã€‚å…¶ä»–é€‰é¡¹ä¸­è‡³å°‘éœ€è¦ä¸€ä¸ªæ¥æŒ‡å®šé˜Ÿåˆ—è°ƒåº¦ç®—æ³•ï¼šÙ1The following scheduler algorithms are available:»ä»¥ä¸‹è°ƒåº¦ç®—æ³•å¯ç”¨ï¼šÙ’Class Based Queuing (CBQ) is used to divide a connection's bandwidth into different classes or queues to prioritize traffic based on filter rules.ÙåŸºäºç±»çš„æ’é˜Ÿï¼ˆCBQï¼‰ç”¨äºå°†è¿æ¥çš„å¸¦å®½åˆ’åˆ†ä¸ºä¸åŒçš„ç±»åˆ«æˆ–é˜Ÿåˆ—ï¼Œä»¥æ ¹æ®è¿‡æ»¤è§„åˆ™å¯¹æµé‡è¿›è¡Œä¼˜å…ˆçº§æ’åºã€‚ÙöRandom Early Detection (RED) is used to avoid network congestion by measuring the length of the queue and comparing it to the minimum and maximum thresholds for the queue.  When the queue is over the maximum, all new packets are randomly dropped.ÙÕéšæœºæ—©æœŸæ£€æµ‹ï¼ˆREDï¼‰ç”¨äºé€šè¿‡æµ‹é‡é˜Ÿåˆ—çš„é•¿åº¦å¹¶å°†å…¶ä¸é˜Ÿåˆ—çš„æœ€å°å’Œæœ€å¤§é˜ˆå€¼è¿›è¡Œæ¯”è¾ƒæ¥é¿å…ç½‘ç»œæ‹¥å¡ã€‚å½“é˜Ÿåˆ—è¶…è¿‡æœ€å¤§é˜ˆå€¼æ—¶ï¼Œæ‰€æœ‰æ–°çš„æ•°æ®åŒ…å°†è¢«éšæœºä¸¢å¼ƒã€‚Ù”In Random Early Detection In and Out (RIO) mode, RED maintains multiple average queue lengths and multiple threshold values, one for each QOS level.Ùåœ¨éšæœºæ—©æœŸæ£€æµ‹è¾“å…¥è¾“å‡ºï¼ˆRIOï¼‰æ¨¡å¼ä¸­ï¼ŒRED ç»´æŠ¤å¤šä¸ªå¹³å‡é˜Ÿåˆ—é•¿åº¦å’Œå¤šä¸ªé˜ˆå€¼ï¼Œæ¯ä¸ª QOS çº§åˆ«å¯¹åº”ä¸€ä¸ªé˜ˆå€¼ã€‚Ù¨Hierarchical Fair Service Curve Packet Scheduler (HFSC) is described in http://www-2.cs.cmu.edu/\~hzhang/HFSC/main.html[http://www-2.cs.cmu.edu/~hzhang/HFSC/main.html].Ù¬å±‚æ¬¡å…¬å¹³æœåŠ¡æ›²çº¿åˆ†ç»„è°ƒåº¦å™¨ï¼ˆHFSCï¼‰çš„æè¿°å¯ä»¥åœ¨ http://www-2.cs.cmu.edu/~hzhang/HFSC/main.html[http://www-2.cs.cmu.edu/~hzhang/HFSC/main.html] æ‰¾åˆ°ã€‚ÙNPriority Queuing (PRIQ) always passes traffic that is in a higher queue first.ÙIä¼˜å…ˆé˜Ÿåˆ—ï¼ˆPRIQï¼‰å§‹ç»ˆé¦–å…ˆä¼ é€’ä½äºè¾ƒé«˜é˜Ÿåˆ—ä¸­çš„æµé‡ã€‚ÙÉMore information about the scheduling algorithms and example rulesets are available at the https://web.archive.org/web/20151109213426/http://www.openbsd.org/faq/pf/queueing.html[OpenBSD's web archive].Ùµæœ‰å…³è°ƒåº¦ç®—æ³•å’Œç¤ºä¾‹è§„åˆ™é›†çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·è®¿é—® OpenBSD çš„ç½‘ç»œå­˜æ¡£ï¼š https://web.archive.org/web/20151109213426/http://www.openbsd.org/faq/pf/queueing.html ã€‚ÚTIPFW is a stateful firewall written for FreeBSD which supports both IPv4 and IPv6.  It is comprised of several components: the kernel firewall filter rule processor and its integrated packet accounting facility, the logging facility, NAT, the man:dummynet[4] traffic shaper, a forward facility, a bridge facility, and an ipstealth facility.Ú%IPFW æ˜¯ä¸º FreeBSD ç¼–å†™çš„ä¸€ç§æœ‰çŠ¶æ€é˜²ç«å¢™ï¼Œæ”¯æŒ IPv4 å’Œ IPv6ã€‚å®ƒç”±å‡ ä¸ªç»„ä»¶ç»„æˆï¼šå†…æ ¸é˜²ç«å¢™è¿‡æ»¤è§„åˆ™å¤„ç†å™¨åŠå…¶é›†æˆçš„æ•°æ®åŒ…è®¡æ•°åŠŸèƒ½ã€æ—¥å¿—è®°å½•åŠŸèƒ½ã€ NATã€man:dummynet[4] æµé‡æ•´å½¢å™¨ã€è½¬å‘åŠŸèƒ½ã€æ¡¥æ¥åŠŸèƒ½å’Œ ipstealth åŠŸèƒ½ã€‚ÚPFreeBSD provides a sample ruleset in [.filename]#/etc/rc.firewall# which defines several firewall types for common scenarios to assist novice users in generating an appropriate ruleset.  IPFW provides a powerful syntax which advanced users can use to craft customized rulesets that meet the security requirements of a given environment.Ú:FreeBSD åœ¨ [.filename]#/etc/rc.firewall# ä¸­æä¾›äº†ä¸€ä¸ªç¤ºä¾‹è§„åˆ™é›†ï¼Œè¯¥è§„åˆ™é›†å®šä¹‰äº†å‡ ç§å¸¸è§åœºæ™¯çš„é˜²ç«å¢™ç±»å‹ï¼Œä»¥å¸®åŠ©æ–°æ‰‹ç”¨æˆ·ç”Ÿæˆé€‚å½“çš„è§„åˆ™é›†ã€‚IPFW æä¾›äº†ä¸€ä¸ªå¼ºå¤§çš„è¯­æ³•ï¼Œé«˜çº§ç”¨æˆ·å¯ä»¥ä½¿ç”¨å®ƒæ¥åˆ›å»ºç¬¦åˆç‰¹å®šç¯å¢ƒå®‰å…¨è¦æ±‚çš„è‡ªå®šä¹‰è§„åˆ™é›†ã€‚Ù™This section describes how to enable IPFW, provides an overview of its rule syntax, and demonstrates several rulesets for common configuration scenarios.Ùzæœ¬èŠ‚ä»‹ç»äº†å¦‚ä½•å¯ç”¨ IPFWï¼Œæä¾›äº†å…¶è§„åˆ™è¯­æ³•çš„æ¦‚è¿°ï¼Œå¹¶æ¼”ç¤ºäº†å‡ ä¸ªå¸¸è§é…ç½®åœºæ™¯çš„è§„åˆ™é›†ã€‚­Enabling IPFW«å¯ç”¨ IPFWÙIPFW is included in the basic FreeBSD install as a kernel loadable module, meaning that a custom kernel is not needed in order to enable IPFW.Ù‹IPFW å·²ç»ä½œä¸ºä¸€ä¸ªå¯åŠ è½½çš„å†…æ ¸æ¨¡å—åŒ…å«åœ¨åŸºæœ¬çš„ FreeBSD å®‰è£…ä¸­ï¼Œè¿™æ„å‘³ç€ä¸éœ€è¦è‡ªå®šä¹‰å†…æ ¸æ¥å¯ç”¨ IPFWã€‚ÙvFor those users who wish to statically compile IPFW support into a custom kernel, see <<firewalls-ipfw-kernelconfig>>.Ùzå¯¹äºé‚£äº›å¸Œæœ›å°† IPFW æ”¯æŒé™æ€ç¼–è¯‘åˆ°è‡ªå®šä¹‰å†…æ ¸ä¸­çš„ç”¨æˆ·ï¼Œè¯·å‚é˜… <<firewalls-ipfw-kernelconfig>>ã€‚ÙnTo configure the system to enable IPFW at boot time, add `firewall_enable="YES"` to [.filename]#/etc/rc.conf#:Ù}è¦åœ¨å¯åŠ¨æ—¶é…ç½®ç³»ç»Ÿä»¥å¯ç”¨ IPFW ï¼Œè¯·å°† `firewall_enable ="YES"` æ·»åŠ åˆ° [.filename]#/etc/rc.conf# æ–‡ä»¶ä¸­ã€‚ÙhTo use one of the default firewall types provided by FreeBSD, add another line which specifies the type:Ù]è¦ä½¿ç”¨ FreeBSD æä¾›çš„é»˜è®¤é˜²ç«å¢™ç±»å‹ä¹‹ä¸€ï¼Œè¯·æ·»åŠ å¦ä¸€è¡Œæ¥æŒ‡å®šç±»å‹ï¼š¸The available types are:µå¯ç”¨çš„ç±»å‹æœ‰ï¼š»`open`: passes all traffic.Ù$`open`ï¼šå…è®¸é€šè¿‡æ‰€æœ‰æµé‡ã€‚Ù%`client`: protects only this machine.¼`client`: ä»…ä¿æŠ¤æœ¬æœºã€‚Ù%`simple`: protects the whole network.Ù `simple`ï¼šä¿æŠ¤æ•´ä¸ªç½‘ç»œã€‚ÙI`closed`: entirely disables IP traffic except for the loopback interface.Ù?`closed`ï¼šå®Œå…¨ç¦ç”¨ IP æµé‡ï¼Œé™¤äº†å›ç¯æ¥å£ä¹‹å¤–ã€‚Ù?`workstation`: protects only this machine using stateful rules.Ù=`workstation`ï¼šä½¿ç”¨æœ‰çŠ¶æ€è§„åˆ™ä»…ä¿æŠ¤æ­¤è®¡ç®—æœºã€‚Ù2`UNKNOWN`: disables the loading of firewall rules.Ù-`UNKNOWN`ï¼šç¦ç”¨é˜²ç«å¢™è§„åˆ™çš„åŠ è½½ã€‚ÙM[.filename]#filename#: full path of the file containing the firewall ruleset.ÙJ[.filename]#filename#: åŒ…å«é˜²ç«å¢™è§„åˆ™é›†çš„æ–‡ä»¶çš„å®Œæ•´è·¯å¾„ã€‚Ù¡If `firewall_type` is set to either `client` or `simple`, modify the default rules found in [.filename]#/etc/rc.firewall# to fit the configuration of the system.Ù’å¦‚æœ `firewall_type` è¢«è®¾ç½®ä¸º `client` æˆ– `simple` ï¼Œè¯·ä¿®æ”¹ [.filename]#/etc/rc.firewall# ä¸­çš„é»˜è®¤è§„åˆ™ä»¥é€‚åº”ç³»ç»Ÿçš„é…ç½®ã€‚Ù?Note that the `filename` type is used to load a custom ruleset.Ù>è¯·æ³¨æ„ï¼Œ`filename` ç±»å‹ç”¨äºåŠ è½½è‡ªå®šä¹‰è§„åˆ™é›†ã€‚ÚAn alternate way to load a custom ruleset is to set the `firewall_script` variable to the absolute path of an _executable script_ that includes IPFW commands.  The examples used in this section assume that the `firewall_script` is set to [.filename]#/etc/ipfw.rules#:ÙâåŠ è½½è‡ªå®šä¹‰è§„åˆ™é›†çš„å¦ä¸€ç§æ–¹æ³•æ˜¯å°† `firewall_script` å˜é‡è®¾ç½®ä¸ºåŒ…å« IPFW å‘½ä»¤çš„å¯æ‰§è¡Œè„šæœ¬çš„ç»å¯¹è·¯å¾„ã€‚æœ¬èŠ‚ä¸­ä½¿ç”¨çš„ç¤ºä¾‹å‡è®¾ `firewall_script` è®¾ç½®ä¸º [.filename]#/etc/ipfw.rules#ã€‚Ù<To enable logging through man:syslogd[8], include this line:ÙCè¦é€šè¿‡ man:syslogd[8] å¯ç”¨æ—¥å¿—è®°å½•ï¼Œè¯·åŒ…å«ä»¥ä¸‹è¡Œï¼šÚ&Only firewall rules with the `log` option will be logged.  The default rules do not include this option and it must be manually added.  Therefore it is advisable that the default ruleset is edited for logging.  In addition, log rotation may be desired if the logs are stored in a separate file.Úåªæœ‰å¸¦æœ‰ `log` é€‰é¡¹çš„é˜²ç«å¢™è§„åˆ™æ‰ä¼šè¢«è®°å½•ã€‚é»˜è®¤è§„åˆ™ä¸åŒ…å«æ­¤é€‰é¡¹ï¼Œå¿…é¡»æ‰‹åŠ¨æ·»åŠ ã€‚å› æ­¤ï¼Œå»ºè®®ç¼–è¾‘é»˜è®¤è§„åˆ™é›†ä»¥è¿›è¡Œæ—¥å¿—è®°å½•ã€‚æ­¤å¤–ï¼Œå¦‚æœæ—¥å¿—å­˜å‚¨åœ¨å•ç‹¬çš„æ–‡ä»¶ä¸­ï¼Œå¯èƒ½éœ€è¦è¿›è¡Œæ—¥å¿—è½®è½¬ã€‚ÙÑThere is no [.filename]#/etc/rc.conf# variable to set logging limits.  To limit the number of times a rule is logged per connection attempt, specify the number using this line in [.filename]#/etc/sysctl.conf#:Ù¾æ²¡æœ‰è®¾ç½®æ—¥å¿—é™åˆ¶çš„ [.filename]#/etc/rc.conf# å˜é‡ã€‚è¦é™åˆ¶æ¯ä¸ªè¿æ¥å°è¯•ä¸­è§„åˆ™è¢«è®°å½•çš„æ¬¡æ•°ï¼Œè¯·åœ¨ [.filename]#/etc/sysctl.conf# ä¸­ä½¿ç”¨ä»¥ä¸‹è¡ŒæŒ‡å®šæ•°å­—ï¼šÙrTo enable logging through a dedicated interface named `ipfw0`, add this line to [.filename]#/etc/rc.conf# instead:Ùuè¦é€šè¿‡åä¸º `ipfw0` çš„ä¸“ç”¨æ¥å£å¯ç”¨æ—¥å¿—è®°å½•ï¼Œè¯·å°†ä»¥ä¸‹è¡Œæ·»åŠ åˆ° [.filename]#/etc/rc.conf# ä¸­ï¼šÙ-Then use tcpdump to see what is being logged:Ù0ç„¶åä½¿ç”¨ tcpdump æŸ¥çœ‹è¢«è®°å½•çš„å†…å®¹ï¼šÙ?There is no overhead due to logging unless tcpdump is attached.ÙZåªæœ‰åœ¨é™„åŠ äº† tcpdump æ—¶ï¼Œæ‰ä¼šå‡ºç°ç”±äºæ—¥å¿—è®°å½•è€Œäº§ç”Ÿçš„é¢å¤–å¼€é”€ã€‚Ù~After saving the needed edits, start the firewall.  To enable logging limits now, also set the `sysctl` value specified above:Ùsä¿å­˜æ‰€éœ€çš„ç¼–è¾‘åï¼Œå¯åŠ¨é˜²ç«å¢™ã€‚è¦ç«‹å³å¯ç”¨æ—¥å¿—è®°å½•é™åˆ¶ï¼Œè¿˜éœ€è®¾ç½®ä¸Šè¿° `sysctl` å€¼ã€‚°IPFW Rule Syntax±IPFW è§„åˆ™è¯­æ³•ÚÑWhen a packet enters the IPFW firewall, it is compared against the first rule in the ruleset and progresses one rule at a time, moving from top to bottom in sequence.  When the packet matches the selection parameters of a rule, the rule's action is executed and the search of the ruleset terminates for that packet.  This is referred to as "first match wins".  If the packet does not match any of the rules, it gets caught by the mandatory IPFW default rule number 65535, which denies all packets and silently discards them.  However, if the packet matches a rule that contains the `count`, `skipto`, or `tee` keywords, the search continues.  Refer to man:ipfw[8] for details on how these keywords affect rule processing.Ú“å½“ä¸€ä¸ªæ•°æ®åŒ…è¿›å…¥ IPFW é˜²ç«å¢™æ—¶ï¼Œå®ƒä¼šä¸è§„åˆ™é›†ä¸­çš„ç¬¬ä¸€æ¡è§„åˆ™è¿›è¡Œæ¯”è¾ƒï¼Œå¹¶æŒ‰é¡ºåºé€æ¡è¿›è¡Œï¼Œä»ä¸Šåˆ°ä¸‹ç§»åŠ¨ã€‚å½“æ•°æ®åŒ…ä¸è§„åˆ™çš„é€‰æ‹©å‚æ•°åŒ¹é…æ—¶ï¼Œæ‰§è¡Œè§„åˆ™çš„åŠ¨ä½œï¼Œå¹¶ç»ˆæ­¢è¯¥æ•°æ®åŒ…çš„è§„åˆ™é›†æœç´¢ã€‚è¿™è¢«ç§°ä¸ºâ€œå…ˆä¸­è€…èƒœï¼ˆfirst match winsï¼‰â€ã€‚å¦‚æœæ•°æ®åŒ…ä¸åŒ¹é…ä»»ä½•è§„åˆ™ï¼Œåˆ™è¢«å¼ºåˆ¶ IPFW é»˜è®¤è§„åˆ™å· 65535 æ•è·ï¼Œè¯¥è§„åˆ™æ‹’ç»æ‰€æœ‰æ•°æ®åŒ…å¹¶å°†å…¶é™é»˜ä¸¢å¼ƒã€‚ç„¶è€Œï¼Œå¦‚æœæ•°æ®åŒ…ä¸åŒ…å« `count`ã€`skipto` æˆ– `tee` å…³é”®å­—çš„è§„åˆ™åŒ¹é…ï¼Œæœç´¢å°†ç»§ç»­è¿›è¡Œã€‚æœ‰å…³è¿™äº›å…³é”®å­—å¦‚ä½•å½±å“è§„åˆ™å¤„ç†çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… man:ipfw[8]ã€‚Ú–When creating an IPFW rule, keywords must be written in the following order.  Some keywords are mandatory while other keywords are optional.  The words shown in uppercase represent a variable and the words shown in lowercase must precede the variable that follows it.  The `+#+` symbol is used to mark the start of a comment and may appear at the end of a rule or on its own line.  Blank lines are ignored.ÚEåˆ›å»º IPFW è§„åˆ™æ—¶ï¼Œå…³é”®å­—å¿…é¡»æŒ‰ç…§ä»¥ä¸‹é¡ºåºç¼–å†™ã€‚æŸäº›å…³é”®å­—æ˜¯å¿…éœ€çš„ï¼Œè€Œå…¶ä»–å…³é”®å­—æ˜¯å¯é€‰çš„ã€‚å¤§å†™å­—æ¯è¡¨ç¤ºå˜é‡ï¼Œå°å†™å­—æ¯è¡¨ç¤ºå¿…é¡»åœ¨å…¶åå‡ºç°çš„å˜é‡ã€‚ `+#+` ç¬¦å·ç”¨äºæ ‡è®°æ³¨é‡Šçš„å¼€å§‹ï¼Œå¯ä»¥å‡ºç°åœ¨è§„åˆ™çš„æœ«å°¾æˆ–å•ç‹¬çš„ä¸€è¡Œä¸Šã€‚ç©ºè¡Œå°†è¢«å¿½ç•¥ã€‚ÙíThis section provides an overview of these keywords and their options.  It is not an exhaustive list of every possible option.  Refer to man:ipfw[8] for a complete description of the rule syntax that can be used when creating IPFW rules.Ù½æœ¬èŠ‚æä¾›äº†è¿™äº›å…³é”®å­—åŠå…¶é€‰é¡¹çš„æ¦‚è¿°ã€‚è¿™ä¸æ˜¯ä¸€ä¸ªè¯¦å°½æ— é—çš„é€‰é¡¹åˆ—è¡¨ã€‚æœ‰å…³åˆ›å»º IPFW è§„åˆ™æ—¶å¯ç”¨çš„è§„åˆ™è¯­æ³•çš„å®Œæ•´æè¿°ï¼Œè¯·å‚é˜… man:ipfw[8]ã€‚Ù&Every rule must start with `ipfw add`.Ù-æ¯æ¡è§„åˆ™éƒ½å¿…é¡»ä»¥ `ipfw add` å¼€å¤´ã€‚Ù÷Each rule is associated with a number from `1` to `65534`.  The number is used to indicate the order of rule processing.  Multiple rules can have the same number, in which case they are applied according to the order in which they have been added.ÙËæ¯ä¸ªè§„åˆ™éƒ½ä¸ä¸€ä¸ªä» `1` åˆ° `65534` çš„æ•°å­—ç›¸å…³è”ã€‚è¯¥æ•°å­—ç”¨äºæŒ‡ç¤ºè§„åˆ™å¤„ç†çš„é¡ºåºã€‚å¤šä¸ªè§„åˆ™å¯ä»¥å…·æœ‰ç›¸åŒçš„æ•°å­—ï¼Œè¿™ç§æƒ…å†µä¸‹å®ƒä»¬æŒ‰ç…§æ·»åŠ çš„é¡ºåºåº”ç”¨ã€‚ÙìEach rule is associated with a set number from `0` to `31`.  Sets can be individually disabled or enabled, making it possible to quickly add or delete a set of rules.  If a SET_NUMBER is not specified, the rule will be added to set `0`.ÙÜæ¯ä¸ªè§„åˆ™ä¸ä¸€ä¸ªä» `0` åˆ° `31` çš„é›†åˆç¼–å·ç›¸å…³è”ã€‚å¯ä»¥å•ç‹¬ç¦ç”¨æˆ–å¯ç”¨é›†åˆï¼Œä»è€Œå¯ä»¥å¿«é€Ÿæ·»åŠ æˆ–åˆ é™¤ä¸€ç»„è§„åˆ™ã€‚å¦‚æœæœªæŒ‡å®š SET_NUMBER ï¼Œåˆ™è§„åˆ™å°†è¢«æ·»åŠ åˆ°é›†åˆ `0` ä¸­ã€‚¦ACTION²åŠ¨ä½œï¼ˆACTIONï¼‰ÙŸA rule can be associated with one of the following actions.  The specified action will be executed when the packet matches the selection criterion of the rule.Ùuè§„åˆ™å¯ä»¥ä¸ä»¥ä¸‹åŠ¨ä½œä¹‹ä¸€å…³è”ã€‚å½“æ•°æ®åŒ…ä¸è§„åˆ™çš„é€‰æ‹©æ¡ä»¶åŒ¹é…æ—¶ï¼Œå°†æ‰§è¡ŒæŒ‡å®šçš„åŠ¨ä½œã€‚Ùf`allow | accept | pass | permit`: these keywords are equivalent and allow packets that match the rule.Ùh`allow | accept | pass | permit`ï¼šè¿™äº›å…³é”®å­—æ˜¯ç­‰æ•ˆçš„ï¼Œå…è®¸åŒ¹é…è§„åˆ™çš„æ•°æ®åŒ…é€šè¿‡ã€‚Úƒ`check-state`: checks the packet against the dynamic state table.  If a match is found, execute the action associated with the rule which generated this dynamic rule, otherwise move to the next rule.  A `check-state` rule does not have selection criterion.  If no `check-state` rule is present in the ruleset, the dynamic rules table is checked at the first `keep-state` or `limit` rule.ÚP`check-state`ï¼šæ£€æŸ¥æ•°æ®åŒ…æ˜¯å¦ä¸åŠ¨æ€çŠ¶æ€è¡¨åŒ¹é…ã€‚å¦‚æœæ‰¾åˆ°åŒ¹é…é¡¹ï¼Œåˆ™æ‰§è¡Œä¸ç”Ÿæˆæ­¤åŠ¨æ€è§„åˆ™ç›¸å…³è”çš„æ“ä½œï¼Œå¦åˆ™è½¬åˆ°ä¸‹ä¸€æ¡è§„åˆ™ã€‚ `check-state` è§„åˆ™æ²¡æœ‰é€‰æ‹©æ¡ä»¶ã€‚å¦‚æœè§„åˆ™é›†ä¸­æ²¡æœ‰ `check-state` è§„åˆ™ï¼Œåˆ™åœ¨ç¬¬ä¸€ä¸ª `keep-state` æˆ– `limit` è§„åˆ™å¤„æ£€æŸ¥åŠ¨æ€è§„åˆ™è¡¨ã€‚Ùh`count`: updates counters for all packets that match the rule.  The search continues with the next rule.Ùg`count`ï¼šæ›´æ–°ä¸è§„åˆ™åŒ¹é…çš„æ‰€æœ‰æ•°æ®åŒ…çš„è®¡æ•°å™¨ã€‚æœç´¢å°†ç»§ç»­è¿›è¡Œä¸‹ä¸€ä¸ªè§„åˆ™ã€‚ÙJ`deny | drop`: either word silently discards packets that match this rule.ÙR`deny | drop`ï¼šè¿™ä¸¤ä¸ªè¯éƒ½è¡¨ç¤ºé™é»˜ä¸¢å¼ƒä¸æ­¤è§„åˆ™åŒ¹é…çš„æ•°æ®åŒ…ã€‚ÙDAdditional actions are available.  Refer to man:ipfw[8] for details.ÙKè¿˜æœ‰å…¶ä»–å¯ç”¨çš„æ“ä½œã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… man:ipfw[8]ã€‚ÚWhen a packet matches a rule with the `log` keyword, a message will be logged to man:syslogd[8] with a facility name of `SECURITY`.  Logging only occurs if the number of packets logged for that particular rule does not exceed a specified LOG_AMOUNT.  If no LOG_AMOUNT is specified, the limit is taken from the value of `net.inet.ip.fw.verbose_limit`.  A value of zero removes the logging limit.  Once the limit is reached, logging can be re-enabled by clearing the logging counter or the packet counter for that rule, using `ipfw resetlog`.Úå½“ä¸€ä¸ªæ•°æ®åŒ…ä¸å¸¦æœ‰ `log` å…³é”®å­—çš„è§„åˆ™åŒ¹é…æ—¶ï¼Œå°†ä¼šå‘ man:syslogd[8] è®°å½•ä¸€æ¡æ¶ˆæ¯ï¼Œè¯¥æ¶ˆæ¯çš„è®¾æ–½åç§°ä¸º `SECURITY`ã€‚åªæœ‰åœ¨ç‰¹å®šè§„åˆ™çš„è®°å½•çš„æ•°æ®åŒ…æ•°é‡ä¸è¶…è¿‡æŒ‡å®šçš„ LOG_AMOUNT æ—¶æ‰ä¼šå‘ç”Ÿè®°å½•ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®š LOG_AMOUNTï¼Œåˆ™é™åˆ¶å€¼å°†ä» `net.inet.ip.fw.verbose_limit` çš„å€¼ä¸­è·å–ã€‚å€¼ä¸ºé›¶å°†ç§»é™¤è®°å½•é™åˆ¶ã€‚ä¸€æ—¦è¾¾åˆ°é™åˆ¶ï¼Œå¯ä»¥é€šè¿‡æ¸…é™¤è¯¥è§„åˆ™çš„è®°å½•è®¡æ•°å™¨æˆ–æ•°æ®åŒ…è®¡æ•°å™¨æ¥é‡æ–°å¯ç”¨è®°å½•ï¼Œä½¿ç”¨ `ipfw resetlog` å‘½ä»¤ã€‚Ù¼Logging is done after all other packet matching conditions have been met, and before performing the final action on the packet.  The administrator decides which rules to enable logging on.Ù«åœ¨æ»¡è¶³æ‰€æœ‰å…¶ä»–æ•°æ®åŒ…åŒ¹é…æ¡ä»¶ä¹‹åï¼Œè¿›è¡Œæ—¥å¿—è®°å½•ï¼Œå¹¶åœ¨å¯¹æ•°æ®åŒ…æ‰§è¡Œæœ€ç»ˆæ“ä½œä¹‹å‰ã€‚ç®¡ç†å‘˜å†³å®šåœ¨å“ªäº›è§„åˆ™ä¸Šå¯ç”¨æ—¥å¿—è®°å½•ã€‚¥PROTO±åè®®ï¼ˆPROTOï¼‰ÙlThis optional value can be used to specify any protocol name or number found in [.filename]#/etc/protocols#.Ùkè¿™ä¸ªå¯é€‰å€¼å¯ä»¥ç”¨æ¥æŒ‡å®šåœ¨ [.filename]#/etc/protocols# ä¸­æ‰¾åˆ°çš„ä»»ä½•åè®®åç§°æˆ–ç¼–å·ã€‚£SRC²æºåœ°å€ï¼ˆSRCï¼‰ÚThe `from` keyword must be followed by the source address or a keyword that represents the source address.  An address can be represented by `any`, `me` (any address configured on an interface on this system), `me6`, (any IPv6 address configured on an interface on this system), or `table` followed by the number of a lookup table which contains a list of addresses.  When specifying an IP address, it can be optionally followed by its CIDR mask or subnet mask.  For example, `1.2.3.4/25` or `1.2.3.4:255.255.255.128`.Ú`from` å…³é”®å­—åé¢å¿…é¡»è·Ÿç€æºåœ°å€æˆ–è¡¨ç¤ºæºåœ°å€çš„å…³é”®å­—ã€‚åœ°å€å¯ä»¥ç”¨ `any`ã€`me`ï¼ˆåœ¨æ­¤ç³»ç»Ÿä¸Šé…ç½®çš„ä»»ä½•æ¥å£çš„åœ°å€ï¼‰ã€`me6`ï¼ˆåœ¨æ­¤ç³»ç»Ÿä¸Šé…ç½®çš„ä»»ä½• IPv6 åœ°å€ï¼‰æˆ– `table` åè·ŸåŒ…å«åœ°å€åˆ—è¡¨çš„æŸ¥æ‰¾è¡¨çš„ç¼–å·æ¥è¡¨ç¤ºã€‚åœ¨æŒ‡å®š IP åœ°å€æ—¶ï¼Œå¯ä»¥é€‰æ‹©æ€§åœ°è·Ÿç€ CIDR æ©ç æˆ–å­ç½‘æ©ç ã€‚ä¾‹å¦‚ï¼Œ`1.2.3.4/25` æˆ– `1.2.3.4:255.255.255.128`ã€‚¨SRC_PORT·æºç«¯å£ï¼ˆSRC_PORTï¼‰ÙgAn optional source port can be specified using the port number or name from [.filename]#/etc/services#.Ùdå¯ä»¥ä½¿ç”¨ç«¯å£å·æˆ–è€…ä» [.filename]#/etc/services# ä¸­çš„åç§°æ¥æŒ‡å®šå¯é€‰çš„æºç«¯å£ã€‚£DSTµç›®æ ‡åœ°å€ï¼ˆDSTï¼‰ÙÙThe `to` keyword must be followed by the destination address or a keyword that represents the destination address.  The same keywords and addresses described in the SRC section can be used to describe the destination.Ùš`to` å…³é”®å­—åé¢å¿…é¡»è·Ÿç€ç›®æ ‡åœ°å€æˆ–ä»£è¡¨ç›®æ ‡åœ°å€çš„å…³é”®å­—ã€‚åœ¨ SRC éƒ¨åˆ†æè¿°çš„ç›¸åŒå…³é”®å­—å’Œåœ°å€å¯ä»¥ç”¨æ¥æè¿°ç›®æ ‡ã€‚¨DST_PORTºç›®æ ‡ç«¯å£ï¼ˆDST_PORTï¼‰ÙlAn optional destination port can be specified using the port number or name from [.filename]#/etc/services#.Ùmå¯ä»¥ä½¿ç”¨ç«¯å£å·æˆ–è€…ä» [.filename]#/etc/services# æ–‡ä»¶ä¸­çš„åç§°æ¥æŒ‡å®šå¯é€‰çš„ç›®æ ‡ç«¯å£ã€‚§OPTIONS³é€‰é¡¹ï¼ˆOPTIONSï¼‰ÚSeveral keywords can follow the source and destination.  As the name suggests, OPTIONS are optional.  Commonly used options include `in` or `out`, which specify the direction of packet flow, `icmptypes` followed by the type of ICMP message, and `keep-state`.Ùíæºå’Œç›®çš„åœ°åé¢å¯ä»¥è·Ÿéšå‡ ä¸ªå…³é”®å­—ã€‚é¡¾åæ€ä¹‰ï¼ŒOPTIONS æ˜¯å¯é€‰çš„ã€‚å¸¸ç”¨çš„é€‰é¡¹åŒ…æ‹¬ `in` æˆ– `out`ï¼Œç”¨äºæŒ‡å®šæ•°æ®åŒ…æµåŠ¨çš„æ–¹å‘ï¼Œ`icmptypes` åé¢è·Ÿéš ICMP æ¶ˆæ¯çš„ç±»å‹ï¼Œä»¥åŠ `keep-state`ã€‚ÙÀWhen a `keep-state` rule is matched, the firewall will create a dynamic rule which matches bidirectional traffic between the source and destination addresses and ports using the same protocol.Ù°å½“åŒ¹é…åˆ° `keep-state` è§„åˆ™æ—¶ï¼Œé˜²ç«å¢™å°†åˆ›å»ºä¸€ä¸ªåŠ¨æ€è§„åˆ™ï¼Œè¯¥è§„åˆ™åŒ¹é…æºåœ°å€å’Œç›®æ ‡åœ°å€ä»¥åŠç«¯å£ä¹‹é—´çš„åŒå‘æµé‡ï¼Œä½¿ç”¨ç›¸åŒçš„åè®®ã€‚Ú¿The dynamic rules facility is vulnerable to resource depletion from a SYN-flood attack which would open a huge number of dynamic rules.  To counter this type of attack with IPFW, use `limit`.  This option limits the number of simultaneous sessions by checking the open dynamic rules, counting the number of times this rule and IP address combination occurred.  If this count is greater than the value specified by `limit`, the packet is discarded.Ú’åŠ¨æ€è§„åˆ™åŠŸèƒ½å®¹æ˜“å—åˆ° SYN æ´ªæ°´æ”»å‡»çš„èµ„æºè€—å°½é—®é¢˜çš„å½±å“ï¼Œè¯¥æ”»å‡»ä¼šæ‰“å¼€å¤§é‡çš„åŠ¨æ€è§„åˆ™ã€‚ä¸ºäº†ä½¿ç”¨ IPFW æ¥å¯¹æŠ—è¿™ç§ç±»å‹çš„æ”»å‡»ï¼Œå¯ä»¥ä½¿ç”¨ `limit` é€‰é¡¹ã€‚è¯¥é€‰é¡¹é€šè¿‡æ£€æŸ¥æ‰“å¼€çš„åŠ¨æ€è§„åˆ™ï¼Œè®¡ç®—è¯¥è§„åˆ™å’Œ IP åœ°å€ç»„åˆå‡ºç°çš„æ¬¡æ•°ï¼Œæ¥é™åˆ¶åŒæ—¶ä¼šè¯çš„æ•°é‡ã€‚å¦‚æœè¯¥è®¡æ•°å¤§äº `limit` æŒ‡å®šçš„å€¼ï¼Œæ•°æ®åŒ…å°†è¢«ä¸¢å¼ƒã€‚ÙbDozens of OPTIONS are available.  Refer to man:ipfw[8] for a description of each available option.Ù]æœ‰æ•°åç§é€‰é¡¹å¯ä¾›é€‰æ‹©ã€‚æœ‰å…³æ¯ä¸ªå¯ç”¨é€‰é¡¹çš„æè¿°ï¼Œè¯·å‚é˜… man:ipfw[8]ã€‚¯Example Ruleset¯ç¤ºä¾‹è§„åˆ™é›†Ú'This section demonstrates how to create an example stateful firewall ruleset script named [.filename]#/etc/ipfw.rules#.  In this example, all connection rules use `in` or `out` to clarify the direction.  They also use `via` _interface-name_ to specify the interface the packet is traveling over.Úæœ¬èŠ‚æ¼”ç¤ºäº†å¦‚ä½•åˆ›å»ºä¸€ä¸ªåä¸º [.filename]#/etc/ipfw.rules# çš„ç¤ºä¾‹æœ‰çŠ¶æ€é˜²ç«å¢™è§„åˆ™è„šæœ¬ã€‚åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæ‰€æœ‰è¿æ¥è§„åˆ™ä½¿ç”¨ `in` æˆ– `out` æ¥æ˜ç¡®æ–¹å‘ã€‚å®ƒä»¬è¿˜ä½¿ç”¨ `via` _interface-name_ æ¥æŒ‡å®šæ•°æ®åŒ…æ‰€ç»è¿‡çš„æ¥å£ã€‚Ù]When first creating or testing a firewall ruleset, consider temporarily setting this tunable:ÙTåœ¨é¦–æ¬¡åˆ›å»ºæˆ–æµ‹è¯•é˜²ç«å¢™è§„åˆ™é›†æ—¶ï¼Œè€ƒè™‘ä¸´æ—¶è®¾ç½®æ­¤å¯è°ƒæ•´é¡¹ï¼šÙÅThis sets the default policy of man:ipfw[8] to be more permissive than the default `deny ip from any to any`, making it slightly more difficult to get locked out of the system right after a reboot.Ù‘è¿™å°†å°† man:ipfw[8] çš„é»˜è®¤ç­–ç•¥è®¾ç½®ä¸ºæ¯”é»˜è®¤çš„ `deny ip from any to any` æ›´å®½æ¾ï¼Œè¿™æ ·åœ¨é‡æ–°å¯åŠ¨åæ›´éš¾è¢«ç³»ç»Ÿé”å®šã€‚ÚKThe firewall script begins by indicating that it is a Bourne shell script and flushes any existing rules.  It then creates the `cmd` variable so that `ipfw add` does not have to be typed at the beginning of every rule.  It also defines the `pif` variable which represents the name of the interface that is attached to the Internet.Ú	é˜²ç«å¢™è„šæœ¬é¦–å…ˆæŒ‡ç¤ºå®ƒæ˜¯ä¸€ä¸ª Bourne shell è„šæœ¬ï¼Œå¹¶æ¸…é™¤ä»»ä½•ç°æœ‰çš„è§„åˆ™ã€‚ç„¶åå®ƒåˆ›å»º `cmd` å˜é‡ï¼Œè¿™æ ·åœ¨æ¯ä¸ªè§„åˆ™çš„å¼€å¤´å°±ä¸éœ€è¦è¾“å…¥ `ipfw add` ã€‚å®ƒè¿˜å®šä¹‰äº† `pif` å˜é‡ï¼Œè¡¨ç¤ºè¿æ¥åˆ°äº’è”ç½‘çš„æ¥å£çš„åç§°ã€‚ÙfThe first two rules allow all traffic on the trusted internal interface and on the loopback interface:ÙWå‰ä¸¤æ¡è§„åˆ™å…è®¸åœ¨å¯ä¿¡çš„å†…éƒ¨æ¥å£å’Œå›ç¯æ¥å£ä¸Šçš„æ‰€æœ‰æµé‡é€šè¿‡ã€‚ÙcThe next rule allows the packet through if it matches an existing entry in the dynamic rules table:Ù]ä¸‹ä¸€ä¸ªè§„åˆ™å…è®¸æ•°æ®åŒ…é€šè¿‡ï¼Œå¦‚æœå®ƒä¸åŠ¨æ€è§„åˆ™è¡¨ä¸­çš„ç°æœ‰æ¡ç›®åŒ¹é…ï¼šÙnThe next set of rules defines which stateful connections internal systems can create to hosts on the Internet:Ùcä¸‹é¢çš„è§„åˆ™é›†å®šä¹‰äº†å†…éƒ¨ç³»ç»Ÿå¯ä»¥ä¸äº’è”ç½‘ä¸Šçš„ä¸»æœºå»ºç«‹å“ªäº›æœ‰çŠ¶æ€è¿æ¥ï¼šÚ0The next set of rules controls connections from Internet hosts to the internal network.  It starts by denying packets typically associated with attacks and then explicitly allows specific types of connections.  All the authorized services that originate from the Internet use `limit` to prevent flooding.Ùóä¸‹ä¸€ç»„è§„åˆ™æ§åˆ¶æ¥è‡ªäº’è”ç½‘ä¸»æœºåˆ°å†…éƒ¨ç½‘ç»œçš„è¿æ¥ã€‚å®ƒé¦–å…ˆæ‹’ç»é€šå¸¸ä¸æ”»å‡»ç›¸å…³çš„æ•°æ®åŒ…ï¼Œç„¶åæ˜ç¡®å…è®¸ç‰¹å®šç±»å‹çš„è¿æ¥ã€‚æ‰€æœ‰ä»äº’è”ç½‘å‘èµ·çš„æˆæƒæœåŠ¡éƒ½ä½¿ç”¨ `limit` æ¥é˜²æ­¢æ´ªæ°´æ”»å‡»ã€‚ÙQThe last rule logs all packets that do not match any of the rules in the ruleset:ÙNæœ€åä¸€æ¡è§„åˆ™è®°å½•æ‰€æœ‰ä¸ç¬¦åˆè§„åˆ™é›†ä¸­ä»»ä½•è§„åˆ™çš„æ•°æ®åŒ…ï¼š­In-kernel NATÙ.å†…æ ¸çº§ç½‘ç»œåœ°å€è½¬æ¢ï¼ˆIn-kernel NATï¼‰Ú„FreeBSD's IPFW firewall has two implementations of NAT: the userland implementation man:natd[8], and the more recent in-kernel NAT implementation.  Both work in conjunction with IPFW to provide network address translation.  This can be used to provide an Internet Connection Sharing solution so that several internal computers can connect to the Internet using a single public IP address.Ú>FreeBSD çš„ IPFW é˜²ç«å¢™æœ‰ä¸¤ç§ NAT å®ç°ï¼šç”¨æˆ·ç©ºé—´å®ç° man:natd[8] å’Œæ›´è¿‘æœŸçš„å†…æ ¸ NAT å®ç°ã€‚ä¸¤è€…éƒ½ä¸ IPFW é…åˆå·¥ä½œï¼Œæä¾›ç½‘ç»œåœ°å€è½¬æ¢åŠŸèƒ½ã€‚è¿™å¯ä»¥ç”¨äºæä¾› Internet è¿æ¥å…±äº«è§£å†³æ–¹æ¡ˆï¼Œä½¿å¤šå°å†…éƒ¨è®¡ç®—æœºå¯ä»¥ä½¿ç”¨å•ä¸ªå…¬å…± IP åœ°å€è¿æ¥åˆ°äº’è”ç½‘ã€‚ÚhTo do this, the FreeBSD machine connected to the Internet must act as a gateway.  This system must have two NICs, where one is connected to the Internet and the other is connected to the internal LAN.  Each machine connected to the LAN should be assigned an IP address in the private network space, as defined by https://www.ietf.org/rfc/rfc1918.txt[RFC 1918].Úbè¦å®ç°è¿™ä¸€ç‚¹ï¼Œè¿æ¥åˆ°äº’è”ç½‘çš„ FreeBSD æœºå™¨å¿…é¡»å……å½“ç½‘å…³ã€‚è¯¥ç³»ç»Ÿå¿…é¡»å…·æœ‰ä¸¤ä¸ªç½‘ç»œæ¥å£å¡ï¼ˆNICï¼‰ï¼Œå…¶ä¸­ä¸€ä¸ªè¿æ¥åˆ°äº’è”ç½‘ï¼Œå¦ä¸€ä¸ªè¿æ¥åˆ°å†…éƒ¨å±€åŸŸç½‘ï¼ˆLANï¼‰ã€‚è¿æ¥åˆ° LAN çš„æ¯å°æœºå™¨åº”åˆ†é…ä¸€ä¸ªç§æœ‰ç½‘ç»œç©ºé—´ä¸­çš„ IP åœ°å€ï¼Œå¦‚ https://www.ietf.org/rfc/rfc1918.txt[RFC 1918] æ‰€å®šä¹‰ã€‚ÙÅSome additional configuration is needed in order to enable the in-kernel NAT facility of IPFW.  To enable in-kernel NAT support at boot time, the following must be set in [.filename]#/etc/rc.conf#:ÙÁä¸ºäº†å¯ç”¨ IPFW å†…æ ¸ä¸­çš„ NAT åŠŸèƒ½ï¼Œéœ€è¦è¿›è¡Œä¸€äº›é¢å¤–çš„é…ç½®ã€‚è¦åœ¨å¯åŠ¨æ—¶å¯ç”¨å†…æ ¸ä¸­çš„ NAT æ”¯æŒï¼Œå¿…é¡»åœ¨ [.filename]#/etc/rc.conf# æ–‡ä»¶ä¸­è®¾ç½®ä»¥ä¸‹å†…å®¹ï¼šÙ¶When `firewall_nat_enable` is set but `firewall_enable` is not, it will have no effect and do nothing.  This is because the in-kernel NAT implementation is only compatible with IPFW.Ùªå½“è®¾ç½®äº† `firewall_nat_enable` ä½†æœªè®¾ç½® `firewall_enable` æ—¶ï¼Œå®ƒå°†ä¸ä¼šäº§ç”Ÿä»»ä½•æ•ˆæœå’Œä½œç”¨ã€‚è¿™æ˜¯å› ä¸ºå†…æ ¸ä¸­çš„ NAT å®ç°ä»…ä¸ IPFW å…¼å®¹ã€‚ÚSWhen the ruleset contains stateful rules, the positioning of the NAT rule is critical and the `skipto` action is used.  The `skipto` action requires a rule number so that it knows which rule to jump to.  The example below builds upon the firewall ruleset shown in the previous section.  It adds some additional entries and modifies some existing rules in order to configure the firewall for in-kernel NAT.  It starts by adding some additional variables which represent the rule number to skip to, the `keep-state` option, and a list of TCP ports which will be used to reduce the number of rules.Úå½“è§„åˆ™é›†åŒ…å«æœ‰çŠ¶æ€çš„è§„åˆ™æ—¶ï¼ŒNAT è§„åˆ™çš„ä½ç½®è‡³å…³é‡è¦ï¼Œå¹¶ä¸”ä½¿ç”¨ `skipto` æ“ä½œã€‚`skipto` æ“ä½œéœ€è¦ä¸€ä¸ªè§„åˆ™ç¼–å·ï¼Œä»¥ä¾¿çŸ¥é“è¦è·³è½¬åˆ°å“ªä¸ªè§„åˆ™ã€‚ä¸‹é¢çš„ç¤ºä¾‹åŸºäºå‰ä¸€èŠ‚ä¸­æ˜¾ç¤ºçš„é˜²ç«å¢™è§„åˆ™é›†è¿›è¡Œæ„å»ºã€‚å®ƒæ·»åŠ äº†ä¸€äº›é¢å¤–çš„æ¡ç›®å¹¶ä¿®æ”¹äº†ä¸€äº›ç°æœ‰è§„åˆ™ï¼Œä»¥ä¾¿ä¸ºå†…æ ¸ä¸­çš„ NAT é…ç½®é˜²ç«å¢™ã€‚é¦–å…ˆæ·»åŠ ä¸€äº›é¢å¤–çš„å˜é‡ï¼Œè¿™äº›å˜é‡è¡¨ç¤ºè¦è·³è½¬åˆ°çš„è§„åˆ™ç¼–å·ï¼Œ`keep-state` é€‰é¡¹ä»¥åŠå°†ç”¨äºå‡å°‘è§„åˆ™æ•°é‡çš„ TCP ç«¯å£åˆ—è¡¨ã€‚Ú§With in-kernel NAT it is necessary to disable TCP segmentation offloading (TSO) due to the architecture of man:libalias[3], a library implemented as a kernel module to provide the in-kernel NAT facility of IPFW.  TSO can be disabled on a per network interface basis using man:ifconfig[8] or on a system wide basis using man:sysctl[8].  To disable TSO system wide, the following must be set it [.filename]#/etc/sysctl.conf#:Ú¶ä½¿ç”¨å†…æ ¸çº§åˆ«çš„ NAT æ—¶ï¼Œç”±äº man:libalias[3] çš„æ¶æ„ï¼Œéœ€è¦ç¦ç”¨ TCP åˆ†æ®µå¸è½½ï¼ˆTSOï¼‰ï¼Œman:libalias[3] æ˜¯ä¸€ä¸ªä½œä¸ºå†…æ ¸æ¨¡å—å®ç°çš„åº“ï¼Œç”¨äºæä¾› IPFW çš„å†…æ ¸çº§åˆ« NAT åŠŸèƒ½ã€‚å¯ä»¥ä½¿ç”¨ man:ifconfig[8] åœ¨æ¯ä¸ªç½‘ç»œæ¥å£ä¸Šç¦ç”¨ TSOï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ man:sysctl[8] åœ¨æ•´ä¸ªç³»ç»Ÿä¸Šç¦ç”¨ TSOã€‚è¦åœ¨æ•´ä¸ªç³»ç»Ÿä¸Šç¦ç”¨ TSOï¼Œéœ€è¦åœ¨ [.filename]#/etc/sysctl.conf# ä¸­è®¾ç½®ä»¥ä¸‹å†…å®¹ï¼šÚ¾A NAT instance will also be configured.  It is possible to have multiple NAT instances each with their own configuration.  For this example only one NAT instance is needed, NAT instance number 1.  The configuration can take a few options such as: `if` which indicates the public interface, `same_ports` which takes care that aliased ports and local port numbers are mapped the same, `unreg_only` will result in only unregistered (private) address spaces to be processed by the NAT instance, and `reset` which will help to keep a functioning NAT instance even when the public IP address of the IPFW machine changes.  For all possible options that can be passed to a single NAT instance configuration consult man:ipfw[8].  When configuring a stateful NATing firewall, it is necessary to allow translated packets to be reinjected in the firewall for further processing.  This can be achieved by disabling `one_pass` behavior at the start of the firewall script.Úè¿˜å°†é…ç½®ä¸€ä¸ª NAT å®ä¾‹ã€‚å¯ä»¥é…ç½®å¤šä¸ª NAT å®ä¾‹ï¼Œæ¯ä¸ªå®ä¾‹éƒ½æœ‰è‡ªå·±çš„é…ç½®ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œåªéœ€è¦ä¸€ä¸ª NAT å®ä¾‹ï¼Œå³ NAT å®ä¾‹å· 1ã€‚é…ç½®å¯ä»¥åŒ…æ‹¬ä¸€äº›é€‰é¡¹ï¼Œå¦‚ï¼š`if` è¡¨ç¤ºå…¬å…±æ¥å£ï¼Œ`same_ports` ç¡®ä¿åˆ«åç«¯å£å’Œæœ¬åœ°ç«¯å£å·æ˜ å°„ç›¸åŒï¼Œ`unreg_only` å°†åªå¤„ç†æœªæ³¨å†Œï¼ˆç§æœ‰ï¼‰åœ°å€ç©ºé—´çš„ NAT å®ä¾‹ï¼Œ`reset` å°†å¸®åŠ©ä¿æŒä¸€ä¸ªæ­£å¸¸è¿è¡Œçš„ NAT å®ä¾‹ï¼Œå³ä½¿ IPFW æœºå™¨çš„å…¬å…± IP åœ°å€å‘ç”Ÿå˜åŒ–ã€‚æœ‰å…³å¯ä»¥ä¼ é€’ç»™å•ä¸ª NAT å®ä¾‹é…ç½®çš„æ‰€æœ‰å¯èƒ½é€‰é¡¹ï¼Œè¯·å‚é˜… man:ipfw[8]ã€‚åœ¨é…ç½®æœ‰çŠ¶æ€çš„ NAT é˜²ç«å¢™æ—¶ï¼Œéœ€è¦å…è®¸å°†å·²è½¬æ¢çš„æ•°æ®åŒ…é‡æ–°æ³¨å…¥é˜²ç«å¢™è¿›è¡Œè¿›ä¸€æ­¥å¤„ç†ã€‚å¯ä»¥é€šè¿‡åœ¨é˜²ç«å¢™è„šæœ¬çš„å¼€å§‹å¤„ç¦ç”¨ `one_pass` è¡Œä¸ºæ¥å®ç°è¿™ä¸€ç‚¹ã€‚ÚıThe inbound NAT rule is inserted _after_ the two rules which allow all traffic on the trusted and loopback interfaces and after the reassemble rule but _before_ the `check-state` rule.  It is important that the rule number selected for this NAT rule, in this example `100`, is higher than the first three rules and lower than the `check-state` rule.  Furthermore, because of the behavior of in-kernel NAT it is advised to place a reassemble rule just before the first NAT rule and after the rules that allow traffic on trusted interface.  Normally, IP fragmentation should not happen, but when dealing with IPSEC/ESP/GRE tunneling traffic it might and the reassembling of fragments is necessary before handing the complete packet over to the in-kernel NAT facility.ÚŸå…¥ç«™ NAT è§„åˆ™è¢«æ’å…¥åœ¨å…è®¸æ‰€æœ‰å—ä¿¡ä»»å’Œå›ç¯æ¥å£ä¸Šçš„æ‰€æœ‰æµé‡çš„ä¸¤ä¸ªè§„åˆ™ä¹‹åï¼Œå¹¶ä¸”åœ¨é‡æ–°ç»„è£…è§„åˆ™ä¹‹åï¼Œä½†åœ¨ `check-state` è§„åˆ™ä¹‹å‰ã€‚åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œä¸ºæ­¤ NAT è§„åˆ™é€‰æ‹©çš„è§„åˆ™ç¼–å·ï¼ˆä¾‹å¦‚ `100`ï¼‰æ¯”å‰ä¸‰ä¸ªè§„åˆ™æ›´é«˜ï¼Œä½†æ¯” `check-state` è§„åˆ™æ›´ä½éå¸¸é‡è¦ã€‚æ­¤å¤–ï¼Œç”±äºå†…æ ¸ NAT çš„è¡Œä¸ºï¼Œå»ºè®®åœ¨ç¬¬ä¸€ä¸ª NAT è§„åˆ™ä¹‹å‰å’Œå…è®¸å—ä¿¡ä»»æ¥å£ä¸Šçš„æµé‡çš„è§„åˆ™ä¹‹åæ”¾ç½®ä¸€ä¸ªé‡æ–°ç»„è£…è§„åˆ™ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œä¸åº”å‘ç”Ÿ IP åˆ†æ®µï¼Œä½†åœ¨å¤„ç† IPSEC/ESP/GRE éš§é“æµé‡æ—¶å¯èƒ½ä¼šå‘ç”Ÿï¼Œå¹¶ä¸”åœ¨å°†å®Œæ•´æ•°æ®åŒ…äº¤ç»™å†…æ ¸ NAT è®¾å¤‡ä¹‹å‰éœ€è¦é‡æ–°ç»„è£…ç‰‡æ®µã€‚ÙŞThe reassemble rule was not needed with userland man:natd[8] because the internal workings of the IPFW `divert` action already takes care of reassembling packets before delivery to the socket as also stated in man:ipfw[8].Ùáåœ¨ä½¿ç”¨ç”¨æˆ·ç©ºé—´çš„ man:natd[8] æ—¶ï¼Œä¸éœ€è¦ä½¿ç”¨ reassemble è§„åˆ™ï¼Œå› ä¸º IPFW çš„ `divert` åŠ¨ä½œåœ¨å°†æ•°æ®åŒ…ä¼ é€’åˆ°å¥—æ¥å­—ä¹‹å‰å·²ç»è´Ÿè´£é‡æ–°ç»„è£…æ•°æ®åŒ…ï¼Œè¿™ä¹Ÿåœ¨ man:ipfw[8] ä¸­æœ‰æ‰€è¯´æ˜ã€‚ÙùThe NAT instance and rule number used in this example does not match with the default NAT instance and rule number created by [.filename]#rc.firewall#.  [.filename]#rc.firewall# is a script that sets up the default firewall rules present in FreeBSD.Ùàåœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ä½¿ç”¨çš„ NAT å®ä¾‹å’Œè§„åˆ™ç¼–å·ä¸ç”± [.filename]#rc.firewall# åˆ›å»ºçš„é»˜è®¤ NAT å®ä¾‹å’Œè§„åˆ™ç¼–å·ä¸åŒ¹é…ã€‚ [.filename]#rc.firewall# æ˜¯ä¸€ä¸ªè®¾ç½® FreeBSD ä¸­é»˜è®¤é˜²ç«å¢™è§„åˆ™çš„è„šæœ¬ã€‚ÚThe outbound rules are modified to replace the `allow` action with the `$skip` variable, indicating that rule processing will continue at rule `1000`.  The seven `tcp` rules have been replaced by rule `125` as the `$good_tcpo` variable contains the seven allowed outbound ports.Ùïå‡ºç«™è§„åˆ™å·²ç»è¢«ä¿®æ”¹ï¼Œå°† `allow` æ“ä½œæ›¿æ¢ä¸º `$skip` å˜é‡ï¼Œè¡¨ç¤ºè§„åˆ™å¤„ç†å°†ç»§ç»­åœ¨è§„åˆ™ `1000` å¤„ã€‚ä¸ƒä¸ª `tcp` è§„åˆ™å·²è¢«æ›¿æ¢ä¸ºè§„åˆ™ `125`ï¼Œå› ä¸º `$good_tcpo` å˜é‡åŒ…å«äº†ä¸ƒä¸ªå…è®¸çš„å‡ºç«™ç«¯å£ã€‚ÙeRemember that IPFW's performance is largely determined by the number of rules present in the ruleset.ÙMè¯·è®°ä½ï¼ŒIPFW çš„æ€§èƒ½ä¸»è¦å–å†³äºè§„åˆ™é›†ä¸­å­˜åœ¨çš„è§„åˆ™æ•°é‡ã€‚ÚîThe inbound rules remain the same, except for the very last rule which removes the `via $pif` in order to catch both inbound and outbound rules.  The NAT rule must follow this last outbound rule, must have a higher number than that last rule, and the rule number must be referenced by the `skipto` action.  In this ruleset, rule number `1000` handles passing all packets to our configured instance for NAT processing.  The next rule allows any packet which has undergone NAT processing to pass.ÚÎå…¥ç«™è§„åˆ™ä¿æŒä¸å˜ï¼Œé™¤äº†æœ€åä¸€æ¡è§„åˆ™ï¼Œå®ƒç§»é™¤äº† `via$pif`ï¼Œä»¥ä¾¿æ•è·å…¥ç«™å’Œå‡ºç«™è§„åˆ™ã€‚NAT è§„åˆ™å¿…é¡»è·Ÿéšè¿™ä¸ªæœ€åçš„å‡ºç«™è§„åˆ™ï¼Œè§„åˆ™å·å¿…é¡»æ¯”æœ€åä¸€æ¡è§„åˆ™çš„å·ç æ›´é«˜ï¼Œå¹¶ä¸”è§„åˆ™å·å¿…é¡»è¢« `skipto` åŠ¨ä½œå¼•ç”¨ã€‚åœ¨è¿™ä¸ªè§„åˆ™é›†ä¸­ï¼Œè§„åˆ™å·ä¸º `1000` çš„è§„åˆ™å¤„ç†å°†æ‰€æœ‰æ•°æ®åŒ…ä¼ é€’ç»™æˆ‘ä»¬é…ç½®çš„å®ä¾‹è¿›è¡Œ NAT å¤„ç†ã€‚ä¸‹ä¸€æ¡è§„åˆ™å…è®¸ç»è¿‡ NAT å¤„ç†çš„ä»»ä½•æ•°æ®åŒ…é€šè¿‡ã€‚ÙÜIn this example, rules `100`, `101`, `125`, `1000`, and `1001` control the address translation of the outbound and inbound packets so that the entries in the dynamic state table always register the private LANIP address.Ù¹åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œè§„åˆ™ `100`ã€`101`ã€`125`ã€`1000` å’Œ `1001` æ§åˆ¶å‡ºç«™å’Œå…¥ç«™æ•°æ®åŒ…çš„åœ°å€è½¬æ¢ï¼Œä»¥ä¾¿åŠ¨æ€çŠ¶æ€è¡¨ä¸­çš„æ¡ç›®å§‹ç»ˆæ³¨å†Œç§æœ‰ LANIP åœ°å€ã€‚Ú>Consider an internal web browser which initializes a new outbound HTTP session over port 80.  When the first outbound packet enters the firewall, it does not match rule `100` because it is headed out rather than in.  It passes rule `101` because this is the first packet and it has not been posted to the dynamic state table yet.  The packet finally matches rule `125` as it is outbound on an allowed port and has a source IP address from the internal LAN.  On matching this rule, two actions take place.  First, the `keep-state` action adds an entry to the dynamic state table and the specified action, `skipto rule 1000`, is executed.  Next, the packet undergoes NAT and is sent out to the Internet.  This packet makes its way to the destination web server, where a response packet is generated and sent back.  This new packet enters the top of the ruleset.  It matches rule `100` and has its destination IP address mapped back to the original internal address.  It then is processed by the `check-state` rule, is found in the table as an existing session, and is released to the LAN.Úùè€ƒè™‘ä¸€ä¸ªå†…éƒ¨çš„ç½‘ç»œæµè§ˆå™¨ï¼Œå®ƒé€šè¿‡ 80 ç«¯å£åˆå§‹åŒ–ä¸€ä¸ªæ–°çš„å‡ºç«™ HTTP ä¼šè¯ã€‚å½“ç¬¬ä¸€ä¸ªå‡ºç«™æ•°æ®åŒ…è¿›å…¥é˜²ç«å¢™æ—¶ï¼Œå®ƒä¸åŒ¹é…è§„åˆ™ `100` ï¼Œå› ä¸ºå®ƒæ˜¯å‘å¤–è€Œä¸æ˜¯å‘å†…çš„ã€‚å®ƒé€šè¿‡è§„åˆ™ `101` ï¼Œå› ä¸ºè¿™æ˜¯ç¬¬ä¸€ä¸ªæ•°æ®åŒ…ï¼Œå¹¶ä¸”å°šæœªè¢«æ·»åŠ åˆ°åŠ¨æ€çŠ¶æ€è¡¨ä¸­ã€‚è¯¥æ•°æ®åŒ…æœ€ç»ˆåŒ¹é…è§„åˆ™ `125` ï¼Œå› ä¸ºå®ƒæ˜¯åœ¨å…è®¸çš„ç«¯å£ä¸Šè¿›è¡Œå‡ºç«™ï¼Œå¹¶ä¸”å…·æœ‰æ¥è‡ªå†…éƒ¨å±€åŸŸç½‘çš„æº IP åœ°å€ã€‚åŒ¹é…æ­¤è§„åˆ™åï¼Œä¼šæ‰§è¡Œä¸¤ä¸ªæ“ä½œã€‚é¦–å…ˆï¼Œ`keep-state` æ“ä½œå°†ä¸€ä¸ªæ¡ç›®æ·»åŠ åˆ°åŠ¨æ€çŠ¶æ€è¡¨ä¸­ï¼Œå¹¶æ‰§è¡ŒæŒ‡å®šçš„æ“ä½œ `skipto rule 1000`ã€‚æ¥ä¸‹æ¥ï¼Œæ•°æ®åŒ…ç»è¿‡ NAT å¤„ç†å¹¶å‘é€åˆ°äº’è”ç½‘ã€‚è¯¥æ•°æ®åŒ…åˆ°è¾¾ç›®æ ‡ Web æœåŠ¡å™¨ï¼Œç”Ÿæˆå¹¶å‘é€ä¸€ä¸ªå“åº”æ•°æ®åŒ…ã€‚è¿™ä¸ªæ–°çš„æ•°æ®åŒ…è¿›å…¥è§„åˆ™é›†çš„é¡¶éƒ¨ã€‚å®ƒåŒ¹é…è§„åˆ™ `100`ï¼Œå¹¶å°†å…¶ç›®æ ‡ IP åœ°å€æ˜ å°„å›åŸå§‹çš„å†…éƒ¨åœ°å€ã€‚ç„¶åï¼Œå®ƒç»è¿‡ `check-state` è§„åˆ™çš„å¤„ç†ï¼Œåœ¨è¡¨ä¸­è¢«è¯†åˆ«ä¸ºä¸€ä¸ªç°æœ‰çš„ä¼šè¯ï¼Œå¹¶è¢«é‡Šæ”¾åˆ°å±€åŸŸç½‘ã€‚Ú¡On the inbound side, the ruleset has to deny bad packets and allow only authorized services.  A packet which matches an inbound rule is posted to the dynamic state table and the packet is released to the LAN.  The packet generated as a response is recognized by the `check-state` rule as belonging to an existing session.  It is then sent to rule `1000` to undergo NAT before being released to the outbound interface.Ú|åœ¨å…¥ç«™æ–¹é¢ï¼Œè§„åˆ™é›†å¿…é¡»æ‹’ç»æ¶æ„æ•°æ®åŒ…ï¼Œå¹¶ä»…å…è®¸æˆæƒçš„æœåŠ¡ã€‚ä¸å…¥ç«™è§„åˆ™åŒ¹é…çš„æ•°æ®åŒ…å°†è¢«å‘å¸ƒåˆ°åŠ¨æ€çŠ¶æ€è¡¨ï¼Œå¹¶å°†æ•°æ®åŒ…é‡Šæ”¾åˆ°å±€åŸŸç½‘ã€‚ä½œä¸ºå“åº”ç”Ÿæˆçš„æ•°æ®åŒ…è¢« `check-state` è§„åˆ™è¯†åˆ«ä¸ºå±äºç°æœ‰ä¼šè¯ã€‚ç„¶åï¼Œå®ƒå°†è¢«å‘é€åˆ°è§„åˆ™ `1000` è¿›è¡Œç½‘ç»œåœ°å€è½¬æ¢ï¼ˆNATï¼‰ï¼Œç„¶åé‡Šæ”¾åˆ°å‡ºç«™æ¥å£ã€‚ÚüTransitioning from userland man:natd[8] to in-kernel NAT might appear seamless at first but there is small catch.  When using the GENERIC kernel, IPFW will load the [.filename]#libalias.ko# kernel module, when `firewall_nat_enable` is enabled in [.filename]#/etc/rc.conf#.  The [.filename]#libalias.ko# kernel module only provides basic NAT functionality, whereas the userland implementation man:natd[8] has all NAT functionality available in its userland library without any extra configuration.  All functionality refers to the following kernel modules that can additionally be loaded when needed besides the standard [.filename]#libalias.ko# kernel module: [.filename]#alias_ftp.ko#, [.filename]#alias_bbt.ko#, [.filename]#skinny.ko#, [.filename]#irc.ko#, [.filename]#alias_pptp.ko# and [.filename]#alias_smedia.ko# using the `kld_list` directive in [.filename]#/etc/rc.conf#.  If a custom kernel is used, the full functionality of the userland library can be compiled in, in the kernel, using the `options LIBALIAS`.Ú¹ä»ç”¨æˆ·ç©ºé—´çš„ man:natd[8] è¿‡æ¸¡åˆ°å†…æ ¸çº§åˆ«çš„ NAT å¯èƒ½ä¸€å¼€å§‹çœ‹èµ·æ¥æ˜¯æ— ç¼çš„ï¼Œä½†æœ‰ä¸€ä¸ªå°é—®é¢˜ã€‚å½“ä½¿ç”¨ GENERIC å†…æ ¸æ—¶ï¼Œå½“åœ¨ [.filename]#/etc/rc.conf# ä¸­å¯ç”¨ `firewall_nat_enable` æ—¶ï¼ŒIPFW å°†åŠ è½½ [.filename]#libalias.ko# å†…æ ¸æ¨¡å—ã€‚ [.filename]#libalias.ko# å†…æ ¸æ¨¡å—åªæä¾›åŸºæœ¬çš„ NAT åŠŸèƒ½ï¼Œè€Œç”¨æˆ·ç©ºé—´å®ç°çš„ man:natd[8] åœ¨å…¶ç”¨æˆ·ç©ºé—´åº“ä¸­æä¾›äº†æ‰€æœ‰çš„ NAT åŠŸèƒ½ï¼Œæ— éœ€ä»»ä½•é¢å¤–é…ç½®ã€‚æ‰€æœ‰åŠŸèƒ½éƒ½æŒ‡çš„æ˜¯ä»¥ä¸‹å†…æ ¸æ¨¡å—ï¼Œé™¤äº†æ ‡å‡†çš„ [.filename]#libalias.ko# å†…æ ¸æ¨¡å—ä¹‹å¤–ï¼Œè¿˜å¯ä»¥åœ¨éœ€è¦æ—¶é¢å¤–åŠ è½½ï¼š [.filename]#alias_ftp.ko#ã€[.filename]#alias_bbt.ko#ã€[.filename]#skinny.ko#ã€[.filename]#irc.ko#ã€[.filename]#alias_pptp.ko# å’Œ [.filename]#alias_smedia.ko#ï¼Œä½¿ç”¨[.filename]#/etc/rc.conf# ä¸­çš„ `kld_list` æŒ‡ä»¤ã€‚å¦‚æœä½¿ç”¨è‡ªå®šä¹‰å†…æ ¸ï¼Œå¯ä»¥ä½¿ç”¨ `options LIBALIAS` å°†ç”¨æˆ·ç©ºé—´åº“çš„å…¨éƒ¨åŠŸèƒ½ç¼–è¯‘åˆ°å†…æ ¸ä¸­ã€‚°Port Redirection¯ç«¯å£é‡å®šå‘ÚThe drawback with NAT in general is that the LAN clients are not accessible from the Internet.  Clients on the LAN can make outgoing connections to the world but cannot receive incoming ones.  This presents a problem if trying to run Internet services on one of the LAN client machines.  A simple way around this is to redirect selected Internet ports on the NAT providing machine to a LAN client.ÚLNAT çš„ä¸€èˆ¬ç¼ºç‚¹æ˜¯ LAN å®¢æˆ·ç«¯æ— æ³•ä»äº’è”ç½‘è®¿é—®ã€‚ LAN ä¸Šçš„å®¢æˆ·ç«¯å¯ä»¥å‘å¤–éƒ¨å»ºç«‹è¿æ¥ï¼Œä½†æ— æ³•æ¥æ”¶ä¼ å…¥è¿æ¥ã€‚å¦‚æœå°è¯•åœ¨ LAN å®¢æˆ·ç«¯æœºå™¨ä¸Šè¿è¡Œäº’è”ç½‘æœåŠ¡ï¼Œè¿™å°†å¸¦æ¥é—®é¢˜ã€‚ä¸€ä¸ªç®€å•çš„è§£å†³æ–¹æ³•æ˜¯å°† NAT æä¾›æœºå™¨ä¸Šçš„é€‰å®šäº’è”ç½‘ç«¯å£é‡å®šå‘åˆ° LAN å®¢æˆ·ç«¯ã€‚ÙÔFor example, an IRC server runs on client `A` and a web server runs on client `B`.  For this to work properly, connections received on ports 6667 (IRC) and 80 (HTTP) must be redirected to the respective machines.Ùçä¾‹å¦‚ï¼ŒIRC æœåŠ¡å™¨è¿è¡Œåœ¨å®¢æˆ·ç«¯ `A` ä¸Šï¼Œè€Œ Web æœåŠ¡å™¨è¿è¡Œåœ¨å®¢æˆ·ç«¯ `B` ä¸Šã€‚ä¸ºäº†ä½¿å…¶æ­£å¸¸å·¥ä½œï¼Œå¿…é¡»å°†æ¥æ”¶åˆ°çš„ 6667 ç«¯å£ï¼ˆIRCï¼‰å’Œ 80 ç«¯å£ï¼ˆHTTPï¼‰çš„è¿æ¥é‡å®šå‘åˆ°ç›¸åº”çš„æœºå™¨ä¸Šã€‚ÚWith in-kernel NAT all configuration is done in the NAT instance configuration.  For a full list of options that an in-kernel NAT instance can use, consult man:ipfw[8].  The IPFW syntax follows the syntax of natd. The syntax for `redirect_port` is as follows:Ùêä½¿ç”¨å†…æ ¸çº§åˆ«çš„ NATï¼Œæ‰€æœ‰é…ç½®éƒ½åœ¨ NAT å®ä¾‹é…ç½®ä¸­å®Œæˆã€‚è¦æŸ¥çœ‹å†…æ ¸çº§åˆ« NAT å®ä¾‹å¯ä»¥ä½¿ç”¨çš„æ‰€æœ‰é€‰é¡¹ï¼Œè¯·å‚è€ƒ man:ipfw[8]ã€‚ IPFW çš„è¯­æ³•éµå¾ª natd çš„è¯­æ³•ã€‚`redirect_port` çš„è¯­æ³•å¦‚ä¸‹ï¼šÙ>To configure the above example setup, the arguments should be:Ù-è¦é…ç½®ä¸Šè¿°ç¤ºä¾‹è®¾ç½®ï¼Œå‚æ•°åº”ä¸ºï¼šÙ¼After adding these arguments to the configuration of NAT instance 1 in the above ruleset, the TCP ports will be port forwarded to the LAN client machines running the IRC and HTTP services.Ù›åœ¨ä¸Šè¿°è§„åˆ™é›†ä¸­å°†è¿™äº›å‚æ•°æ·»åŠ åˆ° NAT å®ä¾‹ 1 çš„é…ç½®åï¼ŒTCP ç«¯å£å°†è¢«ç«¯å£è½¬å‘åˆ°è¿è¡Œ IRC å’Œ HTTP æœåŠ¡çš„å±€åŸŸç½‘å®¢æˆ·æœºã€‚ÙßPort ranges over individual ports can be indicated with `redirect_port`.  For example, _tcp 192.168.0.2:2000-3000 2000-3000_ would redirect all connections received on ports 2000 to 3000 to ports 2000 to 3000 on client `A`.Ùêå¯ä»¥ä½¿ç”¨ `redirect_port` æŒ‡ç¤ºç«¯å£èŒƒå›´è€Œä¸æ˜¯å•ä¸ªç«¯å£ã€‚ä¾‹å¦‚ï¼Œ_tcp 192.168.0.2:2000-3000 2000-3000_ å°†ä¼šå°†æ‰€æœ‰åœ¨ç«¯å£ 2000 åˆ° 3000 ä¸Šæ¥æ”¶åˆ°çš„è¿æ¥é‡å®šå‘åˆ°å®¢æˆ·ç«¯ `A` ä¸Šçš„ç«¯å£ 2000 åˆ° 3000 ã€‚³Address Redirection¯åœ°å€é‡å®šå‘ÚmAddress redirection is useful if more than one IP address is available.  Each LAN client can be assigned its own external IP address by man:ipfw[8], which will then rewrite outgoing packets from the LAN clients with the proper external IP address and redirects all traffic incoming on that particular IP address back to the specific LAN client.  This is also known as static NAT.  For example, if IP addresses `128.1.1.1`, `128.1.1.2`, and `128.1.1.3` are available, `128.1.1.1` can be used as the man:ipfw[8] machine's external IP address, while `128.1.1.2` and `128.1.1.3` are forwarded back to LAN clients `A` and `B`.ÚWå¦‚æœæœ‰å¤šä¸ª IP åœ°å€å¯ç”¨ï¼Œåœ°å€é‡å®šå‘éå¸¸æœ‰ç”¨ã€‚æ¯ä¸ªå±€åŸŸç½‘å®¢æˆ·ç«¯å¯ä»¥é€šè¿‡ man:ipfw[8] åˆ†é…è‡ªå·±çš„å¤–éƒ¨ IP åœ°å€ï¼Œç„¶å man:ipfw[8] å°†é‡å†™æ¥è‡ªå±€åŸŸç½‘å®¢æˆ·ç«¯çš„å‡ºç«™æ•°æ®åŒ…ï¼Œä½¿ç”¨æ­£ç¡®çš„å¤–éƒ¨ IP åœ°å€ï¼Œå¹¶å°†æ‰€æœ‰è¿›å…¥ç‰¹å®š IP åœ°å€çš„æµé‡é‡å®šå‘å›ç‰¹å®šçš„å±€åŸŸç½‘å®¢æˆ·ç«¯ã€‚è¿™ä¹Ÿè¢«ç§°ä¸ºé™æ€ NAT ã€‚ä¾‹å¦‚ï¼Œå¦‚æœå¯ç”¨çš„ IP åœ°å€ä¸º `128.1.1.1`ã€`128.1.1.2` å’Œ `128.1.1.3`ï¼Œåˆ™ `128.1.1.1` å¯ä»¥ç”¨ä½œ man:ipfw[8] æœºå™¨çš„å¤–éƒ¨ IP åœ°å€ï¼Œè€Œ `128.1.1.2` å’Œ `128.1.1.3` åˆ™è¢«è½¬å‘å›å±€åŸŸç½‘å®¢æˆ·ç«¯ `A` å’Œ `B`ã€‚Ù­The `redirect_addr` syntax is as below, where `localIP` is the internal IP address of the LAN client, and `publicIP` the external IP address corresponding to the LAN client.Ù`redirect_addr` çš„è¯­æ³•å¦‚ä¸‹ï¼Œå…¶ä¸­ `localIP` æ˜¯å±€åŸŸç½‘å®¢æˆ·ç«¯çš„å†…éƒ¨ IP åœ°å€ï¼Œ`publicIP` æ˜¯ä¸å±€åŸŸç½‘å®¢æˆ·ç«¯å¯¹åº”çš„å¤–éƒ¨ IP åœ°å€ã€‚Ù)In the example, the arguments would read:Ù-åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå‚æ•°å°†è¢«è¯»å–ä¸ºï¼šÙÒLike `redirect_port`, these arguments are placed in a NAT instance configuration.  With address redirection, there is no need for port redirection, as all data received on a particular IP address is redirected.ÙÎä¸ `redirect_port` ç±»ä¼¼ï¼Œè¿™äº›å‚æ•°ä¹Ÿè¢«æ”¾ç½®åœ¨ NAT å®ä¾‹é…ç½®ä¸­ã€‚é€šè¿‡åœ°å€é‡å®šå‘ï¼Œä¸éœ€è¦è¿›è¡Œç«¯å£é‡å®šå‘ï¼Œå› ä¸ºæ‰€æœ‰æ¥æ”¶åˆ°çš„ç‰¹å®š IP åœ°å€çš„æ•°æ®éƒ½ä¼šè¢«é‡å®šå‘ã€‚ÙThe external IP addresses on the man:ipfw[8] machine must be active and aliased to the external interface.  Refer to man:rc.conf[5] for details.Ù£man:ipfw[8] æœºå™¨ä¸Šçš„å¤–éƒ¨ IP åœ°å€å¿…é¡»å¤„äºæ´»åŠ¨çŠ¶æ€ï¼Œå¹¶ä¸”å¿…é¡»ä¸å¤–éƒ¨æ¥å£è¿›è¡Œåˆ«åè®¾ç½®ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… man:rc.conf[5]ã€‚­Userspace NAT°ç”¨æˆ·ç©ºé—´ NATÚ%Let us start with a statement: the userspace NAT implementation: man:natd[8], has more overhead than in-kernel NAT.  For man:natd[8] to translate packets, the packets have to be copied from the kernel to userspace and back which brings in extra overhead that is not present with in-kernel NAT.Ú)è®©æˆ‘ä»¬ä»ä¸€ä¸ªå£°æ˜å¼€å§‹ï¼šç”¨æˆ·ç©ºé—´çš„ NAT å®ç°ï¼šman:natd[8]ï¼Œæ¯”å†…æ ¸ä¸­çš„ NAT æœ‰æ›´å¤šçš„å¼€é”€ã€‚ä¸ºäº†è®© man:natd[8] ç¿»è¯‘æ•°æ®åŒ…ï¼Œæ•°æ®åŒ…å¿…é¡»ä»å†…æ ¸å¤åˆ¶åˆ°ç”¨æˆ·ç©ºé—´ï¼Œç„¶åå†è¿”å›ï¼Œè¿™å¸¦æ¥äº†é¢å¤–çš„å¼€é”€ï¼Œè€Œå†…æ ¸ä¸­çš„ NAT åˆ™æ²¡æœ‰è¿™ç§å¼€é”€ã€‚ÚUTo enable the userpace NAT daemon man:natd[8] at boot time, the following is a minimum configuration in [.filename]#/etc/rc.conf#.  Where `natd_interface` is set to the name of the NIC attached to the Internet.  The man:rc[8] script of man:natd[8] will automatically check if a dynamic IP address is used and configure itself to handle that.Ú?è¦åœ¨å¯åŠ¨æ—¶å¯ç”¨ç”¨æˆ·ç©ºé—´ NAT å®ˆæŠ¤è¿›ç¨‹ man:natd[8]ï¼Œä»¥ä¸‹æ˜¯åœ¨æ–‡ä»¶ [.filename]#/etc/rc.conf# ä¸­çš„æœ€å°é…ç½®ã€‚å…¶ä¸­ï¼Œ`natd_interface` è®¾ç½®ä¸ºè¿æ¥åˆ°äº’è”ç½‘çš„ç½‘å¡çš„åç§°ã€‚man:natd[8] çš„ man:rc[8] è„šæœ¬å°†è‡ªåŠ¨æ£€æŸ¥æ˜¯å¦ä½¿ç”¨åŠ¨æ€ IP åœ°å€ï¼Œå¹¶é…ç½®è‡ªèº«ä»¥å¤„ç†è¯¥åœ°å€ã€‚ÚƒIn general, the above ruleset as explained for in-kernel NAT can also be used together with man:natd[8].  The exceptions are the configuration of the in-kernel NAT instance `(ipfw -q nat 1 config ...)` which is not needed together with reassemble rule 99 because its functionality is included in the `divert` action.  Rule number 100 and 1000 will have to change sligthly as shown below.Ú>é€šå¸¸æƒ…å†µä¸‹ï¼Œä¸Šè¿°å†…æ ¸ NAT çš„è§„åˆ™é›†ä¹Ÿå¯ä»¥ä¸ man:natd[8] ä¸€èµ·ä½¿ç”¨ã€‚å”¯ä¸€çš„ä¾‹å¤–æ˜¯å†…æ ¸ NAT å®ä¾‹çš„é…ç½® `(ipfw -q nat 1 config ...)` ï¼Œä¸éœ€è¦ä¸é‡ç»„è§„åˆ™ 99 ä¸€èµ·ä½¿ç”¨ï¼Œå› ä¸ºå…¶åŠŸèƒ½å·²åŒ…å«åœ¨ `divert` æ“ä½œä¸­ã€‚è§„åˆ™ç¼–å· 100 å’Œ 1000 éœ€è¦ç¨ä½œä¿®æ”¹ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚ÚTo configure port or address redirection, a similar syntax as with in-kernel NAT is used.  Although, now, instead of specifying the configuration in our ruleset script like with in-kernel NAT, configuration of man:natd[8] is best done in a configuration file.  To do this, an extra flag must be passed via [.filename]#/etc/rc.conf# which specifies the path of the configuration file.ÚQè¦é…ç½®ç«¯å£æˆ–åœ°å€é‡å®šå‘ï¼Œä½¿ç”¨ä¸å†…æ ¸ NAT ç›¸ä¼¼çš„è¯­æ³•ã€‚ç„¶è€Œï¼Œç°åœ¨ï¼Œä¸å†…æ ¸ NAT ä¸åŒï¼Œæˆ‘ä»¬ä¸å†åœ¨è§„åˆ™é›†è„šæœ¬ä¸­æŒ‡å®šé…ç½®ï¼Œè€Œæ˜¯æœ€å¥½åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½® man:natd[8]ã€‚ä¸ºäº†åšåˆ°è¿™ä¸€ç‚¹ï¼Œå¿…é¡»é€šè¿‡ [.filename]#/etc/rc.conf# ä¼ é€’ä¸€ä¸ªé¢å¤–çš„æ ‡å¿—ï¼ŒæŒ‡å®šé…ç½®æ–‡ä»¶çš„è·¯å¾„ã€‚ÙÜThe specified file must contain a list of configuration options, one per line.  For more information about the configuration file and possible variables, consult man:natd[8].  Below are two example entries, one per line:ÙºæŒ‡å®šçš„æ–‡ä»¶å¿…é¡»åŒ…å«ä¸€è¡Œä¸€ä¸ªçš„é…ç½®é€‰é¡¹åˆ—è¡¨ã€‚æœ‰å…³é…ç½®æ–‡ä»¶å’Œå¯èƒ½çš„å˜é‡çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜… man:natd[8]ã€‚ä»¥ä¸‹æ˜¯ä¸¤ä¸ªç¤ºä¾‹æ¡ç›®ï¼Œæ¯è¡Œä¸€ä¸ªï¼š°The IPFW Command«IPFW å‘½ä»¤Ú`ipfw` can be used to make manual, single rule additions or deletions to the active firewall while it is running.  The problem with using this method is that all the changes are lost when the system reboots.  It is recommended to instead write all the rules in a file and to use that file to load the rules at boot time and to replace the currently running firewall rules whenever that file changes.Ú3`ipfw` å¯ä»¥åœ¨é˜²ç«å¢™è¿è¡Œæ—¶æ‰‹åŠ¨æ·»åŠ æˆ–åˆ é™¤å•ä¸ªè§„åˆ™ã€‚ä½¿ç”¨è¿™ç§æ–¹æ³•çš„é—®é¢˜æ˜¯ï¼Œå½“ç³»ç»Ÿé‡æ–°å¯åŠ¨æ—¶ï¼Œæ‰€æœ‰æ›´æ”¹éƒ½ä¼šä¸¢å¤±ã€‚å»ºè®®å°†æ‰€æœ‰è§„åˆ™å†™å…¥ä¸€ä¸ªæ–‡ä»¶ï¼Œå¹¶åœ¨å¯åŠ¨æ—¶ä½¿ç”¨è¯¥æ–‡ä»¶åŠ è½½è§„åˆ™ï¼Œå¹¶åœ¨è¯¥æ–‡ä»¶æ›´æ”¹æ—¶æ›¿æ¢å½“å‰è¿è¡Œçš„é˜²ç«å¢™è§„åˆ™ã€‚ÚU`ipfw` is a useful way to display the running firewall rules to the console screen.  The IPFW accounting facility dynamically creates a counter for each rule that counts each packet that matches the rule.  During the process of testing a rule, listing the rule with its counter is one way to determine if the rule is functioning as expected.Ú9`ipfw` æ˜¯ä¸€ç§å°†è¿è¡Œä¸­çš„é˜²ç«å¢™è§„åˆ™æ˜¾ç¤ºåˆ°æ§åˆ¶å°å±å¹•çš„æœ‰ç”¨æ–¹æ³•ã€‚ IPFW è®¡è´¹åŠŸèƒ½ä¼šä¸ºæ¯ä¸ªè§„åˆ™åŠ¨æ€åˆ›å»ºä¸€ä¸ªè®¡æ•°å™¨ï¼Œç”¨äºè®¡ç®—ä¸è§„åˆ™åŒ¹é…çš„æ¯ä¸ªæ•°æ®åŒ…ã€‚åœ¨æµ‹è¯•è§„åˆ™çš„è¿‡ç¨‹ä¸­ï¼Œåˆ—å‡ºè§„åˆ™åŠå…¶è®¡æ•°å™¨æ˜¯ç¡®å®šè§„åˆ™æ˜¯å¦æŒ‰é¢„æœŸå·¥ä½œçš„ä¸€ç§æ–¹å¼ã€‚Ù*To list all the running rules in sequence:Ù-åˆ—å‡ºæ‰€æœ‰æ­£åœ¨è¿è¡Œçš„è§„åˆ™çš„é¡ºåºï¼šÙ[To list all the running rules with a time stamp of when the last time the rule was matched:ÙNåˆ—å‡ºæ‰€æœ‰æ­£åœ¨è¿è¡Œçš„è§„åˆ™ï¼Œå¹¶æ˜¾ç¤ºè§„åˆ™æœ€ååŒ¹é…çš„æ—¶é—´æˆ³ï¼šÙíThe next example lists accounting information and the packet count for matched rules along with the rules themselves.  The first column is the rule number, followed by the number of matched packets and bytes, followed by the rule itself.Ùºä¸‹ä¸€ä¸ªç¤ºä¾‹åˆ—å‡ºäº†åŒ¹é…è§„åˆ™çš„ä¼šè®¡ä¿¡æ¯å’Œæ•°æ®åŒ…è®¡æ•°ï¼Œä»¥åŠè§„åˆ™æœ¬èº«ã€‚ç¬¬ä¸€åˆ—æ˜¯è§„åˆ™ç¼–å·ï¼Œå…¶åæ˜¯åŒ¹é…çš„æ•°æ®åŒ…å’Œå­—èŠ‚æ•°ï¼Œç„¶åæ˜¯è§„åˆ™æœ¬èº«ã€‚Ù2To list dynamic rules in addition to static rules:Ù-é™¤äº†é™æ€è§„åˆ™å¤–ï¼Œåˆ—å‡ºåŠ¨æ€è§„åˆ™ï¼šÙ'To also show the expired dynamic rules:Ù'ä¸ºäº†æ˜¾ç¤ºå·²è¿‡æœŸçš„åŠ¨æ€è§„åˆ™ï¼šµTo zero the counters:µå°†è®¡æ•°å™¨å½’é›¶ï¼šÙ9To zero the counters for just the rule with number _NUM_:Ù1å°†ç¼–å·ä¸º _NUM_ çš„è§„åˆ™çš„è®¡æ•°å™¨æ¸…é›¶ï¼š¹Logging Firewall Messagesµè®°å½•é˜²ç«å¢™æ¶ˆæ¯ÚçEven with the logging facility enabled, IPFW will not generate any rule logging on its own.  The firewall administrator decides which rules in the ruleset will be logged, and adds the `log` keyword to those rules.  Normally only deny rules are logged.  It is customary to duplicate the "ipfw default deny everything" rule with the `log` keyword included as the last rule in the ruleset.  This way, it is possible to see all the packets that did not match any of the rules in the ruleset.Ú¬å³ä½¿å¯ç”¨äº†æ—¥å¿—åŠŸèƒ½ï¼ŒIPFW ä¹Ÿä¸ä¼šè‡ªåŠ¨ç”Ÿæˆä»»ä½•è§„åˆ™æ—¥å¿—ã€‚é˜²ç«å¢™ç®¡ç†å‘˜å†³å®šå“ªäº›è§„åˆ™å°†è¢«è®°å½•ï¼Œå¹¶åœ¨è¿™äº›è§„åˆ™ä¸­æ·»åŠ  `log` å…³é”®å­—ã€‚é€šå¸¸åªæœ‰æ‹’ç»è§„åˆ™ä¼šè¢«è®°å½•ã€‚ä¹ æƒ¯ä¸Šï¼Œåœ¨è§„åˆ™é›†ä¸­å°†â€œipfw default deny everythingâ€è§„åˆ™å¤åˆ¶ä¸€ä»½ï¼Œå¹¶åœ¨æœ€åä¸€æ¡è§„åˆ™ä¸­åŒ…å« `log` å…³é”®å­—ã€‚è¿™æ ·ï¼Œå°±å¯ä»¥æŸ¥çœ‹æ‰€æœ‰æœªåŒ¹é…è§„åˆ™é›†ä¸­ä»»ä½•è§„åˆ™çš„æ•°æ®åŒ…ã€‚Ú Logging is a two edged sword.  If one is not careful, an over abundance of log data or a DoS attack can fill the disk with log files.  Log messages are not only written to syslogd, but also are displayed on the root console screen and soon become annoying.Ù÷æ—¥å¿—è®°å½•æ˜¯ä¸€æŠŠåŒåˆƒå‰‘ã€‚å¦‚æœä¸å°å¿ƒå¤„ç†ï¼Œè¿‡å¤šçš„æ—¥å¿—æ•°æ®æˆ–è€… DoS æ”»å‡»å¯èƒ½ä¼šå¡«æ»¡ç£ç›˜çš„æ—¥å¿—æ–‡ä»¶ã€‚æ—¥å¿—æ¶ˆæ¯ä¸ä»…ä¼šè¢«å†™å…¥ syslogdï¼Œè¿˜ä¼šæ˜¾ç¤ºåœ¨æ ¹æ§åˆ¶å°å±å¹•ä¸Šï¼Œå¾ˆå¿«å°±ä¼šå˜å¾—ä»¤äººè®¨åŒã€‚ÚZThe `IPFIREWALL_VERBOSE_LIMIT=5` kernel option limits the number of consecutive messages sent to man:syslogd[8], concerning the packet matching of a given rule.  When this option is enabled in the kernel, the number of consecutive messages concerning a particular rule is capped at the number specified.  There is nothing to be gained from 200 identical log messages.  With this option set to five, five consecutive messages concerning a particular rule would be logged to syslogd and the remainder identical consecutive messages would be counted and posted to syslogd with a phrase like the following:Úù`IPFIREWALL_VERBOSE_LIMIT=5` å†…æ ¸é€‰é¡¹é™åˆ¶äº†å‘é€ç»™ man:syslogd[8] çš„è¿ç»­æ¶ˆæ¯æ•°é‡ï¼Œè¿™äº›æ¶ˆæ¯æ¶‰åŠç»™å®šè§„åˆ™çš„æ•°æ®åŒ…åŒ¹é…ã€‚å½“å†…æ ¸ä¸­å¯ç”¨äº†è¿™ä¸ªé€‰é¡¹æ—¶ï¼Œå…³äºç‰¹å®šè§„åˆ™çš„è¿ç»­æ¶ˆæ¯æ•°é‡è¢«é™åˆ¶åœ¨æŒ‡å®šçš„æ•°é‡ä¸Šã€‚200 æ¡ç›¸åŒçš„æ—¥å¿—æ¶ˆæ¯å¹¶æ²¡æœ‰ä»€ä¹ˆå¥½å¤„ã€‚å½“è¿™ä¸ªé€‰é¡¹è®¾ç½®ä¸ºäº”æ—¶ï¼Œå…³äºç‰¹å®šè§„åˆ™çš„äº”æ¡è¿ç»­æ¶ˆæ¯å°†è¢«è®°å½•åˆ° syslogd ä¸­ï¼Œå…¶ä½™ç›¸åŒçš„è¿ç»­æ¶ˆæ¯å°†è¢«è®¡æ•°å¹¶ä»¥ç±»ä¼¼ä»¥ä¸‹çš„çŸ­è¯­å‘å¸ƒåˆ° syslogd ä¸­ï¼šÙˆAll logged packets messages are written by default to [.filename]#/var/log/security#, which is defined in [.filename]#/etc/syslog.conf#.Ù‰æ‰€æœ‰å·²è®°å½•çš„æ•°æ®åŒ…æ¶ˆæ¯é»˜è®¤å†™å…¥åˆ° [.filename]#/var/log/security#ï¼Œè¯¥è·¯å¾„åœ¨ [.filename]#/etc/syslog.conf# ä¸­å®šä¹‰ã€‚¶Building a Rule Script²æ„å»ºè§„åˆ™è„šæœ¬ÚìMost experienced IPFW users create a file containing the rules and code them in a manner compatible with running them as a script.  The major benefit of doing this is the firewall rules can be refreshed in mass without the need of rebooting the system to activate them.  This method is convenient in testing new rules as the procedure can be executed as many times as needed.  Being a script, symbolic substitution can be used for frequently used values to be substituted into multiple rules.Ú¡å¤§å¤šæ•°ç»éªŒä¸°å¯Œçš„ IPFW ç”¨æˆ·ä¼šåˆ›å»ºä¸€ä¸ªåŒ…å«è§„åˆ™çš„æ–‡ä»¶ï¼Œå¹¶ä»¥ä¸è„šæœ¬è¿è¡Œå…¼å®¹çš„æ–¹å¼ç¼–ç å®ƒä»¬ã€‚è¿™æ ·åšçš„ä¸»è¦å¥½å¤„æ˜¯é˜²ç«å¢™è§„åˆ™å¯ä»¥æ‰¹é‡åˆ·æ–°ï¼Œè€Œæ— éœ€é‡æ–°å¯åŠ¨ç³»ç»Ÿæ¥æ¿€æ´»å®ƒä»¬ã€‚è¿™ç§æ–¹æ³•åœ¨æµ‹è¯•æ–°è§„åˆ™æ—¶éå¸¸æ–¹ä¾¿ï¼Œå› ä¸ºå¯ä»¥æ ¹æ®éœ€è¦æ‰§è¡Œè¯¥è¿‡ç¨‹å¤šæ¬¡ã€‚ä½œä¸ºè„šæœ¬ï¼Œå¯ä»¥ä½¿ç”¨ç¬¦å·æ›¿æ¢æ¥å°†å¸¸ç”¨å€¼æ›¿æ¢ä¸ºå¤šä¸ªè§„åˆ™ä¸­çš„å€¼ã€‚Ú,This example script is compatible with the syntax used by the man:sh[1], man:csh[1], and man:tcsh[1] shells.  Symbolic substitution fields are prefixed with a dollar sign ($).  Symbolic fields do not have the $ prefix.  The value to populate the symbolic field must be enclosed in double quotes ("").Ùîè¿™ä¸ªç¤ºä¾‹è„šæœ¬ä¸ man:sh[1]ã€man:csh[1] å’Œ man:tcsh[1] shells ä½¿ç”¨çš„è¯­æ³•å…¼å®¹ã€‚ç¬¦å·æ›¿æ¢å­—æ®µä»¥ç¾å…ƒç¬¦å· ($) ä¸ºå‰ç¼€ã€‚ç¬¦å·å­—æ®µæ²¡æœ‰ $ å‰ç¼€ã€‚ç”¨äºå¡«å……ç¬¦å·å­—æ®µçš„å€¼å¿…é¡»ç”¨åŒå¼•å· ("") æ‹¬èµ·æ¥ã€‚¿Start the rules file like this:¾åƒè¿™æ ·å¼€å§‹è§„åˆ™æ–‡ä»¶ï¼šÙoThe rules are not important as the focus of this example is how the symbolic substitution fields are populated.ÙTè§„åˆ™å¹¶ä¸é‡è¦ï¼Œå› ä¸ºè¿™ä¸ªä¾‹å­çš„é‡ç‚¹æ˜¯å¦‚ä½•å¡«å……ç¬¦å·æ›¿æ¢å­—æ®µã€‚ÙoIf the above example was in [.filename]#/etc/ipfw.rules#, the rules could be reloaded by the following command:Ùuå¦‚æœä¸Šé¢çš„ç¤ºä¾‹ä½äº [.filename]#/etc/ipfw.rules# æ–‡ä»¶ä¸­ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤é‡æ–°åŠ è½½è§„åˆ™ï¼šÙT[.filename]#/etc/ipfw.rules# can be located anywhere and the file can have any name.Ù_[.filename]#/etc/ipfw.rules# å¯ä»¥ä½äºä»»ä½•ä½ç½®ï¼Œæ–‡ä»¶çš„åç§°ä¹Ÿå¯ä»¥æ˜¯ä»»æ„çš„ã€‚ÙGThe same thing could be accomplished by running these commands by hand:Ù?é€šè¿‡æ‰‹åŠ¨è¿è¡Œè¿™äº›å‘½ä»¤ä¹Ÿå¯ä»¥å®ç°ç›¸åŒçš„æ•ˆæœï¼š³IPFW Kernel Options±IPFW å†…æ ¸é€‰é¡¹ÙñIn order to statically compile IPFW support into a custom kernel, refer to the instructions in crossref:kernelconfig[kernelconfig,Configuring the FreeBSD Kernel].  The following options are available for the custom kernel configuration file:ÙÁä¸ºäº†å°† IPFW æ”¯æŒé™æ€ç¼–è¯‘åˆ°è‡ªå®šä¹‰å†…æ ¸ä¸­ï¼Œè¯·å‚è€ƒ crossref:kernelconfig[kernelconfigï¼Œé…ç½® FreeBSD å†…æ ¸] ä¸­çš„è¯´æ˜ã€‚ä»¥ä¸‹é€‰é¡¹å¯ç”¨äºè‡ªå®šä¹‰å†…æ ¸é…ç½®æ–‡ä»¶ï¼šÙ}IPFW can be loaded as a kernel module: options above are built by default as modules or can be set at runtime using tunables.Ù’IPFW å¯ä»¥ä½œä¸ºå†…æ ¸æ¨¡å—åŠ è½½ï¼šä¸Šè¿°é€‰é¡¹é»˜è®¤æƒ…å†µä¸‹è¢«æ„å»ºä¸ºæ¨¡å—ï¼Œæˆ–è€…å¯ä»¥åœ¨è¿è¡Œæ—¶ä½¿ç”¨å¯è°ƒèŠ‚å‚æ•°è¿›è¡Œè®¾ç½®ã€‚Ù¯IPFILTER, also known as IPF, is a cross-platform, open source firewall which has been ported to several operating systems, including FreeBSD, NetBSD, OpenBSD, and Solaris(TM).ÙšIPFILTERï¼Œä¹Ÿç§°ä¸º IPFï¼Œæ˜¯ä¸€ä¸ªè·¨å¹³å°çš„å¼€æºé˜²ç«å¢™ï¼Œå·²ç»ç§»æ¤åˆ°å¤šä¸ªæ“ä½œç³»ç»Ÿï¼ŒåŒ…æ‹¬ FreeBSDã€NetBSDã€OpenBSD å’Œ Solaris(TM)ã€‚ÚgIPFILTER is a kernel-side firewall and NAT mechanism that can be controlled and monitored by userland programs.  Firewall rules can be set or deleted using ipf, NAT rules can be set or deleted using ipnat, run-time statistics for the kernel parts of IPFILTER can be printed using ipfstat, and ipmon can be used to log IPFILTER actions to the system log files.Ú]IPFILTER æ˜¯ä¸€ä¸ªä½äºå†…æ ¸çš„é˜²ç«å¢™å’Œ NAT æœºåˆ¶ï¼Œå¯ä»¥ç”±ç”¨æˆ·ç©ºé—´ç¨‹åºè¿›è¡Œæ§åˆ¶å’Œç›‘æ§ã€‚å¯ä»¥ä½¿ç”¨ ipf è®¾ç½®æˆ–åˆ é™¤é˜²ç«å¢™è§„åˆ™ï¼Œä½¿ç”¨ ipnat è®¾ç½®æˆ–åˆ é™¤ NAT è§„åˆ™ï¼Œä½¿ç”¨ ipfstat æ‰“å° IPFILTER å†…æ ¸éƒ¨åˆ†çš„è¿è¡Œæ—¶ç»Ÿè®¡ä¿¡æ¯ï¼Œå¹¶å¯ä»¥ä½¿ç”¨ ipmon å°† IPFILTER çš„æ“ä½œè®°å½•åˆ°ç³»ç»Ÿæ—¥å¿—æ–‡ä»¶ä¸­ã€‚ÙÌIPF was originally written using a rule processing logic of "the last matching rule wins" and only used stateless rules.  Since then, IPF has been enhanced to include the `quick` and `keep state` options.ÙÙIPF æœ€åˆä½¿ç”¨â€œæœ€ååŒ¹é…è§„åˆ™è·èƒœï¼ˆthe last matching rule winsï¼‰â€çš„è§„åˆ™å¤„ç†é€»è¾‘ï¼Œå¹¶ä¸”åªä½¿ç”¨æ— çŠ¶æ€è§„åˆ™ã€‚æ­¤åï¼ŒIPF å·²ç»è¿›è¡Œäº†å¢å¼ºï¼ŒåŒ…æ‹¬äº† `quick` å’Œ `keep state` é€‰é¡¹ã€‚ÙŞThe IPF FAQ is at http://www.phildev.net/ipf/index.html[http://www.phildev.net/ipf/index.html].  A searchable archive of the IPFilter mailing list is available at http://marc.info/?l=ipfilter[http://marc.info/?l=ipfilter].ÙÓIPF FAQ ä½äº http://www.phildev.net/ipf/index.html[http://www.phildev.net/ipf/index.html]ã€‚IPFilter é‚®ä»¶åˆ—è¡¨çš„å¯æœç´¢å­˜æ¡£å¯åœ¨ http://marc.info/?l=ipfilter[http://marc.info/?l=ipfilter] ä¸Šæ‰¾åˆ°ã€‚Ù˜This section of the Handbook focuses on IPF as it pertains to FreeBSD.  It provides examples of rules that contain the `quick` and `keep state` options.Ù‡æœ¬æ‰‹å†Œçš„è¿™ä¸€éƒ¨åˆ†é‡ç‚¹ä»‹ç»äº†ä¸ FreeBSD ç›¸å…³çš„ IPFã€‚å®ƒæä¾›äº†åŒ…å« `quick` å’Œ `keep state` é€‰é¡¹çš„è§„åˆ™ç¤ºä¾‹ã€‚¬Enabling IPFªå¯ç”¨ IPFÙŒIPF is included in the basic FreeBSD install as a kernel loadable module, meaning that a custom kernel is not needed in order to enable IPF.Ù‡IPF è¢«åŒ…å«åœ¨åŸºæœ¬çš„ FreeBSD å®‰è£…ä¸­ä½œä¸ºä¸€ä¸ªå¯åŠ è½½çš„å†…æ ¸æ¨¡å—ï¼Œè¿™æ„å‘³ç€ä¸éœ€è¦è‡ªå®šä¹‰å†…æ ¸æ¥å¯ç”¨ IPF ã€‚ÙÚFor users who prefer to statically compile IPF support into a custom kernel, refer to the instructions in crossref:kernelconfig[kernelconfig,Configuring the FreeBSD Kernel].  The following kernel options are available:Ùµå¯¹äºå–œæ¬¢å°† IPF æ”¯æŒé™æ€ç¼–è¯‘åˆ°è‡ªå®šä¹‰å†…æ ¸ä¸­çš„ç”¨æˆ·ï¼Œè¯·å‚è€ƒ crossref:kernelconfig[kernelconfig,é…ç½® FreeBSD å†…æ ¸] ä¸­çš„è¯´æ˜ã€‚ä»¥ä¸‹å†…æ ¸é€‰é¡¹å¯ç”¨ï¼šÚwhere `options IPFILTER` enables support for IPFILTER, `options IPFILTER_LOG` enables IPF logging using the [.filename]#ipl# packet logging pseudo-device for every rule that has the `log` keyword, `IPFILTER_LOOKUP` enables IP pools in order to speed up IP lookups, and `options IPFILTER_DEFAULT_BLOCK` changes the default behavior so that any packet not matching a firewall `pass` rule gets blocked.Úq`options IPFILTER` å¯ç”¨å¯¹ IPFILTER çš„æ”¯æŒï¼Œ`options IPFILTER_LOG` å¯ç”¨ä½¿ç”¨ [.filename]#ipl# ä¼ªè®¾å¤‡å¯¹äºæ¯ä¸ªå¸¦æœ‰ `log` å…³é”®å­—çš„è§„åˆ™è¿›è¡Œ IPF æ—¥å¿—è®°å½•ï¼Œ`IPFILTER_LOOKUP` å¯ç”¨ IP æ± ä»¥åŠ å¿« IP æŸ¥æ‰¾é€Ÿåº¦ï¼Œè€Œ `options IPFILTER_DEFAULT_BLOCK` æ›´æ”¹é»˜è®¤è¡Œä¸ºï¼Œä½¿å¾—ä»»ä½•ä¸ç¬¦åˆé˜²ç«å¢™ `pass` è§„åˆ™çš„æ•°æ®åŒ…éƒ½è¢«é˜»æ­¢ã€‚Ú9To configure the system to enable IPF at boot time, add the following entries to [.filename]#/etc/rc.conf#.  These entries will also enable logging and `default pass all`.  To change the default policy to `block all` without compiling a custom kernel, remember to add a `block all` rule at the end of the ruleset.Ú3è¦åœ¨å¯åŠ¨æ—¶é…ç½®ç³»ç»Ÿä»¥å¯ç”¨ IPFï¼Œè¯·å°†ä»¥ä¸‹æ¡ç›®æ·»åŠ åˆ° [.filename]#/etc/rc.conf# æ–‡ä»¶ä¸­ã€‚è¿™äº›æ¡ç›®è¿˜å°†å¯ç”¨æ—¥å¿—è®°å½•å’Œ `default pass all`ã€‚è¦å°†é»˜è®¤ç­–ç•¥æ›´æ”¹ä¸º `block all` è€Œæ— éœ€ç¼–è¯‘è‡ªå®šä¹‰å†…æ ¸ï¼Œè¯·è®°ä½åœ¨è§„åˆ™é›†çš„æœ«å°¾æ·»åŠ ä¸€ä¸ª `block all` è§„åˆ™ã€‚Ù5If NAT functionality is needed, also add these lines:Ù5å¦‚æœéœ€è¦ NAT åŠŸèƒ½ï¼Œè¿˜éœ€è¦æ·»åŠ ä»¥ä¸‹è¡Œï¼š·Then, to start IPF now:Ù"ç„¶åï¼Œç°åœ¨å¼€å§‹å¯åŠ¨ IPFï¼šÙ¡To load the firewall rules, specify the name of the ruleset file using `ipf`.  The following command can be used to replace the currently running firewall rules:Ù‹è¦åŠ è½½é˜²ç«å¢™è§„åˆ™ï¼Œè¯·ä½¿ç”¨ `ipf` æŒ‡å®šè§„åˆ™é›†æ–‡ä»¶çš„åç§°ã€‚å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ›¿æ¢å½“å‰è¿è¡Œçš„é˜²ç«å¢™è§„åˆ™ï¼šÙkwhere `-Fa` flushes all the internal rules tables and `-f` specifies the file containing the rules to load.Ùh`-Fa` é€‰é¡¹ä¼šæ¸…ç©ºæ‰€æœ‰å†…éƒ¨è§„åˆ™è¡¨ï¼Œ`-f` é€‰é¡¹ç”¨äºæŒ‡å®šåŒ…å«è¦åŠ è½½çš„è§„åˆ™çš„æ–‡ä»¶ã€‚ÚThis provides the ability to make changes to a custom ruleset and update the running firewall with a fresh copy of the rules without having to reboot the system.  This method is convenient for testing new rules as the procedure can be executed as many times as needed.Ùóè¿™æä¾›äº†å¯¹è‡ªå®šä¹‰è§„åˆ™é›†è¿›è¡Œæ›´æ”¹å¹¶ä½¿ç”¨æœ€æ–°çš„è§„åˆ™å‰¯æœ¬æ›´æ–°æ­£åœ¨è¿è¡Œçš„é˜²ç«å¢™çš„èƒ½åŠ›ï¼Œè€Œæ— éœ€é‡æ–°å¯åŠ¨ç³»ç»Ÿã€‚è¿™ç§æ–¹æ³•å¯¹äºæµ‹è¯•æ–°è§„åˆ™éå¸¸æ–¹ä¾¿ï¼Œå› ä¸ºå¯ä»¥æ ¹æ®éœ€è¦æ‰§è¡Œè¯¥è¿‡ç¨‹å¤šæ¬¡ã€‚ÙORefer to man:ipf[8] for details on the other flags available with this command.ÙMæœ‰å…³æ­¤å‘½ä»¤å¯ç”¨çš„å…¶ä»–æ ‡å¿—çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è€ƒ man:ipf[8]ã€‚¯IPF Rule Syntax°IPF è§„åˆ™è¯­æ³•ÚİThis section describes the IPF rule syntax used to create stateful rules.  When creating rules, keep in mind that unless the `quick` keyword appears in a rule, every rule is read in order, with the _last matching rule_ being the one that is applied.  This means that even if the first rule to match a packet is a `pass`, if there is a later matching rule that is a `block`, the packet will be dropped.  Sample rulesets can be found in [.filename]#/usr/share/examples/ipfilter#.Ú¼æœ¬èŠ‚æè¿°äº†ç”¨äºåˆ›å»ºæœ‰çŠ¶æ€è§„åˆ™çš„ IPF è§„åˆ™è¯­æ³•ã€‚åœ¨åˆ›å»ºè§„åˆ™æ—¶ï¼Œè¯·è®°ä½ï¼Œé™¤éè§„åˆ™ä¸­å‡ºç°äº† `quick` å…³é”®å­—ï¼Œå¦åˆ™æ¯ä¸ªè§„åˆ™éƒ½ä¼šæŒ‰é¡ºåºè¯»å–ï¼Œåº”ç”¨çš„æ˜¯ _æœ€ååŒ¹é…çš„è§„åˆ™_ã€‚è¿™æ„å‘³ç€ï¼Œå³ä½¿ç¬¬ä¸€ä¸ªåŒ¹é…æ•°æ®åŒ…çš„è§„åˆ™æ˜¯ `pass`ï¼Œå¦‚æœåé¢æœ‰ä¸€ä¸ªåŒ¹é…çš„è§„åˆ™æ˜¯ `block`ï¼Œæ•°æ®åŒ…å°†è¢«ä¸¢å¼ƒã€‚ç¤ºä¾‹è§„åˆ™é›†å¯ä»¥åœ¨ [.filename]#/usr/share/examples/ipfilter# ä¸­æ‰¾åˆ°ã€‚ÙÅWhen creating rules, a `+#+` character is used to mark the start of a comment and may appear at the end of a rule, to explain that rule's function, or on its own line.  Any blank lines are ignored.Ù¸åˆ›å»ºè§„åˆ™æ—¶ï¼Œä½¿ç”¨ `+#+` å­—ç¬¦æ¥æ ‡è®°æ³¨é‡Šçš„å¼€å§‹ï¼Œå¹¶ä¸”å¯ä»¥å‡ºç°åœ¨è§„åˆ™çš„æœ«å°¾ï¼Œä»¥è§£é‡Šè¯¥è§„åˆ™çš„åŠŸèƒ½ï¼Œæˆ–è€…ç‹¬å ä¸€è¡Œã€‚ä»»ä½•ç©ºè¡Œéƒ½ä¼šè¢«å¿½ç•¥ã€‚ÚŸThe keywords which are used in rules must be written in a specific order, from left to right.  Some keywords are mandatory while others are optional.  Some keywords have sub-options which may be keywords themselves and also include more sub-options.  The keyword order is as follows, where the words shown in uppercase represent a variable and the words shown in lowercase must precede the variable that follows it:Úåœ¨è§„åˆ™ä¸­ä½¿ç”¨çš„å…³é”®å­—å¿…é¡»æŒ‰ç…§ç‰¹å®šçš„é¡ºåºä»å·¦åˆ°å³è¿›è¡Œç¼–å†™ã€‚ä¸€äº›å…³é”®å­—æ˜¯å¿…éœ€çš„ï¼Œè€Œå…¶ä»–ä¸€äº›æ˜¯å¯é€‰çš„ã€‚ä¸€äº›å…³é”®å­—å…·æœ‰å­é€‰é¡¹ï¼Œè¿™äº›å­é€‰é¡¹å¯èƒ½æ˜¯å…³é”®å­—æœ¬èº«ï¼Œå¹¶ä¸”è¿˜å¯ä»¥åŒ…å«æ›´å¤šçš„å­é€‰é¡¹ã€‚å…³é”®å­—çš„é¡ºåºå¦‚ä¸‹æ‰€ç¤ºï¼Œå…¶ä¸­å¤§å†™å­—æ¯è¡¨ç¤ºå˜é‡ï¼Œå°å†™å­—æ¯è¡¨ç¤ºå¿…é¡»åœ¨å…¶åé¢çš„å˜é‡ä¹‹å‰å‡ºç°çš„å…³é”®å­—ï¼šÚ	This section describes each of these keywords and their options.  It is not an exhaustive list of every possible option.  Refer to man:ipf[5] for a complete description of the rule syntax that can be used when creating IPF rules and examples for using each keyword.ÙÜæœ¬èŠ‚æè¿°äº†æ¯ä¸ªå…³é”®å­—åŠå…¶é€‰é¡¹ã€‚è¿™ä¸æ˜¯ä¸€ä¸ªè¯¦å°½æ— é—çš„é€‰é¡¹åˆ—è¡¨ã€‚æœ‰å…³åœ¨åˆ›å»º IPF è§„åˆ™å’Œä½¿ç”¨æ¯ä¸ªå…³é”®å­—çš„ç¤ºä¾‹æ—¶å¯ä»¥ä½¿ç”¨çš„è§„åˆ™è¯­æ³•çš„å®Œæ•´æè¿°ï¼Œè¯·å‚é˜… man:ipf[5]ã€‚ÙšThe action keyword indicates what to do with the packet if it matches that rule.  Every rule _must_ have an action.  The following actions are recognized:Ùšaction å…³é”®å­—æŒ‡ç¤ºå¦‚æœæ•°æ®åŒ…ä¸è¯¥è§„åˆ™åŒ¹é…ï¼Œåº”è¯¥é‡‡å–ä»€ä¹ˆæ“ä½œã€‚æ¯ä¸ªè§„åˆ™éƒ½ **å¿…é¡»** æœ‰ä¸€ä¸ªåŠ¨ä½œã€‚ä»¥ä¸‹åŠ¨ä½œè¢«è¯†åˆ«ï¼šº`block`: drops the packet.¿`block`ï¼šä¸¢å¼ƒè¯¥æ•°æ®åŒ…ã€‚º`pass`: allows the packet.Ù!`pass`ï¼šå…è®¸æ•°æ®åŒ…é€šè¿‡ã€‚¾`log`: generates a log record.Ù#`log`ï¼šç”Ÿæˆä¸€æ¡æ—¥å¿—è®°å½•ã€‚Ùl`count`: counts the number of packets and bytes which can provide an indication of how often a rule is used.Ù[`count`ï¼šè®¡ç®—æ•°æ®åŒ…å’Œå­—èŠ‚æ•°çš„æ•°é‡ï¼Œå¯ä»¥æä¾›è§„åˆ™ä½¿ç”¨é¢‘ç‡çš„æŒ‡ç¤ºã€‚ÙD`auth`: queues the packet for further processing by another program.ÙH`auth`ï¼šå°†æ•°æ®åŒ…æ’é˜Ÿï¼Œä»¥ä¾¿ç”±å¦ä¸€ä¸ªç¨‹åºè¿›ä¸€æ­¥å¤„ç†ã€‚ÙT`call`: provides access to functions built into IPF that allow more complex actions.ÙY`call`ï¼šæä¾›å¯¹å†…ç½®äº IPF ä¸­çš„å‡½æ•°çš„è®¿é—®ï¼Œå…è®¸æ‰§è¡Œæ›´å¤æ‚çš„æ“ä½œã€‚ÙR`decapsulate`: removes any headers in order to process the contents of the packet.ÙC`decapsulate`ï¼šç§»é™¤ä»»ä½•å¤´éƒ¨ä»¥ä¾¿å¤„ç†æ•°æ®åŒ…çš„å†…å®¹ã€‚©DIRECTIONµæ–¹å‘ï¼ˆDIRECTIONï¼‰Ù[Next, each rule must explicitly state the direction of traffic using one of these keywords:ÙZæ¥ä¸‹æ¥ï¼Œæ¯ä¸ªè§„åˆ™å¿…é¡»æ˜ç¡®æŒ‡å®šæµé‡çš„æ–¹å‘ï¼Œä½¿ç”¨ä»¥ä¸‹å…³é”®å­—ä¹‹ä¸€ï¼šÙ4`in`: the rule is applied against an inbound packet.Ù(`in`ï¼šè§„åˆ™åº”ç”¨äºå…¥ç«™æ•°æ®åŒ…ã€‚Ù6`out`: the rule is applied against an outbound packet.Ù(`out`: è§„åˆ™åº”ç”¨äºå‡ºç«™æ•°æ®åŒ…ã€‚Ù,`all`: the rule applies to either direction.Ù%`all`: è§„åˆ™é€‚ç”¨äºä»»ä½•æ–¹å‘ã€‚ÙIf the system has multiple interfaces, the interface can be specified along with the direction. An example would be `in on fxp0`.Ùjå¦‚æœç³»ç»Ÿæœ‰å¤šä¸ªæ¥å£ï¼Œå¯ä»¥åœ¨æŒ‡å®šæ–¹å‘æ—¶åŒæ—¶æŒ‡å®šæ¥å£ã€‚ä¸€ä¸ªä¾‹å­æ˜¯ `in on fxp0`ã€‚ÙmOptions are optional.  However, if multiple options are specified, they must be used in the order shown here.Ùié€‰é¡¹æ˜¯å¯é€‰çš„ã€‚ç„¶è€Œï¼Œå¦‚æœæŒ‡å®šäº†å¤šä¸ªé€‰é¡¹ï¼Œåˆ™å¿…é¡»æŒ‰ç…§è¿™é‡Œæ˜¾ç¤ºçš„é¡ºåºä½¿ç”¨ã€‚Ù`log`: when performing the specified ACTION, the contents of the packet's headers will be written to the man:ipl[4] packet log pseudo-device.Ùw`log`ï¼šåœ¨æ‰§è¡ŒæŒ‡å®šçš„æ“ä½œæ—¶ï¼Œæ•°æ®åŒ…å¤´éƒ¨çš„å†…å®¹å°†è¢«å†™å…¥åˆ° man:ipl[4] æ•°æ®åŒ…æ—¥å¿—ä¼ªè®¾å¤‡ä¸­ã€‚Ùœ`quick`: if a packet matches this rule, the ACTION specified by the rule occurs and no further processing of any following rules will occur for this packet.Ù¨`quick`: å¦‚æœä¸€ä¸ªæ•°æ®åŒ…ç¬¦åˆè¿™ä¸ªè§„åˆ™ï¼Œé‚£ä¹ˆè§„åˆ™æŒ‡å®šçš„æ“ä½œå°†ä¼šæ‰§è¡Œï¼Œå¹¶ä¸”å¯¹äºè¿™ä¸ªæ•°æ®åŒ…ï¼Œä¸ä¼šå†è¿›è¡Œä»»ä½•åç»­è§„åˆ™çš„å¤„ç†ã€‚Ùº`on`: must be followed by the interface name as displayed by man:ifconfig[8].  The rule will only match if the packet is going through the specified interface in the specified direction.Ù`on`ï¼šå¿…é¡»è·Ÿéšç€ `man:ifconfig[8]` ä¸­æ˜¾ç¤ºçš„æ¥å£åç§°ã€‚åªæœ‰å½“æ•°æ®åŒ…é€šè¿‡æŒ‡å®šçš„æ¥å£ä»¥æŒ‡å®šçš„æ–¹å‘ä¼ è¾“æ—¶ï¼Œè§„åˆ™æ‰ä¼šåŒ¹é…ã€‚ÙQWhen using the `log` keyword, the following qualifiers may be used in this order:ÙLä½¿ç”¨ `log` å…³é”®å­—æ—¶ï¼Œå¯ä»¥æŒ‰ç…§ä»¥ä¸‹é¡ºåºä½¿ç”¨ä»¥ä¸‹é™å®šè¯ï¼šÙc`body`: indicates that the first 128 bytes of the packet contents will be logged after the headers.ÙS`body`ï¼šè¡¨ç¤ºåœ¨æŠ¥æ–‡å¤´éƒ¨ä¹‹åï¼Œå°†è®°å½•æŠ¥æ–‡å†…å®¹çš„å‰ 128 ä¸ªå­—èŠ‚ã€‚ÙÚ`first`: if the `log` keyword is being used in conjunction with a `keep state` option, this option is recommended so that only the triggering packet is logged and not every packet which matches the stateful connection.Ùµ`first`ï¼šå¦‚æœ `log` å…³é”®å­—ä¸ `keep state` é€‰é¡¹ä¸€èµ·ä½¿ç”¨ï¼Œå»ºè®®ä½¿ç”¨æ­¤é€‰é¡¹ï¼Œä»¥ä¾¿ä»…è®°å½•è§¦å‘çš„æ•°æ®åŒ…ï¼Œè€Œä¸æ˜¯ä¸çŠ¶æ€è¿æ¥åŒ¹é…çš„æ¯ä¸ªæ•°æ®åŒ…ã€‚ÙiAdditional options are available to specify error return messages.  Refer to man:ipf[5] for more details.Ùhè¿˜æœ‰å…¶ä»–é€‰é¡¹å¯ç”¨äºæŒ‡å®šé”™è¯¯è¿”å›æ¶ˆæ¯ã€‚æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… man:ipf[5]ã€‚ªPROTO_TYPE¼åè®®ç±»å‹ï¼ˆPROTO_TYPEï¼‰ÚØThe protocol type is optional.  However, it is mandatory if the rule needs to specify a SRC_PORT or a DST_PORT as it defines the type of protocol.  When specifying the type of protocol, use the `proto` keyword followed by either a protocol number or name from [.filename]#/etc/protocols#.  Example protocol names include `tcp`, `udp`, or `icmp`.  If PROTO_TYPE is specified but no SRC_PORT or DST_PORT is specified, all port numbers for that protocol will match that rule.Ú¾åè®®ç±»å‹æ˜¯å¯é€‰çš„ã€‚ç„¶è€Œï¼Œå¦‚æœè§„åˆ™éœ€è¦æŒ‡å®š SRC_PORT æˆ– DST_PORT ï¼Œåˆ™åè®®ç±»å‹æ˜¯å¿…éœ€çš„ï¼Œå› ä¸ºå®ƒå®šä¹‰äº†åè®®çš„ç±»å‹ã€‚åœ¨æŒ‡å®šåè®®ç±»å‹æ—¶ï¼Œä½¿ç”¨ `proto` å…³é”®å­—ï¼Œåé¢è·Ÿç€æ¥è‡ª [.filename]#/etc/protocols# çš„åè®®å·æˆ–åç§°ã€‚ç¤ºä¾‹åè®®åç§°åŒ…æ‹¬ `tcp`ã€`udp` æˆ– `icmp`ã€‚å¦‚æœæŒ‡å®šäº† PROTO_TYPEï¼Œä½†æœªæŒ‡å®š SRC_PORT æˆ– DST_PORTï¼Œåˆ™è¯¥è§„åˆ™å°†åŒ¹é…è¯¥åè®®çš„æ‰€æœ‰ç«¯å£å·ã€‚¨SRC_ADDR©æºåœ°å€ÙùThe `from` keyword is mandatory and is followed by a keyword which represents the source of the packet.  The source can be a hostname, an IP address followed by the CIDR mask, an address pool, or the keyword `all`.  Refer to man:ipf[5] for examples.ÙÛ`from` å…³é”®å­—æ˜¯å¿…éœ€çš„ï¼Œå¹¶ä¸”åé¢è·Ÿç€ä¸€ä¸ªå…³é”®å­—ï¼Œè¡¨ç¤ºæ•°æ®åŒ…çš„æ¥æºã€‚æ¥æºå¯ä»¥æ˜¯ä¸»æœºåã€IP åœ°å€åè·Ÿ CIDR æ©ç ã€åœ°å€æ± æˆ–å…³é”®å­— `all`ã€‚æœ‰å…³ç¤ºä¾‹ï¼Œè¯·å‚é˜… man:ipf[5]ã€‚ÚcThere is no way to match ranges of IP addresses which do not express themselves easily using the dotted numeric form / mask-length notation.  The package:net-mgmt/ipcalc[] package or port may be used to ease the calculation of the CIDR mask.  Additional information is available at the utility's web page: http://jodies.de/ipcalc[http://jodies.de/ipcalc].Ú-æ²¡æœ‰åŠæ³•åŒ¹é…é‚£äº›ä¸å®¹æ˜“ç”¨ç‚¹åˆ†åè¿›åˆ¶å½¢å¼æˆ–æ©ç é•¿åº¦è¡¨ç¤ºçš„ IP åœ°å€èŒƒå›´ã€‚å¯ä»¥ä½¿ç”¨ package:net-mgmt/ipcalc[] è½¯ä»¶åŒ…æˆ– port æ¥ç®€åŒ– CIDR æ©ç çš„è®¡ç®—ã€‚æœ‰å…³è¯¥å®ç”¨ç¨‹åºçš„æ›´å¤šä¿¡æ¯ï¼Œè¯·è®¿é—®å…¶ç½‘é¡µï¼šhttp://jodies.de/ipcalc[http://jodies.de/ipcalc]ã€‚ÙºThe port number of the source is optional.  However, if it is used, it requires PROTO_TYPE to be first defined in the rule.  The port number must also be preceded by the `proto` keyword.Ù›æºç«¯å£å·æ˜¯å¯é€‰çš„ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½¿ç”¨äº†æºç«¯å£å·ï¼Œè§„åˆ™ä¸­å¿…é¡»é¦–å…ˆå®šä¹‰ PROTO_TYPEã€‚ç«¯å£å·è¿˜å¿…é¡»åœ¨ `proto` å…³é”®å­—ä¹‹å‰ã€‚ÙÆA number of different comparison operators are supported: `=` (equal to), `!=` (not equal to), `<` (less than), `>` (greater than), `<=` (less than or equal to), and `>=` (greater than or equal to).Ù¨æ”¯æŒå¤šç§ä¸åŒçš„æ¯”è¾ƒè¿ç®—ç¬¦ï¼š` = `ï¼ˆç­‰äºï¼‰ï¼Œ`!=`ï¼ˆä¸ç­‰äºï¼‰ï¼Œ`<`ï¼ˆå°äºï¼‰ï¼Œ`>`ï¼ˆå¤§äºï¼‰ï¼Œ`<=`ï¼ˆå°äºç­‰äºï¼‰å’Œ `>=`ï¼ˆå¤§äºç­‰äºï¼‰ã€‚Ù¿To specify port ranges, place the two port numbers between `<>` (less than and greater than ), `><` (greater than and less than ), or `:` (greater than or equal to and less than or equal to).Ù è¦æŒ‡å®šç«¯å£èŒƒå›´ï¼Œè¯·å°†ä¸¤ä¸ªç«¯å£å·æ”¾åœ¨ `<>`ï¼ˆå°äºå’Œå¤§äºï¼‰ã€`><`ï¼ˆå¤§äºå’Œå°äºï¼‰æˆ– `:`ï¼ˆå¤§äºæˆ–ç­‰äºå’Œå°äºæˆ–ç­‰äºï¼‰ä¹‹é—´ã€‚¨DST_ADDR¬ç›®æ ‡åœ°å€ÙæThe `to` keyword is mandatory and is followed by a keyword which represents the destination of the packet.  Similar to SRC_ADDR, it can be a hostname, an IP address followed by the CIDR mask, an address pool, or the keyword `all`.ÙÃ`to` å…³é”®å­—æ˜¯å¿…éœ€çš„ï¼Œåé¢è·Ÿç€ä¸€ä¸ªå…³é”®å­—ï¼Œè¡¨ç¤ºæ•°æ®åŒ…çš„ç›®çš„åœ°ã€‚ä¸ SRC_ADDR ç±»ä¼¼ï¼Œå®ƒå¯ä»¥æ˜¯ä¸»æœºåã€IP åœ°å€åè·Ÿ CIDR æ©ç ã€åœ°å€æ± æˆ–å…³é”®å­— `all`ã€‚ÙÔSimilar to SRC_PORT, the port number of the destination is optional.  However, if it is used, it requires PROTO_TYPE to be first defined in the rule.  The port number must also be preceded by the `proto` keyword.Ù¸ä¸ SRC_PORT ç±»ä¼¼ï¼Œç›®æ ‡ç«¯å£å·æ˜¯å¯é€‰çš„ã€‚ç„¶è€Œï¼Œå¦‚æœä½¿ç”¨äº†ç›®æ ‡ç«¯å£å·ï¼Œè§„åˆ™ä¸­å¿…é¡»é¦–å…ˆå®šä¹‰ PROTO_TYPE ã€‚ç«¯å£å·è¿˜å¿…é¡»åœ¨ `proto` å…³é”®å­—ä¹‹å‰ã€‚Ú%If `tcp` is specified as the PROTO_TYPE, flags can be specified as letters, where each letter represents one of the possible TCP flags used to determine the state of a connection.  Possible values are: `S` (SYN), `A` (ACK), `P` (PSH), `F` (FIN), `U` (URG), `R` (RST), `C` (CWN), and `E` (ECN).Ú/å¦‚æœæŒ‡å®š `tcp` ä½œä¸º PROTO_TYPEï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨å­—æ¯æ¥æŒ‡å®šæ ‡å¿—ï¼Œå…¶ä¸­æ¯ä¸ªå­—æ¯ä»£è¡¨ç”¨äºç¡®å®šè¿æ¥çŠ¶æ€çš„å¯èƒ½çš„ TCP æ ‡å¿—ä¹‹ä¸€ã€‚å¯èƒ½çš„å€¼åŒ…æ‹¬ï¼š`S`ï¼ˆSYNï¼‰ï¼Œ`A`ï¼ˆACKï¼‰ï¼Œ`P`ï¼ˆPSHï¼‰ï¼Œ`F`ï¼ˆFINï¼‰ï¼Œ`U`ï¼ˆURGï¼‰ï¼Œ`R`ï¼ˆRSTï¼‰ï¼Œ`C`ï¼ˆCWNï¼‰å’Œ `E`ï¼ˆECNï¼‰ã€‚Ù€If `icmp` is specified as the PROTO_TYPE, the ICMP type to match can be specified.  Refer to man:ipf[5] for the allowable types.Ùå¦‚æœæŒ‡å®šäº† `icmp` ä½œä¸º PROTO_TYPEï¼Œå¯ä»¥æŒ‡å®šè¦åŒ¹é…çš„ ICMP ç±»å‹ã€‚æœ‰å…³å…è®¸çš„ç±»å‹ï¼Œè¯·å‚é˜… man:ipf[5]ã€‚¥STATE±çŠ¶æ€ï¼ˆSTATEï¼‰Ú=If a `pass` rule contains `keep state`, IPF will add an entry to its dynamic state table and allow subsequent packets that match the connection.  IPF can track state for TCP, UDP, and ICMP sessions.  Any packet that IPF can be certain is part of an active session, even if it is a different protocol, will be allowed.Ú8å¦‚æœä¸€ä¸ª `pass` è§„åˆ™åŒ…å« `keep state`ï¼ŒIPF å°†åœ¨å…¶åŠ¨æ€çŠ¶æ€è¡¨ä¸­æ·»åŠ ä¸€ä¸ªæ¡ç›®ï¼Œå¹¶å…è®¸åŒ¹é…è¿æ¥çš„åç»­æ•°æ®åŒ…ã€‚IPF å¯ä»¥è·Ÿè¸ª TCPã€UDP å’Œ ICMP ä¼šè¯çš„çŠ¶æ€ã€‚ä»»ä½• IPF å¯ä»¥ç¡®å®šæ˜¯æ´»åŠ¨ä¼šè¯çš„ä¸€éƒ¨åˆ†çš„æ•°æ®åŒ…ï¼Œå³ä½¿æ˜¯ä¸åŒçš„åè®®ï¼Œä¹Ÿå°†è¢«å…è®¸é€šè¿‡ã€‚ÚLIn IPF, packets destined to go out through the interface connected to the public Internet are first checked against the dynamic state table.  If the packet matches the next expected packet comprising an active session conversation, it exits the firewall and the state of the session conversation flow is updated in the dynamic state table.  Packets that do not belong to an already active session are checked against the outbound ruleset.  Packets coming in from the interface connected to the public Internet are first checked against the dynamic state table.  If the packet matches the next expected packet comprising an active session, it exits the firewall and the state of the session conversation flow is updated in the dynamic state table.  Packets that do not belong to an already active session are checked against the inbound ruleset.Úºåœ¨ IPF ä¸­ï¼Œç›®æ ‡è¦é€šè¿‡è¿æ¥åˆ°å…¬å…±äº’è”ç½‘çš„æ¥å£å‘é€çš„æ•°æ®åŒ…é¦–å…ˆä¼šä¸åŠ¨æ€çŠ¶æ€è¡¨è¿›è¡ŒåŒ¹é…æ£€æŸ¥ã€‚å¦‚æœæ•°æ®åŒ…ä¸æ´»åŠ¨ä¼šè¯å¯¹è¯çš„ä¸‹ä¸€ä¸ªé¢„æœŸæ•°æ®åŒ…åŒ¹é…ï¼Œå®ƒå°†ç¦»å¼€é˜²ç«å¢™ï¼Œå¹¶ä¸”ä¼šè¯å¯¹è¯æµçš„çŠ¶æ€å°†åœ¨åŠ¨æ€çŠ¶æ€è¡¨ä¸­æ›´æ–°ã€‚ä¸å±äºå·²ç»æ´»åŠ¨ä¼šè¯çš„æ•°æ®åŒ…å°†ä¼šä¸å‡ºç«™è§„åˆ™é›†è¿›è¡Œæ£€æŸ¥ã€‚ä»è¿æ¥åˆ°å…¬å…±äº’è”ç½‘çš„æ¥å£è¿›å…¥çš„æ•°æ®åŒ…é¦–å…ˆä¼šä¸åŠ¨æ€çŠ¶æ€è¡¨è¿›è¡ŒåŒ¹é…æ£€æŸ¥ã€‚å¦‚æœæ•°æ®åŒ…ä¸æ´»åŠ¨ä¼šè¯çš„ä¸‹ä¸€ä¸ªé¢„æœŸæ•°æ®åŒ…åŒ¹é…ï¼Œå®ƒå°†ç¦»å¼€é˜²ç«å¢™ï¼Œå¹¶ä¸”ä¼šè¯å¯¹è¯æµçš„çŠ¶æ€å°†åœ¨åŠ¨æ€çŠ¶æ€è¡¨ä¸­æ›´æ–°ã€‚ä¸å±äºå·²ç»æ´»åŠ¨ä¼šè¯çš„æ•°æ®åŒ…å°†ä¼šä¸å…¥ç«™è§„åˆ™é›†è¿›è¡Œæ£€æŸ¥ã€‚ÚSeveral keywords can be added after `keep state`.  If used, these keywords set various options that control stateful filtering, such as setting connection limits or connection age.  Refer to man:ipf[5] for the list of available options and their descriptions.Ùûåœ¨ `keep state` ä¹‹åå¯ä»¥æ·»åŠ å‡ ä¸ªå…³é”®å­—ã€‚å¦‚æœä½¿ç”¨äº†è¿™äº›å…³é”®å­—ï¼Œå®ƒä»¬å¯ä»¥è®¾ç½®å„ç§æ§åˆ¶æœ‰çŠ¶æ€è¿‡æ»¤çš„é€‰é¡¹ï¼Œä¾‹å¦‚è®¾ç½®è¿æ¥é™åˆ¶æˆ–è¿æ¥æ—¶é•¿ã€‚è¯·å‚è€ƒ man:ipf[5] ä»¥è·å–å¯ç”¨é€‰é¡¹åŠå…¶æè¿°çš„åˆ—è¡¨ã€‚Ù‚This section demonstrates how to create an example ruleset which only allows services matching `pass` rules and blocks all others.Ù†æœ¬èŠ‚æ¼”ç¤ºå¦‚ä½•åˆ›å»ºä¸€ä¸ªç¤ºä¾‹è§„åˆ™é›†ï¼Œè¯¥è§„åˆ™é›†ä»…å…è®¸ä¸ `pass` è§„åˆ™åŒ¹é…çš„æœåŠ¡ï¼Œå¹¶é˜»æ­¢æ‰€æœ‰å…¶ä»–æœåŠ¡ã€‚ÙÓFreeBSD uses the loopback interface ([.filename]#lo0#) and the IP address `127.0.0.1` for internal communication.  The firewall ruleset must contain rules to allow free movement of these internally used packets:Ù¹FreeBSD ä½¿ç”¨å›ç¯æ¥å£ï¼ˆ[.filename]#lo0#ï¼‰å’Œ IP åœ°å€ `127.0.0.1` è¿›è¡Œå†…éƒ¨é€šä¿¡ã€‚é˜²ç«å¢™è§„åˆ™é›†å¿…é¡»åŒ…å«å…è®¸è¿™äº›å†…éƒ¨ä½¿ç”¨çš„æ•°æ®åŒ…è‡ªç”±ä¼ è¾“çš„è§„åˆ™ï¼šÚ*The public interface connected to the Internet is used to authorize and control access of all outbound and inbound connections.  If one or more interfaces are cabled to private networks, those internal interfaces may require rules to allow packets originating from the LAN to flow between the internal networks or to the interface attached to the Internet.  The ruleset should be organized into three major sections: any trusted internal interfaces, outbound connections through the public interface, and inbound connections through the public interface.Ú­ä¸äº’è”ç½‘è¿æ¥çš„å…¬å…±æ¥å£ç”¨äºæˆæƒå’Œæ§åˆ¶æ‰€æœ‰å‡ºç«™å’Œå…¥ç«™è¿æ¥çš„è®¿é—®ã€‚å¦‚æœä¸€ä¸ªæˆ–å¤šä¸ªæ¥å£è¿æ¥åˆ°ç§æœ‰ç½‘ç»œï¼Œé‚£äº›å†…éƒ¨æ¥å£å¯èƒ½éœ€è¦è§„åˆ™æ¥å…è®¸æºè‡ªå±€åŸŸç½‘çš„æ•°æ®åŒ…åœ¨å†…éƒ¨ç½‘ç»œä¹‹é—´æˆ–è¿æ¥åˆ°äº’è”ç½‘çš„æ¥å£ä¹‹é—´æµåŠ¨ã€‚è§„åˆ™é›†åº”è¯¥åˆ†ä¸ºä¸‰ä¸ªä¸»è¦éƒ¨åˆ†ï¼šä»»ä½•å—ä¿¡ä»»çš„å†…éƒ¨æ¥å£ã€é€šè¿‡å…¬å…±æ¥å£çš„å‡ºç«™è¿æ¥å’Œé€šè¿‡å…¬å…±æ¥å£çš„å…¥ç«™è¿æ¥ã€‚ÙaThese two rules allow all traffic to pass through a trusted LAN interface named [.filename]#xl0#:Ùlè¿™ä¸¤æ¡è§„åˆ™å…è®¸æ‰€æœ‰æµé‡é€šè¿‡ä¸€ä¸ªåä¸º [.filename]#xl0# çš„å—ä¿¡ä»»çš„å±€åŸŸç½‘æ¥å£ä¼ è¾“ã€‚Ú The rules for the public interface's outbound and inbound sections should have the most frequently matched rules placed before less commonly matched rules, with the last rule in the section blocking and logging all packets for that interface and direction.ÙÌå…¬å…±æ¥å£çš„å‡ºç«™å’Œå…¥ç«™éƒ¨åˆ†çš„è§„åˆ™åº”è¯¥å°†æœ€å¸¸åŒ¹é…çš„è§„åˆ™æ”¾åœ¨ä¸å¸¸åŒ¹é…çš„è§„åˆ™ä¹‹å‰ï¼Œè€Œè¯¥éƒ¨åˆ†çš„æœ€åä¸€æ¡è§„åˆ™åº”è¯¥é˜»æ­¢å¹¶è®°å½•è¯¥æ¥å£å’Œæ–¹å‘çš„æ‰€æœ‰æ•°æ®åŒ…ã€‚ÚLThis set of rules defines the outbound section of the public interface named [.filename]#dc0#.  These rules keep state and identify the specific services that internal systems are authorized for public Internet access.  All the rules use `quick` and specify the appropriate port numbers and, where applicable, destination addresses.Úè¿™ç»„è§„åˆ™å®šä¹‰äº†åä¸º [.filename]#dc0# çš„å…¬å…±æ¥å£çš„å‡ºç«™éƒ¨åˆ†ã€‚è¿™äº›è§„åˆ™ä¿æŒçŠ¶æ€å¹¶æ ‡è¯†å†…éƒ¨ç³»ç»Ÿè¢«æˆæƒç”¨äºå…¬å…±äº’è”ç½‘è®¿é—®çš„ç‰¹å®šæœåŠ¡ã€‚æ‰€æœ‰è§„åˆ™éƒ½ä½¿ç”¨ `quick` å¹¶æŒ‡å®šé€‚å½“çš„ç«¯å£å·å’Œï¼ˆå¦‚æœé€‚ç”¨ï¼‰ç›®æ ‡åœ°å€ã€‚Ù´This example of the rules in the inbound section of the public interface blocks all undesirable packets first.  This reduces the number of packets that are logged by the last rule.Ùå…¬å…±æ¥å£å…¥ç«™éƒ¨åˆ†çš„è§„åˆ™ç¤ºä¾‹é¦–å…ˆé˜»æ­¢æ‰€æœ‰ä¸éœ€è¦çš„æ•°æ®åŒ…ã€‚è¿™æ ·å¯ä»¥å‡å°‘æœ€åä¸€ä¸ªè§„åˆ™è®°å½•çš„æ•°æ®åŒ…æ•°é‡ã€‚ÙÛAny time there are logged messages on a rule with the `log first` option, run `ipfstat -hio` to evaluate how many times the rule has been matched.  A large number of matches may indicate that the system is under attack.Ù³æ¯å½“è§„åˆ™ä¸Šæœ‰å¸¦æœ‰ `log first` é€‰é¡¹çš„æ—¥å¿—æ¶ˆæ¯æ—¶ï¼Œè¿è¡Œ `ipfstat -hio` æ¥è¯„ä¼°è¯¥è§„åˆ™è¢«åŒ¹é…çš„æ¬¡æ•°ã€‚å¤§é‡çš„åŒ¹é…å¯èƒ½è¡¨æ˜ç³»ç»Ÿæ­£åœ¨é­å—æ”»å‡»ã€‚ÙßThe rest of the rules in the inbound section define which connections are allowed to be initiated from the Internet.  The last rule denies all connections which were not explicitly allowed by previous rules in this section.Ùå…¥ç«™éƒ¨åˆ†çš„å…¶ä½™è§„åˆ™å®šä¹‰äº†å…è®¸ä»äº’è”ç½‘å‘èµ·çš„è¿æ¥ã€‚æœ€åä¸€æ¡è§„åˆ™æ‹’ç»äº†æ‰€æœ‰æœªåœ¨æœ¬èŠ‚ä¸­æ˜ç¡®å…è®¸çš„è¿æ¥ã€‚¯Configuring NATªé…ç½® NATÙ{To enable NAT, add these statements to [.filename]#/etc/rc.conf# and specify the name of the file containing the NAT rules:Ùè¦å¯ç”¨ NATï¼Œè¯·å°†ä»¥ä¸‹è¯­å¥æ·»åŠ åˆ° [.filename]#/etc/rc.conf# æ–‡ä»¶ä¸­ï¼Œå¹¶æŒ‡å®šåŒ…å« NAT è§„åˆ™çš„æ–‡ä»¶çš„åç§°ï¼šÚNAT rules are flexible and can accomplish many different things to fit the needs of both commercial and home users.  The rule syntax presented here has been simplified to demonstrate common usage.  For a complete rule syntax description, refer to man:ipnat[5].ÙæNAT è§„åˆ™æ˜¯çµæ´»çš„ï¼Œå¯ä»¥å®ç°è®¸å¤šä¸åŒçš„åŠŸèƒ½ï¼Œä»¥æ»¡è¶³å•†ä¸šå’Œå®¶åº­ç”¨æˆ·çš„éœ€æ±‚ã€‚è¿™é‡Œä»‹ç»çš„è§„åˆ™è¯­æ³•å·²ç»ç®€åŒ–ï¼Œä»¥å±•ç¤ºå¸¸è§ç”¨æ³•ã€‚æœ‰å…³å®Œæ•´çš„è§„åˆ™è¯­æ³•æè¿°ï¼Œè¯·å‚è€ƒ man:ipnat[5]ã€‚ÙThe basic syntax for a NAT rule is as follows, where `map` starts the rule and _IF_ should be replaced with the name of the external interface:ÙsNAT è§„åˆ™çš„åŸºæœ¬è¯­æ³•å¦‚ä¸‹æ‰€ç¤ºï¼Œå…¶ä¸­ `map` æ˜¯è§„åˆ™çš„å¼€å§‹ï¼Œ_IF_ åº”æ›¿æ¢ä¸ºå¤–éƒ¨æ¥å£çš„åç§°ï¼šÚThe _LAN_IP_RANGE_ is the range of IP addresses used by internal clients.  Usually, it is a private address range such as `192.168.1.0/24`.  The _PUBLIC_ADDRESS_ can either be the static external IP address or the keyword `0/32` which represents the IP address assigned to _IF_.Ú_LAN_IP_RANGE_ æ˜¯å†…éƒ¨å®¢æˆ·ç«¯ä½¿ç”¨çš„ IP åœ°å€èŒƒå›´ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œå®ƒæ˜¯ä¸€ä¸ªç§æœ‰åœ°å€èŒƒå›´ï¼Œæ¯”å¦‚ `192.168.1.0/24` ã€‚_PUBLIC_ADDRESS_ å¯ä»¥æ˜¯é™æ€å¤–éƒ¨ IP åœ°å€ï¼Œä¹Ÿå¯ä»¥æ˜¯å…³é”®å­— `0/32`ï¼Œè¡¨ç¤ºåˆ†é…ç»™ _IF_ çš„ IP åœ°å€ã€‚ÚpIn IPF, when a packet arrives at the firewall from the LAN with a public destination, it first passes through the outbound rules of the firewall ruleset.  Then, the packet is passed to the NAT ruleset which is read from the top down, where the first matching rule wins.  IPF tests each NAT rule against the packet's interface name and source IP address.  When a packet's interface name matches a NAT rule, the packet's source IP address in the private LAN is checked to see if it falls within the IP address range specified in _LAN_IP_RANGE_.  On a match, the packet has its source IP address rewritten with the public IP address specified by _PUBLIC_ADDRESS_.  IPF posts an entry in its internal NAT table so that when the packet returns from the Internet, it can be mapped back to its original private IP address before being passed to the firewall rules for further processing.Ú1åœ¨ IPF ä¸­ï¼Œå½“ä¸€ä¸ªæ•°æ®åŒ…ä»å±€åŸŸç½‘å¸¦æœ‰å…¬å…±ç›®çš„åœ°åˆ°è¾¾é˜²ç«å¢™æ—¶ï¼Œå®ƒé¦–å…ˆé€šè¿‡é˜²ç«å¢™è§„åˆ™é›†çš„å‡ºç«™è§„åˆ™ã€‚ç„¶åï¼Œæ•°æ®åŒ…è¢«ä¼ é€’åˆ° NAT è§„åˆ™é›†ï¼Œè¯¥è§„åˆ™é›†ä»ä¸Šåˆ°ä¸‹è¿›è¡Œè¯»å–ï¼Œç¬¬ä¸€ä¸ªåŒ¹é…çš„è§„åˆ™è·èƒœã€‚IPF ä¼šå°†æ¯ä¸ª NAT è§„åˆ™ä¸æ•°æ®åŒ…çš„æ¥å£åç§°å’Œæº IP åœ°å€è¿›è¡Œæµ‹è¯•ã€‚å½“æ•°æ®åŒ…çš„æ¥å£åç§°ä¸ NAT è§„åˆ™åŒ¹é…æ—¶ï¼Œå°†æ£€æŸ¥æ•°æ®åŒ…åœ¨ç§æœ‰å±€åŸŸç½‘ä¸­çš„æº IP åœ°å€æ˜¯å¦è½åœ¨ _LAN_IP_RANGE_ æŒ‡å®šçš„ IP åœ°å€èŒƒå›´å†…ã€‚å¦‚æœåŒ¹é…æˆåŠŸï¼Œæ•°æ®åŒ…çš„æº IP åœ°å€å°†è¢«é‡å†™ä¸º _PUBLIC_ADDRESS_ æŒ‡å®šçš„å…¬å…± IP åœ°å€ã€‚IPF ä¼šåœ¨å…¶å†…éƒ¨ NAT è¡¨ä¸­å‘å¸ƒä¸€ä¸ªæ¡ç›®ï¼Œä»¥ä¾¿å½“æ•°æ®åŒ…ä»äº’è”ç½‘è¿”å›æ—¶ï¼Œå¯ä»¥å°†å…¶æ˜ å°„å›åŸå§‹çš„ç§æœ‰ IP åœ°å€ï¼Œç„¶åå°†å…¶ä¼ é€’ç»™é˜²ç«å¢™è§„åˆ™è¿›è¡Œè¿›ä¸€æ­¥å¤„ç†ã€‚ÙíFor networks that have large numbers of internal systems or multiple subnets, the process of funneling every private IP address into a single public IP address becomes a resource problem.  Two methods are available to relieve this issue.ÙËå¯¹äºæ‹¥æœ‰å¤§é‡å†…éƒ¨ç³»ç»Ÿæˆ–å¤šä¸ªå­ç½‘çš„ç½‘ç»œæ¥è¯´ï¼Œå°†æ¯ä¸ªç§æœ‰ IP åœ°å€æ±‡é›†åˆ°ä¸€ä¸ªå…¬å…± IP åœ°å€ä¸­çš„è¿‡ç¨‹ä¼šæˆä¸ºä¸€ä¸ªèµ„æºé—®é¢˜ã€‚æœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚Ù­The first method is to assign a range of ports to use as source ports.  By adding the `portmap` keyword, NAT can be directed to only use source ports in the specified range:Ù—ç¬¬ä¸€ç§æ–¹æ³•æ˜¯åˆ†é…ä¸€æ®µç«¯å£ä½œä¸ºæºç«¯å£ä½¿ç”¨ã€‚é€šè¿‡æ·»åŠ  `portmap` å…³é”®å­—ï¼Œå¯ä»¥æŒ‡ç¤º NAT ä»…ä½¿ç”¨æŒ‡å®šèŒƒå›´å†…çš„æºç«¯å£ã€‚ÙfAlternately, use the `auto` keyword which tells NAT to determine the ports that are available for use:ÙOæˆ–è€…ï¼Œä½¿ç”¨ `auto` å…³é”®å­—ï¼Œå‘Šè¯‰ NAT ç¡®å®šå¯ç”¨äºä½¿ç”¨çš„ç«¯å£ï¼šÚEThe second method is to use a pool of public addresses.  This is useful when there are too many LAN addresses to fit into a single public address and a block of public IP addresses is available.  These public addresses can be used as a pool from which NAT selects an IP address as a packet's address is mapped on its way out.Ú<ç¬¬äºŒç§æ–¹æ³•æ˜¯ä½¿ç”¨ä¸€ä¸ªå…¬å…±åœ°å€æ± ã€‚å½“å±€åŸŸç½‘åœ°å€å¤ªå¤šæ— æ³•é€‚åº”å•ä¸ªå…¬å…±åœ°å€ï¼Œå¹¶ä¸”æœ‰ä¸€å—å…¬å…± IP åœ°å€å¯ç”¨æ—¶ï¼Œè¿™ç§æ–¹æ³•éå¸¸æœ‰ç”¨ã€‚è¿™äº›å…¬å…±åœ°å€å¯ä»¥ä½œä¸ºä¸€ä¸ªæ± ï¼Œ NAT ä¼šä»ä¸­é€‰æ‹©ä¸€ä¸ª IP åœ°å€ï¼Œå°†æ•°æ®åŒ…çš„åœ°å€æ˜ å°„ä¸ºå…¶å¤–éƒ¨ä¼ è¾“æ—¶çš„åœ°å€ã€‚ÙtThe range of public IP addresses can be specified using a netmask or CIDR notation.  These two rules are equivalent:Ùmå…¬å…± IP åœ°å€çš„èŒƒå›´å¯ä»¥ä½¿ç”¨ç½‘ç»œæ©ç æˆ– CIDR è¡¨ç¤ºæ³•æ¥æŒ‡å®šã€‚è¿™ä¸¤ä¸ªè§„åˆ™æ˜¯ç­‰ä»·çš„ï¼šÚ†A common practice is to have a publically accessible web server or mail server segregated to an internal network segment.  The traffic from these servers still has to undergo NAT, but port redirection is needed to direct inbound traffic to the correct server.  For example, to map a web server using the internal address `10.0.10.25` to its public IP address of `20.20.20.5`, use this rule:Úcå¸¸è§åšæ³•æ˜¯å°†å…¬å…±å¯è®¿é—®çš„ Web æœåŠ¡å™¨æˆ–é‚®ä»¶æœåŠ¡å™¨éš”ç¦»åˆ°å†…éƒ¨ç½‘ç»œæ®µã€‚è¿™äº›æœåŠ¡å™¨çš„æµé‡ä»ç„¶éœ€è¦ç»è¿‡ NAT ï¼Œä½†éœ€è¦è¿›è¡Œç«¯å£é‡å®šå‘ä»¥å°†å…¥ç«™æµé‡å®šå‘åˆ°æ­£ç¡®çš„æœåŠ¡å™¨ã€‚ä¾‹å¦‚ï¼Œè¦å°†ä½¿ç”¨å†…éƒ¨åœ°å€ `10.0.10.25` çš„ Web æœåŠ¡å™¨æ˜ å°„åˆ°å…¶å…¬å…± IP åœ°å€ `20.20.20.5`ï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹è§„åˆ™ï¼šÙsIf it is the only web server, this rule would also work as it redirects all external HTTP requests to `10.0.10.25`:Ù‡å¦‚æœå®ƒæ˜¯å”¯ä¸€çš„ Web æœåŠ¡å™¨ï¼Œè¿™ä¸ªè§„åˆ™ä¹Ÿä¼šèµ·ä½œç”¨ï¼Œå› ä¸ºå®ƒä¼šå°†æ‰€æœ‰å¤–éƒ¨ HTTP è¯·æ±‚é‡å®šå‘åˆ° `10.0.10.25`ã€‚ÚHIPF has a built in FTP proxy which can be used with NAT.  It monitors all outbound traffic for active or passive FTP connection requests and dynamically creates temporary filter rules containing the port number used by the FTP data channel.  This eliminates the need to open large ranges of high order ports for FTP connections.Ú(IPF å†…ç½®äº†ä¸€ä¸ªå¯ä»¥ä¸ NAT ä¸€èµ·ä½¿ç”¨çš„ FTP ä»£ç†ã€‚å®ƒç›‘è§†æ‰€æœ‰å‡ºç«™æµé‡ï¼Œä»¥æ£€æµ‹ä¸»åŠ¨æˆ–è¢«åŠ¨çš„ FTP è¿æ¥è¯·æ±‚ï¼Œå¹¶åŠ¨æ€åˆ›å»ºä¸´æ—¶è¿‡æ»¤è§„åˆ™ï¼Œå…¶ä¸­åŒ…å« FTP æ•°æ®é€šé“ä½¿ç”¨çš„ç«¯å£å·ã€‚è¿™æ ·å°±ä¸éœ€è¦æ‰“å¼€å¤§èŒƒå›´çš„é«˜é˜¶ç«¯å£æ¥è¿›è¡Œ FTP è¿æ¥ã€‚ÙğIn this example, the first rule calls the proxy for outbound FTP traffic from the internal LAN.  The second rule passes the FTP traffic from the firewall to the Internet, and the third rule handles all non-FTP traffic from the internal LAN:ÙÛåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œç¬¬ä¸€æ¡è§„åˆ™è°ƒç”¨ä»£ç†æ¥å¤„ç†å†…éƒ¨å±€åŸŸç½‘çš„å‡ºç«™ FTP æµé‡ã€‚ç¬¬äºŒæ¡è§„åˆ™å°† FTP æµé‡ä»é˜²ç«å¢™ä¼ é€’åˆ°äº’è”ç½‘ï¼Œç¬¬ä¸‰æ¡è§„åˆ™å¤„ç†å†…éƒ¨å±€åŸŸç½‘çš„æ‰€æœ‰é FTP æµé‡ã€‚Ú)The FTP `map` rules go before the NAT rule so that when a packet matches an FTP rule, the FTP proxy creates temporary filter rules to let the FTP session packets pass and undergo NAT.  All LAN packets that are not FTP will not match the FTP rules but will undergo NAT if they match the third rule.ÚFTP çš„ `map` è§„åˆ™åœ¨ NAT è§„åˆ™ä¹‹å‰ï¼Œè¿™æ ·å½“ä¸€ä¸ªæ•°æ®åŒ…åŒ¹é…åˆ° FTP è§„åˆ™æ—¶ï¼Œ FTP ä»£ç†ä¼šåˆ›å»ºä¸´æ—¶è¿‡æ»¤è§„åˆ™ï¼Œä»¥ä¾¿è®© FTP ä¼šè¯æ•°æ®åŒ…é€šè¿‡å¹¶è¿›è¡Œ NATã€‚æ‰€æœ‰ä¸æ˜¯ FTP çš„å±€åŸŸç½‘æ•°æ®åŒ…å¦‚æœåŒ¹é…åˆ°ç¬¬ä¸‰æ¡è§„åˆ™ï¼Œä¹Ÿä¼šè¿›è¡Œ NAT å¤„ç†ã€‚Ù•Without the FTP proxy, the following firewall rules would instead be needed.  Note that without the proxy, all ports above `1024` need to be allowed:Ùˆå¦‚æœæ²¡æœ‰ FTP ä»£ç†ï¼Œå°†éœ€è¦ä»¥ä¸‹é˜²ç«å¢™è§„åˆ™ã€‚è¯·æ³¨æ„ï¼Œå¦‚æœæ²¡æœ‰ä»£ç†ï¼Œéœ€è¦å…è®¸æ‰€æœ‰å¤§äº `1024` çš„ç«¯å£ï¼šÙäWhenever the file containing the NAT rules is edited, run `ipnat` with `-CF` to delete the current NAT rules and flush the contents of the dynamic translation table.  Include `-f` and specify the name of the NAT ruleset to load:Ùåæ¯å½“ç¼–è¾‘åŒ…å« NAT è§„åˆ™çš„æ–‡ä»¶æ—¶ï¼Œè¿è¡Œ `ipnat` å‘½ä»¤å¹¶ä½¿ç”¨ `-CF` é€‰é¡¹æ¥åˆ é™¤å½“å‰çš„ NAT è§„åˆ™ï¼Œå¹¶æ¸…ç©ºåŠ¨æ€è½¬æ¢è¡¨çš„å†…å®¹ã€‚åŒæ—¶ï¼Œä½¿ç”¨ `-f` é€‰é¡¹å¹¶æŒ‡å®šè¦åŠ è½½çš„ NAT è§„åˆ™é›†çš„åç§°ã€‚¾To display the NAT statistics:ºæ˜¾ç¤º NAT ç»Ÿè®¡ä¿¡æ¯ï¼šÙ)To list the NAT table's current mappings:Ù#è¦åˆ—å‡º NAT è¡¨çš„å½“å‰æ˜ å°„ï¼šÙoTo turn verbose mode on and display information relating to rule processing and active rules and table entries:ÙWè¦æ‰“å¼€è¯¦ç»†æ¨¡å¼å¹¶æ˜¾ç¤ºä¸è§„åˆ™å¤„ç†ã€æ´»åŠ¨è§„åˆ™å’Œè¡¨é¡¹ç›¸å…³çš„ä¿¡æ¯ï¼š¶Viewing IPF Statistics·æŸ¥çœ‹ IPF ç»Ÿè®¡ä¿¡æ¯ÚIPF includes man:ipfstat[8] which can be used to retrieve and display statistics which are gathered as packets match rules as they go through the firewall.  Statistics are accumulated since the firewall was last started or since the last time they were reset to zero using `ipf -Z`.ÙøIPF åŒ…æ‹¬ man:ipfstat[8]ï¼Œå¯ç”¨äºæ£€ç´¢å’Œæ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯ï¼Œè¿™äº›ç»Ÿè®¡ä¿¡æ¯æ˜¯åœ¨æ•°æ®åŒ…é€šè¿‡é˜²ç«å¢™æ—¶åŒ¹é…è§„åˆ™æ—¶æ”¶é›†çš„ã€‚ç»Ÿè®¡ä¿¡æ¯ä»ä¸Šæ¬¡å¯åŠ¨é˜²ç«å¢™æˆ–ä½¿ç”¨ `ipf -Z` å°†å…¶é‡ç½®ä¸ºé›¶çš„ä¸Šæ¬¡é‡ç½®ä»¥æ¥ç´¯ç§¯ã€‚Ù-The default `ipfstat` output looks like this:Ù)é»˜è®¤çš„ `ipfstat` è¾“å‡ºå¦‚ä¸‹æ‰€ç¤ºï¼šÚWSeveral options are available.  When supplied with either `-i` for inbound or `-o` for outbound, the command will retrieve and display the appropriate list of filter rules currently installed and in use by the kernel.  To also see the rule numbers, include `-n`.  For example, `ipfstat -on` displays the outbound rules table with rule numbers:ÚRæœ‰å‡ ä¸ªé€‰é¡¹å¯ä¾›é€‰æ‹©ã€‚å½“ä½¿ç”¨ `-i` å‚æ•°è¡¨ç¤ºå…¥ç«™è§„åˆ™ï¼Œæˆ–ä½¿ç”¨ `-o` å‚æ•°è¡¨ç¤ºå‡ºç«™è§„åˆ™æ—¶ï¼Œè¯¥å‘½ä»¤å°†æ£€ç´¢å¹¶æ˜¾ç¤ºå†…æ ¸å½“å‰å®‰è£…å’Œä½¿ç”¨çš„ç›¸åº”è¿‡æ»¤è§„åˆ™åˆ—è¡¨ã€‚å¦‚æœæƒ³è¦åŒæ—¶çœ‹åˆ°è§„åˆ™ç¼–å·ï¼Œå¯ä»¥åŠ ä¸Š `-n` å‚æ•°ã€‚ä¾‹å¦‚ï¼Œ`ipfstat -on` å°†æ˜¾ç¤ºå¸¦æœ‰è§„åˆ™ç¼–å·çš„å‡ºç«™è§„åˆ™è¡¨ï¼šÙÇInclude `-h` to prefix each rule with a count of how many times the rule was matched.  For example, `ipfstat -oh` displays the outbound internal rules table, prefixing each rule with its usage count:Ù­åœ¨æ¯ä¸ªè§„åˆ™å‰åŠ ä¸ŠåŒ¹é…æ¬¡æ•°çš„è®¡æ•°ï¼Œè¯·ä½¿ç”¨ `-h` é€‰é¡¹ã€‚ä¾‹å¦‚ï¼Œ`ipfstat -oh` æ˜¾ç¤ºå‡ºç«™å†…éƒ¨è§„åˆ™è¡¨ï¼Œæ¯ä¸ªè§„åˆ™å‰éƒ½æœ‰å®ƒçš„ä½¿ç”¨æ¬¡æ•°è®¡æ•°ã€‚ÚfTo display the state table in a format similar to man:top[1], use `ipfstat -t`.  When the firewall is under attack, this option provides the ability to identify and see the attacking packets.  The optional sub-flags give the ability to select the destination or source IP, port, or protocol to be monitored in real time.  Refer to man:ipfstat[8] for details.Ú(è¦ä»¥ç±»ä¼¼äº man:top[1] çš„æ ¼å¼æ˜¾ç¤ºçŠ¶æ€è¡¨ï¼Œè¯·ä½¿ç”¨ `ipfstat -t` å‘½ä»¤ã€‚å½“é˜²ç«å¢™é­å—æ”»å‡»æ—¶ï¼Œæ­¤é€‰é¡¹å¯ä»¥è¯†åˆ«å’ŒæŸ¥çœ‹æ”»å‡»æ•°æ®åŒ…ã€‚å¯é€‰çš„å­æ ‡å¿—æä¾›äº†å®æ—¶ç›‘æ§ç›®æ ‡æˆ–æº IPã€ç«¯å£æˆ–åè®®çš„èƒ½åŠ›ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… man:ipfstat[8]ã€‚«IPF Logging°IPF æ—¥å¿—è®°å½•ÚIPF provides `ipmon`, which can be used to write the firewall's logging information in a human readable format.  It requires that `options IPFILTER_LOG` be first added to a custom kernel using the instructions in crossref:kernelconfig[kernelconfig,Configuring the FreeBSD Kernel].ÚIPF æä¾›äº† `ipmon` å·¥å…·ï¼Œå¯ä»¥å°†é˜²ç«å¢™çš„æ—¥å¿—ä¿¡æ¯ä»¥äººç±»å¯è¯»çš„æ ¼å¼å†™å…¥ã€‚ä½¿ç”¨è¯¥å·¥å…·éœ€è¦é¦–å…ˆæŒ‰ç…§ crossref:kernelconfig[kernelconfig,é…ç½® FreeBSD å†…æ ¸] ä¸­çš„è¯´æ˜ï¼Œåœ¨è‡ªå®šä¹‰å†…æ ¸ä¸­æ·»åŠ  `options IPFILTER_LOG` é€‰é¡¹ã€‚Ú-This command is typically run in daemon mode in order to provide a continuous system log file so that logging of past events may be reviewed.  Since FreeBSD has a built in man:syslogd[8] facility to automatically rotate system logs, the default [.filename]#rc.conf# `ipmon_flags` statement uses `-Ds`:Úè¯¥å‘½ä»¤é€šå¸¸ä»¥å®ˆæŠ¤è¿›ç¨‹æ¨¡å¼è¿è¡Œï¼Œä»¥æä¾›è¿ç»­çš„ç³»ç»Ÿæ—¥å¿—æ–‡ä»¶ï¼Œä»¥ä¾¿å¯ä»¥å›é¡¾è¿‡å»äº‹ä»¶çš„è®°å½•ã€‚ç”±äº FreeBSD å†…ç½®äº† man:syslogd[8] è®¾æ–½æ¥è‡ªåŠ¨è½®è½¬ç³»ç»Ÿæ—¥å¿—ï¼Œå› æ­¤é»˜è®¤çš„ [.filename]#rc.conf# `ipmon_flags` è¯­å¥ä½¿ç”¨äº† `-Ds` é€‰é¡¹ã€‚ÙÙLogging provides the ability to review, after the fact, information such as which packets were dropped, what addresses they came from, and where they were going.  This information is useful in tracking down attackers.ÙÒæ—¥å¿—è®°å½•æä¾›äº†äº‹åå®¡æŸ¥çš„èƒ½åŠ›ï¼Œå¯ä»¥æŸ¥çœ‹è¯¸å¦‚å“ªäº›æ•°æ®åŒ…è¢«ä¸¢å¼ƒã€å®ƒä»¬æ¥è‡ªå“ªäº›åœ°å€ä»¥åŠå®ƒä»¬çš„ç›®çš„åœ°æ˜¯ä»€ä¹ˆç­‰ä¿¡æ¯ã€‚è¿™äº›ä¿¡æ¯åœ¨è¿½è¸ªæ”»å‡»è€…æ–¹é¢éå¸¸æœ‰ç”¨ã€‚ÚÌOnce the logging facility is enabled in [.filename]#rc.conf# and started with `service ipmon start`, IPF will only log the rules which contain the `log` keyword.  The firewall administrator decides which rules in the ruleset should be logged and normally only deny rules are logged.  It is customary to include the `log` keyword in the last rule in the ruleset.  This makes it possible to see all the packets that did not match any of the rules in the ruleset.Úä¸€æ—¦åœ¨ [.filename]#rc.conf# ä¸­å¯ç”¨äº†æ—¥å¿—è®°å½•åŠŸèƒ½ï¼Œå¹¶ä½¿ç”¨ `service ipmon start` å¯åŠ¨åï¼ŒIPF å°†åªè®°å½•åŒ…å« `log` å…³é”®å­—çš„è§„åˆ™ã€‚é˜²ç«å¢™ç®¡ç†å‘˜å†³å®šå“ªäº›è§„åˆ™åº”è¯¥è¢«è®°å½•ï¼Œé€šå¸¸åªæœ‰æ‹’ç»è§„åˆ™ä¼šè¢«è®°å½•ã€‚ä¹ æƒ¯ä¸Šï¼Œåœ¨è§„åˆ™é›†ä¸­çš„æœ€åä¸€ä¸ªè§„åˆ™ä¸­åŒ…å« `log` å…³é”®å­—ã€‚è¿™æ ·å¯ä»¥æŸ¥çœ‹æ‰€æœ‰æœªåŒ¹é…è§„åˆ™é›†ä¸­ä»»ä½•è§„åˆ™çš„æ•°æ®åŒ…ã€‚Ù“By default, `ipmon -Ds` mode uses `local0` as the logging facility.  The following logging levels can be used to further segregate the logged data:Ù…é»˜è®¤æƒ…å†µä¸‹ï¼Œ`ipmon -Ds` æ¨¡å¼ä½¿ç”¨ `local0` ä½œä¸ºæ—¥å¿—è®¾å¤‡ã€‚ä»¥ä¸‹æ—¥å¿—çº§åˆ«å¯ç”¨äºè¿›ä¸€æ­¥åˆ†ç¦»è®°å½•çš„æ•°æ®ï¼šÙiIn order to setup IPF to log all data to [.filename]#/var/log/ipfilter.log#, first create the empty file:Ù}ä¸ºäº†å°† IPF è®¾ç½®ä¸ºå°†æ‰€æœ‰æ•°æ®è®°å½•åˆ° [.filename]#/var/log/ipfilter.log# æ–‡ä»¶ä¸­ï¼Œé¦–å…ˆåˆ›å»ºä¸€ä¸ªç©ºæ–‡ä»¶ï¼šÙwThen, to write all logged messages to the specified file, add the following statement to [.filename]#/etc/syslog.conf#:Ù‚ç„¶åï¼Œè¦å°†æ‰€æœ‰è®°å½•çš„æ¶ˆæ¯å†™å…¥æŒ‡å®šçš„æ–‡ä»¶ï¼Œè¯·å°†ä»¥ä¸‹è¯­å¥æ·»åŠ åˆ° [.filename]#/etc/syslog.conf# æ–‡ä»¶ä¸­ï¼šÙ…To activate the changes and instruct man:syslogd[8] to read the modified [.filename]#/etc/syslog.conf#, run `service syslogd reload`.Ù€è¦æ¿€æ´»æ›´æ”¹å¹¶æŒ‡ç¤º man:syslogd[8] è¯»å–ä¿®æ”¹åçš„ [.filename]#/etc/syslog.conf#ï¼Œè¯·è¿è¡Œ `service syslogd reload`ã€‚ÙRDo not forget to edit [.filename]#/etc/newsyslog.conf# to rotate the new log file.ÙRä¸è¦å¿˜è®°ç¼–è¾‘ [.filename]#/etc/newsyslog.conf# æ¥è½®è½¬æ–°çš„æ—¥å¿—æ–‡ä»¶ã€‚ÙrMessages generated by `ipmon` consist of data fields separated by white space.  Fields common to all messages are:Ùk`ipmon` ç”Ÿæˆçš„æ¶ˆæ¯ç”±ä»¥ç©ºæ ¼åˆ†éš”çš„æ•°æ®å­—æ®µç»„æˆã€‚æ‰€æœ‰æ¶ˆæ¯éƒ½åŒ…å«ä»¥ä¸‹å…±åŒå­—æ®µï¼š»The date of packet receipt.¸æ•°æ®åŒ…æ¥æ”¶æ—¥æœŸã€‚ÙsThe time of packet receipt. This is in the form HH:MM:SS.F, for hours, minutes, seconds, and fractions of a second.Ùbæ•°æ®åŒ…æ¥æ”¶æ—¶é—´ã€‚æ ¼å¼ä¸º HH:MM:SS.Fï¼Œè¡¨ç¤ºå°æ—¶ã€åˆ†é’Ÿã€ç§’å’Œç§’çš„å°æ•°éƒ¨åˆ†ã€‚Ù4The name of the interface that processed the packet.Ù!å¤„ç†æ•°æ®åŒ…çš„æ¥å£åç§°ã€‚Ù<The group and rule number of the rule in the format `@0:17`.Ù2è§„åˆ™çš„ç»„å’Œè§„åˆ™ç¼–å·çš„æ ¼å¼ä¸º `@0:17`ã€‚ÙyThe action: `p` for passed, `b` for blocked, `S` for a short packet, `n` did not match any rules, and `L` for a log rule.ÙƒåŠ¨ä½œï¼š`p` è¡¨ç¤ºé€šè¿‡ï¼Œ`b` è¡¨ç¤ºé˜»æ­¢ï¼Œ`S` è¡¨ç¤ºçŸ­æ•°æ®åŒ…ï¼Œ`n` è¡¨ç¤ºæœªåŒ¹é…ä»»ä½•è§„åˆ™ï¼Œ`L` è¡¨ç¤ºæ—¥å¿—è§„åˆ™ã€‚ÙÃThe addresses written as three fields: the source address and port separated by a comma, the -> symbol, and the destination address and port. For example: `209.53.17.22,80 -> 198.73.220.17,1722`.Ùåœ°å€å†™ä½œä¸‰ä¸ªå­—æ®µï¼šæºåœ°å€å’Œç«¯å£ç”±é€—å·åˆ†éš”ï¼Œ-> ç¬¦å·ï¼Œä»¥åŠç›®æ ‡åœ°å€å’Œç«¯å£ã€‚ä¾‹å¦‚ï¼š `209.53.17.22,80 -> 198.73.220.17,1722`ã€‚ÙD`PR` followed by the protocol name or number: for example, `PR tcp`.Ù:ä»¥åè®®åç§°æˆ–ç¼–å·åè·Ÿ `PR`ï¼šä¾‹å¦‚ï¼Œ`PR tcp`ã€‚Ù]`len` followed by the header length and total length of the packet: for example, `len 20 40`.ÙP`len` åé¢è·Ÿç€æ•°æ®åŒ…çš„å¤´éƒ¨é•¿åº¦å’Œæ€»é•¿åº¦ï¼šä¾‹å¦‚ï¼Œ`len 20 40`ã€‚ÙÑIf the packet is a TCP packet, there will be an additional field starting with a hyphen followed by letters corresponding to any flags that were set.  Refer to man:ipf[5] for a list of letters and their flags.ÙÎå¦‚æœæ•°æ®åŒ…æ˜¯ TCP æ•°æ®åŒ…ï¼Œåˆ™ä¼šæœ‰ä¸€ä¸ªé¢å¤–çš„å­—æ®µï¼Œä»¥è¿å­—ç¬¦å¼€å¤´ï¼Œåé¢è·Ÿç€å¯¹åº”äºè®¾ç½®çš„ä»»ä½•æ ‡å¿—çš„å­—æ¯ã€‚è¯·å‚è€ƒ man:ipf[5] ä»¥è·å–å­—æ¯å’Œå®ƒä»¬çš„æ ‡å¿—åˆ—è¡¨ã€‚ÙìIf the packet is an ICMP packet, there will be two fields at the end: the first always being "icmp" and the next being the ICMP message and sub-message type, separated by a slash.  For example: `icmp 3/3` for a port unreachable message.Úå¦‚æœæ•°æ®åŒ…æ˜¯ä¸€ä¸ª ICMP æ•°æ®åŒ…ï¼Œé‚£ä¹ˆåœ¨æœ«å°¾å°†ä¼šæœ‰ä¸¤ä¸ªå­—æ®µï¼šç¬¬ä¸€ä¸ªå­—æ®µå§‹ç»ˆæ˜¯â€œicmpâ€ï¼Œä¸‹ä¸€ä¸ªå­—æ®µæ˜¯ ICMP æ¶ˆæ¯å’Œå­æ¶ˆæ¯ç±»å‹ï¼Œç”¨æ–œæ åˆ†éš”ã€‚ä¾‹å¦‚ï¼šå¯¹äºä¸€ä¸ªç«¯å£ä¸å¯è¾¾çš„æ¶ˆæ¯ï¼Œè¡¨ç¤ºä¸º `icmp 3/3`ã€‚ªBlacklistd¯é»‘åå•æœåŠ¡ÚBlacklistd is a daemon listening to sockets awaiting to receive notifications from other daemons about connection attempts that failed or were successful.  It is most widely used in blocking too many connection attempts on open ports.  A prime example is SSH running on the internet getting a lot of requests from bots or scripts trying to guess passwords and gain access.  Using blacklistd, the daemon can notify the firewall to create a filter rule to block excessive connection attempts from a single source after a number of tries. Blacklistd was first developed on NetBSD and appeared there in version 7.  FreeBSD 11 imported blacklistd from NetBSD.ÚLBlacklistd æ˜¯ä¸€ä¸ªå®ˆæŠ¤è¿›ç¨‹ï¼Œç›‘å¬å¥—æ¥å­—ä»¥æ¥æ”¶æ¥è‡ªå…¶ä»–å®ˆæŠ¤è¿›ç¨‹çš„æœ‰å…³è¿æ¥å°è¯•å¤±è´¥æˆ–æˆåŠŸçš„é€šçŸ¥ã€‚å®ƒæœ€å¸¸ç”¨äºé˜»æ­¢åœ¨å¼€æ”¾ç«¯å£ä¸Šè¿›è¡Œè¿‡å¤šçš„è¿æ¥å°è¯•ã€‚ä¸€ä¸ªå…¸å‹çš„ä¾‹å­æ˜¯åœ¨äº’è”ç½‘ä¸Šè¿è¡Œçš„ SSH æ”¶åˆ°å¤§é‡æ¥è‡ªæœºå™¨äººæˆ–è„šæœ¬çš„å¯†ç çŒœæµ‹å’Œå…¥ä¾µå°è¯•ã€‚ä½¿ç”¨ blacklistd ï¼Œå®ˆæŠ¤è¿›ç¨‹å¯ä»¥é€šçŸ¥é˜²ç«å¢™åœ¨å¤šæ¬¡å°è¯•ååˆ›å»ºä¸€ä¸ªè¿‡æ»¤è§„åˆ™ï¼Œä»¥é˜»æ­¢æ¥è‡ªå•ä¸ªæºçš„è¿‡å¤šè¿æ¥å°è¯•ã€‚ Blacklistd æœ€åˆåœ¨ NetBSD ä¸Šå¼€å‘ï¼Œå¹¶åœ¨ç‰ˆæœ¬ 7 ä¸­é¦–æ¬¡å‡ºç°ã€‚FreeBSD 11 ä» NetBSD å¯¼å…¥äº† blacklistdã€‚ÚKThis chapter describes how to set up blacklistd, configure it, and provides examples on how to use it.  Readers should be familiar with basic firewall concepts like rules.  For details, refer to the firewall chapter.  PF is used in the examples, but other firewalls available on FreeBSD should be able to work with blacklistd, too.Ú2æœ¬ç« ä»‹ç»äº†å¦‚ä½•è®¾ç½®å’Œé…ç½® blacklistd ï¼Œå¹¶æä¾›äº†å¦‚ä½•ä½¿ç”¨å®ƒçš„ç¤ºä¾‹ã€‚è¯»è€…åº”è¯¥ç†Ÿæ‚‰åŸºæœ¬çš„é˜²ç«å¢™æ¦‚å¿µï¼Œå¦‚è§„åˆ™ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…é˜²ç«å¢™ç« èŠ‚ã€‚ç¤ºä¾‹ä¸­ä½¿ç”¨äº† PFï¼Œä½†åœ¨ FreeBSD ä¸Šå¯ç”¨çš„å…¶ä»–é˜²ç«å¢™ä¹Ÿåº”è¯¥èƒ½å¤Ÿä¸ blacklistd ä¸€èµ·ä½¿ç”¨ã€‚³Enabling Blacklistd±å¯ç”¨ BlacklistdÚvThe main configuration for blacklistd is stored in man:blacklistd.conf[5].  Various command line options are also available to change blacklistd's run-time behavior.  Persistent configuration across reboots should be stored in [.filename]#/etc/blacklistd.conf#.  To enable the daemon during system boot, add a `blacklistd_enable` line to [.filename]#/etc/rc.conf# like this:ÚYblacklistd çš„ä¸»è¦é…ç½®å­˜å‚¨åœ¨ man:blacklistd.conf[5] ä¸­ã€‚è¿˜æœ‰ä¸€äº›å‘½ä»¤è¡Œé€‰é¡¹å¯ç”¨äºæ›´æ”¹ blacklistd çš„è¿è¡Œæ—¶è¡Œä¸ºã€‚é‡å¯åçš„æŒä¹…é…ç½®åº”å­˜å‚¨åœ¨ [.filename]#/etc/blacklistd.conf# ä¸­ã€‚è¦åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶å¯ç”¨å®ˆæŠ¤è¿›ç¨‹ï¼Œè¯·åœ¨ [.filename]#/etc/rc.conf# ä¸­æ·»åŠ ä¸€è¡Œ `blacklistd_enable`ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼šÙ0To start the service manually, run this command:Ù0è¦æ‰‹åŠ¨å¯åŠ¨æœåŠ¡ï¼Œè¯·è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š½Creating a Blacklistd RulesetÙ!åˆ›å»ºä¸€ä¸ª Blacklistd è§„åˆ™é›†ÚRules for blacklistd are configured in man:blacklistd.conf[5] with one entry per line.  Each rule contains a tuple separated by spaces or tabs.  Rules either belong to a `local` or a `remote`, which applies to the machine where blacklistd is running or an outside source, respectively.Ùğé»‘åå•è§„åˆ™åœ¨ man:blacklistd.conf[5] ä¸­é…ç½®ï¼Œæ¯è¡Œä¸€ä¸ªæ¡ç›®ã€‚æ¯ä¸ªè§„åˆ™åŒ…å«ä¸€ä¸ªç”±ç©ºæ ¼æˆ–åˆ¶è¡¨ç¬¦åˆ†éš”çš„å…ƒç»„ã€‚è§„åˆ™å¯ä»¥å±äº `local` æˆ– `remote`ï¼Œåˆ†åˆ«é€‚ç”¨äºè¿è¡Œ blacklistd çš„æœºå™¨æˆ–å¤–éƒ¨æ¥æºã€‚«Local Rules¬æœ¬åœ°è§„åˆ™ÙBAn example blacklistd.conf entry for a local rule looks like this:Ù;ä¸€ä¸ªæœ¬åœ°è§„åˆ™çš„ç¤ºä¾‹ blacklistd.conf æ¡ç›®å¦‚ä¸‹ï¼šÙæAll rules that follow the `[local]` section are treated as local rules (which is the default), applying to the local machine.  When a `[remote]` section is encountered, all rules that follow it are handled as remote machine rules.ÙËåœ¨ `[local]` éƒ¨åˆ†ä¹‹åçš„æ‰€æœ‰è§„åˆ™éƒ½è¢«è§†ä¸ºæœ¬åœ°è§„åˆ™ï¼ˆè¿™æ˜¯é»˜è®¤æƒ…å†µï¼‰ï¼Œé€‚ç”¨äºæœ¬åœ°æœºå™¨ã€‚å½“é‡åˆ° `[remote]` éƒ¨åˆ†æ—¶ï¼Œå…¶åçš„æ‰€æœ‰è§„åˆ™éƒ½è¢«è§†ä¸ºè¿œç¨‹æœºå™¨è§„åˆ™ã€‚Ú”Seven fields separated by either tabs or spaces define a rule.  The first four fields identify the traffic that should be blocklisted.  The three fields that follow define backlistd's behavior.  Wildcards are denoted as asterisks (`*`), matching anything in this field.  The first field defines the location.  In local rules, these are the network ports.  The syntax for the location field is as follows:Ú}è§„åˆ™ç”±ä¸ƒä¸ªå­—æ®µç»„æˆï¼Œå­—æ®µä¹‹é—´ç”¨åˆ¶è¡¨ç¬¦æˆ–ç©ºæ ¼åˆ†éš”ã€‚å‰å››ä¸ªå­—æ®µç”¨äºæ ‡è¯†åº”è¯¥è¢«åŠ å…¥é»‘åå•çš„æµé‡ã€‚æ¥ä¸‹æ¥çš„ä¸‰ä¸ªå­—æ®µå®šä¹‰äº†é»‘åå•çš„è¡Œä¸ºã€‚é€šé…ç¬¦ç”¨æ˜Ÿå·ï¼ˆ`*`ï¼‰è¡¨ç¤ºï¼Œå¯ä»¥åŒ¹é…è¯¥å­—æ®µä¸­çš„ä»»ä½•å†…å®¹ã€‚ç¬¬ä¸€ä¸ªå­—æ®µå®šä¹‰äº†ä½ç½®ï¼Œå¯¹äºæœ¬åœ°è§„åˆ™æ¥è¯´ï¼Œè¿™äº›æ˜¯ç½‘ç»œç«¯å£ã€‚ä½ç½®å­—æ®µçš„è¯­æ³•å¦‚ä¸‹ï¼šÙ‚Addresses can be specified as IPv4 in numeric format or IPv6 in square brackets.  An interface name like `_em0_` can also be used.Ù„åœ°å€å¯ä»¥ä»¥æ•°å­—æ ¼å¼æŒ‡å®šä¸º IPv4 ï¼Œä¹Ÿå¯ä»¥ä»¥æ–¹æ‹¬å·æŒ‡å®šä¸º IPv6 ã€‚è¿˜å¯ä»¥ä½¿ç”¨ç±»ä¼¼ `_em0_` çš„æ¥å£åç§°ã€‚Ù´The socket type is defined by the second field.  TCP sockets are of type `stream`, whereas UDP is denoted as `dgram`.  The example above uses TCP, since SSH is using that protocol.Ù®å¥—æ¥å­—ç±»å‹ç”±ç¬¬äºŒä¸ªå­—æ®µå®šä¹‰ã€‚TCP å¥—æ¥å­—çš„ç±»å‹æ˜¯ `stream`ï¼Œè€Œ UDP åˆ™è¡¨ç¤ºä¸º `dgram` ã€‚ä¸Šé¢çš„ç¤ºä¾‹ä½¿ç”¨ TCPï¼Œå› ä¸º SSH æ­£åœ¨ä½¿ç”¨è¯¥åè®®ã€‚Ú!A protocol can be used in the third field of a blacklistd rule.  The following protocols can be used: `tcp`, `udp`, `tcp6`, `udp6`, or numeric.  A wildcard, like in the example, is typically used to match all protocols unless there is a reason to distinguish traffic by a certain protocol.Ùõåè®®å¯ä»¥åœ¨ blacklistd è§„åˆ™çš„ç¬¬ä¸‰ä¸ªå­—æ®µä¸­ä½¿ç”¨ã€‚å¯ä»¥ä½¿ç”¨ä»¥ä¸‹åè®®ï¼š`tcp`ï¼Œ`udp`ï¼Œ`tcp6`ï¼Œ`udp6` æˆ–æ•°å­—ã€‚é€šå¸¸ä½¿ç”¨é€šé…ç¬¦ï¼ˆå¦‚ç¤ºä¾‹ä¸­ï¼‰æ¥åŒ¹é…æ‰€æœ‰åè®®ï¼Œé™¤éæœ‰ç†ç”±é€šè¿‡ç‰¹å®šåè®®åŒºåˆ†æµé‡ã€‚ÙÅIn the fourth field, the effective user or owner of the daemon process that is reporting the event is defined.  The username or UID can be used here, as well as a wildcard (see example rule above).Ù¿åœ¨ç¬¬å››ä¸ªå­—æ®µä¸­ï¼Œå®šä¹‰äº†æŠ¥å‘Šäº‹ä»¶çš„å®ˆæŠ¤è¿›ç¨‹çš„æœ‰æ•ˆç”¨æˆ·æˆ–æ‰€æœ‰è€…ã€‚å¯ä»¥åœ¨è¿™é‡Œä½¿ç”¨ç”¨æˆ·åæˆ– UID ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨é€šé…ç¬¦ï¼ˆå‚è§ä¸Šé¢çš„ç¤ºä¾‹è§„åˆ™ï¼‰ã€‚ÙØThe packet filter rule name is declared by the fifth field, which starts the behavior part of the rule.  By default, blacklistd puts all blocks under a pf anchor called `blacklistd` in [.filename]#pf.conf# like this:Ùğæ•°æ®åŒ…è¿‡æ»¤è§„åˆ™çš„åç§°ç”±ç¬¬äº”ä¸ªå­—æ®µå£°æ˜ï¼Œè¯¥å­—æ®µå¼€å§‹è§„åˆ™çš„è¡Œä¸ºéƒ¨åˆ†ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œblacklistd å°†æ‰€æœ‰é˜»æ­¢çš„æ•°æ®åŒ…æ”¾åœ¨åä¸º `blacklistd` çš„ pf é”šç‚¹ä¸‹ï¼Œå°±åƒè¿™æ ·åœ¨ [.filename]#pf.conf# ä¸­ï¼šÚ-For separate blocklists, an anchor name can be used in this field.  In other cases, the wildcard will suffice.  When a name starts with a hyphen (`-`) it means that an anchor with the default rule name prepended should be used.  A modified example from the above using the hyphen would look like this:Úå¯¹äºå•ç‹¬çš„å—åˆ—è¡¨ï¼Œå¯ä»¥åœ¨æ­¤å­—æ®µä¸­ä½¿ç”¨é”šç‚¹åç§°ã€‚åœ¨å…¶ä»–æƒ…å†µä¸‹ï¼Œé€šé…ç¬¦å°±è¶³å¤Ÿäº†ã€‚å½“åç§°ä»¥è¿å­—ç¬¦ï¼ˆ`-`ï¼‰å¼€å¤´æ—¶ï¼Œæ„å‘³ç€åº”è¯¥ä½¿ç”¨å¸¦æœ‰é»˜è®¤è§„åˆ™åç§°å‰ç¼€çš„é”šç‚¹ã€‚ä½¿ç”¨è¿å­—ç¬¦çš„ä¿®æ”¹ç¤ºä¾‹å¦‚ä¸‹æ‰€ç¤ºï¼šÙYWith such a rule, any new blocklist rules are added to an anchor called `blacklistd-ssh`.Ùuæœ‰äº†è¿™æ ·çš„è§„åˆ™ï¼Œä»»ä½•æ–°çš„é˜»æ­¢åˆ—è¡¨è§„åˆ™éƒ½ä¼šè¢«æ·»åŠ åˆ°ä¸€ä¸ªåä¸º `blacklistd-ssh` çš„é”šç‚¹ä¸­ã€‚ÚTo block whole subnets for a single rule violation, a `/` in the rule name can be used.  This causes the remaining portion of the name to be interpreted as the mask to be applied to the address specified in the rule.  For example, this rule would block every address adjoining `/24`.Ùõä¸ºäº†é’ˆå¯¹å•ä¸ªè§„åˆ™è¿è§„å°é”æ•´ä¸ªå­ç½‘ï¼Œå¯ä»¥åœ¨è§„åˆ™åç§°ä¸­ä½¿ç”¨ `/`ã€‚è¿™ä¼šå¯¼è‡´åç§°çš„å‰©ä½™éƒ¨åˆ†è¢«è§£é‡Šä¸ºè¦åº”ç”¨äºè§„åˆ™ä¸­æŒ‡å®šçš„åœ°å€çš„æ©ç ã€‚ä¾‹å¦‚ï¼Œè¿™ä¸ªè§„åˆ™å°†å°é”ä¸ `/24` ç›¸é‚»çš„æ¯ä¸ªåœ°å€ã€‚Ù¦It is important to specify the proper protocol here.  IPv4 and IPv6 treat /24 differently, that is the reason why `*` cannot be used in the third field for this rule.Ùªåœ¨è¿™é‡ŒæŒ‡å®šæ­£ç¡®çš„åè®®æ˜¯å¾ˆé‡è¦çš„ã€‚ IPv4 å’Œ IPv6 å¯¹å¾… /24 çš„æ–¹å¼ä¸åŒï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆåœ¨è¿™ä¸ªè§„åˆ™çš„ç¬¬ä¸‰ä¸ªå­—æ®µä¸­ä¸èƒ½ä½¿ç”¨â€œ * â€ã€‚Ù|This rule defines that if any one host in that network is misbehaving, everything else on that network will be blocked, too.Ù„è¿™æ¡è§„åˆ™å®šä¹‰äº†å¦‚æœè¯¥ç½‘ç»œä¸­çš„ä»»ä½•ä¸€ä¸ªä¸»æœºè¡¨ç°ä¸å½“ï¼Œé‚£ä¹ˆè¯¥ç½‘ç»œä¸Šçš„å…¶ä»–æ‰€æœ‰å†…å®¹ä¹Ÿå°†è¢«é˜»æ­¢ã€‚ÚVThe sixth field, called `nfail`, sets the number of login failures required to blocklist the remote IP in question.  When a wildcard is used at this position, it means that blocks will never happen.  In the example rule above, a limit of three is defined meaning that after three attempts to log into SSH on one connection, the IP is blocked.ÚDç¬¬å…­ä¸ªå­—æ®µç§°ä¸º `nfail`ï¼Œå®ƒè®¾ç½®äº†åœ¨ç‰¹å®šè¿œç¨‹ IP è¢«åˆ—å…¥é»‘åå•ä¹‹å‰æ‰€éœ€çš„ç™»å½•å¤±è´¥æ¬¡æ•°ã€‚å½“åœ¨æ­¤ä½ç½®ä½¿ç”¨é€šé…ç¬¦æ—¶ï¼Œæ„å‘³ç€æ°¸è¿œä¸ä¼šå‘ç”Ÿé˜»æ­¢ã€‚åœ¨ä¸Šé¢çš„ç¤ºä¾‹è§„åˆ™ä¸­ï¼Œå®šä¹‰äº†ä¸‰æ¬¡é™åˆ¶ï¼Œè¿™æ„å‘³ç€åœ¨ä¸€æ¬¡è¿æ¥ä¸­å°è¯•ä¸‰æ¬¡ç™»å½• SSH åï¼Œè¯¥ IP å°†è¢«é˜»æ­¢ã€‚ÙÜThe last field in a blacklistd rule definition specifies how long a host is blocklisted.  The default unit is seconds, but suffixes like `m`, `h`, and `d` can also be specified for minutes, hours, and days, respectively.ÙÊåœ¨ blacklistd è§„åˆ™å®šä¹‰ä¸­ï¼Œæœ€åä¸€ä¸ªå­—æ®µæŒ‡å®šäº†ä¸»æœºè¢«åŠ å…¥é»‘åå•çš„æ—¶é—´é•¿åº¦ã€‚é»˜è®¤å•ä½æ˜¯ç§’ï¼Œä½†ä¹Ÿå¯ä»¥ä½¿ç”¨åç¼€ `m`ã€`h` å’Œ `d` åˆ†åˆ«æŒ‡å®šåˆ†é’Ÿã€å°æ—¶å’Œå¤©ã€‚Ú†The example rule in its entirety means that after three times authenticating to SSH will result in a new PF block rule for that host.  Rule matches are performed by first checking local rules one after another, from most specific to least specific.  When a match occurs, the `remote` rules are applied and the name, `nfail`, and disable fields are changed by the `remote` rule that matched.Úeæ•´ä¸ªç¤ºä¾‹è§„åˆ™çš„æ„æ€æ˜¯ï¼Œå½“é€šè¿‡ SSH è¿›è¡Œä¸‰æ¬¡èº«ä»½éªŒè¯åï¼Œå°†ä¸ºè¯¥ä¸»æœºç”Ÿæˆä¸€ä¸ªæ–°çš„ PF é˜»æ­¢è§„åˆ™ã€‚è§„åˆ™åŒ¹é…æ˜¯é€šè¿‡é¦–å…ˆæŒ‰é¡ºåºæ£€æŸ¥æœ¬åœ°è§„åˆ™æ¥è¿›è¡Œçš„ï¼Œä»æœ€å…·ä½“åˆ°æœ€ä¸å…·ä½“ã€‚å½“å‘ç”ŸåŒ¹é…æ—¶ï¼Œå°†åº”ç”¨ `remote` è§„åˆ™ï¼Œå¹¶ä¸”åŒ¹é…çš„ `remote` è§„åˆ™å°†æ›´æ”¹åç§°ã€`nfail` å’Œ `disable` å­—æ®µã€‚¬Remote Rules¬è¿œç¨‹è§„åˆ™Ú!Remote rules are used to specify how blacklistd changes its behavior depending on the remote host currently being evaluated.  Each field in a remote rule is the same as in a local rule.  The only difference is in the way blacklistd is using them.  To explain it, this example rule is used:Úè¿œç¨‹è§„åˆ™ç”¨äºæŒ‡å®š blacklistd æ ¹æ®å½“å‰è¯„ä¼°çš„è¿œç¨‹ä¸»æœºæ¥æ”¹å˜å…¶è¡Œä¸ºçš„æ–¹å¼ã€‚è¿œç¨‹è§„åˆ™ä¸­çš„æ¯ä¸ªå­—æ®µä¸æœ¬åœ°è§„åˆ™ä¸­çš„å­—æ®µç›¸åŒï¼Œå”¯ä¸€çš„åŒºåˆ«åœ¨äº blacklistd ä½¿ç”¨å®ƒä»¬çš„æ–¹å¼ã€‚ä¸ºäº†è§£é‡Šè¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹ç¤ºä¾‹è§„åˆ™ï¼šÚThe address field can be an IP address (either v4 or v6), a port or both.  This allows setting special rules for a specific remote address range like in this example.  The fields for socket type, protocol and owner are identically interpreted as in the local rule.Ùøåœ°å€å­—æ®µå¯ä»¥æ˜¯ IP åœ°å€ï¼ˆIPv4 æˆ– IPv6ï¼‰ï¼Œç«¯å£æˆ–ä¸¤è€…å…¼æœ‰ã€‚è¿™å…è®¸ä¸ºç‰¹å®šçš„è¿œç¨‹åœ°å€èŒƒå›´è®¾ç½®ç‰¹æ®Šè§„åˆ™ï¼Œå°±åƒè¿™ä¸ªä¾‹å­ä¸­ä¸€æ ·ã€‚å¥—æ¥å­—ç±»å‹ã€åè®®å’Œæ‰€æœ‰è€…å­—æ®µçš„è§£é‡Šä¸æœ¬åœ°è§„åˆ™å®Œå…¨ç›¸åŒã€‚ÚThe name fields is different though: the equal sign (`=`) in a remote rule tells blacklistd to use the value from the matching local rule.  It means that the firewall rule entry is taken and the `/25` prefix (a netmask of `255.255.255.128`) is added.  When a connection from that address range is blocklisted, the entire subnet is affected.  A PF anchor name can also be used here, in which case blacklistd will add rules for this address block to the anchor of that name.  The default table is used when a wildcard is specified.Úïç„¶è€Œï¼Œåç§°å­—æ®µæ˜¯ä¸åŒçš„ï¼šè¿œç¨‹è§„åˆ™ä¸­çš„ç­‰å·ï¼ˆ`=`ï¼‰å‘Šè¯‰ blacklistd ä½¿ç”¨åŒ¹é…çš„æœ¬åœ°è§„åˆ™çš„å€¼ã€‚è¿™æ„å‘³ç€é˜²ç«å¢™è§„åˆ™æ¡ç›®è¢«é‡‡ç”¨ï¼Œå¹¶æ·»åŠ äº† `/25` å‰ç¼€ï¼ˆä¸€ä¸ª `255.255.255.128` çš„ç½‘ç»œæ©ç ï¼‰ã€‚å½“æ¥è‡ªè¯¥åœ°å€èŒƒå›´çš„è¿æ¥è¢«åˆ—å…¥é»‘åå•æ—¶ï¼Œæ•´ä¸ªå­ç½‘éƒ½ä¼šå—åˆ°å½±å“ã€‚åœ¨è¿™é‡Œä¹Ÿå¯ä»¥ä½¿ç”¨ PF é”šç‚¹åç§°ï¼Œè¿™æ · blacklistd å°†ä¸ºè¯¥åœ°å€å—æ·»åŠ åˆ°è¯¥åç§°çš„é”šç‚¹çš„è§„åˆ™ã€‚å½“æŒ‡å®šé€šé…ç¬¦æ—¶ï¼Œå°†ä½¿ç”¨é»˜è®¤è¡¨ã€‚Ú(A custom number of failures in the `nfail` column can be defined for an address.  This is useful for exceptions to a specific rule, to maybe allow someone a less strict application of rules or a bit more leniency in login tries.  Blocking is disabled when an asterisk is used in this sixth field.Ùÿå¯ä»¥ä¸ºåœ°å€å®šä¹‰ `nfail` åˆ—ä¸­çš„è‡ªå®šä¹‰å¤±è´¥æ¬¡æ•°ã€‚è¿™å¯¹äºç‰¹å®šè§„åˆ™çš„ä¾‹å¤–æƒ…å†µéå¸¸æœ‰ç”¨ï¼Œå¯ä»¥å…è®¸æŸäººå¯¹è§„åˆ™åº”ç”¨æ›´å®½æ¾æˆ–æ›´å®½å®¹çš„ç™»å½•å°è¯•ã€‚å½“åœ¨ç¬¬å…­ä¸ªå­—æ®µä¸­ä½¿ç”¨æ˜Ÿå·æ—¶ï¼Œé˜»æ­¢åŠŸèƒ½å°†è¢«ç¦ç”¨ã€‚ÙŠRemote rules allow a stricter enforcement of limits on attempts to log in compared to attempts coming from a local network like an office.Ù~è¿œç¨‹è§„åˆ™å…è®¸å¯¹ç™»å½•å°è¯•çš„é™åˆ¶è¿›è¡Œæ›´ä¸¥æ ¼çš„æ‰§è¡Œï¼Œç›¸æ¯”äºæ¥è‡ªæœ¬åœ°ç½‘ç»œï¼ˆå¦‚åŠå…¬å®¤ï¼‰çš„å°è¯•ã€‚¿Blacklistd Client Configuration¸é»‘åå•å®¢æˆ·ç«¯é…ç½®Ú&There are a few software packages in FreeBSD that can utilize blacklistd's functionality.  The two most prominent ones are man:ftpd[8] and man:sshd[8] to block excessive connection attempts.  To activate blacklistd in the SSH daemon, add the following line to [.filename]#/etc/ssh/sshd_config#:Úåœ¨ FreeBSD ä¸­æœ‰å‡ ä¸ªè½¯ä»¶åŒ…å¯ä»¥åˆ©ç”¨ blacklistd çš„åŠŸèƒ½ã€‚å…¶ä¸­æœ€é‡è¦çš„ä¸¤ä¸ªæ˜¯ man:ftpd[8] å’Œ man:sshd[8] ï¼Œç”¨äºé˜»æ­¢è¿‡å¤šçš„è¿æ¥å°è¯•ã€‚è¦åœ¨ SSH å®ˆæŠ¤ç¨‹åºä¸­æ¿€æ´» blacklistdï¼Œè¯·å°†ä»¥ä¸‹è¡Œæ·»åŠ åˆ° [.filename]#/etc/ssh/sshd_config# æ–‡ä»¶ä¸­ï¼šÙ:Restart sshd afterwards to make these changes take effect.Ù?åœ¨è¿›è¡Œè¿™äº›æ›´æ”¹åï¼Œé‡æ–°å¯åŠ¨ sshd ä»¥ä½¿å…¶ç”Ÿæ•ˆã€‚ÙBlacklisting for man:ftpd[8] is enabled using `-B`, either in [.filename]#/etc/inetd.conf# or as a flag in [.filename]#/etc/rc.conf# like this:ÙĞå¯¹äº man:ftpd[8] çš„é»‘åå•åŠŸèƒ½å·²å¯ç”¨ï¼Œå¯ä»¥ä½¿ç”¨ `-B` é€‰é¡¹ï¼Œåœ¨ [.filename]#/etc/inetd.conf# æ–‡ä»¶ä¸­æˆ–è€…ä½œä¸º [.filename]#/etc/rc.conf# æ–‡ä»¶ä¸­çš„ä¸€ä¸ªæ ‡å¿—æ¥è®¾ç½®ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼šÙEThat is all that is needed to make these programs talk to blacklistd.ÙEè¿™å°±æ˜¯ä½¿è¿™äº›ç¨‹åºä¸ blacklistd é€šä¿¡æ‰€éœ€çš„å…¨éƒ¨å†…å®¹ã€‚µBlacklistd Management¯é»‘åå•ç®¡ç†ÚBlacklistd provides the user with a management utility called man:blacklistctl[8].  It displays blocked addresses and networks that are blocklisted by the rules defined in man:blacklistd.conf[5].  To see the list of currently blocked hosts, use `dump` combined with `-b` like this.ÚBlacklistd ä¸ºç”¨æˆ·æä¾›äº†ä¸€ä¸ªåä¸º man:blacklistctl[8] çš„ç®¡ç†å·¥å…·ã€‚å®ƒæ˜¾ç¤ºç”± man:blacklistd.conf[5] ä¸­å®šä¹‰çš„è§„åˆ™æ‰€å±è”½çš„åœ°å€å’Œç½‘ç»œã€‚è¦æŸ¥çœ‹å½“å‰è¢«å±è”½çš„ä¸»æœºåˆ—è¡¨ï¼Œå¯ä»¥ä½¿ç”¨ `dump` å’Œ `-b` ç»„åˆï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚ÚšThis example shows that there were 6 out of three permitted attempts on port 22 coming from the address range `213.0.123.128/25`.  There are more attempts listed than are allowed because SSH allows a client to try multiple logins on a single TCP connection.  A connection that is currently going on is not stopped by blacklistd.  The last connection attempt is listed in the `last access` column of the output.Úcè¿™ä¸ªä¾‹å­æ˜¾ç¤ºï¼Œæ¥è‡ªåœ°å€èŒƒå›´ `213.0.123.128/25` çš„ç«¯å£ 22 ä¸Šæœ‰ 3 æ¬¡å…è®¸çš„å°è¯•ä¸­æœ‰ 6 æ¬¡å¤±è´¥ã€‚åˆ—å‡ºçš„å°è¯•æ¬¡æ•°æ¯”å…è®¸çš„æ¬¡æ•°å¤šï¼Œå› ä¸º SSH å…è®¸å®¢æˆ·ç«¯åœ¨å•ä¸ª TCP è¿æ¥ä¸Šå°è¯•å¤šæ¬¡ç™»å½•ã€‚æ­£åœ¨è¿›è¡Œä¸­çš„è¿æ¥ä¸ä¼šè¢« blacklistd åœæ­¢ã€‚æœ€åä¸€æ¬¡è¿æ¥å°è¯•åœ¨è¾“å‡ºçš„ `last access` åˆ—ä¸­åˆ—å‡ºã€‚ÙdTo see the remaining time that this host will be on the blocklist, add `-r` to the previous command.Ù]è¦æŸ¥çœ‹æ­¤ä¸»æœºåœ¨å°é”åˆ—è¡¨ä¸Šçš„å‰©ä½™æ—¶é—´ï¼Œè¯·åœ¨ä¸Šä¸€ä¸ªå‘½ä»¤ä¸­æ·»åŠ  `-r` ã€‚ÙYIn this example, there are 36s seconds left until this host will not be blocked any more.ÙRåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œè¿˜æœ‰ 36 ç§’çš„æ—¶é—´ï¼Œç›´åˆ°è¿™ä¸ªä¸»æœºä¸å†è¢«é˜»æ­¢ã€‚Ù"Removing Hosts from the Block List¾ä»é˜»æ­¢åˆ—è¡¨ä¸­ç§»é™¤ä¸»æœºÚëSometimes it is necessary to remove a host from the block list before the remaining time expires.  Unfortunately, there is no functionality in blacklistd to do that.  However, it is possible to remove the address from the PF table using pfctl.  For each blocked port, there is a child anchor inside the blacklistd anchor defined in [.filename]#/etc/pf.conf#.  For example, if there is a child anchor for blocking port 22 it is called `blacklistd/22`.  There is a table inside that child anchor that contains the blocked addresses.  This table is called port followed by the port number.  In this example, it would be called `port22`.  With that information at hand, it is now possible to use man:pfctl[8] to display all addresses listed like this:Úxæœ‰æ—¶å€™åœ¨å‰©ä½™æ—¶é—´åˆ°æœŸä¹‹å‰éœ€è¦å°†ä¸»æœºä»é˜»æ­¢åˆ—è¡¨ä¸­ç§»é™¤ã€‚ä¸å¹¸çš„æ˜¯ï¼Œblacklistd ä¸­æ²¡æœ‰è¿™æ ·çš„åŠŸèƒ½ã€‚ç„¶è€Œï¼Œå¯ä»¥ä½¿ç”¨ pfctl å°†åœ°å€ä» PF è¡¨ä¸­ç§»é™¤ã€‚å¯¹äºæ¯ä¸ªè¢«é˜»æ­¢çš„ç«¯å£ï¼Œåœ¨ [.filename]#/etc/pf.conf# ä¸­çš„ blacklistd é”šç‚¹å†…å®šä¹‰äº†ä¸€ä¸ªå­é”šç‚¹ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæœ‰ä¸€ä¸ªç”¨äºé˜»æ­¢ç«¯å£ 22 çš„å­é”šç‚¹ï¼Œå®ƒè¢«ç§°ä¸º `blacklistd/22`ã€‚åœ¨è¯¥å­é”šç‚¹å†…æœ‰ä¸€ä¸ªåŒ…å«è¢«é˜»æ­¢åœ°å€çš„è¡¨ã€‚è¯¥è¡¨çš„åç§°æ˜¯ port åŠ ä¸Šç«¯å£å·ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå®ƒå°†è¢«ç§°ä¸º `port22`ã€‚æœ‰äº†è¿™äº›ä¿¡æ¯ï¼Œç°åœ¨å¯ä»¥ä½¿ç”¨ man:pfctl[8] æ¥æ˜¾ç¤ºæ‰€æœ‰åˆ—å‡ºçš„åœ°å€ã€‚ÙlAfter identifying the address to be unblocked from the list, the following command removes it from the list:Ù]åœ¨ç¡®å®šè¦ä»åˆ—è¡¨ä¸­è§£é™¤é˜»æ­¢çš„åœ°å€ä¹‹åï¼Œä»¥ä¸‹å‘½ä»¤å°†å…¶ä»åˆ—è¡¨ä¸­ç§»é™¤ï¼šÚGThe address is now removed from PF, but will still show up in the blacklistctl list, since it does not know about any changes made in PF.  The entry in blacklistd's database will eventually expire and be removed from its output.  The entry will be added again if the host is matching one of the block rules in blacklistd again.Ú*è¯¥åœ°å€ç°åœ¨å·²ä» PF ä¸­ç§»é™¤ï¼Œä½†ä»ä¼šæ˜¾ç¤ºåœ¨ blacklistctl åˆ—è¡¨ä¸­ï¼Œå› ä¸ºå®ƒä¸çŸ¥é“åœ¨ PF ä¸­æ‰€åšçš„ä»»ä½•æ›´æ”¹ã€‚blacklistd æ•°æ®åº“ä¸­çš„æ¡ç›®æœ€ç»ˆä¼šè¿‡æœŸå¹¶ä»å…¶è¾“å‡ºä¸­åˆ é™¤ã€‚ å¦‚æœä¸»æœºå†æ¬¡åŒ¹é… blacklistd ä¸­çš„é˜»æ­¢è§„åˆ™ï¼Œåˆ™è¯¥æ¡ç›®å°†è¢«å†æ¬¡æ·»åŠ ã€‚Ù2This chapter explains how to use DTrace in FreeBSDÙ1æœ¬ç« ä»‹ç»å¦‚ä½•åœ¨ FreeBSD ä¸­ä½¿ç”¨ DTraceã€‚²Chapter 27. DTrace±ç¬¬ 27 ç«  DTraceÚCDTrace, also known as Dynamic Tracing, was developed by Sun(TM) as a tool for locating performance bottlenecks in production and pre-production systems.  In addition to diagnosing performance problems, DTrace can be used to help investigate and debug unexpected behavior in both the FreeBSD kernel and in userland programs.Ú DTraceï¼Œä¹Ÿè¢«ç§°ä¸ºåŠ¨æ€è·Ÿè¸ªï¼Œæ˜¯ç”± Sun(TM) å¼€å‘çš„ä¸€ç§å·¥å…·ï¼Œç”¨äºå®šä½ç”Ÿäº§å’Œé¢„ç”Ÿäº§ç³»ç»Ÿä¸­çš„æ€§èƒ½ç“¶é¢ˆã€‚é™¤äº†è¯Šæ–­æ€§èƒ½é—®é¢˜å¤–ï¼ŒDTrace è¿˜å¯ä»¥ç”¨äºå¸®åŠ©è°ƒæŸ¥å’Œè°ƒè¯• FreeBSD å†…æ ¸å’Œç”¨æˆ·ç¨‹åºä¸­çš„æ„å¤–è¡Œä¸ºã€‚ÚGDTrace is a remarkable profiling tool, with an impressive array of features for diagnosing system issues.  It may also be used to run pre-written scripts to take advantage of its capabilities.  Users can author their own utilities using the DTrace D Language, allowing them to customize their profiling based on specific needs.Ú%DTrace æ˜¯ä¸€ä¸ªå‡ºè‰²çš„æ€§èƒ½åˆ†æå·¥å…·ï¼Œå…·æœ‰ä»¤äººå°è±¡æ·±åˆ»çš„ä¸€ç³»åˆ—åŠŸèƒ½ï¼Œç”¨äºè¯Šæ–­ç³»ç»Ÿé—®é¢˜ã€‚å®ƒè¿˜å¯ä»¥ç”¨äºè¿è¡Œé¢„å…ˆç¼–å†™çš„è„šæœ¬ï¼Œä»¥åˆ©ç”¨å…¶åŠŸèƒ½ã€‚ç”¨æˆ·å¯ä»¥ä½¿ç”¨ DTrace D è¯­è¨€ç¼–å†™è‡ªå·±çš„å®ç”¨å·¥å…·ï¼Œæ ¹æ®ç‰¹å®šéœ€æ±‚è‡ªå®šä¹‰æ€§èƒ½åˆ†æã€‚Ú­The FreeBSD implementation provides full support for kernel DTrace and experimental support for userland DTrace.  Userland DTrace allows users to perform function boundary tracing for userland programs using the `pid` provider, and to insert static probes into userland programs for later tracing.  Some ports, such as package:databases/postgresql12-server[] and package:lang/php74[] have a DTrace option to enable static probes.ÚœFreeBSD å®ç°æä¾›äº†å¯¹å†…æ ¸ DTrace çš„å®Œå…¨æ”¯æŒï¼Œå¹¶å¯¹ç”¨æˆ·ç©ºé—´ DTrace æä¾›äº†å®éªŒæ€§æ”¯æŒã€‚ç”¨æˆ·ç©ºé—´ DTrace å…è®¸ç”¨æˆ·ä½¿ç”¨ `pid` æä¾›ç¨‹åºå¯¹ç”¨æˆ·ç©ºé—´ç¨‹åºè¿›è¡Œå‡½æ•°è¾¹ç•Œè·Ÿè¸ªï¼Œå¹¶åœ¨ç”¨æˆ·ç©ºé—´ç¨‹åºä¸­æ’å…¥é™æ€æ¢é’ˆä»¥ä¾›åç»­è·Ÿè¸ªã€‚ä¸€äº› portsï¼Œå¦‚ package:databases/postgresql12-server[] å’Œ package:lang/php74[]ï¼Œå…·æœ‰å¯ç”¨é™æ€æ¢é’ˆçš„ DTrace é€‰é¡¹ã€‚ÙkThe official guide to DTrace is maintained by the Illumos project at http://dtrace.org/guide[DTrace Guide].ÙdDTrace çš„å®˜æ–¹æŒ‡å—ç”± Illumos é¡¹ç›®ç»´æŠ¤ï¼Œç½‘å€ä¸º http://dtrace.org/guide[DTrace æŒ‡å—]ã€‚Ù-What DTrace is and what features it provides.Ù)ä»€ä¹ˆæ˜¯ DTrace åŠå…¶æä¾›çš„åŠŸèƒ½ã€‚ÙZDifferences between the Solaris(TM) DTrace implementation and the one provided by FreeBSD.ÙFSolaris(TM) DTrace å®ç°ä¸ FreeBSD æä¾›çš„å®ç°ä¹‹é—´çš„åŒºåˆ«ã€‚Ù(How to enable and use DTrace on FreeBSD.Ù.å¦‚ä½•åœ¨ FreeBSD ä¸Šå¯ç”¨å’Œä½¿ç”¨ DTraceã€‚ºImplementation Differences¬å®ç°å·®å¼‚ÚWhile the DTrace in FreeBSD is similar to that found in Solaris(TM), differences do exist.  The primary difference is that in FreeBSD, DTrace is implemented as a set of kernel modules and DTrace can not be used until the modules are loaded.  To load all of the necessary modules:Úå°½ç®¡ FreeBSD ä¸­çš„ DTrace ä¸ Solaris(TM) ä¸­çš„ DTrace ç›¸ä¼¼ï¼Œä½†ä»å­˜åœ¨ä¸€äº›å·®å¼‚ã€‚ä¸»è¦çš„å·®å¼‚åœ¨äºï¼Œåœ¨ FreeBSD ä¸­ï¼ŒDTrace æ˜¯ä½œä¸ºä¸€ç»„å†…æ ¸æ¨¡å—å®ç°çš„ï¼Œåªæœ‰åœ¨åŠ è½½è¿™äº›æ¨¡å—ä¹‹åæ‰èƒ½ä½¿ç”¨ DTraceã€‚è¦åŠ è½½æ‰€æœ‰å¿…è¦çš„æ¨¡å—ï¼šÙ_Beginning with FreeBSD 10.0-RELEASE, the modules are automatically loaded when `dtrace` is run.ÙSä» FreeBSD 10.0-RELEASE å¼€å§‹ï¼Œå½“è¿è¡Œ `dtrace` æ—¶ï¼Œæ¨¡å—ä¼šè‡ªåŠ¨åŠ è½½ã€‚ÚFreeBSD uses the `DDB_CTF` kernel option to enable support for loading `CTF` data from kernel modules and the kernel itself.  `CTF` is the Solaris(TM) Compact C Type Format which encapsulates a reduced form of debugging information similar to `DWARF` and the venerable stabs.  `CTF` data is added to binaries by the `ctfconvert` and `ctfmerge` build tools.  The `ctfconvert` utility parses `DWARF``ELF` debug sections created by the compiler and `ctfmerge` merges `CTF``ELF` sections from objects into either executables or shared libraries.ÚüFreeBSD ä½¿ç”¨ `DDB_CTF` å†…æ ¸é€‰é¡¹æ¥å¯ç”¨å¯¹ä»å†…æ ¸æ¨¡å—å’Œå†…æ ¸æœ¬èº«åŠ è½½ `CTF` æ•°æ®çš„æ”¯æŒã€‚ `CTF` æ˜¯ Solaris(TM) Compact C Type Formatï¼Œå®ƒå°è£…äº†ä¸€ç§ç±»ä¼¼äº `DWARF` å’Œå¤è€çš„ stabs çš„è°ƒè¯•ä¿¡æ¯çš„ç®€åŒ–å½¢å¼ã€‚`CTF` æ•°æ®æ˜¯ç”± `ctfconvert` å’Œ `ctfmerge` æ„å»ºå·¥å…·æ·»åŠ åˆ°äºŒè¿›åˆ¶æ–‡ä»¶ä¸­çš„ã€‚`ctfconvert` å®ç”¨ç¨‹åºè§£æç”±ç¼–è¯‘å™¨åˆ›å»ºçš„ `DWARF``ELF` è°ƒè¯•éƒ¨åˆ†ï¼Œè€Œ `ctfmerge` å°†å¯¹è±¡ä¸­çš„ `CTF``ELF` éƒ¨åˆ†åˆå¹¶åˆ°å¯æ‰§è¡Œæ–‡ä»¶æˆ–å…±äº«åº“ä¸­ã€‚Ú8Some different providers exist for FreeBSD than for Solaris(TM).  Most notable is the `dtmalloc` provider, which allows tracing `malloc()` by type in the FreeBSD kernel.  Some of the providers found in Solaris(TM), such as `cpc` and `mib`, are not present in FreeBSD.  These may appear in future versions of FreeBSD.  Moreover, some of the providers available in both operating systems are not compatible, in the sense that their probes have different argument types.  Thus, `D` scripts written on Solaris(TM) may or may not work unmodified on FreeBSD, and vice versa.Ú"FreeBSD å’Œ Solaris(TM) å­˜åœ¨ä¸€äº›ä¸åŒçš„ providers ç¨‹åºã€‚å…¶ä¸­æœ€æ˜¾è‘—çš„æ˜¯ `dtmalloc` providerï¼Œå®ƒå…è®¸åœ¨ FreeBSD å†…æ ¸ä¸­æŒ‰ç±»å‹è·Ÿè¸ª `malloc()`ã€‚ Solaris(TM) ä¸­çš„ä¸€äº› providerï¼Œå¦‚ `cpc` å’Œ `mib`ï¼Œåœ¨ FreeBSD ä¸­ä¸å­˜åœ¨ã€‚è¿™äº›å¯èƒ½ä¼šå‡ºç°åœ¨æœªæ¥çš„ FreeBSD ç‰ˆæœ¬ä¸­ã€‚æ­¤å¤–ï¼Œä¸¤ä¸ªæ“ä½œç³»ç»Ÿä¸­éƒ½å¯ç”¨çš„ä¸€äº› provider ä¸å…¼å®¹ï¼Œå› ä¸ºå®ƒä»¬çš„æ¢æµ‹å™¨å…·æœ‰ä¸åŒçš„å‚æ•°ç±»å‹ã€‚å› æ­¤ï¼Œåœ¨ Solaris(TM) ä¸Šç¼–å†™çš„ `D` è„šæœ¬å¯èƒ½æ— æ³•åœ¨ FreeBSD ä¸Šä¸ç»ä¿®æ”¹åœ°å·¥ä½œï¼Œåä¹‹äº¦ç„¶ã€‚ÙäDue to security differences, only `root` may use DTrace on FreeBSD.  Solaris(TM) has a few low level security checks which do not yet exist in FreeBSD.  As such, the [.filename]#/dev/dtrace/dtrace# is strictly limited to `root`.Ùôç”±äºå®‰å…¨å·®å¼‚ï¼Œåªæœ‰ `root` ç”¨æˆ·å¯ä»¥åœ¨ FreeBSD ä¸Šä½¿ç”¨ DTraceã€‚Solaris(TM) åœ¨å®‰å…¨æ–¹é¢æœ‰ä¸€äº›ä½çº§åˆ«çš„å®‰å…¨æ£€æŸ¥ï¼Œåœ¨ FreeBSD ä¸­å°šä¸å­˜åœ¨ã€‚å› æ­¤ï¼Œ[.filename]#/dev/dtrace/dtrace# ä¸¥æ ¼é™åˆ¶ä¸º `root` ç”¨æˆ·ã€‚ÚÂDTrace falls under the Common Development and Distribution License (`CDDL`) license.  To view this license on FreeBSD, see [.filename]#/usr/src/cddl/contrib/opensolaris/OPENSOLARIS.LICENSE# or view it online at http://opensource.org/licenses/CDDL-1.0[http://opensource.org/licenses/CDDL-1.0].  While a FreeBSD kernel with DTrace support is `BSD` licensed, the `CDDL` is used when the modules are distributed in binary form or the binaries are loaded.ÚÃDTrace å±äº Common Development and Distribution Licenseï¼ˆCDDLï¼‰è®¸å¯è¯ã€‚è¦åœ¨ FreeBSD ä¸ŠæŸ¥çœ‹æ­¤è®¸å¯è¯ï¼Œè¯·å‚é˜… [.filename]#/usr/src/cddl/contrib/opensolaris/OPENSOLARIS.LICENSE# æ–‡ä»¶ï¼Œæˆ–åœ¨çº¿æŸ¥çœ‹ http://opensource.org/licenses/CDDL-1.0[http://opensource.org/licenses/CDDL-1.0]ã€‚è™½ç„¶æ”¯æŒ DTrace çš„ FreeBSD å†…æ ¸æ˜¯ BSD è®¸å¯è¯ï¼Œä½†åœ¨ä»¥äºŒè¿›åˆ¶å½¢å¼åˆ†å‘æ¨¡å—æˆ–åŠ è½½äºŒè¿›åˆ¶æ–‡ä»¶æ—¶ï¼Œä½¿ç”¨ CDDL è®¸å¯è¯ã€‚·Enabling DTrace Support´å¯ç”¨ DTrace æ”¯æŒÚnIn FreeBSD 9.2 and 10.0, DTrace support is built into the [.filename]#GENERIC# kernel.  Users of earlier versions of FreeBSD or who prefer to statically compile in DTrace support should add the following lines to a custom kernel configuration file and recompile the kernel using the instructions in crossref:kernelconfig[kernelconfig,Configuring the FreeBSD Kernel]:ÚIåœ¨ FreeBSD 9.2 å’Œ 10.0 ä¸­ï¼ŒDTrace æ”¯æŒå·²ç»å†…ç½®åœ¨ [.filename]#GENERIC# å†…æ ¸ä¸­ã€‚ä½¿ç”¨æ—©æœŸç‰ˆæœ¬çš„ FreeBSD æˆ–è€…æ›´å–œæ¬¢é™æ€ç¼–è¯‘ DTrace æ”¯æŒçš„ç”¨æˆ·åº”è¯¥åœ¨è‡ªå®šä¹‰å†…æ ¸é…ç½®æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹è¡Œï¼Œå¹¶æŒ‰ç…§ crossref:kernelconfig[kernelconfig,é…ç½®FreeBSDå†…æ ¸] ä¸­çš„è¯´æ˜é‡æ–°ç¼–è¯‘å†…æ ¸ã€‚Ù:Users of the AMD64 architecture should also add this line:Ù4ä½¿ç”¨ AMD64 æ¶æ„çš„ç”¨æˆ·è¿˜åº”æ·»åŠ ä»¥ä¸‹è¡Œï¼šÙ‘This option provides support for `FBT`.  While DTrace will work without this option, there will be limited support for function boundary tracing.Ù™æ­¤é€‰é¡¹æä¾›å¯¹ `FBT` çš„æ”¯æŒã€‚è™½ç„¶åœ¨æ²¡æœ‰æ­¤é€‰é¡¹çš„æƒ…å†µä¸‹ DTrace ä¹Ÿå¯ä»¥å·¥ä½œï¼Œä½†å¯¹äºå‡½æ•°è¾¹ç•Œè·Ÿè¸ªçš„æ”¯æŒå°†å—åˆ°é™åˆ¶ã€‚Ú˜Once the FreeBSD system has rebooted into the new kernel, or the DTrace kernel modules have been loaded using `kldload dtraceall`, the system will need support for the Korn shell as the DTrace Toolkit has several utilities written in `ksh`.  Make sure that the package:shells/ksh93[] package or port is installed.  It is also possible to run these tools under package:shells/pdksh[] or package:shells/mksh[].Ú`ä¸€æ—¦ FreeBSD ç³»ç»Ÿé‡å¯åˆ°æ–°å†…æ ¸ï¼Œæˆ–è€…ä½¿ç”¨ `kldload dtraceall` åŠ è½½äº† DTrace å†…æ ¸æ¨¡å—ï¼Œç³»ç»Ÿå°†éœ€è¦æ”¯æŒ Korn shellï¼Œå› ä¸º DTrace Toolkit ä¸­æœ‰å‡ ä¸ªå·¥å…·æ˜¯ç”¨ `ksh` ç¼–å†™çš„ã€‚ç¡®ä¿å®‰è£…äº† package:shells/ksh93[] è½¯ä»¶åŒ…æˆ– portã€‚ä¹Ÿå¯ä»¥åœ¨ package:shells/pdksh[] æˆ– package:shells/mksh[] ä¸‹è¿è¡Œè¿™äº›å·¥å…·ã€‚ÚFinally, install the current DTrace Toolkit, a collection of ready-made scripts for collecting system information.  There are scripts to check open files, memory, `CPU` usage, and a lot more.  FreeBSD 10 installs a few of these scripts into [.filename]#/usr/share/dtrace#.  On other FreeBSD versions, or to install the full DTrace Toolkit, use the package:sysutils/dtrace-toolkit[] package or port.Ú•æœ€åï¼Œå®‰è£…å½“å‰çš„ DTrace Toolkitï¼Œè¿™æ˜¯ä¸€ä¸ªæ”¶é›†ç³»ç»Ÿä¿¡æ¯çš„ç°æˆè„šæœ¬é›†åˆã€‚å…¶ä¸­åŒ…æ‹¬æ£€æŸ¥æ‰“å¼€æ–‡ä»¶ã€å†…å­˜ã€`CPU` ä½¿ç”¨æƒ…å†µç­‰è„šæœ¬ã€‚ FreeBSD 10 ä¼šå°†å…¶ä¸­ä¸€äº›è„šæœ¬å®‰è£…åœ¨ [.filename]#/usr/share/dtrace# ç›®å½•ä¸‹ã€‚å¯¹äºå…¶ä»–ç‰ˆæœ¬çš„ FreeBSDï¼Œæˆ–è€…è¦å®‰è£…å®Œæ•´çš„ DTrace Toolkitï¼Œå¯ä»¥ä½¿ç”¨ package:sysutils/dtrace-toolkit[] åŒ…æˆ– port è¿›è¡Œå®‰è£…ã€‚ÙûThe scripts found in [.filename]#/usr/share/dtrace# have been specifically ported to FreeBSD.  Not all of the scripts found in the DTrace Toolkit will work as-is on FreeBSD and some scripts may require some effort in order for them to work on FreeBSD.Ùòåœ¨ [.filename]#/usr/share/dtrace# ä¸­æ‰¾åˆ°çš„è„šæœ¬å·²ç»ä¸“é—¨ç§»æ¤åˆ°äº† FreeBSDã€‚å¹¶éæ‰€æœ‰åœ¨ DTrace Toolkit ä¸­æ‰¾åˆ°çš„è„šæœ¬éƒ½å¯ä»¥ç›´æ¥åœ¨ FreeBSD ä¸Šè¿è¡Œï¼Œæœ‰äº›è„šæœ¬å¯èƒ½éœ€è¦ä¸€äº›åŠªåŠ›æ‰èƒ½åœ¨ FreeBSD ä¸Šè¿è¡Œã€‚Ú>The DTrace Toolkit includes many scripts in the special language of DTrace.  This language is called the D language and it is very similar to C++.  An in depth discussion of the language is beyond the scope of this document.  It is covered extensively in the http://www.dtrace.org/guide[Illumos Dynamic Tracing Guide].ÚDTrace å·¥å…·åŒ…ä¸­åŒ…å«äº†è®¸å¤šä½¿ç”¨ DTrace ç‰¹æ®Šè¯­è¨€ç¼–å†™çš„è„šæœ¬ã€‚è¿™ç§è¯­è¨€è¢«ç§°ä¸º D è¯­è¨€ï¼Œå®ƒä¸ C ++éå¸¸ç›¸ä¼¼ã€‚æœ¬æ–‡æ¡£ä¸ä¼šæ·±å…¥è®¨è®ºè¯¥è¯­è¨€çš„ç»†èŠ‚ï¼Œä½†åœ¨ http://www.dtrace.org/guide[Illumos åŠ¨æ€è·Ÿè¸ªæŒ‡å—] ä¸­æœ‰è¯¦ç»†ä»‹ç»ã€‚¬Using DTrace­ä½¿ç”¨ DTraceÚ DTrace scripts consist of a list of one or more _probes_, or instrumentation points, where each probe is associated with an action.  Whenever the condition for a probe is met, the associated action is executed.  For example, an action may occur when a file is opened, a process is started, or a line of code is executed.  The action might be to log some information or to modify context variables.  The reading and writing of context variables allows probes to share information and to cooperatively analyze the correlation of different events.ÚºDTrace è„šæœ¬ç”±ä¸€ä¸ªæˆ–å¤šä¸ªæ¢é’ˆï¼ˆæˆ–ç§°ä¸ºä»ªå™¨ç‚¹ï¼‰çš„åˆ—è¡¨ç»„æˆï¼Œæ¯ä¸ªæ¢é’ˆéƒ½ä¸ä¸€ä¸ªåŠ¨ä½œç›¸å…³è”ã€‚å½“æ¢é’ˆçš„æ¡ä»¶æ»¡è¶³æ—¶ï¼Œæ‰§è¡Œç›¸åº”çš„åŠ¨ä½œã€‚ä¾‹å¦‚ï¼Œå½“æ–‡ä»¶è¢«æ‰“å¼€ã€è¿›ç¨‹è¢«å¯åŠ¨æˆ–è€…ä»£ç è¡Œè¢«æ‰§è¡Œæ—¶ï¼Œå¯èƒ½ä¼šè§¦å‘ä¸€ä¸ªåŠ¨ä½œã€‚åŠ¨ä½œå¯ä»¥æ˜¯è®°å½•ä¸€äº›ä¿¡æ¯æˆ–ä¿®æ”¹ä¸Šä¸‹æ–‡å˜é‡ã€‚è¯»å–å’Œå†™å…¥ä¸Šä¸‹æ–‡å˜é‡å…è®¸æ¢é’ˆå…±äº«ä¿¡æ¯å¹¶ååŒåˆ†æä¸åŒäº‹ä»¶ä¹‹é—´çš„å…³è”æ€§ã€‚ÙHTo view all probes, the administrator can execute the following command:Ù<è¦æŸ¥çœ‹æ‰€æœ‰æ¢é’ˆï¼Œç®¡ç†å‘˜å¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼šÙ™Each probe has an `ID`, a `PROVIDER` (dtrace or fbt), a `MODULE`, and a `FUNCTION NAME`.  Refer to man:dtrace[1] for more information about this command.Ù¯æ¯ä¸ªæ¢é’ˆéƒ½æœ‰ä¸€ä¸ª `ID`ï¼Œä¸€ä¸ª `PROVIDER`ï¼ˆdtrace æˆ– fbtï¼‰ï¼Œä¸€ä¸ª `MODULE` å’Œä¸€ä¸ª `FUNCTION NAME`ã€‚æœ‰å…³æ­¤å‘½ä»¤çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜… man:dtrace[1]ã€‚Ù»The examples in this section provide an overview of how to use two of the fully supported scripts from the DTrace Toolkit: the [.filename]#hotkernel# and [.filename]#procsystime# scripts.Ùæœ¬èŠ‚ä¸­çš„ç¤ºä¾‹æä¾›äº†å¦‚ä½•ä½¿ç”¨ DTrace Toolkit ä¸­ä¸¤ä¸ªå®Œå…¨æ”¯æŒçš„è„šæœ¬çš„æ¦‚è¿°ï¼š[.filename]#hotkernel# å’Œ [.filename]#procsystime# è„šæœ¬ã€‚Ù™The [.filename]#hotkernel# script is designed to identify which function is using the most kernel time.  It will produce output similar to the following:Ùz[.filename]#hotkernel# è„šæœ¬æ—¨åœ¨è¯†åˆ«å“ªä¸ªå‡½æ•°ä½¿ç”¨äº†æœ€å¤šçš„å†…æ ¸æ—¶é—´ã€‚å®ƒå°†äº§ç”Ÿç±»ä¼¼ä»¥ä¸‹çš„è¾“å‡ºï¼šÙÖAs instructed, use the kbd:[Ctrl+C] key combination to stop the process.  Upon termination, the script will display a list of kernel functions and timing information, sorting the output in increasing order of time:Ù­æŒ‰ç…§æŒ‡ç¤ºï¼Œä½¿ç”¨ kbd:[Ctrl+C] é”®ç»„åˆæ¥åœæ­¢è¿›ç¨‹ã€‚åœ¨ç»ˆæ­¢åï¼Œè„šæœ¬å°†æ˜¾ç¤ºä¸€ä¸ªå†…æ ¸å‡½æ•°åˆ—è¡¨å’Œæ—¶é—´ä¿¡æ¯ï¼ŒæŒ‰æ—¶é—´é€’å¢çš„é¡ºåºæ’åºè¾“å‡ºï¼šÙ_This script will also work with kernel modules.  To use this feature, run the script with `-m`:Ùfè¿™ä¸ªè„šæœ¬ä¹Ÿå¯ä»¥ç”¨äºå†…æ ¸æ¨¡å—ã€‚è¦ä½¿ç”¨è¿™ä¸ªåŠŸèƒ½ï¼Œè¯·ä½¿ç”¨ `-m` é€‰é¡¹è¿è¡Œè„šæœ¬ï¼šÚ~The [.filename]#procsystime# script captures and prints the system call time usage for a given process `ID` (`PID`) or process name.  In the following example, a new instance of [.filename]#/bin/csh# was spawned.  Then, [.filename]#procsystime# was executed and remained waiting while a few commands were typed on the other incarnation of `csh`.  These are the results of this test:Úi[.filename]#procsystime# è„šæœ¬ç”¨äºæ•è·å¹¶æ‰“å°ç»™å®šè¿›ç¨‹ `ID`(`PID`) æˆ–è¿›ç¨‹åç§°çš„ç³»ç»Ÿè°ƒç”¨æ—¶é—´ä½¿ç”¨æƒ…å†µã€‚åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œä¸€ä¸ªæ–°çš„ [.filename]#/bin/csh# å®ä¾‹è¢«åˆ›å»ºã€‚ç„¶åï¼Œæ‰§è¡Œäº† [.filename]#procsystime# å¹¶ä¿æŒç­‰å¾…çŠ¶æ€ï¼ŒåŒæ—¶åœ¨å¦ä¸€ä¸ª `csh` å®ä¾‹ä¸­è¾“å…¥äº†ä¸€äº›å‘½ä»¤ã€‚è¿™æ˜¯è¿™ä¸ªæµ‹è¯•çš„ç»“æœï¼šÙ„As shown, the `read()` system call used the most time in nanoseconds while the `getpid()` system call used the least amount of time.Ù„å¦‚å›¾æ‰€ç¤ºï¼Œ`read()` ç³»ç»Ÿè°ƒç”¨ä½¿ç”¨çš„æ—¶é—´æœ€é•¿ï¼Œä»¥çº³ç§’ä¸ºå•ä½ï¼Œè€Œ `getpid()` ç³»ç»Ÿè°ƒç”¨ä½¿ç”¨çš„æ—¶é—´æœ€çŸ­ã€‚¹FreeBSD Handbook Glossary·FreeBSD æ‰‹å†Œæœ¯è¯­è¡¨°FreeBSD Glossary±FreeBSD è¯æ±‡è¡¨Ù^This glossary contains terms and acronyms used within the FreeBSD community and documentation.ÙQè¿™ä¸ªè¯æ±‡è¡¨åŒ…å«äº†åœ¨ FreeBSD ç¤¾åŒºå’Œæ–‡æ¡£ä¸­ä½¿ç”¨çš„æœ¯è¯­å’Œç¼©å†™ã€‚ÙASee <<acpi-glossary,Advanced Configuration and Power Interface>>.Ù7å‚è§ <<acpi-glossary,é«˜çº§é…ç½®ä¸ç”µæºæ¥å£>>ã€‚Ù,See <<amd-glossary,Automatic Mount Daemon>>.Ù3å‚è§ <<amd-glossary,è‡ªåŠ¨æŒ‚è½½å®ˆæŠ¤è¿›ç¨‹>>ã€‚Ù+See <<aml-glossary,ACPI Machine Language>>.Ù,å‚è§ <<aml-glossary,ACPI æœºå™¨è¯­è¨€>>ã€‚Ù7See <<api-glossary,Application Programming Interface>>.Ù3å‚è§ <<api-glossary,åº”ç”¨ç¨‹åºç¼–ç¨‹æ¥å£>>ã€‚ÙASee <<apic-glossary,Advanced Programmable Interrupt Controller>>.Ù:å‚è§ <<apic-glossary,é«˜çº§å¯ç¼–ç¨‹ä¸­æ–­æ§åˆ¶å™¨>>ã€‚Ù/See <<apm-glossary,Advanced Power Management>>.Ù,å‚è§<<apm-glossary,é«˜çº§ç”µæºç®¡ç†>>ã€‚Ù9See <<apop-glossary,Authenticated Post Office Protocol>>.Ù.å‚è§ <<apop-glossary,è®¤è¯é‚®å±€åè®®>>ã€‚Ù*See <<asl-glossary,ACPI Source Language>>.Ù+å‚è§ <<asl-glossary,ACPI æºè¯­è¨€ >> ã€‚Ù4See <<ata-glossary,Advanced Technology Attachment>>.Ù-å‚è§ <<ata-glossary,é«˜çº§æŠ€æœ¯é™„ä»¶>>ã€‚Ù0See <<atm-glossary,Asynchronous Transfer Mode>>.Ù-å‚è§ <<atm-glossary,å¼‚æ­¥ä¼ è¾“æ¨¡å¼>>ã€‚Ù»Pseudocode, interpreted by a virtual machine within an ACPI-compliant operating system, providing a layer between the underlying hardware and the documented interface presented to the OS.Ùœä¼ªä»£ç ç”±ä¸€ä¸ªåœ¨ç¬¦åˆ ACPI çš„æ“ä½œç³»ç»Ÿä¸­çš„è™šæ‹Ÿæœºè§£é‡Šï¼Œå®ƒåœ¨åº•å±‚ç¡¬ä»¶å’Œå‘æ“ä½œç³»ç»Ÿå‘ˆç°çš„æ–‡æ¡£åŒ–æ¥å£ä¹‹é—´æä¾›äº†ä¸€å±‚ã€‚´ACPI Source Language®ACPI æºè¯­è¨€Ù+The programming language AML is written in.¼AML æ˜¯ä¸€ç§ç¼–ç¨‹è¯­è¨€ã€‚³Access Control List²è®¿é—®æ§åˆ¶åˆ—è¡¨ÙWA list of permissions attached to an object, usually either a file or a network device.ÙKä¸€ä¸ªé™„åŠ åœ¨å¯¹è±¡ä¸Šçš„æƒé™åˆ—è¡¨ï¼Œé€šå¸¸æ˜¯æ–‡ä»¶æˆ–ç½‘ç»œè®¾å¤‡ã€‚Ù*Advanced Configuration and Power Interface»é«˜çº§é…ç½®ä¸ç”µæºæ¥å£ÚºA specification which provides an abstraction of the interface the hardware presents to the operating system, so that the operating system should need to know nothing about the underlying hardware to make the most of it.  ACPI evolves and supersedes the functionality provided previously by APM, PNPBIOS and other technologies, and provides facilities for controlling power consumption, machine suspension, device enabling and disabling, etc.ÚACPI æ˜¯ä¸€ç§è§„èŒƒï¼Œå®ƒæä¾›äº†ç¡¬ä»¶æ¥å£çš„æŠ½è±¡ï¼Œä½¿æ“ä½œç³»ç»Ÿä¸éœ€è¦äº†è§£åº•å±‚ç¡¬ä»¶å³å¯å……åˆ†åˆ©ç”¨å®ƒã€‚ACPI å‘å±•å¹¶å–ä»£äº†ä»¥å‰ç”± APMã€PNPBIOS å’Œå…¶ä»–æŠ€æœ¯æä¾›çš„åŠŸèƒ½ï¼Œå¹¶æä¾›äº†æ§åˆ¶åŠŸè€—ã€æœºå™¨æš‚åœã€è®¾å¤‡å¯ç”¨å’Œç¦ç”¨ç­‰åŠŸèƒ½ã€‚Ù!Application Programming Interface¸åº”ç”¨ç¨‹åºç¼–ç¨‹æ¥å£Ù¾A set of procedures, protocols and tools that specify the canonical interaction of one or more program parts; how, when and why they do work together, and what data they share or operate on.ÙÀä¸€ç»„ç¨‹åºã€åè®®å’Œå·¥å…·ï¼Œç”¨äºæŒ‡å®šä¸€ä¸ªæˆ–å¤šä¸ªç¨‹åºéƒ¨åˆ†ä¹‹é—´çš„è§„èŒƒäº¤äº’æ–¹å¼ï¼›å®ƒä»¬å¦‚ä½•ã€ä½•æ—¶ä»¥åŠä¸ºä»€ä¹ˆååŒå·¥ä½œï¼Œä»¥åŠå®ƒä»¬å…±äº«æˆ–æ“ä½œçš„æ•°æ®ã€‚¹Advanced Power Management²é«˜çº§ç”µæºç®¡ç†ÙØAn API enabling the operating system to work in conjunction with the BIOS in order to achieve power management.  APM has been superseded by the much more generic and powerful ACPI specification for most applications.Ù´APM æ˜¯ä¸€ç§ APIï¼Œä½¿æ“ä½œç³»ç»Ÿèƒ½å¤Ÿä¸ BIOS ååŒå·¥ä½œï¼Œä»¥å®ç°ç”µæºç®¡ç†ã€‚å¯¹äºå¤§å¤šæ•°åº”ç”¨ç¨‹åºæ¥è¯´ï¼ŒAPM å·²è¢«æ›´é€šç”¨å’Œå¼ºå¤§çš„ ACPI è§„èŒƒæ‰€å–ä»£ã€‚Ù*Advanced Programmable Interrupt Controller¾é«˜çº§å¯ç¼–ç¨‹ä¸­æ–­æ§åˆ¶å™¨¾Advanced Technology Attachment²é«˜çº§æŠ€æœ¯é™„ä»¶ºAsynchronous Transfer Mode²å¼‚æ­¥ä¼ è¾“æ¨¡å¼Ù"Authenticated Post Office Protocol²è®¤è¯é‚®å±€åè®®¶Automatic Mount Daemon¸è‡ªåŠ¨æŒ‚è½½å®ˆæŠ¤è¿›ç¨‹ÙlA daemon that automatically mounts a filesystem when a file or directory within that filesystem is accessed.ÙZå½“è®¿é—®æ–‡ä»¶ç³»ç»Ÿä¸­çš„æ–‡ä»¶æˆ–ç›®å½•æ—¶ï¼Œè‡ªåŠ¨æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿçš„å®ˆæŠ¤è¿›ç¨‹ã€‚Ù=This chapter shows the other filesystems supported by FreeBSDÙ6æœ¬ç« ä»‹ç»äº† FreeBSD æ”¯æŒçš„å…¶ä»–æ–‡ä»¶ç³»ç»Ÿã€‚¾Chapter 23. Other File Systems½ç¬¬ 23 ç«  å…¶ä»–æ–‡ä»¶ç³»ç»Ÿ²Other File Systems²å…¶ä»–æ–‡ä»¶ç³»ç»ŸÚíFile systems are an integral part of any operating system.  They allow users to upload and store files, provide access to data, and make hard drives useful.  Different operating systems differ in their native file system.  Traditionally, the native FreeBSD file system has been the Unix File System UFS which has been modernized as UFS2.  Since FreeBSD 7.0, the Z File System (ZFS) is also available as a native file system.  See crossref:zfs[zfs,The Z File System (ZFS)] for more information.Úİæ–‡ä»¶ç³»ç»Ÿæ˜¯ä»»ä½•æ“ä½œç³»ç»Ÿçš„é‡è¦ç»„æˆéƒ¨åˆ†ã€‚å®ƒä»¬å…è®¸ç”¨æˆ·ä¸Šä¼ å’Œå­˜å‚¨æ–‡ä»¶ï¼Œæä¾›å¯¹æ•°æ®çš„è®¿é—®ï¼Œå¹¶ä½¿ç¡¬ç›˜å˜å¾—æœ‰ç”¨ã€‚ä¸åŒçš„æ“ä½œç³»ç»Ÿåœ¨å…¶æœ¬æœºæ–‡ä»¶ç³»ç»Ÿä¸Šæœ‰æ‰€ä¸åŒã€‚ä¼ ç»Ÿä¸Šï¼Œæœ¬æœºçš„ FreeBSD æ–‡ä»¶ç³»ç»Ÿä¸€ç›´æ˜¯ Unix æ–‡ä»¶ç³»ç»Ÿ UFSï¼Œç°å·²ç°ä»£åŒ–ä¸º UFS2ã€‚è‡ª FreeBSD 7.0 ä»¥æ¥ï¼ŒZ æ–‡ä»¶ç³»ç»Ÿï¼ˆZFSï¼‰ä¹Ÿä½œä¸ºæœ¬æœºæ–‡ä»¶ç³»ç»Ÿå¯ç”¨ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§ crossref:zfs[zfs,Z æ–‡ä»¶ç³»ç»Ÿï¼ˆZFSï¼‰]ã€‚Ú<In addition to its native file systems, FreeBSD supports a multitude of other file systems so that data from other operating systems can be accessed locally, such as data stored on locally attached USB storage devices, flash drives, and hard disks.  This includes support for the Linux(R) Extended File System (EXT).Úé™¤äº†æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¹‹å¤–ï¼ŒFreeBSD è¿˜æ”¯æŒå¤šç§å…¶ä»–æ–‡ä»¶ç³»ç»Ÿï¼Œä»¥ä¾¿å¯ä»¥æœ¬åœ°è®¿é—®æ¥è‡ªå…¶ä»–æ“ä½œç³»ç»Ÿçš„æ•°æ®ï¼Œä¾‹å¦‚å­˜å‚¨åœ¨æœ¬åœ°è¿æ¥çš„ USB å­˜å‚¨è®¾å¤‡ã€é—ªå­˜é©±åŠ¨å™¨å’Œç¡¬ç›˜ä¸Šçš„æ•°æ®ã€‚è¿™åŒ…æ‹¬å¯¹ Linux(R) æ‰©å±•æ–‡ä»¶ç³»ç»Ÿï¼ˆEXTï¼‰çš„æ”¯æŒã€‚ÙüThere are different levels of FreeBSD support for the various file systems.  Some require a kernel module to be loaded and others may require a toolset to be installed.  Some non-native file system support is full read-write while others are read-only.Ùòå¯¹äºä¸åŒçš„æ–‡ä»¶ç³»ç»Ÿï¼ŒFreeBSD æä¾›äº†ä¸åŒçº§åˆ«çš„æ”¯æŒã€‚æœ‰äº›éœ€è¦åŠ è½½å†…æ ¸æ¨¡å—ï¼Œè€Œå…¶ä»–ä¸€äº›å¯èƒ½éœ€è¦å®‰è£…å·¥å…·é›†ã€‚ä¸€äº›éæœ¬åœ°æ–‡ä»¶ç³»ç»Ÿçš„æ”¯æŒæ˜¯å®Œå…¨è¯»å†™çš„ï¼Œè€Œå…¶ä»–ä¸€äº›åˆ™åªæ”¯æŒåªè¯»ã€‚Ù9The difference between native and supported file systems.Ù<æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿå’Œæ”¯æŒçš„æ–‡ä»¶ç³»ç»Ÿä¹‹é—´çš„åŒºåˆ«ã€‚Ù,Which file systems are supported by FreeBSD.Ù#FreeBSD æ”¯æŒå“ªäº›æ–‡ä»¶ç³»ç»Ÿï¼ŸÙJHow to enable, configure, access, and make use of non-native file systems.Ù?å¦‚ä½•å¯ç”¨ã€é…ç½®ã€è®¿é—®å’Œä½¿ç”¨éæœ¬æœºæ–‡ä»¶ç³»ç»Ÿã€‚Ù>Understand UNIX(R) and crossref:basics[basics,FreeBSD basics].ÙBäº†è§£ UNIX(R) å’Œ crossref:basics[basics,FreeBSD åŸºç¡€çŸ¥è¯†]ã€‚ÙhBe familiar with the basics of crossref:kernelconfig[kernelconfig,kernel configuration and compilation].ÙLç†Ÿæ‚‰åŸºç¡€çš„ crossref:kernelconfig[kernelconfig,å†…æ ¸é…ç½®å’Œç¼–è¯‘]ã€‚ÙFFeel comfortable crossref:ports[ports,installing software] in FreeBSD.ÙPåœ¨ FreeBSD ä¸­ï¼Œcrossref:ports[ports,å®‰è£…è½¯ä»¶] ä¼šè®©æ‚¨æ„Ÿåˆ°å¾ˆæ–¹ä¾¿ã€‚Ù]Have some familiarity with crossref:disks[disks,disks], storage, and device names in FreeBSD.ÙYå¯¹ FreeBSD ä¸­çš„ crossref:disks[disks,ç£ç›˜]ã€å­˜å‚¨å’Œè®¾å¤‡åç§°æœ‰ä¸€äº›äº†è§£ã€‚µLinux(R) File SystemsµLinux(R) æ–‡ä»¶ç³»ç»ŸÙ­FreeBSD provides built-in support for several Linux(R) file systems.  This section demonstrates how to load support for and how to mount the supported Linux(R) file systems.Ù‹FreeBSD æä¾›äº†å¯¹å¤šç§ Linux(R) æ–‡ä»¶ç³»ç»Ÿçš„å†…ç½®æ”¯æŒã€‚æœ¬èŠ‚ä»‹ç»å¦‚ä½•åŠ è½½æ”¯æŒå’ŒæŒ‚è½½æ”¯æŒçš„ Linux(R) æ–‡ä»¶ç³»ç»Ÿã€‚Ù»Kernel support for ext2 file systems has been available since FreeBSD 2.2.  The man:ext2fs[5] driver allows the FreeBSD kernel to both read and write to ext2, ext3, and ext4 file systems.Ù¸è‡ª FreeBSD 2.2 ç‰ˆæœ¬èµ·ï¼Œå†…æ ¸å¯¹ ext2 æ–‡ä»¶ç³»ç»Ÿçš„æ”¯æŒå·²ç»å¯ç”¨ã€‚man:ext2fs[5] é©±åŠ¨ç¨‹åºå…è®¸ FreeBSD å†…æ ¸å¯¹ ext2ã€ext3 å’Œ ext4 æ–‡ä»¶ç³»ç»Ÿè¿›è¡Œè¯»å†™æ“ä½œã€‚Ù1Journalling and encryption are not supported yet.Ù*ç›®å‰è¿˜ä¸æ”¯æŒæ—¥å¿—è®°å½•å’ŒåŠ å¯†ã€‚Ù¼To access an ext file system, mount the ext volume by specifying its FreeBSD partition name and an existing mount point.  This example mounts [.filename]#/dev/ada1s1# on [.filename]#/mnt#:Ù»è¦è®¿é—®ä¸€ä¸ª ext æ–‡ä»¶ç³»ç»Ÿï¼Œé€šè¿‡æŒ‡å®šå…¶ FreeBSD åˆ†åŒºåç§°å’Œç°æœ‰çš„æŒ‚è½½ç‚¹æ¥æŒ‚è½½ ext å·ã€‚è¿™ä¸ªä¾‹å­å°† [.filename]#/dev/ada1s1# æŒ‚è½½åˆ° [.filename]#/mnt# ä¸Šï¼šÙºHundreds of standard practices have been authored about how to secure systems and networks, and as a user of FreeBSD, understanding how to protect against attacks and intruders is a mustÙ¢å·²ç»æœ‰æ•°ç™¾ç§å…³äºå¦‚ä½•ä¿æŠ¤ç³»ç»Ÿå’Œç½‘ç»œçš„æ ‡å‡†å®è·µè¢«æ’°å†™å‡ºæ¥ï¼Œä½œä¸º FreeBSD çš„ç”¨æˆ·ï¼Œäº†è§£å¦‚ä½•é˜²å¾¡æ”»å‡»å’Œå…¥ä¾µè€…æ˜¯å¿…é¡»çš„ã€‚´Chapter 16. Security±ç¬¬ 16 ç«  å®‰å…¨¨Security¦å®‰å…¨Ù»Hundreds of standard practices have been authored about how to secure systems and networks, and as a user of FreeBSD, understanding how to protect against attacks and intruders is a must.Ù¥å·²ç»æœ‰æ•°ç™¾ç§å…³äºå¦‚ä½•ä¿æŠ¤ç³»ç»Ÿå’Œç½‘ç»œçš„æ ‡å‡†å®è·µè¢«æ’°å†™å‡ºæ¥ï¼Œä½œä¸º FreeBSD çš„ç”¨æˆ·ï¼Œäº†è§£å¦‚ä½•é˜²å¾¡æ”»å‡»å’Œå…¥ä¾µæ˜¯å¿…ä¸å¯å°‘çš„ã€‚ÙÉIn this chapter, several fundamentals and techniques will be discussed.  The FreeBSD system comes with multiple layers of security, and many more third party utilities may be added to enhance security.Ù˜åœ¨æœ¬ç« ä¸­ï¼Œå°†è®¨è®ºå‡ ä¸ªåŸºæœ¬åŸç†å’ŒæŠ€æœ¯ã€‚FreeBSD ç³»ç»Ÿå…·æœ‰å¤šå±‚å®‰å…¨æ€§ï¼Œå¹¶ä¸”å¯ä»¥æ·»åŠ è®¸å¤šç¬¬ä¸‰æ–¹å·¥å…·æ¥å¢å¼ºå®‰å…¨æ€§ã€‚Ù'Basic FreeBSD system security concepts.Ù'åŸºæœ¬çš„ FreeBSD ç³»ç»Ÿå®‰å…¨æ¦‚å¿µã€‚Ù2The various crypt mechanisms available in FreeBSD.Ù-åœ¨ FreeBSD ä¸­å¯ç”¨çš„å„ç§åŠ å¯†æœºåˆ¶ã€‚Ù8How to configure TCP Wrappers for use with man:inetd[8].Ù=å¦‚ä½•é…ç½® TCP Wrappers ä»¥ä¸ man:inetd[8] ä¸€èµ·ä½¿ç”¨ã€‚Ù"How to set up Kerberos on FreeBSD.Ù+åœ¨ FreeBSD ä¸Šè®¾ç½® Kerberos çš„æ–¹æ³•ã€‚Ù,How to configure and use OpenSSH on FreeBSD.Ù/å¦‚ä½•åœ¨ FreeBSD ä¸Šé…ç½®å’Œä½¿ç”¨ OpenSSHã€‚¾How to use OpenSSL on FreeBSD.Ù&åœ¨ FreeBSD ä¸Šå¦‚ä½•ä½¿ç”¨ OpenSSLã€‚¼How to use file system ACLs.¿å¦‚ä½•ä½¿ç”¨æ–‡ä»¶ç³»ç»Ÿ ACLã€‚ÙZHow to use pkg to audit third party software packages installed from the Ports Collection.ÙHå¦‚ä½•ä½¿ç”¨ pkg æ¥å®¡è®¡ä» Ports é›†åˆå®‰è£…çš„ç¬¬ä¸‰æ–¹è½¯ä»¶åŒ…ã€‚Ù+How to utilize FreeBSD security advisories.Ù$å¦‚ä½•åˆ©ç”¨ FreeBSD å®‰å…¨å…¬å‘Šã€‚Ù;What Process Accounting is and how to enable it on FreeBSD.Ù<è¿›ç¨‹è´¦æˆ·æ˜¯ä»€ä¹ˆä»¥åŠå¦‚ä½•åœ¨ FreeBSD ä¸Šå¯ç”¨å®ƒã€‚ÙRHow to control user resources using login classes or the resource limits database.ÙEå¦‚ä½•ä½¿ç”¨ç™»å½•ç±»æˆ–èµ„æºé™åˆ¶æ•°æ®åº“æ¥æ§åˆ¶ç”¨æˆ·èµ„æºã€‚Ù%What is Capsicum and a basic example.Ù+ä»€ä¹ˆæ˜¯ Capsicum å’Œä¸€ä¸ªåŸºæœ¬ä¾‹å­ã€‚ÙØCertain topics due to their complexity are found in dedicated chapters such as crossref:firewalls[firewalls,Firewalls], crossref:mac[mac,Mandatory Access Control] and articles like extref:{vpn-ipsec}[VPN over IPsec].ÙÛç”±äºå…¶å¤æ‚æ€§ï¼ŒæŸäº›ä¸»é¢˜åœ¨ä¸“é—¨çš„ç« èŠ‚ä¸­è¿›è¡Œè®¨è®ºï¼Œä¾‹å¦‚ crossref:firewalls[firewalls,é˜²ç«å¢™]ï¼Œ crossref:mac[mac,å¼ºåˆ¶è®¿é—®æ§åˆ¶] ä»¥åŠåƒ extref:{vpn-ipsec}[VPN over IPsec] è¿™æ ·çš„æ–‡ç« ã€‚ÚKSecurity is everyone's responsibility.  A weak entry point in any system could allow intruders to gain access to critical information and cause havoc on an entire network.  One of the core principles of information security is the CIA triad, which stands for the Confidentiality, Integrity, and Availability of information systems.Úå®‰å…¨æ˜¯æ¯ä¸ªäººçš„è´£ä»»ã€‚ä»»ä½•ç³»ç»Ÿä¸­çš„å¼±å…¥å£éƒ½å¯èƒ½ä½¿å…¥ä¾µè€…è·å¾—å¯¹å…³é”®ä¿¡æ¯çš„è®¿é—®æƒé™ï¼Œå¹¶å¯¹æ•´ä¸ªç½‘ç»œé€ æˆæ··ä¹±ã€‚ä¿¡æ¯å®‰å…¨çš„æ ¸å¿ƒåŸåˆ™ä¹‹ä¸€æ˜¯ CIA ä¸‰å…ƒç»„ï¼Œå³ä¿¡æ¯ç³»ç»Ÿçš„æœºå¯†æ€§ã€å®Œæ•´æ€§å’Œå¯ç”¨æ€§ã€‚ÚnThe CIA triad is a bedrock concept of computer security as customers and users expect their data to be protected.  For example, a customer expects that their credit card information is securely stored (confidentiality), that their orders are not changed behind the scenes (integrity), and that they have access to their order information at all times (availability).Ú6CIA ä¸‰å…ƒç»„æ˜¯è®¡ç®—æœºå®‰å…¨çš„åŸºæœ¬æ¦‚å¿µï¼Œå› ä¸ºå®¢æˆ·å’Œç”¨æˆ·æœŸæœ›ä»–ä»¬çš„æ•°æ®å¾—åˆ°ä¿æŠ¤ã€‚ä¾‹å¦‚ï¼Œå®¢æˆ·æœŸæœ›ä»–ä»¬çš„ä¿¡ç”¨å¡ä¿¡æ¯è¢«å®‰å…¨åœ°å­˜å‚¨ï¼ˆä¿å¯†æ€§ï¼‰ï¼Œä»–ä»¬çš„è®¢å•åœ¨å¹•åä¸è¢«æ›´æ”¹ï¼ˆå®Œæ•´æ€§ï¼‰ï¼Œå¹¶ä¸”ä»–ä»¬å¯ä»¥éšæ—¶è®¿é—®ä»–ä»¬çš„è®¢å•ä¿¡æ¯ï¼ˆå¯ç”¨æ€§ï¼‰ã€‚Ú$To provide CIA, security professionals apply a defense in depth strategy.  The idea of defense in depth is to add several layers of security to prevent one single layer failing and the entire security system collapsing.  For example, a system administrator cannot simply turn on a firewall and consider the network or system secure.  One must also audit accounts, check the integrity of binaries, and ensure malicious tools are not installed.  To implement an effective security strategy, one must understand threats and how to defend against them.Úñä¸ºäº†æä¾› CIA ï¼ˆæœºå¯†æ€§ã€å®Œæ•´æ€§å’Œå¯ç”¨æ€§ï¼‰ï¼Œå®‰å…¨ä¸“ä¸šäººå‘˜é‡‡ç”¨äº†æ·±åº¦é˜²å¾¡ç­–ç•¥ã€‚æ·±åº¦é˜²å¾¡çš„ç†å¿µæ˜¯åœ¨å®‰å…¨ç³»ç»Ÿä¸­æ·»åŠ å¤šå±‚å®‰å…¨æªæ–½ï¼Œä»¥é˜²æ­¢å•ä¸ªå±‚é¢çš„å¤±è´¥å¯¼è‡´æ•´ä¸ªå®‰å…¨ç³»ç»Ÿå´©æºƒã€‚ä¾‹å¦‚ï¼Œç³»ç»Ÿç®¡ç†å‘˜ä¸èƒ½ä»…ä»…æ‰“å¼€é˜²ç«å¢™å°±è®¤ä¸ºç½‘ç»œæˆ–ç³»ç»Ÿæ˜¯å®‰å…¨çš„ã€‚è¿˜å¿…é¡»å®¡è®¡è´¦æˆ·ã€æ£€æŸ¥äºŒè¿›åˆ¶æ–‡ä»¶çš„å®Œæ•´æ€§ï¼Œå¹¶ç¡®ä¿æ²¡æœ‰å®‰è£…æ¶æ„å·¥å…·ã€‚è¦å®æ–½æœ‰æ•ˆçš„å®‰å…¨ç­–ç•¥ï¼Œå¿…é¡»äº†è§£å¨èƒåŠå…¶é˜²å¾¡æ–¹æ³•ã€‚ÚLWhat is a threat as it pertains to computer security? Threats are not limited to remote attackers who attempt to access a system without permission from a remote location.  Threats also include employees, malicious software, unauthorized network devices, natural disasters, security vulnerabilities, and even competing corporations.Ùíåœ¨è®¡ç®—æœºå®‰å…¨é¢†åŸŸï¼Œå¨èƒæ˜¯æŒ‡ä¸ä»…é™äºè¯•å›¾ä»è¿œç¨‹ä½ç½®æœªç»è®¸å¯è®¿é—®ç³»ç»Ÿçš„è¿œç¨‹æ”»å‡»è€…ã€‚å¨èƒè¿˜åŒ…æ‹¬å‘˜å·¥ã€æ¶æ„è½¯ä»¶ã€æœªç»æˆæƒçš„ç½‘ç»œè®¾å¤‡ã€è‡ªç„¶ç¾å®³ã€å®‰å…¨æ¼æ´ï¼Œç”šè‡³ç«äº‰å¯¹æ‰‹ã€‚Ú˜Systems and networks can be accessed without permission, sometimes by accident, or by remote attackers, and in some cases, via corporate espionage or former employees.  As a user, it is important to prepare for and admit when a mistake has led to a security breach and report possible issues to the security team.  As an administrator, it is important to know of the threats and be prepared to mitigate them.Ú­ç³»ç»Ÿå’Œç½‘ç»œæœ‰æ—¶ä¼šåœ¨æ²¡æœ‰è®¸å¯çš„æƒ…å†µä¸‹è¢«è®¿é—®ï¼Œæœ‰æ—¶æ˜¯å‡ºäºæ„å¤–ï¼Œæˆ–è€…æ˜¯è¢«è¿œç¨‹æ”»å‡»è€…è®¿é—®ï¼Œè€Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¯èƒ½æ˜¯é€šè¿‡ä¼ä¸šé—´è°æ´»åŠ¨æˆ–å‰å‘˜å·¥çš„æ–¹å¼è¿›è¡Œè®¿é—®ã€‚ä½œä¸ºç”¨æˆ·ï¼Œé‡è¦çš„æ˜¯è¦ä¸ºå¯èƒ½å¯¼è‡´å®‰å…¨æ¼æ´çš„é”™è¯¯åšå¥½å‡†å¤‡ï¼Œå¹¶å‘å®‰å…¨å›¢é˜ŸæŠ¥å‘Šå¯èƒ½å­˜åœ¨çš„é—®é¢˜ã€‚ä½œä¸ºç®¡ç†å‘˜ï¼Œäº†è§£å¨èƒå¹¶åšå¥½å‡†å¤‡ä»¥å‡è½»å…¶å½±å“æ˜¯éå¸¸é‡è¦çš„ã€‚ÚXWhen applying security to systems, it is recommended to start by securing the basic accounts and system configuration, and then to secure the network layer so that it adheres to the system policy and the organization's security procedures.  Many organizations already have a security policy that covers the configuration of technology devices.  The policy should include the security configuration of workstations, desktops, mobile devices, phones, production servers, and development servers.  In many cases, standard operating procedures (SOPs) already exist.  When in doubt, ask the security team.ÚÂåœ¨åº”ç”¨å®‰å…¨æªæ–½åˆ°ç³»ç»Ÿæ—¶ï¼Œå»ºè®®é¦–å…ˆä¿æŠ¤åŸºæœ¬è´¦æˆ·å’Œç³»ç»Ÿé…ç½®ï¼Œç„¶åä¿æŠ¤ç½‘ç»œå±‚ï¼Œä½¿å…¶ç¬¦åˆç³»ç»Ÿç­–ç•¥å’Œç»„ç»‡çš„å®‰å…¨ç¨‹åºã€‚è®¸å¤šç»„ç»‡å·²ç»æœ‰äº†æ¶µç›–æŠ€æœ¯è®¾å¤‡é…ç½®çš„å®‰å…¨ç­–ç•¥ã€‚è¯¥ç­–ç•¥åº”åŒ…æ‹¬å·¥ä½œç«™ã€æ¡Œé¢ç”µè„‘ã€ç§»åŠ¨è®¾å¤‡ã€ç”µè¯ã€ç”Ÿäº§æœåŠ¡å™¨å’Œå¼€å‘æœåŠ¡å™¨çš„å®‰å…¨é…ç½®ã€‚åœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œæ ‡å‡†æ“ä½œè§„ç¨‹ï¼ˆSOPï¼‰å·²ç»å­˜åœ¨ã€‚å¦‚æœæœ‰ç–‘é—®ï¼Œè¯·å’¨è¯¢å®‰å…¨å›¢é˜Ÿã€‚±Securing Accounts²ä¿æŠ¤è´¦æˆ·å®‰å…¨ÙıMaintaining secure accounts in FreeBSD is crucial for data confidentiality, system integrity, and privilege separation, as it prevents unauthorized access, malware, and data breaches while ensuring compliance and protecting an organization's reputation.ÙÛåœ¨ FreeBSD ä¸­ç»´æŠ¤å®‰å…¨è´¦æˆ·å¯¹äºæ•°æ®ä¿å¯†æ€§ã€ç³»ç»Ÿå®Œæ•´æ€§å’Œæƒé™åˆ†ç¦»è‡³å…³é‡è¦ï¼Œå®ƒå¯ä»¥é˜²æ­¢æœªç»æˆæƒçš„è®¿é—®ã€æ¶æ„è½¯ä»¶å’Œæ•°æ®æ³„éœ²ï¼ŒåŒæ—¶ç¡®ä¿åˆè§„æ€§å¹¶ä¿æŠ¤ç»„ç»‡çš„å£°èª‰ã€‚±Preventing Logins¬é˜²æ­¢ç™»å½•ÙyIn securing a system, a good starting point is an audit of accounts.  Disable any accounts that do not need login access.Ùråœ¨ä¿æŠ¤ç³»ç»Ÿæ—¶ï¼Œä¸€ä¸ªå¾ˆå¥½çš„èµ·ç‚¹æ˜¯å¯¹è´¦æˆ·è¿›è¡Œå®¡è®¡ã€‚ç¦ç”¨ä»»ä½•ä¸éœ€è¦ç™»å½•è®¿é—®çš„è´¦æˆ·ã€‚ÙNEnsure that `root` has a strong password and that this password is not shared.ÙDç¡®ä¿ `root` æ‹¥æœ‰ä¸€ä¸ªå¼ºå¯†ç ï¼Œå¹¶ä¸”ä¸è¦å…±äº«è¯¥å¯†ç ã€‚Ù4To deny login access to accounts, two methods exist.Ù$æ‹’ç»ç™»å½•è´¦æˆ·æœ‰ä¸¤ç§æ–¹æ³•ã€‚ÙUThe first is to lock the account, this example shows how to lock the `imani` account:ÙNç¬¬ä¸€æ­¥æ˜¯é”å®šè´¦æˆ·ï¼Œè¿™ä¸ªä¾‹å­å±•ç¤ºäº†å¦‚ä½•é”å®š `imani` è´¦æˆ·ï¼šÙÒThe second method is to prevent login access by changing the shell to [.filename]#/usr/sbin/nologin#.  The man:nologin[8] shell prevents the system from assigning a shell to the user when they attempt to login.Ù²ç¬¬äºŒç§æ–¹æ³•æ˜¯é€šè¿‡å°† shell æ›´æ”¹ä¸º [.filename]#/usr/sbin/nologin# æ¥é˜»æ­¢ç™»å½•è®¿é—®ã€‚ man:nologin[8] shell åœ¨ç”¨æˆ·å°è¯•ç™»å½•æ—¶é˜»æ­¢ç³»ç»Ÿä¸ºå…¶åˆ†é… shellã€‚Ù8Only the superuser can change the shell for other users:Ù6åªæœ‰è¶…çº§ç”¨æˆ·æ‰èƒ½æ›´æ”¹å…¶ä»–ç”¨æˆ·çš„ Shellã€‚¯Password Hashes¯å¯†ç å“ˆå¸Œå€¼Ú^Passwords are a necessary evil of technology.  When they must be used, they should be complex and a powerful hash mechanism should be used to encrypt the version that is stored in the password database.  FreeBSD supports several algorithms, including SHA256, SHA512 and Blowfish hash algorithms in its `crypt()` library, see man:crypt[3] for details.ÚCå¯†ç æ˜¯æŠ€æœ¯ä¸­ä¸å¯æˆ–ç¼ºçš„æ¶é­”ã€‚å½“å¿…é¡»ä½¿ç”¨å¯†ç æ—¶ï¼Œå®ƒä»¬åº”è¯¥æ˜¯å¤æ‚çš„ï¼Œå¹¶ä¸”åº”è¯¥ä½¿ç”¨å¼ºå¤§çš„å“ˆå¸Œæœºåˆ¶æ¥åŠ å¯†å­˜å‚¨åœ¨å¯†ç æ•°æ®åº“ä¸­çš„ç‰ˆæœ¬ã€‚FreeBSD æ”¯æŒå¤šç§ç®—æ³•ï¼ŒåŒ…æ‹¬ SHA256ã€SHA512 å’Œ Blowfish å“ˆå¸Œç®—æ³•åœ¨å…¶ `crypt()` åº“ä¸­ï¼Œè¯¦ç»†ä¿¡æ¯è¯·å‚é˜… man:crypt[3]ã€‚Ù‰The default of SHA512 should not be changed to a less secure hashing algorithm, but can be changed to the more secure Blowfish algorithm.Ùuä¸åº”å°† SHA512 çš„é»˜è®¤å€¼æ›´æ”¹ä¸ºè¾ƒä¸å®‰å…¨çš„å“ˆå¸Œç®—æ³•ï¼Œä½†å¯ä»¥æ›´æ”¹ä¸ºæ›´å®‰å…¨çš„ Blowfish ç®—æ³•ã€‚Ù©Blowfish is not part of AES and is not considered compliant with any Federal Information Processing Standards (FIPS).  Its use may not be permitted in some environments.ÙBlowfish ä¸æ˜¯ AES çš„ä¸€éƒ¨åˆ†ï¼Œä¹Ÿä¸è¢«è®¤ä¸ºç¬¦åˆä»»ä½•è”é‚¦ä¿¡æ¯å¤„ç†æ ‡å‡†ï¼ˆFIPSï¼‰ã€‚åœ¨æŸäº›ç¯å¢ƒä¸­å¯èƒ½ä¸å…è®¸ä½¿ç”¨ã€‚ÙÿTo determine which hash algorithm is used to encrypt a user's password, the superuser can view the hash for the user in the FreeBSD password database.  Each hash starts with a symbol which indicates the type of hash mechanism used to encrypt the password.Ùää¸ºäº†ç¡®å®šç”¨äºåŠ å¯†ç”¨æˆ·å¯†ç çš„å“ˆå¸Œç®—æ³•ï¼Œè¶…çº§ç”¨æˆ·å¯ä»¥æŸ¥çœ‹ FreeBSD å¯†ç æ•°æ®åº“ä¸­ç”¨æˆ·çš„å“ˆå¸Œå€¼ã€‚æ¯ä¸ªå“ˆå¸Œå€¼éƒ½ä»¥ä¸€ä¸ªç¬¦å·å¼€å¤´ï¼Œè¯¥ç¬¦å·æŒ‡ç¤ºç”¨äºåŠ å¯†å¯†ç çš„å“ˆå¸Œæœºåˆ¶çš„ç±»å‹ã€‚ÚoIf DES is used, there is no beginning symbol.  For MD5, the symbol is `$`.  For SHA256 and SHA512, the symbol is `$6$`.  For Blowfish, the symbol is `$2a$`.  In this example, the password for `imani` is hashed using the default SHA512 algorithm as the hash starts with `$6$`.  Note that the encrypted hash, not the password itself, is stored in the password database:Ú©å¦‚æœä½¿ç”¨ DES åŠ å¯†ç®—æ³•ï¼Œæ²¡æœ‰èµ·å§‹ç¬¦å·ã€‚å¯¹äº MD5 ç®—æ³•ï¼Œèµ·å§‹ç¬¦å·æ˜¯ `$`ã€‚å¯¹äº SHA256 å’Œ SHA512 ç®—æ³•ï¼Œèµ·å§‹ç¬¦å·æ˜¯ `$6$`ã€‚å¯¹äº Blowfish ç®—æ³•ï¼Œèµ·å§‹ç¬¦å·æ˜¯ `$2a$`ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œç”¨æˆ· `imani` çš„å¯†ç ä½¿ç”¨é»˜è®¤çš„ SHA512 ç®—æ³•è¿›è¡Œå“ˆå¸Œå¤„ç†ï¼Œå› ä¸ºå“ˆå¸Œå€¼ä»¥ `$6$` å¼€å¤´ã€‚è¯·æ³¨æ„ï¼Œå­˜å‚¨åœ¨å¯†ç æ•°æ®åº“ä¸­çš„æ˜¯åŠ å¯†åçš„å“ˆå¸Œå€¼ï¼Œè€Œä¸æ˜¯å¯†ç æœ¬èº«ã€‚Ù4The hash mechanism is set in the user's login class.Ù3å“ˆå¸Œæœºåˆ¶æ˜¯è®¾ç½®åœ¨ç”¨æˆ·çš„ç™»å½•ç±»ä¸­çš„ã€‚ÙWThe following command can be run to check which hash mechanism is currently being used:Ù?å¯ä»¥è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥æ£€æŸ¥å½“å‰ä½¿ç”¨çš„å“ˆå¸Œæœºåˆ¶ï¼šÙUFor example, to change the algorithm to Blowfish, modify that line to look like this:ÙKä¾‹å¦‚ï¼Œè¦å°†ç®—æ³•æ›´æ”¹ä¸º Blowfishï¼Œå°†è¯¥è¡Œä¿®æ”¹ä¸ºä»¥ä¸‹å†…å®¹ï¼šÙJThen, man:cap_mkdb[1] must be executed to upgrade the login.conf database:ÙMç„¶åï¼Œå¿…é¡»æ‰§è¡Œ man:cap_mkdb[1] å‘½ä»¤æ¥å‡çº§ login.conf æ•°æ®åº“ï¼šÙ¹Note that this change will not affect any existing password hashes.  This means that all passwords should be re-hashed by asking users to run `passwd` in order to change their password.Ù¯è¯·æ³¨æ„ï¼Œæ­¤æ›´æ”¹ä¸ä¼šå½±å“ä»»ä½•ç°æœ‰çš„å¯†ç å“ˆå¸Œå€¼ã€‚è¿™æ„å‘³ç€æ‰€æœ‰å¯†ç éƒ½åº”é€šè¿‡è¦æ±‚ç”¨æˆ·è¿è¡Œ `passwd` æ¥é‡æ–°å“ˆå¸Œï¼Œä»¥æ›´æ”¹ä»–ä»¬çš„å¯†ç ã€‚»Password Policy Enforcement¸å¯†ç ç­–ç•¥å¼ºåˆ¶æ‰§è¡ŒÙôEnforcing a strong password policy for local accounts is a fundamental aspect of system security.  In FreeBSD, password length, password strength, and password complexity can be implemented using built-in Pluggable Authentication Modules (PAM).ÙÉå¯¹æœ¬åœ°è´¦æˆ·å¼ºåˆ¶æ‰§è¡Œå¼ºå¯†ç ç­–ç•¥æ˜¯ç³»ç»Ÿå®‰å…¨çš„åŸºæœ¬æ–¹é¢ã€‚åœ¨ FreeBSD ä¸­ï¼Œå¯ä»¥ä½¿ç”¨å†…ç½®çš„å¯æ’æ‹”è®¤è¯æ¨¡å—ï¼ˆPAMï¼‰æ¥å®ç°å¯†ç é•¿åº¦ã€å¯†ç å¼ºåº¦å’Œå¯†ç å¤æ‚æ€§ã€‚ÙİThis section demonstrates how to configure the minimum and maximum password length and the enforcement of mixed characters using the man:pam_passwdqc[8] module.  This module is enforced when a user changes their password.Ù®æœ¬èŠ‚æ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨ man:pam_passwdqc[8] æ¨¡å—é…ç½®æœ€å°å’Œæœ€å¤§å¯†ç é•¿åº¦ä»¥åŠå¼ºåˆ¶ä½¿ç”¨æ··åˆå­—ç¬¦ã€‚å½“ç”¨æˆ·æ›´æ”¹å¯†ç æ—¶ï¼Œå°†å¼ºåˆ¶æ‰§è¡Œæ­¤æ¨¡å—ã€‚Ù…To configure this module, become the superuser and uncomment the line containing `pam_passwdqc.so` in [.filename]#/etc/pam.d/passwd#.Ùè¦é…ç½®æ­¤æ¨¡å—ï¼Œè¯·æˆä¸ºè¶…çº§ç”¨æˆ·ï¼Œå¹¶å–æ¶ˆæ³¨é‡ŠåŒ…å« `pam_passwdqc.so` çš„è¡Œï¼Œä½äº [.filename]#/etc/pam.d/passwd# æ–‡ä»¶ä¸­ã€‚Ù2Then, edit that line to match the password policy:Ù-ç„¶åï¼Œç¼–è¾‘è¯¥è¡Œä»¥ç¬¦åˆå¯†ç ç­–ç•¥ï¼šÙFThe explanation of the parameters can be found in man:pam_passwdqc[8].Ù9å‚æ•°çš„è§£é‡Šå¯ä»¥åœ¨ man:pam_passwdqc[8] ä¸­æ‰¾åˆ°ã€‚ÙdOnce this file is saved, a user changing their password will see a message similar to the following:ÙTä¸€æ—¦ä¿å­˜äº†è¿™ä¸ªæ–‡ä»¶ï¼Œç”¨æˆ·æ›´æ”¹å¯†ç æ—¶å°†çœ‹åˆ°ç±»ä¼¼ä»¥ä¸‹çš„æ¶ˆæ¯ï¼šÙ·If a password that does not match the policy is entered, it will be rejected with a warning and the user will have an opportunity to try again, up to the configured number of retries.Ù“å¦‚æœè¾“å…¥çš„å¯†ç ä¸ç¬¦åˆç­–ç•¥è¦æ±‚ï¼Œç³»ç»Ÿå°†æ‹’ç»å¹¶å‘å‡ºè­¦å‘Šï¼Œç”¨æˆ·å°†æœ‰æœºä¼šå†æ¬¡å°è¯•ï¼Œæœ€å¤šå¯ä»¥é‡è¯•é…ç½®çš„æ¬¡æ•°ã€‚Ù™If your organization's policy requires passwords to expire, FreeBSD supports the `passwordtime` in the user's login class in [.filename]#/etc/login.conf#Ù´å¦‚æœæ‚¨çš„ç»„ç»‡æ”¿ç­–è¦æ±‚å¯†ç è¿‡æœŸï¼ŒFreeBSD æ”¯æŒåœ¨ç”¨æˆ·çš„ç™»å½•ç±»ä¸­ä½¿ç”¨ `passwordtime` é€‰é¡¹ï¼Œè¯¥é€‰é¡¹å¯ä»¥åœ¨ [.filename]#/etc/login.conf# æ–‡ä»¶ä¸­è®¾ç½®ã€‚Ù.The `default` login class contains an example:Ù(`default` ç™»å½•ç±»åŒ…å«ä¸€ä¸ªç¤ºä¾‹ï¼šÙ†So, to set an expiry of 90 days for this login class, remove the comment symbol (#), save the edit, and execute the following command:Ùå› æ­¤ï¼Œè¦ä¸ºæ­¤ç™»å½•ç±»è®¾ç½® 90 å¤©çš„åˆ°æœŸæ—¶é—´ï¼Œåˆ é™¤æ³¨é‡Šç¬¦å·ï¼ˆï¼ƒï¼‰ï¼Œä¿å­˜ç¼–è¾‘ï¼Œå¹¶æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼šÙzTo set the expiration on individual users, pass an expiration date or the number of days to expiry and a username to `pw`:Ùoè¦ä¸ºå•ä¸ªç”¨æˆ·è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œè¯·å°†è¿‡æœŸæ—¥æœŸæˆ–åˆ°æœŸå¤©æ•°ä»¥åŠç”¨æˆ·åä¼ é€’ç»™ `pw` å‘½ä»¤ã€‚ÙrAs seen here, an expiration date is set in the form of day, month, and year.  For more information, see man:pw[8].Ùjå¦‚å›¾æ‰€ç¤ºï¼Œè¿‡æœŸæ—¥æœŸä»¥æ—¥ã€æœˆå’Œå¹´çš„å½¢å¼è®¾ç½®ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜… man:pw[8]ã€‚¿Shared Administration with sudo¾ä½¿ç”¨ sudo è¿›è¡Œå…±äº«ç®¡ç†ÚGSystem administrators often need the ability to grant enhanced permissions to users so they may perform privileged tasks.  The idea that team members are provided access to a FreeBSD system to perform their specific tasks opens up unique challenges to every administrator.  These team members only need a subset of access beyond normal end user levels; however, they almost always tell management they are unable to perform their tasks without superuser access.  Thankfully, there is no reason to provide such access to end users because tools exist to manage this exact requirement.Ú"ç³»ç»Ÿç®¡ç†å‘˜ç»å¸¸éœ€è¦èƒ½å¤Ÿæˆäºˆç”¨æˆ·å¢å¼ºçš„æƒé™ï¼Œä»¥ä¾¿ä»–ä»¬å¯ä»¥æ‰§è¡Œç‰¹æƒä»»åŠ¡ã€‚å›¢é˜Ÿæˆå‘˜è¢«æˆäºˆè®¿é—® FreeBSD ç³»ç»Ÿä»¥æ‰§è¡Œä»–ä»¬çš„ç‰¹å®šä»»åŠ¡çš„æƒ³æ³•ï¼Œç»™æ¯ä¸ªç®¡ç†å‘˜å¸¦æ¥äº†ç‹¬ç‰¹çš„æŒ‘æˆ˜ã€‚è¿™äº›å›¢é˜Ÿæˆå‘˜åªéœ€è¦è¶…å‡ºæ™®é€šç”¨æˆ·çº§åˆ«çš„ä¸€éƒ¨åˆ†è®¿é—®æƒé™ï¼›ç„¶è€Œï¼Œä»–ä»¬å‡ ä¹æ€»æ˜¯å‘Šè¯‰ç®¡ç†å±‚ï¼Œå¦‚æœæ²¡æœ‰è¶…çº§ç”¨æˆ·è®¿é—®æƒé™ï¼Œä»–ä»¬æ— æ³•æ‰§è¡Œä»»åŠ¡ã€‚å¹¸è¿çš„æ˜¯ï¼Œæ²¡æœ‰å¿…è¦ä¸ºç»ˆç«¯ç”¨æˆ·æä¾›è¿™æ ·çš„è®¿é—®æƒé™ï¼Œå› ä¸ºå­˜åœ¨å¯ä»¥ç®¡ç†è¿™ä¸ªç¡®åˆ‡éœ€æ±‚çš„å·¥å…·ã€‚ÙBEven administrators should limit their privileges when not needed.ÙEå³ä½¿æ˜¯ç®¡ç†å‘˜ï¼Œåœ¨ä¸éœ€è¦æ—¶ä¹Ÿåº”è¯¥é™åˆ¶ä»–ä»¬çš„æƒé™ã€‚ÚUp to this point, the security chapter has covered permitting access to authorized users and attempting to prevent unauthorized access.  Another problem arises once authorized users have access to the system resources.  In many cases, some users may need access to application startup scripts, or a team of administrators need to maintain the system.  Traditionally, the standard users and groups, file permissions, and even the man:su[1] command would manage this access.  And as applications required more access, as more users needed to use system resources, a better solution was required.  The most used application is currently Sudo.ÚVåˆ°ç›®å‰ä¸ºæ­¢ï¼Œå®‰å…¨ç« èŠ‚å·²ç»æ¶µç›–äº†å…è®¸æˆæƒç”¨æˆ·è®¿é—®å’Œé˜²æ­¢æœªç»æˆæƒè®¿é—®çš„å†…å®¹ã€‚ä¸€æ—¦æˆæƒç”¨æˆ·è·å¾—ç³»ç»Ÿèµ„æºçš„è®¿é—®æƒé™ï¼Œå¦ä¸€ä¸ªé—®é¢˜å°±å‡ºç°äº†ã€‚åœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œä¸€äº›ç”¨æˆ·å¯èƒ½éœ€è¦è®¿é—®åº”ç”¨ç¨‹åºå¯åŠ¨è„šæœ¬ï¼Œæˆ–è€…ä¸€ä¸ªç®¡ç†å‘˜å›¢é˜Ÿéœ€è¦ç»´æŠ¤ç³»ç»Ÿã€‚ä¼ ç»Ÿä¸Šï¼Œæ ‡å‡†ç”¨æˆ·å’Œç»„ã€æ–‡ä»¶æƒé™ï¼Œç”šè‡³ man:su[1] å‘½ä»¤éƒ½å¯ä»¥ç®¡ç†è¿™ç§è®¿é—®æƒé™ã€‚éšç€åº”ç”¨ç¨‹åºéœ€è¦æ›´å¤šçš„è®¿é—®æƒé™ï¼Œè¶Šæ¥è¶Šå¤šçš„ç”¨æˆ·éœ€è¦ä½¿ç”¨ç³»ç»Ÿèµ„æºï¼Œéœ€è¦ä¸€ä¸ªæ›´å¥½çš„è§£å†³æ–¹æ¡ˆã€‚ç›®å‰æœ€å¸¸ç”¨çš„åº”ç”¨ç¨‹åºæ˜¯ Sudoã€‚ÙòSudo allows administrators to configure more rigid access to system commands and provide for some advanced logging features.  As a tool, it is available from the Ports Collection as package:security/sudo[] or by use of the man:pkg[8] utility.ÙğSudo å…è®¸ç®¡ç†å‘˜å¯¹ç³»ç»Ÿå‘½ä»¤è¿›è¡Œæ›´ä¸¥æ ¼çš„è®¿é—®é…ç½®ï¼Œå¹¶æä¾›ä¸€äº›é«˜çº§æ—¥å¿—è®°å½•åŠŸèƒ½ã€‚ä½œä¸ºä¸€ä¸ªå·¥å…·ï¼Œå¯ä»¥é€šè¿‡ Ports Collection ä¸­çš„ package:security/sudo[] åŒ…æˆ–ä½¿ç”¨ man:pkg[8] å®ç”¨ç¨‹åºæ¥è·å–ã€‚Ù,Execute the following command to install it:Ù!æ‰§è¡Œä»¥ä¸‹å‘½ä»¤è¿›è¡Œå®‰è£…ï¼šÙøAfter the installation is complete, the installed `visudo` will open the configuration file with a text editor.  Using `visudo` is highly recommended as it comes with a built in syntax checker to verify there are no errors before the file is saved.ÙÊå®‰è£…å®Œæˆåï¼Œå®‰è£…çš„ `visudo` å°†ä½¿ç”¨æ–‡æœ¬ç¼–è¾‘å™¨æ‰“å¼€é…ç½®æ–‡ä»¶ã€‚å¼ºçƒˆå»ºè®®ä½¿ç”¨ `visudo`ï¼Œå› ä¸ºå®ƒå†…ç½®äº†è¯­æ³•æ£€æŸ¥å™¨ï¼Œå¯ä»¥åœ¨ä¿å­˜æ–‡ä»¶ä¹‹å‰éªŒè¯æ˜¯å¦å­˜åœ¨é”™è¯¯ã€‚ÚgThe configuration file is made up of several small sections which allow for extensive configuration.  In the following example, web application maintainer, user1, needs to start, stop, and restart the web application known as _webservice_.  To grant this user permission to perform these tasks, add this line to the end of [.filename]#/usr/local/etc/sudoers#:ÚLé…ç½®æ–‡ä»¶ç”±å‡ ä¸ªå°èŠ‚ç»„æˆï¼Œå…è®¸è¿›è¡Œå¹¿æ³›çš„é…ç½®ã€‚åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œ Web åº”ç”¨ç¨‹åºç»´æŠ¤è€… user1 éœ€è¦å¯åŠ¨ã€åœæ­¢å’Œé‡æ–°å¯åŠ¨åä¸º _webservice_ çš„ Web åº”ç”¨ç¨‹åºã€‚ä¸ºäº†æˆäºˆè¯¥ç”¨æˆ·æ‰§è¡Œè¿™äº›ä»»åŠ¡çš„æƒé™ï¼Œè¯·å°†ä»¥ä¸‹è¡Œæ·»åŠ åˆ° [.filename]#/usr/local/etc/sudoers# æ–‡ä»¶çš„æœ«å°¾ï¼šÙ7The user may now start _webservice_ using this command:Ù:ç”¨æˆ·ç°åœ¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¯åŠ¨ _webservice_ï¼šÚ`While this configuration allows a single user access to the webservice service; however, in most organizations, there is an entire web team in charge of managing the service.  A single line can also give access to an entire group.  These steps will create a web group, add a user to this group, and allow all members of the group to manage the service:ÚGè™½ç„¶è¿™ä¸ªé…ç½®å…è®¸å•ä¸ªç”¨æˆ·è®¿é—® webservice æœåŠ¡ï¼›ç„¶è€Œï¼Œåœ¨å¤§å¤šæ•°ç»„ç»‡ä¸­ï¼Œæœ‰ä¸€ä¸ªå®Œæ•´çš„ç½‘ç»œå›¢é˜Ÿè´Ÿè´£ç®¡ç†è¯¥æœåŠ¡ã€‚ä¸€æ¡å•ç‹¬çš„å‘½ä»¤ä¹Ÿå¯ä»¥ç»™æ•´ä¸ªç»„æä¾›è®¿é—®æƒé™ã€‚ä»¥ä¸‹æ­¥éª¤å°†åˆ›å»ºä¸€ä¸ªç½‘ç»œç»„ï¼Œå°†ç”¨æˆ·æ·»åŠ åˆ°è¯¥ç»„ï¼Œå¹¶å…è®¸è¯¥ç»„çš„æ‰€æœ‰æˆå‘˜ç®¡ç†è¯¥æœåŠ¡ï¼šÙIUsing the same man:pw[8] command, the user is added to the webteam group:ÙGä½¿ç”¨ç›¸åŒçš„ man:pw[8] å‘½ä»¤ï¼Œå°†ç”¨æˆ·æ·»åŠ åˆ° webteam ç»„ä¸­ï¼šÙxFinally, this line in [.filename]#/usr/local/etc/sudoers# allows any member of the webteam group to manage _webservice_:Ù}æœ€åï¼Œè¿™è¡Œä»£ç åœ¨æ–‡ä»¶ [.filename]#/usr/local/etc/sudoers# ä¸­å…è®¸ webteam ç»„çš„ä»»ä½•æˆå‘˜ç®¡ç† _webservice_ã€‚Ù|Unlike man:su[1], man:sudo[8] only requires the end user password.  This avoids sharing passwords, which is a poor practice.Ùtä¸ man:su[1] ä¸åŒï¼Œman:sudo[8] åªéœ€è¦æœ€ç»ˆç”¨æˆ·çš„å¯†ç ã€‚è¿™å°±é¿å…äº†å…±äº«å¯†ç è¿™ç§ä¸è‰¯åšæ³•ã€‚ÙåUsers permitted to run applications with man:sudo[8] only enter their own passwords.  This is more secure and gives better control than man:su[1], where the `root` password is entered and the user acquires all `root` permissions.Ùùåªæœ‰è¢«å…è®¸ä½¿ç”¨ man:sudo[8] è¿è¡Œåº”ç”¨ç¨‹åºçš„ç”¨æˆ·éœ€è¦è¾“å…¥è‡ªå·±çš„å¯†ç ã€‚è¿™æ¯”ä½¿ç”¨ man:su[1] æ›´å®‰å…¨ï¼Œå¹¶ä¸”æä¾›äº†æ›´å¥½çš„æ§åˆ¶ï¼Œå› ä¸ºåœ¨ man:su[1] ä¸­éœ€è¦è¾“å…¥ `root` å¯†ç ï¼Œç”¨æˆ·å°†è·å¾—æ‰€æœ‰ `root` æƒé™ã€‚Ù‘Most organizations are moving or have moved toward a two factor authentication model.  In these cases, the user may not have a password to enter.Ù~å¤§å¤šæ•°ç»„ç»‡æ­£åœ¨è½¬å‘æˆ–å·²ç»é‡‡ç”¨äº†åŒå› ç´ è®¤è¯æ¨¡å‹ã€‚åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œç”¨æˆ·å¯èƒ½æ²¡æœ‰å¯†ç å¯è¾“å…¥ã€‚Ùõman:sudo[8] can be configured to permit two factor authentication model by using the `NOPASSWD` variable.  Adding it to the configuration above will allow all members of the _webteam_ group to manage the service without the password requirement:ÙËman:sudo[8] å¯ä»¥é€šè¿‡ä½¿ç”¨ `NOPASSWD` å˜é‡æ¥é…ç½®å…è®¸åŒå› ç´ è®¤è¯æ¨¡å‹ã€‚å°†å…¶æ·»åŠ åˆ°ä¸Šè¿°é…ç½®ä¸­å°†å…è®¸ _webteam_ ç»„çš„æ‰€æœ‰æˆå‘˜åœ¨ä¸éœ€è¦å¯†ç çš„æƒ…å†µä¸‹ç®¡ç†è¯¥æœåŠ¡ã€‚¿Shared Administration with Doas¾ä½¿ç”¨ Doas è¿›è¡Œå…±äº«ç®¡ç†Ù”man:doas[1] is a command-line utility ported from OpenBSD.  It serves as an alternative to the widely used man:sudo[8] command in Unix-like systems.Ù–man:doas[1] æ˜¯ä¸€ä¸ªä» OpenBSD ç§»æ¤è¿‡æ¥çš„å‘½ä»¤è¡Œå®ç”¨ç¨‹åºã€‚å®ƒä½œä¸º Unix-like ç³»ç»Ÿä¸­å¹¿æ³›ä½¿ç”¨çš„ man:sudo[8] å‘½ä»¤çš„æ›¿ä»£å“ã€‚Ú@With doas, users can execute commands with elevated privileges, typically as the root user, while maintaining a simplified and security-conscious approach.  Unlike man:sudo[8], doas emphasizes simplicity and minimalism, focusing on streamlined privilege delegation without an overwhelming array of configuration options.Ú
ä½¿ç”¨ doasï¼Œç”¨æˆ·å¯ä»¥ä»¥æå‡çš„æƒé™æ‰§è¡Œå‘½ä»¤ï¼Œé€šå¸¸æ˜¯ä½œä¸º root ç”¨æˆ·ï¼ŒåŒæ—¶ä¿æŒç®€åŒ–å’Œæ³¨é‡å®‰å…¨çš„æ–¹æ³•ã€‚ä¸ man:sudo[8] ä¸åŒï¼Œdoas å¼ºè°ƒç®€å•å’Œæç®€ä¸»ä¹‰ï¼Œä¸“æ³¨äºç®€åŒ–çš„æƒé™å§”æ´¾ï¼Œè€Œä¸æ˜¯æä¾›è¿‡å¤šçš„é…ç½®é€‰é¡¹ã€‚ÙŠAfter the installation [.filename]#/usr/local/etc/doas.conf# must be configured to grant access for users for specific commands, or roles.Ù€å®‰è£…å®Œæˆåï¼Œå¿…é¡»é…ç½® [.filename]#/usr/local/etc/doas.conf#ï¼Œä»¥æˆäºˆç”¨æˆ·å¯¹ç‰¹å®šå‘½ä»¤æˆ–è§’è‰²çš„è®¿é—®æƒé™ã€‚Ù§The simpliest entry could be the following, which grants the user `local_user` with `root` permissions without asking for its password when executing the doas command.Ù‹æœ€ç®€å•çš„æ¡ç›®å¯ä»¥æ˜¯ä»¥ä¸‹å†…å®¹ï¼Œå®ƒåœ¨æ‰§è¡Œ doas å‘½ä»¤æ—¶æˆäºˆç”¨æˆ· `local_user` ä»¥ `root` æƒé™ï¼Œè€Œæ— éœ€è¾“å…¥å¯†ç ã€‚Ù„After the installation and configuration of the `doas` utility, a command can now be executed with enhanced privileges, for example:Ùhåœ¨å®‰è£…å’Œé…ç½® `doas` å®ç”¨ç¨‹åºä¹‹åï¼Œç°åœ¨å¯ä»¥ä½¿ç”¨å¢å¼ºçš„æƒé™æ‰§è¡Œå‘½ä»¤ï¼Œä¾‹å¦‚ï¼šÙ>For more configuration examples, please read man:doas.conf[5].Ù>è¦è·å–æ›´å¤šçš„é…ç½®ç¤ºä¾‹ï¼Œè¯·é˜…è¯» man:doas.conf[5]ã€‚Ù Intrusion Detection System (IDS)»å…¥ä¾µæ£€æµ‹ç³»ç»Ÿï¼ˆIDSï¼‰ÚVerification of system files and binaries is important because it provides the system administration and security teams information about system changes.  A software application that monitors the system for changes is called an Intrusion Detection System (IDS).ÙÃéªŒè¯ç³»ç»Ÿæ–‡ä»¶å’ŒäºŒè¿›åˆ¶æ–‡ä»¶çš„é‡è¦æ€§åœ¨äºä¸ºç³»ç»Ÿç®¡ç†å’Œå®‰å…¨å›¢é˜Ÿæä¾›æœ‰å…³ç³»ç»Ÿå˜åŒ–çš„ä¿¡æ¯ã€‚ç›‘æ§ç³»ç»Ÿå˜åŒ–çš„è½¯ä»¶åº”ç”¨ç¨‹åºç§°ä¸ºå…¥ä¾µæ£€æµ‹ç³»ç»Ÿï¼ˆIDSï¼‰ã€‚ÚéFreeBSD provides native support for a basic IDS system called man:mtree[8].  While the nightly security emails will notify an administrator of changes, the information is stored locally and there is a chance that a malicious user could modify this information in order to hide their changes to the system.  As such, it is recommended to create a separate set of binary signatures and store them on a read-only, root-owned directory or, preferably, on a removable USB disk or remote server.ÚÊFreeBSD æä¾›äº†å¯¹ä¸€ç§åä¸º man:mtree[8] çš„åŸºæœ¬ IDS ç³»ç»Ÿçš„æœ¬åœ°æ”¯æŒã€‚è™½ç„¶æ¯æ™šçš„å®‰å…¨ç”µå­é‚®ä»¶ä¼šé€šçŸ¥ç®¡ç†å‘˜æœ‰å…³ç³»ç»Ÿå˜æ›´çš„ä¿¡æ¯ï¼Œä½†è¿™äº›ä¿¡æ¯æ˜¯å­˜å‚¨åœ¨æœ¬åœ°çš„ï¼Œæ¶æ„ç”¨æˆ·æœ‰å¯èƒ½ä¿®æ”¹è¿™äº›ä¿¡æ¯ä»¥éšè—å¯¹ç³»ç»Ÿçš„æ›´æ”¹ã€‚å› æ­¤ï¼Œå»ºè®®åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„äºŒè¿›åˆ¶ç­¾åé›†ï¼Œå¹¶å°†å…¶å­˜å‚¨åœ¨åªè¯»ã€å±äº root çš„ç›®å½•ä¸Šï¼Œæˆ–è€…æ›´å¥½åœ°ï¼Œå­˜å‚¨åœ¨å¯ç§»åŠ¨çš„ USB ç£ç›˜æˆ–è¿œç¨‹æœåŠ¡å™¨ä¸Šã€‚ÙEIt is also recommended to run `freebsd-update IDS` after each update.Ù6æ¯æ¬¡æ›´æ–°åï¼Œå»ºè®®è¿è¡Œ `freebsd-update IDS`ã€‚Ù!Generating the Specification File²ç”Ÿæˆè§„èŒƒæ–‡ä»¶Ú¾The built-in man:mtree[8] utility can be used to generate a specification of the contents of a directory.  A seed, or a numeric constant, is used to generate the specification and is required to check that the specification has not changed.  This makes it possible to determine if a file or binary has been modified.  Since the seed value is unknown by an attacker, faking or checking the checksum values of files will be difficult to impossible.Úgå†…ç½®çš„ man:mtree[8] å®ç”¨ç¨‹åºå¯ç”¨äºç”Ÿæˆç›®å½•å†…å®¹çš„è§„èŒƒã€‚ä½¿ç”¨ç§å­æˆ–æ•°å­—å¸¸é‡ç”Ÿæˆè§„èŒƒï¼Œå¹¶ä¸”éœ€è¦ä½¿ç”¨ç§å­æ¥æ£€æŸ¥è§„èŒƒæ˜¯å¦å‘ç”Ÿäº†å˜åŒ–ã€‚è¿™ä½¿å¾—å¯ä»¥ç¡®å®šæ–‡ä»¶æˆ–äºŒè¿›åˆ¶æ–‡ä»¶æ˜¯å¦å·²è¢«ä¿®æ”¹ã€‚ç”±äºæ”»å‡»è€…ä¸çŸ¥é“ç§å­å€¼ï¼Œå› æ­¤ä¼ªé€ æˆ–æ£€æŸ¥æ–‡ä»¶çš„æ ¡éªŒå’Œå€¼å°†å˜å¾—å›°éš¾æˆ–å‡ ä¹ä¸å¯èƒ½ã€‚ÚvIt is recommended to create specifications for the directories which contain binaries and configuration files, as well as any directories containing sensitive data.  Typically, specifications are created for [.filename]#/bin#, [.filename]#/sbin#, [.filename]#/usr/bin#, [.filename]#/usr/sbin#, [.filename]#/usr/local/bin#, [.filename]#/etc#, and [.filename]#/usr/local/etc#.Ú/å»ºè®®ä¸ºåŒ…å«äºŒè¿›åˆ¶æ–‡ä»¶å’Œé…ç½®æ–‡ä»¶çš„ç›®å½•ä»¥åŠåŒ…å«æ•æ„Ÿæ•°æ®çš„ç›®å½•åˆ›å»ºè§„èŒƒã€‚é€šå¸¸ï¼Œä¼šä¸º [.filename]#/bin#ã€[.filename]#/sbin#ã€[.filename]#/usr/bin#ã€[.filename]#/usr/sbin#ã€[.filename]#/usr/local/bin#ã€[.filename]#/etc# å’Œ [.filename]#/usr/local/etc# åˆ›å»ºè§„èŒƒã€‚Ù×The following example generates a set of `sha512` hashes, one for each system binary in [.filename]#/bin#, and saves those values to a hidden file in user's home directory, [.filename]#/home/user/.bin_chksum_mtree#:Ùçä»¥ä¸‹ç¤ºä¾‹ç”Ÿæˆä¸€ç»„ `sha512` å“ˆå¸Œå€¼ï¼Œæ¯ä¸ªå“ˆå¸Œå€¼å¯¹åº”äº [.filename]#/bin# ç›®å½•ä¸­çš„ç³»ç»ŸäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¹¶å°†è¿™äº›å€¼ä¿å­˜åˆ°ç”¨æˆ·ä¸»ç›®å½•ä¸‹çš„éšè—æ–‡ä»¶ [.filename]#/home/user/.bin_chksum_mtree# ä¸­ã€‚Ù}The `123456789` value represents the seed, and should be chosen randomly.  This value should be remembered, *but not shared*.Ùc`123456789` å€¼ä»£è¡¨ç§å­ï¼Œåº”è¯¥éšæœºé€‰æ‹©ã€‚è¿™ä¸ªå€¼åº”è¯¥è¢«è®°ä½ï¼Œ*ä½†ä¸è¦åˆ†äº«* ã€‚Ù[It is important to keep the seed value and the checksum output hidden from malicious users.ÙEå°†ç§å­å€¼å’Œæ ¡éªŒå’Œè¾“å‡ºå¯¹æ¶æ„ç”¨æˆ·ä¿å¯†æ˜¯å¾ˆé‡è¦çš„ã€‚Ù The Specification File Structure²è§„èŒƒæ–‡ä»¶ç»“æ„Ù¡The mtree format is a textual format that describes a collection of filesystem objects.  Such files are typically used to create or verify directory hierarchies.Ùmtree æ ¼å¼æ˜¯ä¸€ç§æè¿°æ–‡ä»¶ç³»ç»Ÿå¯¹è±¡é›†åˆçš„æ–‡æœ¬æ ¼å¼ã€‚è¿™ç§æ–‡ä»¶é€šå¸¸ç”¨äºåˆ›å»ºæˆ–éªŒè¯ç›®å½•å±‚æ¬¡ç»“æ„ã€‚ÙAn mtree file consists of a series of lines, each providing information about a single filesystem object. Leading whitespace is always ignored.Ùä¸€ä¸ª mtree æ–‡ä»¶ç”±ä¸€ç³»åˆ—è¡Œç»„æˆï¼Œæ¯è¡Œæä¾›æœ‰å…³å•ä¸ªæ–‡ä»¶ç³»ç»Ÿå¯¹è±¡çš„ä¿¡æ¯ã€‚å‰å¯¼ç©ºæ ¼å§‹ç»ˆè¢«å¿½ç•¥ã€‚ÙTThe specification file created above will be used to explain the format and content:Ù<ä¸Šé¢åˆ›å»ºçš„è§„èŒƒæ–‡ä»¶å°†ç”¨äºè§£é‡Šæ ¼å¼å’Œå†…å®¹ï¼šÚë<.> User who created the specification.  <.> Machine's hostname.  <.> Directory path.  <.> The Date and time when the specification was created.  <.> `/set` special commands, defines some settings obtained from the files analyzed.  <.> Refers to the parsed directory and indicates things like what type it is, its mode, the number of hard links, and the time in UNIX format since it was modified.  <.> Refers to the file and shows the size, time and a list of hashes to verify the integrity.Ú‹<.> åˆ›å»ºè§„èŒƒçš„ç”¨æˆ·ã€‚ <.> æœºå™¨çš„ä¸»æœºåã€‚ <.> ç›®å½•è·¯å¾„ã€‚ <.> è§„èŒƒåˆ›å»ºçš„æ—¥æœŸå’Œæ—¶é—´ã€‚ <.> `/set` ç‰¹æ®Šå‘½ä»¤ï¼Œå®šä¹‰ä»åˆ†æçš„æ–‡ä»¶ä¸­è·å–çš„ä¸€äº›è®¾ç½®ã€‚ <.> æŒ‡çš„æ˜¯è§£æçš„ç›®å½•ï¼Œå¹¶æŒ‡ç¤ºå…¶ç±»å‹ã€æ¨¡å¼ã€ç¡¬é“¾æ¥æ•°é‡å’Œè‡ªä¿®æ”¹ä»¥æ¥çš„ UNIX æ ¼å¼æ—¶é—´ã€‚ <.> æŒ‡çš„æ˜¯æ–‡ä»¶ï¼Œæ˜¾ç¤ºå¤§å°ã€æ—¶é—´å’Œä¸€ç³»åˆ—å“ˆå¸Œå€¼ä»¥éªŒè¯å®Œæ•´æ€§ã€‚½Verify the Specification file²éªŒè¯è§„èŒƒæ–‡ä»¶Ù¯To verify that the binary signatures have not changed, compare the current contents of the directory to the previously generated specification, and save the results to a file.Ù“ä¸ºäº†éªŒè¯äºŒè¿›åˆ¶ç­¾åæ˜¯å¦å‘ç”Ÿäº†å˜åŒ–ï¼Œå°†å½“å‰ç›®å½•çš„å†…å®¹ä¸å…ˆå‰ç”Ÿæˆçš„è§„èŒƒè¿›è¡Œæ¯”è¾ƒï¼Œå¹¶å°†ç»“æœä¿å­˜åˆ°æ–‡ä»¶ä¸­ã€‚ÙTThis command requires the seed that was used to generate the original specification:Ù3è¯¥å‘½ä»¤éœ€è¦ç”¨äºç”ŸæˆåŸå§‹è§„èŒƒçš„ç§å­ã€‚ÙûThis should produce the same checksum for [.filename]#/bin# that was produced when the specification was created.  If no changes have occurred to the binaries in this directory, the [.filename]#/home/user/.bin_chksum_output# output file will be empty.ÙÕè¿™åº”è¯¥ä¼šä¸º [.filename]#/bin# ç”Ÿæˆä¸åˆ›å»ºè§„èŒƒæ—¶ç›¸åŒçš„æ ¡éªŒå’Œã€‚å¦‚æœåœ¨æ­¤ç›®å½•ä¸­çš„äºŒè¿›åˆ¶æ–‡ä»¶æ²¡æœ‰å‘ç”Ÿä»»ä½•æ›´æ”¹ï¼Œ [.filename]#/home/user/.bin_chksum_output# è¾“å‡ºæ–‡ä»¶å°†ä¸ºç©ºã€‚ÙyTo simulate a change, change the date on [.filename]#/bin/cat# using man:touch[1] and run the verification command again:Ùä¸ºäº†æ¨¡æ‹Ÿä¸€ä¸ªå˜åŒ–ï¼Œä½¿ç”¨ man:touch[1] å‘½ä»¤æ›´æ”¹ [.filename]#/bin/cat# çš„æ—¥æœŸï¼Œç„¶åå†æ¬¡è¿è¡ŒéªŒè¯å‘½ä»¤ï¼šÙ#Run the verification command again:»å†æ¬¡è¿è¡ŒéªŒè¯å‘½ä»¤ï¼šÙ.And then check the content of the output file:Ù$ç„¶åæ£€æŸ¥è¾“å‡ºæ–‡ä»¶çš„å†…å®¹ï¼šÙ„This is just an example of what would be displayed when executing the command, to show the changes that would occur in the metadata.ÙKè¿™åªæ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œå±•ç¤ºæ‰§è¡Œå‘½ä»¤æ—¶å°†æ˜¾ç¤ºçš„å…ƒæ•°æ®æ›´æ”¹ã€‚­Secure levels¬å®‰å…¨çº§åˆ«Ùºsecurelevel is a security mechanism implemented in the kernel.  When the securelevel is positive, the kernel restricts certain tasks; not even the superuser (root) is allowed to do them.Ù¿securelevel æ˜¯å†…æ ¸ä¸­å®ç°çš„ä¸€ç§å®‰å…¨æœºåˆ¶ã€‚å½“ securelevel ä¸ºæ­£æ•°æ—¶ï¼Œå†…æ ¸ä¼šé™åˆ¶æŸäº›ä»»åŠ¡çš„æ‰§è¡Œï¼›å³ä½¿æ˜¯è¶…çº§ç”¨æˆ·ï¼ˆrootï¼‰ä¹Ÿä¸è¢«å…è®¸æ‰§è¡Œè¿™äº›ä»»åŠ¡ã€‚Ù0The securelevel mechanism limits the ability to:Ù*securelevel æœºåˆ¶é™åˆ¶äº†ä»¥ä¸‹èƒ½åŠ›ï¼šÙEUnset certain file flags, such as `schg` (the system immutable flag).ÙFå–æ¶ˆç‰¹å®šæ–‡ä»¶æ ‡å¿—ï¼Œä¾‹å¦‚ `schg`ï¼ˆç³»ç»Ÿä¸å¯å˜æ ‡å¿—ï¼‰ã€‚ÙLWrite to kernel memory via [.filename]#/dev/mem# and [.filename]#/dev/kmem#.ÙPé€šè¿‡ [.filename]#/dev/mem# å’Œ [.filename]#/dev/kmem# æ¥å†™å…¥å†…æ ¸å†…å­˜ã€‚´Load kernel modules.µåŠ è½½å†…æ ¸æ¨¡å—ã€‚µAlter firewall rules.¸ä¿®æ”¹é˜²ç«å¢™è§„åˆ™ã€‚¹Secure Levels Definitions²å®‰å…¨çº§åˆ«å®šä¹‰Ù~The kernel runs with five different security levels.  Any super-user process can raise the level, but no process can lower it.Ù„å†…æ ¸è¿è¡Œåœ¨äº”ä¸ªä¸åŒçš„å®‰å…¨çº§åˆ«ä¸‹ã€‚ä»»ä½•è¶…çº§ç”¨æˆ·è¿›ç¨‹éƒ½å¯ä»¥æå‡çº§åˆ«ï¼Œä½†æ²¡æœ‰è¿›ç¨‹å¯ä»¥é™ä½çº§åˆ«ã€‚½The security definitions are:µå®‰å…¨å®šä¹‰å¦‚ä¸‹ï¼šÙi*Permanently insecure mode* - always run the system in insecure mode.
This is the default initial value.
Ù^*æ°¸ä¹…ä¸å®‰å…¨æ¨¡å¼* - å§‹ç»ˆä»¥ä¸å®‰å…¨æ¨¡å¼è¿è¡Œç³»ç»Ÿã€‚
è¿™æ˜¯é»˜è®¤çš„åˆå§‹å€¼ã€‚
Ù†*Insecure mode* - immutable and append-only flags may be turned off.
All devices may be read or written subject to their permissions.
Ùy*å®‰å…¨æ¨¡å¼* - å¯ä»¥å…³é—­ä¸å¯å˜å’Œä»…è¿½åŠ æ ‡å¿—ã€‚
æ‰€æœ‰è®¾å¤‡éƒ½å¯ä»¥æ ¹æ®å…¶æƒé™è¿›è¡Œè¯»å–æˆ–å†™å…¥ã€‚
Úş*Secure mode* - the system immutable and system append-only flags may not be turned off;
disks for mounted file systems, [.filename]#/dev/mem# and [.filename]#/dev/kmem# may not be opened for writing;
[.filename]#/dev/io# (if your platform has it) may not be opened at all; kernel modules (see man:kld[4]) may not be loaded or unloaded.
The kernel debugger may not be entered using the debug.kdb.enter sysctl.
A panic or trap cannot be forced using the debug.kdb.panic, debug.kdb.panic_str and other sysctl's.
Úó*å®‰å…¨æ¨¡å¼* - ç³»ç»Ÿçš„ä¸å¯å˜å’Œç³»ç»Ÿçš„åªè¿½åŠ æ ‡å¿—ä¸èƒ½è¢«å…³é—­ï¼›
æŒ‚è½½çš„æ–‡ä»¶ç³»ç»Ÿçš„ç£ç›˜ã€[.filename]#/dev/mem# å’Œ [.filename]#/dev/kmem# ä¸èƒ½è¢«æ‰“å¼€ä»¥è¿›è¡Œå†™æ“ä½œï¼›
[.filename]#/dev/io# ï¼ˆå¦‚æœæ‚¨çš„å¹³å°æœ‰çš„è¯ï¼‰ä¸èƒ½è¢«æ‰“å¼€ï¼›
å†…æ ¸æ¨¡å—ï¼ˆå‚è§ man:kld[4]ï¼‰ä¸èƒ½è¢«åŠ è½½æˆ–å¸è½½ã€‚
ä¸èƒ½ä½¿ç”¨ debug.kdb.enter sysctl è¿›å…¥å†…æ ¸è°ƒè¯•å™¨ã€‚
ä¸èƒ½ä½¿ç”¨ debug.kdb.panicã€debug.kdb.panic_str å’Œå…¶ä»– sysctl æ¥å¼ºåˆ¶å‘ç”Ÿææ…Œæˆ–é™·é˜±ã€‚
Ú*Highly secure mode* - same as secure mode, plus disks may not be opened for writing (except by man:mount[2]) whether mounted or not.
This level precludes tampering with file systems by unmounting them, but also inhibits running man:newfs[8] while the system is multiuser.
Ú*é«˜åº¦å®‰å…¨æ¨¡å¼* - ä¸å®‰å…¨æ¨¡å¼ç›¸åŒï¼Œä½†æ˜¯é™¤äº† man:mount[2] ä¹‹å¤–ï¼Œä¸å…è®¸æ‰“å¼€ç£ç›˜è¿›è¡Œå†™å…¥æ“ä½œï¼Œæ— è®ºæ˜¯å¦å·²æŒ‚è½½ã€‚
è¿™ä¸ªçº§åˆ«é˜²æ­¢é€šè¿‡å¸è½½æ–‡ä»¶ç³»ç»Ÿæ¥ç¯¡æ”¹å®ƒä»¬ï¼Œä½†åŒæ—¶ä¹Ÿé˜»æ­¢åœ¨ç³»ç»Ÿå¤„äºå¤šç”¨æˆ·çŠ¶æ€ä¸‹è¿è¡Œ man:newfs[8]ã€‚
ÙÛ*Network secure mode* - same as highly secure mode, plus IP packet filter rules (see man:ipfw[8], man:ipfirewall[4] and man:pfctl[8]) cannot be changed and man:dummynet[4] or man:pf[4] configuration cannot be adjusted.
ÙŞ*ç½‘ç»œå®‰å…¨æ¨¡å¼* - ä¸é«˜åº¦å®‰å…¨æ¨¡å¼ç›¸åŒï¼Œè¿˜åŒ…æ‹¬æ— æ³•æ›´æ”¹ IP æ•°æ®åŒ…è¿‡æ»¤è§„åˆ™ï¼ˆå‚è§ man:ipfw[8]ï¼Œman:ipfirewall[4] å’Œ man:pfctl[8]ï¼‰ï¼Œä»¥åŠæ— æ³•è°ƒæ•´ man:dummynet[4] æˆ– man:pf[4] é…ç½®ã€‚
ÚEIn summary, the key difference between `Permanently Insecure Mode` and `Insecure Mode` in FreeBSD secure levels is the degree of security they provide.  `Permanently Insecure Mode` completely lifts all security restrictions, while `Insecure Mode` relaxes some restrictions but still maintains a level of control and security.Ú"æ€»ç»“ä¸€ä¸‹ï¼Œåœ¨ FreeBSD å®‰å…¨çº§åˆ«ä¸­ï¼Œ`æ°¸ä¹…ä¸å®‰å…¨æ¨¡å¼` å’Œ `ä¸å®‰å…¨æ¨¡å¼` çš„å…³é”®åŒºåˆ«åœ¨äºå®ƒä»¬æä¾›çš„å®‰å…¨ç¨‹åº¦ã€‚`æ°¸ä¹…ä¸å®‰å…¨æ¨¡å¼` å®Œå…¨è§£é™¤äº†æ‰€æœ‰å®‰å…¨é™åˆ¶ï¼Œè€Œ `ä¸å®‰å…¨æ¨¡å¼` æ”¾å®½äº†ä¸€äº›é™åˆ¶ï¼Œä½†ä»ä¿æŒä¸€å®šçš„æ§åˆ¶å’Œå®‰å…¨æ€§ã€‚´Modify Secure Levels²ä¿®æ”¹å®‰å…¨çº§åˆ«ÙŠIn order to change the securelevel of the system it is necessary to activate `kern_securelevel_enable` by executing the following command:Ùhä¸ºäº†æ”¹å˜ç³»ç»Ÿçš„å®‰å…¨çº§åˆ«ï¼Œéœ€è¦é€šè¿‡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ¥æ¿€æ´» `kern_securelevel_enable`ï¼šÙFAnd set the value of `kern_securelevel` to the desired security level:Ù>å°† `kern_securelevel` çš„å€¼è®¾ç½®ä¸ºæ‰€éœ€çš„å®‰å…¨çº§åˆ«ï¼šÙYTo check the status of the securelevel on a running system execute the following command:ÙHè¦æ£€æŸ¥è¿è¡Œä¸­ç³»ç»Ÿçš„å®‰å…¨çº§åˆ«çŠ¶æ€ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼šÙThe output contains the current value of the securelevel.  If it is greater than 0, at least some of the securelevel's protections are enabled.Ù{è¾“å‡ºåŒ…å«äº†å½“å‰å®‰å…¨çº§åˆ«çš„å€¼ã€‚å¦‚æœè¯¥å€¼å¤§äº 0 ï¼Œåˆ™è¡¨ç¤ºå®‰å…¨çº§åˆ«çš„ä¸€äº›ä¿æŠ¤åŠŸèƒ½å·²ç»å¯ç”¨ã€‚ªFile flags¬æ–‡ä»¶æ ‡å¿—Ú+File flags allow users to attach additional metadata or attributes to files and directories beyond basic permissions and ownership.  These flags provide a way to control various behaviors and properties of files without needing to resort to creating special directories or using extended attributes.Ùğæ–‡ä»¶æ ‡å¿—å…è®¸ç”¨æˆ·åœ¨åŸºæœ¬æƒé™å’Œæ‰€æœ‰æƒä¹‹å¤–ï¼Œä¸ºæ–‡ä»¶å’Œç›®å½•é™„åŠ é¢å¤–çš„å…ƒæ•°æ®æˆ–å±æ€§ã€‚è¿™äº›æ ‡å¿—æä¾›äº†ä¸€ç§æ§åˆ¶æ–‡ä»¶çš„å„ç§è¡Œä¸ºå’Œå±æ€§çš„æ–¹å¼ï¼Œè€Œæ— éœ€åˆ›å»ºç‰¹æ®Šç›®å½•æˆ–ä½¿ç”¨æ‰©å±•å±æ€§ã€‚Ú€File flags can be used to achieve different goals, such as preventing file deletion, making files append-only, synchronizing file updates, and more.  Some commonly used file flags in FreeBSD include the "immutable" flag, which prevents modification or deletion of a file, and the "append-only" flag, which allows only data to be added to the end of a file but not modified or removed.Ú[æ–‡ä»¶æ ‡å¿—å¯ä»¥ç”¨äºå®ç°ä¸åŒçš„ç›®æ ‡ï¼Œæ¯”å¦‚é˜²æ­¢æ–‡ä»¶è¢«åˆ é™¤ï¼Œä½¿æ–‡ä»¶åªèƒ½è¿½åŠ ï¼ŒåŒæ­¥æ–‡ä»¶æ›´æ–°ç­‰ç­‰ã€‚åœ¨ FreeBSD ä¸­ï¼Œä¸€äº›å¸¸ç”¨çš„æ–‡ä»¶æ ‡å¿—åŒ…æ‹¬â€œimmutableâ€æ ‡å¿—ï¼Œå®ƒé˜²æ­¢æ–‡ä»¶è¢«ä¿®æ”¹æˆ–åˆ é™¤ï¼Œä»¥åŠâ€œappend-onlyâ€æ ‡å¿—ï¼Œå®ƒåªå…è®¸åœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ æ•°æ®ï¼Œè€Œä¸èƒ½ä¿®æ”¹æˆ–åˆ é™¤æ•°æ®ã€‚ÚËThese flags can be managed using the man:chflags[1] command in FreeBSD, providing administrators and users with greater control over the behavior and characteristics of their files and directories.  It is important to note that file flags are typically managed by root or users with appropriate privileges, as they can influence how files are accessed and manipulated.  Some flags are available for the use of the file's owner, as described in man:chflags[1].Úåœ¨ FreeBSD ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ man:chflags[1] å‘½ä»¤æ¥ç®¡ç†è¿™äº›æ ‡å¿—ï¼Œä¸ºç®¡ç†å‘˜å’Œç”¨æˆ·æä¾›å¯¹å…¶æ–‡ä»¶å’Œç›®å½•çš„è¡Œä¸ºå’Œç‰¹æ€§å…·æœ‰æ›´å¤§çš„æ§åˆ¶æƒã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ–‡ä»¶æ ‡å¿—é€šå¸¸ç”± root ç”¨æˆ·æˆ–å…·æœ‰é€‚å½“æƒé™çš„ç”¨æˆ·ç®¡ç†ï¼Œå› ä¸ºå®ƒä»¬å¯ä»¥å½±å“æ–‡ä»¶çš„è®¿é—®å’Œæ“ä½œæ–¹å¼ã€‚ä¸€äº›æ ‡å¿—å¯ä¾›æ–‡ä»¶æ‰€æœ‰è€…ä½¿ç”¨ï¼Œè¯¦è§ man:chflags[1]ã€‚´Work with File Flags²å¤„ç†æ–‡ä»¶æ ‡å¿—Ù{In this example, a file named [.filename]#~/important.txt# in user's home directory want to be protected against deletions.Ù‡åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œç”¨æˆ·çš„ä¸»ç›®å½•ä¸­æœ‰ä¸€ä¸ªåä¸º [.filename]#~/important.txt# çš„æ–‡ä»¶ï¼Œå¸Œæœ›å¯¹å…¶è¿›è¡Œé˜²åˆ é™¤ä¿æŠ¤ã€‚Ù:Execute the following command to set the `schg` file flag:Ù2æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ¥è®¾ç½® `schg` æ–‡ä»¶æ ‡å¿—ï¼šÙhWhen any user, including the `root` user, tries to delete the file, the system will display the message:Ùbå½“ä»»ä½•ç”¨æˆ·ï¼ŒåŒ…æ‹¬ `root` ç”¨æˆ·ï¼Œå°è¯•åˆ é™¤è¯¥æ–‡ä»¶æ—¶ï¼Œç³»ç»Ÿå°†æ˜¾ç¤ºä»¥ä¸‹æ¶ˆæ¯ï¼šÙrTo delete the file, it will be necessary to delete the file flags of that file by executing the following command:ÙQè¦åˆ é™¤è¯¥æ–‡ä»¶ï¼Œéœ€è¦æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ¥åˆ é™¤è¯¥æ–‡ä»¶çš„æ–‡ä»¶æ ‡å¿—ï¼šÙVA list of supported file flags and their functionality can be found in man:chflags[1].ÙOå¯ä»¥åœ¨ man:chflags[1] ä¸­æ‰¾åˆ°æ”¯æŒçš„æ–‡ä»¶æ ‡å¿—åŠå…¶åŠŸèƒ½çš„åˆ—è¡¨ã€‚Ú2OpenSSH is a set of network connectivity tools used to provide secure access to remote machines.  Additionally, TCP/IP connections can be tunneled or forwarded securely through SSH connections.  OpenSSH encrypts all traffic to eliminate eavesdropping, connection hijacking, and other network-level attacks.ÙûOpenSSH æ˜¯ä¸€ç»„ç½‘ç»œè¿æ¥å·¥å…·ï¼Œç”¨äºæä¾›å¯¹è¿œç¨‹æœºå™¨çš„å®‰å…¨è®¿é—®ã€‚æ­¤å¤–ï¼Œå¯ä»¥é€šè¿‡ SSH è¿æ¥å®‰å…¨åœ°éš§é“æˆ–è½¬å‘ TCP/IP è¿æ¥ã€‚OpenSSH å¯¹æ‰€æœ‰æµé‡è¿›è¡ŒåŠ å¯†ï¼Œä»¥æ¶ˆé™¤çªƒå¬ã€è¿æ¥åŠ«æŒå’Œå…¶ä»–ç½‘ç»œçº§æ”»å‡»ã€‚ÙTOpenSSH is maintained by the OpenBSD project and is installed by default in FreeBSD.ÙGOpenSSH ç”± OpenBSD é¡¹ç›®ç»´æŠ¤ï¼Œå¹¶ä¸”åœ¨ FreeBSD ä¸­é»˜è®¤å®‰è£…ã€‚Ú$When data is sent over the network in an unencrypted form, network sniffers anywhere in between the client and server can steal user/password information or data transferred during the session.  OpenSSH offers a variety of authentication and encryption methods to prevent this from happening.Ùÿå½“æ•°æ®ä»¥æœªåŠ å¯†çš„å½¢å¼é€šè¿‡ç½‘ç»œå‘é€æ—¶ï¼Œä½äºå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„ç½‘ç»œå—…æ¢å™¨å¯ä»¥çªƒå–ç”¨æˆ·/å¯†ç ä¿¡æ¯æˆ–åœ¨ä¼šè¯æœŸé—´ä¼ è¾“çš„æ•°æ®ã€‚OpenSSH æä¾›äº†å„ç§èº«ä»½éªŒè¯å’ŒåŠ å¯†æ–¹æ³•ï¼Œä»¥é˜²æ­¢è¿™ç§æƒ…å†µå‘ç”Ÿã€‚Ù[More information about OpenSSH is available in the link:https://www.openssh.com/[web page].ÙYæœ‰å…³ OpenSSH çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·è®¿é—® link:https://www.openssh.com/[è¿™ä¸ªé¡µé¢]ã€‚ÙÜThis section provides an overview of the built-in client utilities to securely access other systems and securely transfer files from a FreeBSD system.  It then describes how to configure a SSH server on a FreeBSD system.ÙÈæœ¬èŠ‚æä¾›äº†å†…ç½®çš„å®¢æˆ·ç«¯å·¥å…·çš„æ¦‚è¿°ï¼Œç”¨äºå®‰å…¨åœ°è®¿é—®å…¶ä»–ç³»ç»Ÿå¹¶ä» FreeBSD ç³»ç»Ÿå®‰å…¨åœ°ä¼ è¾“æ–‡ä»¶ã€‚ç„¶åï¼Œå®ƒæè¿°äº†å¦‚ä½•åœ¨ FreeBSD ç³»ç»Ÿä¸Šé…ç½® SSH æœåŠ¡å™¨ã€‚ÙéAs stated, this chapter will cover the base system version of OpenSSH.  A version of OpenSSH is also available in the package:security/openssh-portable[], which provides additional configuration options and is updated more regularly.ÙÍå¦‚ä¸Šæ‰€è¿°ï¼Œæœ¬ç« å°†ä»‹ç» OpenSSH çš„åŸºæœ¬ç³»ç»Ÿç‰ˆæœ¬ã€‚OpenSSH çš„ä¸€ä¸ªç‰ˆæœ¬ä¹Ÿå¯ä»¥åœ¨åŒ… security/openssh-portable[] ä¸­æ‰¾åˆ°ï¼Œè¯¥ç‰ˆæœ¬æä¾›äº†é¢å¤–çš„é…ç½®é€‰é¡¹ï¼Œå¹¶ä¸”å®šæœŸæ›´æ–°ã€‚¾Using the SSH Client Utilitiesºä½¿ç”¨ SSH å®¢æˆ·ç«¯å·¥å…·ÚTo log into a SSH server, use man:ssh[1] and specify a username that exists on that server and the IP address or hostname of the server.  If this is the first time a connection has been made to the specified server, the user will be prompted to first verify the server's fingerprint:Ùöè¦ç™»å½•åˆ° SSH æœåŠ¡å™¨ï¼Œä½¿ç”¨ man:ssh[1] å‘½ä»¤ï¼Œå¹¶æŒ‡å®šå­˜åœ¨äºè¯¥æœåŠ¡å™¨ä¸Šçš„ç”¨æˆ·åä»¥åŠæœåŠ¡å™¨çš„ IP åœ°å€æˆ–ä¸»æœºåã€‚å¦‚æœè¿™æ˜¯ç¬¬ä¸€æ¬¡è¿æ¥åˆ°æŒ‡å®šçš„æœåŠ¡å™¨ï¼Œç”¨æˆ·å°†è¢«æç¤ºé¦–å…ˆéªŒè¯æœåŠ¡å™¨çš„æŒ‡çº¹ï¼šÚ&SSH utilizes a key fingerprint system to verify the authenticity of the server when the client connects.  When the user accepts the key's fingerprint by typing `yes` when connecting for the first time, a copy of the key is saved to [.filename]#~/.ssh/known_hosts# in the user's home directory.  Future attempts to login are verified against the saved key and man:ssh[1] will display an alert if the server's key does not match the saved key.  If this occurs, the user should first verify why the key has changed before continuing with the connection.ÚîSSH åˆ©ç”¨å¯†é’¥æŒ‡çº¹ç³»ç»Ÿæ¥éªŒè¯å®¢æˆ·ç«¯è¿æ¥æ—¶æœåŠ¡å™¨çš„çœŸå®æ€§ã€‚å½“ç”¨æˆ·åœ¨é¦–æ¬¡è¿æ¥æ—¶é€šè¿‡è¾“å…¥ `yes` æ¥å—å¯†é’¥çš„æŒ‡çº¹æ—¶ï¼Œå¯†é’¥çš„å‰¯æœ¬å°†ä¿å­˜åœ¨ç”¨æˆ·çš„ä¸»ç›®å½•ä¸‹çš„ [.filename]#~/.ssh/known_hosts# æ–‡ä»¶ä¸­ã€‚å°†æ¥çš„ç™»å½•å°è¯•å°†æ ¹æ®ä¿å­˜çš„å¯†é’¥è¿›è¡ŒéªŒè¯ï¼Œå¦‚æœæœåŠ¡å™¨çš„å¯†é’¥ä¸ä¿å­˜çš„å¯†é’¥ä¸åŒ¹é…ï¼Œ man:ssh[1] å°†æ˜¾ç¤ºè­¦å‘Šã€‚å¦‚æœå‘ç”Ÿè¿™ç§æƒ…å†µï¼Œç”¨æˆ·åº”è¯¥é¦–å…ˆéªŒè¯å¯†é’¥ä¸ºä½•å‘ç”Ÿå˜åŒ–ï¼Œç„¶åå†ç»§ç»­è¿æ¥ã€‚Ù?How to perform this check is outside the scope of this chapter.Ù0å¦‚ä½•æ‰§è¡Œæ­¤æ£€æŸ¥è¶…å‡ºäº†æœ¬ç« çš„èŒƒå›´ã€‚ÙCUse man:scp[1] to securely copy a file to or from a remote machine.Ùxä½¿ç”¨ man:scp[1] å‘½ä»¤å¯ä»¥å®‰å…¨åœ°å°†æ–‡ä»¶ä»æœ¬åœ°å¤åˆ¶åˆ°è¿œç¨‹æœºå™¨ï¼Œæˆ–è€…ä»è¿œç¨‹æœºå™¨å¤åˆ¶åˆ°æœ¬åœ°ã€‚Ù}This example copies `COPYRIGHT` on the remote system to a file of the same name in the current directory of the local system:Ùmè¿™ä¸ªä¾‹å­å°†è¿œç¨‹ç³»ç»Ÿä¸Šçš„ `COPYRIGHT` æ–‡ä»¶å¤åˆ¶åˆ°æœ¬åœ°ç³»ç»Ÿå½“å‰ç›®å½•ä¸‹åŒåçš„æ–‡ä»¶ä¸­ï¼šÙSince the fingerprint was already verified for this host, the server's key is automatically checked before prompting for the user's password.Ù~ç”±äºè¯¥ä¸»æœºçš„æŒ‡çº¹å·²ç»éªŒè¯è¿‡ï¼Œå› æ­¤åœ¨æç¤ºç”¨æˆ·è¾“å…¥å¯†ç ä¹‹å‰ï¼ŒæœåŠ¡å™¨çš„å¯†é’¥ä¼šè‡ªåŠ¨è¿›è¡Œæ£€æŸ¥ã€‚ÚƒThe arguments passed to man:scp[1] are similar to man:cp[1].  The file or files to copy is the first argument and the destination to copy to is the second.  Since the file is fetched over the network, one or more of the file arguments takes the form `user@host:<path_to_remote_file>`.  Be aware when copying directories recursively that man:scp[1] uses `-r`, whereas man:cp[1] uses `-R`.Úfä¼ é€’ç»™ man:scp[1] çš„å‚æ•°ä¸ man:cp[1] ç±»ä¼¼ã€‚è¦å¤åˆ¶çš„æ–‡ä»¶æˆ–æ–‡ä»¶æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œè¦å¤åˆ¶åˆ°çš„ç›®æ ‡æ˜¯ç¬¬äºŒä¸ªå‚æ•°ã€‚ç”±äºæ–‡ä»¶æ˜¯é€šè¿‡ç½‘ç»œè·å–çš„ï¼Œå› æ­¤ä¸€ä¸ªæˆ–å¤šä¸ªæ–‡ä»¶å‚æ•°é‡‡ç”¨ `user@host:<path_to_remote_file>` çš„å½¢å¼ã€‚åœ¨é€’å½’å¤åˆ¶ç›®å½•æ—¶ï¼Œè¯·æ³¨æ„ man:scp[1] ä½¿ç”¨ `-r`ï¼Œè€Œ man:cp[1] ä½¿ç”¨ `-R`ã€‚ÙBTo open an interactive session for copying files, use man:sftp[1].ÙNè¦æ‰“å¼€ä¸€ä¸ªç”¨äºå¤åˆ¶æ–‡ä»¶çš„äº¤äº’å¼ä¼šè¯ï¼Œè¯·ä½¿ç”¨ man:sftp[1]ã€‚ÙVRefer to man:sftp[1] for a list of available commands while in an man:sftp[1] session.ÙSåœ¨ man:sftp[1] ä¼šè¯ä¸­ï¼Œå¯ä»¥å‚è€ƒ man:sftp[1] è·å–å¯ç”¨å‘½ä»¤çš„åˆ—è¡¨ã€‚¸Key-based Authentication»åŸºäºå¯†é’¥çš„èº«ä»½éªŒè¯Ù˜Instead of using passwords, a client can be configured to connect to the remote machine using keys.  For security reasons, this is the preferred method.Ùå®¢æˆ·ç«¯å¯ä»¥é…ç½®ä¸ºä½¿ç”¨å¯†é’¥è¿æ¥åˆ°è¿œç¨‹æœºå™¨ï¼Œè€Œä¸æ˜¯ä½¿ç”¨å¯†ç ã€‚å‡ºäºå®‰å…¨åŸå› ï¼Œè¿™æ˜¯é¦–é€‰çš„æ–¹æ³•ã€‚Ùõman:ssh-keygen[1] can be used to generate the authentication keys.  To generate a public and private key pair, specify the type of key and follow the prompts.  It is recommended to protect the keys with a memorable, but hard to guess passphrase.ÙÆman:ssh-keygen[1] å¯ä»¥ç”¨æ¥ç”Ÿæˆèº«ä»½éªŒè¯å¯†é’¥ã€‚è¦ç”Ÿæˆå…¬é’¥å’Œç§é’¥å¯¹ï¼Œè¯·æŒ‡å®šå¯†é’¥ç±»å‹å¹¶æŒ‰ç…§æç¤ºæ“ä½œã€‚å»ºè®®ä½¿ç”¨æ˜“äºè®°ä½ä½†éš¾ä»¥çŒœæµ‹çš„å¯†ç æ¥ä¿æŠ¤å¯†é’¥ã€‚ÙûThe private key is stored in [.filename]#~/.ssh/id_rsa# and the public key is stored in [.filename]#~/.ssh/id_rsa.pub#.  The _public_ key must be copied to [.filename]#~/.ssh/authorized_keys# on the remote machine for key-based authentication to work.Ùèç§é’¥å­˜å‚¨åœ¨ [.filename]#~/.ssh/id_rsa# ä¸­ï¼Œå…¬é’¥å­˜å‚¨åœ¨ [.filename]#~/.ssh/id_rsa.pub# ä¸­ã€‚ä¸ºäº†ä½¿åŸºäºå¯†é’¥çš„èº«ä»½éªŒè¯å·¥ä½œï¼Œå¿…é¡»å°† _å…¬é’¥_ å¤åˆ¶åˆ°è¿œç¨‹æœºå™¨ä¸Šçš„ [.filename]#~/.ssh/authorized_keys#ã€‚Ù«Utilizing a passphrase for OpenSSH keys is a key security practice, providing an extra layer of protection against unauthorized access and enhancing overall cybersecurity.Ù¥ä¸º OpenSSH å¯†é’¥ä½¿ç”¨å¯†ç çŸ­è¯­æ˜¯ä¸€ç§å…³é”®çš„å®‰å…¨å®è·µï¼Œå¯ä»¥æä¾›é¢å¤–çš„ä¿æŠ¤å±‚ï¼Œé˜²æ­¢æœªç»æˆæƒçš„è®¿é—®ï¼Œå¹¶å¢å¼ºæ•´ä½“ç½‘ç»œå®‰å…¨æ€§ã€‚Ù>In case of loss or theft, this adds another layer of security.ÙEåœ¨é—å¤±æˆ–è¢«ç›—çš„æƒ…å†µä¸‹ï¼Œè¿™å¢åŠ äº†å¦ä¸€å±‚å®‰å…¨ä¿éšœã€‚­SSH TunnelingªSSH éš§é“ÙcOpenSSH has the ability to create a tunnel to encapsulate another protocol in an encrypted session.ÙVOpenSSH å…·æœ‰åˆ›å»ºéš§é“çš„èƒ½åŠ›ï¼Œå¯ä»¥åœ¨åŠ å¯†ä¼šè¯ä¸­å°è£…å¦ä¸€ç§åè®®ã€‚Ù:The following command tells man:ssh[1] to create a tunnel:Ù3ä»¥ä¸‹å‘½ä»¤å‘Šè¯‰ man:ssh[1] åˆ›å»ºä¸€ä¸ªéš§é“ï¼šÙ(This example uses the following options:Ù$è¿™ä¸ªä¾‹å­ä½¿ç”¨äº†ä»¥ä¸‹é€‰é¡¹ï¼šÙ>Specifies a local "dynamic" application-level port forwarding.ÙIæŒ‡å®šäº†ä¸€ä¸ªæœ¬åœ°çš„â€œåŠ¨æ€ï¼ˆdynamicï¼‰â€åº”ç”¨å±‚ç«¯å£è½¬å‘ã€‚Ù9The login name to use on the specified remote SSH server.Ù8åœ¨æŒ‡å®šçš„è¿œç¨‹ SSH æœåŠ¡å™¨ä¸Šä½¿ç”¨çš„ç™»å½•åã€‚Ù\An SSH tunnel works by creating a listen socket on `localhost` on the specified `localport`.ÙfSSH éš§é“é€šè¿‡åœ¨æŒ‡å®šçš„ `localport` ä¸Šåœ¨ `localhost` ä¸Šåˆ›å»ºä¸€ä¸ªç›‘å¬å¥—æ¥å­—æ¥å·¥ä½œã€‚ÙaThis method can be used to wrap any number of insecure TCP protocols such as SMTP, POP3, and FTP.Ùbè¿™ç§æ–¹æ³•å¯ä»¥ç”¨æ¥åŒ…è£…ä»»æ„æ•°é‡çš„ä¸å®‰å…¨çš„ TCP åè®®ï¼Œå¦‚ SMTPã€ POP3 å’Œ FTPã€‚·Enabling the SSH Server´å¯ç”¨ SSH æœåŠ¡å™¨ÙšIn addition to providing built-in SSH client utilities, a FreeBSD system can be configured as an SSH server, accepting connections from other SSH clients.Ùé™¤äº†æä¾›å†…ç½®çš„ SSH å®¢æˆ·ç«¯å·¥å…·å¤–ï¼Œ FreeBSD ç³»ç»Ÿè¿˜å¯ä»¥é…ç½®ä¸º SSH æœåŠ¡å™¨ï¼Œæ¥å—æ¥è‡ªå…¶ä»– SSH å®¢æˆ·ç«¯çš„è¿æ¥ã€‚ÙÀAs stated, this chapter will cover the base system version of OpenSSH.  Please *not* confuse with package:security/openssh-portable[], the version of OpenSSH that ships with the FreeBSD ports.Ù¹æ­£å¦‚æ‰€è¿°ï¼Œæœ¬ç« å°†æ¶µç›– OpenSSH çš„åŸºæœ¬ç³»ç»Ÿç‰ˆæœ¬ã€‚è¯· *ä¸è¦* ä¸ package:security/openssh-portable[] æ··æ·†ï¼Œåè€…æ˜¯éš FreeBSD ports ä¸€èµ·æä¾›çš„ OpenSSH ç‰ˆæœ¬ã€‚ÙUIn order to have the SSH Server enabled across reboots execute the following command:ÙGä¸ºäº†åœ¨é‡æ–°å¯åŠ¨åå¯ç”¨ SSH æœåŠ¡å™¨ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼šÙ9Then execute the following command to enable the service:Ù-ç„¶åæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ä»¥å¯ç”¨è¯¥æœåŠ¡ï¼šÚThe first time sshd starts on a FreeBSD system, the system's host keys will be automatically created and the fingerprint will be displayed on the console.  Provide users with the fingerprint so that they can verify it the first time they connect to the server.ÙÌåœ¨ FreeBSD ç³»ç»Ÿä¸Šé¦–æ¬¡å¯åŠ¨ sshd æ—¶ï¼Œç³»ç»Ÿçš„ä¸»æœºå¯†é’¥å°†ä¼šè‡ªåŠ¨åˆ›å»ºï¼Œå¹¶ä¸”æŒ‡çº¹å°†ä¼šæ˜¾ç¤ºåœ¨æ§åˆ¶å°ä¸Šã€‚æä¾›ç”¨æˆ·æŒ‡çº¹ï¼Œä»¥ä¾¿ä»–ä»¬åœ¨é¦–æ¬¡è¿æ¥æœåŠ¡å™¨æ—¶è¿›è¡ŒéªŒè¯ã€‚Ù¶Refer to man:sshd[8] for the list of available options when starting sshd and a more complete discussion about authentication, the login process, and the various configuration files.Ùè¯·å‚è€ƒ man:sshd[8] ä»¥è·å–åœ¨å¯åŠ¨ sshd æ—¶å¯ç”¨çš„é€‰é¡¹åˆ—è¡¨ï¼Œä»¥åŠæœ‰å…³èº«ä»½éªŒè¯ã€ç™»å½•è¿‡ç¨‹å’Œå„ç§é…ç½®æ–‡ä»¶çš„æ›´å®Œæ•´çš„è®¨è®ºã€‚ÙdAt this point, the sshd should be available to all users with a username and password on the system.ÙYåœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œsshd åº”è¯¥å¯¹ç³»ç»Ÿä¸Šæ‰€æœ‰å…·æœ‰ç”¨æˆ·åå’Œå¯†ç çš„ç”¨æˆ·å¯ç”¨ã€‚Ù!Configuring publickey auth method¾é…ç½®å…¬é’¥èº«ä»½éªŒè¯æ–¹æ³•ÚConfiguring OpenSSH to use public key authentication enhances security by leveraging asymmetric cryptography for authentication.  This method eliminates password-related risks, such as weak passwords or interception during transmission, while thwarting various password-based attacks.  However, it's vital to ensure the private keys are well-protected to prevent unauthorized access.ÚYé€šè¿‡é…ç½® OpenSSH ä½¿ç”¨å…¬é’¥èº«ä»½éªŒè¯ï¼Œå¯ä»¥é€šè¿‡åˆ©ç”¨éå¯¹ç§°åŠ å¯†è¿›è¡Œèº«ä»½éªŒè¯æ¥å¢å¼ºå®‰å…¨æ€§ã€‚è¿™ç§æ–¹æ³•æ¶ˆé™¤äº†ä¸å¯†ç ç›¸å…³çš„é£é™©ï¼Œä¾‹å¦‚å¼±å¯†ç æˆ–åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­çš„æ‹¦æˆªï¼ŒåŒæ—¶é˜»æ­¢äº†å„ç§åŸºäºå¯†ç çš„æ”»å‡»ã€‚ç„¶è€Œï¼Œç¡®ä¿ç§é’¥å—åˆ°è‰¯å¥½ä¿æŠ¤ä»¥é˜²æ­¢æœªç»æˆæƒçš„è®¿é—®éå¸¸é‡è¦ã€‚ÙZThe first step will be to configure man:sshd[8] to use the required authentication method.ÙFç¬¬ä¸€æ­¥æ˜¯é…ç½® man:sshd[8] ä»¥ä½¿ç”¨æ‰€éœ€çš„èº«ä»½éªŒè¯æ–¹æ³•ã€‚ÙQEdit [.filename]#/etc/ssh/sshd_config# and uncomment the following configuration:ÙSç¼–è¾‘ [.filename]#/etc/ssh/sshd_config# æ–‡ä»¶ï¼Œå¹¶å–æ¶ˆä»¥ä¸‹é…ç½®çš„æ³¨é‡Šï¼šÙıOnce the configuration is done, the users will have to send the system administrator their *public key* and these keys will be added in [.filename]#.ssh/authorized_keys#.  The process for generating the keys is described in <<Key-based Authentication>>.Ùıä¸€æ—¦é…ç½®å®Œæˆï¼Œç”¨æˆ·å°†éœ€è¦å°†ä»–ä»¬çš„ *å…¬é’¥* å‘é€ç»™ç³»ç»Ÿç®¡ç†å‘˜ï¼Œè¿™äº›å¯†é’¥å°†è¢«æ·»åŠ åˆ° [.filename]#.ssh/authorized_keys# æ–‡ä»¶ä¸­ã€‚ç”Ÿæˆå¯†é’¥çš„è¿‡ç¨‹åœ¨ <<Key-based Authentication,åŸºäºå¯†é’¥çš„èº«ä»½éªŒè¯>> ä¸­æè¿°ã€‚Ù8Then restart the server executing the following command:Ù0ç„¶åæ‰§è¡Œä»¥ä¸‹å‘½ä»¤é‡æ–°å¯åŠ¨æœåŠ¡å™¨ï¼šÙoIt is strongly recommended to follow the security improvements indicated in <<security-sshd-security-options>>.Ù}å¼ºçƒˆå»ºè®®æŒ‰ç…§ <<security-sshd-security-options,SSH æœåŠ¡å™¨å®‰å…¨é€‰é¡¹>> ä¸­æŒ‡ç¤ºçš„å®‰å…¨æ”¹è¿›æªæ–½è¿›è¡Œæ“ä½œã€‚»SSH Server Security Options¹SSH æœåŠ¡å™¨å®‰å…¨é€‰é¡¹Ù¤While sshd is the most widely used remote administration facility for FreeBSD, brute force and drive by attacks are common to any system exposed to public networks.Ù¢å°½ç®¡ sshd æ˜¯ FreeBSD æœ€å¹¿æ³›ä½¿ç”¨çš„è¿œç¨‹ç®¡ç†å·¥å…·ï¼Œä½†æš´åŠ›ç ´è§£å’Œé©±åŠ¨æ”»å‡»å¯¹äºä»»ä½•æš´éœ²åœ¨å…¬å…±ç½‘ç»œä¸­çš„ç³»ç»Ÿæ¥è¯´éƒ½æ˜¯å¸¸è§çš„ã€‚ÙÀSeveral additional parameters are available to prevent the success of these attacks and will be described in this section.  All configurations will be done in [.filename]#/etc/ssh/sshd_config#Ù˜æœ¬èŠ‚å°†ä»‹ç»å‡ ä¸ªå¯ç”¨çš„é¢å¤–å‚æ•°ï¼Œä»¥é˜²æ­¢è¿™äº›æ”»å‡»çš„æˆåŠŸã€‚æ‰€æœ‰é…ç½®éƒ½å°†åœ¨ [.filename]#/etc/ssh/sshd_config# æ–‡ä»¶ä¸­å®Œæˆã€‚ÚDo not confuse [.filename]#/etc/ssh/sshd_config# with [.filename]#/etc/ssh/ssh_config# (note the extra `d` in the first filename).  The first file configures the server and the second file configures the client.  Refer to man:ssh_config[5] for a listing of the available client settings.Úä¸è¦å°† [.filename]#/etc/ssh/sshd_config# ä¸ [.filename]#/etc/ssh/ssh_config# æ··æ·†ï¼ˆæ³¨æ„ç¬¬ä¸€ä¸ªæ–‡ä»¶åä¸­å¤šäº†ä¸€ä¸ª `d`ï¼‰ã€‚ç¬¬ä¸€ä¸ªæ–‡ä»¶é…ç½®æœåŠ¡å™¨ï¼Œç¬¬äºŒä¸ªæ–‡ä»¶é…ç½®å®¢æˆ·ç«¯ã€‚è¯·å‚è€ƒ man:ssh_config[5] ä»¥è·å–å¯ç”¨å®¢æˆ·ç«¯è®¾ç½®çš„åˆ—è¡¨ã€‚Ù£By default, authentication can be done with both pubkey and password.  To allow *only* pubkey authentication, *which is strongly recommended*, change the variable:Ùé»˜è®¤æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨å…¬é’¥å’Œå¯†ç è¿›è¡Œèº«ä»½éªŒè¯ã€‚ä¸ºäº† *ä»…* å…è®¸å…¬é’¥èº«ä»½éªŒè¯ï¼Œ*å¼ºçƒˆæ¨è*ï¼Œè¯·æ›´æ”¹å˜é‡ï¼šÚIt is a good idea to limit which users can log into the SSH server and from where using the `AllowUsers` keyword in the OpenSSH server configuration file.  For example, to only allow `user` to log in from `192.168.1.32`, add this line to [.filename]#/etc/ssh/sshd_config#:Úåœ¨ OpenSSH æœåŠ¡å™¨é…ç½®æ–‡ä»¶ä¸­ä½¿ç”¨ `AllowUsers` å…³é”®å­—é™åˆ¶å“ªäº›ç”¨æˆ·å¯ä»¥ç™»å½• SSH æœåŠ¡å™¨ä»¥åŠä»å“ªé‡Œç™»å½•æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ã€‚ä¾‹å¦‚ï¼Œè¦ä»…å…è®¸ `user` ä» `192.168.1.32` ç™»å½•ï¼Œå°†ä»¥ä¸‹è¡Œæ·»åŠ åˆ° [.filename]#/etc/ssh/sshd_config# æ–‡ä»¶ä¸­ï¼šÙYTo allow `user` to log in from anywhere, list that user without specifying an IP address:ÙTä¸ºäº†å…è®¸ `user` ä»ä»»ä½•åœ°æ–¹ç™»å½•ï¼Œåˆ—å‡ºè¯¥ç”¨æˆ·è€Œä¸æŒ‡å®š IP åœ°å€ï¼šÙ:Multiple users should be listed on the same line, like so:Ù9å¤šä¸ªç”¨æˆ·åº”è¯¥åœ¨åŒä¸€è¡Œä¸Šåˆ—å‡ºï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼šÙ§After making all the changes, and before restarting the service, it is recommended to verify that the configuration made is correct by executing the following command:Ùåœ¨è¿›è¡Œæ‰€æœ‰æ›´æ”¹ä¹‹åï¼Œåœ¨é‡æ–°å¯åŠ¨æœåŠ¡ä¹‹å‰ï¼Œå»ºè®®é€šè¿‡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ¥éªŒè¯æ‰€åšçš„é…ç½®æ˜¯å¦æ­£ç¡®ï¼šÙIf the configuration file is correct, no output will be shown.  In case the configuration file is incorrect, it will show something like this:Ùxå¦‚æœé…ç½®æ–‡ä»¶æ­£ç¡®ï¼Œå°†ä¸ä¼šæ˜¾ç¤ºä»»ä½•è¾“å‡ºã€‚å¦‚æœé…ç½®æ–‡ä»¶ä¸æ­£ç¡®ï¼Œå°†ä¼šæ˜¾ç¤ºç±»ä¼¼ä»¥ä¸‹å†…å®¹ï¼šÙ„After making the changes and checking that the configuration file is correct, tell sshd to reload its configuration file by running:Ùråœ¨è¿›è¡Œæ›´æ”¹å¹¶ç¡®è®¤é…ç½®æ–‡ä»¶æ­£ç¡®åï¼Œé€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤å‘Šè¯‰ sshd é‡æ–°åŠ è½½å…¶é…ç½®æ–‡ä»¶ï¼šÙ¢OpenSSL is a cryptography toolkit implementing the Secure Sockets Layer (SSL) and Transport Layer Security (TLS) network protocols and many cryptography routines.ÙŒOpenSSL æ˜¯ä¸€ä¸ªå®ç°å®‰å…¨å¥—æ¥å­—å±‚ï¼ˆSSLï¼‰å’Œä¼ è¾“å±‚å®‰å…¨ï¼ˆTLSï¼‰ç½‘ç»œåè®®ä»¥åŠè®¸å¤šå¯†ç å­¦ä¾‹ç¨‹çš„å¯†ç å­¦å·¥å…·åŒ…ã€‚Ù—The openssl program is a command line tool for using the various cryptography functions of OpenSSL's crypto library from the shell.  It can be used forÙ~openssl ç¨‹åºæ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºåœ¨ shell ä¸­ä½¿ç”¨ OpenSSL çš„åŠ å¯†åº“çš„å„ç§åŠ å¯†åŠŸèƒ½ã€‚å®ƒå¯ä»¥ç”¨äºÙCCreation and management of private keys, public keys and parametersÙ*ç§é’¥ã€å…¬é’¥å’Œå‚æ•°çš„åˆ›å»ºå’Œç®¡ç†Ù#Public key cryptographic operations²å…¬é’¥åŠ å¯†æ“ä½œÙ-Creation of X.509 certificates, CSRs and CRLsÙOåˆ›å»º X.509 è¯ä¹¦ã€è¯ä¹¦ç­¾åè¯·æ±‚ï¼ˆCSRï¼‰å’Œè¯ä¹¦æ’¤é”€åˆ—è¡¨ï¼ˆCRLï¼‰¾Calculation of Message Digestsµæ¶ˆæ¯æ‘˜è¦çš„è®¡ç®—Ù&Encryption and Decryption with CiphersÙ!ä½¿ç”¨å¯†ç è¿›è¡ŒåŠ å¯†å’Œè§£å¯†¿SSL/TLS Client and Server TestsÙ#SSL/TLS å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨æµ‹è¯•Ù+Handling of S/MIME signed or encrypted mailÙ#å¤„ç† S/MIME ç­¾åæˆ–åŠ å¯†é‚®ä»¶Ù0Time Stamp requests, generation and verificationÙ!æ—¶é—´æˆ³è¯·æ±‚ã€ç”Ÿæˆå’ŒéªŒè¯Ù Benchmarking the crypto routinesÙ!å¯¹åŠ å¯†ç®—æ³•è¿›è¡ŒåŸºå‡†æµ‹è¯•ÙwFor more information about OpenSSL, read the free https://www.feistyduck.com/books/openssl-cookbook/[OpenSSL Cookbook].Ù{æœ‰å…³ OpenSSL çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·é˜…è¯»å…è´¹çš„ https://www.feistyduck.com/books/openssl-cookbook/[OpenSSL Cookbook]ã€‚·Generating Certificates¬ç”Ÿæˆè¯ä¹¦Ù—OpenSSL supports the generation of certificates both to be validated by a link:https://en.wikipedia.org/wiki/Certificate_authority[CA] and for own use.ÙgOpenSSL æ”¯æŒç”Ÿæˆè¯ä¹¦ï¼Œæ—¢å¯ä»¥ç”±è¯ä¹¦é¢å‘æœºæ„ï¼ˆCAï¼‰éªŒè¯ï¼Œä¹Ÿå¯ä»¥ä¾›è‡ªå·±ä½¿ç”¨ã€‚Ú–Run the command man:openssl[1] to generate a valid certificate for a link:https://en.wikipedia.org/wiki/Certificate_authority[CA] with the following arguments.  This command will create two files in the current directory.  The certificate request, [.filename]#req.pem#, can be sent to a link:https://en.wikipedia.org/wiki/Certificate_authority[CA] which, will validate the entered credentials, sign the request, and return the signed certificate.  The second file, [.filename]#cert.key#, is the private key for the certificate and should be stored in a secure location.  If this falls in the hands of others, it can be used to impersonate the user or the server.ÚWè¿è¡Œå‘½ä»¤ man:openssl[1] ä»¥ä½¿ç”¨ä»¥ä¸‹å‚æ•°ç”Ÿæˆä¸€ä¸ªæœ‰æ•ˆçš„è¯ä¹¦ï¼Œç”¨äºä¸€ä¸ªåä¸º link:https://en.wikipedia.org/wiki/Certificate_authority[CA] çš„è¯ä¹¦é¢å‘æœºæ„ã€‚è¯¥å‘½ä»¤å°†åœ¨å½“å‰ç›®å½•ä¸­åˆ›å»ºä¸¤ä¸ªæ–‡ä»¶ã€‚è¯ä¹¦è¯·æ±‚æ–‡ä»¶ [.filename]#req.pem# å¯ä»¥å‘é€ç»™ link:https://en.wikipedia.org/wiki/Certificate_authority[CA] ï¼Œè¯¥æœºæ„å°†éªŒè¯è¾“å…¥çš„å‡­æ®ï¼Œç­¾ç½²è¯·æ±‚å¹¶è¿”å›ç­¾ç½²åçš„è¯ä¹¦ã€‚ç¬¬äºŒä¸ªæ–‡ä»¶ [.filename]#cert.key# æ˜¯è¯ä¹¦çš„ç§é’¥ï¼Œåº”å­˜æ”¾åœ¨å®‰å…¨çš„ä½ç½®ã€‚å¦‚æœè¯¥ç§é’¥è½å…¥ä»–äººä¹‹æ‰‹ï¼Œå¯èƒ½è¢«ç”¨æ¥å†’å……ç”¨æˆ·æˆ–æœåŠ¡å™¨ã€‚Ù:Execute the following command to generate the certificate:Ù$æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ä»¥ç”Ÿæˆè¯ä¹¦ï¼šÚùAlternately, if a signature from a link:https://en.wikipedia.org/wiki/Certificate_authority[CA] is not required, a self-signed certificate can be created.  This will create two new files in the current directory: a private key file [.filename]#cert.key#, and the certificate itself, [.filename]#cert.crt#.  These should be placed in a directory, preferably under [.filename]#/etc/ssl/#, which is readable only by `root`.  Permissions of `0700` are appropriate for these files and can be set using `chmod`.ÚÔæˆ–è€…ï¼Œå¦‚æœä¸éœ€è¦æ¥è‡ª link:https://en.wikipedia.org/wiki/Certificate_authority[CA] çš„ç­¾åï¼Œå¯ä»¥åˆ›å»ºè‡ªç­¾åè¯ä¹¦ã€‚è¿™å°†åœ¨å½“å‰ç›®å½•ä¸­åˆ›å»ºä¸¤ä¸ªæ–°æ–‡ä»¶ï¼šç§é’¥æ–‡ä»¶ [.filename]#cert.key# å’Œè¯ä¹¦æœ¬èº« [.filename]#cert.crt#ã€‚è¿™äº›æ–‡ä»¶åº”è¯¥æ”¾åœ¨ä¸€ä¸ªç›®å½•ä¸­ï¼Œæœ€å¥½æ˜¯åœ¨ [.filename]#/etc/ssl/# ä¸‹ï¼Œè¯¥ç›®å½•åªèƒ½ç”± `root` ç”¨æˆ·è¯»å–ã€‚å¯¹äºè¿™äº›æ–‡ä»¶ï¼Œé€‚å½“çš„æƒé™æ˜¯ `0700` ï¼Œå¯ä»¥ä½¿ç”¨ `chmod` å‘½ä»¤è®¾ç½®ã€‚½Configuring the FIPS Provider¸é…ç½® FIPS æä¾›ç¨‹åºÚÙWith the import of OpenSSL 3 into the base system (on FreeBSD 14 and later), its new concept of provider modules was introduced in the system.  Besides the default provider module built-in to the library, the _legacy_ module implements the now optional deprecated cryptography algorithms, while the _fips_ module restricts the OpenSSL implementation to the cryptography algorithms present in the link:https://en.wikipedia.org/wiki/Federal_Information_Processing_Standards[FIPS] set of standards.  This part of OpenSSL receives link:https://www.openssl.org/docs/fips.html[particular care], including a link:https://www.openssl.org/news/fips-cve.html[list of relevant security issues], and is subject to the link:https://github.com/openssl/openssl/blob/master/README-FIPS.md[FIPS 140 validation process] on a regular basis.  The link:https://www.openssl.org/source/[list of FIPS validated versions] is also available.  This allows users to ensure FIPS compliance in their use of OpenSSL.Ú0éšç€ OpenSSL 3 è¿›å…¥åŸºç¡€ç³»ç»Ÿï¼ˆåœ¨ FreeBSD 14 åŠæ›´é«˜ç‰ˆæœ¬ä¸­ï¼‰ï¼Œç³»ç»Ÿå¼•å…¥äº†å…¶æ–°çš„æä¾›è€…æ¨¡å—æ¦‚å¿µã€‚é™¤äº†åº“ä¸­å†…ç½®çš„é»˜è®¤æä¾›è€…æ¨¡å—å¤–ï¼Œ_legacy_ æ¨¡å—å®ç°äº†ç°åœ¨å¯é€‰çš„å·²å¼ƒç”¨çš„å¯†ç ç®—æ³•ï¼Œè€Œ _fips_ æ¨¡å—å°† OpenSSL å®ç°é™åˆ¶ä¸ºé“¾æ¥ä¸­å­˜åœ¨çš„å¯†ç ç®—æ³•ï¼š link:https://en.wikipedia.org/wiki/Federal_Information_Processing_Standards[FIPS] æ ‡å‡†é›†ã€‚OpenSSL çš„è¿™éƒ¨åˆ†æ¥å—ç‰¹åˆ«å…³æ³¨ï¼ŒåŒ…æ‹¬ä¸€ä»½ç›¸å…³å®‰å…¨é—®é¢˜çš„é“¾æ¥ï¼š link:https://www.openssl.org/news/fips-cve.html[åˆ—è¡¨] ï¼Œå¹¶å®šæœŸè¿›è¡Œ link:https://github.com/openssl/openssl/blob/master/README-FIPS.md[FIPS 140 éªŒè¯è¿‡ç¨‹]ã€‚è¿˜æä¾›äº† link:https://www.openssl.org/source/[ç» FIPS éªŒè¯çš„ç‰ˆæœ¬åˆ—è¡¨] ã€‚è¿™ä½¿å¾—ç”¨æˆ·å¯ä»¥ç¡®ä¿åœ¨ä½¿ç”¨ OpenSSL æ—¶ç¬¦åˆ FIPS æ ‡å‡†ã€‚ÚLImportantly, the man:fips_module[7] is protected by an additional security measure, preventing its use without passing an integrity check.  This check can be setup by the local system administrator, allowing every user of OpenSSL 3 to load this module.  When not configured correctly, the FIPS module is expected to fail as follows:Ú)é‡è¦çš„æ˜¯ï¼Œman:fips_module[7] å—åˆ°é¢å¤–çš„å®‰å…¨æªæ–½ä¿æŠ¤ï¼Œé˜²æ­¢åœ¨æœªé€šè¿‡å®Œæ•´æ€§æ£€æŸ¥çš„æƒ…å†µä¸‹ä½¿ç”¨ã€‚è¿™ä¸ªæ£€æŸ¥å¯ä»¥ç”±æœ¬åœ°ç³»ç»Ÿç®¡ç†å‘˜è®¾ç½®ï¼Œå…è®¸ OpenSSL 3 çš„æ¯ä¸ªç”¨æˆ·åŠ è½½è¿™ä¸ªæ¨¡å—ã€‚å½“é…ç½®ä¸æ­£ç¡®æ—¶ï¼Œé¢„è®¡ FIPS æ¨¡å—å°†å¤±è´¥ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼šÙ-The ouput should be similar to the following:Ù$è¾“å‡ºåº”è¯¥ç±»ä¼¼äºä»¥ä¸‹å†…å®¹ï¼šÚ;The check can be configured through the creation of a file in [.filename]#/etc/ssl/fipsmodule.cnf#, which will then be referenced in OpenSSL's main configuration file [.filename]#/etc/ssl/openssl.cnf#.  OpenSSL provides the man:openssl-fipsinstall[1] utility to help with this process, which can be used as follows:Ú-å¯ä»¥é€šè¿‡åœ¨ [.filename]#/etc/ssl/fipsmodule.cnf# ä¸­åˆ›å»ºä¸€ä¸ªæ–‡ä»¶æ¥é…ç½®æ£€æŸ¥ï¼Œç„¶ååœ¨ OpenSSL çš„ä¸»é…ç½®æ–‡ä»¶ [.filename]#/etc/ssl/openssl.cnf# ä¸­å¼•ç”¨è¯¥æ–‡ä»¶ã€‚OpenSSL æä¾›äº† man:openssl-fipsinstall[1] å®ç”¨ç¨‹åºæ¥å¸®åŠ©å®Œæˆæ­¤è¿‡ç¨‹ï¼Œå¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ–¹å¼ä½¿ç”¨ï¼šÙKThe [.filename]#/etc/ssl/openssl.cnf# should then be modified, in order to:ÙGç„¶ååº”è¯¥ä¿®æ”¹ [.filename]#/etc/ssl/openssl.cnf# æ–‡ä»¶ï¼Œä»¥ä¾¿ï¼šÙFInclude the [.filename]#/etc/ssl/fipsmodule.cnf# file generated above,ÙDåŒ…å«ä¸Šé¢ç”Ÿæˆçš„ [.filename]#/etc/ssl/fipsmodule.cnf# æ–‡ä»¶ï¼ŒÙ(Expose the FIPS module for possible use,Ù6å°† FIPS æ¨¡å—æš´éœ²å‡ºæ¥ï¼Œä»¥ä¾¿å¯èƒ½çš„ä½¿ç”¨ã€‚Ù+And explicitly activate the default module.¾å¹¶æ˜¾å¼æ¿€æ´»é»˜è®¤æ¨¡å—ã€‚ÙkWith this done, it should be possible to confirm that the FIPS module is effectively available and working:Ù`å®Œæˆè¿™ä¸€æ­¥éª¤åï¼Œåº”è¯¥å¯ä»¥ç¡®è®¤ FIPS æ¨¡å—å·²ç»æœ‰æ•ˆåœ°å¯ç”¨å¹¶ä¸”æ­£å¸¸å·¥ä½œï¼šÙ·This procedure has to be repeated every time the FIPS module is modified, e.g., after performing system updates, or after applying security fixes affecting OpenSSL in the base system.Ù¢æ¯æ¬¡ä¿®æ”¹ FIPS æ¨¡å—æ—¶éƒ½å¿…é¡»é‡å¤æ‰§è¡Œæ­¤è¿‡ç¨‹ï¼Œä¾‹å¦‚åœ¨æ‰§è¡Œç³»ç»Ÿæ›´æ–°åæˆ–åœ¨åº”ç”¨å½±å“åŸºæœ¬ç³»ç»Ÿä¸­çš„ OpenSSL çš„å®‰å…¨ä¿®å¤ç¨‹åºåã€‚Ú_Kerberos is a network authentication protocol which was originally created by the Massachusetts Institute of Technology (MIT) as a way to securely provide authentication across a potentially hostile network.  The Kerberos protocol uses strong cryptography so that both a client and server can prove their identity without sending any unencrypted secrets over the network.  Kerberos can be described as an identity-verifying proxy system and as a trusted third-party authentication system.  After a user authenticates with Kerberos, their communications can be encrypted to assure privacy and data integrity.ÚùKerberos æ˜¯ä¸€ç§ç½‘ç»œè®¤è¯åè®®ï¼Œæœ€åˆç”±éº»çœç†å·¥å­¦é™¢ï¼ˆMITï¼‰åˆ›å»ºï¼Œç”¨äºåœ¨å¯èƒ½å­˜åœ¨æ•Œå¯¹ç½‘ç»œçš„æƒ…å†µä¸‹æä¾›å®‰å…¨è®¤è¯ã€‚Kerberos åè®®ä½¿ç”¨å¼ºåŠ å¯†æŠ€æœ¯ï¼Œä½¿å¾—å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å¯ä»¥åœ¨ä¸å‘é€ä»»ä½•æœªåŠ å¯†çš„ç§˜å¯†ä¿¡æ¯çš„æƒ…å†µä¸‹è¯æ˜å…¶èº«ä»½ã€‚Kerberos å¯ä»¥è¢«æè¿°ä¸ºä¸€ä¸ªèº«ä»½éªŒè¯ä»£ç†ç³»ç»Ÿå’Œä¸€ä¸ªå¯ä¿¡ç¬¬ä¸‰æ–¹è®¤è¯ç³»ç»Ÿã€‚ç”¨æˆ·åœ¨ä½¿ç”¨ Kerberos è¿›è¡Œèº«ä»½éªŒè¯åï¼Œä»–ä»¬çš„é€šä¿¡å¯ä»¥è¢«åŠ å¯†ä»¥ç¡®ä¿éšç§å’Œæ•°æ®å®Œæ•´æ€§ã€‚ÚThe only function of Kerberos is to provide the secure authentication of users and servers on the network.  It does not provide authorization or auditing functions.  It is recommended that Kerberos be used with other security methods which provide authorization and audit services.ÙÊKerberos çš„å”¯ä¸€åŠŸèƒ½æ˜¯åœ¨ç½‘ç»œä¸Šæä¾›ç”¨æˆ·å’ŒæœåŠ¡å™¨çš„å®‰å…¨è®¤è¯ã€‚å®ƒä¸æä¾›æˆæƒæˆ–å®¡è®¡åŠŸèƒ½ã€‚å»ºè®®å°† Kerberos ä¸å…¶ä»–æä¾›æˆæƒå’Œå®¡è®¡æœåŠ¡çš„å®‰å…¨æ–¹æ³•ä¸€èµ·ä½¿ç”¨ã€‚ÚêThe current version of the protocol is version 5, described in RFC 4120.  Several free implementations of this protocol are available, covering a wide range of operating systems.  MIT continues to develop their Kerberos package.  It is commonly used in the US as a cryptography product, and has historically been subject to US export regulations.  In FreeBSD, MITKerberos is available as the package:security/krb5[] package or port.  The Heimdal Kerberos implementation was explicitly developed outside of the US to avoid export regulations.  The Heimdal Kerberos distribution is included in the base FreeBSD installation, and another distribution with more configurable options is available as package:security/heimdal[] in the Ports Collection.Ú­åè®®çš„å½“å‰ç‰ˆæœ¬æ˜¯ç‰ˆæœ¬ 5ï¼Œè¯¦ç»†æè¿°åœ¨ RFC 4120 ä¸­ã€‚æœ‰å‡ ä¸ªå…è´¹çš„å®ç°è¯¥åè®®çš„è½¯ä»¶å¯ä¾›é€‰æ‹©ï¼Œè¦†ç›–äº†å¹¿æ³›çš„æ“ä½œç³»ç»Ÿã€‚éº»çœç†å·¥å­¦é™¢ï¼ˆMITï¼‰ç»§ç»­å¼€å‘ä»–ä»¬çš„ Kerberos è½¯ä»¶åŒ…ã€‚å®ƒåœ¨ç¾å›½å¸¸è¢«ç”¨ä½œå¯†ç å­¦äº§å“ï¼Œå¹¶ä¸”å†å²ä¸Šå—åˆ°ç¾å›½å‡ºå£ç®¡åˆ¶çš„é™åˆ¶ã€‚åœ¨ FreeBSD ä¸­ï¼Œ MITKerberos å¯ä½œä¸º package:security/krb5[] è½¯ä»¶åŒ…æˆ–ç«¯å£ä½¿ç”¨ã€‚Heimdal Kerberos å®ç°æ˜¯ä¸“é—¨åœ¨ç¾å›½ä»¥å¤–å¼€å‘çš„ï¼Œä»¥é¿å…å‡ºå£ç®¡åˆ¶ã€‚Heimdal Kerberos å‘è¡Œç‰ˆå·²åŒ…å«åœ¨åŸºæœ¬çš„ FreeBSD å®‰è£…ä¸­ï¼Œè¿˜æœ‰å¦ä¸€ä¸ªå…·æœ‰æ›´å¤šå¯é…ç½®é€‰é¡¹çš„å‘è¡Œç‰ˆå¯åœ¨ Ports Collection ä¸­ä½¿ç”¨ï¼Œå³ package:security/heimdal[]ã€‚ÙìIn Kerberos users and services are identified as "principals" which are contained within an administrative grouping, called a "realm".  A typical user principal would be of the form `_user_@_REALM_` (realms are traditionally uppercase).ÙÇåœ¨ Kerberos ä¸­ï¼Œç”¨æˆ·å’ŒæœåŠ¡è¢«ç§°ä¸ºâ€œä¸»ä½“â€ï¼Œå¹¶åŒ…å«åœ¨ä¸€ä¸ªç®¡ç†ç»„ä¸­ï¼Œç§°ä¸ºâ€œé¢†åŸŸâ€ã€‚ä¸€ä¸ªå…¸å‹çš„ç”¨æˆ·ä¸»ä½“çš„å½¢å¼ä¸º `_user_@_REALM_` ï¼ˆé¢†åŸŸé€šå¸¸æ˜¯å¤§å†™ï¼‰ã€‚ÙkThis section provides a guide on how to set up Kerberos using the Heimdal distribution included in FreeBSD.ÙXæœ¬èŠ‚æä¾›äº†ä½¿ç”¨ FreeBSD ä¸­åŒ…å«çš„ Heimdal å‘è¡Œç‰ˆè®¾ç½® Kerberos çš„æŒ‡å—ã€‚ÙZFor purposes of demonstrating a Kerberos installation, the name spaces will be as follows:ÙFä¸ºäº†å±•ç¤º Kerberos å®‰è£…çš„ç›®çš„ï¼Œå‘½åç©ºé—´å°†å¦‚ä¸‹æ‰€ç¤ºï¼šÙ,The DNS domain (zone) will be `example.org`.Ù*DNS åŸŸï¼ˆåŒºåŸŸï¼‰å°†æ˜¯ `example.org`ã€‚Ù)The Kerberos realm will be `EXAMPLE.ORG`.Ù&Kerberos é¢†åŸŸå°†æ˜¯ `EXAMPLE.ORG`ã€‚Ù¡Use real domain names when setting up Kerberos, even if it will run internally.  This avoids DNS problems and assures inter-operation with other Kerberos realms.Ù¦åœ¨è®¾ç½® Kerberos æ—¶ï¼Œè¯·ä½¿ç”¨çœŸå®çš„åŸŸåï¼Œå³ä½¿å®ƒå°†åœ¨å†…éƒ¨è¿è¡Œã€‚è¿™æ ·å¯ä»¥é¿å… DNS é—®é¢˜ï¼Œå¹¶ç¡®ä¿ä¸å…¶ä»– Kerberos é¢†åŸŸçš„äº’æ“ä½œæ€§ã€‚¸Setting up a Heimdal KDC²è®¾ç½® Heimdal KDCÚ—The Key Distribution Center (KDC) is the centralized authentication service that Kerberos provides, the "trusted third party" of the system.  It is the computer that issues Kerberos tickets, which are used for clients to authenticate to servers.  As the KDC is considered trusted by all other computers in the Kerberos realm, it has heightened security concerns.  Direct access to the KDC should be limited.Úiå¯†é’¥åˆ†å‘ä¸­å¿ƒï¼ˆKDCï¼‰æ˜¯ Kerberos æä¾›çš„é›†ä¸­å¼è®¤è¯æœåŠ¡ï¼Œä¹Ÿæ˜¯ç³»ç»Ÿçš„â€œå¯ä¿¡ç¬¬ä¸‰æ–¹â€ã€‚å®ƒæ˜¯å‘æ”¾ Kerberos ç¥¨æ®çš„è®¡ç®—æœºï¼Œç”¨äºå®¢æˆ·ç«¯å¯¹æœåŠ¡å™¨è¿›è¡Œèº«ä»½éªŒè¯ã€‚ç”±äº KDC è¢« Kerberos é¢†åŸŸä¸­çš„æ‰€æœ‰å…¶ä»–è®¡ç®—æœºè§†ä¸ºå¯ä¿¡ä»»çš„ï¼Œå› æ­¤å®ƒå…·æœ‰æ›´é«˜çš„å®‰å…¨æ€§è¦æ±‚ã€‚åº”è¯¥é™åˆ¶å¯¹ KDC çš„ç›´æ¥è®¿é—®ã€‚ÙƒWhile running a KDC requires few computing resources, a dedicated machine acting only as a KDC is recommended for security reasons.Ùfè¿è¡Œ KDC æ‰€éœ€çš„è®¡ç®—èµ„æºå¾ˆå°‘ï¼Œä½†å‡ºäºå®‰å…¨åŸå› ï¼Œå»ºè®®ä½¿ç”¨ä¸“ç”¨æœºå™¨ä½œä¸º KDCã€‚ÙDTo begin, install the package:security/heimdal[] package as follows:ÙIé¦–å…ˆï¼ŒæŒ‰ç…§ä»¥ä¸‹æ–¹å¼å®‰è£… package:security/heimdal[] è½¯ä»¶åŒ…ï¼šÙ@Next, update [.filename]#/etc/rc.conf# using `sysrc` as follows:ÙWæ¥ä¸‹æ¥ï¼Œä½¿ç”¨ `sysrc` æŒ‰ç…§ä»¥ä¸‹æ–¹å¼æ›´æ–° [.filename]#/etc/rc.conf# æ–‡ä»¶ï¼šÙ2Next, edit [.filename]#/etc/krb5.conf# as follows:ÙJæ¥ä¸‹æ¥ï¼ŒæŒ‰ç…§ä»¥ä¸‹æ–¹å¼ç¼–è¾‘ [.filename]#/etc/krb5.conf# æ–‡ä»¶ï¼šÙIn this example, the KDC will use the fully-qualified hostname `kerberos.example.org`.  The hostname of the KDC must be resolvable in the DNS.Ù„åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒKDC å°†ä½¿ç”¨å®Œå…¨é™å®šçš„ä¸»æœºå `kerberos.example.org`ã€‚KDC çš„ä¸»æœºåå¿…é¡»èƒ½å¤Ÿåœ¨ DNS ä¸­è§£æã€‚ÙÎKerberos can also use the DNS to locate KDCs, instead of a `[realms]` section in [.filename]#/etc/krb5.conf#.  For large organizations that have their own DNS servers, the above example could be trimmed to:ÙÈKerberos ä¹Ÿå¯ä»¥ä½¿ç”¨ DNS æ¥å®šä½ KDCsï¼Œè€Œä¸æ˜¯åœ¨ [.filename]#/etc/krb5.conf# æ–‡ä»¶çš„ `[realms]` éƒ¨åˆ†ä¸­ã€‚å¯¹äºæ‹¥æœ‰è‡ªå·± DNS æœåŠ¡å™¨çš„å¤§å‹ç»„ç»‡ï¼Œä¸Šè¿°ç¤ºä¾‹å¯ä»¥ç®€åŒ–ä¸ºï¼šÙGWith the following lines being included in the `example.org` zone file:Ù3åœ¨ `example.org` åŒºåŸŸæ–‡ä»¶ä¸­åŒ…å«ä»¥ä¸‹è¡Œï¼šÙãIn order for clients to be able to find the Kerberos services, they _must_ have either a fully configured [.filename]#/etc/krb5.conf# or a minimally configured [.filename]#/etc/krb5.conf# _and_ a properly configured DNS server.ÙÍä¸ºäº†ä½¿å®¢æˆ·ç«¯èƒ½å¤Ÿæ‰¾åˆ° Kerberos æœåŠ¡ï¼Œå®ƒä»¬å¿…é¡»å…·æœ‰å®Œå…¨é…ç½®çš„ [.filename]#/etc/krb5.conf# æ–‡ä»¶æˆ–æœ€å°é…ç½®çš„ [.filename]#/etc/krb5.conf# æ–‡ä»¶å’Œæ­£ç¡®é…ç½®çš„ DNS æœåŠ¡å™¨ã€‚ÚtNext, create the Kerberos database which contains the keys of all principals (users and hosts) encrypted with a master password.  It is not required to remember this password as it will be stored in [.filename]#/var/heimdal/m-key#; it would be reasonable to use a 45-character random password for this purpose.  To create the master key, run `kstash` and enter a password:ÚMæ¥ä¸‹æ¥ï¼Œåˆ›å»º Kerberos æ•°æ®åº“ï¼Œå…¶ä¸­åŒ…å«ä½¿ç”¨ä¸»å¯†ç åŠ å¯†çš„æ‰€æœ‰ä¸»ä½“ï¼ˆç”¨æˆ·å’Œä¸»æœºï¼‰çš„å¯†é’¥ã€‚ä¸éœ€è¦è®°ä½æ­¤å¯†ç ï¼Œå› ä¸ºå®ƒå°†å­˜å‚¨åœ¨ [.filename]#/var/heimdal/m-key# ä¸­ï¼›ä¸ºæ­¤ç›®çš„ä½¿ç”¨ä¸€ä¸ª 45 ä¸ªå­—ç¬¦çš„éšæœºå¯†ç æ˜¯åˆç†çš„ã€‚è¦åˆ›å»ºä¸»å¯†é’¥ï¼Œè¯·è¿è¡Œ `kstash` å¹¶è¾“å…¥å¯†ç ï¼šÚ¶Once the master key has been created, the database should be initialized.  The Kerberos administrative tool man:kadmin[8] can be used on the KDC in a mode that operates directly on the database, without using the man:kadmind[8] network service, as `kadmin -l`.  This resolves the chicken-and-egg problem of trying to connect to the database before it is created.  At the `kadmin` prompt, use `init` to create the realm's initial database:Úpä¸€æ—¦ä¸»å¯†é’¥è¢«åˆ›å»ºï¼Œå°±åº”è¯¥åˆå§‹åŒ–æ•°æ®åº“ã€‚å¯ä»¥åœ¨ KDC ä¸Šä½¿ç”¨ Kerberos ç®¡ç†å·¥å…· man:kadmin[8] ä»¥ `kadmin -l` çš„æ¨¡å¼ç›´æ¥æ“ä½œæ•°æ®åº“ï¼Œè€Œä¸ä½¿ç”¨ man:kadmind[8] ç½‘ç»œæœåŠ¡ã€‚è¿™è§£å†³äº†åœ¨åˆ›å»ºæ•°æ®åº“ä¹‹å‰å°è¯•è¿æ¥æ•°æ®åº“çš„é¸¡ç”Ÿè›‹é—®é¢˜ã€‚åœ¨ `kadmin` æç¤ºç¬¦ä¸‹ï¼Œä½¿ç”¨ `init` å‘½ä»¤åˆ›å»ºé¢†åŸŸçš„åˆå§‹æ•°æ®åº“ï¼šÙäLastly, while still in `kadmin`, create the first principal using `add`.  Stick to the default options for the principal for now, as these can be changed later with `modify`.  Type `?` at the prompt to see the available options.Ù×æœ€åï¼Œåœ¨ `kadmin` ä¸­ä½¿ç”¨ `add` å‘½ä»¤åˆ›å»ºç¬¬ä¸€ä¸ªä¸»ä½“ã€‚æš‚æ—¶ä½¿ç”¨é»˜è®¤é€‰é¡¹ï¼Œå› ä¸ºè¿™äº›é€‰é¡¹å¯ä»¥åœ¨ä»¥åä½¿ç”¨ `modify` å‘½ä»¤è¿›è¡Œæ›´æ”¹ã€‚åœ¨æç¤ºç¬¦å¤„è¾“å…¥ `?` ä»¥æŸ¥çœ‹å¯ç”¨é€‰é¡¹ã€‚Ù(Next, start the KDC services by running:Ù8æ¥ä¸‹æ¥ï¼Œé€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤å¯åŠ¨ KDC æœåŠ¡ï¼šÙºWhile there will not be any kerberized daemons running at this point, it is possible to confirm that the KDC is functioning by obtaining a ticket for the principal that was just created:Ù›åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œä¸ä¼šæœ‰ä»»ä½•è¿è¡Œçš„ Kerberized å®ˆæŠ¤ç¨‹åºï¼Œä½†å¯ä»¥é€šè¿‡è·å–åˆšåˆšåˆ›å»ºçš„ä¸»ä½“çš„ç¥¨è¯æ¥ç¡®è®¤ KDC æ˜¯å¦æ­£å¸¸è¿è¡Œï¼šÙ>Confirm that a ticket was successfully obtained using `klist`:Ù3ä½¿ç”¨ `klist` ç¡®è®¤æˆåŠŸè·å–äº†ä¸€å¼ ç¥¨æ®ã€‚Ù@The temporary ticket can be destroyed when the test is finished:Ù0æµ‹è¯•å®Œæˆåï¼Œä¸´æ—¶ç¥¨æ®å¯ä»¥è¢«é”€æ¯ã€‚Ù$Configuring a Server to Use Kerberos¾é…ç½®æœåŠ¡å™¨ä½¿ç”¨ KerberosÙñThe first step in configuring a server to use Kerberos authentication is to ensure that it has the correct configuration in [.filename]#/etc/krb5.conf#.  The version from the KDC can be used as-is, or it can be regenerated on the new system.Ùİé…ç½®æœåŠ¡å™¨ä»¥ä½¿ç”¨ Kerberos èº«ä»½éªŒè¯çš„ç¬¬ä¸€æ­¥æ˜¯ç¡®ä¿å®ƒåœ¨ [.filename]#/etc/krb5.conf# ä¸­å…·æœ‰æ­£ç¡®çš„é…ç½®ã€‚å¯ä»¥ç›´æ¥ä½¿ç”¨ KDC æä¾›çš„ç‰ˆæœ¬ï¼Œæˆ–è€…å¯ä»¥åœ¨æ–°ç³»ç»Ÿä¸Šé‡æ–°ç”Ÿæˆè¯¥æ–‡ä»¶ã€‚Ú3Next, create [.filename]#/etc/krb5.keytab# on the server.  This is the main part of "Kerberizing" a service - it corresponds to generating a secret shared between the service and the KDC.  The secret is a cryptographic key, stored in a "keytab".  The keytab contains the server's host key, which allows it and the KDC to verify each others' identity.  It must be transmitted to the server in a secure fashion, as the security of the server can be broken if the key is made public.  Typically, the [.filename]#keytab# is generated on an administrator's trusted machine using `kadmin`, then securely transferred to the server, e.g., with man:scp[1]; it can also be created directly on the server if that is consistent with the desired security policy.  It is very important that the keytab is transmitted to the server in a secure fashion: if the key is known by some other party, that party can impersonate any user to the server! Using `kadmin` on the server directly is convenient, because the entry for the host principal in the KDC database is also created using `kadmin`.Úæ¥ä¸‹æ¥ï¼Œåœ¨æœåŠ¡å™¨ä¸Šåˆ›å»º [.filename]#/etc/krb5.keytab# æ–‡ä»¶ã€‚è¿™æ˜¯â€œKerberizingâ€æœåŠ¡çš„ä¸»è¦éƒ¨åˆ† - å®ƒå¯¹åº”äºåœ¨æœåŠ¡å’Œ KDC ä¹‹é—´ç”Ÿæˆä¸€ä¸ªå…±äº«å¯†é’¥ã€‚è¿™ä¸ªå¯†é’¥æ˜¯ä¸€ä¸ªåŠ å¯†å¯†é’¥ï¼Œå­˜å‚¨åœ¨ä¸€ä¸ªâ€œkeytabâ€æ–‡ä»¶ä¸­ã€‚ keytab æ–‡ä»¶åŒ…å«äº†æœåŠ¡å™¨çš„ä¸»æœºå¯†é’¥ï¼Œå®ƒå…è®¸æœåŠ¡å™¨å’Œ KDC éªŒè¯å½¼æ­¤çš„èº«ä»½ã€‚å¿…é¡»ä»¥å®‰å…¨çš„æ–¹å¼å°†å®ƒä¼ è¾“åˆ°æœåŠ¡å™¨ä¸Šï¼Œå› ä¸ºå¦‚æœå¯†é’¥è¢«å…¬å¼€ï¼ŒæœåŠ¡å™¨çš„å®‰å…¨æ€§å¯èƒ½ä¼šè¢«ç ´åã€‚é€šå¸¸ï¼Œ[.filename]#keytab# æ–‡ä»¶æ˜¯åœ¨ç®¡ç†å‘˜ä¿¡ä»»çš„æœºå™¨ä¸Šä½¿ç”¨ `kadmin` ç”Ÿæˆçš„ï¼Œç„¶åé€šè¿‡å®‰å…¨ä¼ è¾“æ–¹å¼ä¼ è¾“åˆ°æœåŠ¡å™¨ä¸Šï¼Œä¾‹å¦‚ä½¿ç”¨ man:scp[1] å‘½ä»¤ï¼›å¦‚æœç¬¦åˆæ‰€éœ€çš„å®‰å…¨ç­–ç•¥ï¼Œä¹Ÿå¯ä»¥ç›´æ¥åœ¨æœåŠ¡å™¨ä¸Šåˆ›å»ºã€‚éå¸¸é‡è¦çš„æ˜¯ï¼Œå¿…é¡»ä»¥å®‰å…¨çš„æ–¹å¼å°† keytab æ–‡ä»¶ä¼ è¾“åˆ°æœåŠ¡å™¨ä¸Šï¼šå¦‚æœå¯†é’¥è¢«å…¶ä»–æ–¹çŸ¥æ™“ï¼Œè¯¥æ–¹å¯ä»¥å†’å……ä»»ä½•ç”¨æˆ·è®¿é—®æœåŠ¡å™¨ï¼åœ¨æœåŠ¡å™¨ä¸Šç›´æ¥ä½¿ç”¨ `kadmin` éå¸¸æ–¹ä¾¿ï¼Œå› ä¸ºåœ¨ KDC æ•°æ®åº“ä¸­ä¸ºä¸»æœºä¸»ä½“åˆ›å»ºæ¡ç›®ä¹Ÿæ˜¯ä½¿ç”¨ `kadmin` å®Œæˆçš„ã€‚ÚáOf course, `kadmin` is a kerberized service; a Kerberos ticket is needed to authenticate to the network service, but to ensure that the user running `kadmin` is actually present (and their session has not been hijacked), `kadmin` will prompt for the password to get a fresh ticket.  The principal authenticating to the kadmin service must be permitted to use the `kadmin` interface, as specified in [.filename]#/var/heimdal/kadmind.acl#. See the section titled "Remote administration" in `info heimdal` for details on designing access control lists.  Instead of enabling remote `kadmin` access, the administrator could securely connect to the KDC via the local console or man:ssh[1], and perform administration locally using `kadmin -l`.ÚÔå½“ç„¶ï¼Œ`kadmin` æ˜¯ä¸€ä¸ªä½¿ç”¨ Kerberos è¿›è¡Œèº«ä»½éªŒè¯çš„æœåŠ¡ï¼›éœ€è¦ä¸€ä¸ª Kerberos ç¥¨è¯æ¥è®¤è¯åˆ°ç½‘ç»œæœåŠ¡ï¼Œä½†ä¸ºäº†ç¡®ä¿è¿è¡Œ `kadmin` çš„ç”¨æˆ·å®é™…ä¸Šå­˜åœ¨ï¼ˆå¹¶ä¸”ä»–ä»¬çš„ä¼šè¯æ²¡æœ‰è¢«åŠ«æŒï¼‰ï¼Œ`kadmin` ä¼šæç¤ºè¾“å…¥å¯†ç ä»¥è·å–ä¸€ä¸ªæ–°çš„ç¥¨è¯ã€‚è®¤è¯åˆ° kadmin æœåŠ¡çš„ä¸»ä½“å¿…é¡»è¢«å…è®¸ä½¿ç”¨ `kadmin` æ¥å£ï¼Œå¦‚ [.filename]#/var/heimdal/kadmind.acl# ä¸­æ‰€æŒ‡å®šçš„ã€‚æœ‰å…³è®¾è®¡è®¿é—®æ§åˆ¶åˆ—è¡¨çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… `info heimdal` ä¸­æ ‡é¢˜ä¸ºâ€œè¿œç¨‹ç®¡ç†ï¼ˆRemote administrationï¼‰â€çš„éƒ¨åˆ†ã€‚ç®¡ç†å‘˜å¯ä»¥é€šè¿‡æœ¬åœ°æ§åˆ¶å°æˆ– man:ssh[1] å®‰å…¨åœ°è¿æ¥åˆ° KDCï¼Œå¹¶ä½¿ç”¨ `kadmin -l` åœ¨æœ¬åœ°è¿›è¡Œç®¡ç†ï¼Œè€Œä¸æ˜¯å¯ç”¨è¿œç¨‹ `kadmin` è®¿é—®ã€‚Ú-After installing [.filename]#/etc/krb5.conf#, use `add --random-key` in `kadmin`.  This adds the server's host principal to the database, but does not extract a copy of the host principal key to a keytab.  To generate the keytab, use `ext` to extract the server's host principal key to its own keytab:Ú>åœ¨å®‰è£…å®Œ [.filename]#/etc/krb5.conf# åï¼Œåœ¨ `kadmin` ä¸­ä½¿ç”¨ `add --random-key` å‘½ä»¤ã€‚è¿™å°†å‘æ•°æ®åº“ä¸­æ·»åŠ æœåŠ¡å™¨çš„ä¸»æœºä¸»ä½“ï¼Œä½†ä¸ä¼šå°†ä¸»æœºä¸»ä½“å¯†é’¥æå–åˆ°å¯†é’¥è¡¨ä¸­ã€‚è¦ç”Ÿæˆå¯†é’¥è¡¨ï¼Œè¯·ä½¿ç”¨ `ext` å‘½ä»¤å°†æœåŠ¡å™¨çš„ä¸»æœºä¸»ä½“å¯†é’¥æå–åˆ°å…¶è‡ªå·±çš„å¯†é’¥è¡¨ä¸­ï¼šÚNote that `ext_keytab` stores the extracted key in [.filename]#/etc/krb5.keytab# by default.  This is good when being run on the server being kerberized, but the `--keytab _path/to/file_` argument should be used when the keytab is being extracted elsewhere:Úè¯·æ³¨æ„ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œ`ext_keytab` å°†æå–çš„å¯†é’¥å­˜å‚¨åœ¨ [.filename]#/etc/krb5.keytab# ä¸­ã€‚å½“åœ¨è¿›è¡Œ Kerberos è®¤è¯çš„æœåŠ¡å™¨ä¸Šè¿è¡Œæ—¶ï¼Œè¿™æ˜¯å¾ˆå¥½çš„é€‰æ‹©ã€‚ä½†æ˜¯ï¼Œå½“å¯†é’¥è¡¨åœ¨å…¶ä»–åœ°æ–¹æå–æ—¶ï¼Œåº”ä½¿ç”¨ `--keytab _path/to/file_` å‚æ•°ã€‚ÙÄThe keytab can then be securely copied to the server using man:scp[1] or a removable media.  Be sure to specify a non-default keytab name to avoid inserting unneeded keys into the system's keytab.ÙÉç„¶åï¼Œå¯ä»¥ä½¿ç”¨ man:scp[1] æˆ–å¯ç§»åŠ¨ä»‹è´¨å°† keytab å®‰å…¨åœ°å¤åˆ¶åˆ°æœåŠ¡å™¨ã€‚è¯·ç¡®ä¿æŒ‡å®šä¸€ä¸ªéé»˜è®¤çš„ keytab åç§°ï¼Œä»¥é¿å…å°†ä¸å¿…è¦çš„å¯†é’¥æ’å…¥ç³»ç»Ÿçš„ keytab ä¸­ã€‚ÚPAt this point, the server can read encrypted messages from the KDC using its shared key, stored in [.filename]#krb5.keytab#.  It is now ready for the Kerberos-using services to be enabled.  One of the most common such services is man:sshd[8], which supports Kerberos via the GSS-API.  In [.filename]#/etc/ssh/sshd_config#, add the line:Ú0æ­¤æ—¶ï¼ŒæœåŠ¡å™¨å¯ä»¥ä½¿ç”¨å­˜å‚¨åœ¨ [.filename]#krb5.keytab# ä¸­çš„å…±äº«å¯†é’¥ä» KDC è¯»å–åŠ å¯†æ¶ˆæ¯ã€‚ç°åœ¨å¯ä»¥å¯ç”¨ä½¿ç”¨ Kerberos çš„æœåŠ¡äº†ã€‚å…¶ä¸­æœ€å¸¸è§çš„æœåŠ¡ä¹‹ä¸€æ˜¯ man:sshd[8]ï¼Œå®ƒé€šè¿‡ GSS-API æ”¯æŒ Kerberosã€‚åœ¨ [.filename]#/etc/ssh/sshd_config# ä¸­æ·»åŠ ä»¥ä¸‹è¡Œï¼šÙyAfter making this change, man:sshd[8] must be restarted for the new configuration to take effect: `service sshd restart`.Ùkåœ¨è¿›è¡Œæ­¤æ›´æ”¹åï¼Œå¿…é¡»é‡æ–°å¯åŠ¨ man:sshd[8] ä»¥ä½¿æ–°çš„é…ç½®ç”Ÿæ•ˆï¼š`service sshd restart`ã€‚Ù$Configuring a Client to Use Kerberos¾é…ç½®å®¢æˆ·ç«¯ä½¿ç”¨ KerberosÙ˜As it was for the server, the client requires configuration in [.filename]#/etc/krb5.conf#.  Copy the file in place (securely) or re-enter it as needed.Ù¡ä¸æœåŠ¡å™¨ä¸€æ ·ï¼Œå®¢æˆ·ç«¯éœ€è¦åœ¨ [.filename]#/etc/krb5.conf# ä¸­è¿›è¡Œé…ç½®ã€‚å°†æ–‡ä»¶å¤åˆ¶åˆ°æŒ‡å®šä½ç½®ï¼ˆå®‰å…¨åœ°ï¼‰æˆ–æ ¹æ®éœ€è¦é‡æ–°è¾“å…¥ã€‚ÚâTest the client by using `kinit`, `klist`, and `kdestroy` from the client to obtain, show, and then delete a ticket for an existing principal.  Kerberos applications should also be able to connect to Kerberos enabled servers.  If that does not work but obtaining a ticket does, the problem is likely with the server and not with the client or the KDC.  In the case of kerberized man:ssh[1], GSS-API is disabled by default, so test using `ssh -o GSSAPIAuthentication=yes _hostname_`.Úûé€šè¿‡åœ¨å®¢æˆ·ç«¯ä½¿ç”¨ `kinit`ã€`klist` å’Œ `kdestroy` å‘½ä»¤æ¥è·å–ã€æ˜¾ç¤ºå’Œåˆ é™¤ç°æœ‰ä¸»ä½“çš„ç¥¨è¯ï¼Œæ¥æµ‹è¯•å®¢æˆ·ç«¯ã€‚ Kerberos åº”ç”¨ç¨‹åºä¹Ÿåº”è¯¥èƒ½å¤Ÿè¿æ¥åˆ°å¯ç”¨äº† Kerberos çš„æœåŠ¡å™¨ã€‚å¦‚æœè¿æ¥ä¸èµ·ä½œç”¨ï¼Œä½†æ˜¯è·å–ç¥¨è¯å¯ä»¥ï¼Œé‚£ä¹ˆé—®é¢˜å¾ˆå¯èƒ½æ˜¯æœåŠ¡å™¨è€Œä¸æ˜¯å®¢æˆ·ç«¯æˆ– KDC çš„é—®é¢˜ã€‚åœ¨ä½¿ç”¨ kerberized man:ssh[1] çš„æƒ…å†µä¸‹ï¼Œé»˜è®¤æƒ…å†µä¸‹ç¦ç”¨äº† GSS-APIï¼Œå› æ­¤è¯·ä½¿ç”¨ `ssh -o GSSAPIAuthentication = yes _hostname_` å‘½ä»¤è¿›è¡Œæµ‹è¯•ã€‚Ù’When testing a Kerberized application, try using a packet sniffer such as `tcpdump` to confirm that no sensitive information is sent in the clear.Ù‰åœ¨æµ‹è¯• Kerberized åº”ç”¨ç¨‹åºæ—¶ï¼Œå°è¯•ä½¿ç”¨è¯¸å¦‚ `tcpdump` ä¹‹ç±»çš„æ•°æ®åŒ…å—…æ¢å™¨æ¥ç¡®è®¤æ²¡æœ‰æ˜æ–‡å‘é€æ•æ„Ÿä¿¡æ¯ã€‚ÚVarious Kerberos client applications are available.  With the advent of a bridge so that applications using SASL for authentication can use GSS-API mechanisms as well, large classes of client applications can use Kerberos for authentication, from Jabber clients to IMAP clients.Ú$æœ‰å„ç§ä¸åŒçš„ Kerberos å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºå¯ä¾›é€‰æ‹©ã€‚éšç€æ¡¥æ¥çš„å‡ºç°ï¼Œä½¿ç”¨ SASL è¿›è¡Œèº«ä»½éªŒè¯çš„åº”ç”¨ç¨‹åºä¹Ÿå¯ä»¥ä½¿ç”¨ GSS-API æœºåˆ¶ï¼Œå› æ­¤å¤§éƒ¨åˆ†å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºéƒ½å¯ä»¥ä½¿ç”¨ Kerberos è¿›è¡Œèº«ä»½éªŒè¯ï¼ŒåŒ…æ‹¬ Jabber å®¢æˆ·ç«¯å’Œ IMAP å®¢æˆ·ç«¯ã€‚ÚvUsers within a realm typically have their Kerberos principal mapped to a local user account.  Occasionally, one needs to grant access to a local user account to someone who does not have a matching Kerberos principal.  For example, `tillman@EXAMPLE.ORG` may need access to the local user account `webdevelopers`.  Other principals may also need access to that local account.ÚBåœ¨ä¸€ä¸ªé¢†åŸŸä¸­ï¼Œé€šå¸¸ä¼šå°†ç”¨æˆ·çš„ Kerberos ä¸»ä½“æ˜ å°„åˆ°æœ¬åœ°ç”¨æˆ·è´¦æˆ·ã€‚å¶å°”ï¼Œéœ€è¦å°†æœ¬åœ°ç”¨æˆ·è´¦æˆ·çš„è®¿é—®æƒé™æˆäºˆæ²¡æœ‰åŒ¹é…çš„ Kerberos ä¸»ä½“çš„äººã€‚ä¾‹å¦‚ï¼Œ`tillman@EXAMPLE.ORG` å¯èƒ½éœ€è¦è®¿é—®æœ¬åœ°ç”¨æˆ·è´¦æˆ· `webdevelopers`ã€‚å…¶ä»–ä¸»ä½“ä¹Ÿå¯èƒ½éœ€è¦è®¿é—®è¯¥æœ¬åœ°è´¦æˆ·ã€‚ÚFThe [.filename]#.k5login# and [.filename]#.k5users# files, placed in a user's home directory, can be used to solve this problem.  For example, if the following [.filename]#.k5login# is placed in the home directory of `webdevelopers`, both principals listed will have access to that account without requiring a shared password:Ú"æ”¾ç½®åœ¨ç”¨æˆ·çš„ä¸»ç›®å½•ä¸­çš„ [.filename]#.k5login# å’Œ [.filename]#.k5users# æ–‡ä»¶å¯ä»¥ç”¨æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ä¾‹å¦‚ï¼Œå¦‚æœå°†ä»¥ä¸‹ [.filename]#.k5login# æ–‡ä»¶æ”¾ç½®åœ¨ `webdevelopers` çš„ä¸»ç›®å½•ä¸­ï¼Œåˆ—å‡ºçš„ä¸¤ä¸ªä¸»ä½“éƒ½å¯ä»¥è®¿é—®è¯¥å¸æˆ·ï¼Œè€Œæ— éœ€å…±äº«å¯†ç ï¼šÙERefer to man:ksu[1] for more information about [.filename]#.k5users#.ÙJè¯·å‚è€ƒ man:ksu[1] è·å–æœ‰å…³ [.filename]#.k5users# çš„æ›´å¤šä¿¡æ¯ã€‚¯MIT Differences±ä¸ MIT çš„å·®å¼‚ÚThe major difference between the MIT and Heimdal implementations is that `kadmin` has a different, but equivalent, set of commands and uses a different protocol.  If the KDC is MIT, the Heimdal version of `kadmin` cannot be used to administer the KDC remotely, and vice versa.ÙãMIT å’Œ Heimdal å®ç°ä¹‹é—´çš„ä¸»è¦åŒºåˆ«æ˜¯ `kadmin` å…·æœ‰ä¸åŒä½†ç­‰æ•ˆçš„å‘½ä»¤é›†ï¼Œå¹¶ä¸”ä½¿ç”¨ä¸åŒçš„åè®®ã€‚å¦‚æœ KDC æ˜¯ MIT ç‰ˆæœ¬ï¼Œåˆ™æ— æ³•ä½¿ç”¨ Heimdal ç‰ˆæœ¬çš„ `kadmin` è¿œç¨‹ç®¡ç† KDCï¼Œåä¹‹äº¦ç„¶ã€‚Ú¦Client applications may also use slightly different command line options to accomplish the same tasks.  Following the instructions at http://web.mit.edu/Kerberos/www/[http://web.mit.edu/Kerberos/www/] is recommended.  Be careful of path issues: the MIT port installs into [.filename]#/usr/local/# by default, and the FreeBSD system applications run instead of the MIT versions if `PATH` lists the system directories first.Ú†å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºä¹Ÿå¯ä»¥ä½¿ç”¨ç¨å¾®ä¸åŒçš„å‘½ä»¤è¡Œé€‰é¡¹æ¥å®Œæˆç›¸åŒçš„ä»»åŠ¡ã€‚å»ºè®®æŒ‰ç…§ http://web.mit.edu/Kerberos/www/[http://web.mit.edu/Kerberos/www/] ä¸Šçš„è¯´æ˜è¿›è¡Œæ“ä½œã€‚è¯·æ³¨æ„è·¯å¾„é—®é¢˜ï¼šMIT ç«¯å£é»˜è®¤å®‰è£…åœ¨ [.filename]#/usr/local/# ä¸­ï¼Œå¦‚æœ `PATH` åˆ—è¡¨ä¸­é¦–å…ˆåˆ—å‡ºç³»ç»Ÿç›®å½•ï¼Œåˆ™ FreeBSD ç³»ç»Ÿåº”ç”¨ç¨‹åºå°†ä»£æ›¿ MIT ç‰ˆæœ¬è¿è¡Œã€‚ÙŒWhen using MIT Kerberos as a KDC on FreeBSD, execute the following commands to add the required configurations to [.filename]#/etc/rc.conf#:Ùˆåœ¨ FreeBSD ä¸Šä½¿ç”¨ MIT Kerberos ä½œä¸º KDC æ—¶ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤å°†æ‰€éœ€çš„é…ç½®æ·»åŠ åˆ° [.filename]#/etc/rc.conf# æ–‡ä»¶ä¸­ï¼šÙ*Kerberos Tips, Tricks, and TroubleshootingÙ'Kerberos æç¤ºã€æŠ€å·§å’Œæ•…éšœæ’é™¤ÙQWhen configuring and troubleshooting Kerberos, keep the following points in mind:Ù@åœ¨é…ç½®å’Œæ•…éšœæ’é™¤ Kerberos æ—¶ï¼Œè¯·è®°ä½ä»¥ä¸‹å‡ ç‚¹ï¼šÙœWhen using either Heimdal or MITKerberos from ports, ensure that the `PATH` lists the port's versions of the client applications before the system versions.Ù—åœ¨ä½¿ç”¨æ¥è‡ª ports çš„ Heimdal æˆ– MITKerberos æ—¶ï¼Œè¯·ç¡®ä¿ `PATH` ä¸­åˆ—å‡ºçš„æ˜¯ç«¯å£ç‰ˆæœ¬çš„å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºï¼Œè€Œä¸æ˜¯ç³»ç»Ÿç‰ˆæœ¬ã€‚ÙÜIf all the computers in the realm do not have synchronized time settings, authentication may fail. crossref:network-servers[network-ntp,â€œClock Synchronization with NTPâ€] describes how to synchronize clocks using NTP.ÙËå¦‚æœé¢†åŸŸä¸­çš„æ‰€æœ‰è®¡ç®—æœºæ²¡æœ‰åŒæ­¥çš„æ—¶é—´è®¾ç½®ï¼Œè®¤è¯å¯èƒ½ä¼šå¤±è´¥ã€‚ crossref:network-servers[network-ntp,â€œä½¿ç”¨ NTP è¿›è¡Œæ—¶é’ŸåŒæ­¥â€] æè¿°äº†å¦‚ä½•ä½¿ç”¨ NTP åŒæ­¥æ—¶é’Ÿã€‚ÙÏIf the hostname is changed, the `host/` principal must be changed and the keytab updated. This also applies to special keytab entries like the `HTTP/` principal used for Apache's package:www/mod_auth_kerb[].ÙÆå¦‚æœä¸»æœºåå‘ç”Ÿå˜åŒ–ï¼Œåˆ™å¿…é¡»æ›´æ”¹ `host/` ä¸»ä½“å¹¶æ›´æ–° keytabã€‚è¿™ä¹Ÿé€‚ç”¨äºç‰¹æ®Šçš„ keytab æ¡ç›®ï¼Œæ¯”å¦‚ç”¨äº Apache çš„ `HTTP/` ä¸»ä½“ï¼Œä¾‹å¦‚ package:www/mod_auth_kerb[]ã€‚ÚYAll hosts in the realm must be both forward and reverse resolvable in DNS or, at a minimum, exist in [.filename]#/etc/hosts#. CNAMEs will work, but the A and PTR records must be correct and in place. The error message for unresolvable hosts is not intuitive: `Kerberos5 refuses authentication because Read req failed: Key table entry not found`.Úgé¢†åŸŸä¸­çš„æ‰€æœ‰ä¸»æœºå¿…é¡»åœ¨ DNS ä¸­å…·æœ‰æ­£å‘å’Œåå‘è§£æçš„èƒ½åŠ›ï¼Œæˆ–è€…è‡³å°‘å­˜åœ¨äº [.filename]#/etc/hosts# æ–‡ä»¶ä¸­ã€‚CNAME è®°å½•å¯ä»¥ä½¿ç”¨ï¼Œä½† A è®°å½•å’Œ PTR è®°å½•å¿…é¡»æ­£ç¡®å¹¶ä¸”å­˜åœ¨ã€‚å¯¹äºæ— æ³•è§£æçš„ä¸»æœºï¼Œé”™è¯¯æ¶ˆæ¯å¹¶ä¸ç›´è§‚ï¼š`Kerberos5 refuses authenticatio because Read req failed: Key table entry not found`ÙÄSome operating systems that act as clients to the KDC do not set the permissions for `ksu` to be setuid `root`. This means that `ksu` does not work. This is a permissions problem, not a KDC error.Ù­ä¸€äº›ä½œä¸º KDC å®¢æˆ·ç«¯çš„æ“ä½œç³»ç»Ÿæ²¡æœ‰è®¾ç½® `ksu` çš„æƒé™ä¸º setuid `root`ã€‚è¿™æ„å‘³ç€ `ksu` æ— æ³•å·¥ä½œã€‚è¿™æ˜¯ä¸€ä¸ªæƒé™é—®é¢˜ï¼Œè€Œä¸æ˜¯ KDC é”™è¯¯ã€‚ÚFWith MITKerberos, to allow a principal to have a ticket life longer than the default lifetime of ten hours, use `modify_principal` at the man:kadmin[8] prompt to change the `maxlife` of both the principal in question and the `krbtgt` principal. The principal can then use `kinit -l` to request a ticket with a longer lifetime.ÚOä½¿ç”¨ MITKerberosï¼Œå¦‚æœè¦å…è®¸ä¸€ä¸ªä¸»ä½“æ‹¥æœ‰æ¯”é»˜è®¤çš„åå°æ—¶æ›´é•¿çš„ç¥¨æ®ç”Ÿå‘½å‘¨æœŸï¼Œå¯ä»¥åœ¨ man:kadmin[8] æç¤ºç¬¦ä¸‹ä½¿ç”¨ `modify_principal` å‘½ä»¤æ¥æ›´æ”¹ç›¸å…³ä¸»ä½“å’Œ `krbtgt` ä¸»ä½“çš„ `maxlife` å±æ€§ã€‚ç„¶åï¼Œè¯¥ä¸»ä½“å¯ä»¥ä½¿ç”¨ `kinit -l` å‘½ä»¤æ¥è¯·æ±‚ä¸€ä¸ªå…·æœ‰æ›´é•¿ç”Ÿå‘½å‘¨æœŸçš„ç¥¨æ®ã€‚ÚŒWhen running a packet sniffer on the KDC to aid in troubleshooting while running `kinit` from a workstation, the Ticket Granting Ticket (TGT) is sent immediately, even before the password is typed. This is because the Kerberos server freely transmits a TGT to any unauthorized request. However, every TGT is encrypted in a key derived from the user's password. When a user types their password, it is not sent to the KDC, it is instead used to decrypt the TGT that `kinit` already obtained. If the decryption process results in a valid ticket with a valid time stamp, the user has valid Kerberos credentials. These credentials include a session key for establishing secure communications with the Kerberos server in the future, as well as the actual TGT, which is encrypted with the Kerberos server's own key. This second layer of encryption allows the Kerberos server to verify the authenticity of each TGT.Ú	åœ¨ä»å·¥ä½œç«™è¿è¡Œ `kinit` æ—¶ï¼Œåœ¨ KDC ä¸Šè¿è¡Œæ•°æ®åŒ…å—…æ¢å™¨ä»¥å¸®åŠ©æ•…éšœæ’é™¤æ—¶ï¼Œç¥¨æ®æˆäºˆç¥¨è¯ï¼ˆTGTï¼‰ä¼šç«‹å³å‘é€ï¼Œç”šè‡³åœ¨è¾“å…¥å¯†ç ä¹‹å‰ã€‚è¿™æ˜¯å› ä¸º Kerberos æœåŠ¡å™¨ä¼šè‡ªç”±åœ°å‘ä»»ä½•æœªç»æˆæƒçš„è¯·æ±‚ä¼ è¾“ TGTã€‚ç„¶è€Œï¼Œæ¯ä¸ª TGT éƒ½æ˜¯ä½¿ç”¨ç”¨æˆ·å¯†ç æ´¾ç”Ÿçš„å¯†é’¥è¿›è¡ŒåŠ å¯†çš„ã€‚å½“ç”¨æˆ·è¾“å…¥å¯†ç æ—¶ï¼Œå®ƒä¸ä¼šè¢«å‘é€åˆ° KDCï¼Œè€Œæ˜¯ç”¨äºè§£å¯† `kinit` å·²ç»è·å–çš„ TGTã€‚å¦‚æœè§£å¯†è¿‡ç¨‹äº§ç”Ÿä¸€ä¸ªå¸¦æœ‰æœ‰æ•ˆæ—¶é—´æˆ³çš„æœ‰æ•ˆç¥¨è¯ï¼Œç”¨æˆ·å°±æ‹¥æœ‰æœ‰æ•ˆçš„ Kerberos å‡­è¯ã€‚è¿™äº›å‡­è¯åŒ…æ‹¬ç”¨äºä¸ Kerberos æœåŠ¡å™¨å»ºç«‹å®‰å…¨é€šä¿¡çš„ä¼šè¯å¯†é’¥ï¼Œä»¥åŠä½¿ç”¨ Kerberos æœåŠ¡å™¨è‡ªå·±çš„å¯†é’¥åŠ å¯†çš„å®é™… TGTã€‚è¿™ç¬¬äºŒå±‚åŠ å¯†å…è®¸ Kerberos æœåŠ¡å™¨éªŒè¯æ¯ä¸ª TGT çš„çœŸå®æ€§ã€‚ÚHost principals can have a longer ticket lifetime. If the user principal has a lifetime of a week but the host being connected to has a lifetime of nine hours, the user cache will have an expired host principal and the ticket cache will not work as expected.Ùíä¸»æœºä¸»ä½“å¯ä»¥æ‹¥æœ‰æ›´é•¿çš„ç¥¨æ®ç”Ÿå‘½å‘¨æœŸã€‚å¦‚æœç”¨æˆ·ä¸»ä½“çš„ç”Ÿå‘½å‘¨æœŸä¸ºä¸€å‘¨ï¼Œä½†è¿æ¥çš„ä¸»æœºçš„ç”Ÿå‘½å‘¨æœŸä¸ºä¹å°æ—¶ï¼Œç”¨æˆ·ç¼“å­˜å°†ä¼šæœ‰ä¸€ä¸ªè¿‡æœŸçš„ä¸»æœºä¸»ä½“ï¼Œç¥¨æ®ç¼“å­˜å°†æ— æ³•æŒ‰é¢„æœŸå·¥ä½œã€‚ÚdWhen setting up [.filename]#krb5.dict# to prevent specific bad passwords from being used as described in man:kadmind[8], remember that it only applies to principals that have a password policy assigned to them. The format used in [.filename]#krb5.dict# is one string per line. Creating a symbolic link to [.filename]#/usr/share/dict/words# might be useful.ÚEåœ¨è®¾ç½® [.filename]#krb5.dict# ä»¥é˜²æ­¢ç‰¹å®šçš„å¼±å¯†ç è¢«ä½¿ç”¨ï¼Œå¦‚ man:kadmind[8] ä¸­æ‰€æè¿°çš„é‚£æ ·ï¼Œè¯·è®°ä½å®ƒä»…é€‚ç”¨äºå·²åˆ†é…å¯†ç ç­–ç•¥çš„ä¸»ä½“ã€‚ [.filename]#krb5.dict# ä¸­ä½¿ç”¨çš„æ ¼å¼æ˜¯æ¯è¡Œä¸€ä¸ªå­—ç¬¦ä¸²ã€‚åˆ›å»ºä¸€ä¸ªç¬¦å·é“¾æ¥åˆ° [.filename]#/usr/share/dict/words# å¯èƒ½ä¼šå¾ˆæœ‰ç”¨ã€‚¿Mitigating Kerberos Limitations¹ç¼“è§£ Kerberos çš„é™åˆ¶ÚySince Kerberos is an all or nothing approach, every service enabled on the network must either be modified to work with Kerberos or be otherwise secured against network attacks.  This is to prevent user credentials from being stolen and re-used.  An example is when Kerberos is enabled on all remote shells but the non-Kerberized POP3 mail server sends passwords in plain text.Úpç”±äº Kerberos æ˜¯ä¸€ç§å…¨é¢çš„æ–¹æ³•ï¼Œç½‘ç»œä¸Šçš„æ¯ä¸ªå¯ç”¨çš„æœåŠ¡éƒ½å¿…é¡»è¦ä¹ˆè¢«ä¿®æ”¹ä»¥ä¸ Kerberos ä¸€èµ·å·¥ä½œï¼Œè¦ä¹ˆä»¥å…¶ä»–æ–¹å¼è¿›è¡Œç½‘ç»œæ”»å‡»é˜²æŠ¤ã€‚è¿™æ˜¯ä¸ºäº†é˜²æ­¢ç”¨æˆ·å‡­æ®è¢«çªƒå–å’Œé‡å¤ä½¿ç”¨ã€‚ä¸€ä¸ªä¾‹å­æ˜¯å½“ Kerberos åœ¨æ‰€æœ‰è¿œç¨‹ shell ä¸Šå¯ç”¨æ—¶ï¼Œé Kerberos åŒ–çš„ POP3 é‚®ä»¶æœåŠ¡å™¨ä¼šä»¥æ˜æ–‡å‘é€å¯†ç ã€‚ÚPThe KDC is a single point of failure.  By design, the KDC must be as secure as its master password database.  The KDC should have absolutely no other services running on it and should be physically secure.  The danger is high because Kerberos stores all passwords encrypted with the same master key which is stored as a file on the KDC.Ú,KDC æ˜¯ä¸€ä¸ªå•ç‚¹æ•…éšœã€‚æŒ‰è®¾è®¡ï¼ŒKDC å¿…é¡»ä¸å…¶ä¸»å¯†ç æ•°æ®åº“ä¸€æ ·å®‰å…¨ã€‚KDC ä¸Šä¸åº”è¯¥è¿è¡Œä»»ä½•å…¶ä»–æœåŠ¡ï¼Œå¹¶ä¸”åº”è¯¥å…·æœ‰ç‰©ç†å®‰å…¨æ€§ã€‚å±é™©æ€§å¾ˆé«˜ï¼Œå› ä¸º Kerberos å°†æ‰€æœ‰å¯†ç éƒ½ä½¿ç”¨ç›¸åŒçš„ä¸»å¯†é’¥è¿›è¡ŒåŠ å¯†ï¼Œè¯¥å¯†é’¥å­˜å‚¨åœ¨ KDC ä¸Šçš„æ–‡ä»¶ä¸­ã€‚ÚA compromised master key is not quite as bad as one might fear.  The master key is only used to encrypt the Kerberos database and as a seed for the random number generator.  As long as access to the KDC is secure, an attacker cannot do much with the master key.Ùêä¸€ä¸ªè¢«ç ´åçš„ä¸»å¯†é’¥å¹¶ä¸åƒäººä»¬å¯èƒ½æ‹…å¿ƒçš„é‚£æ ·ç³Ÿç³•ã€‚ä¸»å¯†é’¥ä»…ç”¨äºåŠ å¯† Kerberos æ•°æ®åº“å’Œä½œä¸ºéšæœºæ•°ç”Ÿæˆå™¨çš„ç§å­ã€‚åªè¦ KDC çš„è®¿é—®æ˜¯å®‰å…¨çš„ï¼Œæ”»å‡»è€…æ— æ³•å¯¹ä¸»å¯†é’¥åšå¤ªå¤šäº‹æƒ…ã€‚ÙüIf the KDC is unavailable, network services are unusable as authentication cannot be performed.  This can be alleviated with a single master KDC and one or more slaves, and with careful implementation of secondary or fall-back authentication using PAM.Ùàå¦‚æœ KDC ä¸å¯ç”¨ï¼Œç½‘ç»œæœåŠ¡å°†æ— æ³•ä½¿ç”¨ï¼Œå› ä¸ºæ— æ³•è¿›è¡Œèº«ä»½éªŒè¯ã€‚å¯ä»¥é€šè¿‡ä¸€ä¸ªä¸» KDC å’Œä¸€ä¸ªæˆ–å¤šä¸ªä» KDC ä»¥åŠå¯¹ PAM è¿›è¡Œç»†è‡´å®æ–½çš„æ¬¡è¦æˆ–å¤‡ç”¨èº«ä»½éªŒè¯æ¥ç¼“è§£è¿™ä¸ªé—®é¢˜ã€‚ÚOKerberos allows users, hosts and services to authenticate between themselves.  It does not have a mechanism to authenticate the KDC to the users, hosts, or services.  This means that a trojaned `kinit` could record all user names and passwords.  File system integrity checking tools like package:security/tripwire[] can alleviate this.Ú@Kerberos å…è®¸ç”¨æˆ·ã€ä¸»æœºå’ŒæœåŠ¡ä¹‹é—´è¿›è¡Œèº«ä»½éªŒè¯ã€‚å®ƒæ²¡æœ‰æœºåˆ¶æ¥å¯¹ç”¨æˆ·ã€ä¸»æœºæˆ–æœåŠ¡è¿›è¡Œèº«ä»½éªŒè¯ã€‚è¿™æ„å‘³ç€ä¸€ä¸ªè¢«æœ¨é©¬ç¨‹åºæ„ŸæŸ“çš„ `kinit` å¯ä»¥è®°å½•æ‰€æœ‰çš„ç”¨æˆ·åå’Œå¯†ç ã€‚æ–‡ä»¶ç³»ç»Ÿå®Œæ•´æ€§æ£€æŸ¥å·¥å…·ï¼Œå¦‚ package:security/tripwire[] å¯ä»¥ç¼“è§£è¿™ä¸ªé—®é¢˜ã€‚Ù!Resources and Further Information¸èµ„æºå’Œè¿›ä¸€æ­¥ä¿¡æ¯ÙMhttp://www.faqs.org/faqs/Kerberos-faq/general/preamble.html[The Kerberos FAQ]ÙMhttp://www.faqs.org/faqs/Kerberos-faq/general/preamble.html[The Kerberos FAQ]Ùjhttp://web.mit.edu/Kerberos/www/dialogue.html[Designing an Authentication System: a Dialog in Four Scenes]Ù_http://web.mit.edu/Kerberos/www/dialogue.html[è®¾è®¡ä¸€ä¸ªè®¤è¯ç³»ç»Ÿï¼šå››ä¸ªåœºæ™¯çš„å¯¹è¯]Ù`https://www.ietf.org/rfc/rfc4120.txt[RFC 4120, The Kerberos Network Authentication Service (V5)]ÙZhttps://www.ietf.org/rfc/rfc4120.txt[RFC 4120ï¼ŒKerberos ç½‘ç»œèº«ä»½éªŒè¯æœåŠ¡ï¼ˆV5ï¼‰]Ù8http://web.mit.edu/Kerberos/www/[MIT Kerberos home page]Ù5http://web.mit.edu/Kerberos/www/[MIT Kerberos ä¸»é¡µ]ÙKhttps://github.com/heimdal/heimdal/wiki[Heimdal Kerberos project wiki page]ÙLhttps://github.com/heimdal/heimdal/wiki[Heimdal Kerberos é¡¹ç›®ç»´åŸºé¡µé¢]ÚTCP Wrappers is a host-based network access control system.  By intercepting incoming network requests before they reach the actual network service, TCP Wrappers assess whether the source IP address is permitted or denied access based on predefined rules in configuration files.ÙçTCP Wrappers æ˜¯ä¸€ç§åŸºäºä¸»æœºçš„ç½‘ç»œè®¿é—®æ§åˆ¶ç³»ç»Ÿã€‚é€šè¿‡åœ¨å®é™…ç½‘ç»œæœåŠ¡ä¹‹å‰æ‹¦æˆªä¼ å…¥çš„ç½‘ç»œè¯·æ±‚ï¼ŒTCP Wrappers æ ¹æ®é…ç½®æ–‡ä»¶ä¸­é¢„å®šä¹‰çš„è§„åˆ™è¯„ä¼°æº IP åœ°å€æ˜¯å¦è¢«å…è®¸æˆ–æ‹’ç»è®¿é—®ã€‚Ú5However, while TCP Wrappers provide basic access control, they should not be considered a substitute for more robust security measures.  For comprehensive protection, it's recommended to use advanced technologies like firewalls, along with proper user authentication practices and intrusion detection systems.Úç„¶è€Œï¼Œå°½ç®¡ TCP åŒ…è£…å™¨æä¾›äº†åŸºæœ¬çš„è®¿é—®æ§åˆ¶ï¼Œä½†å®ƒä»¬ä¸åº”è¢«è§†ä¸ºæ›´å¼ºå¤§çš„å®‰å…¨æªæ–½çš„æ›¿ä»£å“ã€‚ä¸ºäº†å…¨é¢ä¿æŠ¤ï¼Œå»ºè®®ä½¿ç”¨åƒé˜²ç«å¢™è¿™æ ·çš„å…ˆè¿›æŠ€æœ¯ï¼Œä»¥åŠé€‚å½“çš„ç”¨æˆ·èº«ä»½éªŒè¯å®è·µå’Œå…¥ä¾µæ£€æµ‹ç³»ç»Ÿã€‚µInitial Configuration¬åˆå§‹é…ç½®ÙˆTCP Wrappers are enabled by default in man:inetd[8].  So the first step will be to enable man:inetd[8] executing the following commands:ÙpTCP åŒ…è£…å™¨é»˜è®¤åœ¨ man:inetd[8] ä¸­å¯ç”¨ã€‚å› æ­¤ï¼Œç¬¬ä¸€æ­¥æ˜¯å¯ç”¨ man:inetd[8]ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼šÙ7Then, properly configure [.filename]#/etc/hosts.allow#.Ù=ç„¶åï¼Œæ­£ç¡®é…ç½® [.filename]#/etc/hosts.allow# æ–‡ä»¶ã€‚Ù¸Unlike other implementations of TCP Wrappers, the use of [.filename]#hosts.deny# is deprecated in FreeBSD.  All configuration options should be placed in [.filename]#/etc/hosts.allow#.Ù©ä¸å…¶ä»– TCP Wrappers çš„å®ç°ä¸åŒï¼Œåœ¨ FreeBSD ä¸­ä½¿ç”¨ [.filename]#hosts.deny# å·²è¢«å¼ƒç”¨ã€‚æ‰€æœ‰é…ç½®é€‰é¡¹åº”æ”¾ç½®åœ¨ [.filename]#/etc/hosts.allow# ä¸­ã€‚ÙüIn the simplest configuration, daemon connection policies are set to either permit or block, depending on the options in [.filename]#/etc/hosts.allow#.  The default configuration in FreeBSD is to allow all connections to the daemons started with inetd.Ù×åœ¨æœ€ç®€å•çš„é…ç½®ä¸­ï¼Œå®ˆæŠ¤è¿›ç¨‹è¿æ¥ç­–ç•¥æ ¹æ® [.filename]#/etc/hosts.allow# ä¸­çš„é€‰é¡¹è®¾ç½®ä¸ºå…è®¸æˆ–é˜»æ­¢ã€‚åœ¨ FreeBSD ä¸­ï¼Œé»˜è®¤é…ç½®æ˜¯å…è®¸æ‰€æœ‰ä¸ inetd å¯åŠ¨çš„å®ˆæŠ¤è¿›ç¨‹çš„è¿æ¥ã€‚ÚÑBasic configuration usually takes the form of `daemon : address : action`, where `daemon` is the daemon which inetd started, `address` is a valid hostname, IP address, or an IPv6 address enclosed in brackets ([ ]), and `action` is either `allow` or `deny`.  TCP Wrappers uses a first rule match semantic, meaning that the configuration file is scanned from the beginning for a matching rule.  When a match is found, the rule is applied and the search process stops.Ú°åŸºæœ¬é…ç½®é€šå¸¸é‡‡ç”¨ `daemon : address : action` çš„å½¢å¼ï¼Œå…¶ä¸­ `daemon` æ˜¯ç”± inetd å¯åŠ¨çš„å®ˆæŠ¤è¿›ç¨‹ï¼Œ `address` æ˜¯æœ‰æ•ˆçš„ä¸»æœºåã€ IP åœ°å€æˆ–ç”¨æ–¹æ‹¬å·ï¼ˆ[ ]ï¼‰æ‹¬èµ·æ¥çš„ IPv6 åœ°å€ï¼Œ`action` å¯ä»¥æ˜¯ `allow` æˆ– `deny`ã€‚TCP Wrappers ä½¿ç”¨é¦–æ¬¡åŒ¹é…è§„åˆ™çš„è¯­ä¹‰ï¼Œæ„å‘³ç€é…ç½®æ–‡ä»¶ä»å¤´å¼€å§‹æ‰«æä»¥å¯»æ‰¾åŒ¹é…çš„è§„åˆ™ã€‚å½“æ‰¾åˆ°åŒ¹é…æ—¶ï¼Œè§„åˆ™è¢«åº”ç”¨å¹¶ä¸”æœç´¢è¿‡ç¨‹åœæ­¢ã€‚Ù–For example, to allow POP3 connections via the package:mail/qpopper[] daemon, the following lines should be appended to [.filename]#/etc/hosts.allow#:Ù”ä¾‹å¦‚ï¼Œè¦å…è®¸é€šè¿‡ package:mail/qpopper[] å®ˆæŠ¤ç¨‹åºè¿›è¡Œ POP3 è¿æ¥ï¼Œåº”å°†ä»¥ä¸‹è¡Œè¿½åŠ åˆ° [.filename]#/etc/hosts.allow# æ–‡ä»¶ä¸­ï¼šÙ,Whenever this file is edited, restart inetd:Ù1æ¯å½“ç¼–è¾‘æ­¤æ–‡ä»¶æ—¶ï¼Œé‡æ–°å¯åŠ¨ inetd ï¼š¶Advanced Configuration¬é«˜çº§é…ç½®ÚTTCP Wrappers provides advanced options to allow more control over the way connections are handled.  In some cases, it may be appropriate to return a comment to certain hosts or daemon connections.  In other cases, a log entry should be recorded or an email sent to the administrator.  Other situations may require the use of a service for local connections only.  This is all possible through the use of configuration options known as wildcards, expansion characters, and external command execution.  To learn more about wildcards and their associated functionality, refer to man:hosts_access[5].ÚüTCP Wrappers æä¾›äº†é«˜çº§é€‰é¡¹ï¼Œå¯ä»¥æ›´å¥½åœ°æ§åˆ¶è¿æ¥çš„å¤„ç†æ–¹å¼ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå‘ç‰¹å®šçš„ä¸»æœºæˆ–å®ˆæŠ¤è¿›ç¨‹è¿æ¥è¿”å›æ³¨é‡Šå¯èƒ½æ˜¯åˆé€‚çš„ã€‚åœ¨å…¶ä»–æƒ…å†µä¸‹ï¼Œåº”è®°å½•æ—¥å¿—æ¡ç›®æˆ–å‘ç®¡ç†å‘˜å‘é€ç”µå­é‚®ä»¶ã€‚å…¶ä»–æƒ…å†µå¯èƒ½éœ€è¦ä»…ç”¨äºæœ¬åœ°è¿æ¥çš„æœåŠ¡ã€‚é€šè¿‡ä½¿ç”¨é€šé…ç¬¦ã€æ‰©å±•å­—ç¬¦å’Œå¤–éƒ¨å‘½ä»¤æ‰§è¡Œçš„é…ç½®é€‰é¡¹ï¼Œæ‰€æœ‰è¿™äº›éƒ½æ˜¯å¯èƒ½çš„ã€‚è¦äº†è§£æœ‰å…³é€šé…ç¬¦åŠå…¶ç›¸å…³åŠŸèƒ½çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜… man:hosts_access[5] ã€‚´Access Control Lists²è®¿é—®æ§åˆ¶åˆ—è¡¨ÚfAccess Control Lists (ACLs) extend traditional UNIX(R) file permissions by allowing fine-grained access control for users and groups on a per-file or per-directory basis.  Each ACL entry defines a user or group and the associated permissions, such as read, write, and execute.  FreeBSD provides commands like man:getfacl[1] and man:setfacl[1] to manage ACLs.Ú[è®¿é—®æ§åˆ¶åˆ—è¡¨ï¼ˆACLï¼‰é€šè¿‡å…è®¸ç”¨æˆ·å’Œç»„åœ¨æ¯ä¸ªæ–‡ä»¶æˆ–ç›®å½•çš„åŸºç¡€ä¸Šè¿›è¡Œç»†ç²’åº¦çš„è®¿é—®æ§åˆ¶ï¼Œæ‰©å±•äº†ä¼ ç»Ÿçš„ UNIX(R) æ–‡ä»¶æƒé™ã€‚æ¯ä¸ª ACL æ¡ç›®å®šä¹‰äº†ä¸€ä¸ªç”¨æˆ·æˆ–ç»„ä»¥åŠç›¸å…³çš„æƒé™ï¼Œå¦‚è¯»å–ã€å†™å…¥å’Œæ‰§è¡Œã€‚ FreeBSD æä¾›äº†åƒ man:getfacl[1] å’Œ man:setfacl[1] è¿™æ ·çš„å‘½ä»¤æ¥ç®¡ç† ACLã€‚Ú&ACLs are useful in scenarios requiring more specific access control than standard permissions, commonly used in multi-user environments or shared hosting.  However, complexity may be unavoidable, but careful planning is required to ensure that the desired security properties are being providedÚè®¿é—®æ§åˆ¶åˆ—è¡¨ï¼ˆACLï¼‰åœ¨éœ€è¦æ¯”æ ‡å‡†æƒé™æ›´å…·ä½“çš„è®¿é—®æ§åˆ¶çš„åœºæ™¯ä¸­éå¸¸æœ‰ç”¨ï¼Œé€šå¸¸åœ¨å¤šç”¨æˆ·ç¯å¢ƒæˆ–å…±äº«æ‰˜ç®¡ä¸­ä½¿ç”¨ã€‚ç„¶è€Œï¼Œå¤æ‚æ€§å¯èƒ½æ˜¯ä¸å¯é¿å…çš„ï¼Œä½†éœ€è¦ä»”ç»†è§„åˆ’ï¼Œä»¥ç¡®ä¿æä¾›æ‰€éœ€çš„å®‰å…¨æ€§è´¨ã€‚Ù½FreeBSD supports the implementation of NFSv4 ACLs in both UFS and OpenZFS.  Please note that some arguments to the man:setfacl[1] command only work with POSIX ACLs and others in NFSv4 ACLs.Ù©FreeBSD æ”¯æŒåœ¨ UFS å’Œ OpenZFS ä¸­å®ç° NFSv4 ACLsã€‚è¯·æ³¨æ„ï¼Œman:setfacl[1] å‘½ä»¤çš„ä¸€äº›å‚æ•°ä»…é€‚ç”¨äº POSIX ACLsï¼Œè€Œå…¶ä»–å‚æ•°é€‚ç”¨äº NFSv4 ACLsã€‚»Enabling ACL Support in UFS¼åœ¨ UFS ä¸­å¯ç”¨ ACL æ”¯æŒÙnACLs are enabled by the mount-time administrative flag, `acls`, which may be added to [.filename]#/etc/fstab#.ÙtACLs æ˜¯é€šè¿‡æŒ‚è½½æ—¶çš„ç®¡ç†æ ‡å¿— `acls` å¯ç”¨çš„ï¼Œå¯ä»¥å°†å…¶æ·»åŠ åˆ° [.filename]#/etc/fstab# æ–‡ä»¶ä¸­ã€‚Ù{Therefore it will be necessary to access [.filename]#/etc/fstab# and in the options section add the `acls` flag as follows:Ùfå› æ­¤ï¼Œéœ€è¦è®¿é—® [.filename]#/etc/fstab# å¹¶åœ¨é€‰é¡¹éƒ¨åˆ†æ·»åŠ  `acls` æ ‡å¿—ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š´Get ACLs information±è·å– ACL ä¿¡æ¯ÙOIt is possible to check the ACLs of a file or a directory using man:getfacl[1].ÙEå¯ä»¥ä½¿ç”¨ man:getfacl[1] å‘½ä»¤æ¥æ£€æŸ¥æ–‡ä»¶æˆ–ç›®å½•çš„ ACL ã€‚Ù`For example, to view the ACL settings on [.filename]#~/test# file execute the following command:ÙVä¾‹å¦‚ï¼Œè¦æŸ¥çœ‹ [.filename]#~/test# æ–‡ä»¶çš„ ACL è®¾ç½®ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼šÙJThe output should be similar to the following in case of using NFSv4 ACLs:Ù?å¦‚æœä½¿ç”¨ NFSv4 ACLs ï¼Œè¾“å‡ºåº”è¯¥ç±»ä¼¼äºä»¥ä¸‹å†…å®¹ï¼šÙQAnd the output should be similar to the following in case of using POSIX.1e ACLs:ÙAå¦‚æœä½¿ç”¨ POSIX.1e ACLsï¼Œè¾“å‡ºåº”è¯¥ç±»ä¼¼äºä»¥ä¸‹å†…å®¹ï¼š±Working with ACLs¸ä½¿ç”¨ ACLs è¿›è¡Œå·¥ä½œÙRman:setfacl[1] can be used to add, modify or remove ACLs from a file or directory.ÙMman:setfacl[1] å¯ä»¥ç”¨äºå‘æ–‡ä»¶æˆ–ç›®å½•æ·»åŠ ã€ä¿®æ”¹æˆ–åˆ é™¤ ACL ã€‚ÙÌAs noted above, some arguments to man:setfacl[1] do not work with NFSv4 ACLs, and vice versa.  This section covers how to execute the commands for POSIX ACLs and for NFSv4 ACLs and shows examples of both.Ù´å¦‚ä¸Šæ‰€è¿°ï¼Œman:setfacl[1] çš„ä¸€äº›å‚æ•°ä¸ NFSv4 ACLs ä¸å…¼å®¹ï¼Œåä¹‹äº¦ç„¶ã€‚æœ¬èŠ‚ä»‹ç»å¦‚ä½•æ‰§è¡Œ POSIX ACLs å’Œ NFSv4 ACLs çš„å‘½ä»¤ï¼Œå¹¶æä¾›äº†ä¸¤è€…çš„ç¤ºä¾‹ã€‚ÙGFor example, to set the mandatory elements of the POSIX.1e default ACL:Ù9ä¾‹å¦‚ï¼Œè¦è®¾ç½® POSIX.1e é»˜è®¤ ACL çš„å¼ºåˆ¶å…ƒç´ ï¼šÙ›This other example sets read, write, and execute permissions for the file owner's POSIX.1e ACL entry and read and write permissions for group mail on file:Ù›è¿™ä¸ªç¤ºä¾‹è®¾ç½®äº†æ–‡ä»¶æ‰€æœ‰è€…çš„ POSIX.1e ACL æ¡ç›®çš„è¯»å–ã€å†™å…¥å’Œæ‰§è¡Œæƒé™ï¼Œå¹¶ä¸ºæ–‡ä»¶ä¸Šçš„é‚®ä»¶ç»„è®¾ç½®äº†è¯»å–å’Œå†™å…¥æƒé™ã€‚Ù;To do the same as in the previous example but in NFSv4 ACL:ÙAä¸ºäº†åœ¨ NFSv4 ACL ä¸­æ‰§è¡Œä¸å‰ä¸€ä¸ªç¤ºä¾‹ç›¸åŒçš„æ“ä½œï¼šÙRTo remove all ACL entries except for the three required from file in POSIX.1e ACL:Ù]ä» POSIX.1e ACL æ–‡ä»¶ä¸­åˆ é™¤é™¤äº†ä¸‰ä¸ªå¿…éœ€çš„ ACL æ¡ç›®ä¹‹å¤–çš„æ‰€æœ‰ ACL æ¡ç›®ã€‚Ù'To remove all ACL entries in NFSv4 ACL:Ù.è¦åˆ é™¤ NFSv4 ACL ä¸­çš„æ‰€æœ‰ ACL æ¡ç›®ï¼šÙoRefer to man:getfacl[1] and man:setfacl[1] for more information about the options available for these commands.Ù^æœ‰å…³è¿™äº›å‘½ä»¤å¯ç”¨é€‰é¡¹çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è€ƒ man:getfacl[1] å’Œ man:setfacl[1]ã€‚ÚCapsicum is a lightweight OS capability and sandbox framework implementing a hybrid capability system model.  Capabilities are unforgeable tokens of authority that can be delegated and must be presented to perform an action.  Capsicum makes file descriptors into capabilities.ÙëCapsicum æ˜¯ä¸€ä¸ªè½»é‡çº§çš„æ“ä½œç³»ç»Ÿèƒ½åŠ›å’Œæ²™ç®±æ¡†æ¶ï¼Œå®ç°äº†æ··åˆèƒ½åŠ›ç³»ç»Ÿæ¨¡å‹ã€‚èƒ½åŠ›æ˜¯ä¸å¯ä¼ªé€ çš„æˆæƒä»¤ç‰Œï¼Œå¯ä»¥å§”æ´¾ï¼Œå¿…é¡»æäº¤æ‰èƒ½æ‰§è¡Œæ“ä½œã€‚ Capsicum å°†æ–‡ä»¶æè¿°ç¬¦è½¬æ¢ä¸ºèƒ½åŠ›ã€‚ÙôCapsicum can be used for application and library compartmentalisation, the decomposition of larger bodies of software into isolated (sandboxed) components in order to implement security policies and limit the impact of software vulnerabilities.Ù¨Capsicum å¯ä»¥ç”¨äºåº”ç”¨ç¨‹åºå’Œåº“çš„åˆ†éš”ï¼Œå°†è¾ƒå¤§çš„è½¯ä»¶ä½“åˆ†è§£ä¸ºéš”ç¦»ï¼ˆæ²™ç›’åŒ–ï¼‰çš„ç»„ä»¶ï¼Œä»¥å®æ–½å®‰å…¨ç­–ç•¥å¹¶é™åˆ¶è½¯ä»¶æ¼æ´çš„å½±å“ã€‚²Process Accounting¬è¿›ç¨‹è´¦æˆ·ÙÑProcess accounting is a security method in which an administrator may keep track of system resources used and their allocation among users, provide for system monitoring, and minimally track a user's commands.ÙÏè¿›ç¨‹è´¦æˆ·æ˜¯ä¸€ç§å®‰å…¨æ–¹æ³•ï¼Œç®¡ç†å‘˜å¯ä»¥é€šè¿‡è¯¥æ–¹æ³•è·Ÿè¸ªç³»ç»Ÿèµ„æºçš„ä½¿ç”¨æƒ…å†µä»¥åŠå®ƒä»¬åœ¨ç”¨æˆ·ä¹‹é—´çš„åˆ†é…æƒ…å†µï¼Œæä¾›ç³»ç»Ÿç›‘æ§ï¼Œå¹¶æœ€å°‘ç¨‹åº¦åœ°è·Ÿè¸ªç”¨æˆ·çš„å‘½ä»¤ã€‚ÚGProcess accounting has both positive and negative points.  One of the positives is that an intrusion may be narrowed down to the point of entry.  A negative is the amount of logs generated by process accounting, and the disk space they may require.  This section walks an administrator through the basics of process accounting.Ú#è¿›ç¨‹è´¦æˆ·æœ‰ç§¯æå’Œæ¶ˆæçš„ä¸€é¢ã€‚å…¶ä¸­ä¸€ä¸ªç§¯æçš„æ–¹é¢æ˜¯å¯ä»¥å°†å…¥ä¾µäº‹ä»¶è¿½æº¯åˆ°å…¥ä¾µç‚¹ã€‚æ¶ˆæçš„ä¸€é¢æ˜¯è¿›ç¨‹è´¦æˆ·ä¼šç”Ÿæˆå¤§é‡çš„æ—¥å¿—ï¼Œå¹¶ä¸”å¯èƒ½éœ€è¦å¤§é‡çš„ç£ç›˜ç©ºé—´æ¥å­˜å‚¨è¿™äº›æ—¥å¿—ã€‚æœ¬èŠ‚å°†å‘ç®¡ç†å‘˜ä»‹ç»è¿›ç¨‹è´¦æˆ·çš„åŸºç¡€çŸ¥è¯†ã€‚ÙbIf more fine-grained accounting is needed, refer to crossref:audit[audit,Security Event Auditing].Ù_å¦‚æœéœ€è¦æ›´ç»†ç²’åº¦çš„ä¼šè®¡è®°å½•ï¼Œè¯·å‚è€ƒ crossref:audit[audit,å®‰å…¨äº‹ä»¶å®¡è®¡]ã€‚Ù)Enabling and Utilizing Process Accounting»å¯ç”¨å’Œåˆ©ç”¨è¿›ç¨‹è´¦æˆ·ÙQBefore using process accounting, it must be enabled using the following commands:ÙBåœ¨ä½¿ç”¨è¿›ç¨‹è®°è´¦ä¹‹å‰ï¼Œå¿…é¡»ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¯ç”¨å®ƒï¼šÚThe accounting information is stored in files located in [.filename]#/var/account#, which is automatically created, if necessary, the first time the accounting service starts.  These files contain sensitive information, including all the commands issued by all users.  Write access to the files is limited to `root`, and read access is limited to `root` and members of the `wheel` group.  To also prevent members of `wheel` from reading the files, change the mode of the [.filename]#/var/account# directory to allow access only by `root`.ÚËè®°å¸ä¿¡æ¯å­˜å‚¨åœ¨ä½äº [.filename]#/var/account# çš„æ–‡ä»¶ä¸­ï¼Œå¦‚æœéœ€è¦ï¼Œè®°å¸æœåŠ¡é¦–æ¬¡å¯åŠ¨æ—¶ä¼šè‡ªåŠ¨åˆ›å»ºè¯¥æ–‡ä»¶ã€‚è¿™äº›æ–‡ä»¶åŒ…å«æ•æ„Ÿä¿¡æ¯ï¼ŒåŒ…æ‹¬æ‰€æœ‰ç”¨æˆ·å‘å‡ºçš„æ‰€æœ‰å‘½ä»¤ã€‚å¯¹æ–‡ä»¶çš„å†™è®¿é—®æƒé™ä»…é™äº `root` ï¼Œè¯»è®¿é—®æƒé™ä»…é™äº `root` å’Œ `wheel` ç»„çš„æˆå‘˜ã€‚ä¸ºäº†é˜²æ­¢ `wheel` ç»„çš„æˆå‘˜ä¹Ÿèƒ½è¯»å–è¿™äº›æ–‡ä»¶ï¼Œå°† [.filename]#/var/account# ç›®å½•çš„æ¨¡å¼æ›´æ”¹ä¸ºä»…å…è®¸ `root` è®¿é—®ã€‚ÚëOnce enabled, accounting will begin to track information such as CPU statistics and executed commands.  All accounting logs are in a non-human readable format which can be viewed using man:sa[8].  If issued without any options, man:sa[8] prints information relating to the number of per-user calls, the total elapsed time in minutes, total CPU and user time in minutes, and the average number of I/O operations.  Refer to man:sa[8] for the list of available options which control the output.ÚÚå¯ç”¨åï¼Œä¼šè®¡å°†å¼€å§‹è·Ÿè¸ªè¯¸å¦‚ CPU ç»Ÿè®¡å’Œæ‰§è¡Œçš„å‘½ä»¤ç­‰ä¿¡æ¯ã€‚æ‰€æœ‰çš„è®°è´¦æ—¥å¿—éƒ½ä»¥éäººç±»å¯è¯»çš„æ ¼å¼å­˜å‚¨ï¼Œå¯ä»¥ä½¿ç”¨ man:sa[8] å‘½ä»¤æŸ¥çœ‹ã€‚å¦‚æœä¸å¸¦ä»»ä½•é€‰é¡¹ä½¿ç”¨ man:sa[8] å‘½ä»¤ï¼Œå°†æ‰“å°ä¸æ¯ä¸ªç”¨æˆ·è°ƒç”¨æ¬¡æ•°ã€æ€»ç»è¿‡æ—¶é—´ï¼ˆä»¥åˆ†é’Ÿä¸ºå•ä½ï¼‰ã€æ€» CPU å’Œç”¨æˆ·æ—¶é—´ï¼ˆä»¥åˆ†é’Ÿä¸ºå•ä½ï¼‰ä»¥åŠå¹³å‡ I/O æ“ä½œæ¬¡æ•°ç›¸å…³çš„ä¿¡æ¯ã€‚æœ‰å…³æ§åˆ¶è¾“å‡ºçš„å¯ç”¨é€‰é¡¹åˆ—è¡¨ï¼Œè¯·å‚è€ƒ man:sa[8] å‘½ä»¤ã€‚Ù8To display the commands issued by users, use `lastcomm`.Ù?è¦æ˜¾ç¤ºç”¨æˆ·å‘å‡ºçš„å‘½ä»¤ï¼Œè¯·ä½¿ç”¨ `lastcomm` å‘½ä»¤ã€‚Ù\For example, this command prints out all usage of `ls` by `trhodes` on the `ttyp1` terminal:Ùeä¾‹å¦‚ï¼Œè¿™ä¸ªå‘½ä»¤ä¼šæ‰“å°å‡ºåœ¨ `ttyp1` ç»ˆç«¯ä¸Šç”± `trhodes` ä½¿ç”¨çš„ `ls` çš„æ‰€æœ‰ç”¨æ³•ï¼šÙaMany other useful options exist and are explained in man:lastcomm[1], man:acct[5], and man:sa[8].Ùlè¿˜æœ‰è®¸å¤šå…¶ä»–æœ‰ç”¨çš„é€‰é¡¹ï¼Œå¯ä»¥åœ¨ man:lastcomm[1]ã€man:acct[5] å’Œ man:sa[8] ä¸­æ‰¾åˆ°è§£é‡Šã€‚¯Resource Limits¬èµ„æºé™åˆ¶Ú­In FreeBSD, resource limits refer to the mechanisms that control and manage the allocation of various system resources to processes and users.  These limits are designed to prevent a single process or user from consuming an excessive amount of resources, which could lead to performance degradation or system instability.  Resource limits help ensure fair resource distribution among all active processes and users on the system.Ú>åœ¨ FreeBSD ä¸­ï¼Œèµ„æºé™åˆ¶æ˜¯æŒ‡æ§åˆ¶å’Œç®¡ç†å°†å„ç§ç³»ç»Ÿèµ„æºåˆ†é…ç»™è¿›ç¨‹å’Œç”¨æˆ·çš„æœºåˆ¶ã€‚è¿™äº›é™åˆ¶æ—¨åœ¨é˜²æ­¢å•ä¸ªè¿›ç¨‹æˆ–ç”¨æˆ·æ¶ˆè€—è¿‡å¤šçš„èµ„æºï¼Œä»è€Œå¯èƒ½å¯¼è‡´æ€§èƒ½ä¸‹é™æˆ–ç³»ç»Ÿä¸ç¨³å®šã€‚èµ„æºé™åˆ¶æœ‰åŠ©äºç¡®ä¿ç³»ç»Ÿä¸Šæ‰€æœ‰æ´»åŠ¨è¿›ç¨‹å’Œç”¨æˆ·ä¹‹é—´å…¬å¹³åˆ†é…èµ„æºã€‚ÙtFreeBSD provides several methods for an administrator to limit the amount of system resources an individual may use.ÙVFreeBSD æä¾›äº†å‡ ç§æ–¹æ³•ï¼Œä¾›ç®¡ç†å‘˜é™åˆ¶ä¸ªäººä½¿ç”¨ç³»ç»Ÿèµ„æºçš„æ•°é‡ã€‚Ú’The traditional method defines login classes by editing [.filename]#/etc/login.conf#.  While this method is still supported, any changes require a multi-step process of editing this file, rebuilding the resource database, making necessary changes to [.filename]#/etc/master.passwd#, and rebuilding the password database.  This can become time consuming, depending upon the number of users to configure.Úhä¼ ç»Ÿçš„æ–¹æ³•æ˜¯é€šè¿‡ç¼–è¾‘ [.filename]#/etc/login.conf# æ¥å®šä¹‰ç™»å½•ç±»ã€‚è™½ç„¶è¿™ç§æ–¹æ³•ä»ç„¶å—æ”¯æŒï¼Œä½†ä»»ä½•æ›´æ”¹éƒ½éœ€è¦å¤šä¸ªæ­¥éª¤ï¼šç¼–è¾‘è¯¥æ–‡ä»¶ã€é‡å»ºèµ„æºæ•°æ®åº“ã€å¯¹ [.filename]#/etc/master.passwd# è¿›è¡Œå¿…è¦çš„æ›´æ”¹ï¼Œå¹¶é‡æ–°æ„å»ºå¯†ç æ•°æ®åº“ã€‚è¿™å¯èƒ½ä¼šè€—è´¹æ—¶é—´ï¼Œå…·ä½“å–å†³äºè¦é…ç½®çš„ç”¨æˆ·æ•°é‡ã€‚ÙÖman:rctl[8] can be used to provide a more fine-grained method for controlling resource limits.  This command supports more than user limits as it can also be used to set resource constraints on processes and jails.Ù¬man:rctl[8] å¯ä»¥ç”¨äºæä¾›ä¸€ç§æ›´ç²¾ç»†çš„æ–¹æ³•æ¥æ§åˆ¶èµ„æºé™åˆ¶ã€‚è¯¥å‘½ä»¤ä¸ä»…æ”¯æŒç”¨æˆ·é™åˆ¶ï¼Œè¿˜å¯ä»¥ç”¨äºåœ¨è¿›ç¨‹å’Œ jails ä¸Šè®¾ç½®èµ„æºçº¦æŸã€‚ÙhThis section demonstrates both methods for controlling resources, beginning with the traditional method.ÙEæœ¬èŠ‚å±•ç¤ºäº†æ§åˆ¶èµ„æºçš„ä¸¤ç§æ–¹æ³•ï¼Œé¦–å…ˆæ˜¯ä¼ ç»Ÿæ–¹æ³•ã€‚²Types of Resources¯èµ„æºçš„ç±»å‹ÙBFreeBSD provides limits for various types of resources, including:Ù8FreeBSD æä¾›äº†å„ç§ç±»å‹èµ„æºçš„é™åˆ¶ï¼ŒåŒ…æ‹¬ï¼š®Resource types¬èµ„æºç±»å‹¨CPU TimeªCPU æ—¶é—´Ù3Limits the amount of CPU time a process can consumeÙ)é™åˆ¶è¿›ç¨‹å¯ä»¥æ¶ˆè€—çš„ CPU æ—¶é—´é‡Ù8Controls the amount of physical memory a process can useÙ'æ§åˆ¶è¿›ç¨‹å¯ä½¿ç”¨çš„ç‰©ç†å†…å­˜é‡ªOpen Files¬æ‰“å¼€æ–‡ä»¶ÙALimits the number of files a process can have open simultaneouslyÙ*é™åˆ¶è¿›ç¨‹åŒæ—¶æ‰“å¼€çš„æ–‡ä»¶æ•°é‡ã€‚©Processes¦è¿›ç¨‹Ù?Controls the number of processes a user or a process can createÙ3æ§åˆ¶ç”¨æˆ·æˆ–è¿›ç¨‹å¯ä»¥åˆ›å»ºçš„è¿›ç¨‹æ•°é‡ã€‚©File Size¬æ–‡ä»¶å¤§å°Ù:Limits the maximum size of files that a process can createÙ3é™åˆ¶è¿›ç¨‹å¯ä»¥åˆ›å»ºçš„æ–‡ä»¶çš„æœ€å¤§å¤§å°ã€‚ªCore Dumps¬æ ¸å¿ƒè½¬å‚¨ÙBControls whether processes are allowed to generate core dump filesÙ3æ§åˆ¶è¿›ç¨‹æ˜¯å¦å…è®¸ç”Ÿæˆæ ¸å¿ƒè½¬å‚¨æ–‡ä»¶ã€‚±Network Resources¬ç½‘ç»œèµ„æºÙHLimits the amount of network resources (e.g., sockets) a process can useÙHé™åˆ¶è¿›ç¨‹å¯ä»¥ä½¿ç”¨çš„ç½‘ç»œèµ„æºï¼ˆä¾‹å¦‚ï¼Œå¥—æ¥å­—ï¼‰çš„æ•°é‡ÙBFor a full listing of types see man:login.conf[5] and man:rctl[8].ÙLæœ‰å…³ç±»å‹çš„å®Œæ•´åˆ—è¡¨ï¼Œè¯·å‚é˜… man:login.conf[5] å’Œ man:rctl[8]ã€‚¹Configuring Login Classes¯é…ç½®ç™»å½•ç±»ÚáIn the traditional method, login classes and the resource limits to apply to a login class are defined in [.filename]#/etc/login.conf#.  Each user account can be assigned to a login class, where `default` is the default login class.  Each login class has a set of login capabilities associated with it.  A login capability is a `_name_=_value_` pair, where _name_ is a well-known identifier and _value_ is an arbitrary string which is processed accordingly depending on the _name_.Ú¾åœ¨ä¼ ç»Ÿçš„æ–¹æ³•ä¸­ï¼Œç™»å½•ç±»å’Œé€‚ç”¨äºç™»å½•ç±»çš„èµ„æºé™åˆ¶åœ¨ [.filename]#/etc/login.conf# æ–‡ä»¶ä¸­å®šä¹‰ã€‚æ¯ä¸ªç”¨æˆ·è´¦æˆ·å¯ä»¥åˆ†é…ç»™ä¸€ä¸ªç™»å½•ç±»ï¼Œå…¶ä¸­ `default` æ˜¯é»˜è®¤çš„ç™»å½•ç±»ã€‚æ¯ä¸ªç™»å½•ç±»éƒ½æœ‰ä¸€ç»„ä¸ä¹‹å…³è”çš„ç™»å½•èƒ½åŠ›ã€‚ç™»å½•èƒ½åŠ›æ˜¯ä¸€ä¸ª `_name_=_value_` å¯¹ï¼Œå…¶ä¸­ _name_ æ˜¯ä¸€ä¸ªä¼—æ‰€å‘¨çŸ¥çš„æ ‡è¯†ç¬¦ï¼Œ_value_ æ˜¯ä¸€ä¸ªä»»æ„å­—ç¬¦ä¸²ï¼Œæ ¹æ® _name_ çš„ä¸åŒè¿›è¡Œç›¸åº”çš„å¤„ç†ã€‚Ù}The first step to configure a resource limit will be to open [.filename]#/etc/login.conf# by executing the following command:Ùfé…ç½®èµ„æºé™åˆ¶çš„ç¬¬ä¸€æ­¥æ˜¯é€šè¿‡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ‰“å¼€ [.filename]#/etc/login.conf# æ–‡ä»¶ï¼šÙThen locate the section for the user class to be modified.  In this example, let's assume the user class is named `limited`, create it in case it not exists.Ù‹ç„¶åæ‰¾åˆ°è¦ä¿®æ”¹çš„ç”¨æˆ·ç±»çš„éƒ¨åˆ†ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå‡è®¾ç”¨æˆ·ç±»çš„åç§°æ˜¯ `limited`ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºå®ƒã€‚ÙÓ<.> Name of the user class.  <.> Sets the maximum number of processes (maxproc) to 50 for users in the `limited` class.  <.> Indicates that this user class inherits the default settings from the "default" class.Ù«<.> ç”¨æˆ·ç±»çš„åç§°ã€‚ <.> å°† `limited` ç±»ä¸­çš„ç”¨æˆ·çš„æœ€å¤§è¿›ç¨‹æ•°ï¼ˆmaxprocï¼‰è®¾ç½®ä¸º 50ã€‚ <.> è¡¨ç¤ºè¯¥ç”¨æˆ·ç±»ç»§æ‰¿äº†â€œdefaultâ€ç±»çš„é»˜è®¤è®¾ç½®ã€‚ÙAfter modifying the [.filename]#/etc/login.conf# file, run man:cap_mkdb[1] to generate the database that FreeBSD uses to apply these settings:ÙŒåœ¨ä¿®æ”¹ [.filename]#/etc/login.conf# æ–‡ä»¶åï¼Œè¿è¡Œ man:cap_mkdb[1] å‘½ä»¤ç”Ÿæˆ FreeBSD ä½¿ç”¨çš„æ•°æ®åº“ï¼Œä»¥åº”ç”¨è¿™äº›è®¾ç½®ï¼šÙbman:chpass[1] can be used to change the class to the desired user executint the following command:ÙGman:chpass[1] å¯ä»¥ç”¨äºæ›´æ”¹ç”¨æˆ·çš„ç±»åˆ«ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼šÙKThis will open a text editor, add the new `limited` class there as follows:ÙYè¿™å°†æ‰“å¼€ä¸€ä¸ªæ–‡æœ¬ç¼–è¾‘å™¨ï¼Œåœ¨å…¶ä¸­æ·»åŠ æ–°çš„ `limited` ç±»ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼šÙÇNow, the user assigned to the `limited` class will have a maximum process limit of 50.  Remember that this is just one example of setting a resource limit using the [.filename]#/etc/login.conf# file.Ù°ç°åœ¨ï¼Œåˆ†é…ç»™ `limited` ç±»çš„ç”¨æˆ·å°†å…·æœ‰æœ€å¤§è¿›ç¨‹é™åˆ¶ä¸º 50ã€‚è¯·è®°ä½ï¼Œè¿™åªæ˜¯ä½¿ç”¨ [.filename]#/etc/login.conf# æ–‡ä»¶è®¾ç½®èµ„æºé™åˆ¶çš„ä¸€ä¸ªç¤ºä¾‹ã€‚ÚKeep in mind that after making changes to the [.filename]#/etc/login.conf# file, the user needs to log out and log back in for the changes to take effect.  Additionally, always exercise caution when editing system configuration files, especially when using privileged access.Ùäè¯·è®°ä½ï¼Œåœ¨å¯¹ [.filename]#/etc/login.conf# æ–‡ä»¶è¿›è¡Œæ›´æ”¹åï¼Œç”¨æˆ·éœ€è¦æ³¨é”€å¹¶é‡æ–°ç™»å½•ä»¥ä½¿æ›´æ”¹ç”Ÿæ•ˆã€‚æ­¤å¤–ï¼Œåœ¨ç¼–è¾‘ç³»ç»Ÿé…ç½®æ–‡ä»¶æ—¶ï¼Œç‰¹åˆ«æ˜¯åœ¨ä½¿ç”¨ç‰¹æƒè®¿é—®æ—¶ï¼Œå§‹ç»ˆè¦è°¨æ…è¡Œäº‹ã€‚Ù(Enabling and Configuring Resource Limits»å¯ç”¨å’Œé…ç½®èµ„æºé™åˆ¶ÙòThe man:rctl[8] system provides a more fine-grained way to set and manage resource limits for individual processes and users.  It allows you to dynamically assign resource limits to specific processes or users, regardless of their user class.ÙÕman:rctl[8] ç³»ç»Ÿæä¾›äº†ä¸€ç§æ›´ç²¾ç»†çš„æ–¹å¼æ¥è®¾ç½®å’Œç®¡ç†å•ä¸ªè¿›ç¨‹å’Œç”¨æˆ·çš„èµ„æºé™åˆ¶ã€‚å®ƒå…è®¸æ‚¨åŠ¨æ€åœ°ä¸ºç‰¹å®šçš„è¿›ç¨‹æˆ–ç”¨æˆ·åˆ†é…èµ„æºé™åˆ¶ï¼Œè€Œä¸è€ƒè™‘ä»–ä»¬çš„ç”¨æˆ·ç±»åˆ«ã€‚Ù‰The first step to use man:rctl[8] will be to enable it adding the following line to [.filename]#/boot/loader.conf# and reboot the system:Ù~ä½¿ç”¨ man:rctl[8] çš„ç¬¬ä¸€æ­¥æ˜¯å°†ä»¥ä¸‹è¡Œæ·»åŠ åˆ° [.filename]#/boot/loader.conf# å¹¶é‡æ–°å¯åŠ¨ç³»ç»Ÿï¼Œä»¥å¯ç”¨å®ƒï¼šÙVThen active the man:rctl[8] service and enable it executing by the following commands:ÙFç„¶åæ¿€æ´» man:rctl[8] æœåŠ¡å¹¶é€šè¿‡ä»¥ä¸‹å‘½ä»¤å¯ç”¨å®ƒæ‰§è¡Œï¼šÙ9Then man:rctl[8] may be used to set rules for the system.Ù:ç„¶åå¯ä»¥ä½¿ç”¨ man:rctl[8] æ¥ä¸ºç³»ç»Ÿè®¾ç½®è§„åˆ™ã€‚ÙŠRule syntax (man:rctl.conf[5]) is controlled through the use of a subject, subject-id, resource, and action, as seen in this example rule:Ù†è§„åˆ™è¯­æ³•ï¼ˆman:rctl.conf[5]ï¼‰é€šè¿‡ä½¿ç”¨ä¸»é¢˜ã€ä¸»é¢˜ ID ã€èµ„æºå’Œæ“ä½œæ¥è¿›è¡Œæ§åˆ¶ï¼Œå¦‚ä¸‹é¢çš„ç¤ºä¾‹è§„åˆ™æ‰€ç¤ºï¼šÙcFor example to constrained the user to add no more than 10 processes execute the following command:ÙXä¾‹å¦‚ï¼Œè¦é™åˆ¶ç”¨æˆ·æ·»åŠ çš„è¿›ç¨‹æ•°é‡ä¸è¶…è¿‡ 10 ä¸ªï¼Œè¯·æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼šÙMTo check the applied resource limits the man:rctl[8] command can be executed:ÙCè¦æ£€æŸ¥åº”ç”¨çš„èµ„æºé™åˆ¶ï¼Œå¯ä»¥æ‰§è¡Œ man:rctl[8] å‘½ä»¤ã€‚ÙÁRules will persist across reboots if they have been added to [.filename]#/etc/rctl.conf#.  The format is a rule, without the preceding command. For example, the previous rule could be added as:ÙÂå¦‚æœå°†è§„åˆ™æ·»åŠ åˆ° [.filename]#/etc/rctl.conf# æ–‡ä»¶ä¸­ï¼Œè§„åˆ™å°†åœ¨é‡æ–°å¯åŠ¨åä¿æŒä¸å˜ã€‚æ ¼å¼æ˜¯ä¸€ä¸ªè§„åˆ™ï¼Œæ²¡æœ‰å‰å¯¼å‘½ä»¤ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥å°†ä¸Šè¿°è§„åˆ™æ·»åŠ ä¸ºï¼šÙ&Monitoring Third Party Security Issues»ç›‘æ§ç¬¬ä¸‰æ–¹å®‰å…¨é—®é¢˜ÙşIn recent years, the security world has made many improvements to how vulnerability assessment is handled.  The threat of system intrusion increases as third party utilities are installed and configured for virtually any operating system available today.ÙÀè¿‘å¹´æ¥ï¼Œå®‰å…¨é¢†åŸŸåœ¨æ¼æ´è¯„ä¼°çš„å¤„ç†æ–¹é¢å–å¾—äº†è®¸å¤šæ”¹è¿›ã€‚éšç€ç¬¬ä¸‰æ–¹å·¥å…·åœ¨å‡ ä¹æ‰€æœ‰ç°æœ‰æ“ä½œç³»ç»Ÿä¸Šçš„å®‰è£…å’Œé…ç½®ï¼Œç³»ç»Ÿå…¥ä¾µçš„å¨èƒä¹Ÿåœ¨å¢åŠ ã€‚ÚVulnerability assessment is a key factor in security.  While FreeBSD releases advisories for the base system, doing so for every third party utility is beyond the FreeBSD Project's capability.  There is a way to mitigate third party vulnerabilities and warn administrators of known security issues.  A FreeBSD add on utility known as pkg includes options explicitly for this purpose.Údæ¼æ´è¯„ä¼°æ˜¯å®‰å…¨æ€§çš„å…³é”®å› ç´ ã€‚è™½ç„¶ FreeBSD ä¸ºåŸºæœ¬ç³»ç»Ÿå‘å¸ƒäº†å®‰å…¨å…¬å‘Šï¼Œä½†å¯¹äºæ¯ä¸ªç¬¬ä¸‰æ–¹å®ç”¨ç¨‹åºéƒ½è¿™æ ·åšè¶…å‡ºäº† FreeBSD é¡¹ç›®çš„èƒ½åŠ›èŒƒå›´ã€‚æœ‰ä¸€ç§æ–¹æ³•å¯ä»¥å‡è½»ç¬¬ä¸‰æ–¹æ¼æ´å¹¶è­¦å‘Šç®¡ç†å‘˜å·²çŸ¥çš„å®‰å…¨é—®é¢˜ã€‚ä¸€ä¸ªåä¸º pkg çš„ FreeBSD é™„åŠ å®ç”¨ç¨‹åºä¸“é—¨åŒ…å«äº†è¿™ä¸ªç›®çš„çš„é€‰é¡¹ã€‚Ù„pkg polls a database for security issues.  The database is updated and maintained by the FreeBSD Security Team and ports developers.Ùvpkg è½®è¯¢æ•°æ®åº“ä»¥æŸ¥æ‰¾å®‰å…¨é—®é¢˜ã€‚è¯¥æ•°æ®åº“ç”± FreeBSD å®‰å…¨å›¢é˜Ÿå’Œç«¯å£å¼€å‘äººå‘˜æ›´æ–°å’Œç»´æŠ¤ã€‚Ù›Installation provides man:periodic[8] configuration files for maintaining the pkg audit database, and provides a programmatic method of keeping it updated.Ù‹å®‰è£…æä¾›äº†ç”¨äºç»´æŠ¤ pkg audit æ•°æ®åº“çš„ man:periodic[8] é…ç½®æ–‡ä»¶ï¼Œå¹¶æä¾›äº†ä¸€ç§ç¨‹åºåŒ–çš„æ–¹æ³•æ¥ä¿æŒå…¶æ›´æ–°ã€‚ÙØAfter installation, and to audit third party utilities as part of the Ports Collection at any time, an administrator may choose to update the database and view known vulnerabilities of installed packages by invoking:Ù«å®‰è£…å®Œæˆåï¼Œç®¡ç†å‘˜å¯ä»¥é€‰æ‹©æ›´æ–°æ•°æ®åº“å¹¶æŸ¥çœ‹å·²å®‰è£…è½¯ä»¶åŒ…çš„å·²çŸ¥æ¼æ´ï¼Œä»¥ä¾¿éšæ—¶å®¡æ ¸ç¬¬ä¸‰æ–¹å·¥å…·ä½œä¸º Ports Collection çš„ä¸€éƒ¨åˆ†ã€‚ÙuBy pointing a web browser to the displayed URL, an administrator may obtain more information about the vulnerability.Ù`é€šè¿‡å°† Web æµè§ˆå™¨æŒ‡å‘æ˜¾ç¤ºçš„ URLï¼Œç®¡ç†å‘˜å¯ä»¥è·å–æœ‰å…³æ¼æ´çš„æ›´å¤šä¿¡æ¯ã€‚ÙƒThis will include the versions affected, by FreeBSD port version, along with other web sites which may contain security advisories.Ùtè¿™å°†åŒ…æ‹¬å—å½±å“çš„ç‰ˆæœ¬ï¼ŒæŒ‰ç…§ FreeBSD port ç‰ˆæœ¬åˆ—å‡ºï¼Œä»¥åŠå¯èƒ½åŒ…å«å®‰å…¨å…¬å‘Šçš„å…¶ä»–ç½‘ç«™ã€‚»FreeBSD Security Advisories´FreeBSD å®‰å…¨å…¬å‘ŠÚ®Like many producers of quality operating systems, the FreeBSD Project has a security team which is responsible for determining the End-of-Life (EoL) date for each FreeBSD release and to provide security updates for supported releases which have not yet reached their EoL.  More information about the FreeBSD security team and the supported releases is available on the link:https://www.FreeBSD.org/security[FreeBSD security page].Úlåƒè®¸å¤šä¼˜è´¨æ“ä½œç³»ç»Ÿçš„ç”Ÿäº§è€…ä¸€æ ·ï¼ŒFreeBSD é¡¹ç›®æœ‰ä¸€ä¸ªå®‰å…¨å›¢é˜Ÿï¼Œè´Ÿè´£ç¡®å®šæ¯ä¸ª FreeBSD å‘å¸ƒç‰ˆæœ¬çš„ç”Ÿå‘½å‘¨æœŸç»“æŸï¼ˆEoLï¼‰æ—¥æœŸï¼Œå¹¶ä¸ºå°šæœªè¾¾åˆ°å…¶ EoL çš„å—æ”¯æŒç‰ˆæœ¬æä¾›å®‰å…¨æ›´æ–°ã€‚æœ‰å…³ FreeBSD å®‰å…¨å›¢é˜Ÿå’Œå—æ”¯æŒç‰ˆæœ¬çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·è®¿é—® link:https://www.FreeBSD.org/security[FreeBSD å®‰å…¨é¡µé¢]ã€‚ÚOne task of the security team is to respond to reported security vulnerabilities in the FreeBSD operating system.  Once a vulnerability is confirmed, the security team verifies the steps necessary to fix the vulnerability and updates the source code with the fix.  It then publishes the details as a "Security Advisory".  Security advisories are published on the link:https://www.FreeBSD.org/security/advisories/[FreeBSD website] and mailed to the {freebsd-security-notifications}, {freebsd-security}, and {freebsd-announce}.Ú¶å®‰å…¨å›¢é˜Ÿçš„ä¸€ä¸ªä»»åŠ¡æ˜¯å“åº” FreeBSD æ“ä½œç³»ç»Ÿä¸­æŠ¥å‘Šçš„å®‰å…¨æ¼æ´ã€‚ä¸€æ—¦ç¡®è®¤äº†æ¼æ´ï¼Œå®‰å…¨å›¢é˜Ÿä¼šéªŒè¯ä¿®å¤æ¼æ´æ‰€éœ€çš„æ­¥éª¤ï¼Œå¹¶æ›´æ–°æºä»£ç è¿›è¡Œä¿®å¤ã€‚ç„¶åï¼Œå®ƒå°†è¯¦ç»†ä¿¡æ¯å‘å¸ƒä¸ºâ€œå®‰å…¨å…¬å‘Šâ€ã€‚å®‰å…¨å…¬å‘Šä¼šå‘å¸ƒåœ¨ link:https://www.FreeBSD.org/security/advisories/[FreeBSD ç½‘ç«™] ä¸Šï¼Œå¹¶å‘é€ç»™ {freebsd-security-notifications}ã€{freebsd-security} å’Œ {freebsd-announce}ã€‚½Format of a Security Advisoryµå®‰å…¨å…¬å‘Šçš„æ ¼å¼Ù2Here is an example of a FreeBSD security advisory:Ù-è¿™æ˜¯ä¸€ä¸ª FreeBSD å®‰å…¨å…¬å‘Šçš„ç¤ºä¾‹ï¼šÙ2Every security advisory uses the following format:Ù*æ¯ä¸ªå®‰å…¨å…¬å‘Šéƒ½ä½¿ç”¨ä»¥ä¸‹æ ¼å¼ï¼šÙ«Each security advisory is signed by the PGP key of the Security Officer. The public key for the Security Officer can be verified at crossref:pgpkeys[pgpkeys,OpenPGP Keys].Ùæ¯ä¸ªå®‰å…¨å…¬å‘Šéƒ½ç”±å®‰å…¨å®˜å‘˜çš„ PGP å¯†é’¥ç­¾åã€‚å¯ä»¥åœ¨ crossref:pgpkeys[pgpkeys,OpenPGP Keys] ä¸ŠéªŒè¯å®‰å…¨å®˜å‘˜çš„å…¬é’¥ã€‚ÚThe name of the security advisory always begins with `FreeBSD-SA-` (for FreeBSD Security Advisory), followed by the year in two digit format (`23:`), followed by the advisory number for that year (`07.`), followed by the name of the affected application or subsystem (`bhyve`).Ùêå®‰å…¨å…¬å‘Šçš„åç§°å§‹ç»ˆä»¥ `FreeBSD-SA-`ï¼ˆFreeBSD å®‰å…¨å…¬å‘Šï¼‰å¼€å¤´ï¼Œåè·Ÿä¸¤ä½æ•°æ ¼å¼çš„å¹´ä»½ï¼ˆ`23:`ï¼‰ï¼Œåè·Ÿè¯¥å¹´ä»½çš„å…¬å‘Šç¼–å·ï¼ˆ`07.`ï¼‰ï¼Œåè·Ÿå—å½±å“çš„åº”ç”¨ç¨‹åºæˆ–å­ç³»ç»Ÿçš„åç§°ï¼ˆ`bhyve`ï¼‰ã€‚Ù/The `Topic` field summarizes the vulnerability.Ù)`Topic` å­—æ®µæ€»ç»“äº†æ¼æ´çš„å†…å®¹ã€‚Ú¯The `Category` refers to the affected part of the system which may be one of `core`, `contrib`, or `ports`. The `core` category means that the vulnerability affects a core component of the FreeBSD operating system. The `contrib` category means that the vulnerability affects software included with FreeBSD, such as BIND. The `ports` category indicates that the vulnerability affects software available through the Ports Collection.Ú?`Category` æŒ‡çš„æ˜¯ç³»ç»Ÿä¸­å—å½±å“çš„éƒ¨åˆ†ï¼Œå¯ä»¥æ˜¯ `core`ã€`contrib` æˆ– `ports` ä¹‹ä¸€ã€‚`core` ç±»åˆ«è¡¨ç¤ºæ¼æ´å½±å“ FreeBSD æ“ä½œç³»ç»Ÿçš„æ ¸å¿ƒç»„ä»¶ã€‚`contrib` ç±»åˆ«è¡¨ç¤ºæ¼æ´å½±å“ FreeBSD ä¸­åŒ…å«çš„è½¯ä»¶ï¼Œå¦‚ BINDã€‚`ports` ç±»åˆ«è¡¨ç¤ºæ¼æ´å½±å“é€šè¿‡ Ports Collection æä¾›çš„è½¯ä»¶ã€‚Ù¿The `Module` field refers to the component location. In this example, the `bhyve` module is affected; therefore, this vulnerability affects an application installed with the operating system.Ù¡`Module` å­—æ®µæŒ‡çš„æ˜¯ç»„ä»¶çš„ä½ç½®ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ`bhyve` æ¨¡å—å—åˆ°å½±å“ï¼›å› æ­¤ï¼Œè¿™ä¸ªæ¼æ´ä¼šå½±å“å®‰è£…æœ‰æ“ä½œç³»ç»Ÿçš„åº”ç”¨ç¨‹åºã€‚ÙŞThe `Announced` field reflects the date the security advisory was published. This means that the security team has verified that the problem exists and that a patch has been committed to the FreeBSD source code repository.Ù´`Announced` å­—æ®µåæ˜ äº†å®‰å…¨å…¬å‘Šå‘å¸ƒçš„æ—¥æœŸã€‚è¿™æ„å‘³ç€å®‰å…¨å›¢é˜Ÿå·²ç»éªŒè¯äº†é—®é¢˜çš„å­˜åœ¨ï¼Œå¹¶ä¸”å·²ç»æäº¤äº†ä¸€ä¸ªè¡¥ä¸åˆ° FreeBSD æºä»£ç ä»“åº“ä¸­ã€‚ÙqThe `Credits` field gives credit to the individual or organization who noticed the vulnerability and reported it.ÙO`Credits` å­—æ®µç”¨äºç»™å‘ç°å¹¶æŠ¥å‘Šæ¼æ´çš„ä¸ªäººæˆ–ç»„ç»‡æä¾›é¸£è°¢ã€‚ÙZThe `Affects` field explains which releases of FreeBSD are affected by this vulnerability.ÙL`Affects` å­—æ®µè¯´æ˜äº†å“ªäº›ç‰ˆæœ¬çš„ FreeBSD å—åˆ°æ­¤æ¼æ´çš„å½±å“ã€‚ÚThe `Corrected` field indicates the date, time, time offset, and releases that were corrected. The section in parentheses shows each branch for which the fix has been merged, and the version number of the corresponding release from that branch. The release identifier itself includes the version number and, if appropriate, the patch level. The patch level is the letter `p` followed by a number, indicating the sequence number of the patch, allowing users to track which patches have already been applied to the system.Ú‚`Corrected` å­—æ®µè¡¨ç¤ºä¿®æ­£çš„æ—¥æœŸã€æ—¶é—´ã€æ—¶é—´åç§»å’Œä¿®æ­£çš„å‘å¸ƒç‰ˆæœ¬ã€‚æ‹¬å·ä¸­çš„éƒ¨åˆ†æ˜¾ç¤ºäº†å·²åˆå¹¶ä¿®å¤çš„æ¯ä¸ªåˆ†æ”¯ï¼Œä»¥åŠè¯¥åˆ†æ”¯å¯¹åº”å‘å¸ƒçš„ç‰ˆæœ¬å·ã€‚å‘å¸ƒæ ‡è¯†ç¬¦æœ¬èº«åŒ…æ‹¬ç‰ˆæœ¬å·å’Œï¼ˆå¦‚æœé€‚ç”¨ï¼‰è¡¥ä¸çº§åˆ«ã€‚è¡¥ä¸çº§åˆ«æ˜¯å­—æ¯ `p` åè·Ÿä¸€ä¸ªæ•°å­—ï¼Œè¡¨ç¤ºè¡¥ä¸çš„åºåˆ—å·ï¼Œå…è®¸ç”¨æˆ·è·Ÿè¸ªå·²åº”ç”¨åˆ°ç³»ç»Ÿçš„è¡¥ä¸ã€‚Ù“The `CVE Name` field lists the advisory number, if one exists, in the public http://cve.mitre.org[cve.mitre.org] security vulnerabilities database.Ù`CVE Name` å­—æ®µåˆ—å‡ºäº†å…¬å…± http://cve.mitre.org[cve.mitre.org] å®‰å…¨æ¼æ´æ•°æ®åº“ä¸­çš„å’¨è¯¢ç¼–å·ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ã€‚ÙEThe `Background` field provides a description of the affected module.Ù7`Background` å­—æ®µæä¾›äº†å—å½±å“æ¨¡å—çš„æè¿°ã€‚ÙThe `Problem Description` field explains the vulnerability. This can include information about the flawed code and how the utility could be maliciously used.Ù‘`Problem Description` å­—æ®µè§£é‡Šäº†æ¼æ´çš„æƒ…å†µã€‚è¿™å¯èƒ½åŒ…æ‹¬æœ‰å…³æœ‰ç¼ºé™·çš„ä»£ç ä»¥åŠå¦‚ä½•æ¶æ„ä½¿ç”¨è¯¥å®ç”¨ç¨‹åºçš„ä¿¡æ¯ã€‚ÙTThe `Impact` field describes what type of impact the problem could have on a system.ÙE`Impact` å­—æ®µæè¿°äº†é—®é¢˜å¯¹ç³»ç»Ÿå¯èƒ½äº§ç”Ÿçš„å½±å“ç±»å‹ã€‚ÙThe `Workaround` field indicates if a workaround is available to system administrators who cannot immediately patch the system.Ùp`Workaround` å­—æ®µæŒ‡ç¤ºç³»ç»Ÿç®¡ç†å‘˜æ˜¯å¦å¯ä»¥ç«‹å³ä¿®è¡¥ç³»ç»Ÿï¼Œä»¥åŠæ˜¯å¦æœ‰å¯ç”¨çš„è§£å†³æ–¹æ³•ã€‚ÙµThe `Solution` field provides the instructions for patching the affected system. This is a step by step tested and verified method for getting a system patched and working securely.Ù›`Solution` å­—æ®µæä¾›äº†ä¿®è¡¥å—å½±å“ç³»ç»Ÿçš„æŒ‡ä»¤ã€‚è¿™æ˜¯ä¸€ä¸ªç»è¿‡é€æ­¥æµ‹è¯•å’ŒéªŒè¯çš„æ–¹æ³•ï¼Œç”¨äºä¿®è¡¥ç³»ç»Ÿå¹¶ç¡®ä¿å…¶å®‰å…¨è¿è¡Œã€‚Ù‰The `Correction Details` field displays each affected Subversion or Git branch with the revision number that contains the corrected code.Ù}`Correction Details` å­—æ®µæ˜¾ç¤ºäº†æ¯ä¸ªå—å½±å“çš„ Subversion æˆ– Git åˆ†æ”¯ä»¥åŠåŒ…å«ä¿®æ­£ä»£ç çš„ä¿®è®¢ç‰ˆæœ¬å·ã€‚Ù\The `References` field offers sources of additional information regarding the vulnerability.ÙC`References` å­—æ®µæä¾›äº†æœ‰å…³æ¼æ´çš„é¢å¤–ä¿¡æ¯çš„æ¥æºã€‚Ù2_crossref:introduction[introduction,Introduction]_Ù-_crossref:introduction[introduction, å¯¼è¨€]_ÙÏFreeBSD security event auditing supports reliable, fine-grained, and configurable logging of a variety of security-relevant system events, including logins, configuration changes, and file and network accessÙ§FreeBSD å®‰å…¨äº‹ä»¶å®¡è®¡æ”¯æŒå¯é ã€ç»†ç²’åº¦å’Œå¯é…ç½®çš„è®°å½•å„ç§ä¸å®‰å…¨ç›¸å…³çš„ç³»ç»Ÿäº‹ä»¶ï¼ŒåŒ…æ‹¬ç™»å½•ã€é…ç½®æ›´æ”¹ä»¥åŠæ–‡ä»¶å’Œç½‘ç»œè®¿é—®ã€‚Ù#Chapter 19. Security Event Auditing½ç¬¬ 19 ç«  å®‰å…¨äº‹ä»¶å®¡è®¡·Security Event Auditing²å®‰å…¨äº‹ä»¶å®¡è®¡ÚHThe FreeBSD operating system includes support for security event auditing.  Event auditing supports reliable, fine-grained, and configurable logging of a variety of security-relevant system events, including logins, configuration changes, and file and network access.  These log records can be invaluable for live system monitoring, intrusion detection, and postmortem analysis.  FreeBSD implements Sun(TM)'s published Basic Security Module (BSM) Application Programming Interface (API) and file format, and is interoperable with the Solaris(TM) and Mac OS(R) X audit implementations.ÚØFreeBSD æ“ä½œç³»ç»ŸåŒ…å«å®‰å…¨äº‹ä»¶å®¡è®¡çš„æ”¯æŒã€‚äº‹ä»¶å®¡è®¡æ”¯æŒå¯é ã€ç»†ç²’åº¦å’Œå¯é…ç½®çš„è®°å½•å„ç§ä¸å®‰å…¨ç›¸å…³çš„ç³»ç»Ÿäº‹ä»¶ï¼ŒåŒ…æ‹¬ç™»å½•ã€é…ç½®æ›´æ”¹ä»¥åŠæ–‡ä»¶å’Œç½‘ç»œè®¿é—®ã€‚è¿™äº›æ—¥å¿—è®°å½•å¯¹äºå®æ—¶ç³»ç»Ÿç›‘æ§ã€å…¥ä¾µæ£€æµ‹å’Œäº‹ååˆ†æéå¸¸å®è´µã€‚ FreeBSD å®ç°äº† Sun(TM) å‘å¸ƒçš„åŸºæœ¬å®‰å…¨æ¨¡å—ï¼ˆBSMï¼‰åº”ç”¨ç¨‹åºç¼–ç¨‹æ¥å£ï¼ˆAPIï¼‰å’Œæ–‡ä»¶æ ¼å¼ï¼Œå¹¶ä¸ Solaris(TM) å’Œ Mac OS(R) X çš„å®¡è®¡å®ç°äº’æ“ä½œã€‚Ù–This chapter focuses on the installation and configuration of event auditing.  It explains audit policies and provides an example audit configuration.Ùuæœ¬ç« é‡ç‚¹ä»‹ç»äº‹ä»¶å®¡è®¡çš„å®‰è£…å’Œé…ç½®ã€‚å®ƒè§£é‡Šäº†å®¡è®¡ç­–ç•¥ï¼Œå¹¶æä¾›äº†ä¸€ä¸ªç¤ºä¾‹å®¡è®¡é…ç½®ã€‚Ù(What event auditing is and how it works.Ù3ä»€ä¹ˆæ˜¯äº‹ä»¶å®¡è®¡ä»¥åŠå®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚ÙCHow to configure event auditing on FreeBSD for users and processes.Ù<å¦‚ä½•åœ¨ FreeBSD ä¸Šé…ç½®ç”¨æˆ·å’Œè¿›ç¨‹çš„äº‹ä»¶å®¡è®¡ã€‚ÙIHow to review the audit trail using the audit reduction and review tools.ÙEå¦‚ä½•ä½¿ç”¨å®¡è®¡ç¼©å‡å’Œå®¡æŸ¥å·¥å…·æ¥å®¡æŸ¥å®¡è®¡è·Ÿè¸ªè®°å½•ã€‚Ù…Be familiar with the basics of kernel configuration/compilation (crossref:kernelconfig[kernelconfig,Configuring the FreeBSD Kernel]).ÙPç†Ÿæ‚‰ crossref:kernelconfig[kernelconfig,å†…æ ¸é…ç½®/ç¼–è¯‘çš„åŸºç¡€çŸ¥è¯†]ã€‚ÙùThe audit facility has some known limitations.  Not all security-relevant system events are auditable and some login mechanisms, such as Xorg-based display managers and third-party daemons, do not properly configure auditing for user login sessions.Ùóå®¡è®¡åŠŸèƒ½æœ‰ä¸€äº›å·²çŸ¥çš„é™åˆ¶ã€‚å¹¶éæ‰€æœ‰ä¸å®‰å…¨ç›¸å…³çš„ç³»ç»Ÿäº‹ä»¶éƒ½å¯ä»¥è¿›è¡Œå®¡è®¡ï¼Œè€ŒæŸäº›ç™»å½•æœºåˆ¶ï¼ˆä¾‹å¦‚åŸºäº Xorg çš„æ˜¾ç¤ºç®¡ç†å™¨å’Œç¬¬ä¸‰æ–¹å®ˆæŠ¤ç¨‹åºï¼‰æœªæ­£ç¡®é…ç½®ç”¨æˆ·ç™»å½•ä¼šè¯çš„å®¡è®¡åŠŸèƒ½ã€‚Ú	The security event auditing facility is able to generate very detailed logs of system activity.  On a busy system, trail file data can be very large when configured for high detail, exceeding gigabytes a week in some configurations.  Administrators should take into account the disk space requirements associated with high volume audit configurations.  For example, it may be desirable to dedicate a file system to [.filename]#/var/audit# so that other file systems are not affected if the audit file system becomes full.Ú¼å®‰å…¨äº‹ä»¶å®¡è®¡åŠŸèƒ½èƒ½å¤Ÿç”Ÿæˆç³»ç»Ÿæ´»åŠ¨çš„éå¸¸è¯¦ç»†çš„æ—¥å¿—ã€‚åœ¨ç¹å¿™çš„ç³»ç»Ÿä¸Šï¼Œå½“é…ç½®ä¸ºé«˜è¯¦ç»†çº§åˆ«æ—¶ï¼Œè·Ÿè¸ªæ–‡ä»¶æ•°æ®å¯èƒ½éå¸¸å¤§ï¼Œåœ¨æŸäº›é…ç½®ä¸‹æ¯å‘¨è¶…è¿‡å‡ ä¸ªåƒå…†å­—èŠ‚ã€‚ç®¡ç†å‘˜åº”è€ƒè™‘ä¸é«˜å®¹é‡å®¡è®¡é…ç½®ç›¸å…³çš„ç£ç›˜ç©ºé—´éœ€æ±‚ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥å°†ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿä¸“é—¨ç”¨äº [.filename]#/var/audit#ï¼Œè¿™æ ·å¦‚æœå®¡è®¡æ–‡ä»¶ç³»ç»Ÿå˜æ»¡ï¼Œå…¶ä»–æ–‡ä»¶ç³»ç»Ÿä¸ä¼šå—åˆ°å½±å“ã€‚Ù;The following terms are related to security event auditing:Ù*ä»¥ä¸‹æœ¯è¯­ä¸å®‰å…¨äº‹ä»¶å®¡è®¡ç›¸å…³ï¼šÚÓ_event_: an auditable event is any event that can be logged using the audit subsystem. Examples of security-relevant events include the creation of a file, the building of a network connection, or a user logging in. Events are either "attributable", meaning that they can be traced to an authenticated user, or "non-attributable". Examples of non-attributable events are any events that occur before authentication in the login process, such as bad password attempts.Ú«_äº‹ä»¶ï¼ˆeventï¼‰_ï¼šå¯å®¡è®¡äº‹ä»¶æ˜¯æŒ‡å¯ä»¥ä½¿ç”¨å®¡è®¡å­ç³»ç»Ÿè®°å½•çš„ä»»ä½•äº‹ä»¶ã€‚å®‰å…¨ç›¸å…³äº‹ä»¶çš„ç¤ºä¾‹åŒ…æ‹¬æ–‡ä»¶çš„åˆ›å»ºã€ç½‘ç»œè¿æ¥çš„å»ºç«‹æˆ–ç”¨æˆ·ç™»å½•ã€‚äº‹ä»¶å¯ä»¥æ˜¯â€œå¯å½’å› â€çš„ï¼Œæ„å‘³ç€å¯ä»¥è¿½æº¯åˆ°ç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·ï¼Œä¹Ÿå¯ä»¥æ˜¯â€œä¸å¯å½’å› â€çš„ã€‚ä¸å¯å½’å› äº‹ä»¶çš„ç¤ºä¾‹æ˜¯åœ¨ç™»å½•è¿‡ç¨‹ä¸­èº«ä»½éªŒè¯ä¹‹å‰å‘ç”Ÿçš„ä»»ä½•äº‹ä»¶ï¼Œä¾‹å¦‚å¯†ç é”™è¯¯å°è¯•ã€‚Ù³_class_: a named set of related events which are used in selection expressions. Commonly used classes of events include "file creation" (fc), "exec" (ex), and "login_logout" (lo).Ù³_class_ï¼šä¸€ç»„å‘½åçš„ç›¸å…³äº‹ä»¶ï¼Œç”¨äºé€‰æ‹©è¡¨è¾¾å¼ä¸­ä½¿ç”¨ã€‚å¸¸ç”¨çš„äº‹ä»¶ç±»åŒ…æ‹¬â€œæ–‡ä»¶åˆ›å»ºâ€ï¼ˆfcï¼‰ã€â€œæ‰§è¡Œâ€ï¼ˆexï¼‰å’Œâ€œç™»å½•/æ³¨é”€â€ï¼ˆloï¼‰ã€‚Ùÿ_record_: an audit log entry describing a security event. Records contain a record event type, information on the subject (user) performing the action, date and time information, information on any objects or arguments, and a success or failure condition.Ùİ_record_ï¼šæè¿°å®‰å…¨äº‹ä»¶çš„å®¡è®¡æ—¥å¿—æ¡ç›®ã€‚è®°å½•åŒ…å«è®°å½•äº‹ä»¶ç±»å‹ã€æ‰§è¡Œæ“ä½œçš„ä¸»ä½“ï¼ˆç”¨æˆ·ï¼‰çš„ä¿¡æ¯ã€æ—¥æœŸå’Œæ—¶é—´ä¿¡æ¯ã€ä»»ä½•å¯¹è±¡æˆ–å‚æ•°çš„ä¿¡æ¯ï¼Œä»¥åŠæˆåŠŸæˆ–å¤±è´¥çš„æ¡ä»¶ã€‚Ùø_trail_: a log file consisting of a series of audit records describing security events. Trails are in roughly chronological order with respect to the time events completed. Only authorized processes are allowed to commit records to the audit trail.ÙÖ_trail_ï¼šä¸€ä¸ªç”±ä¸€ç³»åˆ—æè¿°å®‰å…¨äº‹ä»¶çš„å®¡è®¡è®°å½•ç»„æˆçš„æ—¥å¿—æ–‡ä»¶ã€‚Trail çš„é¡ºåºå¤§è‡´æŒ‰ç…§äº‹ä»¶å®Œæˆçš„æ—¶é—´é¡ºåºæ’åˆ—ã€‚åªæœ‰ç»è¿‡æˆæƒçš„è¿›ç¨‹æ‰å…è®¸å‘å®¡è®¡è½¨è¿¹æäº¤è®°å½•ã€‚Ùp_selection expression_: a string containing a list of prefixes and audit event class names used to match events.Ù_é€‰æ‹©è¡¨è¾¾å¼ï¼ˆselection expressionï¼‰_ï¼šä¸€ä¸ªåŒ…å«å‰ç¼€å’Œå®¡è®¡äº‹ä»¶ç±»ååˆ—è¡¨çš„å­—ç¬¦ä¸²ï¼Œç”¨äºåŒ¹é…äº‹ä»¶ã€‚ÚL_preselection_: the process by which the system identifies which events are of interest to the administrator. The preselection configuration uses a series of selection expressions to identify which classes of events to audit for which users, as well as global settings that apply to both authenticated and unauthenticated processes.Ùû_é¢„é€‰ï¼ˆpreselectionï¼‰_ï¼šç³»ç»Ÿè¯†åˆ«å“ªäº›äº‹ä»¶å¯¹ç®¡ç†å‘˜æ„Ÿå…´è¶£çš„è¿‡ç¨‹ã€‚é¢„é€‰é…ç½®ä½¿ç”¨ä¸€ç³»åˆ—é€‰æ‹©è¡¨è¾¾å¼æ¥è¯†åˆ«å“ªäº›äº‹ä»¶ç±»åˆ«é€‚ç”¨äºå“ªäº›ç”¨æˆ·è¿›è¡Œå®¡è®¡ï¼Œä»¥åŠé€‚ç”¨äºå·²è®¤è¯å’Œæœªè®¤è¯è¿›ç¨‹çš„å…¨å±€è®¾ç½®ã€‚ÚÙ_reduction_: the process by which records from existing audit trails are selected for preservation, printing, or analysis. Likewise, the process by which undesired audit records are removed from the audit trail. Using reduction, administrators can implement policies for the preservation of audit data. For example, detailed audit trails might be kept for one month, but after that, trails might be reduced in order to preserve only login information for archival purposes.Úˆ_reduction_ï¼šä»ç°æœ‰å®¡è®¡è·Ÿè¸ªä¸­é€‰æ‹©è®°å½•ä»¥è¿›è¡Œä¿ç•™ã€æ‰“å°æˆ–åˆ†æçš„è¿‡ç¨‹ã€‚åŒæ ·ï¼Œä¹Ÿæ˜¯ä»å®¡è®¡è·Ÿè¸ªä¸­åˆ é™¤ä¸éœ€è¦çš„å®¡è®¡è®°å½•çš„è¿‡ç¨‹ã€‚é€šè¿‡ä½¿ç”¨å‡å°‘ï¼Œç®¡ç†å‘˜å¯ä»¥å®æ–½æœ‰å…³ä¿ç•™å®¡è®¡æ•°æ®çš„ç­–ç•¥ã€‚ä¾‹å¦‚ï¼Œè¯¦ç»†çš„å®¡è®¡è·Ÿè¸ªå¯èƒ½ä¼šä¿ç•™ä¸€ä¸ªæœˆï¼Œä½†ä¹‹åï¼Œä¸ºäº†ä¿ç•™ä»…ç”¨äºå½’æ¡£ç›®çš„çš„ç™»å½•ä¿¡æ¯ï¼Œå¯èƒ½ä¼šè¿›è¡Œå‡å°‘ã€‚³Audit Configuration¬å®¡è®¡é…ç½®ÚUser space support for event auditing is installed as part of the base FreeBSD operating system.  Kernel support is available in the [.filename]#GENERIC# kernel by default, and man:auditd[8] can be enabled by adding the following line to [.filename]#/etc/rc.conf#:Úç”¨æˆ·ç©ºé—´å¯¹äº‹ä»¶å®¡è®¡çš„æ”¯æŒæ˜¯ä½œä¸ºåŸºæœ¬çš„ FreeBSD æ“ä½œç³»ç»Ÿçš„ä¸€éƒ¨åˆ†å®‰è£…çš„ã€‚å†…æ ¸æ”¯æŒé»˜è®¤æƒ…å†µä¸‹åœ¨ [.filename]#GENERIC# å†…æ ¸ä¸­å¯ç”¨ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡åœ¨ [.filename]#/etc/rc.conf# ä¸­æ·»åŠ ä»¥ä¸‹è¡Œæ¥å¯ç”¨ man:auditd[8]ã€‚½Then, start the audit daemon:Ù$ç„¶åï¼Œå¯åŠ¨å®¡è®¡å®ˆæŠ¤è¿›ç¨‹ï¼šÙvUsers who prefer to compile a custom kernel must include the following line in their custom kernel configuration file:Ù`å–œæ¬¢ç¼–è¯‘è‡ªå®šä¹‰å†…æ ¸çš„ç”¨æˆ·å¿…é¡»åœ¨å…¶è‡ªå®šä¹‰å†…æ ¸é…ç½®æ–‡ä»¶ä¸­åŒ…å«ä»¥ä¸‹è¡Œï¼š»Event Selection Expressionsµäº‹ä»¶é€‰æ‹©è¡¨è¾¾å¼Ú.Selection expressions are used in a number of places in the audit configuration to determine which events should be audited.  Expressions contain a list of event classes to match.  Selection expressions are evaluated from left to right, and two expressions are combined by appending one onto the other.Ùùé€‰æ‹©è¡¨è¾¾å¼åœ¨å®¡è®¡é…ç½®ä¸­çš„è®¸å¤šåœ°æ–¹ç”¨äºç¡®å®šåº”è¯¥å®¡è®¡å“ªäº›äº‹ä»¶ã€‚è¡¨è¾¾å¼åŒ…å«è¦åŒ¹é…çš„äº‹ä»¶ç±»åˆ«åˆ—è¡¨ã€‚é€‰æ‹©è¡¨è¾¾å¼ä»å·¦åˆ°å³è¿›è¡Œè¯„ä¼°ï¼Œå¹¶é€šè¿‡å°†ä¸€ä¸ªè¡¨è¾¾å¼é™„åŠ åˆ°å¦ä¸€ä¸ªæ¥ç»„åˆä¸¤ä¸ªè¡¨è¾¾å¼ã€‚Ù?<<event-selection>> summarizes the default audit event classes:Ù;<<event-selection>> æ€»ç»“äº†é»˜è®¤çš„å®¡è®¡äº‹ä»¶ç±»åˆ«ï¼š»Default Audit Event Classes»é»˜è®¤çš„å®¡è®¡äº‹ä»¶ç±»åˆ«ªClass Name¦ç±»å¦Action¦è¡ŒåŠ¨£all¦æ‰€æœ‰¸Match all event classes.¸åŒ¹é…æ‰€æœ‰äº‹ä»¶ç±»ã€‚Ù authentication and authorizationµèº«ä»½éªŒè¯å’Œæˆæƒ®administrative¬ç®¡ç†æ“ä½œÙ:Administrative actions performed on the system as a whole.Ù'å¯¹æ•´ä¸ªç³»ç»Ÿæ‰§è¡Œçš„ç®¡ç†æ“ä½œã€‚«application¬åº”ç”¨ç¨‹åº»Application defined action.¾åº”ç”¨ç¨‹åºå®šä¹‰çš„æ“ä½œã€‚ªfile close¬å…³é—­æ–‡ä»¶Ù'Audit calls to the `close` system call.Ù*å®¡è®¡å¯¹ `close` ç³»ç»Ÿè°ƒç”¨çš„è°ƒç”¨ã€‚¤exec¦æ‰§è¡ŒÙ¾Audit program execution. Auditing of command line arguments and environmental variables is controlled via man:audit_control[5] using the `argv` and `envv` parameters to the `policy` setting.Ù«æ‰§è¡Œå®¡è®¡ç¨‹åºã€‚é€šè¿‡ man:audit_control[5] ä½¿ç”¨ `argv` å’Œ `envv` å‚æ•°æ¥æ§åˆ¶å‘½ä»¤è¡Œå‚æ•°å’Œç¯å¢ƒå˜é‡çš„å®¡è®¡ï¼Œè¿™æ˜¯é€šè¿‡ `policy` è®¾ç½®å®ç°çš„ã€‚µfile attribute access²æ–‡ä»¶å±æ€§è®¿é—®ÙNAudit the access of object attributes such as man:stat[1] and man:pathconf[2].ÙGå®¡è®¡å¯¹è±¡å±æ€§çš„è®¿é—®ï¼Œä¾‹å¦‚ man:stat[1] å’Œ man:pathconf[2]ã€‚«file create¬åˆ›å»ºæ–‡ä»¶Ù1Audit events where a file is created as a result.Ù'å®¡è®¡äº‹ä»¶ï¼šæ–‡ä»¶åˆ›å»ºçš„ç»“æœã€‚«file delete¬åˆ é™¤æ–‡ä»¶Ù(Audit events where file deletion occurs.»å®¡è®¡æ–‡ä»¶åˆ é™¤äº‹ä»¶ã€‚µfile attribute modify²æ–‡ä»¶å±æ€§ä¿®æ”¹ÙqAudit events where file attribute modification occurs, such as by man:chown[8], man:chflags[1], and man:flock[2].Ùrå®¡è®¡æ–‡ä»¶å±æ€§ä¿®æ”¹çš„äº‹ä»¶ï¼Œä¾‹å¦‚é€šè¿‡ man:chown[8]ï¼Œman:chflags[1] å’Œ man:flock[2] è¿›è¡Œçš„ä¿®æ”¹ã€‚©file read¬æ–‡ä»¶è¯»å–ÙCAudit events in which data is read or files are opened for reading.ÙHå®¡è®¡äº‹ä»¶ä¸­æ¶‰åŠæ•°æ®è¯»å–æˆ–æ‰“å¼€æ–‡ä»¶è¿›è¡Œè¯»å–çš„æƒ…å†µã€‚ªfile write¬æ–‡ä»¶å†™å…¥ÙGAudit events in which data is written or files are written or modified.ÙEå®¡è®¡äº‹ä»¶ä¸­æ¶‰åŠæ•°æ®å†™å…¥ã€æ–‡ä»¶å†™å…¥æˆ–ä¿®æ”¹çš„æƒ…å†µã€‚Ù%Audit use of the `ioctl` system call.Ù*å®¡è®¡å¯¹ `ioctl` ç³»ç»Ÿè°ƒç”¨çš„ä½¿ç”¨ã€‚ÙfAudit various forms of Inter-Process Communication, including POSIX pipes and System V IPC operations.ÙTå®¡è®¡å„ç§å½¢å¼çš„è¿›ç¨‹é—´é€šä¿¡ï¼ŒåŒ…æ‹¬ POSIX ç®¡é“å’Œ System V IPC æ“ä½œã€‚¬login_logout­ç™»å½•_æ³¨é”€Ù,Audit man:login[1] and man:logout[1] events.Ù/å®¡è®¡ man:login[1] å’Œ man:logout[1] äº‹ä»¶ã€‚°non attributable¯ä¸å¯å½’å› çš„¾Audit non-attributable events.»å®¡è®¡ä¸å¯å½’å±äº‹ä»¶ã€‚­invalid class¬æ— æ•ˆçš„ç±»¶Match no audit events.¾æ²¡æœ‰åŒ¹é…çš„å®¡è®¡äº‹ä»¶ã€‚§network¦ç½‘ç»œÙQAudit events related to network actions such as man:connect[2] and man:accept[2].ÙNä¸ç½‘ç»œæ“ä½œç›¸å…³çš„å®¡è®¡äº‹ä»¶ï¼Œå¦‚ man:connect[2] å’Œ man:accept[2]ã€‚¥other¦å…¶ä»–»Audit miscellaneous events.µå®¡è®¡å…¶ä»–äº‹ä»¶ã€‚§process¦è¿‡ç¨‹Ù=Audit process operations such as man:exec[3] and man:exit[3].Ù7å®¡è®¡è¿›ç¨‹æ“ä½œï¼Œå¦‚ man:exec[3] å’Œ man:exit[3]ã€‚Ù‡These audit event classes may be customized by modifying the [.filename]#audit_class# and [.filename]#audit_event# configuration files.Ù|è¿™äº›å®¡è®¡äº‹ä»¶ç±»å¯ä»¥é€šè¿‡ä¿®æ”¹ [.filename]#audit_class# å’Œ [.filename]#audit_event# é…ç½®æ–‡ä»¶è¿›è¡Œè‡ªå®šä¹‰ã€‚ÙõEach audit event class may be combined with a prefix indicating whether successful/failed operations are matched, and whether the entry is adding or removing matching for the class and type.  <<event-prefixes>> summarizes the available prefixes:ÙÀæ¯ä¸ªå®¡è®¡äº‹ä»¶ç±»åˆ«å¯ä»¥ä¸å‰ç¼€ç»„åˆï¼Œä»¥æŒ‡ç¤ºåŒ¹é…æˆåŠŸ/å¤±è´¥çš„æ“ä½œï¼Œå¹¶æŒ‡ç¤ºæ·»åŠ æˆ–åˆ é™¤è¯¥ç±»åˆ«å’Œç±»å‹çš„åŒ¹é…é¡¹ã€‚ <<event-prefixes>> æ€»ç»“äº†å¯ç”¨çš„å‰ç¼€ï¼šÙ Prefixes for Audit Event Classes¸å®¡è®¡äº‹ä»¶ç±»çš„å‰ç¼€¦Prefix¦å‰ç¼€Ù&Audit successful events in this class.Ù!å®¡è®¡æ­¤ç±»ä¸­çš„æˆåŠŸäº‹ä»¶ã€‚Ù"Audit failed events in this class.Ù!å®¡è®¡æ­¤ç±»ä¸­çš„å¤±è´¥äº‹ä»¶ã€‚Ù9Audit neither successful nor failed events in this class.ÙHåœ¨è¿™ä¸ªç±»ä¸­ï¼Œæ—¢ä¸å®¡è®¡æˆåŠŸäº‹ä»¶ï¼Œä¹Ÿä¸å®¡è®¡å¤±è´¥äº‹ä»¶ã€‚Ù-Do not audit successful events in this class.Ù3ä¸è¦å¯¹è¿™ä¸ªç±»ä¸­çš„æˆåŠŸäº‹ä»¶è¿›è¡Œå®¡è®¡ã€‚Ù)Do not audit failed events in this class.Ù0ä¸è¦å¯¹è¯¥ç±»ä¸­çš„å¤±è´¥äº‹ä»¶è¿›è¡Œå®¡è®¡ã€‚Ù[If no prefix is present, both successful and failed instances of the event will be audited.ÙNå¦‚æœæ²¡æœ‰å‰ç¼€ï¼Œåˆ™å¯¹äº‹ä»¶çš„æˆåŠŸå’Œå¤±è´¥å®ä¾‹éƒ½å°†è¿›è¡Œå®¡è®¡ã€‚Ù„The following example selection string selects both successful and failed login/logout events, but only successful execution events:Ùmä»¥ä¸‹ç¤ºä¾‹é€‰æ‹©å­—ç¬¦ä¸²é€‰æ‹©æˆåŠŸå’Œå¤±è´¥çš„ç™»å½•/æ³¨é”€äº‹ä»¶ï¼Œä½†ä»…é€‰æ‹©æˆåŠŸçš„æ‰§è¡Œäº‹ä»¶ï¼šÙfThe following configuration files for security event auditing are found in [.filename]#/etc/security#:ÙUå®‰å…¨äº‹ä»¶å®¡è®¡çš„ä»¥ä¸‹é…ç½®æ–‡ä»¶ä½äº [.filename]#/etc/security# ç›®å½•ä¸­ï¼šÙH[.filename]#audit_class#: contains the definitions of the audit classes.Ù8[.filename]#audit_class#: åŒ…å«äº†å®¡è®¡ç±»çš„å®šä¹‰ã€‚Ù¶[.filename]#audit_control#: controls aspects of the audit subsystem, such as default audit classes, minimum disk space to leave on the audit log volume, and maximum audit trail size.Ù¬[.filename]#audit_control#: æ§åˆ¶å®¡è®¡å­ç³»ç»Ÿçš„å„ä¸ªæ–¹é¢ï¼Œå¦‚é»˜è®¤å®¡è®¡ç±»åˆ«ã€åœ¨å®¡è®¡æ—¥å¿—å·ä¸Šä¿ç•™çš„æœ€å°ç£ç›˜ç©ºé—´ä»¥åŠæœ€å¤§å®¡è®¡è·Ÿè¸ªå¤§å°ã€‚Ù}[.filename]#audit_event#: textual names and descriptions of system audit events and a list of which classes each event is in.Ùq[.filename]#audit_event#: ç³»ç»Ÿå®¡è®¡äº‹ä»¶çš„æ–‡æœ¬åç§°å’Œæè¿°ï¼Œä»¥åŠæ¯ä¸ªäº‹ä»¶æ‰€å±çš„ç±»åˆ«åˆ—è¡¨ã€‚Ùk[.filename]#audit_user#: user-specific audit requirements to be combined with the global defaults at login.Ùd[.filename]#audit_user#: ç”¨æˆ·ç‰¹å®šçš„å®¡è®¡è¦æ±‚ï¼Œåœ¨ç™»å½•æ—¶ä¸å…¨å±€é»˜è®¤å€¼ç»“åˆä½¿ç”¨ã€‚Ùå[.filename]#audit_warn#: a customizable shell script used by man:auditd[8] to generate warning messages in exceptional situations, such as when space for audit records is running low or when the audit trail file has been rotated.ÙÑ[.filename]#audit_warn#: æ˜¯ä¸€ä¸ªå¯å®šåˆ¶çš„ Shell è„šæœ¬ï¼Œç”± man:auditd[8] ä½¿ç”¨ï¼Œç”¨äºåœ¨å¼‚å¸¸æƒ…å†µä¸‹ç”Ÿæˆè­¦å‘Šæ¶ˆæ¯ï¼Œä¾‹å¦‚å½“å®¡è®¡è®°å½•çš„ç©ºé—´ä¸è¶³æˆ–å®¡è®¡è·Ÿè¸ªæ–‡ä»¶å·²ç»è½®è½¬æ—¶ã€‚Ù‰Audit configuration files should be edited and maintained carefully, as errors in configuration may result in improper logging of events.Ùfå®¡è®¡é…ç½®æ–‡ä»¶åº”è¯¥å°å¿ƒç¼–è¾‘å’Œç»´æŠ¤ï¼Œå› ä¸ºé…ç½®é”™è¯¯å¯èƒ½å¯¼è‡´äº‹ä»¶è®°å½•ä¸æ­£ç¡®ã€‚ÙğIn most cases, administrators will only need to modify [.filename]#audit_control# and [.filename]#audit_user#.  The first file controls system-wide audit properties and policies and the second file may be used to fine-tune auditing by user.Ùõåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œç®¡ç†å‘˜åªéœ€è¦ä¿®æ”¹ [.filename]#audit_control# å’Œ [.filename]#audit_user# è¿™ä¸¤ä¸ªæ–‡ä»¶ã€‚ç¬¬ä¸€ä¸ªæ–‡ä»¶æ§åˆ¶ç³»ç»ŸèŒƒå›´çš„å®¡è®¡å±æ€§å’Œç­–ç•¥ï¼Œè€Œç¬¬äºŒä¸ªæ–‡ä»¶å¯ç”¨äºæŒ‰ç”¨æˆ·è¿›è¡Œç»†åŒ–è°ƒæ•´å®¡è®¡ã€‚Ù#The [.filename]#audit_control# FileÙ![.filename]#audit_control# æ–‡ä»¶ÙYA number of defaults for the audit subsystem are specified in [.filename]#audit_control#:ÙUåœ¨ [.filename]#audit_control# æ–‡ä»¶ä¸­æŒ‡å®šäº†ä¸€äº›å®¡è®¡å­ç³»ç»Ÿçš„é»˜è®¤å€¼ï¼šÚrThe `dir` entry is used to set one or more directories where audit logs will be stored.  If more than one directory entry appears, they will be used in order as they fill.  It is common to configure audit so that audit logs are stored on a dedicated file system, in order to prevent interference between the audit subsystem and other subsystems if the file system fills.Ú9`dir` æ¡ç›®ç”¨äºè®¾ç½®ä¸€ä¸ªæˆ–å¤šä¸ªç›®å½•ï¼Œç”¨äºå­˜å‚¨å®¡è®¡æ—¥å¿—ã€‚å¦‚æœå‡ºç°å¤šä¸ª `dir` æ¡ç›®ï¼Œåˆ™æŒ‰ç…§å®ƒä»¬å‡ºç°çš„é¡ºåºè¿›è¡Œå¡«å……ã€‚é€šå¸¸é…ç½®å®¡è®¡æ—¶ï¼Œä¼šå°†å®¡è®¡æ—¥å¿—å­˜å‚¨åœ¨ä¸“ç”¨çš„æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œä»¥é˜²æ­¢æ–‡ä»¶ç³»ç»Ÿå¡«æ»¡æ—¶å®¡è®¡å­ç³»ç»Ÿä¸å…¶ä»–å­ç³»ç»Ÿä¹‹é—´çš„å¹²æ‰°ã€‚Ù{If the `dist` field is set to `on` or `yes`, hard links will be created to all trail files in [.filename]#/var/audit/dist#.Ù‡å¦‚æœ `dist` å­—æ®µè®¾ç½®ä¸º `on` æˆ– `yes` ï¼Œå°†ä¼šåœ¨ [.filename]#/var/audit/dist# ç›®å½•ä¸‹åˆ›å»ºæ‰€æœ‰å®¡è®¡æ–‡ä»¶çš„ç¡¬é“¾æ¥ã€‚ÙáThe `flags` field sets the system-wide default preselection mask for attributable events.  In the example above, successful and failed login/logout events as well as authentication and authorization are audited for all users.ÙÆ`flags` å­—æ®µè®¾ç½®äº†ç³»ç»ŸèŒƒå›´å†…å¯å½’å±äº‹ä»¶çš„é»˜è®¤é¢„é€‰æ©ç ã€‚åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼ŒæˆåŠŸå’Œå¤±è´¥çš„ç™»å½•/æ³¨é”€äº‹ä»¶ä»¥åŠèº«ä»½éªŒè¯å’Œæˆæƒå°†ä¸ºæ‰€æœ‰ç”¨æˆ·è¿›è¡Œå®¡è®¡ã€‚ÙuThe `minfree` entry defines the minimum percentage of free space for the file system where the audit trail is stored.Ù[`minfree` æ¡ç›®å®šä¹‰äº†å­˜å‚¨å®¡è®¡è·Ÿè¸ªçš„æ–‡ä»¶ç³»ç»Ÿçš„æœ€å°ç©ºé—²ç©ºé—´ç™¾åˆ†æ¯”ã€‚Ù›The `naflags` entry specifies audit classes to be audited for non-attributed events, such as the login/logout process and authentication and authorization.Ùƒ`naflags` æ¡ç›®æŒ‡å®šäº†è¦å¯¹éå½’å› äº‹ä»¶è¿›è¡Œå®¡è®¡çš„å®¡è®¡ç±»åˆ«ï¼Œä¾‹å¦‚ç™»å½•/æ³¨é”€è¿‡ç¨‹ä»¥åŠèº«ä»½éªŒè¯å’Œæˆæƒã€‚ÚrThe `policy` entry specifies a comma-separated list of policy flags controlling various aspects of audit behavior.  The `cnt` indicates that the system should continue running despite an auditing failure (this flag is highly recommended).  The other flag, `argv`, causes command line arguments to the man:execve[2] system call to be audited as part of command execution.ÚL`policy` æ¡ç›®æŒ‡å®šäº†ä¸€ä¸ªé€—å·åˆ†éš”çš„ç­–ç•¥æ ‡å¿—åˆ—è¡¨ï¼Œç”¨äºæ§åˆ¶å®¡è®¡è¡Œä¸ºçš„å„ä¸ªæ–¹é¢ã€‚`cnt` è¡¨ç¤ºç³»ç»Ÿåº”è¯¥åœ¨å®¡è®¡å¤±è´¥çš„æƒ…å†µä¸‹ç»§ç»­è¿è¡Œï¼ˆå¼ºçƒˆæ¨èä½¿ç”¨æ­¤æ ‡å¿—ï¼‰ã€‚å¦ä¸€ä¸ªæ ‡å¿— `argv` ä¼šå¯¼è‡´å‘½ä»¤è¡Œå‚æ•°åœ¨æ‰§è¡Œå‘½ä»¤æ—¶ä½œä¸º man:execve[2] ç³»ç»Ÿè°ƒç”¨çš„ä¸€éƒ¨åˆ†è¿›è¡Œå®¡è®¡ã€‚Ú!The `filesz` entry specifies the maximum size for an audit trail before automatically terminating and rotating the trail file.  A value of `0` disables automatic log rotation.  If the requested file size is below the minimum of 512k, it will be ignored and a log message will be generated.Ùæ`filesz` æ¡ç›®æŒ‡å®šäº†å®¡è®¡è·Ÿè¸ªæ–‡ä»¶åœ¨è‡ªåŠ¨ç»ˆæ­¢å’Œè½®è½¬ä¹‹å‰çš„æœ€å¤§å¤§å°ã€‚å€¼ä¸º `0` è¡¨ç¤ºç¦ç”¨è‡ªåŠ¨æ—¥å¿—è½®è½¬ã€‚å¦‚æœè¯·æ±‚çš„æ–‡ä»¶å¤§å°ä½äºæœ€å°å€¼ 512k ï¼Œå®ƒå°†è¢«å¿½ç•¥å¹¶ç”Ÿæˆä¸€æ¡æ—¥å¿—æ¶ˆæ¯ã€‚ÙSThe `expire-after` field specifies when audit log files will expire and be removed.ÙK`expire-after` å­—æ®µæŒ‡å®šäº†å®¡è®¡æ—¥å¿—æ–‡ä»¶ä½•æ—¶è¿‡æœŸå¹¶è¢«åˆ é™¤ã€‚Ù The [.filename]#audit_user# File¾[.filename]#audit_user# æ–‡ä»¶Ú_The administrator can specify further audit requirements for specific users in [.filename]#audit_user#.  Each line configures auditing for a user via two fields: the `alwaysaudit` field specifies a set of events that should always be audited for the user, and the `neveraudit` field specifies a set of events that should never be audited for the user.Ú&ç®¡ç†å‘˜å¯ä»¥åœ¨ [.filename]#audit_user# ä¸­ä¸ºç‰¹å®šç”¨æˆ·æŒ‡å®šè¿›ä¸€æ­¥çš„å®¡è®¡è¦æ±‚ã€‚æ¯ä¸€è¡Œé€šè¿‡ä¸¤ä¸ªå­—æ®µé…ç½®ç”¨æˆ·çš„å®¡è®¡ï¼š `alwaysaudit` å­—æ®µæŒ‡å®šåº”å§‹ç»ˆå¯¹ç”¨æˆ·è¿›è¡Œå®¡è®¡çš„ä¸€ç»„äº‹ä»¶ï¼Œè€Œ `neveraudit` å­—æ®µæŒ‡å®šä¸åº”å¯¹ç”¨æˆ·è¿›è¡Œå®¡è®¡çš„ä¸€ç»„äº‹ä»¶ã€‚Ú7The following example entries audit login/logout events and successful command execution for `root` and file creation and successful command execution for `www`.  If used with the default [.filename]#audit_control#, the `lo` entry for `root` is redundant, and login/logout events will also be audited for `www`.Ú;ä»¥ä¸‹ç¤ºä¾‹æ¡ç›®å®¡è®¡ `root` ç”¨æˆ·çš„ç™»å½•/æ³¨é”€äº‹ä»¶å’ŒæˆåŠŸçš„å‘½ä»¤æ‰§è¡Œï¼Œä»¥åŠ `www` ç”¨æˆ·çš„æ–‡ä»¶åˆ›å»ºå’ŒæˆåŠŸçš„å‘½ä»¤æ‰§è¡Œã€‚å¦‚æœä¸é»˜è®¤çš„ [.filename]#audit_control# ä¸€èµ·ä½¿ç”¨ï¼Œå¯¹äº `root` ç”¨æˆ·çš„ `lo` æ¡ç›®æ˜¯å¤šä½™çš„ï¼Œå¹¶ä¸”è¿˜å°†å®¡è®¡ `www` ç”¨æˆ·çš„ç™»å½•/æ³¨é”€äº‹ä»¶ã€‚¹Working with Audit Trails¸ä½¿ç”¨å®¡è®¡è·Ÿè¸ªåŠŸèƒ½ÚÍSince audit trails are stored in the BSM binary format, several built-in tools are available to modify or convert these trails to text.  To convert trail files to a simple text format, use `praudit`.  To reduce the audit trail file for analysis, archiving, or printing purposes, use `auditreduce`.  This utility supports a variety of selection parameters, including event type, event class, user, date or time of the event, and the file path or object acted on.ÚÁç”±äºå®¡è®¡è·Ÿè¸ªæ˜¯ä»¥ BSM äºŒè¿›åˆ¶æ ¼å¼å­˜å‚¨çš„ï¼Œå› æ­¤æœ‰å‡ ä¸ªå†…ç½®å·¥å…·å¯ç”¨äºä¿®æ”¹æˆ–å°†è¿™äº›è·Ÿè¸ªè½¬æ¢ä¸ºæ–‡æœ¬ã€‚è¦å°†è·Ÿè¸ªæ–‡ä»¶è½¬æ¢ä¸ºç®€å•çš„æ–‡æœ¬æ ¼å¼ï¼Œè¯·ä½¿ç”¨ `praudit`ã€‚è¦ç¼©å°å®¡è®¡è·Ÿè¸ªæ–‡ä»¶ä»¥è¿›è¡Œåˆ†æã€å­˜æ¡£æˆ–æ‰“å°ï¼Œè¯·ä½¿ç”¨ `auditreduce`ã€‚æ­¤å®ç”¨ç¨‹åºæ”¯æŒå„ç§é€‰æ‹©å‚æ•°ï¼ŒåŒ…æ‹¬äº‹ä»¶ç±»å‹ã€äº‹ä»¶ç±»åˆ«ã€ç”¨æˆ·ã€äº‹ä»¶çš„æ—¥æœŸæˆ–æ—¶é—´ï¼Œä»¥åŠæ“ä½œçš„æ–‡ä»¶è·¯å¾„æˆ–å¯¹è±¡ã€‚ÙPFor example, to dump the entire contents of a specified audit log in plain text:ÙHä¾‹å¦‚ï¼Œè¦ä»¥çº¯æ–‡æœ¬å½¢å¼è½¬å‚¨æŒ‡å®šå®¡è®¡æ—¥å¿—çš„å…¨éƒ¨å†…å®¹ï¼šÙ+Where _AUDITFILE_ is the audit log to dump.Ù7å…¶ä¸­ _AUDITFILE_ æ˜¯è¦è½¬å‚¨çš„å®¡è®¡æ—¥å¿—æ–‡ä»¶ã€‚Ú#Audit trails consist of a series of audit records made up of tokens, which `praudit` prints sequentially, one per line.  Each token is of a specific type, such as `header` (an audit record header) or `path` (a file path from a name lookup).  The following is an example of an `execve` event:Ú$å®¡è®¡è¿½è¸ªç”±ä¸€ç³»åˆ—ç”±ä»¤ç‰Œç»„æˆçš„å®¡è®¡è®°å½•ç»„æˆï¼Œ`praudit` æŒ‰é¡ºåºé€è¡Œæ‰“å°è¿™äº›è®°å½•ï¼Œæ¯è¡Œä¸€ä¸ªä»¤ç‰Œã€‚æ¯ä¸ªä»¤ç‰Œéƒ½æ˜¯ç‰¹å®šç±»å‹çš„ï¼Œä¾‹å¦‚ `header` ï¼ˆå®¡è®¡è®°å½•å¤´ï¼‰æˆ– `path`ï¼ˆåç§°æŸ¥æ‰¾çš„æ–‡ä»¶è·¯å¾„ï¼‰ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ª `execve` äº‹ä»¶çš„ç¤ºä¾‹ï¼šÚThis audit represents a successful `execve` call, in which the command `finger doug` has been run.  The `exec arg` token contains the processed command line presented by the shell to the kernel.  The `path` token holds the path to the executable as looked up by the kernel.  The `attribute` token describes the binary and includes the file mode.  The `subject` token stores the audit user ID, effective user ID and group ID, real user ID and group ID, process ID, session ID, port ID, and login address.  Notice that the audit user ID and real user ID differ as the user `robert` switched to the `root` account before running this command, but it is audited using the original authenticated user.  The `return` token indicates the successful execution and the `trailer` concludes the record.ÚÅæ­¤å®¡è®¡è®°å½•è¡¨ç¤ºä¸€ä¸ªæˆåŠŸçš„ `execve` è°ƒç”¨ï¼Œå…¶ä¸­è¿è¡Œäº†å‘½ä»¤ `finger doug`ã€‚`exec arg` ä»¤ç‰ŒåŒ…å«ç”± shell ä¼ é€’ç»™å†…æ ¸çš„å¤„ç†è¿‡çš„å‘½ä»¤è¡Œã€‚`path` ä»¤ç‰Œä¿å­˜äº†å†…æ ¸æŸ¥æ‰¾åˆ°çš„å¯æ‰§è¡Œæ–‡ä»¶çš„è·¯å¾„ã€‚`attribute` ä»¤ç‰Œæè¿°äº†äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¹¶åŒ…æ‹¬æ–‡ä»¶æ¨¡å¼ã€‚`subject` ä»¤ç‰Œå­˜å‚¨äº†å®¡è®¡ç”¨æˆ· ID ã€æœ‰æ•ˆç”¨æˆ· ID å’Œç»„ ID ã€çœŸå®ç”¨æˆ· ID å’Œç»„ ID ã€è¿›ç¨‹ ID ã€ä¼šè¯ ID ã€ç«¯å£ ID å’Œç™»å½•åœ°å€ã€‚è¯·æ³¨æ„ï¼Œå®¡è®¡ç”¨æˆ· ID å’ŒçœŸå®ç”¨æˆ· ID ä¸åŒï¼Œå› ä¸ºç”¨æˆ· `robert` åœ¨è¿è¡Œæ­¤å‘½ä»¤ä¹‹å‰åˆ‡æ¢åˆ°äº† `root` è´¦æˆ·ï¼Œä½†æ˜¯å®ƒæ˜¯ä½¿ç”¨åŸå§‹è®¤è¯ç”¨æˆ·è¿›è¡Œå®¡è®¡çš„ã€‚`return` ä»¤ç‰Œè¡¨ç¤ºæˆåŠŸæ‰§è¡Œï¼Œ`trailer` ç»“æŸäº†è®°å½•ã€‚ÙJXML output format is also supported and can be selected by including `-x`.ÙAè¿˜æ”¯æŒ XML è¾“å‡ºæ ¼å¼ï¼Œå¯ä»¥é€šè¿‡åŒ…å« `-x` æ¥é€‰æ‹©ã€‚ÙÆSince audit logs may be very large, a subset of records can be selected using `auditreduce`.  This example selects all audit records produced for the user `trhodes` stored in [.filename]#AUDITFILE#:Ù¿ç”±äºå®¡è®¡æ—¥å¿—å¯èƒ½éå¸¸åºå¤§ï¼Œå¯ä»¥ä½¿ç”¨ `auditreduce` é€‰æ‹©è®°å½•çš„å­é›†ã€‚æ­¤ç¤ºä¾‹é€‰æ‹©å­˜å‚¨åœ¨ [.filename]#AUDITFILE# ä¸­çš„ç”¨æˆ· `trhodes` ç”Ÿæˆçš„æ‰€æœ‰å®¡è®¡è®°å½•ã€‚ÚÌMembers of the `audit` group have permission to read audit trails in [.filename]#/var/audit#.  By default, this group is empty, so only the `root` user can read audit trails.  Users may be added to the `audit` group in order to delegate audit review rights.  As the ability to track audit log contents provides significant insight into the behavior of users and processes, it is recommended that the delegation of audit review rights be performed with caution.Ú|`audit` ç»„çš„æˆå‘˜æœ‰æƒé™è¯»å–ä½äº [.filename]#/var/audit# ç›®å½•ä¸‹çš„å®¡è®¡æ—¥å¿—ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¯¥ç»„ä¸ºç©ºï¼Œå› æ­¤åªæœ‰ `root` ç”¨æˆ·å¯ä»¥è¯»å–å®¡è®¡æ—¥å¿—ã€‚å¯ä»¥å°†ç”¨æˆ·æ·»åŠ åˆ° `audit` ç»„ä¸­ä»¥å§”æ´¾å®¡è®¡å®¡æŸ¥æƒé™ã€‚ç”±äºè·Ÿè¸ªå®¡è®¡æ—¥å¿—å†…å®¹å¯ä»¥æä¾›å¯¹ç”¨æˆ·å’Œè¿›ç¨‹è¡Œä¸ºçš„é‡è¦è§è§£ï¼Œå»ºè®®è°¨æ…è¿›è¡Œå®¡è®¡å®¡æŸ¥æƒé™çš„å§”æ´¾ã€‚Ù!Live Monitoring Using Audit PipesÙ$ä½¿ç”¨å®¡è®¡ç®¡é“è¿›è¡Œå®æ—¶ç›‘æ§ÚÀAudit pipes are cloning pseudo-devices which allow applications to tap the live audit record stream.  This is primarily of interest to authors of intrusion detection and system monitoring applications.  However, the audit pipe device is a convenient way for the administrator to allow live monitoring without running into problems with audit trail file ownership or log rotation interrupting the event stream.  To track the live audit event stream:ÚVå®¡è®¡ç®¡é“æ˜¯å…‹éš†ä¼ªè®¾å¤‡ï¼Œå…è®¸åº”ç”¨ç¨‹åºç›‘å¬å®æ—¶å®¡è®¡è®°å½•æµã€‚è¿™ä¸»è¦å¯¹å…¥ä¾µæ£€æµ‹å’Œç³»ç»Ÿç›‘æ§åº”ç”¨ç¨‹åºçš„ä½œè€…æ„Ÿå…´è¶£ã€‚ç„¶è€Œï¼Œå®¡è®¡ç®¡é“è®¾å¤‡æ˜¯ç®¡ç†å‘˜å…è®¸å®æ—¶ç›‘æ§çš„ä¾¿æ·æ–¹å¼ï¼Œå¯ä»¥é¿å…å®¡è®¡è·Ÿè¸ªæ–‡ä»¶æ‰€æœ‰æƒæˆ–æ—¥å¿—è½®æ¢ä¸­æ–­äº‹ä»¶æµçš„é—®é¢˜ã€‚è¦è·Ÿè¸ªå®æ—¶å®¡è®¡äº‹ä»¶æµï¼šÙ¾By default, audit pipe device nodes are accessible only to the `root` user.  To make them accessible to the members of the `audit` group, add a `devfs` rule to [.filename]#/etc/devfs.rules#:Ù»é»˜è®¤æƒ…å†µä¸‹ï¼Œå®¡è®¡ç®¡é“è®¾å¤‡èŠ‚ç‚¹åªå¯¹ `root` ç”¨æˆ·å¯è®¿é—®ã€‚è¦ä½¿å…¶å¯¹ `audit` ç»„çš„æˆå‘˜å¯è®¿é—®ï¼Œéœ€è¦åœ¨ `/etc/devfs.rules` æ–‡ä»¶ä¸­æ·»åŠ ä¸€ä¸ª `devfs` è§„åˆ™ã€‚ÙQSee man:devfs.rules[5] for more information on configuring the devfs file system.ÙWè¯·å‚é˜… man:devfs.rules[5] ä»¥è·å–æœ‰å…³é…ç½® devfs æ–‡ä»¶ç³»ç»Ÿçš„æ›´å¤šä¿¡æ¯ã€‚ÚİIt is easy to produce audit event feedback cycles, in which the viewing of each audit event results in the generation of more audit events.  For example, if all network I/O is audited, and `praudit` is run from an SSH session, a continuous stream of audit events will be generated at a high rate, as each event being printed will generate another event.  For this reason, it is advisable to run `praudit` on an audit pipe device from sessions without fine-grained I/O auditing.Ú å¾ˆå®¹æ˜“äº§ç”Ÿå®¡è®¡äº‹ä»¶åé¦ˆå¾ªç¯ï¼Œå³æ¯ä¸ªå®¡è®¡äº‹ä»¶çš„æŸ¥çœ‹éƒ½ä¼šå¯¼è‡´æ›´å¤šçš„å®¡è®¡äº‹ä»¶ç”Ÿæˆã€‚ä¾‹å¦‚ï¼Œå¦‚æœå¯¹æ‰€æœ‰ç½‘ç»œ I/O è¿›è¡Œå®¡è®¡ï¼Œå¹¶ä¸”ä»ä¸€ä¸ª SSH ä¼šè¯ä¸­è¿è¡Œ `praudit`ï¼Œå°†ä»¥é«˜é€Ÿç”Ÿæˆè¿ç»­çš„å®¡è®¡äº‹ä»¶æµï¼Œå› ä¸ºæ¯ä¸ªè¢«æ‰“å°çš„äº‹ä»¶éƒ½ä¼šç”Ÿæˆå¦ä¸€ä¸ªäº‹ä»¶ã€‚å› æ­¤ï¼Œå»ºè®®åœ¨æ²¡æœ‰ç»†ç²’åº¦ I/O å®¡è®¡çš„ä¼šè¯ä¸­ä»å®¡è®¡ç®¡é“è®¾å¤‡ä¸Šè¿è¡Œ `praudit`ã€‚Ù*Rotating and Compressing Audit Trail FilesÙ!æ—‹è½¬å’Œå‹ç¼©å®¡è®¡æ—¥å¿—æ–‡ä»¶Ú#Audit trails are written to by the kernel and managed by the audit daemon, man:auditd[8].  Administrators should not attempt to use man:newsyslog.conf[5] or other tools to directly rotate audit logs.  Instead, `audit` should be used to shut down auditing, reconfigure the audit system, and perform log rotation.  The following command causes the audit daemon to create a new audit log and signal the kernel to switch to using the new log.  The old log will be terminated and renamed, at which point it may then be manipulated by the administrator:Ú×å®¡è®¡æ—¥å¿—ç”±å†…æ ¸ç¼–å†™ï¼Œå¹¶ç”±å®¡è®¡å®ˆæŠ¤ç¨‹åºï¼ˆman:auditd[8]ï¼‰ç®¡ç†ã€‚ç®¡ç†å‘˜ä¸åº”å°è¯•ä½¿ç”¨ man:newsyslog.conf[5] æˆ–å…¶ä»–å·¥å…·ç›´æ¥è½®è½¬å®¡è®¡æ—¥å¿—ã€‚ç›¸åï¼Œåº”ä½¿ç”¨ `audit` æ¥å…³é—­å®¡è®¡ã€é‡æ–°é…ç½®å®¡è®¡ç³»ç»Ÿå¹¶æ‰§è¡Œæ—¥å¿—è½®è½¬ã€‚ä»¥ä¸‹å‘½ä»¤ä¼šå¯¼è‡´å®¡è®¡å®ˆæŠ¤ç¨‹åºåˆ›å»ºä¸€ä¸ªæ–°çš„å®¡è®¡æ—¥å¿—ï¼Œå¹¶å‘å†…æ ¸å‘å‡ºä¿¡å·ä»¥åˆ‡æ¢åˆ°ä½¿ç”¨æ–°æ—¥å¿—ã€‚æ—§æ—¥å¿—å°†è¢«ç»ˆæ­¢å’Œé‡å‘½åï¼Œæ­¤æ—¶ç®¡ç†å‘˜å¯ä»¥å¯¹å…¶è¿›è¡Œæ“ä½œã€‚ÙhIf man:auditd[8] is not currently running, this command will fail and an error message will be produced.ÙQå¦‚æœ man:auditd[8] å½“å‰æœªè¿è¡Œï¼Œè¯¥å‘½ä»¤å°†å¤±è´¥å¹¶äº§ç”Ÿé”™è¯¯æ¶ˆæ¯ã€‚ÙfAdding the following line to [.filename]#/etc/crontab# will schedule this rotation every twelve hours:ÙZå°†ä»¥ä¸‹è¡Œæ·»åŠ åˆ° [.filename]#/etc/crontab# å°†ä¼šæ¯éš”åäºŒå°æ—¶å®‰æ’æ­¤è½®æ¢ï¼šÙDThe change will take effect once [.filename]#/etc/crontab# is saved.Ù9æ›´æ”¹å°†åœ¨ä¿å­˜ [.filename]#/etc/crontab# åç”Ÿæ•ˆã€‚ÙAutomatic rotation of the audit trail file based on file size is possible using `filesz` in [.filename]#audit_control# as described in <<audit-auditcontrol>>.Ù•æ ¹æ® <<audit-auditcontrol>> ä¸­æ‰€è¿°ï¼Œå¯ä»¥ä½¿ç”¨ `filesz` åœ¨ [.filename]#audit_control# ä¸­åŸºäºæ–‡ä»¶å¤§å°è‡ªåŠ¨æ—‹è½¬å®¡è®¡è·Ÿè¸ªæ–‡ä»¶ã€‚ÚÍAs audit trail files can become very large, it is often desirable to compress or otherwise archive trails once they have been closed by the audit daemon.  The [.filename]#audit_warn# script can be used to perform customized operations for a variety of audit-related events, including the clean termination of audit trails when they are rotated.  For example, the following may be added to [.filename]#/etc/security/audit_warn# to compress audit trails on close:Ú—ç”±äºå®¡è®¡è·Ÿè¸ªæ–‡ä»¶å¯èƒ½å˜å¾—éå¸¸å¤§ï¼Œå› æ­¤é€šå¸¸å¸Œæœ›åœ¨å®¡è®¡å®ˆæŠ¤ç¨‹åºå…³é—­å®ƒä»¬åå¯¹è·Ÿè¸ªè¿›è¡Œå‹ç¼©æˆ–å½’æ¡£ã€‚ [.filename]#audit_warn# è„šæœ¬å¯ç”¨äºæ‰§è¡Œå„ç§ä¸å®¡è®¡ç›¸å…³çš„äº‹ä»¶çš„è‡ªå®šä¹‰æ“ä½œï¼ŒåŒ…æ‹¬åœ¨è½®æ¢å®¡è®¡è·Ÿè¸ªæ—¶å¯¹å…¶è¿›è¡Œæ¸…ç†ç»ˆæ­¢ã€‚ ä¾‹å¦‚ï¼Œå¯ä»¥å°†ä»¥ä¸‹å†…å®¹æ·»åŠ åˆ° [.filename]#/etc/security/audit_warn# ä¸­ä»¥åœ¨å…³é—­æ—¶å‹ç¼©å®¡è®¡è·Ÿè¸ªï¼šÚDOther archiving activities might include copying trail files to a centralized server, deleting old trail files, or reducing the audit trail to remove unneeded records.  This script will be run only when audit trail files are cleanly terminated.  It will not be run on trails left unterminated following an improper shutdown.Úå…¶ä»–å½’æ¡£æ´»åŠ¨å¯èƒ½åŒ…æ‹¬å°†è½¨è¿¹æ–‡ä»¶å¤åˆ¶åˆ°é›†ä¸­æœåŠ¡å™¨ï¼Œåˆ é™¤æ—§çš„è½¨è¿¹æ–‡ä»¶ï¼Œæˆ–è€…å‡å°‘å®¡è®¡è½¨è¿¹ä»¥åˆ é™¤ä¸éœ€è¦çš„è®°å½•ã€‚æ­¤è„šæœ¬ä»…åœ¨å®¡è®¡è½¨è¿¹æ–‡ä»¶è¢«æ­£ç¡®ç»ˆæ­¢æ—¶è¿è¡Œã€‚å®ƒä¸ä¼šåœ¨å› ä¸æ­£ç¡®çš„å…³é—­è€Œå¯¼è‡´æœªç»ˆæ­¢çš„è½¨è¿¹ä¸Šè¿è¡Œã€‚Ù¥This chapter explains much of the FreeBSD configuration files, how to enable or disable a service, how to configure the logging system and the power management area.ÙŠæœ¬ç« ä»‹ç»äº† FreeBSD é…ç½®æ–‡ä»¶çš„è®¸å¤šå†…å®¹ï¼ŒåŒ…æ‹¬å¦‚ä½•å¯ç”¨æˆ–ç¦ç”¨æœåŠ¡ï¼Œå¦‚ä½•é…ç½®æ—¥å¿—ç³»ç»Ÿå’Œç”µæºç®¡ç†åŒºåŸŸã€‚ÙAChapter 14. Configuration, Services, Logging and Power ManagementÙ2ç¬¬ 14 ç«  é…ç½®ã€æœåŠ¡ã€æ—¥å¿—å’Œç”µæºç®¡ç†Ù5Configuration, Services, Logging and Power ManagementÙ'é…ç½®ã€æœåŠ¡ã€æ—¥å¿—å’Œç”µæºç®¡ç†ÙÕOne of the important aspects of FreeBSD is proper system configuration.  This chapter explains much of the FreeBSD configuration process, including some of the parameters which can be set to tune a FreeBSD system.Ù°FreeBSD çš„ä¸€ä¸ªé‡è¦æ–¹é¢æ˜¯æ­£ç¡®çš„ç³»ç»Ÿé…ç½®ã€‚æœ¬ç« ä»‹ç»äº† FreeBSD é…ç½®è¿‡ç¨‹çš„è®¸å¤šå†…å®¹ï¼ŒåŒ…æ‹¬ä¸€äº›å¯ä»¥è®¾ç½®çš„å‚æ•°ï¼Œç”¨äºè°ƒæ•´ FreeBSD ç³»ç»Ÿã€‚Ù@How to use the various configuration files in [.filename]#/etc#.Ù:å¦‚ä½•ä½¿ç”¨ [.filename]#/etc# ä¸­çš„å„ç§é…ç½®æ–‡ä»¶ã€‚ÙfThe basics of [.filename]#rc.conf# configuration and [.filename]#/usr/local/etc/rc.d# startup scripts.Ù^[.filename]#rc.conf# é…ç½®å’Œ [.filename]#/usr/local/etc/rc.d# å¯åŠ¨è„šæœ¬çš„åŸºç¡€çŸ¥è¯†ã€‚Ù2How to tune FreeBSD using man:sysctl[8] variables.Ù5å¦‚ä½•ä½¿ç”¨ man:sysctl[8] å˜é‡æ¥è°ƒæ•´ FreeBSDã€‚Ù1How to configure the power management in FreeBSD.Ù*å¦‚ä½•åœ¨ FreeBSD ä¸­é…ç½®ç”µæºç®¡ç†ã€‚ÙµFreeBSD maintains a clear separation between the base system and third party applications and therefore this affects where the configuration files of these applications are located.ÙFreeBSD åœ¨åŸºç¡€ç³»ç»Ÿå’Œç¬¬ä¸‰æ–¹åº”ç”¨ç¨‹åºä¹‹é—´ä¿æŒäº†æ˜ç¡®çš„åˆ†ç¦»ï¼Œå› æ­¤è¿™å½±å“äº†è¿™äº›åº”ç”¨ç¨‹åºçš„é…ç½®æ–‡ä»¶çš„ä½ç½®ã€‚ÙúFreeBSD base system configuration is located at the [.filename]#/etc# directory, and the [.filename]#/usr/local/etc# directory contains all the configuration files of the applications installed on the system through the ports collection and packages.ÙÂFreeBSD åŸºæœ¬ç³»ç»Ÿé…ç½®ä½äº .filename]#/etc# ç›®å½•ä¸‹ï¼Œè€Œ [.filename]#/usr/local/etc# ç›®å½•åŒ…å«é€šè¿‡ ports é›†åˆå’Œè½¯ä»¶åŒ…å®‰è£…åœ¨ç³»ç»Ÿä¸Šçš„æ‰€æœ‰åº”ç”¨ç¨‹åºçš„é…ç½®æ–‡ä»¶ã€‚ÙµThe kernel state configuration is located in [.filename]#/etc/sysctl.conf#.  In the section <<configtuning-sysctl>>, the operation of man:sysctl[8] will be explained in more detail.Ùå†…æ ¸çŠ¶æ€é…ç½®ä½äº [.filename]#/etc/sysctl.conf#ã€‚åœ¨ <<configtuning-sysctl>> éƒ¨åˆ†ï¼Œå°†æ›´è¯¦ç»†åœ°è§£é‡Š man:sysctl[8] çš„æ“ä½œã€‚ÙRFor more information about the FreeBSD file system structure refer to man:hier[7].ÙKæœ‰å…³ FreeBSD æ–‡ä»¶ç³»ç»Ÿç»“æ„çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜… man:hier[7]ã€‚ÙİAs a general rule, configuration files do not use a standard on what syntax they must follow.  Although it is true that the `#` character is normally used to comment a line and that each line has a configuration variable.Ù§é€šå¸¸æƒ…å†µä¸‹ï¼Œé…ç½®æ–‡ä»¶æ²¡æœ‰éµå¾ªç»Ÿä¸€çš„è¯­æ³•è§„èŒƒã€‚è™½ç„¶ä½¿ç”¨ `#` å­—ç¬¦æ¥æ³¨é‡Šä¸€è¡Œæ˜¯å¸¸è§çš„åšæ³•ï¼Œå¹¶ä¸”æ¯è¡Œéƒ½åŒ…å«ä¸€ä¸ªé…ç½®å˜é‡ã€‚ÙŠSome applications like man:pkg[8] are starting to use the link:https://github.com/vstakhov/libucl[Universal Configuration Language (UCL)].Ù{ä¸€äº›åº”ç”¨ç¨‹åºï¼Œå¦‚ man:pkg[8]ï¼Œå¼€å§‹ä½¿ç”¨ link:https://github.com/vstakhov/libucl[é€šç”¨é…ç½®è¯­è¨€ï¼ˆUCLï¼‰] ã€‚¿The [.filename]#/etc# directory¸[.filename]#/etc# ç›®å½•Ù‰The [.filename]#/etc# directory contains all of the FreeBSD base system configuration files that are responsible for configuring FreeBSD.ÙZ[.filename]#/etc# ç›®å½•åŒ…å«äº†æ‰€æœ‰è´Ÿè´£é…ç½® FreeBSD çš„åŸºæœ¬ç³»ç»Ÿé…ç½®æ–‡ä»¶ã€‚Ù˜*Extreme* caution must be taken when modifying files in the [.filename]#/etc# directory; misconfiguration could make FreeBSD unbootable or malfunction.
ÙŒåœ¨ä¿®æ”¹ [.filename]#/etc# ç›®å½•ä¸­çš„æ–‡ä»¶æ—¶ï¼Œå¿…é¡»éå¸¸å°å¿ƒï¼›é…ç½®é”™è¯¯å¯èƒ½ä¼šå¯¼è‡´ FreeBSD æ— æ³•å¯åŠ¨æˆ–å‡ºç°æ•…éšœã€‚
ÙGDefault system configuration files, see man:rc[8] for more information.ÙGé»˜è®¤çš„ç³»ç»Ÿé…ç½®æ–‡ä»¶ï¼Œè¯·å‚é˜… man:rc[8] è·å–æ›´å¤šä¿¡æ¯ã€‚ÙMman:fstab[5] contains descriptive information about the various file systems.Ù@man:fstab[5] åŒ…å«äº†å…³äºå„ç§æ–‡ä»¶ç³»ç»Ÿçš„æè¿°ä¿¡æ¯ã€‚ÙFExtra man:sendmail[8] configuration and other MTA configuration files.Ù=é¢å¤–çš„ man:sendmail[8] é…ç½®å’Œå…¶ä»– MTA é…ç½®æ–‡ä»¶ã€‚ÙBmtree configuration files, see man: mtree[8] for more information.ÙAmtree é…ç½®æ–‡ä»¶ï¼Œè¯·å‚è€ƒ man:mtree[8] äº†è§£æ›´å¤šä¿¡æ¯ã€‚ÙKConfiguration files for the Pluggable Authentication Modules (PAM) library.Ù>Pluggable Authentication Modulesï¼ˆPAMï¼‰åº“çš„é…ç½®æ–‡ä»¶ã€‚ÙkScripts that are run daily, weekly, and monthly, via man:cron[8], see man:periodic[8] for more information.Ùlé€šè¿‡ man:cron[8] æ¯å¤©ã€æ¯å‘¨å’Œæ¯æœˆè¿è¡Œçš„è„šæœ¬ï¼Œè¯·å‚é˜… man:periodic[8] è·å–æ›´å¤šä¿¡æ¯ã€‚ÙNSystem and daemon startup/control scripts, see man:rc[8] for more information.ÙWç³»ç»Ÿå’Œå®ˆæŠ¤è¿›ç¨‹çš„å¯åŠ¨/æ§åˆ¶è„šæœ¬ï¼Œè¯·å‚é˜… man:rc[8] è·å–æ›´å¤šä¿¡æ¯ã€‚ÙóContains descriptive information about the local host name, configuration details for any potential network interfaces and which services should be started up at system initial boot time. More information in <<configtuning-core-configuration>>ÙÌåŒ…å«æœ‰å…³æœ¬åœ°ä¸»æœºåç§°çš„æè¿°æ€§ä¿¡æ¯ï¼Œæ½œåœ¨ç½‘ç»œæ¥å£çš„é…ç½®ç»†èŠ‚ä»¥åŠåº”åœ¨ç³»ç»Ÿåˆå§‹å¯åŠ¨æ—¶å¯åŠ¨çš„æœåŠ¡ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§ <<configtuning-core-configuration>>ã€‚ÙIOpenBSM audit configuration files, see man:audit[8] for more information.ÙFOpenBSM å®¡è®¡é…ç½®æ–‡ä»¶ï¼Œè¯¦è§ man:audit[8] è·å–æ›´å¤šä¿¡æ¯ã€‚Ù=ppp configuration files, see man:ppp[8] for more information.Ù=ppp é…ç½®æ–‡ä»¶ï¼Œè¯·å‚è€ƒ man:ppp[8] è·å–æ›´å¤šä¿¡æ¯ã€‚ÙAOpenSSH configuration files, see man:ssh[1] for more information.Ù:OpenSSH é…ç½®æ–‡ä»¶ï¼Œæ›´å¤šä¿¡æ¯è¯·å‚è§ man:ssh[1]ã€‚¼OpenSSL configuration files.·OpenSSL é…ç½®æ–‡ä»¶ã€‚ÙMContains settings for the kernel. More information in <<configtuning-sysctl>>ÙHåŒ…å«å†…æ ¸çš„è®¾ç½®ã€‚æ›´å¤šä¿¡æ¯è¯·å‚è§ <<configtuning-sysctl>>ã€‚²The sysctl utility³sysctl å®ç”¨ç¨‹åºÙNThe man:sysctl[8] utility is used to make changes to a running FreeBSD system.ÙMman:sysctl[8] å®ç”¨ç¨‹åºç”¨äºå¯¹è¿è¡Œä¸­çš„ FreeBSD ç³»ç»Ÿè¿›è¡Œæ›´æ”¹ã€‚ÚThe man:sysctl[8] utility retrieves kernel state and allows processes with appropriate privilege to set kernel state.  The state to be retrieved or set is described using a "Management Information Base" ("MIB") style name, described as a dotted set of components.Ú%man:sysctl[8] å®ç”¨ç¨‹åºç”¨äºæ£€ç´¢å†…æ ¸çŠ¶æ€ï¼Œå¹¶å…è®¸å…·æœ‰é€‚å½“ç‰¹æƒçš„è¿›ç¨‹è®¾ç½®å†…æ ¸çŠ¶æ€ã€‚è¦æ£€ç´¢æˆ–è®¾ç½®çš„çŠ¶æ€ä½¿ç”¨â€œç®¡ç†ä¿¡æ¯åº“ï¼ˆManagement Information Baseï¼‰â€ï¼ˆâ€œMIBâ€ï¼‰æ ·å¼çš„åç§°è¿›è¡Œæè¿°ï¼Œè¯¥åç§°è¢«æè¿°ä¸ºä¸€ç»„ç”±ç‚¹åˆ†éš”çš„ç»„ä»¶ã€‚»Management Information Base¯ç®¡ç†ä¿¡æ¯åº“¦sysctlÚ{sysctl æ˜¯ä¸€ä¸ªç”¨äºç®¡ç†å’Œé…ç½® Linux å†…æ ¸å‚æ•°çš„å‘½ä»¤è¡Œå·¥å…·ã€‚å®ƒå…è®¸ç”¨æˆ·æŸ¥çœ‹å’Œä¿®æ”¹å†…æ ¸çš„è¿è¡Œæ—¶å‚æ•°ï¼Œä»¥åŠæ§åˆ¶ç³»ç»Ÿçš„è¡Œä¸ºã€‚é€šè¿‡ sysctl å‘½ä»¤ï¼Œç”¨æˆ·å¯ä»¥æŸ¥è¯¢å’Œä¿®æ”¹å„ç§ç³»ç»Ÿè®¾ç½®ï¼Œå¦‚ç½‘ç»œé…ç½®ã€æ–‡ä»¶ç³»ç»Ÿå‚æ•°ã€å†…å­˜ç®¡ç†ç­‰ã€‚è¿™ä¸ªå·¥å…·åœ¨è°ƒä¼˜ç³»ç»Ÿæ€§èƒ½ã€è§£å†³é—®é¢˜å’Œè¿›è¡Œç³»ç»Ÿç®¡ç†æ—¶éå¸¸æœ‰ç”¨ã€‚¯"Magic" numbers®"é­”æœ¯"æ•°å­—½Kernel functions and featuresµå†…æ ¸åŠŸèƒ½å’Œç‰¹æ€§®virtual memory¬è™šæ‹Ÿå†…å­˜ªFilesystem¬æ–‡ä»¶ç³»ç»Ÿ´Debugging parameters¬è°ƒè¯•å‚æ•°¨Hardware¦ç¡¬ä»¶±Machine dependent¬æœºå™¨ä¾èµ–¨Userland¬ç”¨æˆ·ç©ºé—´ÙWAt its core, man:sysctl[8] serves two functions: to read and to modify system settings.ÙMåœ¨å…¶æ ¸å¿ƒï¼Œman:sysctl[8] æœ‰ä¸¤ä¸ªåŠŸèƒ½ï¼šè¯»å–å’Œä¿®æ”¹ç³»ç»Ÿè®¾ç½®ã€‚¿To view all readable variables:Ù!æŸ¥çœ‹æ‰€æœ‰å¯è¯»å–çš„å˜é‡ï¼šÙ0To read a particular variable, specify its name:Ù0è¦è¯»å–ç‰¹å®šçš„å˜é‡ï¼Œè¯·æŒ‡å®šå…¶åç§°ï¼šÙzThe Management Information Base (MIB) is hierarchical and hence, specifying a prefix prints all the nodes hanging from it:Ùrç®¡ç†ä¿¡æ¯åº“ï¼ˆMIBï¼‰æ˜¯åˆ†å±‚çš„ï¼Œå› æ­¤ï¼ŒæŒ‡å®šä¸€ä¸ªå‰ç¼€å°†æ‰“å°å‡ºæ‰€æœ‰æŒ‚åœ¨è¯¥å‰ç¼€ä¸‹çš„èŠ‚ç‚¹ï¼šÙ@To set a particular variable, use the _variable_=_value_ syntax:ÙDè¦è®¾ç½®ç‰¹å®šçš„å˜é‡ï¼Œè¯·ä½¿ç”¨ _variable_=_value_ çš„è¯­æ³•ï¼šÙTo keep the configuration after a reboot it is necessary to add these variables to the [.filename]#/etc/sysctl.conf# file as explained below.Ùä¸ºäº†åœ¨é‡å¯åä¿ç•™é…ç½®ï¼Œéœ€è¦æŒ‰ç…§ä¸‹é¢çš„è¯´æ˜å°†è¿™äº›å˜é‡æ·»åŠ åˆ° [.filename]#/etc/sysctl.conf# æ–‡ä»¶ä¸­ã€‚Ù&The [.filename]#/etc/sysctl.conf# fileÙ$[.filename]#/etc/sysctl.conf# æ–‡ä»¶ÙsThe configuration file for man:sysctl[8], [.filename]#/etc/sysctl.conf#, looks much like [.filename]#/etc/rc.conf#.Ùmman:sysctl[8] çš„é…ç½®æ–‡ä»¶ï¼Œ[.filename]#/etc/sysctl.conf# ï¼Œçœ‹èµ·æ¥å¾ˆåƒ [.filename]#/etc/rc.conf#ã€‚Ù/Values are set using a `variable=value` syntax.Ù-ä½¿ç”¨ `variable=value` è¯­æ³•æ¥è®¾ç½®å€¼ã€‚ÙvThe specified values are set after the system goes into multi-user mode.  Not all variables are settable in this mode.Ùlç³»ç»Ÿè¿›å…¥å¤šç”¨æˆ·æ¨¡å¼åï¼Œè®¾ç½®äº†æŒ‡å®šçš„å€¼ã€‚å¹¶éæ‰€æœ‰å˜é‡éƒ½å¯ä»¥åœ¨æ­¤æ¨¡å¼ä¸‹è®¾ç½®ã€‚ÙºFor example, to turn off logging of fatal signal exits and prevent users from seeing processes started by other users, the following tunables can be set in [.filename]#/etc/sysctl.conf#:Ù«ä¾‹å¦‚ï¼Œè¦å…³é—­è‡´å‘½ä¿¡å·é€€å‡ºçš„æ—¥å¿—è®°å½•å¹¶é˜²æ­¢ç”¨æˆ·çœ‹åˆ°å…¶ä»–ç”¨æˆ·å¯åŠ¨çš„è¿›ç¨‹ï¼Œå¯ä»¥åœ¨[.filename]#/etc/sysctl.conf# ä¸­è®¾ç½®ä»¥ä¸‹å¯è°ƒæ•´é¡¹ï¼šÙnTo obtain more information about what function a particular sysctl has, the following command can be executed:ÙPè¦è·å–å…³äºç‰¹å®š sysctl å‡½æ•°çš„æ›´å¤šä¿¡æ¯ï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼šÙ&Managing System-Specific Configuration¸ç®¡ç†ç³»ç»Ÿç‰¹å®šé…ç½®ÙYThe principal location for system configuration information is [.filename]#/etc/rc.conf#.ÙAç³»ç»Ÿé…ç½®ä¿¡æ¯çš„ä¸»è¦ä½ç½®æ˜¯ [.filename]#/etc/rc.conf#ã€‚ÙÁThis file contains a wide range of configuration information and it is read at system startup to configure the system.  It provides the configuration information for the [.filename]#rc*# files.Ù‡è¯¥æ–‡ä»¶åŒ…å«äº†å„ç§é…ç½®ä¿¡æ¯ï¼Œå¹¶åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶è¯»å–ä»¥é…ç½®ç³»ç»Ÿã€‚å®ƒä¸º [.filename]#rc*# æ–‡ä»¶æä¾›é…ç½®ä¿¡æ¯ã€‚ÙmThe entries in [.filename]#/etc/rc.conf# override the default settings in [.filename]#/etc/defaults/rc.conf#.Ùh[.filename]#/etc/rc.conf# ä¸­çš„æ¡ç›®ä¼šè¦†ç›– [.filename]#/etc/defaults/rc.conf# ä¸­çš„é»˜è®¤è®¾ç½®ã€‚Ù´The file [.filename]#/etc/defaults/rc.conf# containing the default settings should not be edited.  Instead, all system-specific changes should be made to [.filename]#/etc/rc.conf#.Ù¥ä¸åº”ç¼–è¾‘åŒ…å«é»˜è®¤è®¾ç½®çš„æ–‡ä»¶ [.filename]#/etc/defaults/rc.conf# ã€‚ç›¸åï¼Œæ‰€æœ‰ç‰¹å®šäºç³»ç»Ÿçš„æ›´æ”¹åº”è¯¥åœ¨ [.filename]#/etc/rc.conf# ä¸­è¿›è¡Œã€‚Ù²A number of strategies may be applied in clustered applications to separate site-wide configuration from system-specific configuration in order to reduce administration overhead.Ùåœ¨é›†ç¾¤åº”ç”¨ä¸­ï¼Œå¯ä»¥é‡‡ç”¨å¤šç§ç­–ç•¥æ¥å°†æ•´ä¸ªç«™ç‚¹çš„é…ç½®ä¸ç³»ç»Ÿç‰¹å®šçš„é…ç½®åˆ†ç¦»ï¼Œä»¥å‡å°‘ç®¡ç†å¼€é”€ã€‚ÙhThe recommended approach is to place system-specific configuration into [.filename]#/etc/rc.conf.local#.Ù`æ¨èçš„æ–¹æ³•æ˜¯å°†ç³»ç»Ÿç‰¹å®šçš„é…ç½®æ”¾ç½®åœ¨ [.filename]#/etc/rc.conf.local# æ–‡ä»¶ä¸­ã€‚ÙMFor example, these entries in [.filename]#/etc/rc.conf# apply to all systems:ÙKä¾‹å¦‚ï¼Œè¿™äº›æ¡ç›®åœ¨ [.filename]#/etc/rc.conf# é€‚ç”¨äºæ‰€æœ‰ç³»ç»Ÿï¼šÙSWhereas these entries in [.filename]#/etc/rc.conf.local# apply to this system only:ÙTè€Œè¿™äº›æ¡ç›®åœ¨ [.filename]#/etc/rc.conf.local# æ–‡ä»¶ä¸­ä»…é€‚ç”¨äºæ­¤ç³»ç»Ÿï¼šÙ˜Distribute [.filename]#/etc/rc.conf# to every system using an application such as rsync or puppet, while [.filename]#/etc/rc.conf.local# remains unique.Ù¢ä½¿ç”¨è¯¸å¦‚ rsync æˆ– puppet çš„åº”ç”¨ç¨‹åºï¼Œå°† [.filename]#/etc/rc.conf# åˆ†å‘åˆ°æ¯ä¸ªç³»ç»Ÿï¼ŒåŒæ—¶ä¿æŒ [.filename]#/etc/rc.conf.local# çš„å”¯ä¸€æ€§ã€‚ÙxUpgrading the system will not overwrite [.filename]#/etc/rc.conf#, so system configuration information will not be lost.Ùcå‡çº§ç³»ç»Ÿä¸ä¼šè¦†ç›– [.filename]#/etc/rc.conf# æ–‡ä»¶ï¼Œå› æ­¤ç³»ç»Ÿé…ç½®ä¿¡æ¯ä¸ä¼šä¸¢å¤±ã€‚ÙäBoth [.filename]#/etc/rc.conf# and [.filename]#/etc/rc.conf.local# are parsed by man:sh[1].  This allows system operators to create complex configuration scenarios.  Refer to man:rc.conf[5] for further information on this topic.ÙĞ[.filename]#/etc/rc.conf# å’Œ [.filename]#/etc/rc.conf.local# éƒ½ç”± man:sh[1] è§£æã€‚è¿™ä½¿å¾—ç³»ç»Ÿæ“ä½œå‘˜èƒ½å¤Ÿåˆ›å»ºå¤æ‚çš„é…ç½®åœºæ™¯ã€‚æœ‰å…³æ­¤ä¸»é¢˜çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜… man:rc.conf[5]ã€‚¼Managing Services in FreeBSD»åœ¨ FreeBSD ä¸­ç®¡ç†æœåŠ¡ÙlFreeBSD uses the man:rc[8] system of startup scripts during system initialization and for managing services.Ù[FreeBSD åœ¨ç³»ç»Ÿåˆå§‹åŒ–å’ŒæœåŠ¡ç®¡ç†è¿‡ç¨‹ä¸­ä½¿ç”¨ man:rc[8] ç³»ç»Ÿçš„å¯åŠ¨è„šæœ¬ã€‚ÙThe scripts listed in [.filename]#/etc/rc.d# provide basic services which can be controlled with the `start`, `stop`, and `restart` options to man:service[8].Ùš[.filename]#/etc/rc.d# ä¸­åˆ—å‡ºçš„è„šæœ¬æä¾›åŸºæœ¬æœåŠ¡ï¼Œå¯ä»¥é€šè¿‡ `start`ã€`stop` å’Œ `restart`é€‰é¡¹æ¥æ§åˆ¶ï¼Œä½¿ç”¨ man:service[8] å‘½ä»¤ã€‚Ù1A basic script may look similar to the following:Ù3ä¸€ä¸ªåŸºæœ¬çš„è„šæœ¬å¯èƒ½ç±»ä¼¼äºä»¥ä¸‹å†…å®¹ï¼šÙhRefer to extref:{rc-scripting}[this article] for instructions on how to create custom man:rc[8] scripts.Ùkè¯·å‚è€ƒ extref:{rc-scripting}[è¿™ç¯‡æ–‡ç« ]ï¼Œäº†è§£å¦‚ä½•åˆ›å»ºè‡ªå®šä¹‰çš„ man:rc[8] è„šæœ¬çš„æŒ‡å—ã€‚±Starting Services¬å¯åŠ¨æœåŠ¡Ù™Many users install third party software on FreeBSD from the Ports Collection and require the installed services to be started upon system initialization.Ùè®¸å¤šç”¨æˆ·åœ¨ FreeBSD ä¸Šä» Ports Collection å®‰è£…ç¬¬ä¸‰æ–¹è½¯ä»¶ï¼Œå¹¶è¦æ±‚åœ¨ç³»ç»Ÿåˆå§‹åŒ–æ—¶å¯åŠ¨å·²å®‰è£…çš„æœåŠ¡ã€‚ÙñServices, such as package:security/openssh-portable[] or package:www/nginx[] are just two of the many software packages which may be started during system initialization.  This section explains the procedures available for starting services.ÙÓæœåŠ¡ï¼Œä¾‹å¦‚ package:security/openssh-portable[] æˆ– package:www/nginx[] åªæ˜¯è®¸å¤šè½¯ä»¶åŒ…ä¸­çš„ä¸¤ä¸ªï¼Œè¿™äº›è½¯ä»¶åŒ…å¯èƒ½åœ¨ç³»ç»Ÿåˆå§‹åŒ–æœŸé—´å¯åŠ¨ã€‚æœ¬èŠ‚ä»‹ç»äº†å¯åŠ¨æœåŠ¡çš„å¯ç”¨ç¨‹åºã€‚Ù÷Since the man:rc[8] system is primarily intended to start and stop services at system startup and shutdown time, the `start`, `stop` and `restart` options will only perform their action if the appropriate [.filename]#/etc/rc.conf# variable is set.ÙÛç”±äº man:rc[8] ç³»ç»Ÿä¸»è¦ç”¨äºåœ¨ç³»ç»Ÿå¯åŠ¨å’Œå…³é—­æ—¶å¯åŠ¨å’Œåœæ­¢æœåŠ¡ï¼Œå› æ­¤åªæœ‰åœ¨è®¾ç½®äº†é€‚å½“çš„ [.filename]#/etc/rc.conf# å˜é‡æ—¶ï¼Œ`start`ã€`stop` å’Œ `restart` é€‰é¡¹æ‰ä¼šæ‰§è¡Œå…¶æ“ä½œã€‚Ù˜So the first step to start a service, like for example package:www/nginx[] is to add it to [.filename]#/etc/rc.conf# by executing the following command:ÙŒå› æ­¤ï¼Œå¯åŠ¨æœåŠ¡çš„ç¬¬ä¸€æ­¥ï¼Œä¾‹å¦‚ package:www/nginx[]ï¼Œæ˜¯é€šè¿‡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å°†å…¶æ·»åŠ åˆ° [.filename]#/etc/rc.conf# ä¸­ï¼šÙ:Then nginx can be started executing the following command:Ù1ç„¶åå¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ¥å¯åŠ¨ nginx ï¼šÚTo `start`, `stop` or `restart` a service regardless of the settings in [.filename]#/etc/rc.conf#, these commands should be prefixed with "one".  For instance, to start package:www/nginx[] regardless of the current [.filename]#/etc/rc.conf# setting, execute the following command:Úæ— è®º [.filename]#/etc/rc.conf# ä¸­çš„è®¾ç½®å¦‚ä½•ï¼Œè¦å¯åŠ¨ã€åœæ­¢æˆ–é‡æ–°å¯åŠ¨æœåŠ¡ï¼Œè¿™äº›å‘½ä»¤éƒ½åº”ä»¥â€œoneâ€ä¸ºå‰ç¼€ã€‚ä¾‹å¦‚ï¼Œè¦å¯åŠ¨ package:www/nginx[]ï¼Œæ— è®ºå½“å‰ [.filename]#/etc/rc.conf# çš„è®¾ç½®å¦‚ä½•ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š³Status of a Service¯æœåŠ¡çš„çŠ¶æ€ÙBTo determine if a service is running, use the `status` subcommand.ÙCè¦ç¡®å®šæœåŠ¡æ˜¯å¦æ­£åœ¨è¿è¡Œï¼Œè¯·ä½¿ç”¨ `status` å­å‘½ä»¤ã€‚Ù;For example, to verify that package:www/nginx[] is running:Ù<ä¾‹å¦‚ï¼Œè¦éªŒè¯ package:www/nginx[] æ˜¯å¦æ­£åœ¨è¿è¡Œï¼š°Reload a Service²é‡æ–°åŠ è½½æœåŠ¡ÙªIn some cases, it is also possible to `reload` a service.  This attempts to send a signal to an individual service, forcing the service to reload its configuration files.Ù±åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä¹Ÿå¯ä»¥â€œé‡æ–°åŠ è½½ï¼ˆreloadï¼‰â€ä¸€ä¸ªæœåŠ¡ã€‚è¿™å°†å°è¯•å‘ä¸€ä¸ªå•ç‹¬çš„æœåŠ¡å‘é€ä¸€ä¸ªä¿¡å·ï¼Œå¼ºåˆ¶è¯¥æœåŠ¡é‡æ–°åŠ è½½å…¶é…ç½®æ–‡ä»¶ã€‚Ù@In most cases, this means sending the service a `SIGHUP` signal.ÙLåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œè¿™æ„å‘³ç€å‘æœåŠ¡å‘é€ä¸€ä¸ª `SIGHUP` ä¿¡å·ã€‚Ù)*Not all services support this feature.*
Ù**å¹¶éæ‰€æœ‰æœåŠ¡éƒ½æ”¯æŒæ­¤åŠŸèƒ½ã€‚*
ÙŞThe man:rc[8] system is used for network services and it also contributes to most of the system initialization.  For instance, when the [.filename]#/etc/rc.d/bgfsck# script is executed, it prints out the following message:Ù¶man:rc[8] ç³»ç»Ÿç”¨äºç½‘ç»œæœåŠ¡ï¼Œå¹¶ä¸”å®ƒè¿˜è´¡çŒ®äº†å¤§éƒ¨åˆ†ç³»ç»Ÿåˆå§‹åŒ–å·¥ä½œã€‚ä¾‹å¦‚ï¼Œå½“æ‰§è¡Œ [.filename]#/etc/rc.d/bgfsck# è„šæœ¬æ—¶ï¼Œå®ƒä¼šæ‰“å°å‡ºä»¥ä¸‹æ¶ˆæ¯ï¼šÙeThis script is used for background file system checks, which occur only during system initialization.ÙNè¯¥è„šæœ¬ç”¨äºåå°æ–‡ä»¶ç³»ç»Ÿæ£€æŸ¥ï¼Œä»…åœ¨ç³»ç»Ÿåˆå§‹åŒ–æœŸé—´è¿›è¡Œã€‚Ù¾Many system services depend on other services to function properly.  For example, man:yp[8] and other RPC-based services may fail to start until after the man:rpcbind[8] service has started.Ù è®¸å¤šç³»ç»ŸæœåŠ¡ä¾èµ–å…¶ä»–æœåŠ¡çš„æ­£å¸¸è¿è¡Œã€‚ä¾‹å¦‚ï¼Œman:yp[8] å’Œå…¶ä»–åŸºäº RPC çš„æœåŠ¡å¯èƒ½åœ¨ man:rpcbind[8] æœåŠ¡å¯åŠ¨ä¹‹å‰æ— æ³•å¯åŠ¨ã€‚ÙDAdditional information can be found in man:rc[8] and man:rc.subr[8].ÙBå¯ä»¥åœ¨ man:rc[8] å’Œ man:rc.subr[8] ä¸­æ‰¾åˆ°æ›´å¤šçš„ä¿¡æ¯ã€‚Ù Using Services to Start Services¸ä½¿ç”¨æœåŠ¡å¯åŠ¨æœåŠ¡ÙÁOther services can be started using man:inetd[8].  Working with man:inetd[8] and its configuration is described in depth in crossref:network-servers[network-inetd,â€œThe inetd Super-Serverâ€].Ù·å…¶ä»–æœåŠ¡å¯ä»¥ä½¿ç”¨ man:inetd[8] å¯åŠ¨ã€‚æœ‰å…³ä½¿ç”¨ man:inetd[8] åŠå…¶é…ç½®çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… crossref:network-servers[network-inetd,â€œinetd è¶…çº§æœåŠ¡å™¨â€]ã€‚ÚIn some cases, it may make more sense to use man:cron[8] to start system services.  This approach has a number of advantages as man:cron[8] runs these processes as the owner of the man:crontab[5].  This allows regular users to start and maintain their own applications.Ùüåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä½¿ç”¨ man:cron[8] æ¥å¯åŠ¨ç³»ç»ŸæœåŠ¡å¯èƒ½æ›´åˆç†ã€‚è¿™ç§æ–¹æ³•æœ‰è®¸å¤šä¼˜ç‚¹ï¼Œå› ä¸º man:cron[8] ä»¥ man:crontab[5] çš„æ‰€æœ‰è€…èº«ä»½è¿è¡Œè¿™äº›è¿›ç¨‹ã€‚è¿™ä½¿å¾—æ™®é€šç”¨æˆ·å¯ä»¥å¯åŠ¨å’Œç»´æŠ¤è‡ªå·±çš„åº”ç”¨ç¨‹åºã€‚ÙµThe `@reboot` feature of man:cron[8], may be used in place of the time specification.  This causes the job to run when man:cron[8] is started, normally during system initialization.Ù«`@reboot` åŠŸèƒ½æ˜¯ man:cron[8] çš„ä¸€ä¸ªç‰¹æ€§ï¼Œå¯ä»¥ç”¨æ¥æ›¿ä»£æ—¶é—´è§„èŒƒã€‚è¿™å°†å¯¼è‡´ä½œä¸šåœ¨ man:cron[8] å¯åŠ¨æ—¶è¿è¡Œï¼Œé€šå¸¸æ˜¯åœ¨ç³»ç»Ÿåˆå§‹åŒ–æœŸé—´ã€‚±Cron and Periodic·Cron å’Œå‘¨æœŸæ€§ä»»åŠ¡ÙScheduling tasks to run at a certain day or time is a very common task on FreeBSD.  The tool in charge of performing this task is man:cron[8].Ù“åœ¨ FreeBSD ä¸Šï¼Œå®‰æ’ä»»åŠ¡åœ¨ç‰¹å®šçš„æ—¥æœŸæˆ–æ—¶é—´è¿è¡Œæ˜¯ä¸€é¡¹éå¸¸å¸¸è§çš„ä»»åŠ¡ã€‚è´Ÿè´£æ‰§è¡Œè¿™é¡¹ä»»åŠ¡çš„å·¥å…·æ˜¯ man:cron[8]ã€‚ÙIn addition to tasks that can be scheduled by the user via man:cron[8], FreeBSD performs routine background tasks managed by man:periodic[8].Ù†é™¤äº†ç”¨æˆ·å¯ä»¥é€šè¿‡ man:cron[8] è¿›è¡Œè°ƒåº¦çš„ä»»åŠ¡ä¹‹å¤–ï¼ŒFreeBSD è¿˜æ‰§è¡Œç”± man:periodic[8] ç®¡ç†çš„å¸¸è§„åå°ä»»åŠ¡ã€‚ÙµThe man:cron[8] utility runs in the background and regularly checks [.filename]#/etc/crontab# for tasks to execute and searches [.filename]#/var/cron/tabs# for custom crontab files.Ù¶man:cron[8] å®ç”¨ç¨‹åºåœ¨åå°è¿è¡Œï¼Œå¹¶å®šæœŸæ£€æŸ¥ [.filename]#/etc/crontab# ä¸­çš„ä»»åŠ¡ä»¥æ‰§è¡Œï¼Œå¹¶åœ¨ [.filename]#/var/cron/tabs# ä¸­æœç´¢è‡ªå®šä¹‰çš„ crontab æ–‡ä»¶ã€‚ÙNThese files are used to schedule tasks which cron runs at the specified times.ÙPè¿™äº›æ–‡ä»¶ç”¨äºå®‰æ’ä»»åŠ¡ï¼Œcron ä¼šåœ¨æŒ‡å®šçš„æ—¶é—´è¿è¡Œè¿™äº›ä»»åŠ¡ã€‚ÙKEach entry in a crontab defines a task to run and is known as a _cron job_.ÙXcrontab ä¸­çš„æ¯ä¸ªæ¡ç›®å®šä¹‰äº†ä¸€ä¸ªè¦è¿è¡Œçš„ä»»åŠ¡ï¼Œè¢«ç§°ä¸º _cron ä½œä¸š_ã€‚ÚÿTwo different types of configuration files are used: the system crontab, which should not be modified, and user crontabs, which can be created and edited as needed.  The format used by these files is documented in man:crontab[5].  The format of the system crontab, [.filename]#/etc/crontab# includes a `who` column which does not exist in user crontabs.  In the system crontab, cron runs the command as the user specified in this column.  In a user crontab, all commands run as the user who created the crontab.Úøä½¿ç”¨äº†ä¸¤ç§ä¸åŒç±»å‹çš„é…ç½®æ–‡ä»¶ï¼šç³»ç»Ÿ crontab å’Œç”¨æˆ· crontabã€‚ç³»ç»Ÿ crontab ä¸åº”è¯¥è¢«ä¿®æ”¹ï¼Œè€Œç”¨æˆ· crontab å¯ä»¥æ ¹æ®éœ€è¦åˆ›å»ºå’Œç¼–è¾‘ã€‚è¿™äº›æ–‡ä»¶ä½¿ç”¨çš„æ ¼å¼åœ¨ man:crontab[5] ä¸­æœ‰æ–‡æ¡£è®°å½•ã€‚ç³»ç»Ÿ crontab çš„æ ¼å¼ï¼ˆ.filename]#/etc/crontab#ï¼‰åŒ…æ‹¬ä¸€ä¸ª `who` åˆ—ï¼Œåœ¨ç”¨æˆ· crontab ä¸­ä¸å­˜åœ¨ã€‚åœ¨ç³»ç»Ÿ crontab ä¸­ï¼Œcron æ ¹æ®è¯¥åˆ—ä¸­æŒ‡å®šçš„ç”¨æˆ·è¿è¡Œå‘½ä»¤ã€‚åœ¨ç”¨æˆ· crontab ä¸­ï¼Œæ‰€æœ‰å‘½ä»¤éƒ½ä»¥åˆ›å»º crontab çš„ç”¨æˆ·èº«ä»½è¿è¡Œã€‚ÙÖUser crontabs allow individual users to schedule their own tasks.  The `root` user can also have a user [.filename]#crontab# which can be used to schedule tasks that do not exist in the system [.filename]#crontab#.Ùšç”¨æˆ·çš„ crontab å…è®¸ä¸ªåˆ«ç”¨æˆ·å®‰æ’è‡ªå·±çš„ä»»åŠ¡ã€‚`root` ç”¨æˆ·ä¹Ÿå¯ä»¥æ‹¥æœ‰ä¸€ä¸ªç”¨æˆ· crontab ï¼Œç”¨äºå®‰æ’ç³»ç»Ÿä¸­ä¸å­˜åœ¨çš„ä»»åŠ¡ã€‚ÙJHere is a sample entry from the system crontab, [.filename]#/etc/crontab#:ÙGè¿™æ˜¯ç³»ç»Ÿ crontab çš„ä¸€ä¸ªç¤ºä¾‹æ¡ç›®ï¼Œ[.filename]#/etc/crontab#:Ú;<.> Lines that begin with the `+#+` character are comments. A comment can be placed in the file as a reminder of what and why a desired action is performed. Comments cannot be on the same line as a command or else they will be interpreted as part of the command; they must be on a new line. Blank lines are ignored.Ú
<.> ä»¥ `+#+` å­—ç¬¦å¼€å¤´çš„è¡Œæ˜¯æ³¨é‡Šã€‚æ³¨é‡Šå¯ä»¥æ”¾åœ¨æ–‡ä»¶ä¸­ä½œä¸ºå¯¹æ‰€æ‰§è¡Œçš„æ“ä½œçš„å†…å®¹å’ŒåŸå› çš„æé†’ã€‚æ³¨é‡Šä¸èƒ½ä¸å‘½ä»¤åœ¨åŒä¸€è¡Œï¼Œå¦åˆ™å®ƒä»¬å°†è¢«è§£é‡Šä¸ºå‘½ä»¤çš„ä¸€éƒ¨åˆ†ï¼›å®ƒä»¬å¿…é¡»åœ¨æ–°çš„ä¸€è¡Œä¸Šã€‚ç©ºè¡Œä¼šè¢«å¿½ç•¥ã€‚Ú"<.> The equals (`=`) character is used to define any environment settings. In this example, it is used to define the `SHELL` and `PATH`. If the `SHELL` is omitted, cron will use the default Bourne shell. If the `PATH` is omitted, the full path must be given to the command or script to run.Ú<.> ç­‰å·ï¼ˆ`=`ï¼‰å­—ç¬¦ç”¨äºå®šä¹‰ä»»ä½•ç¯å¢ƒè®¾ç½®ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå®ƒè¢«ç”¨æ¥å®šä¹‰ `SHELL` å’Œ `PATH`ã€‚å¦‚æœçœç•¥äº† `SHELL`ï¼Œ cron å°†ä½¿ç”¨é»˜è®¤çš„ Bourne shellã€‚å¦‚æœçœç•¥äº† `PATH`ï¼Œåˆ™å¿…é¡»æä¾›è¦è¿è¡Œçš„å‘½ä»¤æˆ–è„šæœ¬çš„å®Œæ•´è·¯å¾„ã€‚Ú†<.> This line defines the seven fields used in a system crontab: `minute`, `hour`, `mday`, `month`, `wday`, `who`, and `command`. The `minute` field is the time in minutes when the specified command will be run, the `hour` is the hour when the specified command will be run, the `mday` is the day of the month, `month` is the month, and `wday` is the day of the week. These fields must be numeric values, representing the twenty-four hour clock, or a `*`, representing all values for that field. The `who` field only exists in the system crontab and specifies which user the command should be run as. The last field is the command to be executed.Ú·<.> è¿™è¡Œå®šä¹‰äº†ç³»ç»Ÿ crontab ä¸­ä½¿ç”¨çš„ä¸ƒä¸ªå­—æ®µï¼š`minute`ï¼ˆåˆ†é’Ÿï¼‰ã€`hour`ï¼ˆå°æ—¶ï¼‰ã€`mday`ï¼ˆæœˆä¸­çš„æŸä¸€å¤©ï¼‰ã€`month`ï¼ˆæœˆä»½ï¼‰ã€`wday`ï¼ˆæ˜ŸæœŸå‡ ï¼‰ã€`who`ï¼ˆç”¨æˆ·ï¼‰å’Œ `command`ï¼ˆå‘½ä»¤ï¼‰ã€‚`minute` å­—æ®µè¡¨ç¤ºæŒ‡å®šå‘½ä»¤å°†è¿è¡Œçš„åˆ†é’Ÿæ•°ï¼Œ`hour` å­—æ®µè¡¨ç¤ºæŒ‡å®šå‘½ä»¤å°†è¿è¡Œçš„å°æ—¶æ•°ï¼Œ`mday` å­—æ®µè¡¨ç¤ºæœˆä»½ä¸­çš„æŸä¸€å¤©ï¼Œ`month` å­—æ®µè¡¨ç¤ºæœˆä»½ï¼Œ`wday` å­—æ®µè¡¨ç¤ºæ˜ŸæœŸå‡ ã€‚è¿™äº›å­—æ®µå¿…é¡»æ˜¯æ•°å­—å€¼ï¼Œè¡¨ç¤º 24 å°æ—¶åˆ¶çš„æ—¶é—´ï¼Œæˆ–è€…æ˜¯ `*`ï¼Œè¡¨ç¤ºè¯¥å­—æ®µçš„æ‰€æœ‰å€¼ã€‚`who` å­—æ®µä»…å­˜åœ¨äºç³»ç»Ÿ crontab ä¸­ï¼Œç”¨äºæŒ‡å®šå‘½ä»¤åº”è¯¥ä»¥å“ªä¸ªç”¨æˆ·èº«ä»½è¿è¡Œã€‚æœ€åä¸€ä¸ªå­—æ®µæ˜¯è¦æ‰§è¡Œçš„å‘½ä»¤ã€‚Ú£<.> This entry defines the values for this cron job. The `\*/11`, followed by several more `*` characters, specifies that `/usr/libexec/save-entropy` is invoked by `operator` every eleven minutes of every hour, of every day and day of the week, of every month. Commands can include any number of switches. However, commands which extend to multiple lines need to be broken with the backslash "\" continuation character.Úh<.> æ­¤æ¡ç›®å®šä¹‰äº†æ­¤ cron ä½œä¸šçš„å€¼ã€‚`\*/11` åé¢è·Ÿç€å‡ ä¸ª `*` å­—ç¬¦ï¼ŒæŒ‡å®šäº† `/usr/libexec/save-entropy` åœ¨æ¯å°æ—¶çš„æ¯åä¸€åˆ†é’Ÿï¼Œæ¯å¤©çš„æ¯å°æ—¶ï¼Œæ¯å‘¨çš„æ¯å¤©ï¼Œæ¯æœˆçš„æ¯å¤©éƒ½ç”± `operator` è°ƒç”¨ã€‚å‘½ä»¤å¯ä»¥åŒ…å«ä»»æ„æ•°é‡çš„å¼€å…³ã€‚ç„¶è€Œï¼Œè·¨å¤šè¡Œçš„å‘½ä»¤éœ€è¦ä½¿ç”¨åæ–œæ  "\" ç»§ç»­å­—ç¬¦è¿›è¡Œåˆ†å‰²ã€‚·Creating a User Crontab¾åˆ›å»ºç”¨æˆ·çš„å®šæ—¶ä»»åŠ¡è¡¨Ù:To create a user crontab, invoke `crontab` in editor mode:Ù_è¦åˆ›å»ºä¸€ä¸ªç”¨æˆ·çš„å®šæ—¶ä»»åŠ¡è¡¨ï¼Œå¯ä»¥åœ¨ç¼–è¾‘å™¨æ¨¡å¼ä¸‹è°ƒç”¨ `crontab` å‘½ä»¤ï¼šÙÔThis will open the user's crontab using the default text editor.  The first time a user runs this command, it will open an empty file.  Once a user creates a crontab, this command will open that file for editing.ÙÓè¿™å°†ä½¿ç”¨é»˜è®¤çš„æ–‡æœ¬ç¼–è¾‘å™¨æ‰“å¼€ç”¨æˆ·çš„ crontabã€‚å½“ç”¨æˆ·ç¬¬ä¸€æ¬¡è¿è¡Œæ­¤å‘½ä»¤æ—¶ï¼Œå®ƒå°†æ‰“å¼€ä¸€ä¸ªç©ºæ–‡ä»¶ã€‚ä¸€æ—¦ç”¨æˆ·åˆ›å»ºäº†ä¸€ä¸ª crontabï¼Œæ­¤å‘½ä»¤å°†æ‰“å¼€è¯¥æ–‡ä»¶ä»¥ä¾›ç¼–è¾‘ã€‚Ù£It is useful to add these lines to the top of the crontab file in order to set the environment variables and to remember the meanings of the fields in the crontab:Ùåœ¨ crontab æ–‡ä»¶çš„é¡¶éƒ¨æ·»åŠ ä»¥ä¸‹è¡Œæ˜¯å¾ˆæœ‰ç”¨çš„ï¼Œè¿™æ ·å¯ä»¥è®¾ç½®ç¯å¢ƒå˜é‡å¹¶è®°ä½ crontab ä¸­å­—æ®µçš„å«ä¹‰ï¼šÚThen add a line for each command or script to run, specifying the time to run the command.  This example runs the specified custom Bourne shell script every day at two in the afternoon.  Since the path to the script is not specified in `PATH`, the full path to the script is given:Ùıç„¶åä¸ºæ¯ä¸ªè¦è¿è¡Œçš„å‘½ä»¤æˆ–è„šæœ¬æ·»åŠ ä¸€è¡Œï¼ŒæŒ‡å®šè¿è¡Œå‘½ä»¤çš„æ—¶é—´ã€‚æ­¤ç¤ºä¾‹åœ¨æ¯å¤©ä¸‹åˆä¸¤ç‚¹è¿è¡ŒæŒ‡å®šçš„è‡ªå®šä¹‰ Bourne shell è„šæœ¬ã€‚ç”±äºè„šæœ¬çš„è·¯å¾„æ²¡æœ‰åœ¨ `PATH` ä¸­æŒ‡å®šï¼Œå› æ­¤ç»™å‡ºäº†è„šæœ¬çš„å®Œæ•´è·¯å¾„ï¼šÙÒBefore using a custom script, make sure it is executable and test it with the limited set of environment variables set by cron.  To replicate the environment that would be used to run the above cron entry, use:Ùºåœ¨ä½¿ç”¨è‡ªå®šä¹‰è„šæœ¬ä¹‹å‰ï¼Œè¯·ç¡®ä¿å®ƒæ˜¯å¯æ‰§è¡Œçš„ï¼Œå¹¶ä½¿ç”¨ cron è®¾ç½®çš„æœ‰é™ç¯å¢ƒå˜é‡é›†è¿›è¡Œæµ‹è¯•ã€‚è¦å¤åˆ¶ç”¨äºè¿è¡Œä¸Šè¿° cron æ¡ç›®çš„ç¯å¢ƒï¼Œè¯·ä½¿ç”¨ï¼šÙÒThe environment set by cron is discussed in man:crontab[5].  Checking that scripts operate correctly in a cron environment is especially important if they include any commands that delete files using wildcards.Ù¸åœ¨ man:crontab[5] ä¸­è®¨è®ºäº†ç”± cron è®¾ç½®çš„ç¯å¢ƒã€‚å¦‚æœè„šæœ¬ä¸­åŒ…å«ä½¿ç”¨é€šé…ç¬¦åˆ é™¤æ–‡ä»¶çš„å‘½ä»¤ï¼Œé‚£ä¹ˆåœ¨ cron ç¯å¢ƒä¸­æ£€æŸ¥è„šæœ¬çš„æ­£ç¡®è¿è¡Œå°¤ä¸ºé‡è¦ã€‚ÙÜWhen finished editing the crontab, save the file.  It will automatically be installed, and cron will read the crontab and run its cron jobs at their specified times.  To list the cron jobs in a crontab, use this command:ÙÆç¼–è¾‘å®Œ crontab åï¼Œä¿å­˜æ–‡ä»¶ã€‚å®ƒå°†è‡ªåŠ¨å®‰è£…ï¼Œå¹¶ä¸” cron å°†è¯»å– crontab å¹¶åœ¨æŒ‡å®šçš„æ—¶é—´è¿è¡Œå…¶ cron ä½œä¸šã€‚è¦åˆ—å‡º crontab ä¸­çš„ cron ä½œä¸šï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼šÙ1To remove all of the cron jobs in a user crontab:Ù3è¦åˆ é™¤ç”¨æˆ· crontab ä¸­çš„æ‰€æœ‰ cron ä½œä¸šï¼šÚ FreeBSD provides a set of system management scripts to check status of various subsystems, perform security-related checks, rotate log files, etc.  These scripts are run on a periodic basis: daily. weekly, or monthly.  The management of these tasks is performed by man:periodic[8] and its configuration resides in man:periodic.conf[5].  The periodic tasks are initiated by entries in the system crontab, shown above.ÚjFreeBSD æä¾›äº†ä¸€ç»„ç³»ç»Ÿç®¡ç†è„šæœ¬ï¼Œç”¨äºæ£€æŸ¥å„ç§å­ç³»ç»Ÿçš„çŠ¶æ€ï¼Œæ‰§è¡Œä¸å®‰å…¨ç›¸å…³çš„æ£€æŸ¥ï¼Œè½®è½¬æ—¥å¿—æ–‡ä»¶ç­‰ã€‚è¿™äº›è„šæœ¬å®šæœŸè¿è¡Œï¼šæ¯å¤©ã€æ¯å‘¨æˆ–æ¯æœˆã€‚è¿™äº›ä»»åŠ¡çš„ç®¡ç†ç”± man:periodic[8] æ‰§è¡Œï¼Œå¹¶ä¸”å…¶é…ç½®å­˜å‚¨åœ¨ man:periodic.conf[5] ä¸­ã€‚å®šæœŸä»»åŠ¡ç”±ç³»ç»Ÿ crontab ä¸­çš„æ¡ç›®å¯åŠ¨ï¼Œå¦‚ä¸Šæ‰€ç¤ºã€‚Ù¨Scripts executed by man:periodic[8] are located in [.filename]#/etc/periodic/# for base utilities and in [.filename]#/usr/local/etc/periodic/# for third-party software.Ù®man:periodic[8] æ‰§è¡Œçš„è„šæœ¬ä½äºåŸºæœ¬å·¥å…·çš„ [.filename]#/etc/periodic/# ç›®å½•ä¸‹ï¼Œç¬¬ä¸‰æ–¹è½¯ä»¶çš„è„šæœ¬ä½äº [.filename]#/usr/local/etc/periodic/# ç›®å½•ä¸‹ã€‚ÙLThey are organized in 4 subdirectories, daily, weekly, monthly and security.Ùˆå®ƒä»¬è¢«ç»„ç»‡åœ¨ 4 ä¸ªå­ç›®å½•ä¸­ï¼Œåˆ†åˆ«æ˜¯ dailyï¼ˆæ¯æ—¥ï¼‰ã€weeklyï¼ˆæ¯å‘¨ï¼‰ã€monthlyï¼ˆæ¯æœˆï¼‰å’Œ securityï¼ˆå®‰å…¨ï¼‰ã€‚Ù Enable or Disable Periodic Tasks»å¯ç”¨æˆ–ç¦ç”¨å®šæœŸä»»åŠ¡Ù@FreeBSD has some scripts enabled by default to run periodically.Ù5FreeBSD é»˜è®¤å¯ç”¨äº†ä¸€äº›å®šæœŸè¿è¡Œçš„è„šæœ¬ã€‚ÙwTo enable or disable a task, the first step is to edit [.filename]#/etc/periodic.conf# executing the following command:Ùlè¦å¯ç”¨æˆ–ç¦ç”¨ä»»åŠ¡ï¼Œç¬¬ä¸€æ­¥æ˜¯ç¼–è¾‘ [.filename]#/etc/periodic.conf# æ–‡ä»¶ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼šÙaAnd then to enable, for example, `daily_status_zfs_enable` put the following content in the file:ÙSç„¶åï¼Œè¦å¯ç”¨ `daily_status_zfs_enable`ï¼Œè¯·å°†ä»¥ä¸‹å†…å®¹æ”¾å…¥æ–‡ä»¶ä¸­ï¼šÙbTo disable a task that is active by default, all that needs to be done is to change `YES` to `NO`.Ù^è¦ç¦ç”¨é»˜è®¤æƒ…å†µä¸‹å¤„äºæ´»åŠ¨çŠ¶æ€çš„ä»»åŠ¡ï¼Œåªéœ€å°† `YES` æ›´æ”¹ä¸º `NO` å³å¯ã€‚Ù(Configuring the Output of Periodic Tasks»é…ç½®å®šæœŸä»»åŠ¡çš„è¾“å‡ºÙ¢In [.filename]#/etc/periodic.conf# the variables `daily_output`, `weekly_output` and `monthly_output` specifies where to send the results of the script execution.Ùšåœ¨ [.filename]#/etc/periodic.conf# æ–‡ä»¶ä¸­ï¼Œå˜é‡ `daily_output`ã€`weekly_output` å’Œ `monthly_output` æŒ‡å®šäº†è„šæœ¬æ‰§è¡Œç»“æœçš„å‘é€ä½ç½®ã€‚ÙBy default the output of the periodic scripts are emailed to root, and therefore it is best to read root's mail or alias root to a mailbox that is monitored.Ù¢é»˜è®¤æƒ…å†µä¸‹ï¼Œå‘¨æœŸæ€§è„šæœ¬çš„è¾“å‡ºä¼šå‘é€åˆ° root çš„é‚®ç®±ï¼Œå› æ­¤æœ€å¥½é˜…è¯» root çš„é‚®ä»¶æˆ–å°† root çš„åˆ«åè®¾ç½®ä¸ºä¸€ä¸ªè¢«ç›‘æ§çš„é‚®ç®±ã€‚ÙˆTo send the results to another email or to other emails, add the email addresses separated by spaces to [.filename]#/etc/periodic.conf#:Ù™è¦å°†ç»“æœå‘é€åˆ°å¦ä¸€ä¸ªç”µå­é‚®ä»¶æˆ–å…¶ä»–ç”µå­é‚®ä»¶ï¼Œè¯·å°†ç”µå­é‚®ä»¶åœ°å€ä»¥ç©ºæ ¼åˆ†éš”æ·»åŠ åˆ° [.filename]#/etc/periodic.conf# ä¸­ï¼šÙ·To log periodic output instead of receiving it as email, add the following lines to [.filename]#/etc/periodic.conf#. man:newsyslog[8] will rotate these files at the appropriate times:ÙØè¦å°†å‘¨æœŸæ€§çš„è¾“å‡ºè®°å½•åˆ°æ—¥å¿—æ–‡ä»¶è€Œä¸æ˜¯é€šè¿‡ç”µå­é‚®ä»¶æ¥æ”¶ï¼Œå°†ä»¥ä¸‹è¡Œæ·»åŠ åˆ° [.filename]#/etc/periodic.conf# æ–‡ä»¶ä¸­ã€‚ man:newsyslog[8] ä¼šåœ¨é€‚å½“çš„æ—¶é—´å¯¹è¿™äº›æ–‡ä»¶è¿›è¡Œè½®è½¬ï¼šºConfiguring System Logging²é…ç½®ç³»ç»Ÿæ—¥å¿—ÚzGenerating and reading system logs is an important aspect of system administration.  The information in system logs can be used to detect hardware and software issues as well as application and system configuration errors.  This information also plays an important role in security auditing and incident response.  Most system daemons and applications will generate log entries.Ú2ç”Ÿæˆå’Œè¯»å–ç³»ç»Ÿæ—¥å¿—æ˜¯ç³»ç»Ÿç®¡ç†çš„é‡è¦æ–¹é¢ã€‚ç³»ç»Ÿæ—¥å¿—ä¸­çš„ä¿¡æ¯å¯ä»¥ç”¨äºæ£€æµ‹ç¡¬ä»¶å’Œè½¯ä»¶é—®é¢˜ï¼Œä»¥åŠåº”ç”¨ç¨‹åºå’Œç³»ç»Ÿé…ç½®é”™è¯¯ã€‚è¿™äº›ä¿¡æ¯åœ¨å®‰å…¨å®¡è®¡å’Œäº‹ä»¶å“åº”ä¸­ä¹Ÿèµ·ç€é‡è¦ä½œç”¨ã€‚å¤§å¤šæ•°ç³»ç»Ÿå®ˆæŠ¤è¿›ç¨‹å’Œåº”ç”¨ç¨‹åºéƒ½ä¼šç”Ÿæˆæ—¥å¿—æ¡ç›®ã€‚Ù‡FreeBSD provides a system logger, man:syslogd[8], to manage logging.  By default, syslogd is enabled and started when the system boots.Ù™FreeBSD æä¾›äº†ä¸€ä¸ªç³»ç»Ÿæ—¥å¿—è®°å½•å™¨ï¼Œman:syslogd[8]ï¼Œç”¨äºç®¡ç†æ—¥å¿—è®°å½•ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œç³»ç»Ÿå¯åŠ¨æ—¶ä¼šå¯ç”¨å’Œå¯åŠ¨ syslogdã€‚Ù—This section describes how to configure the FreeBSD system logger for both local and remote logging and how to perform log rotation and log management.Ùæœ¬èŠ‚ä»‹ç»äº†å¦‚ä½•é…ç½® FreeBSD ç³»ç»Ÿæ—¥å¿—è®°å½•å™¨ä»¥è¿›è¡Œæœ¬åœ°å’Œè¿œç¨‹æ—¥å¿—è®°å½•ï¼Œä»¥åŠå¦‚ä½•æ‰§è¡Œæ—¥å¿—è½®è½¬å’Œæ—¥å¿—ç®¡ç†ã€‚¹Configuring Local Logging¸é…ç½®æœ¬åœ°æ—¥å¿—è®°å½•Ú‹The configuration file, [.filename]#/etc/syslog.conf#, controls what syslogd does with log entries as they are received.  There are several parameters to control the handling of incoming events.  The _facility_ describes which subsystem generated the message, such as the kernel or a daemon, and the _level_ describes the severity of the event that occurred.  This makes it possible to configure if and where a log message is logged, depending on the facility and level.  It is also possible to take action depending on the application that sent the message, and in the case of remote logging, the hostname of the machine generating the logging event.Úé…ç½®æ–‡ä»¶ [.filename]#/etc/syslog.conf# æ§åˆ¶ç€ syslogd åœ¨æ¥æ”¶åˆ°æ—¥å¿—æ¡ç›®æ—¶çš„å¤„ç†æ–¹å¼ã€‚æœ‰å‡ ä¸ªå‚æ•°ç”¨äºæ§åˆ¶å¤„ç†ä¼ å…¥äº‹ä»¶çš„æ–¹å¼ã€‚_facility_ æè¿°äº†ç”Ÿæˆæ¶ˆæ¯çš„å­ç³»ç»Ÿï¼Œä¾‹å¦‚å†…æ ¸æˆ–å®ˆæŠ¤è¿›ç¨‹ï¼Œè€Œ _level_ æè¿°äº†å‘ç”Ÿäº‹ä»¶çš„ä¸¥é‡ç¨‹åº¦ã€‚è¿™ä½¿å¾—å¯ä»¥æ ¹æ® facility å’Œ level é…ç½®æ˜¯å¦ä»¥åŠåœ¨å“ªé‡Œè®°å½•æ—¥å¿—æ¶ˆæ¯ã€‚è¿˜å¯ä»¥æ ¹æ®å‘é€æ¶ˆæ¯çš„åº”ç”¨ç¨‹åºä»¥åŠè¿œç¨‹æ—¥å¿—è®°å½•çš„æƒ…å†µä¸‹ç”Ÿæˆæ—¥å¿—äº‹ä»¶çš„æœºå™¨çš„ä¸»æœºåæ¥é‡‡å–è¡ŒåŠ¨ã€‚Ú^This configuration file contains one line per action, where the syntax for each line is a selector field followed by an action field.  The syntax of the selector field is _facility.level_ which will match log messages from _facility_ at level _level_ or higher.  It is also possible to add an optional comparison flag before the level to specify more precisely what is logged.  Multiple selector fields can be used for the same action, and are separated with a semicolon (`;`).  Using `*` will match everything.  The action field denotes where to send the log message, such as to a file or remote log host.Ú	è¯¥é…ç½®æ–‡ä»¶æ¯è¡ŒåŒ…å«ä¸€ä¸ªæ“ä½œï¼Œæ¯è¡Œçš„è¯­æ³•æ˜¯é€‰æ‹©å™¨å­—æ®µåè·Ÿä¸€ä¸ªæ“ä½œå­—æ®µã€‚é€‰æ‹©å™¨å­—æ®µçš„è¯­æ³•æ˜¯ _facility.level_ï¼Œå®ƒå°†åŒ¹é… _facility_ åœ¨ _level_ æˆ–æ›´é«˜çº§åˆ«çš„æ—¥å¿—æ¶ˆæ¯ã€‚è¿˜å¯ä»¥åœ¨çº§åˆ«ä¹‹å‰æ·»åŠ ä¸€ä¸ªå¯é€‰çš„æ¯”è¾ƒæ ‡å¿—ï¼Œä»¥æ›´ç²¾ç¡®åœ°æŒ‡å®šè®°å½•çš„å†…å®¹ã€‚å¯ä»¥ä¸ºåŒä¸€ä¸ªæ“ä½œä½¿ç”¨å¤šä¸ªé€‰æ‹©å™¨å­—æ®µï¼Œå¹¶ç”¨åˆ†å· (`;`) åˆ†éš”ã€‚ä½¿ç”¨ `*` å°†åŒ¹é…æ‰€æœ‰å†…å®¹ã€‚æ“ä½œå­—æ®µè¡¨ç¤ºå°†æ—¥å¿—æ¶ˆæ¯å‘é€åˆ°ä½•å¤„ï¼Œä¾‹å¦‚æ–‡ä»¶æˆ–è¿œç¨‹æ—¥å¿—ä¸»æœºã€‚ÙNAs an example, here is the default [.filename]#/etc/syslog.conf# from FreeBSD:ÙCä»¥ä¸‹æ˜¯ FreeBSD çš„é»˜è®¤ [.filename]#/etc/syslog.conf# ç¤ºä¾‹ï¼šÚ <.> Matches all messages with a level of `err` or higher, as well as `kern.warning`, `auth.notice` and `mail.crit`, and sends these log messages to the console ([.filename]#/dev/console#).  <.> Matches all messages from the `mail` facility at level `info` or above and logs the messages to [.filename]#/var/log/maillog#.  <.> Uses a comparison flag (`=`) to only match messages at level `debug` and logs them to [.filename]#/var/log/debug.log#.  <.> Is an example usage of a program specification. This makes the rules following it only valid for the specified program. In this case, only the messages generated by man:devd[8] are logged to [.filename]#/var/log/devd.log#.Ú<.> åŒ¹é…æ‰€æœ‰çº§åˆ«ä¸º `err` æˆ–æ›´é«˜çš„æ¶ˆæ¯ï¼Œä»¥åŠ `kern.warning`ã€`auth.notice` å’Œ `mail.crit` ï¼Œå¹¶å°†è¿™äº›æ—¥å¿—æ¶ˆæ¯å‘é€åˆ°æ§åˆ¶å°ï¼ˆ[.filename]#/dev/console#ï¼‰ã€‚
<.> åŒ¹é…æ‰€æœ‰çº§åˆ«ä¸º `info` æˆ–æ›´é«˜çš„ `mail` è®¾æ–½çš„æ¶ˆæ¯ï¼Œå¹¶å°†è¿™äº›æ¶ˆæ¯è®°å½•åˆ° [.filename]#/var/log/maillog# ã€‚
<.> ä½¿ç”¨æ¯”è¾ƒæ ‡å¿—ï¼ˆ`=`ï¼‰ä»…åŒ¹é…çº§åˆ«ä¸º `debug` çš„æ¶ˆæ¯ï¼Œå¹¶å°†å…¶è®°å½•åˆ° [.filename]#/var/log/debug.log# ã€‚
<.> æ˜¯ç¨‹åºè§„èŒƒçš„ç¤ºä¾‹ç”¨æ³•ã€‚è¿™ä½¿å¾—å…¶åçš„è§„åˆ™ä»…å¯¹æŒ‡å®šçš„ç¨‹åºæœ‰æ•ˆã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåªæœ‰ç”± man:devd[8] ç”Ÿæˆçš„æ¶ˆæ¯è¢«è®°å½•åˆ° [.filename]#/var/log/devd.log# ã€‚ÙFor more information about [.filename]#/etc/syslog.conf#, its syntax, and more advanced usage examples, see man:syslog.conf[5].Ùƒæœ‰å…³ [.filename]#/etc/syslog.conf# çš„æ›´å¤šä¿¡æ¯ï¼ŒåŒ…æ‹¬å…¶è¯­æ³•å’Œæ›´é«˜çº§çš„ç”¨æ³•ç¤ºä¾‹ï¼Œè¯·å‚é˜… man:syslog.conf[5]ã€‚²Logging Facilities²æ—¥å¿—è®°å½•è®¾æ–½ÙµA facility describes the part of the system generating the message.  Facilities are a way of separating the different messages so that it is easier for the user to consult the logs.Ù„è®¾æ–½æè¿°äº†ç³»ç»Ÿç”Ÿæˆæ¶ˆæ¯çš„éƒ¨åˆ†ã€‚è®¾æ–½æ˜¯ä¸€ç§å°†ä¸åŒçš„æ¶ˆæ¯åˆ†å¼€çš„æ–¹å¼ï¼Œä»¥ä¾¿ç”¨æˆ·æ›´å®¹æ˜“æŸ¥é˜…æ—¥å¿—ã€‚±syslog facilities­syslog è®¾æ–½¤auth¦è®¤è¯ÙEThe authorization system: man:login[1], man:su[1], man:getty[8], etc.Ù=æˆæƒç³»ç»Ÿï¼šman:login[1]ï¼Œman:su[1]ï¼Œman:getty[8] ç­‰ã€‚Ù=The same as auth, but logged to a file readable only by root.ÙQä¸ auth ç›¸åŒï¼Œä½†æ—¥å¿—è®°å½•åˆ°ä¸€ä¸ªåªæœ‰ root ç”¨æˆ·å¯è¯»çš„æ–‡ä»¶ä¸­ã€‚ÙRMessages written to [.filename]#/dev/console# by the kernel console output driver.ÙTç”±å†…æ ¸æ§åˆ¶å°è¾“å‡ºé©±åŠ¨ç¨‹åºå†™å…¥åˆ° [.filename]#/dev/console# çš„æ¶ˆæ¯ã€‚Ù+Messages written by the man:cron[8] daemon.Ù.ç”± man:cron[8] å®ˆæŠ¤è¿›ç¨‹ç¼–å†™çš„æ¶ˆæ¯ã€‚Ù`System daemons, such as man:routed[8], that are not provided for explicitly by other facilities.Ù_ç³»ç»Ÿå®ˆæŠ¤è¿›ç¨‹ï¼Œä¾‹å¦‚ man:routed[8]ï¼Œè¿™äº›è¿›ç¨‹ä¸æ˜¯ç”±å…¶ä»–è®¾æ–½æ˜ç¡®æä¾›çš„ã€‚Ù>The file transfer protocol daemons: man:ftpd[8], man:tftpd[8].Ù>æ–‡ä»¶ä¼ è¾“åè®®å®ˆæŠ¤è¿›ç¨‹ï¼šman:ftpd[8]ï¼Œman:tftpd[8]ã€‚ÙRMessages generated by the kernel. These cannot be generated by any user processes.ÙKç”±å†…æ ¸ç”Ÿæˆçš„æ¶ˆæ¯ã€‚è¿™äº›æ¶ˆæ¯ä¸èƒ½ç”±ä»»ä½•ç”¨æˆ·è¿›ç¨‹ç”Ÿæˆã€‚ÙJThe line printer spooling system: man:lpr[1], man:lpc[8], man:lpd[8], etc.ÙOè¡Œå¼æ‰“å°æœºçš„æ’é˜Ÿç³»ç»Ÿï¼šman:lpr[1]ï¼Œman:lpc[8]ï¼Œman:lpd[8] ç­‰ç­‰ã€‚°The mail system.¯é‚®ä»¶ç³»ç»Ÿã€‚Ù-This facility adds a record every 20 minutes.Ù+è¯¥è®¾æ–½æ¯ 20 åˆ†é’Ÿæ·»åŠ ä¸€æ¡è®°å½•ã€‚¸The network news system.µç½‘ç»œæ–°é—»ç³»ç»Ÿã€‚Ù!The network time protocol system.»ç½‘ç»œæ—¶é—´åè®®ç³»ç»Ÿã€‚Ù)Security subsystems, such as man:ipfw[4].Ù$å®‰å…¨å­ç³»ç»Ÿï¼Œå¦‚ man:ipfw[4]ã€‚Ù,Messages generated internally by syslogd(8).Ù'man:syslogd(8) å†…éƒ¨ç”Ÿæˆçš„æ¶ˆæ¯ã€‚ÙlMessages generated by random user processes. *This is the default facility identifier if none is specified*.Ù\ç”±éšæœºç”¨æˆ·è¿›ç¨‹ç”Ÿæˆçš„æ¶ˆæ¯ã€‚*å¦‚æœæœªæŒ‡å®šï¼Œåˆ™ä¸ºé»˜è®¤çš„è®¾æ–½æ ‡è¯†ç¬¦*ã€‚ÙcThe Unix-to-Unix Copy system. An ancient protocol. Really weird to see messages from this facility.ÙhUnix åˆ° Unix å¤åˆ¶ç³»ç»Ÿã€‚ä¸€ä¸ªå¤è€çš„åè®®ã€‚çœŸçš„å¾ˆå¥‡æ€ªçœ‹åˆ°æ¥è‡ªè¿™ä¸ªè®¾æ–½çš„æ¶ˆæ¯ã€‚·Reserved for local use.¸ä¿ç•™ä¾›æœ¬åœ°ä½¿ç”¨ã€‚®Logging Levels¬æ—¥å¿—çº§åˆ«ÙtThe level describes the severity of the message, and is a keyword from the following ordered list (higher to lower):Ùfçº§åˆ«æè¿°äº†æ¶ˆæ¯çš„ä¸¥é‡ç¨‹åº¦ï¼Œå¹¶ä¸”æ˜¯ä»¥ä¸‹æœ‰åºåˆ—è¡¨ä¸­çš„å…³é”®å­—ï¼ˆä»é«˜åˆ°ä½ï¼‰ï¼š­syslog levels­syslog çº§åˆ«Ù;A panic condition. This is normally broadcast to all users.Ù9ä¸€ç§ææ…Œçš„æƒ…å†µã€‚é€šå¸¸ä¼šå‘æ‰€æœ‰ç”¨æˆ·å¹¿æ’­ã€‚ÙVA condition that should be corrected immediately, such as a corrupted system database.Ù9åº”ç«‹å³çº æ­£çš„æ¡ä»¶ï¼Œä¾‹å¦‚ç³»ç»Ÿæ•°æ®åº“æŸåã€‚Ù.Critical conditions, e.g., hard device errors.Ù*å…³é”®æ¡ä»¶ï¼Œä¾‹å¦‚ç¡¬ä»¶è®¾å¤‡é”™è¯¯ã€‚§Errors.©é”™è¯¯ã€‚±Warning messages.¯è­¦å‘Šä¿¡æ¯ã€‚ÙSConditions that are not error conditions, but should possibly be handled specially.Ù<ä¸æ˜¯é”™è¯¯æ¡ä»¶ï¼Œä½†å¯èƒ½éœ€è¦ç‰¹æ®Šå¤„ç†çš„æ¡ä»¶ã€‚·Informational messages.²ä¿¡æ¯æ€§æ¶ˆæ¯ã€‚ÙPMessages that contain information normally of use only when debugging a program.Ù<åŒ…å«é€šå¸¸ä»…åœ¨è°ƒè¯•ç¨‹åºæ—¶æœ‰ç”¨çš„ä¿¡æ¯çš„æ¶ˆæ¯ã€‚Ù2This special level disables a particular facility.Ù3è¿™ä¸ªç‰¹æ®Šçº§åˆ«ç¦ç”¨äº†ä¸€ä¸ªç‰¹å®šçš„åŠŸèƒ½ã€‚±Read Log Messages²é˜…è¯»æ—¥å¿—æ¶ˆæ¯ÙÕBy default FreeBSD log files use the format link:https://datatracker.ietf.org/doc/html/rfc3164[rfc3164], also known as The BSD syslog Protocol.  Learn more about other formats and how to use them at man:syslog[8].Ùïé»˜è®¤æƒ…å†µä¸‹ï¼ŒFreeBSD æ—¥å¿—æ–‡ä»¶ä½¿ç”¨ link:https://datatracker.ietf.org/doc/html/rfc3164[rfc3164] æ ¼å¼ï¼Œä¹Ÿè¢«ç§°ä¸º BSD syslog åè®®ã€‚äº†è§£æ›´å¤šå…³äºå…¶ä»–æ ¼å¼ä»¥åŠå¦‚ä½•ä½¿ç”¨å®ƒä»¬çš„ä¿¡æ¯ï¼Œè¯·å‚é˜… man:syslog[8]ã€‚Ù-Typically the logs have the following syntax:Ù!é€šå¸¸æ—¥å¿—å…·æœ‰ä»¥ä¸‹è¯­æ³•ï¼šÙMThe output of the [.filename]#/var/log/cron# file will be used as an example:ÙCå°†ä½¿ç”¨ [.filename]#/var/log/cron# æ–‡ä»¶çš„è¾“å‡ºä½œä¸ºç¤ºä¾‹ï¼šÙVerbose logging, so the facility and the level on each message will be added, can be enabled in man:syslog[8] by running the following command:Ù„å¯ä»¥é€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤åœ¨ man:syslog[8] ä¸­å¯ç”¨è¯¦ç»†æ—¥å¿—è®°å½•ï¼Œè¿™æ ·æ¯æ¡æ¶ˆæ¯çš„è®¾æ–½å’Œçº§åˆ«éƒ½ä¼šè¢«æ·»åŠ ï¼šÙzOnce the function is activated, the facility and the level will be displayed in the log as shown in the following example:Ù]ä¸€æ—¦å‡½æ•°è¢«æ¿€æ´»ï¼Œè®¾æ–½å’Œçº§åˆ«å°†ä¼šåœ¨æ—¥å¿—ä¸­æ˜¾ç¤ºï¼Œå¦‚ä¸‹é¢çš„ç¤ºä¾‹æ‰€ç¤ºï¼š»Log Management and Rotationµæ—¥å¿—ç®¡ç†å’Œè½®è½¬ÙkLog files can grow quickly, taking up disk space and making it more difficult to locate useful information.Ùiæ—¥å¿—æ–‡ä»¶å¯ä»¥å¿«é€Ÿå¢é•¿ï¼Œå ç”¨ç£ç›˜ç©ºé—´ï¼Œå¹¶ä¸”ä½¿å¾—æŸ¥æ‰¾æœ‰ç”¨ä¿¡æ¯å˜å¾—æ›´åŠ å›°éš¾ã€‚ÙVIn FreeBSD, man:newsyslog[8] is used to manage log files and attempt to mitigate this.ÙYåœ¨ FreeBSD ä¸­ï¼Œman:newsyslog[8] ç”¨äºç®¡ç†æ—¥å¿—æ–‡ä»¶å¹¶å°è¯•å‡è½»è¿™ä¸ªé—®é¢˜ã€‚ÙœThis built-in program periodically rotates and compresses log files, and optionally creates missing log files and signals programs when log files are moved.Ù“è¿™ä¸ªå†…ç½®ç¨‹åºå®šæœŸè½®è½¬å’Œå‹ç¼©æ—¥å¿—æ–‡ä»¶ï¼Œå¹¶å¯é€‰æ‹©åˆ›å»ºä¸¢å¤±çš„æ—¥å¿—æ–‡ä»¶ï¼Œå¹¶åœ¨æ—¥å¿—æ–‡ä»¶ç§»åŠ¨æ—¶å‘ç¨‹åºå‘é€ä¿¡å·ã€‚Ù«Since newsyslog is run from man:cron[8], it cannot rotate files more often than it is scheduled to run from man:cron[8].  In the default configuration, it runs every hour.Ù¬ç”±äº newsyslog æ˜¯ä» man:cron[8] è¿è¡Œçš„ï¼Œå®ƒä¸èƒ½æ¯”ä» man:cron[8] è®¡åˆ’è¿è¡Œçš„é¢‘ç‡æ›´é¢‘ç¹åœ°æ—‹è½¬æ–‡ä»¶ã€‚åœ¨é»˜è®¤é…ç½®ä¸­ï¼Œå®ƒæ¯å°æ—¶è¿è¡Œä¸€æ¬¡ã€‚ÙXHere is the default configuration in FreeBSD, more information in man:newsyslog.conf[5]:Ù_ä»¥ä¸‹æ˜¯ FreeBSD ä¸­çš„é»˜è®¤é…ç½®ï¼Œåœ¨ man:newsyslog.conf[5] ä¸­å¯ä»¥æ‰¾åˆ°æ›´å¤šä¿¡æ¯ï¼šÙ;`logfilename` - Name of the system log file to be archived.Ù:`logfilename` - è¦å½’æ¡£çš„ç³»ç»Ÿæ—¥å¿—æ–‡ä»¶çš„åç§°ã€‚ÙY`[owner:group]` - This optional field specifies the owner and group for the archive file.ÙN`[owner:group]` - è¿™ä¸ªå¯é€‰å­—æ®µæŒ‡å®šäº†å­˜æ¡£æ–‡ä»¶çš„æ‰€æœ‰è€…å’Œç»„ã€‚ÙÄ`mode` - Specify the file mode of the log file and archives. Valid mode bits are 0666.  (That is, read and write permissions for the rotated log may be specified for the owner, group, and others.)Ù®`mode` - æŒ‡å®šæ—¥å¿—æ–‡ä»¶å’Œå½’æ¡£æ–‡ä»¶çš„æ–‡ä»¶æ¨¡å¼ã€‚æœ‰æ•ˆçš„æ¨¡å¼ä½æ˜¯ 0666 ï¼ˆå³ï¼Œå¯ä»¥ä¸ºæ‰€æœ‰è€…ã€ç»„å’Œå…¶ä»–ç”¨æˆ·æŒ‡å®šæ—‹è½¬æ—¥å¿—çš„è¯»å†™æƒé™ï¼‰ã€‚ÙF`count` - Specify the maximum number of archive files which may exist.Ù=`count` - æŒ‡å®šå…è®¸å­˜åœ¨çš„å½’æ¡£æ–‡ä»¶çš„æœ€å¤§æ•°é‡ã€‚ÙÌ`size` - When the size of the log file reaches size in kilobytes, the log file will be trimmed as described above. If this field contains an asterisk ('*'), the log file will not be trimmed based on size.ÙÏ`size` - å½“æ—¥å¿—æ–‡ä»¶çš„å¤§å°è¾¾åˆ°æŒ‡å®šçš„å¤§å°ï¼ˆä»¥åƒå­—èŠ‚ä¸ºå•ä½ï¼‰æ—¶ï¼Œå°†æŒ‰ç…§ä¸Šè¿°æè¿°è¿›è¡Œä¿®å‰ªã€‚å¦‚æœè¯¥å­—æ®µåŒ…å«æ˜Ÿå·ï¼ˆ'*'ï¼‰ï¼Œåˆ™ä¸ä¼šæ ¹æ®å¤§å°æ¥ä¿®å‰ªæ—¥å¿—æ–‡ä»¶ã€‚Ùf`when` - Consist of an interval, a specific time, or both. Supported options in man:newsyslog.conf[5].Ùt`when` - ç”±ä¸€ä¸ªæ—¶é—´é—´éš”ã€ä¸€ä¸ªç‰¹å®šæ—¶é—´æˆ–ä¸¤è€…ç»„æˆã€‚åœ¨ man:newsyslog.conf[5] ä¸­æ”¯æŒçš„é€‰é¡¹ã€‚Ùa`flags` - Indicates the flags that newsyslog accepts, supported options in man:newsyslog.conf[5].ÙX`flags` - è¡¨ç¤º newsyslog æ¥å—çš„æ ‡å¿—ï¼Œman:newsyslog.conf[5] ä¸­æ”¯æŒçš„é€‰é¡¹ã€‚Ù{`[/pid_file]` - This optional field specifies the file name containing a daemon's process ID or to find a group process ID.Ùl`[/pid_file]` - è¿™ä¸ªå¯é€‰å­—æ®µæŒ‡å®šåŒ…å«å®ˆæŠ¤è¿›ç¨‹çš„è¿›ç¨‹ ID æˆ–æŸ¥æ‰¾è¿›ç¨‹ç»„ ID çš„æ–‡ä»¶åã€‚Ù_`[sig_num]` - This optional field specifies the signal that will be sent to the daemon process.ÙJ`[sig_num]` - è¿™ä¸ªå¯é€‰å­—æ®µæŒ‡å®šå°†å‘é€ç»™å®ˆæŠ¤è¿›ç¨‹çš„ä¿¡å·ã€‚Ù¥The last two fields are optional and specify the name of the Process ID (PID) file of a process and a signal number to send to that process when the file is rotated.Ù“æœ€åä¸¤ä¸ªå­—æ®µæ˜¯å¯é€‰çš„ï¼Œç”¨äºæŒ‡å®šè¿›ç¨‹çš„è¿›ç¨‹ IDï¼ˆPIDï¼‰æ–‡ä»¶çš„åç§°ä»¥åŠåœ¨æ–‡ä»¶è½®è½¬æ—¶å‘é€ç»™è¯¥è¿›ç¨‹çš„ä¿¡å·ç¼–å·ã€‚ºConfiguring Remote Logging¸é…ç½®è¿œç¨‹æ—¥å¿—è®°å½•ÙÌMonitoring the log files of multiple hosts can become unwieldy as the number of systems increases.  Configuring centralized logging can reduce some of the administrative burden of log file administration.Ù«éšç€ç³»ç»Ÿæ•°é‡çš„å¢åŠ ï¼Œç›‘æ§å¤šä¸ªä¸»æœºçš„æ—¥å¿—æ–‡ä»¶å¯èƒ½å˜å¾—éš¾ä»¥ç®¡ç†ã€‚é…ç½®é›†ä¸­å¼æ—¥å¿—è®°å½•å¯ä»¥å‡è½»ä¸€äº›æ—¥å¿—æ–‡ä»¶ç®¡ç†çš„è¡Œæ”¿è´Ÿæ‹…ã€‚ÙrIn FreeBSD, centralized log file aggregation, merging, and rotation can be configured using syslogd and newsyslog.Ùnåœ¨ FreeBSD ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ syslogd å’Œ newsyslog æ¥é…ç½®é›†ä¸­å¼æ—¥å¿—æ–‡ä»¶èšåˆã€åˆå¹¶å’Œè½®è½¬ã€‚Ù˜This section demonstrates an example configuration, where host `A`, named `logserv.example.com`, will collect logging information for the local network.Ù}æœ¬èŠ‚æ¼”ç¤ºäº†ä¸€ä¸ªç¤ºä¾‹é…ç½®ï¼Œå…¶ä¸­ä¸»æœº `A`ï¼Œåä¸º `logserv.example.com`ï¼Œå°†æ”¶é›†æœ¬åœ°ç½‘ç»œçš„æ—¥å¿—ä¿¡æ¯ã€‚ÙnHost `B`, named `logclient.example.com`, will be configured to pass logging information to the logging server.Ùgä¸»æœº `B`ï¼Œåä¸º `logclient.example.com`ï¼Œå°†è¢«é…ç½®ä¸ºå°†æ—¥å¿—ä¿¡æ¯ä¼ é€’ç»™æ—¥å¿—æœåŠ¡å™¨ã€‚¸Log Server Configurationµæ—¥å¿—æœåŠ¡å™¨é…ç½®ÙaA log server is a system that has been configured to accept logging information from other hosts.Ù`æ—¥å¿—æœåŠ¡å™¨æ˜¯ä¸€ä¸ªå·²é…ç½®å¥½çš„ç³»ç»Ÿï¼Œç”¨äºæ¥æ”¶æ¥è‡ªå…¶ä»–ä¸»æœºçš„æ—¥å¿—ä¿¡æ¯ã€‚Ù5Before configuring a log server, check the following:Ù9åœ¨é…ç½®æ—¥å¿—æœåŠ¡å™¨ä¹‹å‰ï¼Œè¯·æ£€æŸ¥ä»¥ä¸‹å†…å®¹ï¼šÙ¤If there is a firewall between the logging server and any logging clients, ensure that the firewall ruleset allows UDP port 514 for both the clients and the server.Ù“å¦‚æœåœ¨æ—¥å¿—æœåŠ¡å™¨å’Œä»»ä½•æ—¥å¿—å®¢æˆ·ç«¯ä¹‹é—´å­˜åœ¨é˜²ç«å¢™ï¼Œè¯·ç¡®ä¿é˜²ç«å¢™è§„åˆ™é›†å…è®¸å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨çš„ UDP ç«¯å£ 514ã€‚Ú%The logging server and all client machines must have forward and reverse entries in the local DNS. If the network does not have a DNS server, create entries in each system's [.filename]#/etc/hosts#. Proper name resolution is required so that log entries are not rejected by the logging server.Úæ—¥å¿—æœåŠ¡å™¨å’Œæ‰€æœ‰å®¢æˆ·ç«¯æœºå™¨å¿…é¡»åœ¨æœ¬åœ° DNS ä¸­å…·æœ‰æ­£å‘å’Œåå‘æ¡ç›®ã€‚å¦‚æœç½‘ç»œæ²¡æœ‰ DNS æœåŠ¡å™¨ï¼Œè¯·åœ¨æ¯ä¸ªç³»ç»Ÿçš„ [.filename]#/etc/hosts# ä¸­åˆ›å»ºæ¡ç›®ã€‚æ­£ç¡®çš„åç§°è§£ææ˜¯å¿…éœ€çš„ï¼Œä»¥ä¾¿æ—¥å¿—æ¡ç›®ä¸ä¼šè¢«æ—¥å¿—æœåŠ¡å™¨æ‹’ç»ã€‚ÚNOn the log server, edit [.filename]#/etc/syslog.conf# to specify the name of the client to receive log entries from, the logging facility to be used, and the name of the log to store the host's log entries.  This example adds the hostname of `B`, logs all facilities, and stores the log entries in [.filename]#/var/log/logclient.log#.ÚNåœ¨æ—¥å¿—æœåŠ¡å™¨ä¸Šï¼Œç¼–è¾‘ [.filename]#/etc/syslog.conf# æ–‡ä»¶ï¼ŒæŒ‡å®šè¦æ¥æ”¶æ—¥å¿—æ¡ç›®çš„å®¢æˆ·ç«¯åç§°ï¼Œè¦ä½¿ç”¨çš„æ—¥å¿—è®¾æ–½ä»¥åŠå­˜å‚¨ä¸»æœºæ—¥å¿—æ¡ç›®çš„æ—¥å¿—åç§°ã€‚æ­¤ç¤ºä¾‹å°†ä¸»æœºå `B` æ·»åŠ åˆ°æ—¥å¿—ä¸­ï¼Œè®°å½•æ‰€æœ‰è®¾æ–½ï¼Œå¹¶å°†æ—¥å¿—æ¡ç›®å­˜å‚¨åœ¨ [.filename]#/var/log/logclient.log# æ–‡ä»¶ä¸­ã€‚¿Sample Log Server Configuration»ç¤ºä¾‹æ—¥å¿—æœåŠ¡å™¨é…ç½®Ù¤When adding multiple log clients, add a similar two-line entry for each client.  More information about the available facilities may be found in man:syslog.conf[5].Ù—å½“æ·»åŠ å¤šä¸ªæ—¥å¿—å®¢æˆ·ç«¯æ—¶ï¼Œä¸ºæ¯ä¸ªå®¢æˆ·ç«¯æ·»åŠ ç±»ä¼¼çš„ä¸¤è¡Œæ¡ç›®ã€‚æœ‰å…³å¯ç”¨è®¾æ–½çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜… man:syslog.conf[5]ã€‚Ù%Next, execute the following commands:Ù!æ¥ä¸‹æ¥ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼šÚ-The first entry starts syslogd at system boot.  The second entry allows log entries from the specified client.  The `-v -v` increases the verbosity of logged messages.  This is useful for tweaking facilities as administrators are able to see what type of messages are being logged under each facility.Úç¬¬ä¸€æ¡æ¡ç›®åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶å¯åŠ¨ syslogd ã€‚ç¬¬äºŒæ¡æ¡ç›®å…è®¸æ¥è‡ªæŒ‡å®šå®¢æˆ·ç«¯çš„æ—¥å¿—æ¡ç›®ã€‚ `-v -v` å¢åŠ äº†æ—¥å¿—æ¶ˆæ¯çš„è¯¦ç»†ç¨‹åº¦ã€‚è¿™å¯¹äºè°ƒæ•´è®¾æ–½éå¸¸æœ‰ç”¨ï¼Œå› ä¸ºç®¡ç†å‘˜å¯ä»¥çœ‹åˆ°æ¯ä¸ªè®¾æ–½ä¸‹è®°å½•äº†ä»€ä¹ˆç±»å‹çš„æ¶ˆæ¯ã€‚ÙÅMultiple `-a` options may be specified to allow logging from multiple clients.  IP addresses and whole netblocks may also be specified.  Refer to man:syslogd[8] for a full list of possible options.Ù»å¯ä»¥æŒ‡å®šå¤šä¸ª `-a` é€‰é¡¹æ¥å…è®¸ä»å¤šä¸ªå®¢æˆ·ç«¯è¿›è¡Œæ—¥å¿—è®°å½•ã€‚è¿˜å¯ä»¥æŒ‡å®š IP åœ°å€å’Œæ•´ä¸ªç½‘ç»œå—ã€‚æœ‰å…³å¯èƒ½é€‰é¡¹çš„å®Œæ•´åˆ—è¡¨ï¼Œè¯·å‚é˜… man:syslogd[8]ã€‚½Finally, create the log file:¾æœ€åï¼Œåˆ›å»ºæ—¥å¿—æ–‡ä»¶ï¼šÙ8At this point, syslogd should be restarted and verified:Ù-æ­¤æ—¶ï¼Œåº”é‡æ–°å¯åŠ¨å¹¶éªŒè¯ syslogd ï¼šÙ²If a PID is returned, the server restarted successfully, and client configuration can begin.  If the server did not restart, consult [.filename]#/var/log/messages# for the error.ÙÃå¦‚æœè¿”å›äº†ä¸€ä¸ª PIDï¼Œåˆ™è¡¨ç¤ºæœåŠ¡å™¨æˆåŠŸé‡å¯ï¼Œå¯ä»¥å¼€å§‹å®¢æˆ·ç«¯é…ç½®ã€‚å¦‚æœæœåŠ¡å™¨æ²¡æœ‰é‡å¯ï¼Œè¯·æŸ¥çœ‹é”™è¯¯ä¿¡æ¯ï¼Œè¯·å‚è€ƒ [.filename]#/var/log/messages# æ–‡ä»¶ã€‚¸Log Client Configurationµæ—¥å¿—å®¢æˆ·ç«¯é…ç½®Ù{A logging client sends log entries to a logging server on the network.  The client also keeps a local copy of its own logs.Ù~ä¸€ä¸ªæ—¥å¿—å®¢æˆ·ç«¯å°†æ—¥å¿—æ¡ç›®å‘é€åˆ°ç½‘ç»œä¸Šçš„æ—¥å¿—æœåŠ¡å™¨ã€‚å®¢æˆ·ç«¯è¿˜ä¿ç•™äº†è‡ªå·±æ—¥å¿—çš„æœ¬åœ°å‰¯æœ¬ã€‚Ù`Once a logging server has been configured, execute the following commands on the logging client:ÙNä¸€æ—¦é…ç½®äº†æ—¥å¿—æœåŠ¡å™¨ï¼Œå°±åœ¨æ—¥å¿—å®¢æˆ·ç«¯ä¸Šæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼šÙ¶The first entry enables syslogd on boot up.  The second entry prevents logs from being accepted by this client from other hosts (`-s`) and increases the verbosity of logged messages.Ùœç¬¬ä¸€é¡¹å¯ç”¨äº†ç³»ç»Ÿå¯åŠ¨æ—¶çš„ syslogdã€‚ç¬¬äºŒé¡¹é˜»æ­¢å…¶ä»–ä¸»æœºå‘æ­¤å®¢æˆ·ç«¯æ¥å—æ—¥å¿—ï¼ˆ`-s`ï¼‰ï¼Œå¹¶å¢åŠ äº†æ—¥å¿—æ¶ˆæ¯çš„è¯¦ç»†ç¨‹åº¦ã€‚ÙËNext, define the logging server in the client's [.filename]#/etc/syslog.conf#.  In this example, all logged facilities are sent to a remote system, denoted by the `@` symbol, with the specified hostname:ÙØæ¥ä¸‹æ¥ï¼Œåœ¨å®¢æˆ·ç«¯çš„ [.filename]#/etc/syslog.conf# æ–‡ä»¶ä¸­å®šä¹‰æ—¥å¿—æœåŠ¡å™¨ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæ‰€æœ‰è®°å½•çš„è®¾æ–½éƒ½ä¼šè¢«å‘é€åˆ°ä¸€ä¸ªè¿œç¨‹ç³»ç»Ÿï¼Œç”¨ `@` ç¬¦å·è¡¨ç¤ºï¼Œå¹¶æŒ‡å®šä¸»æœºåï¼šÙFAfter saving the edit, restart syslogd for the changes to take effect:Ù<ä¿å­˜ç¼–è¾‘åï¼Œé‡æ–°å¯åŠ¨ syslogd ä»¥ä½¿æ›´æ”¹ç”Ÿæ•ˆï¼šÙzTo test that log messages are being sent across the network, use man:logger[1] on the client to send a message to syslogd:Ùä¸ºäº†æµ‹è¯•æ—¥å¿—æ¶ˆæ¯æ˜¯å¦é€šè¿‡ç½‘ç»œå‘é€ï¼Œå¯ä»¥åœ¨å®¢æˆ·ç«¯ä½¿ç”¨ man:logger[1] å‘½ä»¤å‘ syslogd å‘é€ä¸€æ¡æ¶ˆæ¯ã€‚ÙThis message should now exist both in [.filename]#/var/log/messages# on the client and [.filename]#/var/log/logclient.log# on the log server.Ùæ­¤æ¶ˆæ¯ç°åœ¨åº”è¯¥åŒæ—¶å­˜åœ¨äºå®¢æˆ·ç«¯çš„ [.filename]#/var/log/messages# å’Œæ—¥å¿—æœåŠ¡å™¨çš„ [.filename]#/var/log/logclient.log# ä¸­ã€‚µDebugging Log Serversµè°ƒè¯•æ—¥å¿—æœåŠ¡å™¨ÚCIf no messages are being received on the log server, the cause is most likely a network connectivity issue, a hostname resolution issue, or a typo in a configuration file.  To isolate the cause, ensure that both the logging server and the logging client are able to `ping` each other using the hostname specified in their [.filename]#/etc/rc.conf#.  If this fails, check the network cabling, the firewall ruleset, and the hostname entries in the DNS server or [.filename]#/etc/hosts# on both the logging server and clients.  Repeat until the `ping` is successful from both hosts.Úå¦‚æœæ—¥å¿—æœåŠ¡å™¨ä¸Šæ²¡æœ‰æ¥æ”¶åˆ°ä»»ä½•æ¶ˆæ¯ï¼ŒåŸå› å¾ˆå¯èƒ½æ˜¯ç½‘ç»œè¿æ¥é—®é¢˜ã€ä¸»æœºåè§£æé—®é¢˜æˆ–é…ç½®æ–‡ä»¶ä¸­çš„æ‹¼å†™é”™è¯¯ã€‚ä¸ºäº†ç¡®å®šåŸå› ï¼Œç¡®ä¿æ—¥å¿—æœåŠ¡å™¨å’Œæ—¥å¿—å®¢æˆ·ç«¯éƒ½èƒ½å¤Ÿä½¿ç”¨å®ƒä»¬åœ¨ [.filename]#/etc/rc.conf# ä¸­æŒ‡å®šçš„ä¸»æœºåç›¸äº’ `ping`ã€‚å¦‚æœå¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œç”µç¼†ã€é˜²ç«å¢™è§„åˆ™é›†ä»¥åŠ DNS æœåŠ¡å™¨æˆ–æ—¥å¿—æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¸Šçš„ [.filename]#/etc/hosts# ä¸­çš„ä¸»æœºåæ¡ç›®ã€‚é‡å¤æ­¤è¿‡ç¨‹ï¼Œç›´åˆ°ä»ä¸¤ä¸ªä¸»æœºéƒ½æˆåŠŸ `ping`ã€‚ÚeIf the `ping` succeeds on both hosts but log messages are still not being received, temporarily increase logging verbosity to narrow down the configuration issue.  In the following example, [.filename]#/var/log/logclient.log# on the logging server is empty and [.filename]#/var/log/messages# on the logging client does not indicate a reason for the failure.Újå¦‚æœåœ¨ä¸¤å°ä¸»æœºä¸Šéƒ½æˆåŠŸæ‰§è¡Œäº† `ping` å‘½ä»¤ï¼Œä½†ä»ç„¶æ— æ³•æ¥æ”¶åˆ°æ—¥å¿—æ¶ˆæ¯ï¼Œåˆ™å¯ä»¥æš‚æ—¶å¢åŠ æ—¥å¿—çš„è¯¦ç»†ç¨‹åº¦ä»¥ç¼©å°é…ç½®é—®é¢˜çš„èŒƒå›´ã€‚åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œæ—¥å¿—æœåŠ¡å™¨ä¸Šçš„ [.filename]#/var/log/logclient.log# æ–‡ä»¶ä¸ºç©ºï¼Œè€Œæ—¥å¿—å®¢æˆ·ç«¯ä¸Šçš„ [.filename]#/var/log/messages# æ–‡ä»¶æ²¡æœ‰æ˜¾ç¤ºå¤±è´¥çš„åŸå› ã€‚ÙgTo increase debugging output, edit the `syslogd_flags` entry on the logging server and issue a restart:Ùeä¸ºäº†å¢åŠ è°ƒè¯•è¾“å‡ºï¼Œç¼–è¾‘æ—¥å¿—æœåŠ¡å™¨ä¸Šçš„ `syslogd_flags` æ¡ç›®å¹¶æ‰§è¡Œé‡å¯æ“ä½œï¼šÙ`Debugging data similar to the following will flash on the console immediately after the restart:ÙQåœ¨é‡æ–°å¯åŠ¨åï¼Œç±»ä¼¼ä»¥ä¸‹çš„è°ƒè¯•æ•°æ®å°†ç«‹å³åœ¨æ§åˆ¶å°ä¸Šé—ªç°ï¼šÙŞIn this example, the log messages are being rejected due to a typo which results in a hostname mismatch.  The client's hostname should be `logclient`, not `logclien`.  Fix the typo, issue a restart, and verify the results:Ùæåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œç”±äºä¸€ä¸ªæ‹¼å†™é”™è¯¯å¯¼è‡´æ—¥å¿—æ¶ˆæ¯è¢«æ‹’ç»ï¼Œä»è€Œå¯¼è‡´ä¸»æœºåä¸åŒ¹é…ã€‚å®¢æˆ·ç«¯çš„ä¸»æœºååº”è¯¥æ˜¯ `logclient`ï¼Œè€Œä¸æ˜¯ `logclien`ã€‚ä¿®å¤æ‹¼å†™é”™è¯¯ï¼Œé‡æ–°å¯åŠ¨ï¼Œå¹¶éªŒè¯ç»“æœã€‚ÙWAt this point, the messages are being properly received and placed in the correct file.ÙEç›®å‰ï¼Œæ¶ˆæ¯å·²ç»è¢«æ­£ç¡®æ¥æ”¶å¹¶æ”¾ç½®åœ¨æ­£ç¡®çš„æ–‡ä»¶ä¸­ã€‚·Security Considerations¬å®‰å…¨è€ƒè™‘ÚÎAs with any network service, security requirements should be considered before implementing a logging server.  Log files may contain sensitive data about services enabled on the local host, user accounts, and configuration data.  Network data sent from the client to the server will not be encrypted or password protected.  If a need for encryption exists, consider using package:security/stunnel[], which will transmit the logging data over an encrypted tunnel.Úƒä¸ä»»ä½•ç½‘ç»œæœåŠ¡ä¸€æ ·ï¼Œåœ¨å®æ–½æ—¥å¿—æœåŠ¡å™¨ä¹‹å‰åº”è€ƒè™‘å®‰å…¨è¦æ±‚ã€‚æ—¥å¿—æ–‡ä»¶å¯èƒ½åŒ…å«æœ‰å…³æœ¬åœ°ä¸»æœºä¸Šå¯ç”¨çš„æœåŠ¡ã€ç”¨æˆ·å¸æˆ·å’Œé…ç½®æ•°æ®çš„æ•æ„Ÿä¿¡æ¯ã€‚ä»å®¢æˆ·ç«¯å‘é€åˆ°æœåŠ¡å™¨çš„ç½‘ç»œæ•°æ®å°†ä¸ä¼šè¿›è¡ŒåŠ å¯†æˆ–å¯†ç ä¿æŠ¤ã€‚å¦‚æœéœ€è¦åŠ å¯†ï¼Œè¯·è€ƒè™‘ä½¿ç”¨ package:security/stunnel[]ï¼Œå®ƒå°†é€šè¿‡åŠ å¯†éš§é“ä¼ è¾“æ—¥å¿—æ•°æ®ã€‚ÚäLocal security is also an issue.  Log files are not encrypted during use or after log rotation.  Local users may access log files to gain additional insight into system configuration.  Setting proper permissions on log files is critical.  The built-in log rotator, newsyslog, supports setting permissions on newly created and rotated log files.  Setting log files to mode `600` should prevent unwanted access by local users.  Refer to man:newsyslog.conf[5] for additional information.Úßæœ¬åœ°å®‰å…¨æ€§ä¹Ÿæ˜¯ä¸€ä¸ªé—®é¢˜ã€‚æ—¥å¿—æ–‡ä»¶åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­æˆ–åœ¨æ—¥å¿—è½®æ¢åéƒ½æ²¡æœ‰åŠ å¯†ã€‚æœ¬åœ°ç”¨æˆ·å¯ä»¥è®¿é—®æ—¥å¿—æ–‡ä»¶ä»¥è·å–æœ‰å…³ç³»ç»Ÿé…ç½®çš„æ›´å¤šä¿¡æ¯ã€‚åœ¨æ—¥å¿—æ–‡ä»¶ä¸Šè®¾ç½®é€‚å½“çš„æƒé™è‡³å…³é‡è¦ã€‚å†…ç½®çš„æ—¥å¿—è½®æ¢ç¨‹åº newsyslog æ”¯æŒåœ¨æ–°åˆ›å»ºå’Œè½®æ¢çš„æ—¥å¿—æ–‡ä»¶ä¸Šè®¾ç½®æƒé™ã€‚å°†æ—¥å¿—æ–‡ä»¶è®¾ç½®ä¸º `600` æ¨¡å¼åº”è¯¥å¯ä»¥é˜²æ­¢æœ¬åœ°ç”¨æˆ·çš„éæ³•è®¿é—®ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜… man:newsyslog.conf[5] ã€‚½Power and Resource ManagementµåŠŸè€—å’Œèµ„æºç®¡ç†ÙçIt is important to utilize hardware resources in an efficient manner.  Power and resource management allows the operating system to monitor system limits and to possibly run some actions triggered by events related to those limits.Ù®é«˜æ•ˆåˆ©ç”¨ç¡¬ä»¶èµ„æºæ˜¯éå¸¸é‡è¦çš„ã€‚åŠŸè€—å’Œèµ„æºç®¡ç†ä½¿æ“ä½œç³»ç»Ÿèƒ½å¤Ÿç›‘æ§ç³»ç»Ÿé™åˆ¶ï¼Œå¹¶å¯èƒ½æ ¹æ®ä¸è¿™äº›é™åˆ¶ç›¸å…³çš„äº‹ä»¶è¿è¡Œä¸€äº›æ“ä½œã€‚²ACPI configuration«ACPI é…ç½®ÙYOn FreeBSD the management of these resources is managed by the man:acpi[4] kernel device.ÙLåœ¨ FreeBSD ä¸Šï¼Œè¿™äº›èµ„æºçš„ç®¡ç†ç”± man:acpi[4] å†…æ ¸è®¾å¤‡ç®¡ç†ã€‚ÙFIn FreeBSD the man:acpi[4] driver is loaded by default at system boot.ÙXåœ¨ FreeBSD ä¸­ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œåœ¨ç³»ç»Ÿå¯åŠ¨æ—¶åŠ è½½ man:acpi[4] é©±åŠ¨ç¨‹åºã€‚ÙmThis driver *cannot be unloaded after boot* because the system bus uses it for various hardware interactions.Ùuç”±äºç³»ç»Ÿæ€»çº¿åœ¨å„ç§ç¡¬ä»¶äº¤äº’ä¸­ä½¿ç”¨è¯¥é©±åŠ¨ç¨‹åºï¼Œå› æ­¤æ­¤é©±åŠ¨ç¨‹åºåœ¨å¼•å¯¼å *æ— æ³•å¸è½½*ã€‚ÙÔIn addition to man:acpi[4], FreeBSD has several dedicated kernel modules for various ACPI vendor subsystems.  These modules will add some extra functionality like fan speed, keyboard backlit or screen brightness.ÙÉé™¤äº† man:acpi[4] ä¹‹å¤–ï¼ŒFreeBSD è¿˜æœ‰å‡ ä¸ªä¸“é—¨çš„å†…æ ¸æ¨¡å—ç”¨äºå„ç§ ACPI ä¾›åº”å•†å­ç³»ç»Ÿã€‚è¿™äº›æ¨¡å—å°†æ·»åŠ ä¸€äº›é¢å¤–çš„åŠŸèƒ½ï¼Œå¦‚é£æ‰‡é€Ÿåº¦ã€é”®ç›˜èƒŒå…‰æˆ–å±å¹•äº®åº¦ã€‚Ù:The list can be obtained by running the following command:Ù-å¯ä»¥é€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤è·å–åˆ—è¡¨ï¼šÙ™In the event that, for example, an IBM/Lenovo laptop is used, it will be necessary to load the module man:acpi_ibm[4] by executing the following command:Ùsä¾‹å¦‚ï¼Œå¦‚æœä½¿ç”¨ IBM/Lenovo ç¬”è®°æœ¬ç”µè„‘ï¼Œåˆ™éœ€è¦é€šè¿‡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤åŠ è½½æ¨¡å— man:acpi_ibm[4]ï¼šÙGAnd add this line to [.filename]#/boot/loader.conf# to load it at boot:Ù_å¹¶å°†ä»¥ä¸‹è¡Œæ·»åŠ åˆ° [.filename]#/boot/loader.conf# æ–‡ä»¶ä¸­ï¼Œä»¥åœ¨å¯åŠ¨æ—¶åŠ è½½å®ƒï¼šÚUAn alternative to the man:acpi_video[4] module is the man:backlight[9] driver.  It provides a generic way for handling a panel backlight.  The default GENERIC kernel includes this driver.  The man:backlight[8] utility can be used to query and adjust the brightness of the panel backlight.  In this example the brightness is decreased by 10%:Ú3man:acpi_video[4] æ¨¡å—çš„æ›¿ä»£æ–¹æ¡ˆæ˜¯ man:backlight[9] é©±åŠ¨ç¨‹åºã€‚å®ƒæä¾›äº†ä¸€ç§é€šç”¨çš„å¤„ç†é¢æ¿èƒŒå…‰çš„æ–¹å¼ã€‚é»˜è®¤çš„ GENERIC å†…æ ¸åŒ…å«äº†è¿™ä¸ªé©±åŠ¨ç¨‹åºã€‚man:backlight[8] å®ç”¨ç¨‹åºå¯ç”¨äºæŸ¥è¯¢å’Œè°ƒæ•´é¢æ¿èƒŒå…‰çš„äº®åº¦ã€‚åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œäº®åº¦å‡å°‘äº† 10% ï¼š´CPU Power Management°CPU åŠŸè€—ç®¡ç†Ù‘CPU is the most consuming part of the system.  Knowing how to improve CPU efficiency is a fundamental part of our system in order to save energy.ÙxCPU æ˜¯ç³»ç»Ÿä¸­æœ€æ¶ˆè€—èµ„æºçš„éƒ¨åˆ†ã€‚äº†è§£å¦‚ä½•æé«˜ CPU æ•ˆç‡æ˜¯æˆ‘ä»¬ç³»ç»Ÿä¸­èŠ‚çœèƒ½æºçš„åŸºæœ¬éƒ¨åˆ†ã€‚ÙáIn order to make proper use of the machine's resources in a correct way, FreeBSD supports technologies such as Intel Turbo Boost, AMD Turbo Core, Intel Speed Shift among others through the use of man:powerd[8] and cpufreq[4].Ù»ä¸ºäº†æ­£ç¡®åœ°å……åˆ†åˆ©ç”¨æœºå™¨çš„èµ„æºï¼ŒFreeBSD é€šè¿‡ä½¿ç”¨ man:powerd[8] å’Œ cpufreq[4] ç­‰æŠ€æœ¯æ¥æ”¯æŒè¯¸å¦‚ Intel Turbo Boostã€AMD Turbo Coreã€Intel Speed Shift ç­‰æŠ€æœ¯ã€‚ÙXThe first step will be to obtain the CPU information by executing the following command:Ù;ç¬¬ä¸€æ­¥æ˜¯é€šè¿‡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ¥è·å– CPU ä¿¡æ¯ï¼šÙD<.> In this case the `0` digit represents the first core of the CPU.Ù@åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ•°å­— `0` ä»£è¡¨ CPU çš„ç¬¬ä¸€ä¸ªæ ¸å¿ƒã€‚Ù*Lowest Cx state to use for idling the CPU.Ù6ç”¨äºä½¿ CPU å¤„äºç©ºé—²çŠ¶æ€çš„æœ€ä½ Cx çŠ¶æ€ã€‚¸CPU supported Cx states.ºCPU æ”¯æŒçš„ Cx çŠ¶æ€ã€‚Ù?Currently available levels for the CPU (frequency/power usage).Ù2å½“å‰å¯ç”¨çš„ CPU çº§åˆ«ï¼ˆé¢‘ç‡ / åŠŸè€—ï¼‰ã€‚Ù$Current active CPU frequency in MHz.Ù4å½“å‰æ´»åŠ¨çš„ CPU é¢‘ç‡ï¼ˆä»¥ MHz ä¸ºå•ä½ï¼‰ã€‚¿Current temperature of the CPU.¶CPU çš„å½“å‰æ¸©åº¦ã€‚ÙIf the temperature information is not displayed, load the man:coretemp[4] module.  In case of using an AMD CPU, load the man:amdtemp[4] module.Ùzå¦‚æœæ¸©åº¦ä¿¡æ¯æœªæ˜¾ç¤ºï¼Œè¯·åŠ è½½ man:coretemp[4] æ¨¡å—ã€‚å¦‚æœä½¿ç”¨ AMD CPUï¼Œè¯·åŠ è½½ man:amdtemp[4] æ¨¡å—ã€‚ÙrOnce the CPU information is available the easiest way to configure power saving is to let man:powerd[8] take over.ÙVä¸€æ—¦ CPU ä¿¡æ¯å¯ç”¨ï¼Œé…ç½®èŠ‚èƒ½çš„æœ€ç®€å•æ–¹æ³•æ˜¯è®© man:powerd[8] æ¥ç®¡ã€‚ÙREnable man:powerd[8] service in [.filename]#/etc/rc.conf# to start at system boot:Ù`åœ¨ [.filename]#/etc/rc.conf# ä¸­å¯ç”¨ man:powerd[8] æœåŠ¡ï¼Œä½¿å…¶åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶å¯åŠ¨ï¼šÙ˜It will also be necessary to indicate certain parameters to man:powerd[8] to tell it how to manage the state of the CPU executing the following command:Ùnè¿˜éœ€è¦å‘ man:powerd[8] æŒ‡å®šä¸€äº›å‚æ•°ï¼Œä»¥å‘Šè¯‰å®ƒå¦‚ä½•ç®¡ç†æ‰§è¡Œä»¥ä¸‹å‘½ä»¤çš„ CPU çš„çŠ¶æ€ï¼šÙ0`-a`: Selects the mode to use while on AC power.Ù1`-a`ï¼šé€‰æ‹©åœ¨äº¤æµç”µæºä¸‹ä½¿ç”¨çš„æ¨¡å¼ã€‚Ù9`hiadaptive`: Operation mode. More info at man:powerd[8].ÙD`hiadaptive`ï¼šæ“ä½œæ¨¡å¼ã€‚æ›´å¤šä¿¡æ¯è¯·å‚è€ƒ man:powerd[8]ã€‚Ùp`-i`: Specifies the CPU load percent level when adaptive mode should begin to degrade performance to save power.Ùc`-i`ï¼šæŒ‡å®šå½“è‡ªé€‚åº”æ¨¡å¼å¼€å§‹é™ä½æ€§èƒ½ä»¥èŠ‚çœç”µåŠ›æ—¶çš„ CPU è´Ÿè½½ç™¾åˆ†æ¯”æ°´å¹³ã€‚Ùx`-r`: Specifies the CPU load percent level where adaptive mode should consider the CPU running and increase performance.Ùb`-r`ï¼šæŒ‡å®šè‡ªé€‚åº”æ¨¡å¼åº”è¯¥è€ƒè™‘ CPU è¿è¡Œå¹¶æé«˜æ€§èƒ½çš„ CPU è´Ÿè½½ç™¾åˆ†æ¯”æ°´å¹³ã€‚Ù›`-N`: Treat "nice" time as idle for the purpose of load calculation; i.e., do not increase the CPU frequency if the CPU is only busy with "nice" processes.Ù‹`-N`ï¼šå°†â€œniceâ€æ—¶é—´è§†ä¸ºç©ºé—²æ—¶é—´ï¼Œç”¨äºè´Ÿè½½è®¡ç®—ï¼›å³ï¼Œå¦‚æœ CPU ä»…å¿™äºâ€œniceâ€è¿›ç¨‹ï¼Œåˆ™ä¸å¢åŠ  CPU é¢‘ç‡ã€‚Ù<And then enable the service executing the following command:Ù'ç„¶åæ‰§è¡Œä»¥ä¸‹å‘½ä»¤å¯ç”¨æœåŠ¡ï¼šµCPU Frequency Control°CPU é¢‘ç‡æ§åˆ¶Ú­FreeBSD includes a generic man:cpufreq[4] driver to allow the administrator, or software such as man:powerd[8] and package:sysutils/powerdxx[], to manage the frequency of the CPU to achieve the desired balance between performance and economy.  A lower setting will save power while reducing the heat generated by the CPU.  A higher setting will increase performance at the cost of using additional power and generating more heat.ÚwFreeBSD åŒ…å«ä¸€ä¸ªé€šç”¨çš„ man:cpufreq[4] é©±åŠ¨ç¨‹åºï¼Œå…è®¸ç®¡ç†å‘˜æˆ–è€…åƒ man:powerd[8] å’Œ package:sysutils/powerdxx[] è¿™æ ·çš„è½¯ä»¶æ¥ç®¡ç† CPU çš„é¢‘ç‡ï¼Œä»¥å®ç°æ€§èƒ½å’Œç»æµä¹‹é—´çš„ç†æƒ³å¹³è¡¡ã€‚é™ä½è®¾ç½®å¯ä»¥èŠ‚çœç”µåŠ›ï¼ŒåŒæ—¶å‡å°‘ CPU äº§ç”Ÿçš„çƒ­é‡ã€‚æé«˜è®¾ç½®å¯ä»¥å¢åŠ æ€§èƒ½ï¼Œä½†ä¼šæ¶ˆè€—é¢å¤–çš„ç”µåŠ›å¹¶äº§ç”Ÿæ›´å¤šçš„çƒ­é‡ã€‚Ú¢The Intel(R) Enhanced Speed Step(TM) driver, man:est[4], replaces the generic man:cpufreq[4] driver for CPUs that provide this feature.  The CPU frequency can be statically adjusted using man:sysctl[8], or with the `/etc/rc.d/power_profile` startup script.  Additional software, such as man:powerd[8] or package:sysutils/powerdxx[], can be used to automatically adjust the CPU frequency based on processor utilization.ÚfIntel(R) Enhanced Speed Step(TM) é©±åŠ¨ç¨‹åºï¼Œman:est[4]ï¼Œç”¨äºæ›¿ä»£æä¾›æ­¤åŠŸèƒ½çš„ CPU çš„é€šç”¨ man:cpufreq[4] é©±åŠ¨ç¨‹åºã€‚å¯ä»¥ä½¿ç”¨ man:sysctl[8] æˆ– `/etc/rc.d/power_profile` å¯åŠ¨è„šæœ¬é™æ€è°ƒæ•´ CPU é¢‘ç‡ã€‚è¿˜å¯ä»¥ä½¿ç”¨ man:powerd[8] æˆ– package:sysutils/powerdxx[] ç­‰å…¶ä»–è½¯ä»¶æ ¹æ®å¤„ç†å™¨åˆ©ç”¨ç‡è‡ªåŠ¨è°ƒæ•´ CPU é¢‘ç‡ã€‚ÙwEach supported frequency, along with its expected power consumption, can be listed by examining the man:sysctl[3] tree:ÙZå¯ä»¥é€šè¿‡æ£€æŸ¥ man:sysctl[3] æ ‘æ¥åˆ—å‡ºæ¯ä¸ªæ”¯æŒçš„é¢‘ç‡åŠå…¶é¢„æœŸçš„åŠŸè€—ã€‚ÙnA frequency 1 MHz higher than the maximum frequency of the CPU indicates the Intel(R) Turbo Boost(TM) feature.ÙFCPU çš„æœ€å¤§é¢‘ç‡åŠ  1 MHz è¡¨ç¤º Intel(R) Turbo Boost(TM) åŠŸèƒ½ã€‚ÚVUsers running newer Intel(R) CPUs may find some differences in dynamic frequency control when upgrading to FreeBSD 13.  A new driver for the Intel(R) Speed Shift(TM) feature set, available on certain SKUs, exposes the ability for the hardware to dynamically vary the core frequencies, including on a per core basis.  FreeBSD 13 comes with the man:hwpstate_intel[4] driver to automatically enable Speed Shift(TM) control on equipped CPUs, replacing the older Enhanced Speed Step(TM) man:est[4] driver.  The man:sysctl[8] `dev.cpufreq.%d.freq_driver` will indicate if the system is using Speed Shift.ÚNè¿è¡Œè¾ƒæ–°çš„ Intel(R) CPU çš„ç”¨æˆ·åœ¨å‡çº§åˆ° FreeBSD 13 æ—¶å¯èƒ½ä¼šå‘ç°åŠ¨æ€é¢‘ç‡æ§åˆ¶æ–¹é¢å­˜åœ¨ä¸€äº›å·®å¼‚ã€‚é’ˆå¯¹æŸäº› SKU å¯ç”¨çš„ Intel(R) Speed Shift(TM) åŠŸèƒ½é›†ï¼Œæä¾›äº†ä¸€ç§æ–°çš„é©±åŠ¨ç¨‹åºï¼Œå¯ä»¥ä½¿ç¡¬ä»¶èƒ½å¤ŸåŠ¨æ€åœ°å˜åŒ–æ ¸å¿ƒé¢‘ç‡ï¼ŒåŒ…æ‹¬æ¯ä¸ªæ ¸å¿ƒçš„é¢‘ç‡ã€‚FreeBSD 13 é…å¤‡äº† man:hwpstate_intel[4] é©±åŠ¨ç¨‹åºï¼Œå¯ä»¥è‡ªåŠ¨å¯ç”¨é…å¤‡äº† Speed Shift(TM) æ§åˆ¶åŠŸèƒ½çš„ CPUï¼Œå–ä»£äº†è¾ƒæ—§çš„ Enhanced Speed Step(TM) man:est[4] é©±åŠ¨ç¨‹åºã€‚man:sysctl[8] `dev.cpufreq.%d.freq_driver` å°†æŒ‡ç¤ºç³»ç»Ÿæ˜¯å¦æ­£åœ¨ä½¿ç”¨ Speed Shiftã€‚ÙiTo determine which frequency control driver is being used, examining the `dev.cpufreq.0.freq_driver` oid.Ùcè¦ç¡®å®šæ­£åœ¨ä½¿ç”¨å“ªä¸ªé¢‘ç‡æ§åˆ¶é©±åŠ¨ç¨‹åºï¼Œè¯·æ£€æŸ¥ `dev.cpufreq.0.freq_driver` oid ã€‚ÙÕThis indicates that the new man:hwpstate_intel[4] driver is in use.  On such systems, the oid `dev.cpu.%d.freq_levels` will show only the maximum CPU frequency, and will indicate a power consumption level of `-1`.ÙÂè¿™è¡¨ç¤ºæ­£åœ¨ä½¿ç”¨æ–°çš„ man:hwpstate_intel[4] é©±åŠ¨ç¨‹åºã€‚åœ¨è¿™ç§ç³»ç»Ÿä¸Šï¼Œoid `dev.cpu.%d.freq_levels` åªä¼šæ˜¾ç¤ºæœ€å¤§çš„ CPU é¢‘ç‡ï¼Œå¹¶ä¸”ä¼šæ˜¾ç¤ºä¸€ä¸ªåŠŸè€—çº§åˆ«ä¸º `-1`ã€‚ÙSThe current CPU frequency can be determined by examining the `dev.cpu.%d.freq` oid.ÙIå¯ä»¥é€šè¿‡æ£€æŸ¥ `dev.cpu.%d.freq` oid æ¥ç¡®å®šå½“å‰çš„ CPU é¢‘ç‡ã€‚ÙFor more information, including on how to balance performance and energy use, and on how to disable this driver, refer to the man page man:hwpstate_intel[4].Ù‘æœ‰å…³æ›´å¤šä¿¡æ¯ï¼ŒåŒ…æ‹¬å¦‚ä½•å¹³è¡¡æ€§èƒ½å’Œèƒ½æºä½¿ç”¨ï¼Œä»¥åŠå¦‚ä½•ç¦ç”¨æ­¤é©±åŠ¨ç¨‹åºï¼Œè¯·å‚é˜…æ‰‹å†Œé¡µé¢ man:hwpstate_intel[4]ã€‚Ù¹Users accustomed to using man:powerd[8] or package:sysutils/powerdxx[] will find these utilities have been superseded by the man:hwpstate_intel[4] driver and no longer work as expected.Ù¯ä¹ æƒ¯ä½¿ç”¨ man:powerd[8] æˆ– package:sysutils/powerdxx[] çš„ç”¨æˆ·ä¼šå‘ç°è¿™äº›å®ç”¨ç¨‹åºå·²è¢« man:hwpstate_intel[4] é©±åŠ¨ç¨‹åºå–ä»£ï¼Œå¹¶ä¸”ä¸å†æŒ‰é¢„æœŸå·¥ä½œã€‚¾Graphics Card Power Managementµå›¾å½¢å¡åŠŸè€—ç®¡ç†ÙËGraphics cards have become a fundamental part of computing in recent years.  Some graphics cards may have excessive power consumption.  FreeBSD allows certain configurations to improve power consumption.Ù˜è¿‘å¹´æ¥ï¼Œæ˜¾å¡å·²æˆä¸ºè®¡ç®—æœºçš„åŸºæœ¬ç»„æˆéƒ¨åˆ†ã€‚ä¸€äº›æ˜¾å¡å¯èƒ½å…·æœ‰è¿‡é«˜çš„åŠŸè€—ã€‚FreeBSD å…è®¸è¿›è¡ŒæŸäº›é…ç½®ä»¥æ”¹å–„åŠŸè€—ã€‚Ù“In case of using a Intel(R) graphics card with the package:graphics/drm-kmod[] driver these options can be added to [.filename]#/boot/loader.conf#:Ù•å¦‚æœä½¿ç”¨ Intel(R) æ˜¾å¡ä¸ package:graphics/drm-kmod[] é©±åŠ¨ç¨‹åºï¼Œå¯ä»¥å°†ä»¥ä¸‹é€‰é¡¹æ·»åŠ åˆ° [.filename]#/boot/loader.conf# æ–‡ä»¶ä¸­ï¼šÙ•<.> Try to skip unnecessary mode sets at boot time.  <.> Enable power-saving display C-states.  <.> Enable frame buffer compression for power savingsÙ†<.> å°è¯•åœ¨å¯åŠ¨æ—¶è·³è¿‡ä¸å¿…è¦çš„æ¨¡å¼è®¾ç½®ã€‚ <.> å¯ç”¨çœç”µæ˜¾ç¤º C çŠ¶æ€ã€‚ <.> å¯ç”¨å¸§ç¼“å†²å‹ç¼©ä»¥èŠ‚çœç”µé‡ã€‚®Suspend/Resume­æŒ‚èµ·/æ¢å¤ÙĞThe suspend/resume function allows the machine to be kept in a state in which there is no a big energy consumption and allows the system to be resumed without having to lose the state of the running programs.ÙyæŒ‚èµ·/æ¢å¤åŠŸèƒ½å…è®¸æœºå™¨ä¿æŒåœ¨ä½èƒ½è€—çŠ¶æ€ï¼Œå¹¶ä¸”åœ¨ä¸ä¸¢å¤±è¿è¡Œç¨‹åºçŠ¶æ€çš„æƒ…å†µä¸‹æ¢å¤ç³»ç»Ÿã€‚ÙİIn order for the suspend/resume functionality to work correctly the graphics drivers must be loaded on the system.  In non-KMS-supported graphics cards man:sc[4] must be used not to break the suspend/resume functionality.Ù·ä¸ºäº†ä½¿æŒ‚èµ·/æ¢å¤åŠŸèƒ½æ­£å¸¸å·¥ä½œï¼Œå¿…é¡»åœ¨ç³»ç»Ÿä¸ŠåŠ è½½å›¾å½¢é©±åŠ¨ç¨‹åºã€‚åœ¨ä¸æ”¯æŒ KMS çš„å›¾å½¢å¡ä¸Šï¼Œå¿…é¡»ä½¿ç”¨ man:sc[4] æ¥é¿å…ç ´åæŒ‚èµ·/æ¢å¤åŠŸèƒ½ã€‚Ù†More information about which driver to use and how to configure it can be found at the crossref:x11[x11, The X Window System chapter].Ùyæœ‰å…³ä½¿ç”¨å“ªä¸ªé©±åŠ¨ç¨‹åºä»¥åŠå¦‚ä½•é…ç½®å®ƒçš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜… crossref:x11[X11,X Window ç³»ç»Ÿç« èŠ‚]ã€‚Ù3man:acpi[4] supports the next list of sleep states:Ù0man:acpi[4] æ”¯æŒä»¥ä¸‹ç¡çœ çŠ¶æ€çš„åˆ—è¡¨ï¼š¶Supported Sleep Statesµæ”¯æŒçš„ç¡çœ çŠ¶æ€Ù`Quick suspend to RAM. The CPU enters a lower power state, but most peripherals are left running.Ù_å¿«é€ŸæŒ‚èµ·åˆ° RAMã€‚CPU è¿›å…¥è¾ƒä½çš„åŠŸè€—çŠ¶æ€ï¼Œä½†å¤§å¤šæ•°å¤–è®¾ä»ç„¶ä¿æŒè¿è¡Œã€‚ÙbLower power state than S1, but with the same basic characteristics. Not supported by many systems.Ù[æ¯” S1 æ›´ä½çš„åŠŸè€—çŠ¶æ€ï¼Œä½†å…·æœ‰ç›¸åŒçš„åŸºæœ¬ç‰¹å¾ã€‚ä¸è¢«è®¸å¤šç³»ç»Ÿæ”¯æŒã€‚ÙeSuspend to RAM. Most devices are powered off, and the system stops running except for memory refresh.Ù^æŒ‚èµ·åˆ° RAMã€‚å¤§å¤šæ•°è®¾å¤‡éƒ½å…³é—­ç”µæºï¼Œç³»ç»Ÿåœæ­¢è¿è¡Œï¼Œåªè¿›è¡Œå†…å­˜åˆ·æ–°ã€‚Ù¨Suspend to disk. All devices are powered off, and the system stops running. When resuming, the system starts as if from a cold power on. *Not yet supported by FreeBSD*.Ù—ç£ç›˜æŒ‚èµ·ã€‚æ‰€æœ‰è®¾å¤‡éƒ½è¢«å…³é—­ï¼Œç³»ç»Ÿåœæ­¢è¿è¡Œã€‚åœ¨æ¢å¤æ—¶ï¼Œç³»ç»Ÿä¼šåƒä»å†·å¯åŠ¨ä¸€æ ·å¯åŠ¨ã€‚*FreeBSD å°šä¸æ”¯æŒæ­¤åŠŸèƒ½*ã€‚Ù)System shuts down cleanly and powers off.Ù$ç³»ç»Ÿæ­£å¸¸å…³é—­å¹¶å…³é—­ç”µæºã€‚ºConfiguring Suspend/Resume³é…ç½®æŒ‚èµ·/æ¢å¤Ù}The first step will be to know which type of sleep states supports the hardware we are using executing the following command:Ùiç¬¬ä¸€æ­¥æ˜¯è¦çŸ¥é“æˆ‘ä»¬æ­£åœ¨ä½¿ç”¨çš„ç¡¬ä»¶æ”¯æŒå“ªç§ç±»å‹çš„ç¡çœ çŠ¶æ€ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼šÙ>As stated above FreeBSD does *not* yet support the `S4` state.Ù9å¦‚ä¸Šæ‰€è¿°ï¼Œ FreeBSD ç›®å‰ *ä¸æ”¯æŒ* `S4` çŠ¶æ€ã€‚Ù²man:acpiconf[8] can be used to check if the `S3` state works correctly by running the following command, if it succeeds, the screen should go black and the machine will turn off:Ùman:acpiconf[8] å¯ä»¥é€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥æ£€æŸ¥ `S3` çŠ¶æ€æ˜¯å¦æ­£å¸¸å·¥ä½œï¼Œå¦‚æœæˆåŠŸï¼Œå±å¹•åº”è¯¥å˜é»‘ï¼Œæœºå™¨å°†å…³é—­ï¼šÙ\In the vast majority of cases the Suspend/Resume functionality wants to be used on a laptop.ÙLåœ¨ç»å¤§å¤šæ•°æƒ…å†µä¸‹ï¼ŒæŒ‚èµ·/æ¢å¤åŠŸèƒ½æ˜¯ç”¨äºç¬”è®°æœ¬ç”µè„‘çš„ã€‚ÙFreeBSD can be configured to enter the `S3` state when closing the lid by adding the following line to the [.filename]#/etc/sysctl.conf# file.Ù‹åœ¨å…³é—­ç¬”è®°æœ¬ç›–å­æ—¶ï¼Œå¯ä»¥é€šè¿‡åœ¨ [.filename]#/etc/sysctl.conf# æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹è¡Œæ¥é…ç½® FreeBSD è¿›å…¥ `S3` çŠ¶æ€ã€‚Ù!Troubleshooting in Suspend/Resume¼æŒ‚èµ·/æ¢å¤çš„æ•…éšœæ’é™¤ÙÑA lot of effort has been made to make the Suspend and Resume functions work properly and in the best way on FreeBSD.  But currently the Suspend and Resume functions only work properly on some specific laptops.ÙÉä¸ºäº†ä½¿ FreeBSD ä¸Šçš„æŒ‚èµ·å’Œæ¢å¤åŠŸèƒ½æ­£å¸¸å·¥ä½œå¹¶ä»¥æœ€ä½³æ–¹å¼è¿è¡Œï¼Œå·²ç»ä»˜å‡ºäº†å¾ˆå¤šåŠªåŠ›ã€‚ä½†ç›®å‰ï¼ŒæŒ‚èµ·å’Œæ¢å¤åŠŸèƒ½åªåœ¨ä¸€äº›ç‰¹å®šçš„ç¬”è®°æœ¬ç”µè„‘ä¸Šæ­£å¸¸å·¥ä½œã€‚Ù9Some checks can be done in case it doesn't work properly.Ù9å¦‚æœå®ƒæ— æ³•æ­£å¸¸å·¥ä½œï¼Œå¯ä»¥è¿›è¡Œä¸€äº›æ£€æŸ¥ã€‚Ù„In some cases it is enough to turn off the bluetooth.  In others it is enough loading the correct driver for the graphics card, etc.Ùxåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå…³é—­è“ç‰™å°±è¶³å¤Ÿäº†ã€‚åœ¨å…¶ä»–æƒ…å†µä¸‹ï¼Œåªéœ€åŠ è½½æ­£ç¡®çš„æ˜¾å¡é©±åŠ¨ç¨‹åºç­‰å³å¯ã€‚Ù™In case it doesn't work correctly, some tips can be found on the FreeBSD Wiki in the section link:https://wiki.freebsd.org/SuspendResume[Suspend/Resume].Ùå¦‚æœå®ƒä¸èƒ½æ­£å¸¸å·¥ä½œï¼Œå¯ä»¥åœ¨ FreeBSD Wiki çš„ link:https://wiki.freebsd.org/SuspendResume[Suspend/Resume] éƒ¨åˆ†æ‰¾åˆ°ä¸€äº›æç¤ºã€‚±Adding Swap Space²æ·»åŠ äº¤æ¢ç©ºé—´ÙİSometimes a FreeBSD system requires more swap space.  This section describes two methods to increase swap space: adding swap to an existing partition or new hard drive, and creating a swap file on an existing file system.ÙÏæœ‰æ—¶å€™ FreeBSD ç³»ç»Ÿéœ€è¦æ›´å¤šçš„äº¤æ¢ç©ºé—´ã€‚æœ¬èŠ‚ä»‹ç»äº†ä¸¤ç§å¢åŠ äº¤æ¢ç©ºé—´çš„æ–¹æ³•ï¼šåœ¨ç°æœ‰åˆ†åŒºæˆ–æ–°ç¡¬ç›˜ä¸Šæ·»åŠ äº¤æ¢ç©ºé—´ï¼Œä»¥åŠåœ¨ç°æœ‰æ–‡ä»¶ç³»ç»Ÿä¸Šåˆ›å»ºäº¤æ¢æ–‡ä»¶ã€‚ÙFor information on how to encrypt swap space, which options exist, and why it should be done, refer to crossref:disks[swap-encrypting,â€œEncrypting Swapâ€].Ù¢æœ‰å…³å¦‚ä½•åŠ å¯†äº¤æ¢ç©ºé—´ã€å­˜åœ¨å“ªäº›é€‰é¡¹ä»¥åŠä¸ºä»€ä¹ˆåº”è¯¥è¿™æ ·åšçš„ä¿¡æ¯ï¼Œè¯·å‚è€ƒ crossref:disks[swap-encrypting,â€œåŠ å¯†äº¤æ¢ç©ºé—´â€]ã€‚Ù.Swap on a New Hard Drive or Existing PartitionÙ*åœ¨æ–°ç¡¬ç›˜æˆ–ç°æœ‰åˆ†åŒºä¸Šè¿›è¡Œäº¤æ¢ÚTAdding a new drive for swap gives better performance than using a partition on an existing drive.  Setting up partitions and drives is explained in crossref:disks[disks-adding,"Adding Disks"] while crossref:bsdinstall[configtuning-initial,"Designing the Partition Layout"] discusses partition layouts and swap partition size considerations.ÚJåœ¨ç°æœ‰é©±åŠ¨å™¨ä¸Šä½¿ç”¨åˆ†åŒºç›¸æ¯”ä½¿ç”¨æ–°çš„é©±åŠ¨å™¨è¿›è¡Œäº¤æ¢ä¼šæä¾›æ›´å¥½çš„æ€§èƒ½ã€‚åœ¨ crossref:disks[disks-adding,â€œæ·»åŠ ç£ç›˜â€] ä¸­è§£é‡Šäº†å¦‚ä½•è®¾ç½®åˆ†åŒºå’Œé©±åŠ¨å™¨ï¼Œè€Œ crossref:bsdinstall[configtuning-initial,â€œè®¾è®¡åˆ†åŒºå¸ƒå±€â€] åˆ™è®¨è®ºäº†åˆ†åŒºå¸ƒå±€å’Œäº¤æ¢åˆ†åŒºå¤§å°çš„è€ƒè™‘äº‹é¡¹ã€‚Ú It is possible to use any partition not currently mounted, even if it already contains data.  Using `swapon` on a partition that contains data will overwrite and destroy that data.  Make sure that the partition to be added as swap is really the intended partition before running `swapon`.Ùûå¯ä»¥ä½¿ç”¨ä»»ä½•å½“å‰æœªæŒ‚è½½çš„åˆ†åŒºï¼Œå³ä½¿å®ƒå·²ç»åŒ…å«æ•°æ®ã€‚åœ¨åŒ…å«æ•°æ®çš„åˆ†åŒºä¸Šä½¿ç”¨ `swapon` å‘½ä»¤å°†è¦†ç›–å¹¶é”€æ¯è¯¥æ•°æ®ã€‚åœ¨è¿è¡Œ `swapon` ä¹‹å‰ï¼Œè¯·ç¡®ä¿è¦æ·»åŠ ä¸ºäº¤æ¢åˆ†åŒºçš„åˆ†åŒºç¡®å®æ˜¯é¢„æœŸçš„åˆ†åŒºã€‚Ù`man:swapon[8] can be used to add a swap partition to the system executing the following command:ÙMman:swapon[8] å¯ä»¥ç”¨äºå‘æ‰§è¡Œä»¥ä¸‹å‘½ä»¤çš„ç³»ç»Ÿæ·»åŠ äº¤æ¢åˆ†åŒºï¼šÙZTo automatically add this swap partition on boot, add an entry to [.filename]#/etc/fstab#:Ùdè¦åœ¨å¯åŠ¨æ—¶è‡ªåŠ¨æ·»åŠ æ­¤äº¤æ¢åˆ†åŒºï¼Œè¯·åœ¨ [.filename]#/etc/fstab# ä¸­æ·»åŠ ä¸€ä¸ªæ¡ç›®ï¼šÙNSee man:fstab[5] for an explanation of the entries in [.filename]#/etc/fstab#.ÙMè¯·å‚é˜… man:fstab[5]ï¼Œäº†è§£ [.filename]#/etc/fstab# ä¸­æ¡ç›®çš„è§£é‡Šã€‚´Creating a Swap File²åˆ›å»ºäº¤æ¢æ–‡ä»¶ÙFThese examples create a 512M swap file called [.filename]#/usr/swap0#.ÙOè¿™äº›ç¤ºä¾‹åˆ›å»ºä¸€ä¸ªåä¸º [.filename]#/usr/swap0# çš„ 512M äº¤æ¢æ–‡ä»¶ã€‚Ù^Swap files on ZFS file systems are strongly discouraged, as swapping can lead to system hangs.Ùbå¼ºçƒˆä¸å»ºè®®åœ¨ ZFS æ–‡ä»¶ç³»ç»Ÿä¸Šä½¿ç”¨äº¤æ¢æ–‡ä»¶ï¼Œå› ä¸ºäº¤æ¢å¯èƒ½å¯¼è‡´ç³»ç»ŸæŒ‚èµ·ã€‚Ù*The first step is to create the swap file:Ù!ç¬¬ä¸€æ­¥æ˜¯åˆ›å»ºäº¤æ¢æ–‡ä»¶ï¼šÙAThe second step is to put the proper permissions on the new file:Ù0ç¬¬äºŒæ­¥æ˜¯ç»™æ–°æ–‡ä»¶è®¾ç½®é€‚å½“çš„æƒé™ï¼šÙgThe third step is to inform the system about the swap file by adding a line to [.filename]#/etc/fstab#:Ùjç¬¬ä¸‰æ­¥æ˜¯é€šè¿‡åœ¨ [.filename]#/etc/fstab# ä¸­æ·»åŠ ä¸€è¡Œæ¥é€šçŸ¥ç³»ç»Ÿå…³äºäº¤æ¢æ–‡ä»¶çš„ä¿¡æ¯ï¼šÙ]Swap space will be added on system startup. To add swap space immediately, use man:swapon[8]:Ùfç³»ç»Ÿå¯åŠ¨æ—¶å°†æ·»åŠ äº¤æ¢ç©ºé—´ã€‚è¦ç«‹å³æ·»åŠ äº¤æ¢ç©ºé—´ï¼Œè¯·ä½¿ç”¨ man:swapon[8] å‘½ä»¤ã€‚ÙUThis chapter covers some of the more frequently used network services on UNIX systemsÙ<æœ¬ç« ä»‹ç»äº† UNIX ç³»ç»Ÿä¸Šä¸€äº›å¸¸ç”¨çš„ç½‘ç»œæœåŠ¡ã€‚»Chapter 32. Network Serversºç¬¬ 32 ç«  ç½‘ç»œæœåŠ¡å™¨¯Network Servers¯ç½‘ç»œæœåŠ¡å™¨ÚThis chapter covers some of the more frequently used network services on UNIX(R) systems.  This includes installing, configuring, testing, and maintaining many different types of network services.  Example configuration files are included throughout this chapter for reference.ÙÉæœ¬ç« ä»‹ç»äº† UNIX(R) ç³»ç»Ÿä¸Šä¸€äº›å¸¸ç”¨çš„ç½‘ç»œæœåŠ¡ã€‚è¿™åŒ…æ‹¬å®‰è£…ã€é…ç½®ã€æµ‹è¯•å’Œç»´æŠ¤è®¸å¤šä¸åŒç±»å‹çš„ç½‘ç»œæœåŠ¡ã€‚æœ¬ç« ä¸­è¿˜åŒ…å«äº†ç¤ºä¾‹é…ç½®æ–‡ä»¶ï¼Œä¾›å‚è€ƒä½¿ç”¨ã€‚Ù.By the end of this chapter, readers will know:Ù*åˆ°æœ¬ç« ç»“æŸæ—¶ï¼Œè¯»è€…å°†ä¼šäº†è§£ï¼š¿How to manage the inetd daemon.Ù"å¦‚ä½•ç®¡ç† inetd å®ˆæŠ¤è¿›ç¨‹ã€‚Ù,How to set up the Network File System (NFS).Ù*å¦‚ä½•è®¾ç½®ç½‘ç»œæ–‡ä»¶ç³»ç»Ÿï¼ˆNFSï¼‰ã€‚Ù^How to set up the Network Information Server (NIS) for centralizing and sharing user accounts.ÙTå¦‚ä½•è®¾ç½®ç½‘ç»œä¿¡æ¯æœåŠ¡å™¨ï¼ˆNISï¼‰ä»¥å®ç°ç”¨æˆ·è´¦æˆ·çš„é›†ä¸­å’Œå…±äº«ã€‚Ù8How to set FreeBSD up to act as an LDAP server or clientÙ6å¦‚ä½•å°† FreeBSD è®¾ç½®ä¸º LDAP æœåŠ¡å™¨æˆ–å®¢æˆ·ç«¯Ù4How to set up automatic network settings using DHCP.Ù-å¦‚ä½•ä½¿ç”¨ DHCP è®¾ç½®è‡ªåŠ¨ç½‘ç»œè®¾ç½®ã€‚Ù)How to set up a Domain Name Server (DNS).Ù'å¦‚ä½•è®¾ç½®åŸŸåæœåŠ¡å™¨ï¼ˆDNSï¼‰ã€‚Ù%How to set up the Apache HTTP Server.Ù%å¦‚ä½•è®¾ç½® Apache HTTP æœåŠ¡å™¨ã€‚Ù4How to set up a File Transfer Protocol (FTP) server.Ù9å¦‚ä½•è®¾ç½®ä¸€ä¸ªæ–‡ä»¶ä¼ è¾“åè®®ï¼ˆFTPï¼‰æœåŠ¡å™¨ã€‚ÙIHow to set up a file and print server for Windows(R) clients using Samba.ÙLå¦‚ä½•ä½¿ç”¨ Samba ä¸º Windows(R) å®¢æˆ·ç«¯è®¾ç½®æ–‡ä»¶å’Œæ‰“å°æœåŠ¡å™¨ã€‚ÙeHow to synchronize the time and date, and set up a time server using the Network Time Protocol (NTP).ÙZå¦‚ä½•ä½¿ç”¨ç½‘ç»œæ—¶é—´åè®®ï¼ˆNTPï¼‰åŒæ­¥æ—¶é—´å’Œæ—¥æœŸï¼Œå¹¶è®¾ç½®æ—¶é—´æœåŠ¡å™¨ã€‚´How to set up iSCSI.µå¦‚ä½•è®¾ç½® iSCSIã€‚Ù*This chapter assumes a basic knowledge of:Ù-æœ¬ç« å‡è®¾è¯»è€…å…·å¤‡ä»¥ä¸‹åŸºæœ¬çŸ¥è¯†ï¼š½[.filename]#/etc/rc# scripts.¾[.filename]#/etc/rc# è„šæœ¬ã€‚´Network terminology.¯ç½‘ç»œæœ¯è¯­ã€‚ÙtInstallation of additional third-party software (crossref:ports[ports,Installing Applications: Packages and Ports]).Ùdå®‰è£…é¢å¤–çš„ç¬¬ä¸‰æ–¹è½¯ä»¶ï¼ˆcrossref:ports[ports,å®‰è£…åº”ç”¨ç¨‹åºï¼šè½¯ä»¶åŒ…å’Œ Ports]ï¼‰ã€‚¶The inetd Super-Serverµinetd è¶…çº§æœåŠ¡å™¨Ú)The man:inetd[8] daemon is sometimes referred to as a Super-Server because it manages connections for many services.  Instead of starting multiple applications, only the inetd service needs to be started.  When a connection is received for a service that is managed by inetd, it determines which program the connection is destined for, spawns a process for that program, and delegates the program a socket.  Using inetd for services that are not heavily used can reduce system load, when compared to running each daemon individually in stand-alone mode.ÚÆman:inetd[8] å®ˆæŠ¤è¿›ç¨‹æœ‰æ—¶è¢«ç§°ä¸ºè¶…çº§æœåŠ¡å™¨ï¼Œå› ä¸ºå®ƒç®¡ç†è®¸å¤šæœåŠ¡çš„è¿æ¥ã€‚ä¸éœ€è¦å¯åŠ¨å¤šä¸ªåº”ç”¨ç¨‹åºï¼Œåªéœ€å¯åŠ¨ inetd æœåŠ¡å³å¯ã€‚å½“ inetd æ¥æ”¶åˆ°ç”±å…¶ç®¡ç†çš„æœåŠ¡çš„è¿æ¥æ—¶ï¼Œå®ƒç¡®å®šè¿æ¥æ‰€éœ€çš„ç¨‹åºï¼Œä¸ºè¯¥ç¨‹åºç”Ÿæˆä¸€ä¸ªè¿›ç¨‹ï¼Œå¹¶ä¸ºè¯¥ç¨‹åºåˆ†é…ä¸€ä¸ªå¥—æ¥å­—ã€‚ä¸åœ¨ç‹¬ç«‹æ¨¡å¼ä¸‹å•ç‹¬è¿è¡Œæ¯ä¸ªå®ˆæŠ¤è¿›ç¨‹ç›¸æ¯”ï¼Œä½¿ç”¨ inetd æ¥å¤„ç†ä¸å¸¸ç”¨çš„æœåŠ¡å¯ä»¥å‡å°‘ç³»ç»Ÿè´Ÿè½½ã€‚ÙŸPrimarily, inetd is used to spawn other daemons, but several trivial protocols are handled internally, such as chargen, auth, time, echo, discard, and daytime.Ù–inetd ä¸»è¦ç”¨äºç”Ÿæˆå…¶ä»–å®ˆæŠ¤è¿›ç¨‹ï¼Œä½†ä¹Ÿä¼šå¤„ç†ä¸€äº›å†…éƒ¨çš„ç®€å•åè®®ï¼Œä¾‹å¦‚ chargenã€authã€timeã€echoã€discard å’Œ daytimeã€‚Ù4This section covers the basics of configuring inetd.Ù.æœ¬èŠ‚ä»‹ç»äº†é…ç½® inetd çš„åŸºç¡€çŸ¥è¯†ã€‚²Configuration File¬é…ç½®æ–‡ä»¶Ú›Configuration of inetd is done by editing [.filename]#/etc/inetd.conf#.  Each line of this configuration file represents an application which can be started by inetd.  By default, every line starts with a comment (`+#+`), meaning that inetd is not listening for any applications.  To configure inetd to listen for an application's connections, remove the `+#+` at the beginning of the line for that application.Ú_é…ç½® inetd æ˜¯é€šè¿‡ç¼–è¾‘ [.filename]#/etc/inetd.conf# æ–‡ä»¶æ¥å®Œæˆçš„ã€‚è¯¥é…ç½®æ–‡ä»¶çš„æ¯ä¸€è¡Œè¡¨ç¤ºä¸€ä¸ªå¯ä»¥ç”± inetd å¯åŠ¨çš„åº”ç”¨ç¨‹åºã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯ä¸€è¡Œéƒ½ä»¥æ³¨é‡Šï¼ˆ`+#+`ï¼‰å¼€å¤´ï¼Œè¡¨ç¤º inetd ä¸ç›‘å¬ä»»ä½•åº”ç”¨ç¨‹åºã€‚è¦é…ç½® inetd ç›‘å¬åº”ç”¨ç¨‹åºçš„è¿æ¥ï¼Œè¯·åˆ é™¤è¯¥åº”ç”¨ç¨‹åºè¡Œå¼€å¤´çš„ `+#+`ã€‚ÙfAfter saving your edits, configure inetd to start at system boot by editing [.filename]#/etc/rc.conf#:Ùjåœ¨ä¿å­˜æ‚¨çš„ç¼–è¾‘åï¼Œé€šè¿‡ç¼–è¾‘ [.filename]#/etc/rc.conf# é…ç½® inetd åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶å¯åŠ¨ï¼šÙLTo start inetd now, so that it listens for the service you configured, type:ÙHè¦ç«‹å³å¯åŠ¨ inetdï¼Œä»¥ä¾¿å®ƒç›‘å¬æ‚¨é…ç½®çš„æœåŠ¡ï¼Œè¯·é”®å…¥ï¼šÙoOnce inetd is started, it needs to be notified whenever a modification is made to [.filename]#/etc/inetd.conf#:Ùgä¸€æ—¦ inetd å¯åŠ¨ï¼Œæ¯å½“å¯¹ [.filename]#/etc/inetd.conf# æ–‡ä»¶è¿›è¡Œä¿®æ”¹æ—¶ï¼Œéœ€è¦é€šçŸ¥å®ƒã€‚Ù&Reloading the inetd Configuration File¿é‡æ–°åŠ è½½ inetd é…ç½®æ–‡ä»¶Ù«Typically, the default entry for an application does not need to be edited beyond removing the `+#+`.  In some situations, it may be appropriate to edit the default entry.Ùé€šå¸¸æƒ…å†µä¸‹ï¼Œåº”ç”¨ç¨‹åºçš„é»˜è®¤æ¡ç›®æ— éœ€ç¼–è¾‘ï¼Œåªéœ€åˆ é™¤ `+#+` å³å¯ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¯èƒ½éœ€è¦ç¼–è¾‘é»˜è®¤æ¡ç›®ã€‚ÙCAs an example, this is the default entry for man:ftpd[8] over IPv4:ÙCä½œä¸ºä¸€ä¸ªä¾‹å­ï¼Œè¿™æ˜¯ IPv4 ä¸Š man:ftpd[8] çš„é»˜è®¤æ¡ç›®ï¼šÙ-The seven columns in an entry are as follows:Ù!ä¸€ä¸ªæ¡ç›®ä¸­çš„ä¸ƒåˆ—å¦‚ä¸‹ï¼š¦where:¬åœ¨å“ªé‡Œï¼š¬service-name¬æœåŠ¡åç§°ÚThe service name of the daemon to start.  It must correspond to a service listed in [.filename]#/etc/services#.  This determines which port inetd listens on for incoming connections to that service.  When using a custom service, it must first be added to [.filename]#/etc/services#.Úè¦å¯åŠ¨çš„å®ˆæŠ¤è¿›ç¨‹çš„æœåŠ¡åç§°ã€‚å®ƒå¿…é¡»å¯¹åº”äº [.filename]#/etc/services# ä¸­åˆ—å‡ºçš„æœåŠ¡ã€‚è¿™å†³å®šäº† inetd ç›‘å¬å“ªä¸ªç«¯å£ä»¥æ¥æ”¶è¯¥æœåŠ¡çš„ä¼ å…¥è¿æ¥ã€‚å½“ä½¿ç”¨è‡ªå®šä¹‰æœåŠ¡æ—¶ï¼Œå¿…é¡»é¦–å…ˆå°†å…¶æ·»åŠ åˆ° [.filename]#/etc/services# ä¸­ã€‚«socket-type¯å¥—æ¥å­—ç±»å‹ÙpEither `stream`, `dgram`, `raw`, or `seqpacket`.  Use `stream` for TCP connections and `dgram` for UDP services.Ù’å¯ä»¥ä½¿ç”¨ `stream` ã€ `dgram` ã€ `raw` æˆ– `seqpacket` ã€‚å¯¹äº TCP è¿æ¥ï¼Œè¯·ä½¿ç”¨ `stream` ï¼Œå¯¹äº UDP æœåŠ¡ï¼Œè¯·ä½¿ç”¨ `dgram` ã€‚¨protocol¦åè®®Ù(Use one of the following protocol names:Ù!ä½¿ç”¨ä»¥ä¸‹åè®®åç§°ä¹‹ä¸€ï¼š­Protocol Name¬åè®®åç§°«Explanation¦è§£é‡ŠÙŞ{wait|nowait}[/max-child[/max-connections-per-ip-per-minute[/max-child-per-ip]]]:: In this field, `wait` or `nowait` must be specified.  `max-child`, `max-connections-per-ip-per-minute` and `max-child-per-ip` are optional.Ùã{wait|nowait}[/max-child[/max-connections-per-ip-per-minute[/max-child-per-ip]]]:: åœ¨è¿™ä¸ªå­—æ®µä¸­ï¼Œå¿…é¡»æŒ‡å®š `wait` æˆ– `nowait`ã€‚`max-child`ã€`max-connections-per-ip-per-minute` å’Œ `max-child-per-ip` æ˜¯å¯é€‰çš„ã€‚ÚB`wait|nowait` indicates whether or not the service is able to handle its own socket.  `dgram` socket types must use `wait` while `stream` daemons, which are usually multi-threaded, should use `nowait`.  `wait` usually hands off multiple sockets to a single daemon, while `nowait` spawns a child daemon for each new socket.Ú7`wait|nowait` è¡¨ç¤ºæœåŠ¡æ˜¯å¦èƒ½å¤Ÿå¤„ç†è‡ªå·±çš„å¥—æ¥å­—ã€‚`dgram` å¥—æ¥å­—ç±»å‹å¿…é¡»ä½¿ç”¨ `wait`ï¼Œè€Œé€šå¸¸æ˜¯å¤šçº¿ç¨‹çš„ `stream` å®ˆæŠ¤è¿›ç¨‹åº”è¯¥ä½¿ç”¨ `nowait`ã€‚`wait` é€šå¸¸å°†å¤šä¸ªå¥—æ¥å­—äº¤ç»™å•ä¸ªå®ˆæŠ¤è¿›ç¨‹å¤„ç†ï¼Œè€Œ `nowait` åˆ™ä¸ºæ¯ä¸ªæ–°å¥—æ¥å­—ç”Ÿæˆä¸€ä¸ªå­å®ˆæŠ¤è¿›ç¨‹ã€‚ÙÕThe maximum number of child daemons inetd may spawn is set by `max-child`.  For example, to limit ten instances of the daemon, place a `/10` after `nowait`.  Specifying `/0` allows an unlimited number of children.Ùİ`max-child` å‚æ•°è®¾ç½®äº† inetd å¯ä»¥ç”Ÿæˆçš„å­å®ˆæŠ¤è¿›ç¨‹çš„æœ€å¤§æ•°é‡ã€‚ä¾‹å¦‚ï¼Œè¦é™åˆ¶å®ˆæŠ¤è¿›ç¨‹çš„å®ä¾‹æ•°ä¸ºåä¸ªï¼Œå¯ä»¥åœ¨ `nowait` åé¢åŠ ä¸Š `/10`ã€‚æŒ‡å®š `/0` å…è®¸æ— é™æ•°é‡çš„å­è¿›ç¨‹ã€‚Ú3`max-connections-per-ip-per-minute` limits the number of connections from any particular IP address per minute.  Once the limit is reached, further connections from this IP address will be dropped until the end of the minute.  For example, a value of `/10` would limit any particular IP address to ten connection attempts per minute.  `max-child-per-ip` limits the number of child processes that can be started on behalf on any single IP address at any moment.  These options can limit excessive resource consumption and help to prevent Denial of Service attacks.Ú¹`max-connections-per-ip-per-minute` é™åˆ¶æ¯ä¸ªç‰¹å®š IP åœ°å€æ¯åˆ†é’Ÿçš„è¿æ¥æ•°ã€‚ä¸€æ—¦è¾¾åˆ°é™åˆ¶ï¼Œè¯¥ IP åœ°å€çš„è¿›ä¸€æ­¥è¿æ¥å°†è¢«ä¸¢å¼ƒï¼Œç›´åˆ°åˆ†é’Ÿç»“æŸã€‚ä¾‹å¦‚ï¼Œå€¼ä¸º `/10` å°†é™åˆ¶æ¯ä¸ªç‰¹å®š IP åœ°å€æ¯åˆ†é’Ÿçš„è¿æ¥å°è¯•æ¬¡æ•°ä¸ºåæ¬¡ã€‚`max-child-per-ip` é™åˆ¶åœ¨ä»»ä½•å•ä¸ª IP åœ°å€ä¸Šä»£è¡¨å¯åŠ¨çš„å­è¿›ç¨‹æ•°é‡ã€‚è¿™äº›é€‰é¡¹å¯ä»¥é™åˆ¶è¿‡åº¦çš„èµ„æºæ¶ˆè€—ï¼Œå¹¶å¸®åŠ©é˜²æ­¢æ‹’ç»æœåŠ¡æ”»å‡»ã€‚ÙBAn example can be seen in the default settings for man:fingerd[8]:Ù@åœ¨ man:fingerd[8] çš„é»˜è®¤è®¾ç½®ä¸­å¯ä»¥çœ‹åˆ°ä¸€ä¸ªç¤ºä¾‹ï¼š¤user¦ç”¨æˆ·Ù]The username the daemon will run as.  Daemons typically run as `root`, `daemon`, or `nobody`.Ùhå®ˆæŠ¤è¿›ç¨‹å°†ä»¥å“ªä¸ªç”¨æˆ·åè¿è¡Œã€‚å®ˆæŠ¤è¿›ç¨‹é€šå¸¸ä»¥ `root`ã€`daemon` æˆ– `nobody` è¿è¡Œã€‚®server-program¯æœåŠ¡å™¨ç¨‹åºÙfThe full path to the daemon.  If the daemon is a service provided by inetd internally, use `internal`.Ùmå®ˆæŠ¤è¿›ç¨‹çš„å®Œæ•´è·¯å¾„ã€‚å¦‚æœå®ˆæŠ¤è¿›ç¨‹æ˜¯ç”± inetd å†…éƒ¨æä¾›çš„æœåŠ¡ï¼Œè¯·ä½¿ç”¨ `internal` ã€‚¸server-program-argumentsµæœåŠ¡å™¨ç¨‹åºå‚æ•°Ù†Used to specify any command arguments to be passed to the daemon on invocation.  If the daemon is an internal service, use `internal`.Ùç”¨äºæŒ‡å®šåœ¨è°ƒç”¨å®ˆæŠ¤ç¨‹åºæ—¶è¦ä¼ é€’çš„ä»»ä½•å‘½ä»¤å‚æ•°ã€‚å¦‚æœå®ˆæŠ¤ç¨‹åºæ˜¯å†…éƒ¨æœåŠ¡ï¼Œè¯·ä½¿ç”¨ `internal` ã€‚´Command-Line Options¯å‘½ä»¤è¡Œé€‰é¡¹Ú8Like most server daemons, inetd has a number of options that can be used to modify its behavior.  By default, inetd is started with `-wW -C 60`.  These options enable TCP wrappers for all services, including internal services, and prevent any IP address from requesting any service more than 60 times per minute.Ú#åƒå¤§å¤šæ•°æœåŠ¡å™¨å®ˆæŠ¤ç¨‹åºä¸€æ ·ï¼Œ inetd æœ‰ä¸€äº›é€‰é¡¹å¯ä»¥ç”¨æ¥ä¿®æ”¹å…¶è¡Œä¸ºã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œinetd ä½¿ç”¨ `-wW -C 60` å¯åŠ¨ã€‚è¿™äº›é€‰é¡¹å¯ç”¨äº†æ‰€æœ‰æœåŠ¡çš„ TCP åŒ…è£…å™¨ï¼ŒåŒ…æ‹¬å†…éƒ¨æœåŠ¡ï¼Œå¹¶é˜²æ­¢ä»»ä½• IP åœ°å€åœ¨ä¸€åˆ†é’Ÿå†…è¯·æ±‚è¶…è¿‡ 60 æ¬¡çš„æœåŠ¡ã€‚Ù¼To change the default options which are passed to inetd, add an entry for `inetd_flags` in [.filename]#/etc/rc.conf#.  If inetd is already running, restart it with `service inetd restart`.Ù»è¦æ›´æ”¹ä¼ é€’ç»™ inetd çš„é»˜è®¤é€‰é¡¹ï¼Œè¯·åœ¨ `/etc/rc.conf` ä¸­æ·»åŠ ä¸€ä¸ª `inetd_flags` æ¡ç›®ã€‚å¦‚æœ inetd å·²ç»åœ¨è¿è¡Œï¼Œè¯·ä½¿ç”¨ `service inetd restart` é‡æ–°å¯åŠ¨å®ƒã€‚Ù(The available rate limiting options are:Ù!å¯ç”¨çš„é€Ÿç‡é™åˆ¶é€‰é¡¹æœ‰ï¼šª-c maximum¬-c æœ€å¤§å€¼ÙÏSpecify the default maximum number of simultaneous invocations of each service, where the default is unlimited.  May be overridden on a per-service basis by using `max-child` in [.filename]#/etc/inetd.conf#.Ù»æŒ‡å®šæ¯ä¸ªæœåŠ¡çš„é»˜è®¤æœ€å¤§å¹¶å‘è°ƒç”¨æ•°ï¼Œå…¶ä¸­é»˜è®¤å€¼ä¸ºæ— é™åˆ¶ã€‚å¯ä»¥é€šè¿‡åœ¨ [.filename]#/etc/inetd.conf# ä¸­ä½¿ç”¨ `max-child` æ¥å¯¹æ¯ä¸ªæœåŠ¡è¿›è¡Œå•ç‹¬è®¾ç½®ã€‚§-C rate©-C é€Ÿç‡ÙáSpecify the default maximum number of times a service can be invoked from a single IP address per minute.  May be overridden on a per-service basis by using `max-connections-per-ip-per-minute` in [.filename]#/etc/inetd.conf#.ÙÈæŒ‡å®šå•ä¸ª IP åœ°å€æ¯åˆ†é’Ÿå¯ä»¥è°ƒç”¨æœåŠ¡çš„é»˜è®¤æœ€å¤§æ¬¡æ•°ã€‚å¯ä»¥é€šè¿‡åœ¨ [.filename]#/etc/inetd.conf# ä¸­ä½¿ç”¨ `max-connections-per-ip-per-minute` æ¥è¦†ç›–æ¯ä¸ªæœåŠ¡çš„åŸºç¡€ä¸Šã€‚§-R rate©-R é€Ÿç‡Ù’Specify the maximum number of times a service can be invoked in one minute, where the default is `256`.  A rate of `0` allows an unlimited number.ÙŠæŒ‡å®šä¸€ä¸ªæœåŠ¡åœ¨ä¸€åˆ†é’Ÿå†…å¯ä»¥è¢«è°ƒç”¨çš„æœ€å¤§æ¬¡æ•°ï¼Œå…¶ä¸­é»˜è®¤å€¼ä¸º `256` ã€‚è®¾ç½®ä¸º `0` è¡¨ç¤ºå…è®¸æ— é™æ¬¡è°ƒç”¨ã€‚ª-s maximum¬-s æœ€å¤§å€¼ÙíSpecify the maximum number of times a service can be invoked from a single IP address at any one time, where the default is unlimited.  May be overridden on a per-service basis by using `max-child-per-ip` in [.filename]#/etc/inetd.conf#.ÙØæŒ‡å®šå•ä¸ª IP åœ°å€åœ¨ä»»ä½•ä¸€æ¬¡ä¸­å¯ä»¥è°ƒç”¨æœåŠ¡çš„æœ€å¤§æ¬¡æ•°ï¼Œå…¶ä¸­é»˜è®¤å€¼ä¸ºæ— é™ã€‚å¯ä»¥é€šè¿‡åœ¨ [.filename]#/etc/inetd.conf# ä¸­ä½¿ç”¨ `max-child-per-ip` æ¥è¦†ç›–æ¯ä¸ªæœåŠ¡çš„åŸºç¡€è®¾ç½®ã€‚ÙUAdditional options are available. Refer to man:inetd[8] for the full list of options.ÙPè¿˜æœ‰å…¶ä»–é€‰é¡¹å¯ç”¨ã€‚è¯·å‚è€ƒ man:inetd[8] è·å–å®Œæ•´çš„é€‰é¡¹åˆ—è¡¨ã€‚ÚyMany of the daemons which can be managed by inetd are not security-conscious.  Some daemons, such as fingerd, can provide information that may be useful to an attacker.  Only enable the services which are needed and monitor the system for excessive connection attempts.  `max-connections-per-ip-per-minute`, `max-child` and `max-child-per-ip` can be used to limit such attacks.ÚOè®¸å¤šå¯ä»¥ç”± inetd ç®¡ç†çš„å®ˆæŠ¤è¿›ç¨‹å¹¶ä¸æ³¨é‡å®‰å…¨æ€§ã€‚ä¸€äº›å®ˆæŠ¤è¿›ç¨‹ï¼Œæ¯”å¦‚ fingerdï¼Œå¯èƒ½æä¾›å¯¹æ”»å‡»è€…æœ‰ç”¨çš„ä¿¡æ¯ã€‚åªå¯ç”¨æ‰€éœ€çš„æœåŠ¡ï¼Œå¹¶ç›‘æ§ç³»ç»Ÿæ˜¯å¦å­˜åœ¨è¿‡å¤šçš„è¿æ¥å°è¯•ã€‚å¯ä»¥ä½¿ç”¨ `max-connections-per-ip-per-minute`ã€`max-child` å’Œ `max-child-per-ip` æ¥é™åˆ¶æ­¤ç±»æ”»å‡»ã€‚Ù•By default, TCP wrappers are enabled.  Consult man:hosts_access[5] for more information on placing TCP restrictions on various inetd invoked daemons.Ù£é»˜è®¤æƒ…å†µä¸‹ï¼ŒTCP åŒ…è£…å™¨æ˜¯å¯ç”¨çš„ã€‚è¯·å‚è€ƒ man:hosts_access[5] äº†è§£å¦‚ä½•åœ¨å„ç§ inetd è°ƒç”¨çš„å®ˆæŠ¤è¿›ç¨‹ä¸Šè®¾ç½® TCP é™åˆ¶çš„æ›´å¤šä¿¡æ¯ã€‚¹Network File System (NFS)»ç½‘ç»œæ–‡ä»¶ç³»ç»Ÿï¼ˆNFSï¼‰ÙâFreeBSD supports the Network File System (NFS), which allows a server to share directories and files with clients over a network.  With NFS, users and programs can access files on remote systems as if they were stored locally.ÙÕFreeBSD æ”¯æŒç½‘ç»œæ–‡ä»¶ç³»ç»Ÿï¼ˆNFSï¼‰ï¼Œå®ƒå…è®¸æœåŠ¡å™¨é€šè¿‡ç½‘ç»œä¸å®¢æˆ·ç«¯å…±äº«ç›®å½•å’Œæ–‡ä»¶ã€‚ä½¿ç”¨ NFSï¼Œç”¨æˆ·å’Œç¨‹åºå¯ä»¥åƒè®¿é—®æœ¬åœ°å­˜å‚¨çš„æ–‡ä»¶ä¸€æ ·è®¿é—®è¿œç¨‹ç³»ç»Ÿä¸Šçš„æ–‡ä»¶ã€‚ÙCNFS has many practical uses.  Some of the more common uses include:Ù@NFS æœ‰è®¸å¤šå®é™…ç”¨é€”ã€‚å…¶ä¸­ä¸€äº›å¸¸è§çš„ç”¨é€”åŒ…æ‹¬ï¼šÙData that would otherwise be duplicated on each client can be kept in a single location and accessed by clients on the network.Ù“åœ¨ç½‘ç»œä¸Šï¼ŒåŸæœ¬éœ€è¦åœ¨æ¯ä¸ªå®¢æˆ·ç«¯ä¸Šé‡å¤çš„æ•°æ®å¯ä»¥ä¿å­˜åœ¨ä¸€ä¸ªå•ä¸€çš„ä½ç½®ï¼Œå¹¶ä¸”å¯ä»¥è¢«ç½‘ç»œä¸Šçš„å®¢æˆ·ç«¯è®¿é—®ã€‚ÙÆSeveral clients may need access to the [.filename]#/usr/ports/distfiles# directory. Sharing that directory allows for quick access to the source files without having to download them to each client.Ù§å¤šä¸ªå®¢æˆ·ç«¯å¯èƒ½éœ€è¦è®¿é—® [.filename]#/usr/ports/distfiles# ç›®å½•ã€‚å…±äº«è¯¥ç›®å½•å¯ä»¥å¿«é€Ÿè®¿é—®æºæ–‡ä»¶ï¼Œè€Œæ— éœ€å°†å®ƒä»¬ä¸‹è½½åˆ°æ¯ä¸ªå®¢æˆ·ç«¯ã€‚ÙŞOn large networks, it is often more convenient to configure a central NFS server on which all user home directories are stored. Users can log into a client anywhere on the network and have access to their home directories.ÙÂåœ¨å¤§å‹ç½‘ç»œä¸­ï¼Œé€šå¸¸æ›´æ–¹ä¾¿åœ°é…ç½®ä¸€ä¸ªä¸­å¤® NFS æœåŠ¡å™¨ï¼Œç”¨äºå­˜å‚¨æ‰€æœ‰ç”¨æˆ·çš„ä¸»ç›®å½•ã€‚ç”¨æˆ·å¯ä»¥åœ¨ç½‘ç»œä¸­çš„ä»»ä½•å®¢æˆ·ç«¯ç™»å½•ï¼Œå¹¶è®¿é—®ä»–ä»¬çš„ä¸»ç›®å½•ã€‚Ù†Administration of NFS exports is simplified. For example, there is only one file system where security or backup policies must be set.ÙsNFS å¯¼å‡ºçš„ç®¡ç†å˜å¾—æ›´åŠ ç®€åŒ–ã€‚ä¾‹å¦‚ï¼Œåªéœ€è¦åœ¨ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿä¸­è®¾ç½®å®‰å…¨æ€§æˆ–å¤‡ä»½ç­–ç•¥ã€‚Ú1Removable media storage devices can be used by other machines on the network. This reduces the number of devices throughout the network and provides a centralized location to manage their security. It is often more convenient to install software on multiple machines from a centralized installation media.Ùêå¯ç§»åŠ¨åª’ä½“å­˜å‚¨è®¾å¤‡å¯ä»¥è¢«ç½‘ç»œä¸Šçš„å…¶ä»–æœºå™¨ä½¿ç”¨ã€‚è¿™å‡å°‘äº†ç½‘ç»œä¸­è®¾å¤‡çš„æ•°é‡ï¼Œå¹¶æä¾›äº†ä¸€ä¸ªé›†ä¸­ç®¡ç†å®‰å…¨æ€§çš„ä½ç½®ã€‚ä»é›†ä¸­å®‰è£…åª’ä½“ä¸Šå®‰è£…è½¯ä»¶åˆ°å¤šå°æœºå™¨ä¸Šé€šå¸¸æ›´åŠ æ–¹ä¾¿ã€‚ÙÚNFS consists of a server and one or more clients.  The client remotely accesses the data that is stored on the server machine.  In order for this to function properly, a few processes have to be configured and running.ÙµNFS ç”±ä¸€ä¸ªæœåŠ¡å™¨å’Œä¸€ä¸ªæˆ–å¤šä¸ªå®¢æˆ·ç«¯ç»„æˆã€‚å®¢æˆ·ç«¯è¿œç¨‹è®¿é—®å­˜å‚¨åœ¨æœåŠ¡å™¨æœºå™¨ä¸Šçš„æ•°æ®ã€‚ä¸ºäº†ä½¿å…¶æ­£å¸¸è¿è¡Œï¼Œéœ€è¦é…ç½®å’Œè¿è¡Œä¸€äº›è¿›ç¨‹ã€‚Ù,These daemons must be running on the server:Ù0è¿™äº›å®ˆæŠ¤è¿›ç¨‹å¿…é¡»åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œï¼š¦Daemon¬å®ˆæŠ¤è¿›ç¨‹Ù8The NFS daemon which services requests from NFS clients.Ù6NFS å®ˆæŠ¤è¿›ç¨‹è´Ÿè´£ä¸º NFS å®¢æˆ·ç«¯æä¾›æœåŠ¡ã€‚ÙCThe NFS mount daemon which carries out requests received from nfsd.Ù@NFS æŒ‚è½½å®ˆæŠ¤è¿›ç¨‹è´Ÿè´£å¤„ç†ä» nfsd æ¥æ”¶åˆ°çš„è¯·æ±‚ã€‚ÙNThis daemon allows NFS clients to discover which port the NFS server is using.ÙOè¯¥å®ˆæŠ¤è¿›ç¨‹å…è®¸ NFS å®¢æˆ·ç«¯å‘ç° NFS æœåŠ¡å™¨æ­£åœ¨ä½¿ç”¨çš„ç«¯å£ã€‚ÙQRunning man:nfsiod[8] on the client can improve performance, but is not required.ÙJåœ¨å®¢æˆ·ç«¯ä¸Šè¿è¡Œ nfsiod[8] å¯ä»¥æé«˜æ€§èƒ½ï¼Œä½†ä¸æ˜¯å¿…éœ€çš„ã€‚¶Configuring the Server¯é…ç½®æœåŠ¡å™¨ÚÃThe file systems which the NFS server will share are specified in [.filename]#/etc/exports#.  Each line in this file specifies a file system to be exported, which clients have access to that file system, and any access options.  When adding entries to this file, each exported file system, its properties, and allowed hosts must occur on a single line.  If no clients are listed in the entry, then any client on the network can mount that file system.Ú·NFS æœåŠ¡å™¨å°†å…±äº«çš„æ–‡ä»¶ç³»ç»Ÿåœ¨ [.filename]#/etc/exports# æ–‡ä»¶ä¸­æŒ‡å®šã€‚è¯¥æ–‡ä»¶ä¸­çš„æ¯ä¸€è¡Œéƒ½æŒ‡å®šäº†è¦å¯¼å‡ºçš„æ–‡ä»¶ç³»ç»Ÿï¼Œå®¢æˆ·ç«¯å¯¹è¯¥æ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ä»¥åŠä»»ä½•è®¿é—®é€‰é¡¹ã€‚åœ¨å‘è¯¥æ–‡ä»¶æ·»åŠ æ¡ç›®æ—¶ï¼Œæ¯ä¸ªå¯¼å‡ºçš„æ–‡ä»¶ç³»ç»Ÿã€å…¶å±æ€§å’Œå…è®¸çš„ä¸»æœºå¿…é¡»å‡ºç°åœ¨åŒä¸€è¡Œä¸Šã€‚å¦‚æœæ¡ç›®ä¸­æ²¡æœ‰åˆ—å‡ºå®¢æˆ·ç«¯ï¼Œåˆ™ä»»ä½•ç½‘ç»œä¸Šçš„å®¢æˆ·ç«¯éƒ½å¯ä»¥æŒ‚è½½è¯¥æ–‡ä»¶ç³»ç»Ÿã€‚ÚIThe following [.filename]#/etc/exports# entries demonstrate how to export file systems.  The examples can be modified to match the file systems and client names on the reader's network.  There are many options that can be used in this file, but only a few will be mentioned here.  See man:exports[5] for the full list of options.Ú9ä»¥ä¸‹æ˜¯ç¤ºä¾‹çš„ [.filename]#/etc/exports# æ¡ç›®ï¼Œæ¼”ç¤ºäº†å¦‚ä½•å¯¼å‡ºæ–‡ä»¶ç³»ç»Ÿã€‚è¿™äº›ç¤ºä¾‹å¯ä»¥æ ¹æ®è¯»è€…ç½‘ç»œä¸Šçš„æ–‡ä»¶ç³»ç»Ÿå’Œå®¢æˆ·ç«¯åç§°è¿›è¡Œä¿®æ”¹ã€‚åœ¨æ­¤æ–‡ä»¶ä¸­å¯ä»¥ä½¿ç”¨è®¸å¤šé€‰é¡¹ï¼Œä½†è¿™é‡Œåªæåˆ°äº†ä¸€äº›ã€‚æœ‰å…³æ‰€æœ‰é€‰é¡¹çš„å®Œæ•´åˆ—è¡¨ï¼Œè¯·å‚é˜… man:exports[5] ã€‚ÙjThis example shows how to export [.filename]#/cdrom# to three hosts named _alpha_, _bravo_, and _charlie_:Ùuè¿™ä¸ªç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•å°† [.filename]#/cdrom# å¯¼å‡ºåˆ°åä¸º _alpha_ã€_bravo_ å’Œ _charlie_ çš„ä¸‰å°ä¸»æœºï¼šÚThe `-ro` flag makes the file system read-only, preventing clients from making any changes to the exported file system.  This example assumes that the host names are either in DNS or in [.filename]#/etc/hosts#.  Refer to man:hosts[5] if the network does not have a DNS server.Ùş`-ro` æ ‡å¿—ä½¿æ–‡ä»¶ç³»ç»Ÿå˜ä¸ºåªè¯»ï¼Œé˜²æ­¢å®¢æˆ·ç«¯å¯¹å¯¼å‡ºçš„æ–‡ä»¶ç³»ç»Ÿè¿›è¡Œä»»ä½•æ›´æ”¹ã€‚æ­¤ç¤ºä¾‹å‡è®¾ä¸»æœºåè¦ä¹ˆåœ¨ DNS ä¸­ï¼Œè¦ä¹ˆåœ¨ [.filename]#/etc/hosts# æ–‡ä»¶ä¸­ã€‚å¦‚æœç½‘ç»œæ²¡æœ‰ DNS æœåŠ¡å™¨ï¼Œè¯·å‚è€ƒ `man:hosts[5]`ã€‚ÚqThe next example exports [.filename]#/home# to three clients by IP address.  This can be useful for networks without DNS or [.filename]#/etc/hosts# entries.  The `-alldirs` flag allows subdirectories to be mount points.  In other words, it will not automatically mount the subdirectories, but will permit the client to mount the directories that are required as needed.Ú;ä¸‹é¢çš„ç¤ºä¾‹é€šè¿‡ IP åœ°å€å°† [.filename]#/home# å¯¼å‡ºç»™ä¸‰ä¸ªå®¢æˆ·ç«¯ã€‚è¿™å¯¹äºæ²¡æœ‰ DNS æˆ– [.filename]#/etc/hosts# æ¡ç›®çš„ç½‘ç»œéå¸¸æœ‰ç”¨ã€‚ `-alldirs` æ ‡å¿—å…è®¸å­ç›®å½•ä½œä¸ºæŒ‚è½½ç‚¹ã€‚æ¢å¥è¯è¯´ï¼Œå®ƒä¸ä¼šè‡ªåŠ¨æŒ‚è½½å­ç›®å½•ï¼Œä½†ä¼šå…è®¸å®¢æˆ·ç«¯æ ¹æ®éœ€è¦æŒ‚è½½æ‰€éœ€çš„ç›®å½•ã€‚Ú‘This next example exports [.filename]#/a# so that two clients from different domains may access that file system.  The `-maproot=root` allows `root` on the remote system to write data on the exported file system as `root`.  If `-maproot=root` is not specified, the client's `root` user will be mapped to the server's `nobody` account and will be subject to the access limitations defined for `nobody`.Ú„ä¸‹ä¸€ä¸ªç¤ºä¾‹å°† [.filename]#/a# å¯¼å‡ºï¼Œä»¥ä¾¿æ¥è‡ªä¸åŒåŸŸçš„ä¸¤ä¸ªå®¢æˆ·ç«¯å¯ä»¥è®¿é—®è¯¥æ–‡ä»¶ç³»ç»Ÿã€‚`-maproot=root` å…è®¸è¿œç¨‹ç³»ç»Ÿä¸Šçš„ `root` ç”¨æˆ·ä»¥ `root` èº«ä»½åœ¨å¯¼å‡ºçš„æ–‡ä»¶ç³»ç»Ÿä¸Šå†™å…¥æ•°æ®ã€‚å¦‚æœæœªæŒ‡å®š `-maproot=root` ï¼Œå®¢æˆ·ç«¯çš„ `root` ç”¨æˆ·å°†è¢«æ˜ å°„åˆ°æœåŠ¡å™¨çš„ `nobody` è´¦æˆ·ï¼Œå¹¶å—åˆ°ä¸º `nobody` å®šä¹‰çš„è®¿é—®é™åˆ¶çš„çº¦æŸã€‚Ù¶A client can only be specified once per file system.  For example, if [.filename]#/usr# is a single file system, these entries would be invalid as both entries specify the same host:ÙÇæ¯ä¸ªæ–‡ä»¶ç³»ç»Ÿåªèƒ½æŒ‡å®šä¸€ä¸ªå®¢æˆ·ç«¯ã€‚ä¾‹å¦‚ï¼Œå¦‚æœ [.filename]#/usr# æ˜¯ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶ç³»ç»Ÿï¼Œé‚£ä¹ˆè¿™äº›æ¡ç›®å°†æ˜¯æ— æ•ˆçš„ï¼Œå› ä¸ºä¸¤ä¸ªæ¡ç›®éƒ½æŒ‡å®šäº†ç›¸åŒçš„ä¸»æœºï¼šÙ:The correct format for this situation is to use one entry:Ù<åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ­£ç¡®çš„æ ¼å¼æ˜¯ä½¿ç”¨ä¸€ä¸ªæ¡ç›®ï¼šÙ}The following is an example of a valid export list, where [.filename]#/usr# and [.filename]#/exports# are local file systems:Ùxä¸‹é¢æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„å¯¼å‡ºåˆ—è¡¨ç¤ºä¾‹ï¼Œå…¶ä¸­ [.filename]#/usr# å’Œ [.filename]#/exports# æ˜¯æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿï¼šÙpTo enable the processes required by the NFS server at boot time, add these options to [.filename]#/etc/rc.conf#:Ùwè¦åœ¨å¯åŠ¨æ—¶å¯ç”¨ NFS æœåŠ¡å™¨æ‰€éœ€çš„è¿›ç¨‹ï¼Œè¯·å°†ä»¥ä¸‹é€‰é¡¹æ·»åŠ åˆ° [.filename]#/etc/rc.conf# æ–‡ä»¶ä¸­ï¼šÙ6The server can be started now by running this command:Ù9ç°åœ¨å¯ä»¥é€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥å¯åŠ¨æœåŠ¡å™¨ï¼šÙ÷Whenever the NFS server is started, mountd also starts automatically.  However, mountd only reads [.filename]#/etc/exports# when it is started.  To make subsequent [.filename]#/etc/exports# edits take effect immediately, force mountd to reread it:Ùğæ¯å½“ NFS æœåŠ¡å™¨å¯åŠ¨æ—¶ï¼Œmountd ä¹Ÿä¼šè‡ªåŠ¨å¯åŠ¨ã€‚ç„¶è€Œï¼Œmountd åªåœ¨å¯åŠ¨æ—¶è¯»å– [.filename]#/etc/exports# æ–‡ä»¶ã€‚ä¸ºäº†ä½¿åç»­å¯¹ [.filename]#/etc/exports# æ–‡ä»¶çš„ç¼–è¾‘ç«‹å³ç”Ÿæ•ˆï¼Œå¼ºåˆ¶ mountd é‡æ–°è¯»å–å®ƒï¼šÙBRefer to man:nfsv4[4] for a description of an NFS Version 4 setup.Ù=è¯·å‚è€ƒ man:nfsv4[4] äº†è§£ NFS ç‰ˆæœ¬ 4 çš„è®¾ç½®æè¿°ã€‚¶Configuring the Client¯é…ç½®å®¢æˆ·ç«¯ÙRTo enable NFS clients, set this option in each client's [.filename]#/etc/rc.conf#:Ùhè¦å¯ç”¨ NFS å®¢æˆ·ç«¯ï¼Œè¯·åœ¨æ¯ä¸ªå®¢æˆ·ç«¯çš„ [.filename]#/etc/rc.conf# æ–‡ä»¶ä¸­è®¾ç½®æ­¤é€‰é¡¹ï¼šÙ*Then, run this command on each NFS client:Ù8ç„¶åï¼Œåœ¨æ¯ä¸ª NFS å®¢æˆ·ç«¯ä¸Šè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼šÙõThe client now has everything it needs to mount a remote file system.  In these examples, the server's name is `server` and the client's name is `client`.  To mount [.filename]#/home# on `server` to the [.filename]#/mnt# mount point on `client`:Úå®¢æˆ·ç«¯ç°åœ¨å·²ç»æ‹¥æœ‰äº†æŒ‚è½½è¿œç¨‹æ–‡ä»¶ç³»ç»Ÿæ‰€éœ€çš„ä¸€åˆ‡ã€‚åœ¨è¿™äº›ç¤ºä¾‹ä¸­ï¼ŒæœåŠ¡å™¨çš„åç§°æ˜¯ `server`ï¼Œå®¢æˆ·ç«¯çš„åç§°æ˜¯ `client`ã€‚è¦å°† `server` ä¸Šçš„ [.filename]#/home# æŒ‚è½½åˆ° `client` ä¸Šçš„ [.filename]#/mnt# æŒ‚è½½ç‚¹ï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼šÙvThe files and directories in [.filename]#/home# will now be available on `client`, in the [.filename]#/mnt# directory.Ùyç°åœ¨ï¼Œä½äº [.filename]#/home# ç›®å½•ä¸­çš„æ–‡ä»¶å’Œç›®å½•å°†åœ¨ `client` ä¸Šçš„ [.filename]#/mnt# ç›®å½•ä¸­å¯ç”¨ã€‚Ù\To mount a remote file system each time the client boots, add it to [.filename]#/etc/fstab#:Ùpè¦åœ¨æ¯æ¬¡å®¢æˆ·ç«¯å¯åŠ¨æ—¶æŒ‚è½½è¿œç¨‹æ–‡ä»¶ç³»ç»Ÿï¼Œè¯·å°†å…¶æ·»åŠ åˆ° [.filename]#/etc/fstab# æ–‡ä»¶ä¸­ï¼šÙARefer to man:fstab[5] for a description of all available options.Ù=è¯·å‚è€ƒ man:fstab[5]ï¼Œäº†è§£æ‰€æœ‰å¯ç”¨é€‰é¡¹çš„æè¿°ã€‚§Locking¦é”å®šÙSome applications require file locking to operate correctly.  To enable locking, execute the following command on both the client and server:Ù~æŸäº›åº”ç”¨ç¨‹åºéœ€è¦æ–‡ä»¶é”å®šæ‰èƒ½æ­£å¸¸è¿è¡Œã€‚è¦å¯ç”¨é”å®šï¼Œè¯·åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¸Šæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼šÙ°If locking is not required on the server, the NFS client can be configured to lock locally by including `-L` when running mount.  Refer to man:mount_nfs[8] for further details.Ù¨å¦‚æœæœåŠ¡å™¨ä¸Šä¸éœ€è¦é”å®šï¼Œå¯ä»¥åœ¨è¿è¡Œ mount æ—¶åŒ…å« `-L` æ¥é…ç½® NFS å®¢æˆ·ç«¯è¿›è¡Œæœ¬åœ°é”å®šã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… man:mount_nfs[8] ã€‚Ù$Automating Mounts with man:autofs[5]Ù!ä½¿ç”¨ man:autofs[5] è‡ªåŠ¨æŒ‚è½½ÙíThe man:autofs[5] automount facility is supported starting with FreeBSD 10.1-RELEASE.  To use the automounter functionality in older versions of FreeBSD, use man:amd[8] instead.  This chapter only describes the man:autofs[5] automounter.ÙÎman:autofs[5] è‡ªåŠ¨æŒ‚è½½åŠŸèƒ½ä» FreeBSD 10.1-RELEASE å¼€å§‹å¾—åˆ°æ”¯æŒã€‚è¦åœ¨æ—§ç‰ˆæœ¬çš„ FreeBSD ä¸­ä½¿ç”¨è‡ªåŠ¨æŒ‚è½½åŠŸèƒ½ï¼Œè¯·ä½¿ç”¨ man:amd[8]ã€‚æœ¬ç« ä»…æè¿° man:autofs[5] è‡ªåŠ¨æŒ‚è½½å™¨ã€‚ÚŠThe man:autofs[5] facility is a common name for several components that, together, allow for automatic mounting of remote and local filesystems whenever a file or directory within that file system is accessed.  It consists of the kernel component, man:autofs[5], and several userspace applications: man:automount[8], man:automountd[8] and man:autounmountd[8].  It serves as an alternative for man:amd[8] from previous FreeBSD releases.  amd is still provided for backward compatibility purposes, as the two use different map formats; the one used by autofs is the same as with other SVR4 automounters, such as the ones in Solaris, MacOS X, and Linux.Ú<man:autofs[5] è®¾æ–½æ˜¯å‡ ä¸ªç»„ä»¶çš„é€šç”¨åç§°ï¼Œè¿™äº›ç»„ä»¶ä¸€èµ·å…è®¸åœ¨è®¿é—®æ–‡ä»¶ç³»ç»Ÿä¸­çš„æ–‡ä»¶æˆ–ç›®å½•æ—¶è‡ªåŠ¨æŒ‚è½½è¿œç¨‹å’Œæœ¬åœ°æ–‡ä»¶ç³»ç»Ÿã€‚å®ƒç”±å†…æ ¸ç»„ä»¶ man:autofs[5] å’Œå‡ ä¸ªç”¨æˆ·ç©ºé—´åº”ç”¨ç¨‹åº man:automount[8]ã€man:automountd[8] å’Œ man:autounmountd[8] ç»„æˆã€‚å®ƒä½œä¸ºå…ˆå‰çš„ FreeBSD ç‰ˆæœ¬ä¸­ man:amd[8] çš„æ›¿ä»£å“ã€‚amd ä»ç„¶æä¾›å‘åå…¼å®¹æ€§ï¼Œå› ä¸ºä¸¤è€…ä½¿ç”¨ä¸åŒçš„æ˜ å°„æ ¼å¼ï¼›autofs ä½¿ç”¨çš„æ˜ å°„æ ¼å¼ä¸å…¶ä»– SVR4 è‡ªåŠ¨æŒ‚è½½ç¨‹åºï¼ˆå¦‚ Solarisã€MacOS X å’Œ Linux ä¸­çš„è‡ªåŠ¨æŒ‚è½½ç¨‹åºï¼‰ç›¸åŒã€‚ÙzThe man:autofs[5] virtual filesystem is mounted on specified mountpoints by man:automount[8], usually invoked during boot.Ùwman:autofs[5] è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿç”± man:automount[8] åœ¨æŒ‡å®šçš„æŒ‚è½½ç‚¹ä¸ŠæŒ‚è½½ï¼Œé€šå¸¸åœ¨å¯åŠ¨è¿‡ç¨‹ä¸­è°ƒç”¨ã€‚ÚÙWhenever a process attempts to access a file within the man:autofs[5] mountpoint, the kernel will notify man:automountd[8] daemon and pause the triggering process.  The man:automountd[8] daemon will handle kernel requests by finding the proper map and mounting the filesystem according to it, then signal the kernel to release blocked process.  The man:autounmountd[8] daemon automatically unmounts automounted filesystems after some time, unless they are still being used.Úµæ¯å½“ä¸€ä¸ªè¿›ç¨‹å°è¯•è®¿é—® man:autofs[5] æŒ‚è½½ç‚¹ä¸­çš„æ–‡ä»¶æ—¶ï¼Œå†…æ ¸å°†é€šçŸ¥ man:automountd[8] å®ˆæŠ¤è¿›ç¨‹å¹¶æš‚åœè§¦å‘è¿›ç¨‹ã€‚ man:automountd[8] å®ˆæŠ¤è¿›ç¨‹å°†é€šè¿‡æŸ¥æ‰¾æ­£ç¡®çš„æ˜ å°„å¹¶æ ¹æ®å…¶æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿæ¥å¤„ç†å†…æ ¸è¯·æ±‚ï¼Œç„¶åå‘å†…æ ¸å‘å‡ºé‡Šæ”¾è¢«é˜»å¡è¿›ç¨‹çš„ä¿¡å·ã€‚ man:autounmountd[8] å®ˆæŠ¤è¿›ç¨‹ä¼šåœ¨ä¸€æ®µæ—¶é—´åè‡ªåŠ¨å¸è½½è‡ªåŠ¨æŒ‚è½½çš„æ–‡ä»¶ç³»ç»Ÿï¼Œé™¤éå®ƒä»¬ä»åœ¨ä½¿ç”¨ä¸­ã€‚ÙØThe primary autofs configuration file is [.filename]#/etc/auto_master#. It assigns individual maps to top-level mounts.  For an explanation of [.filename]#auto_master# and the map syntax, refer to man:auto_master[5].ÙËä¸»è¦çš„ autofs é…ç½®æ–‡ä»¶æ˜¯ [.filename]#/etc/auto_master#ã€‚å®ƒå°†å„ä¸ªæ˜ å°„åˆ†é…ç»™é¡¶çº§æŒ‚è½½ç‚¹ã€‚æœ‰å…³ [.filename]#auto_master# å’Œæ˜ å°„è¯­æ³•çš„è§£é‡Šï¼Œè¯·å‚è€ƒ `man:auto_master[5]` ã€‚ÚmThere is a special automounter map mounted on [.filename]#/net#.  When a file is accessed within this directory, man:autofs[5] looks up the corresponding remote mount and automatically mounts it.  For instance, an attempt to access a file within [.filename]#/net/foobar/usr# would tell man:automountd[8] to mount the [.filename]#/usr# export from the host `foobar`.Ú;åœ¨ [.filename]#/net# ä¸ŠæŒ‚è½½äº†ä¸€ä¸ªç‰¹æ®Šçš„è‡ªåŠ¨æŒ‚è½½æ˜ å°„ã€‚å½“åœ¨è¯¥ç›®å½•ä¸­è®¿é—®æ–‡ä»¶æ—¶ï¼Œman:autofs[5] ä¼šæŸ¥æ‰¾ç›¸åº”çš„è¿œç¨‹æŒ‚è½½å¹¶è‡ªåŠ¨æŒ‚è½½å®ƒã€‚ä¾‹å¦‚ï¼Œå°è¯•è®¿é—® [.filename]#/net/foobar/usr# ä¸­çš„æ–‡ä»¶ä¼šå‘Šè¯‰ man:automountd[8] ä»ä¸»æœº `foobar` æŒ‚è½½ [.filename]#/usr# å¯¼å‡ºã€‚Ù%Mounting an Export with man:autofs[5]Ù-ä½¿ç”¨ man:autofs[5] æŒ‚è½½ä¸€ä¸ªå¯¼å‡ºç›®å½•ÙrIn this example, `showmount -e` shows the exported file systems that can be mounted from the NFS server, `foobar`:Ùlåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ`showmount -e` æ˜¾ç¤ºäº†å¯ä»¥ä» NFS æœåŠ¡å™¨ `foobar` æŒ‚è½½çš„å¯¼å‡ºæ–‡ä»¶ç³»ç»Ÿã€‚Ú The output from `showmount` shows [.filename]#/usr# as an export.  When changing directories to [.filename]#/host/foobar/usr#, man:automountd[8] intercepts the request and attempts to resolve the hostname `foobar`.  If successful, man:automountd[8] automatically mounts the source export.Ùÿ`showmount` å‘½ä»¤çš„è¾“å‡ºæ˜¾ç¤º [.filename]#/usr# ç›®å½•è¢«å¯¼å‡ºã€‚å½“åˆ‡æ¢åˆ° [.filename]#/host/foobar/usr# ç›®å½•æ—¶ï¼Œ man:automountd[8] ä¼šæ‹¦æˆªè¯·æ±‚å¹¶å°è¯•è§£æä¸»æœºå `foobar`ã€‚å¦‚æœæˆåŠŸï¼Œman:automountd[8] ä¼šè‡ªåŠ¨æŒ‚è½½æºå¯¼å‡ºã€‚ÙQTo enable man:autofs[5] at boot time, add this line to [.filename]#/etc/rc.conf#:Ù_è¦åœ¨å¯åŠ¨æ—¶å¯ç”¨ man:autofs[5]ï¼Œè¯·å°†ä»¥ä¸‹è¡Œæ·»åŠ åˆ° [.filename]#/etc/rc.conf# ä¸­ï¼šÙ-Then man:autofs[5] can be started by running:Ù=ç„¶åå¯ä»¥é€šè¿‡è¿è¡Œ man:autofs[5] æ¥å¯åŠ¨ autofs[5]ã€‚Ú The man:autofs[5] map format is the same as in other operating systems.  Information about this format from other sources can be useful, like the http://web.archive.org/web/20160813071113/http://images.apple.com/business/docs/Autofs.pdf[Mac OS X document].Ùğman:autofs[5] æ˜ å°„æ ¼å¼ä¸å…¶ä»–æ“ä½œç³»ç»Ÿç›¸åŒã€‚æ¥è‡ªå…¶ä»–æ¥æºçš„å…³äºè¯¥æ ¼å¼çš„ä¿¡æ¯å¯èƒ½ä¼šå¾ˆæœ‰ç”¨ï¼Œæ¯”å¦‚ http://web.archive.org/web/20160813071113/http://images.apple.com/business/docs/Autofs.pdf[Mac OS X æ–‡æ¡£] ã€‚ÙConsult the man:automount[8], man:automountd[8], man:autounmountd[8], and man:auto_master[5] manual pages for more information.Ù}è¯·å‚è€ƒ man:automount[8]ã€man:automountd[8]ã€man:autounmountd[8] å’Œ man:auto_master[5] æ‰‹å†Œé¡µé¢è·å–æ›´å¤šä¿¡æ¯ã€‚Ù Network Information System (NIS)»ç½‘ç»œä¿¡æ¯ç³»ç»Ÿï¼ˆNISï¼‰Ú<Network Information System (NIS) is designed to centralize administration of UNIX(R)-like systems such as Solaris(TM), HP-UX, AIX(R), Linux, NetBSD, OpenBSD, and FreeBSD.  NIS was originally known as Yellow Pages but the name was changed due to trademark issues.  This is the reason why NIS commands begin with `yp`.Úç½‘ç»œä¿¡æ¯ç³»ç»Ÿï¼ˆNISï¼‰æ—¨åœ¨é›†ä¸­ç®¡ç†ç±» UNIX(R) ç³»ç»Ÿï¼Œå¦‚ Solaris(TM)ã€HP-UXã€AIX(R)ã€Linuxã€NetBSDã€OpenBSD å’Œ FreeBSDã€‚NIS æœ€åˆè¢«ç§°ä¸º Yellow Pagesï¼Œä½†ç”±äºå•†æ ‡é—®é¢˜è€Œæ›´æ”¹äº†åç§°ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ NIS å‘½ä»¤ä»¥ `yp` å¼€å¤´çš„åŸå› ã€‚ÚRNIS is a Remote Procedure Call (RPC)-based client/server system that allows a group of machines within an NIS domain to share a common set of configuration files.  This permits a system administrator to set up NIS client systems with only minimal configuration data and to add, remove, or modify configuration data from a single location.Ú,NIS æ˜¯ä¸€ç§åŸºäºè¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼ˆRPCï¼‰çš„å®¢æˆ·ç«¯/æœåŠ¡å™¨ç³»ç»Ÿï¼Œå…è®¸ NIS åŸŸå†…çš„ä¸€ç»„æœºå™¨å…±äº«ä¸€ç»„å…¬å…±çš„é…ç½®æ–‡ä»¶ã€‚è¿™ä½¿å¾—ç³»ç»Ÿç®¡ç†å‘˜å¯ä»¥ä»…ä½¿ç”¨æœ€å°‘çš„é…ç½®æ•°æ®è®¾ç½® NIS å®¢æˆ·ç«¯ç³»ç»Ÿï¼Œå¹¶ä¸”å¯ä»¥ä»å•ä¸€ä½ç½®æ·»åŠ ã€åˆ é™¤æˆ–ä¿®æ”¹é…ç½®æ•°æ®ã€‚Ù+FreeBSD uses version 2 of the NIS protocol.Ù+FreeBSD ä½¿ç”¨ NIS åè®®çš„ç¬¬ 2 ç‰ˆæœ¬ã€‚·NIS Terms and Processes³NIS æœ¯è¯­å’Œæµç¨‹ÙDTable 28.1 summarizes the terms and important processes used by NIS:Ù8è¡¨ 28.1 æ€»ç»“äº† NIS ä½¿ç”¨çš„æœ¯è¯­å’Œé‡è¦è¿‡ç¨‹ã€‚¯NIS TerminologyªNIS æœ¯è¯­¤Term¦æœ¯è¯­ÙmNIS servers and clients share an NIS domain name. Typically, this name does not have anything to do with DNS.ÙYNIS æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯å…±äº«ä¸€ä¸ª NIS åŸŸåã€‚é€šå¸¸ï¼Œè¿™ä¸ªåŸŸåä¸ DNS æ— å…³ã€‚ÙcThis service enables RPC and must be running in order to run an NIS server or act as an NIS client.Ùfæ­¤æœåŠ¡å¯ç”¨äº† RPC ï¼Œå¹¶ä¸”å¿…é¡»åœ¨è¿è¡Œ NIS æœåŠ¡å™¨æˆ–å……å½“ NIS å®¢æˆ·ç«¯æ—¶æ‰èƒ½è¿è¡Œã€‚Ú!This service binds an NIS client to its NIS server. It will take the NIS domain name and use RPC to connect to the server. It is the core of client/server communication in an NIS environment. If this service is not running on a client machine, it will not be able to access the NIS server.Ùúè¯¥æœåŠ¡å°† NIS å®¢æˆ·ç«¯ç»‘å®šåˆ°å…¶ NIS æœåŠ¡å™¨ã€‚å®ƒå°†è·å– NIS åŸŸåå¹¶ä½¿ç”¨ RPC è¿æ¥åˆ°æœåŠ¡å™¨ã€‚å®ƒæ˜¯ NIS ç¯å¢ƒä¸­å®¢æˆ·ç«¯/æœåŠ¡å™¨é€šä¿¡çš„æ ¸å¿ƒã€‚å¦‚æœå®¢æˆ·ç«¯æœºå™¨ä¸Šæ²¡æœ‰è¿è¡Œæ­¤æœåŠ¡ï¼Œå°†æ— æ³•è®¿é—® NIS æœåŠ¡å™¨ã€‚ÚAThis is the process for the NIS server. If this service stops running, the server will no longer be able to respond to NIS requests so hopefully, there is a slave server to take over. Some non-FreeBSD clients will not try to reconnect using a slave server and the ypbind process may need to be restarted on these clients.Úè¿™æ˜¯ NIS æœåŠ¡å™¨çš„è¿›ç¨‹ã€‚å¦‚æœè¯¥æœåŠ¡åœæ­¢è¿è¡Œï¼ŒæœåŠ¡å™¨å°†æ— æ³•å“åº” NIS è¯·æ±‚ï¼Œå› æ­¤å¸Œæœ›æœ‰ä¸€ä¸ªä»æœåŠ¡å™¨æ¥ç®¡ã€‚ä¸€äº›é FreeBSD å®¢æˆ·ç«¯å¯èƒ½ä¸ä¼šå°è¯•ä½¿ç”¨ä»æœåŠ¡å™¨é‡æ–°è¿æ¥ï¼Œè¿™äº›å®¢æˆ·ç«¯å¯èƒ½éœ€è¦é‡æ–°å¯åŠ¨ ypbind è¿›ç¨‹ã€‚ÙŞThis process only runs on NIS master servers. This daemon allows NIS clients to change their NIS passwords. If this daemon is not running, users will have to login to the NIS master server and change their passwords there.Ùéè¿™ä¸ªè¿›ç¨‹åªåœ¨ NIS ä¸»æœåŠ¡å™¨ä¸Šè¿è¡Œã€‚è¿™ä¸ªå®ˆæŠ¤è¿›ç¨‹å…è®¸ NIS å®¢æˆ·ç«¯æ›´æ”¹ä»–ä»¬çš„ NIS å¯†ç ã€‚å¦‚æœè¿™ä¸ªå®ˆæŠ¤è¿›ç¨‹æ²¡æœ‰è¿è¡Œï¼Œç”¨æˆ·å°†ä¸å¾—ä¸ç™»å½•åˆ° NIS ä¸»æœåŠ¡å™¨å¹¶åœ¨é‚£é‡Œæ›´æ”¹ä»–ä»¬çš„å¯†ç ã€‚­Machine Types¬æœºå™¨ç±»å‹Ù5There are three types of hosts in an NIS environment:Ù,åœ¨ NIS ç¯å¢ƒä¸­æœ‰ä¸‰ç§ç±»å‹çš„ä¸»æœºï¼š±NIS master server°NIS ä¸»æœåŠ¡å™¨ÚîThis server acts as a central repository for host configuration information and maintains the authoritative copy of the files used by all of the NIS clients.  The [.filename]#passwd#, [.filename]#group#, and other various files used by NIS clients are stored on the master server.  While it is possible for one machine to be an NIS master server for more than one NIS domain, this type of configuration will not be covered in this chapter as it assumes a relatively small-scale NIS environment.ÚŒè¯¥æœåŠ¡å™¨å……å½“ä¸»æœºé…ç½®ä¿¡æ¯çš„ä¸­å¤®å­˜å‚¨åº“ï¼Œå¹¶ç»´æŠ¤æ‰€æœ‰ NIS å®¢æˆ·ç«¯ä½¿ç”¨çš„æ–‡ä»¶çš„æƒå¨å‰¯æœ¬ã€‚NIS å®¢æˆ·ç«¯ä½¿ç”¨çš„ [.filename]#passwd#ã€[.filename]#group# å’Œå…¶ä»–å„ç§æ–‡ä»¶å­˜å‚¨åœ¨ä¸»æœåŠ¡å™¨ä¸Šã€‚è™½ç„¶ä¸€ä¸ªæœºå™¨å¯ä»¥æˆä¸ºå¤šä¸ª NIS åŸŸçš„ NIS ä¸»æœåŠ¡å™¨ï¼Œä½†æœ¬ç« ä¸æ¶µç›–è¿™ç§ç±»å‹çš„é…ç½®ï¼Œå› ä¸ºå®ƒå‡è®¾ä¸€ä¸ªç›¸å¯¹è§„æ¨¡è¾ƒå°çš„ NIS ç¯å¢ƒã€‚±NIS slave servers°NIS ä»æœåŠ¡å™¨ÙçNIS slave servers maintain copies of the NIS master's data files in order to provide redundancy.  Slave servers also help to balance the load of the master server as NIS clients always attach to the NIS server which responds first.ÙÊNIS ä»æœåŠ¡å™¨ç»´æŠ¤ NIS ä¸»æœåŠ¡å™¨æ•°æ®æ–‡ä»¶çš„å‰¯æœ¬ï¼Œä»¥æä¾›å†—ä½™ã€‚ä»æœåŠ¡å™¨è¿˜æœ‰åŠ©äºå¹³è¡¡ä¸»æœåŠ¡å™¨çš„è´Ÿè½½ï¼Œå› ä¸º NIS å®¢æˆ·ç«¯æ€»æ˜¯è¿æ¥åˆ°é¦–å…ˆå“åº”çš„ NIS æœåŠ¡å™¨ã€‚«NIS clients­NIS å®¢æˆ·ç«¯Ù>NIS clients authenticate against the NIS server during log on.Ù?NIS å®¢æˆ·ç«¯åœ¨ç™»å½•æ—¶å¯¹ NIS æœåŠ¡å™¨è¿›è¡Œèº«ä»½éªŒè¯ã€‚ÚHInformation in many files can be shared using NIS.  The [.filename]#master.passwd#, [.filename]#group#, and [.filename]#hosts# files are commonly shared via NIS.  Whenever a process on a client needs information that would normally be found in these files locally, it makes a query to the NIS server that it is bound to instead.Úè®¸å¤šæ–‡ä»¶çš„ä¿¡æ¯å¯ä»¥é€šè¿‡ NIS å…±äº«ã€‚[.filename]#master.passwd#ã€[.filename]#group# å’Œ [.filename]#hosts# æ–‡ä»¶é€šå¸¸é€šè¿‡ NIS å…±äº«ã€‚æ¯å½“å®¢æˆ·ç«¯ä¸Šçš„è¿›ç¨‹éœ€è¦é€šå¸¸åœ¨è¿™äº›æ–‡ä»¶ä¸­æ‰¾åˆ°çš„ä¿¡æ¯æ—¶ï¼Œå®ƒä¼šå‘ç»‘å®šçš„ NIS æœåŠ¡å™¨å‘å‡ºæŸ¥è¯¢ã€‚·Planning Considerations²è§„åˆ’è€ƒè™‘å› ç´ ÚˆThis section describes a sample NIS environment which consists of 15 FreeBSD machines with no centralized point of administration.  Each machine has its own [.filename]#/etc/passwd# and [.filename]#/etc/master.passwd#.  These files are kept in sync with each other only through manual intervention.  Currently, when a user is added to the lab, the process must be repeated on all 15 machines.Úqæœ¬èŠ‚æè¿°äº†ä¸€ä¸ªç¤ºä¾‹çš„ NIS ç¯å¢ƒï¼Œè¯¥ç¯å¢ƒç”± 15 å° FreeBSD æœºå™¨ç»„æˆï¼Œæ²¡æœ‰é›†ä¸­çš„ç®¡ç†ç‚¹ã€‚æ¯å°æœºå™¨éƒ½æœ‰è‡ªå·±çš„ [.filename]#/etc/passwd# å’Œ [.filename]#/etc/master.passwd# æ–‡ä»¶ã€‚è¿™äº›æ–‡ä»¶åªèƒ½é€šè¿‡æ‰‹åŠ¨å¹²é¢„æ¥ä¿æŒåŒæ­¥ã€‚ç›®å‰ï¼Œå½“åœ¨å®éªŒå®¤ä¸­æ·»åŠ ç”¨æˆ·æ—¶ï¼Œè¿™ä¸ªè¿‡ç¨‹å¿…é¡»åœ¨æ‰€æœ‰ 15 å°æœºå™¨ä¸Šé‡å¤æ‰§è¡Œã€‚Ù0The configuration of the lab will be as follows:»å®éªŒå®¤çš„é…ç½®å¦‚ä¸‹ï¼š¬Machine name¬æœºå™¨åç§°¬Machine role¬æœºå™¨è§’è‰²«`ellington`¢``ªNIS master°NIS ä¸»æœåŠ¡å™¨©NIS slave°NIS ä»æœåŠ¡å™¨³Faculty workstationµæ•™èŒå‘˜å·¥å·¥ä½œç«™®Client machine¯å®¢æˆ·ç«¯æœºå™¨µOther client machines¯å…¶ä»–å®¢æˆ·æœºÙÊIf this is the first time an NIS scheme is being developed, it should be thoroughly planned ahead of time.  Regardless of network size, several decisions need to be made as part of the planning process.Ù’å¦‚æœè¿™æ˜¯ç¬¬ä¸€æ¬¡å¼€å‘ NIS æ–¹æ¡ˆï¼Œåº”è¯¥æå‰è¿›è¡Œå½»åº•çš„è§„åˆ’ã€‚æ— è®ºç½‘ç»œè§„æ¨¡å¦‚ä½•ï¼Œè§„åˆ’è¿‡ç¨‹ä¸­éœ€è¦åšå‡ºå‡ ä¸ªå†³ç­–ã€‚ºChoosing a NIS Domain Name·é€‰æ‹©ä¸€ä¸ª NIS åŸŸåÚ
When a client broadcasts its requests for info, it includes the name of the NIS domain that it is part of.  This is how multiple servers on one network can tell which server should answer which request.  Think of the NIS domain name as the name for a group of hosts.Ùèå½“å®¢æˆ·ç«¯å¹¿æ’­å…¶ä¿¡æ¯è¯·æ±‚æ—¶ï¼Œå®ƒä¼šåŒ…å«å…¶æ‰€å±çš„ NIS åŸŸçš„åç§°ã€‚è¿™å°±æ˜¯åœ¨ä¸€ä¸ªç½‘ç»œä¸Šå¤šä¸ªæœåŠ¡å™¨å¦‚ä½•çŸ¥é“å“ªä¸ªæœåŠ¡å™¨åº”è¯¥å›ç­”å“ªä¸ªè¯·æ±‚çš„æ–¹å¼ã€‚å°† NIS åŸŸåè§†ä¸ºä¸€ç»„ä¸»æœºçš„åç§°ã€‚Ú»Some organizations choose to use their Internet domain name for their NIS domain name.  This is not recommended as it can cause confusion when trying to debug network problems.  The NIS domain name should be unique within the network and it is helpful if it describes the group of machines it represents.  For example, the Art department at Acme Inc. might be in the "acme-art" NIS domain.  This example will use the domain name `test-domain`.Úgä¸€äº›ç»„ç»‡é€‰æ‹©ä½¿ç”¨å…¶äº’è”ç½‘åŸŸåä½œä¸º NIS åŸŸåã€‚è¿™å¹¶ä¸æ¨èï¼Œå› ä¸ºåœ¨è°ƒè¯•ç½‘ç»œé—®é¢˜æ—¶å¯èƒ½ä¼šå¼•èµ·æ··æ·†ã€‚NIS åŸŸååº”åœ¨ç½‘ç»œä¸­æ˜¯å”¯ä¸€çš„ï¼Œå¹¶ä¸”å¦‚æœèƒ½æè¿°å®ƒæ‰€ä»£è¡¨çš„æœºå™¨ç»„ï¼Œé‚£å°†ä¼šå¾ˆæœ‰å¸®åŠ©ã€‚ä¾‹å¦‚ï¼ŒAcme å…¬å¸çš„è‰ºæœ¯éƒ¨é—¨å¯èƒ½åœ¨"acme-art"çš„ NIS åŸŸä¸­ã€‚æœ¬ç¤ºä¾‹å°†ä½¿ç”¨åŸŸå `test-domain` ã€‚ÙòHowever, some non-FreeBSD operating systems require the NIS domain name to be the same as the Internet domain name.  If one or more machines on the network have this restriction, the Internet domain name _must_ be used as the NIS domain name.Ù»ç„¶è€Œï¼Œä¸€äº›é FreeBSD æ“ä½œç³»ç»Ÿè¦æ±‚ NIS åŸŸåä¸äº’è”ç½‘åŸŸåç›¸åŒã€‚å¦‚æœç½‘ç»œä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªæœºå™¨æœ‰æ­¤é™åˆ¶ï¼Œåˆ™å¿…é¡»ä½¿ç”¨äº’è”ç½‘åŸŸåä½œä¸º NIS åŸŸåã€‚¼Physical Server Requirementsµç‰©ç†æœåŠ¡å™¨è¦æ±‚ÚøThere are several things to keep in mind when choosing a machine to use as a NIS server.  Since NIS clients depend upon the availability of the server, choose a machine that is not rebooted frequently.  The NIS server should ideally be a stand alone machine whose sole purpose is to be an NIS server.  If the network is not heavily used, it is acceptable to put the NIS server on a machine running other services.  However, if the NIS server becomes unavailable, it will adversely affect all NIS clients.ÚÀé€‰æ‹©ç”¨ä½œ NIS æœåŠ¡å™¨çš„æœºå™¨æ—¶ï¼Œæœ‰å‡ ä¸ªè¦æ³¨æ„çš„äº‹é¡¹ã€‚ç”±äº NIS å®¢æˆ·ç«¯ä¾èµ–äºæœåŠ¡å™¨çš„å¯ç”¨æ€§ï¼Œå› æ­¤é€‰æ‹©ä¸€å°ä¸ç»å¸¸é‡æ–°å¯åŠ¨çš„æœºå™¨ã€‚NIS æœåŠ¡å™¨æœ€å¥½æ˜¯ä¸€å°ç‹¬ç«‹çš„æœºå™¨ï¼Œå…¶å”¯ä¸€ç›®çš„å°±æ˜¯ä½œä¸º NIS æœåŠ¡å™¨ã€‚å¦‚æœç½‘ç»œä½¿ç”¨ç‡ä¸é«˜ï¼Œå¯ä»¥å°† NIS æœåŠ¡å™¨æ”¾åœ¨è¿è¡Œå…¶ä»–æœåŠ¡çš„æœºå™¨ä¸Šã€‚ç„¶è€Œï¼Œå¦‚æœ NIS æœåŠ¡å™¨ä¸å¯ç”¨ï¼Œå°†ä¼šå¯¹æ‰€æœ‰ NIS å®¢æˆ·ç«¯äº§ç”Ÿä¸åˆ©å½±å“ã€‚Ù!Configuring the NIS Master Server·é…ç½® NIS ä¸»æœåŠ¡å™¨Ú¯The canonical copies of all NIS files are stored on the master server.  The databases used to store the information are called NIS maps.  In FreeBSD, these maps are stored in [.filename]#/var/yp/[domainname]# where [.filename]#[domainname]# is the name of the NIS domain.  Since multiple domains are supported, it is possible to have several directories, one for each domain.  Each domain will have its own independent set of maps.Úpæ‰€æœ‰ NIS æ–‡ä»¶çš„è§„èŒƒå‰¯æœ¬å­˜å‚¨åœ¨ä¸»æœåŠ¡å™¨ä¸Šã€‚ç”¨äºå­˜å‚¨ä¿¡æ¯çš„æ•°æ®åº“ç§°ä¸º NIS æ˜ å°„ã€‚åœ¨ FreeBSD ä¸­ï¼Œè¿™äº›æ˜ å°„å­˜å‚¨åœ¨ [.filename]#/var/yp/[domainname]# ä¸­ï¼Œå…¶ä¸­ [.filename]#[domainname]# æ˜¯ NIS åŸŸçš„åç§°ã€‚ç”±äºæ”¯æŒå¤šä¸ªåŸŸï¼Œå› æ­¤å¯èƒ½ä¼šæœ‰å¤šä¸ªç›®å½•ï¼Œæ¯ä¸ªåŸŸä¸€ä¸ªç›®å½•ã€‚æ¯ä¸ªåŸŸéƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„æ˜ å°„é›†ã€‚Ú1NIS master and slave servers handle all NIS requests through man:ypserv[8].  This daemon is responsible for receiving incoming requests from NIS clients, translating the requested domain and map name to a path to the corresponding database file, and transmitting data from the database back to the client.ÚNIS ä¸»æœåŠ¡å™¨å’Œä»æœåŠ¡å™¨é€šè¿‡ man:ypserv[8] å¤„ç†æ‰€æœ‰ NIS è¯·æ±‚ã€‚è¯¥å®ˆæŠ¤è¿›ç¨‹è´Ÿè´£æ¥æ”¶æ¥è‡ª NIS å®¢æˆ·ç«¯çš„ä¼ å…¥è¯·æ±‚ï¼Œå°†è¯·æ±‚çš„åŸŸå’Œæ˜ å°„åç§°è½¬æ¢ä¸ºç›¸åº”æ•°æ®åº“æ–‡ä»¶çš„è·¯å¾„ï¼Œå¹¶å°†æ•°æ®åº“ä¸­çš„æ•°æ®ä¼ è¾“å›å®¢æˆ·ç«¯ã€‚ÙêSetting up a master NIS server can be relatively straight forward, depending on environmental needs.  Since FreeBSD provides built-in NIS support, it only needs to be enabled by adding the following lines to [.filename]#/etc/rc.conf#:ÙÀæ ¹æ®ç¯å¢ƒéœ€æ±‚ï¼Œè®¾ç½®ä¸» NIS æœåŠ¡å™¨å¯ä»¥ç›¸å¯¹ç®€å•ã€‚ç”±äº FreeBSD æä¾›äº†å†…ç½®çš„ NIS æ”¯æŒï¼Œåªéœ€è¦é€šè¿‡å°†ä»¥ä¸‹è¡Œæ·»åŠ åˆ° [.filename]#/etc/rc.conf# æ¥å¯ç”¨ NIS ï¼šÚ<.> This line sets the NIS domain name to `test-domain`.  <.> This automates the start up of the NIS server processes when the system boots.  <.> This enables the man:rpc.yppasswdd[8] daemon so that users can change their NIS password from a client machine.Ùô<.> è¿™è¡Œä»£ç å°† NIS åŸŸåè®¾ç½®ä¸º `test-domain`ã€‚
 <.> è¿™å°†åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶è‡ªåŠ¨å¯åŠ¨ NIS æœåŠ¡å™¨è¿›ç¨‹ã€‚
 <.> è¿™å°†å¯ç”¨ man:rpc.yppasswdd[8] å®ˆæŠ¤è¿›ç¨‹ï¼Œä»¥ä¾¿ç”¨æˆ·å¯ä»¥ä»å®¢æˆ·ç«¯æœºå™¨ä¸Šæ›´æ”¹ä»–ä»¬çš„ NIS å¯†ç ã€‚Ú:Care must be taken in a multi-server domain where the server machines are also NIS clients.  It is generally a good idea to force the servers to bind to themselves rather than allowing them to broadcast bind requests and possibly become bound to each other.  Strange failure modes can result if one server goes down and others are dependent upon it.  Eventually, all the clients will time out and attempt to bind to other servers, but the delay involved can be considerable and the failure mode is still present since the servers might bind to each other all over again.Úâåœ¨ä¸€ä¸ªå¤šæœåŠ¡å™¨åŸŸä¸­ï¼Œéœ€è¦æ³¨æ„æœåŠ¡å™¨æœºå™¨ä¹Ÿæ˜¯ NIS å®¢æˆ·ç«¯çš„æƒ…å†µã€‚é€šå¸¸æœ€å¥½å¼ºåˆ¶æœåŠ¡å™¨ç»‘å®šåˆ°è‡ªå·±ï¼Œè€Œä¸æ˜¯å…è®¸å®ƒä»¬å¹¿æ’­ç»‘å®šè¯·æ±‚å¹¶å¯èƒ½ç›¸äº’ç»‘å®šã€‚å¦‚æœä¸€ä¸ªæœåŠ¡å™¨å´©æºƒï¼Œå…¶ä»–æœåŠ¡å™¨ä¾èµ–äºå®ƒï¼Œå¯èƒ½ä¼šå‡ºç°å¥‡æ€ªçš„æ•…éšœæ¨¡å¼ã€‚æœ€ç»ˆï¼Œæ‰€æœ‰å®¢æˆ·ç«¯éƒ½ä¼šè¶…æ—¶å¹¶å°è¯•ç»‘å®šåˆ°å…¶ä»–æœåŠ¡å™¨ï¼Œä½†æ¶‰åŠçš„å»¶è¿Ÿå¯èƒ½ç›¸å½“å¤§ï¼Œå¹¶ä¸”æ•…éšœæ¨¡å¼ä»ç„¶å­˜åœ¨ï¼Œå› ä¸ºæœåŠ¡å™¨å¯èƒ½ä¼šå†æ¬¡ç›¸äº’ç»‘å®šã€‚ÙŠA server that is also a client can be forced to bind to a particular server by adding these additional lines to [.filename]#/etc/rc.conf#:Ùœä¸€ä¸ªæ—¢æ˜¯æœåŠ¡å™¨åˆæ˜¯å®¢æˆ·ç«¯çš„æœåŠ¡å™¨å¯ä»¥é€šè¿‡åœ¨ [.filename]#/etc/rc.conf# ä¸­æ·»åŠ ä»¥ä¸‹é¢å¤–çš„è¡Œæ¥å¼ºåˆ¶ç»‘å®šåˆ°ç‰¹å®šçš„æœåŠ¡å™¨ï¼šÙ{<.> This enables running client stuff as well.  <.> This line sets the NIS domain name to `test-domain` and bind to itself.Ùw<.> è¿™æ ·å¯ä»¥è¿è¡Œå®¢æˆ·ç«¯çš„å†…å®¹ã€‚ <.> è¿™è¡Œä»£ç å°† NIS åŸŸåè®¾ç½®ä¸º `test-domain` å¹¶ç»‘å®šåˆ°è‡ªèº«ã€‚Ù¶After saving the edits, type `/etc/netstart` to restart the network and apply the values defined in [.filename]#/etc/rc.conf#.  Before initializing the NIS maps, start man:ypserv[8]:Ù®ä¿å­˜ç¼–è¾‘åï¼Œè¾“å…¥ `/etc/netstart` æ¥é‡æ–°å¯åŠ¨ç½‘ç»œå¹¶åº”ç”¨åœ¨ [.filename]#/etc/rc.conf# ä¸­å®šä¹‰çš„å€¼ã€‚åœ¨åˆå§‹åŒ– NIS æ˜ å°„ä¹‹å‰ï¼Œå¯åŠ¨ man:ypserv[8]ï¼š¹Initializing the NIS Maps´åˆå§‹åŒ– NIS æ˜ å°„Ú>NIS maps are generated from the configuration files in [.filename]#/etc# on the NIS master, with one exception: [.filename]#/etc/master.passwd#.  This is to prevent the propagation of passwords to all the servers in the NIS domain.  Therefore, before the NIS maps are initialized, configure the primary password files:ÚNIS æ˜ å°„æ˜¯ä» NIS ä¸»æœåŠ¡å™¨ä¸Šçš„é…ç½®æ–‡ä»¶ [.filename]#/etc# ç”Ÿæˆçš„ï¼Œåªæœ‰ä¸€ä¸ªä¾‹å¤–ï¼š[.filename]#/etc/master.passwd#ã€‚è¿™æ˜¯ä¸ºäº†é˜²æ­¢å¯†ç ä¼ æ’­åˆ° NIS åŸŸä¸­çš„æ‰€æœ‰æœåŠ¡å™¨ã€‚å› æ­¤ï¼Œåœ¨åˆå§‹åŒ– NIS æ˜ å°„ä¹‹å‰ï¼Œè¯·é…ç½®ä¸»å¯†ç æ–‡ä»¶ï¼šÙÆIt is advisable to remove all entries for system accounts as well as any user accounts that do not need to be propagated to the NIS clients, such as the `root` and any other administrative accounts.Ùå»ºè®®åˆ é™¤æ‰€æœ‰ç³»ç»Ÿè´¦æˆ·çš„æ¡ç›®ï¼Œä»¥åŠä¸éœ€è¦ä¼ æ’­åˆ° NIS å®¢æˆ·ç«¯çš„ä»»ä½•ç”¨æˆ·è´¦æˆ·ï¼Œä¾‹å¦‚ `root` å’Œå…¶ä»–ç®¡ç†è´¦æˆ·ã€‚ÙzEnsure that the [.filename]#/var/yp/master.passwd# is neither group or world readable by setting its permissions to `600`.ÙŠé€šè¿‡å°† [.filename]#/var/yp/master.passwd# çš„æƒé™è®¾ç½®ä¸º `600`ï¼Œç¡®ä¿å®ƒæ—¢ä¸å¯ç”±ç»„è¯»å–ï¼Œä¹Ÿä¸å¯ç”±å…¶ä»–ç”¨æˆ·è¯»å–ã€‚ÙÆAfter completing this task, initialize the NIS maps.  FreeBSD includes the man:ypinit[8] script to do this.  When generating maps for the master server, include `-m` and specify the NIS domain name:Ù±å®Œæˆæ­¤ä»»åŠ¡åï¼Œåˆå§‹åŒ– NIS æ˜ å°„ã€‚FreeBSD åŒ…å« man:ypinit[8] è„šæœ¬æ¥å®Œæˆæ­¤æ“ä½œã€‚åœ¨ä¸ºä¸»æœåŠ¡å™¨ç”Ÿæˆæ˜ å°„æ—¶ï¼ŒåŒ…æ‹¬ `-m` é€‰é¡¹å¹¶æŒ‡å®š NIS åŸŸåï¼šÚAThis will create [.filename]#/var/yp/Makefile# from [.filename]#/var/yp/Makefile.dist#.  By default, this file assumes that the environment has a single NIS server with only FreeBSD clients.  Since `test-domain` has a slave server, edit this line in [.filename]#/var/yp/Makefile# so that it begins with a comment (`+#+`):ÚDè¿™å°†ä» [.filename]#/var/yp/Makefile.dist# åˆ›å»º [.filename]#/var/yp/Makefile# ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ­¤æ–‡ä»¶å‡è®¾ç¯å¢ƒä¸­åªæœ‰ä¸€ä¸ª NIS æœåŠ¡å™¨å’Œä»…æœ‰ FreeBSD å®¢æˆ·ç«¯ã€‚ç”±äº `test-domain` æœ‰ä¸€ä¸ªä»æœåŠ¡å™¨ï¼Œå› æ­¤è¯·ç¼–è¾‘ [.filename]#/var/yp/Makefile# ä¸­çš„æ­¤è¡Œï¼Œä½¿å…¶ä»¥æ³¨é‡Šï¼ˆ`+#+`ï¼‰å¼€å¤´ï¼š°Adding New Users¯æ·»åŠ æ–°ç”¨æˆ·ÚBEvery time a new user is created, the user account must be added to the master NIS server and the NIS maps rebuilt.  Until this occurs, the new user will not be able to login anywhere except on the NIS master.  For example, to add the new user `jsmith` to the `test-domain` domain, run these commands on the master server:Ú$æ¯æ¬¡åˆ›å»ºæ–°ç”¨æˆ·æ—¶ï¼Œéƒ½å¿…é¡»å°†ç”¨æˆ·å¸æˆ·æ·»åŠ åˆ°ä¸» NIS æœåŠ¡å™¨å¹¶é‡å»º NIS æ˜ å°„ã€‚åœ¨æ­¤ä¹‹å‰ï¼Œæ–°ç”¨æˆ·å°†æ— æ³•ç™»å½•é™¤ NIS ä¸»æœåŠ¡å™¨ä¹‹å¤–çš„ä»»ä½•åœ°æ–¹ã€‚ä¾‹å¦‚ï¼Œè¦å°†æ–°ç”¨æˆ· `jsmith` æ·»åŠ åˆ° `test-domain` åŸŸä¸­ï¼Œè¯·åœ¨ä¸»æœåŠ¡å™¨ä¸Šè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼šÙRThe user could also be added using `adduser jsmith` instead of `pw useradd smith`.ÙPç”¨æˆ·ä¹Ÿå¯ä»¥ä½¿ç”¨ `adduser jsmith` è€Œä¸æ˜¯ `pw useradd smith` æ¥æ·»åŠ ã€‚½Setting up a NIS Slave Server½è®¾ç½®ä¸€ä¸ª NIS ä»æœåŠ¡å™¨Ú‹To set up an NIS slave server, log on to the slave server and edit [.filename]#/etc/rc.conf# as for the master server.  Do not generate any NIS maps, as these already exist on the master server.  When running `ypinit` on the slave server, use `-s` (for slave) instead of `-m` (for master).  This option requires the name of the NIS master in addition to the domain name, as seen in this example:Ú”è¦è®¾ç½®ä¸€ä¸ª NIS ä»æœåŠ¡å™¨ï¼Œç™»å½•åˆ°ä»æœåŠ¡å™¨å¹¶åƒä¸»æœåŠ¡å™¨ä¸€æ ·ç¼–è¾‘ [.filename]#/etc/rc.conf#ã€‚ä¸è¦ç”Ÿæˆä»»ä½• NIS æ˜ å°„ï¼Œå› ä¸ºè¿™äº›æ˜ å°„å·²ç»å­˜åœ¨äºä¸»æœåŠ¡å™¨ä¸Šã€‚åœ¨ä»æœåŠ¡å™¨ä¸Šè¿è¡Œ `ypinit` æ—¶ï¼Œä½¿ç”¨ `-s`ï¼ˆä»£è¡¨ä»æœåŠ¡å™¨ï¼‰è€Œä¸æ˜¯ `-m` ï¼ˆä»£è¡¨ä¸»æœåŠ¡å™¨ï¼‰ã€‚æ­¤é€‰é¡¹é™¤äº†åŸŸåå¤–ï¼Œè¿˜éœ€è¦æä¾› NIS ä¸»æœåŠ¡å™¨çš„åç§°ï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼šÚ#This will generate a directory on the slave server called [.filename]#/var/yp/test-domain# which contains copies of the NIS master server's maps.  Adding these [.filename]#/etc/crontab# entries on each slave server will force the slaves to sync their maps with the maps on the master server:Úè¿™å°†åœ¨ä»æœåŠ¡å™¨ä¸Šç”Ÿæˆä¸€ä¸ªåä¸º [.filename]#/var/yp/test-domain# çš„ç›®å½•ï¼Œå…¶ä¸­åŒ…å« NIS ä¸»æœåŠ¡å™¨æ˜ å°„çš„å‰¯æœ¬ã€‚åœ¨æ¯ä¸ªä»æœåŠ¡å™¨ä¸Šæ·»åŠ è¿™äº› [.filename]#/etc/crontab# æ¡ç›®å°†å¼ºåˆ¶ä»æœåŠ¡å™¨å°†å…¶æ˜ å°„ä¸ä¸»æœåŠ¡å™¨ä¸Šçš„æ˜ å°„åŒæ­¥ï¼šÚoThese entries are not mandatory because the master server automatically attempts to push any map changes to its slaves.  However, since clients may depend upon the slave server to provide correct password information, it is recommended to force frequent password map updates.  This is especially important on busy networks where map updates might not always complete.Ú8è¿™äº›æ¡ç›®ä¸æ˜¯å¼ºåˆ¶æ€§çš„ï¼Œå› ä¸ºä¸»æœåŠ¡å™¨ä¼šè‡ªåŠ¨å°è¯•å°†ä»»ä½•æ˜ å°„æ›´æ”¹æ¨é€åˆ°ä»æœåŠ¡å™¨ã€‚ç„¶è€Œï¼Œç”±äºå®¢æˆ·ç«¯å¯èƒ½ä¾èµ–ä»æœåŠ¡å™¨æä¾›æ­£ç¡®çš„å¯†ç ä¿¡æ¯ï¼Œå»ºè®®å¼ºåˆ¶é¢‘ç¹æ›´æ–°å¯†ç æ˜ å°„ã€‚è¿™åœ¨ç¹å¿™çš„ç½‘ç»œä¸Šå°¤ä¸ºé‡è¦ï¼Œå› ä¸ºæ˜ å°„æ›´æ–°å¯èƒ½å¹¶ä¸æ€»æ˜¯å®Œæˆã€‚ÙhTo finish the configuration, run `/etc/netstart` on the slave server in order to start the NIS services.ÙUè¦å®Œæˆé…ç½®ï¼Œè¯·åœ¨ä»æœåŠ¡å™¨ä¸Šè¿è¡Œ `/etc/netstart` ä»¥å¯åŠ¨ NIS æœåŠ¡ã€‚¸Setting Up an NIS Client´è®¾ç½® NIS å®¢æˆ·ç«¯ÚõAn NIS client binds to an NIS server using man:ypbind[8].  This daemon broadcasts RPC requests on the local network.  These requests specify the domain name configured on the client.  If an NIS server in the same domain receives one of the broadcasts, it will respond to ypbind, which will record the server's address.  If there are several servers available, the client will use the address of the first server to respond and will direct all of its NIS requests to that server.  The client will automatically ping the server on a regular basis to make sure it is still available.  If it fails to receive a reply within a reasonable amount of time, ypbind will mark the domain as unbound and begin broadcasting again in the hopes of locating another server.Úä¸€ä¸ª NIS å®¢æˆ·ç«¯ä½¿ç”¨ man:ypbind[8] ç»‘å®šåˆ°ä¸€ä¸ª NIS æœåŠ¡å™¨ã€‚è¿™ä¸ªå®ˆæŠ¤è¿›ç¨‹åœ¨æœ¬åœ°ç½‘ç»œä¸Šå¹¿æ’­ RPC è¯·æ±‚ã€‚è¿™äº›è¯·æ±‚æŒ‡å®šäº†å®¢æˆ·ç«¯ä¸Šé…ç½®çš„åŸŸåã€‚å¦‚æœåŒä¸€åŸŸä¸­çš„ä¸€ä¸ª NIS æœåŠ¡å™¨æ¥æ”¶åˆ°å…¶ä¸­ä¸€ä¸ªå¹¿æ’­ï¼Œå®ƒå°†å›åº” ypbindï¼Œå¹¶è®°å½•æœåŠ¡å™¨çš„åœ°å€ã€‚å¦‚æœæœ‰å¤šä¸ªå¯ç”¨çš„æœåŠ¡å™¨ï¼Œå®¢æˆ·ç«¯å°†ä½¿ç”¨ç¬¬ä¸€ä¸ªå›åº”çš„æœåŠ¡å™¨çš„åœ°å€ï¼Œå¹¶å°†æ‰€æœ‰çš„ NIS è¯·æ±‚å®šå‘åˆ°è¯¥æœåŠ¡å™¨ã€‚å®¢æˆ·ç«¯ä¼šå®šæœŸè‡ªåŠ¨ ping æœåŠ¡å™¨ï¼Œä»¥ç¡®ä¿å®ƒä»ç„¶å¯ç”¨ã€‚å¦‚æœåœ¨åˆç†çš„æ—¶é—´å†…æœªæ”¶åˆ°å›å¤ï¼Œypbind å°†æ ‡è®°è¯¥åŸŸä¸ºæœªç»‘å®šï¼Œå¹¶é‡æ–°å¼€å§‹å¹¿æ’­ï¼Œå¸Œæœ›æ‰¾åˆ°å¦ä¸€ä¸ªæœåŠ¡å™¨ã€‚Ù3To configure a FreeBSD machine to be an NIS client:Ù/è¦å°† FreeBSD æœºå™¨é…ç½®ä¸º NIS å®¢æˆ·ç«¯ï¼šÙEdit [.filename]#/etc/rc.conf# and add the following lines in order to set the NIS domain name and start man:ypbind[8] during network startup:Ù‘ç¼–è¾‘ [.filename]#/etc/rc.conf# æ–‡ä»¶ï¼Œå¹¶æŒ‰ç…§ä»¥ä¸‹é¡ºåºæ·»åŠ ä»¥ä¸‹è¡Œï¼Œä»¥è®¾ç½® NIS åŸŸåå¹¶åœ¨ç½‘ç»œå¯åŠ¨æ—¶å¯åŠ¨ man:ypbind[8]ï¼šÚáTo import all possible password entries from the NIS server, use `vipw` to remove all user accounts except one from [.filename]#/etc/master.passwd#. When removing the accounts, keep in mind that at least one local account should remain and this account should be a member of `wheel`. If there is a problem with NIS, this local account can be used to log in remotely, become the superuser, and fix the problem. Before saving the edits, add the following line to the end of the file:Ú¹è¦ä» NIS æœåŠ¡å™¨å¯¼å…¥æ‰€æœ‰å¯èƒ½çš„å¯†ç æ¡ç›®ï¼Œè¯·ä½¿ç”¨ `vipw` å‘½ä»¤ä» [.filename]#/etc/master.passwd# ä¸­åˆ é™¤é™¤ä¸€ä¸ªä¹‹å¤–çš„æ‰€æœ‰ç”¨æˆ·è´¦æˆ·ã€‚åœ¨åˆ é™¤è´¦æˆ·æ—¶ï¼Œè¯·è®°ä½è‡³å°‘åº”ä¿ç•™ä¸€ä¸ªæœ¬åœ°è´¦æˆ·ï¼Œå¹¶ä¸”è¯¥è´¦æˆ·åº”è¯¥æ˜¯ `wheel` ç»„çš„æˆå‘˜ã€‚å¦‚æœ NIS å‡ºç°é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨è¯¥æœ¬åœ°è´¦æˆ·è¿œç¨‹ç™»å½•ï¼Œæˆä¸ºè¶…çº§ç”¨æˆ·å¹¶ä¿®å¤é—®é¢˜ã€‚åœ¨ä¿å­˜ç¼–è¾‘ä¹‹å‰ï¼Œè¯·åœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ ä»¥ä¸‹è¡Œï¼šÚaThis line configures the client to provide anyone with a valid account in the NIS server's password maps an account on the client.  There are many ways to configure the NIS client by modifying this line.  One method is described in <<network-netgroups>>.  For more detailed reading, refer to the book `Managing NFS and NIS`, published by O'Reilly Media.ÚWè¿™è¡Œé…ç½®å°†ä½¿å®¢æˆ·ç«¯ä¸º NIS æœåŠ¡å™¨å¯†ç æ˜ å°„ä¸­å…·æœ‰æœ‰æ•ˆå¸æˆ·çš„ä»»ä½•äººåœ¨å®¢æˆ·ç«¯ä¸Šæä¾›ä¸€ä¸ªå¸æˆ·ã€‚æœ‰è®¸å¤šæ–¹æ³•å¯ä»¥é€šè¿‡ä¿®æ”¹è¿™è¡Œæ¥é…ç½® NIS å®¢æˆ·ç«¯ã€‚å…¶ä¸­ä¸€ç§æ–¹æ³•åœ¨ <<network-netgroups>> ä¸­æœ‰æè¿°ã€‚å¦‚éœ€æ›´è¯¦ç»†çš„é˜…è¯»ï¼Œè¯·å‚è€ƒ O'Reilly Media å‡ºç‰ˆçš„ `Managing NFS and NIS` ä¸€ä¹¦ã€‚ÙcTo import all possible group entries from the NIS server, add this line to [.filename]#/etc/group#:Ùrè¦ä» NIS æœåŠ¡å™¨å¯¼å…¥æ‰€æœ‰å¯èƒ½çš„ç»„æ¡ç›®ï¼Œè¯·å°†ä»¥ä¸‹è¡Œæ·»åŠ åˆ° [.filename]#/etc/group# æ–‡ä»¶ä¸­ï¼šÙUTo start the NIS client immediately, execute the following commands as the superuser:ÙMè¦ç«‹å³å¯åŠ¨ NIS å®¢æˆ·ç«¯ï¼Œè¯·ä»¥è¶…çº§ç”¨æˆ·èº«ä»½æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼šÙtAfter completing these steps, running `ypcat passwd` on the client should show the server's [.filename]#passwd# map.Ùså®Œæˆè¿™äº›æ­¥éª¤åï¼Œåœ¨å®¢æˆ·ç«¯ä¸Šè¿è¡Œ `ypcat passwd` åº”è¯¥æ˜¾ç¤ºæœåŠ¡å™¨çš„ [.filename]#passwd# æ˜ å°„ã€‚¬NIS SecurityªNIS å®‰å…¨ÚSince RPC is a broadcast-based service, any system running ypbind within the same domain can retrieve the contents of the NIS maps.  To prevent unauthorized transactions, man:ypserv[8] supports a feature called "securenets" which can be used to restrict access to a given set of hosts.  By default, this information is stored in [.filename]#/var/yp/securenets#, unless man:ypserv[8] is started with `-p` and an alternate path.  This file contains entries that consist of a network specification and a network mask separated by white space.  Lines starting with `+"#"+` are considered to be comments.  A sample [.filename]#securenets# might look like this:ÚIç”±äº RPC æ˜¯åŸºäºå¹¿æ’­çš„æœåŠ¡ï¼Œå› æ­¤åœ¨åŒä¸€åŸŸä¸­è¿è¡Œ ypbind çš„ä»»ä½•ç³»ç»Ÿéƒ½å¯ä»¥æ£€ç´¢ NIS æ˜ å°„çš„å†…å®¹ã€‚ä¸ºäº†é˜²æ­¢æœªç»æˆæƒçš„äº‹åŠ¡ï¼Œ man:ypserv[8] æ”¯æŒä¸€ä¸ªåä¸º"securenets"çš„åŠŸèƒ½ï¼Œå¯ä»¥ç”¨æ¥é™åˆ¶å¯¹ç»™å®šä¸€ç»„ä¸»æœºçš„è®¿é—®ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ­¤ä¿¡æ¯å­˜å‚¨åœ¨ [.filename]#/var/yp/securenets# ä¸­ï¼Œé™¤é man:ypserv[8] ä½¿ç”¨ `-p` å’Œæ›¿ä»£è·¯å¾„å¯åŠ¨ã€‚è¯¥æ–‡ä»¶åŒ…å«ç”±ç©ºæ ¼åˆ†éš”çš„ç½‘ç»œè§„èŒƒå’Œç½‘ç»œæ©ç ç»„æˆçš„æ¡ç›®ã€‚ä»¥ ` +"#"+ ` å¼€å¤´çš„è¡Œè¢«è§†ä¸ºæ³¨é‡Šã€‚ä¸€ä¸ªç¤ºä¾‹çš„ [.filename]#securenets# å¯èƒ½å¦‚ä¸‹æ‰€ç¤ºï¼šÚBIf man:ypserv[8] receives a request from an address that matches one of these rules, it will process the request normally.  If the address fails to match a rule, the request will be ignored and a warning message will be logged.  If the [.filename]#securenets# does not exist, `ypserv` will allow connections from any host.Úå¦‚æœ man:ypserv[8] æ¥æ”¶åˆ°ä¸è¿™äº›è§„åˆ™åŒ¹é…çš„åœ°å€çš„è¯·æ±‚ï¼Œå®ƒå°†æ­£å¸¸å¤„ç†è¯¥è¯·æ±‚ã€‚å¦‚æœåœ°å€æœªèƒ½åŒ¹é…è§„åˆ™ï¼Œè¯·æ±‚å°†è¢«å¿½ç•¥ï¼Œå¹¶è®°å½•ä¸€æ¡è­¦å‘Šä¿¡æ¯ã€‚å¦‚æœ [.filename]#securenets# ä¸å­˜åœ¨ï¼Œ`ypserv` å°†å…è®¸æ¥è‡ªä»»ä½•ä¸»æœºçš„è¿æ¥ã€‚Ú1crossref:security[tcpwrappers,"TCP Wrapper"] is an alternate mechanism for providing access control instead of [.filename]#securenets#.  While either access control mechanism adds some security, they are both vulnerable to "IP spoofing" attacks.  All NIS-related traffic should be blocked at the firewall.ÚJcrossref:security[tcpwrappers,"TCP Wrapper"] æ˜¯ä¸€ç§æ›¿ä»£çš„è®¿é—®æ§åˆ¶æœºåˆ¶ï¼Œç”¨äºæä¾›å¯¹ [.filename]#securenets# çš„è®¿é—®æ§åˆ¶ã€‚è™½ç„¶è¿™ä¸¤ç§è®¿é—®æ§åˆ¶æœºåˆ¶éƒ½å¢åŠ äº†ä¸€å®šçš„å®‰å…¨æ€§ï¼Œä½†å®ƒä»¬éƒ½å®¹æ˜“å—åˆ°â€œIP æ¬ºéª—â€æ”»å‡»çš„å½±å“ã€‚æ‰€æœ‰ä¸ NIS ç›¸å…³çš„æµé‡éƒ½åº”è¯¥åœ¨é˜²ç«å¢™ä¸Šè¢«é˜»æ­¢ã€‚ÚÍServers using [.filename]#securenets# may fail to serve legitimate NIS clients with archaic TCP/IP implementations.  Some of these implementations set all host bits to zero when doing broadcasts or fail to observe the subnet mask when calculating the broadcast address.  While some of these problems can be fixed by changing the client configuration, other problems may force the retirement of these client systems or the abandonment of [.filename]#securenets#.Úšä½¿ç”¨ [.filename]#securenets# çš„æœåŠ¡å™¨å¯èƒ½æ— æ³•ä¸ºä½¿ç”¨è¿‡æ—¶çš„ TCP/IP å®ç°çš„åˆæ³• NIS å®¢æˆ·ç«¯æä¾›æœåŠ¡ã€‚å…¶ä¸­ä¸€äº›å®ç°åœ¨è¿›è¡Œå¹¿æ’­æ—¶å°†æ‰€æœ‰ä¸»æœºä½è®¾ç½®ä¸ºé›¶ï¼Œæˆ–è€…åœ¨è®¡ç®—å¹¿æ’­åœ°å€æ—¶æœªè§‚å¯Ÿå­ç½‘æ©ç ã€‚è™½ç„¶å¯ä»¥é€šè¿‡æ›´æ”¹å®¢æˆ·ç«¯é…ç½®æ¥è§£å†³å…¶ä¸­ä¸€äº›é—®é¢˜ï¼Œä½†å…¶ä»–é—®é¢˜å¯èƒ½ä¼šè¿«ä½¿é€€å½¹è¿™äº›å®¢æˆ·ç«¯ç³»ç»Ÿæˆ–æ”¾å¼ƒ [.filename]#securenets#ã€‚ÚAThe use of TCP Wrapper increases the latency of the NIS server.  The additional delay may be long enough to cause timeouts in client programs, especially in busy networks with slow NIS servers.  If one or more clients suffer from latency, convert those clients into NIS slave servers and force them to bind to themselves.ÚNä½¿ç”¨ TCP Wrapper ä¼šå¢åŠ  NIS æœåŠ¡å™¨çš„å»¶è¿Ÿã€‚é¢å¤–çš„å»¶è¿Ÿå¯èƒ½è¶³å¤Ÿé•¿ï¼Œä»¥è‡³äºåœ¨ç¹å¿™çš„ç½‘ç»œä¸­ï¼Œç‰¹åˆ«æ˜¯åœ¨é€Ÿåº¦è¾ƒæ…¢çš„ NIS æœåŠ¡å™¨ä¸Šï¼Œä¼šå¯¼è‡´å®¢æˆ·ç«¯ç¨‹åºè¶…æ—¶ã€‚å¦‚æœä¸€ä¸ªæˆ–å¤šä¸ªå®¢æˆ·ç«¯å—åˆ°å»¶è¿Ÿçš„å½±å“ï¼Œå°†è¿™äº›å®¢æˆ·ç«¯è½¬æ¢ä¸º NIS ä»æœåŠ¡å™¨ï¼Œå¹¶å¼ºåˆ¶å®ƒä»¬ç»‘å®šåˆ°è‡ªå·±ã€‚²Barring Some Users²ç¦æ­¢æŸäº›ç”¨æˆ·ÚIn this example, the `basie` system is a faculty workstation within the NIS domain.  The [.filename]#passwd# map on the master NIS server contains accounts for both faculty and students.  This section demonstrates how to allow faculty logins on this system while refusing student logins.Ùüåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ`basie` ç³»ç»Ÿæ˜¯ NIS åŸŸä¸­çš„ä¸€ä¸ªæ•™èŒå·¥å·¥ä½œç«™ã€‚ä¸» NIS æœåŠ¡å™¨ä¸Šçš„ [.filename]#passwd# æ˜ å°„åŒ…å«äº†æ•™èŒå·¥å’Œå­¦ç”Ÿçš„è´¦æˆ·ã€‚æœ¬èŠ‚æ¼”ç¤ºäº†å¦‚ä½•å…è®¸æ•™èŒå·¥ç™»å½•è¿™ä¸ªç³»ç»Ÿï¼ŒåŒæ—¶æ‹’ç»å­¦ç”Ÿç™»å½•ã€‚Ú¾To prevent specified users from logging on to a system, even if they are present in the NIS database, use `vipw` to add `-_username_` with the correct number of colons towards the end of [.filename]#/etc/master.passwd# on the client, where _username_ is the username of a user to bar from logging in.  The line with the blocked user must be before the `+` line that allows NIS users.  In this example, `bill` is barred from logging on to `basie`:Ú†ä¸ºäº†é˜²æ­¢æŒ‡å®šçš„ç”¨æˆ·ç™»å½•ç³»ç»Ÿï¼Œå³ä½¿ä»–ä»¬åœ¨ NIS æ•°æ®åº“ä¸­å­˜åœ¨ï¼Œä½¿ç”¨ `vipw` åœ¨å®¢æˆ·ç«¯çš„ [.filename]#/etc/master.passwd# æœ«å°¾æ·»åŠ  `-_username_`ï¼Œå…¶ä¸­ `_username_` æ˜¯è¦ç¦æ­¢ç™»å½•çš„ç”¨æˆ·çš„ç”¨æˆ·åï¼Œå¹¶ä¸”æ­£ç¡®çš„å†’å·æ•°é‡ã€‚è¢«é˜»æ­¢ç”¨æˆ·çš„è¡Œå¿…é¡»åœ¨å…è®¸ NIS ç”¨æˆ·çš„ `+` è¡Œä¹‹å‰ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ`bill` è¢«ç¦æ­¢ç™»å½•åˆ° `basie`ã€‚¯Using Netgroups°ä½¿ç”¨ NetgroupsÙ­Barring specified users from logging on to individual systems becomes unscaleable on larger networks and quickly loses the main benefit of NIS: _centralized_ administration.Ù”åœ¨è¾ƒå¤§çš„ç½‘ç»œä¸Šï¼Œç¦æ­¢ç‰¹å®šç”¨æˆ·ç™»å½•åˆ°ä¸ªåˆ«ç³»ç»Ÿå˜å¾—ä¸å¯æ‰©å±•ï¼Œå¹¶ä¸”å¾ˆå¿«å¤±å»äº† NIS çš„ä¸»è¦ä¼˜åŠ¿ï¼š_é›†ä¸­åŒ–_ç®¡ç†ã€‚ÚNetgroups were developed to handle large, complex networks with hundreds of users and machines.  Their use is comparable to UNIX(R) groups, where the main difference is the lack of a numeric ID and the ability to define a netgroup by including both user accounts and other netgroups.ÙğNetgroups æ˜¯ä¸ºå¤„ç†å…·æœ‰æ•°ç™¾ä¸ªç”¨æˆ·å’Œæœºå™¨çš„å¤§å‹å¤æ‚ç½‘ç»œè€Œå¼€å‘çš„ã€‚å®ƒä»¬çš„ä½¿ç”¨ç±»ä¼¼äº UNIX(R) ç»„ï¼Œä¸»è¦åŒºåˆ«åœ¨äºç¼ºä¹æ•°å­— IDï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡åŒ…å«ç”¨æˆ·è´¦æˆ·å’Œå…¶ä»– netgroups æ¥å®šä¹‰ netgroupã€‚ÙŠTo expand on the example used in this chapter, the NIS domain will be extended to add the users and systems shown in Tables 28.2 and 28.3:Ùsä¸ºäº†æ‰©å±•æœ¬ç« ä¸­ä½¿ç”¨çš„ç¤ºä¾‹ï¼ŒNIS åŸŸå°†è¢«æ‰©å±•ä»¥æ·»åŠ è¡¨ 28.2 å’Œ 28.3 ä¸­æ˜¾ç¤ºçš„ç”¨æˆ·å’Œç³»ç»Ÿã€‚°Additional Users¬é™„åŠ ç”¨æˆ·¬User Name(s)©ç”¨æˆ·å·IT department employees¯IT éƒ¨é—¨å‘˜å·¥¹IT department apprentices¯IT éƒ¨é—¨å­¦å¾’©employees¦å‘˜å·¥§interns©å®ä¹ ç”Ÿ²Additional Systems¬å…¶ä»–ç³»ç»Ÿ¯Machine Name(s)¬æœºå™¨åç§°Ù8Only IT employees are allowed to log onto these servers.Ù.åªæœ‰ IT å‘˜å·¥æ‰èƒ½ç™»å½•è¿™äº›æœåŠ¡å™¨ã€‚ÙIAll members of the IT department are allowed to login onto these servers.Ù<IT éƒ¨é—¨çš„æ‰€æœ‰æˆå‘˜éƒ½è¢«å…è®¸ç™»å½•è¿™äº›æœåŠ¡å™¨ã€‚Ù(Ordinary workstations used by employees.Ù!å‘˜å·¥ä½¿ç”¨çš„æ™®é€šå·¥ä½œç«™ã€‚ÙZA very old machine without any critical data. Even interns are allowed to use this system.Ùfä¸€å°éå¸¸è€æ—§çš„æœºå™¨ï¼Œæ²¡æœ‰ä»»ä½•å…³é”®æ•°æ®ã€‚ç”šè‡³å®ä¹ ç”Ÿéƒ½å¯ä»¥ä½¿ç”¨è¿™ä¸ªç³»ç»Ÿã€‚ÚÎWhen using netgroups to configure this scenario, each user is assigned to one or more netgroups and logins are then allowed or forbidden for all members of the netgroup.  When adding a new machine, login restrictions must be defined for all netgroups.  When a new user is added, the account must be added to one or more netgroups.  If the NIS setup is planned carefully, only one central configuration file needs modification to grant or deny access to machines.ÚÉåœ¨ä½¿ç”¨ netgroups é…ç½®è¿™ç§æƒ…å†µæ—¶ï¼Œæ¯ä¸ªç”¨æˆ·éƒ½è¢«åˆ†é…åˆ°ä¸€ä¸ªæˆ–å¤šä¸ª netgroupsï¼Œå¹¶ä¸”ç™»å½•æƒé™ä¼šå¯¹ netgroup çš„æ‰€æœ‰æˆå‘˜è¿›è¡Œå…è®¸æˆ–ç¦æ­¢ã€‚å½“æ·»åŠ ä¸€ä¸ªæ–°çš„æœºå™¨æ—¶ï¼Œå¿…é¡»ä¸ºæ‰€æœ‰ netgroups å®šä¹‰ç™»å½•é™åˆ¶ã€‚å½“æ·»åŠ ä¸€ä¸ªæ–°ç”¨æˆ·æ—¶ï¼Œå¿…é¡»å°†è¯¥è´¦æˆ·æ·»åŠ åˆ°ä¸€ä¸ªæˆ–å¤šä¸ª netgroups ä¸­ã€‚å¦‚æœ NIS è®¾ç½®å¾—å½“ï¼Œåªéœ€è¦ä¿®æ”¹ä¸€ä¸ªä¸­å¤®é…ç½®æ–‡ä»¶å°±å¯ä»¥æˆäºˆæˆ–æ‹’ç»å¯¹æœºå™¨çš„è®¿é—®æƒé™ã€‚ÙÍThe first step is the initialization of the NIS`netgroup` map.  In FreeBSD, this map is not created by default.  On the NIS master server, use an editor to create a map named [.filename]#/var/yp/netgroup#.ÙÑç¬¬ä¸€æ­¥æ˜¯åˆå§‹åŒ– NIS çš„ `netgroup` æ˜ å°„ã€‚åœ¨ FreeBSD ä¸­ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¸ä¼šåˆ›å»ºæ­¤æ˜ å°„ã€‚åœ¨ NIS ä¸»æœåŠ¡å™¨ä¸Šï¼Œä½¿ç”¨ç¼–è¾‘å™¨åˆ›å»ºä¸€ä¸ªåä¸º [.filename]#/var/yp/netgroup# çš„æ˜ å°„ã€‚ÙfThis example creates four netgroups to represent IT employees, IT apprentices, employees, and interns:Ùaè¿™ä¸ªä¾‹å­åˆ›å»ºäº†å››ä¸ªç½‘ç»œç»„ï¼Œåˆ†åˆ«ä»£è¡¨ IT å‘˜å·¥ã€IT å­¦å¾’ã€å‘˜å·¥å’Œå®ä¹ ç”Ÿï¼šÚEach entry configures a netgroup. The first column in an entry is the name of the netgroup.  Each set of parentheses represents either a group of one or more users or the name of another netgroup.  When specifying a user, the three comma-delimited fields inside each group represent:Ùææ¯ä¸ªæ¡ç›®é…ç½®ä¸€ä¸ª netgroupã€‚æ¡ç›®ä¸­çš„ç¬¬ä¸€åˆ—æ˜¯ netgroup çš„åç§°ã€‚æ¯å¯¹æ‹¬å·è¡¨ç¤ºä¸€ä¸ªæˆ–å¤šä¸ªç”¨æˆ·çš„ç»„æˆ–å¦ä¸€ä¸ª netgroup çš„åç§°ã€‚åœ¨æŒ‡å®šç”¨æˆ·æ—¶ï¼Œæ¯ä¸ªç»„å†…çš„ä¸‰ä¸ªé€—å·åˆ†éš”å­—æ®µè¡¨ç¤ºï¼šÙThe name of the host(s) where the other fields representing the user are valid. If a hostname is not specified, the entry is valid on all hosts.Ùuè¡¨ç¤ºç”¨æˆ·æœ‰æ•ˆçš„å…¶ä»–å­—æ®µæ‰€åœ¨çš„ä¸»æœºåã€‚å¦‚æœæœªæŒ‡å®šä¸»æœºåï¼Œåˆ™æ¡ç›®åœ¨æ‰€æœ‰ä¸»æœºä¸Šæœ‰æ•ˆã€‚Ù6The name of the account that belongs to this netgroup.Ù'å±äºæ­¤ç½‘ç»œç»„çš„å¸æˆ·çš„åç§°ã€‚Ù`The NIS domain for the account. Accounts may be imported from other NIS domains into a netgroup.ÙLå¸æˆ·çš„ NIS åŸŸã€‚å¯ä»¥å°†å¸æˆ·ä»å…¶ä»– NIS åŸŸå¯¼å…¥åˆ°ç½‘ç»œç»„ä¸­ã€‚ÙšIf a group contains multiple users, separate each user with whitespace.  Additionally, each field may contain wildcards.  See man:netgroup[5] for details.Ù¦å¦‚æœä¸€ä¸ªç»„åŒ…å«å¤šä¸ªç”¨æˆ·ï¼Œè¯·ä½¿ç”¨ç©ºæ ¼åˆ†éš”æ¯ä¸ªç”¨æˆ·ã€‚æ­¤å¤–ï¼Œæ¯ä¸ªå­—æ®µå¯ä»¥åŒ…å«é€šé…ç¬¦ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… man:netgroup[5]ã€‚ÙÎNetgroup names longer than 8 characters should not be used.  The names are case sensitive and using capital letters for netgroup names is an easy way to distinguish between user, machine and netgroup names.Ù·ä¸åº”ä½¿ç”¨è¶…è¿‡ 8 ä¸ªå­—ç¬¦çš„ Netgroup åç§°ã€‚è¿™äº›åç§°åŒºåˆ†å¤§å°å†™ï¼Œä½¿ç”¨å¤§å†™å­—æ¯ä½œä¸º Netgroup åç§°æ˜¯åŒºåˆ†ç”¨æˆ·ã€æœºå™¨å’Œ Netgroup åç§°çš„ç®€å•æ–¹æ³•ã€‚ÙüSome non-FreeBSD NIS clients cannot handle netgroups containing more than 15 entries.  This limit may be circumvented by creating several sub-netgroups with 15 users or fewer and a real netgroup consisting of the sub-netgroups, as seen in this example:Úä¸€äº›é FreeBSD çš„ NIS å®¢æˆ·ç«¯æ— æ³•å¤„ç†åŒ…å«è¶…è¿‡ 15 ä¸ªæ¡ç›®çš„ netgroupã€‚å¯ä»¥é€šè¿‡åˆ›å»ºå¤šä¸ªåŒ…å« 15 ä¸ªæˆ–æ›´å°‘ç”¨æˆ·çš„å­ netgroup ä»¥åŠä¸€ä¸ªç”±å­ netgroup ç»„æˆçš„çœŸæ­£çš„ netgroup æ¥ç»•è¿‡æ­¤é™åˆ¶ï¼Œå¦‚ä¸‹é¢çš„ç¤ºä¾‹æ‰€ç¤ºï¼šÙXRepeat this process if more than 225 (15 times 15) users exist within a single netgroup.Ù\å¦‚æœå•ä¸ªç½‘ç»œç»„ä¸­å­˜åœ¨è¶…è¿‡ 225 ä¸ªï¼ˆ15 ä¹˜ä»¥ 15ï¼‰ç”¨æˆ·ï¼Œè¯·é‡å¤æ­¤è¿‡ç¨‹ã€‚Ù+To activate and distribute the new NIS map:Ù&è¦æ¿€æ´»å’Œåˆ†å‘æ–°çš„ NIS æ˜ å°„ï¼šÙÏThis will generate the three NIS maps [.filename]#netgroup#, [.filename]#netgroup.byhost# and [.filename]#netgroup.byuser#.  Use the map key option of man:ypcat[1] to check if the new NIS maps are available:ÙÑè¿™å°†ç”Ÿæˆä¸‰ä¸ª NIS æ˜ å°„æ–‡ä»¶ [.filename]#netgroup#ã€[.filename]#netgroup.byhost# å’Œ [.filename]#netgroup.byuser#ã€‚ä½¿ç”¨ man:ypcat[1] çš„æ˜ å°„é”®é€‰é¡¹æ¥æ£€æŸ¥æ–°çš„ NIS æ˜ å°„æ–‡ä»¶æ˜¯å¦å¯ç”¨ï¼šÙôThe output of the first command should resemble the contents of [.filename]#/var/yp/netgroup#.  The second command only produces output if host-specific netgroups were created.  The third command is used to get the list of netgroups for a user.Ùäç¬¬ä¸€ä¸ªå‘½ä»¤çš„è¾“å‡ºåº”è¯¥ç±»ä¼¼äº [.filename]#/var/yp/netgroup# æ–‡ä»¶çš„å†…å®¹ã€‚åªæœ‰åœ¨åˆ›å»ºäº†ç‰¹å®šä¸»æœºçš„ netgroup æ—¶ï¼Œç¬¬äºŒä¸ªå‘½ä»¤æ‰ä¼šäº§ç”Ÿè¾“å‡ºã€‚ç¬¬ä¸‰ä¸ªå‘½ä»¤ç”¨äºè·å–ç”¨æˆ·çš„ netgroup åˆ—è¡¨ã€‚Ù‡To configure a client, use man:vipw[8] to specify the name of the netgroup.  For example, on the server named `war`, replace this line:Ù‡è¦é…ç½®å®¢æˆ·ç«¯ï¼Œè¯·ä½¿ç”¨ man:vipw[8] æ¥æŒ‡å®š netgroup çš„åç§°ã€‚ä¾‹å¦‚ï¼Œåœ¨åä¸º `war` çš„æœåŠ¡å™¨ä¸Šï¼Œæ›¿æ¢è¿™ä¸€è¡Œï¼šÙ³This specifies that only the users defined in the netgroup `IT_EMP` will be imported into this system's password database and only those users are allowed to login to this system.Ùè¿™æŒ‡å®šåªæœ‰åœ¨ netgroup `IT_EMP` ä¸­å®šä¹‰çš„ç”¨æˆ·å°†è¢«å¯¼å…¥åˆ°æ­¤ç³»ç»Ÿçš„å¯†ç æ•°æ®åº“ä¸­ï¼Œå¹¶ä¸”åªæœ‰è¿™äº›ç”¨æˆ·è¢«å…è®¸ç™»å½•åˆ°æ­¤ç³»ç»Ÿã€‚ÚÂThis configuration also applies to the `~` function of the shell and all routines which convert between user names and numerical user IDs.  In other words, `cd ~_user_` will not work, `ls -l` will show the numerical ID instead of the username, and `find . -user joe -print` will fail with the message `No such user`.  To fix this, import all user entries without allowing them to login into the servers.  This can be achieved by adding an extra line:Ú—æ­¤é…ç½®ä¹Ÿé€‚ç”¨äº shell çš„ `~` å‡½æ•°å’Œæ‰€æœ‰åœ¨ç”¨æˆ·åç§°å’Œæ•°å­—ç”¨æˆ· ID ä¹‹é—´è½¬æ¢çš„ä¾‹ç¨‹ã€‚æ¢å¥è¯è¯´ï¼Œ`cd ~_user_` å°†æ— æ³•å·¥ä½œï¼Œ`ls -l` å°†æ˜¾ç¤ºæ•°å­— ID è€Œä¸æ˜¯ç”¨æˆ·åï¼Œ`find . -user joe -print` å°†ä»¥ `No such user` çš„æ¶ˆæ¯å¤±è´¥ã€‚è¦è§£å†³æ­¤é—®é¢˜ï¼Œå¯¼å…¥æ‰€æœ‰ç”¨æˆ·æ¡ç›®æ—¶ä¸å…è®¸å®ƒä»¬ç™»å½•åˆ°æœåŠ¡å™¨ã€‚å¯ä»¥é€šè¿‡æ·»åŠ é¢å¤–çš„ä¸€è¡Œæ¥å®ç°è¿™ä¸€ç‚¹ï¼šÙ„This line configures the client to import all entries but to replace the shell in those entries with [.filename]#/usr/sbin/nologin#.Ù€è¿™è¡Œé…ç½®å°†å®¢æˆ·ç«¯é…ç½®ä¸ºå¯¼å…¥æ‰€æœ‰æ¡ç›®ï¼Œä½†å°†è¿™äº›æ¡ç›®ä¸­çš„ shell æ›¿æ¢ä¸º [.filename]#/usr/sbin/nologin#ã€‚ÙŞMake sure that extra line is placed _after_ `+@IT_EMP:::::::::`.  Otherwise, all user accounts imported from NIS will have [.filename]#/usr/sbin/nologin# as their login shell and no one will be able to login to the system.ÙÒè¯·ç¡®ä¿åœ¨ `+@IT_EMP:::::::::` _ä¹‹å_æ”¾ç½®é¢å¤–çš„ç©ºè¡Œã€‚å¦åˆ™ï¼Œä» NIS å¯¼å…¥çš„æ‰€æœ‰ç”¨æˆ·å¸æˆ·å°†å°† [.filename]#/usr/sbin/nologin# ä½œä¸ºå…¶ç™»å½• shellï¼Œè€Œæ²¡æœ‰äººå°†èƒ½å¤Ÿç™»å½•åˆ°ç³»ç»Ÿã€‚ÙfTo configure the less important servers, replace the old `+:::::::::` on the servers with these lines:Ù_è¦é…ç½®è¾ƒä¸é‡è¦çš„æœåŠ¡å™¨ï¼Œè¯·å°†æœåŠ¡å™¨ä¸Šçš„æ—§ `+:::::::::` æ›¿æ¢ä¸ºä»¥ä¸‹è¡Œï¼šÙ6The corresponding lines for the workstations would be:»å·¥ä½œç«™çš„ç›¸åº”è¡Œä¸ºï¼šÚKNIS supports the creation of netgroups from other netgroups which can be useful if the policy regarding user access changes.  One possibility is the creation of role-based netgroups.  For example, one might create a netgroup called `BIGSRV` to define the login restrictions for the important servers, another netgroup called `SMALLSRV` for the less important servers, and a third netgroup called `USERBOX` for the workstations.  Each of these netgroups contains the netgroups that are allowed to login onto these machines.  The new entries for the NIS`netgroup` map would look like this:ÚNIS æ”¯æŒä»å…¶ä»– netgroups åˆ›å»º netgroupsï¼Œè¿™åœ¨ç”¨æˆ·è®¿é—®ç­–ç•¥å‘ç”Ÿå˜åŒ–æ—¶éå¸¸æœ‰ç”¨ã€‚ä¸€ä¸ªå¯èƒ½çš„æƒ…å†µæ˜¯åˆ›å»ºåŸºäºè§’è‰²çš„ netgroupsã€‚ä¾‹å¦‚ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªåä¸º `BIGSRV` çš„ netgroup æ¥å®šä¹‰é‡è¦æœåŠ¡å™¨çš„ç™»å½•é™åˆ¶ï¼Œå¦ä¸€ä¸ªåä¸º `SMALLSRV` çš„ netgroup ç”¨äºä¸å¤ªé‡è¦çš„æœåŠ¡å™¨ï¼Œä»¥åŠä¸€ä¸ªåä¸º `USERBOX` çš„ netgroup ç”¨äºå·¥ä½œç«™ã€‚æ¯ä¸ª netgroup éƒ½åŒ…å«è¢«å…è®¸ç™»å½•åˆ°è¿™äº›æœºå™¨ä¸Šçš„ netgroupsã€‚NIS`netgroup` æ˜ å°„çš„æ–°æ¡ç›®å¦‚ä¸‹æ‰€ç¤ºï¼šÚ&This method of defining login restrictions works reasonably well when it is possible to define groups of machines with identical restrictions.  Unfortunately, this is the exception and not the rule.  Most of the time, the ability to define login restrictions on a per-machine basis is required.Ùíå½“èƒ½å¤Ÿå®šä¹‰å…·æœ‰ç›¸åŒé™åˆ¶çš„æœºå™¨ç»„æ—¶ï¼Œè¿™ç§å®šä¹‰ç™»å½•é™åˆ¶çš„æ–¹æ³•è¿ä½œå¾—ç›¸å½“ä¸é”™ã€‚ä¸å¹¸çš„æ˜¯ï¼Œè¿™åªæ˜¯ä¸ªä¾‹è€Œä¸æ˜¯è§„åˆ™ã€‚å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œéœ€è¦èƒ½å¤ŸæŒ‰ç…§æ¯å°æœºå™¨çš„åŸºç¡€å®šä¹‰ç™»å½•é™åˆ¶ã€‚Ú×Machine-specific netgroup definitions are another possibility to deal with the policy changes.  In this scenario, the [.filename]#/etc/master.passwd# of each system contains two lines starting with "+".  The first line adds a netgroup with the accounts allowed to login onto this machine and the second line adds all other accounts with [.filename]#/usr/sbin/nologin# as shell.  It is recommended to use the "ALL-CAPS" version of the hostname as the name of the netgroup:Ú£æœºå™¨ç‰¹å®šçš„ç½‘ç»œç»„å®šä¹‰æ˜¯å¤„ç†ç­–ç•¥å˜æ›´çš„å¦ä¸€ç§å¯èƒ½æ€§ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ¯ä¸ªç³»ç»Ÿçš„ [.filename]#/etc/master.passwd# æ–‡ä»¶åŒ…å«ä¸¤è¡Œä»¥"+"å¼€å¤´çš„å†…å®¹ã€‚ç¬¬ä¸€è¡Œæ·»åŠ äº†ä¸€ä¸ªå…è®¸ç™»å½•åˆ°è¯¥æœºå™¨çš„å¸æˆ·çš„ç½‘ç»œç»„ï¼Œç¬¬äºŒè¡Œæ·»åŠ äº†æ‰€æœ‰å…¶ä»–å¸æˆ·ï¼Œå¹¶å°†å…¶ shell è®¾ç½®ä¸º [.filename]#/usr/sbin/nologin#ã€‚å»ºè®®ä½¿ç”¨ä¸»æœºåçš„å¤§å†™ç‰ˆæœ¬ä½œä¸ºç½‘ç»œç»„çš„åç§°ï¼šÚOnce this task is completed on all the machines, there is no longer a need to modify the local versions of [.filename]#/etc/master.passwd# ever again.  All further changes can be handled by modifying the NIS map.  Here is an example of a possible `netgroup` map for this scenario:Ùşä¸€æ—¦åœ¨æ‰€æœ‰æœºå™¨ä¸Šå®Œæˆäº†è¿™ä¸ªä»»åŠ¡ï¼Œå°±ä¸å†éœ€è¦å†æ¬¡ä¿®æ”¹æœ¬åœ°ç‰ˆæœ¬çš„ [.filename]#/etc/master.passwd# æ–‡ä»¶äº†ã€‚æ‰€æœ‰åç»­çš„æ›´æ”¹éƒ½å¯ä»¥é€šè¿‡ä¿®æ”¹ NIS æ˜ å°„æ¥å¤„ç†ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªå¯èƒ½çš„ `netgroup` æ˜ å°„çš„ç¤ºä¾‹ï¼šÙöIt may not always be advisable to use machine-based netgroups.  When deploying a couple of dozen or hundreds of systems, role-based netgroups instead of machine-based netgroups may be used to keep the size of the NIS map within reasonable limits.ÙÔå¹¶ä¸æ€»æ˜¯å»ºè®®ä½¿ç”¨åŸºäºæœºå™¨çš„ç½‘ç»œç»„ã€‚å½“éƒ¨ç½²å‡ åä¸ªæˆ–å‡ ç™¾ä¸ªç³»ç»Ÿæ—¶ï¼Œå¯ä»¥ä½¿ç”¨åŸºäºè§’è‰²çš„ç½‘ç»œç»„ä»£æ›¿åŸºäºæœºå™¨çš„ç½‘ç»œç»„ï¼Œä»¥ä¿æŒ NIS æ˜ å°„çš„å¤§å°åœ¨åˆç†èŒƒå›´å†…ã€‚°Password Formats¬å¯†ç æ ¼å¼ÚANIS requires that all hosts within an NIS domain use the same format for encrypting passwords.  If users have trouble authenticating on an NIS client, it may be due to a differing password format.  In a heterogeneous network, the format must be supported by all operating systems, where DES is the lowest common standard.Ú	NIS è¦æ±‚ NIS åŸŸå†…çš„æ‰€æœ‰ä¸»æœºä½¿ç”¨ç›¸åŒçš„å¯†ç åŠ å¯†æ ¼å¼ã€‚å¦‚æœç”¨æˆ·åœ¨ NIS å®¢æˆ·ç«¯ä¸Šè®¤è¯æ—¶é‡åˆ°é—®é¢˜ï¼Œå¯èƒ½æ˜¯ç”±äºå¯†ç æ ¼å¼ä¸åŒã€‚åœ¨å¼‚æ„ç½‘ç»œä¸­ï¼Œè¯¥æ ¼å¼å¿…é¡»ç”±æ‰€æœ‰æ“ä½œç³»ç»Ÿæ”¯æŒï¼Œå…¶ä¸­ DES æ˜¯æœ€ä½å…¬å…±æ ‡å‡†ã€‚ÙhTo check which format a server or client is using, look at this section of [.filename]#/etc/login.conf#:Ùoè¦æ£€æŸ¥æœåŠ¡å™¨æˆ–å®¢æˆ·ç«¯ä½¿ç”¨çš„æ ¼å¼ï¼Œè¯·æŸ¥çœ‹ [.filename]#/etc/login.conf# æ–‡ä»¶çš„è¿™ä¸ªéƒ¨åˆ†ï¼šÚ<In this example, the system is using the DES format for password hashing.  Other possible values include `blf` for Blowfish, `md5` for MD5, `sha256` and `sha512` for SHA-256 and SHA-512 respectively.  For more information and the up to date list of what is available on your system, consult the man:crypt[3] manpage.Ú åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œç³»ç»Ÿä½¿ç”¨ DES æ ¼å¼è¿›è¡Œå¯†ç å“ˆå¸Œã€‚å…¶ä»–å¯èƒ½çš„å€¼åŒ…æ‹¬ `blf` è¡¨ç¤º Blowfishï¼Œ`md5` è¡¨ç¤º MD5ï¼Œ`sha256` å’Œ `sha512` åˆ†åˆ«è¡¨ç¤º SHA-256 å’Œ SHA-512ã€‚è¦è·å–æ›´å¤šä¿¡æ¯å’Œç³»ç»Ÿä¸Šå¯ç”¨é€‰é¡¹çš„æœ€æ–°åˆ—è¡¨ï¼Œè¯·å‚è€ƒ man:crypt[3] æ‰‹å†Œé¡µã€‚Ù If the format on a host needs to be edited to match the one being used in the NIS domain, the login capability database must be rebuilt after saving the change:ÙŒå¦‚æœéœ€è¦ç¼–è¾‘ä¸»æœºä¸Šçš„æ ¼å¼ä»¥åŒ¹é…åœ¨ NIS åŸŸä¸­ä½¿ç”¨çš„æ ¼å¼ï¼Œåˆ™åœ¨ä¿å­˜æ›´æ”¹åå¿…é¡»é‡æ–°æ„å»ºç™»å½•èƒ½åŠ›æ•°æ®åº“ã€‚ÙŸThe format of passwords for existing user accounts will not be updated until each user changes their password _after_ the login capability database is rebuilt.Ù„åœ¨ç™»å½•èƒ½åŠ›æ•°æ®åº“é‡å»ºä¹‹åï¼Œåªæœ‰å½“æ¯ä¸ªç”¨æˆ·åœ¨æ›´æ”¹å¯†ç ä¹‹åï¼Œç°æœ‰ç”¨æˆ·è´¦æˆ·çš„å¯†ç æ ¼å¼æ‰ä¼šæ›´æ–°ã€‚Ù,Lightweight Directory Access Protocol (LDAP)Ù%è½»é‡çº§ç›®å½•è®¿é—®åè®®ï¼ˆLDAPï¼‰ÚuThe Lightweight Directory Access Protocol (LDAP) is an application layer protocol used to access, modify, and authenticate objects using a distributed directory information service.  Think of it as a phone or record book which stores several levels of hierarchical, homogeneous information.  It is used in Active Directory and OpenLDAP networks and allows users to access to several levels of internal information utilizing a single account.  For example, email authentication, pulling employee contact information, and internal website authentication might all make use of a single user account in the LDAP server's record base.Úëè½»é‡çº§ç›®å½•è®¿é—®åè®®ï¼ˆLDAPï¼‰æ˜¯ä¸€ç§åº”ç”¨å±‚åè®®ï¼Œç”¨äºè®¿é—®ã€ä¿®æ”¹å’Œè®¤è¯ä½¿ç”¨åˆ†å¸ƒå¼ç›®å½•ä¿¡æ¯æœåŠ¡çš„å¯¹è±¡ã€‚å¯ä»¥å°†å…¶è§†ä¸ºå­˜å‚¨å¤šä¸ªå±‚æ¬¡ç»“æ„ã€åŒè´¨ä¿¡æ¯çš„ç”µè¯ç°¿æˆ–è®°å½•ç°¿ã€‚å®ƒåœ¨ Active Directory å’Œ OpenLDAP ç½‘ç»œä¸­ä½¿ç”¨ï¼Œå¹¶å…è®¸ç”¨æˆ·ä½¿ç”¨å•ä¸ªå¸æˆ·è®¿é—®å¤šä¸ªå±‚æ¬¡çš„å†…éƒ¨ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼Œç”µå­é‚®ä»¶è®¤è¯ã€è·å–å‘˜å·¥è”ç³»ä¿¡æ¯å’Œå†…éƒ¨ç½‘ç«™è®¤è¯å¯èƒ½éƒ½ä¼šä½¿ç”¨ LDAP æœåŠ¡å™¨è®°å½•åº“ä¸­çš„å•ä¸ªç”¨æˆ·å¸æˆ·ã€‚ÚdThis section provides a quick start guide for configuring an LDAP server on a FreeBSD system.  It assumes that the administrator already has a design plan which includes the type of information to store, what that information will be used for, which users should have access to that information, and how to secure this information from unauthorized access.Ú)æœ¬èŠ‚æä¾›äº†åœ¨ FreeBSD ç³»ç»Ÿä¸Šé…ç½® LDAP æœåŠ¡å™¨çš„å¿«é€Ÿå…¥é—¨æŒ‡å—ã€‚å®ƒå‡è®¾ç®¡ç†å‘˜å·²ç»æœ‰äº†ä¸€ä¸ªè®¾è®¡è®¡åˆ’ï¼Œå…¶ä¸­åŒ…æ‹¬è¦å­˜å‚¨çš„ä¿¡æ¯ç±»å‹ï¼Œè¯¥ä¿¡æ¯å°†ç”¨äºä»€ä¹ˆç›®çš„ï¼Œå“ªäº›ç”¨æˆ·åº”è¯¥è®¿é—®è¯¥ä¿¡æ¯ï¼Œä»¥åŠå¦‚ä½•ä¿æŠ¤è¯¥ä¿¡æ¯å…å—æœªç»æˆæƒçš„è®¿é—®ã€‚¾LDAP Terminology and Structure´LDAP æœ¯è¯­å’Œç»“æ„ÚãLDAP uses several terms which should be understood before starting the configuration.  All directory entries consist of a group of _attributes_.  Each of these attribute sets contains a unique identifier known as a _Distinguished Name_ (DN) which is normally built from several other attributes such as the common or _Relative Distinguished Name_ (RDN).  Similar to how directories have absolute and relative paths, consider a DN as an absolute path and the RDN as the relative path.Ú•åœ¨å¼€å§‹é…ç½®ä¹‹å‰ï¼Œéœ€è¦äº†è§£ LDAP ä½¿ç”¨çš„å‡ ä¸ªæœ¯è¯­ã€‚æ‰€æœ‰ç›®å½•æ¡ç›®ç”±ä¸€ç»„_å±æ€§_ç»„æˆã€‚æ¯ä¸ªå±æ€§é›†éƒ½åŒ…å«ä¸€ä¸ªç§°ä¸º_Distinguished Name_ï¼ˆDNï¼‰çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œé€šå¸¸ç”±å…¶ä»–å±æ€§ï¼ˆå¦‚å¸¸è§çš„æˆ–_Relative Distinguished Name_ ï¼ˆRDNï¼‰ï¼‰æ„å»ºè€Œæˆã€‚ç±»ä¼¼äºç›®å½•å…·æœ‰ç»å¯¹è·¯å¾„å’Œç›¸å¯¹è·¯å¾„ï¼Œå¯ä»¥å°† DN è§†ä¸ºç»å¯¹è·¯å¾„ï¼Œå°† RDN è§†ä¸ºç›¸å¯¹è·¯å¾„ã€‚Ù°An example LDAP entry looks like the following.  This example searches for the entry for the specified user account (`uid`), organizational unit (`ou`), and organization (`o`):ÙŠä¸€ä¸ªç¤ºä¾‹ LDAP æ¡ç›®å¦‚ä¸‹æ‰€ç¤ºã€‚æ­¤ç¤ºä¾‹æœç´¢æŒ‡å®šç”¨æˆ·å¸æˆ·ï¼ˆ`uid`ï¼‰ã€ç»„ç»‡å•ä½ï¼ˆ`ou`ï¼‰å’Œç»„ç»‡ï¼ˆ`o`ï¼‰çš„æ¡ç›®ï¼šÙ†This example entry shows the values for the `dn`, `mail`, `cn`, `uid`, and `telephoneNumber` attributes.  The cn attribute is the RDN.Ùsè¿™ä¸ªç¤ºä¾‹æ¡ç›®æ˜¾ç¤ºäº† `dn`ã€`mail`ã€`cn`ã€`uid` å’Œ `telephoneNumber` å±æ€§çš„å€¼ã€‚`cn` å±æ€§æ˜¯ RDNã€‚ÙŸMore information about LDAP and its terminology can be found at http://www.openldap.org/doc/admin24/intro.html[http://www.openldap.org/doc/admin24/intro.html].Ù•æœ‰å…³ LDAP åŠå…¶æœ¯è¯­çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·è®¿é—® http://www.openldap.org/doc/admin24/intro.html[http://www.openldap.org/doc/admin24/intro.html]ã€‚ºConfiguring an LDAP Serverµé…ç½® LDAP æœåŠ¡å™¨Ù†FreeBSD does not provide a built-in LDAP server.  Begin the configuration by installing package:net/openldap-server[] package or port:Ù‹FreeBSD æ²¡æœ‰æä¾›å†…ç½®çš„ LDAP æœåŠ¡å™¨ã€‚å¼€å§‹é…ç½®è¿‡ç¨‹ï¼Œéœ€è¦å®‰è£… `net/openldap-server` åŒ…æˆ–è€…ä½¿ç”¨ port è¿›è¡Œå®‰è£…ã€‚Ú9There is a large set of default options enabled in the extref:{linux-users}[package, software].  Review them by running `pkg info openldap-server`.  If they are not sufficient (for example if SQL support is needed), please consider recompiling the port using the appropriate crossref:ports[ports-using,framework].Úåœ¨ extref:{linux-users}[package, software] ä¸­å¯ç”¨äº†ä¸€ç»„å¤§é‡çš„é»˜è®¤é€‰é¡¹ã€‚é€šè¿‡è¿è¡Œ `pkg info openldap-server` æ¥æŸ¥çœ‹å®ƒä»¬ã€‚å¦‚æœå®ƒä»¬ä¸è¶³å¤Ÿï¼ˆä¾‹å¦‚éœ€è¦ SQL æ”¯æŒï¼‰ï¼Œè¯·è€ƒè™‘ä½¿ç”¨é€‚å½“çš„ crossref:ports[ports-using, framework] é‡æ–°ç¼–è¯‘è¯¥ portã€‚Ù•The installation creates the directory [.filename]#/var/db/openldap-data# to hold the data.  The directory to store the certificates must be created:Ù{å®‰è£…è¿‡ç¨‹ä¼šåˆ›å»ºç›®å½• [.filename]#/var/db/openldap-data# æ¥å­˜å‚¨æ•°æ®ã€‚å¿…é¡»åˆ›å»ºç”¨äºå­˜å‚¨è¯ä¹¦çš„ç›®å½•ï¼šÚ×The next phase is to configure the Certificate Authority.  The following commands must be executed from [.filename]#/usr/local/etc/openldap/private#.  This is important as the file permissions need to be restrictive and users should not have access to these files.  More detailed information about certificates and their parameters can be found in crossref:security[openssl,"OpenSSL"].  To create the Certificate Authority, start with this command and follow the prompts:Ú…ä¸‹ä¸€æ­¥æ˜¯é…ç½®è¯ä¹¦é¢å‘æœºæ„ã€‚ä»¥ä¸‹å‘½ä»¤å¿…é¡»ä» [.filename]#/usr/local/etc/openldap/private# ç›®å½•ä¸‹æ‰§è¡Œã€‚è¿™å¾ˆé‡è¦ï¼Œå› ä¸ºæ–‡ä»¶æƒé™éœ€è¦é™åˆ¶ï¼Œå¹¶ä¸”ç”¨æˆ·ä¸åº”è¯¥è®¿é—®è¿™äº›æ–‡ä»¶ã€‚æœ‰å…³è¯ä¹¦åŠå…¶å‚æ•°çš„æ›´è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… crossref:security[openssl,"OpenSSL"]ã€‚è¦åˆ›å»ºè¯ä¹¦é¢å‘æœºæ„ï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¹¶æŒ‰ç…§æç¤ºè¿›è¡Œæ“ä½œï¼šÙéThe entries for the prompts may be generic _except_ for the `Common Name`.  This entry must be _different_ than the system hostname.  If this will be a self signed certificate, prefix the hostname with `CA` for Certificate Authority.ÙÑæç¤ºçš„æ¡ç›®å¯ä»¥æ˜¯é€šç”¨çš„ï¼Œé™¤äº† `Common Name` ä¹‹å¤–ã€‚è¿™ä¸ªæ¡ç›®å¿…é¡»ä¸ç³»ç»Ÿä¸»æœºå_ä¸åŒ_ã€‚å¦‚æœè¿™å°†æ˜¯ä¸€ä¸ªè‡ªç­¾åè¯ä¹¦ï¼Œè¯·åœ¨ä¸»æœºåå‰åŠ ä¸Š `CA` è¡¨ç¤ºè¯ä¹¦é¢å‘æœºæ„ã€‚ÙwThe next task is to create a certificate signing request and a private key.  Input this command and follow the prompts:Ù`ä¸‹ä¸€æ­¥æ˜¯åˆ›å»ºè¯ä¹¦ç­¾åè¯·æ±‚å’Œç§é’¥ã€‚è¾“å…¥ä»¥ä¸‹å‘½ä»¤å¹¶æŒ‰ç…§æç¤ºè¿›è¡Œæ“ä½œï¼šÙÛDuring the certificate generation process, be sure to correctly set the `Common Name` attribute.  The Certificate Signing Request must be signed with the Certificate Authority in order to be used as a valid certificate:Ù™åœ¨è¯ä¹¦ç”Ÿæˆè¿‡ç¨‹ä¸­ï¼Œè¯·ç¡®ä¿æ­£ç¡®è®¾ç½® `Common Name` å±æ€§ã€‚è¯ä¹¦ç­¾åè¯·æ±‚å¿…é¡»ç”±è¯ä¹¦é¢å‘æœºæ„ç­¾åï¼Œæ‰èƒ½ç”¨ä½œæœ‰æ•ˆè¯ä¹¦ã€‚ÙeThe final part of the certificate generation process is to generate and sign the client certificates:ÙEè¯ä¹¦ç”Ÿæˆè¿‡ç¨‹çš„æœ€åä¸€æ­¥æ˜¯ç”Ÿæˆå’Œç­¾ç½²å®¢æˆ·ç«¯è¯ä¹¦ï¼šÙ¯Remember to use the same `Common Name` attribute when prompted.  When finished, ensure that a total of eight (8) new files have been generated through the proceeding commands.Ù‘åœ¨æç¤ºæ—¶ï¼Œè¯·è®°å¾—ä½¿ç”¨ç›¸åŒçš„ `Common Name` å±æ€§ã€‚å®Œæˆåï¼Œè¯·ç¡®ä¿é€šè¿‡å‰é¢çš„å‘½ä»¤ç”Ÿæˆäº†æ€»å…±å…«ï¼ˆ8ï¼‰ä¸ªæ–°æ–‡ä»¶ã€‚Ù¿The daemon running the OpenLDAP server is [.filename]#slapd#.  Its configuration is performed through [.filename]#slapd.ldif#: the old [.filename]#slapd.conf# has been deprecated by OpenLDAP.Ù¹è¿è¡Œ OpenLDAP æœåŠ¡å™¨çš„å®ˆæŠ¤è¿›ç¨‹æ˜¯ [.filename]#slapd#ã€‚å®ƒçš„é…ç½®æ˜¯é€šè¿‡ [.filename]#slapd.ldif# æ–‡ä»¶è¿›è¡Œçš„ï¼šæ—§çš„ [.filename]#slapd.conf# å·²è¢« OpenLDAP å¼ƒç”¨ã€‚ÚRhttp://www.openldap.org/doc/admin24/slapdconf2.html[Configuration examples] for [.filename]#slapd.ldif# are available and can also be found in [.filename]#/usr/local/etc/openldap/slapd.ldif.sample#.  Options are documented in slapd-config(5).  Each section of [.filename]#slapd.ldif#, like all the other LDAP attribute sets, is uniquely identified through a DN.  Be sure that no blank lines are left between the `dn:` statement and the desired end of the section.  In the following example, TLS will be used to implement a secure channel.  The first section represents the global configuration:Ú
http://www.openldap.org/doc/admin24/slapdconf2.html[é…ç½®ç¤ºä¾‹] å¯ä»¥åœ¨ [.filename]#slapd.ldif# ä¸­æ‰¾åˆ°ï¼Œå¹¶ä¸”è¿˜å¯ä»¥åœ¨ [.filename]#/usr/local/etc/openldap/slapd.ldif.sample# ä¸­æ‰¾åˆ°ã€‚é€‰é¡¹åœ¨ slapd-config(5) ä¸­æœ‰æ–‡æ¡£è®°å½•ã€‚[.filename]#slapd.ldif# çš„æ¯ä¸ªéƒ¨åˆ†ï¼Œå°±åƒæ‰€æœ‰å…¶ä»– LDAP å±æ€§é›†ä¸€æ ·ï¼Œéƒ½é€šè¿‡ DN å”¯ä¸€æ ‡è¯†ã€‚è¯·ç¡®ä¿åœ¨ `dn:` è¯­å¥å’Œæ‰€éœ€éƒ¨åˆ†çš„æœ«å°¾ä¹‹é—´æ²¡æœ‰ç©ºè¡Œã€‚åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œå°†ä½¿ç”¨ TLS æ¥å®ç°å®‰å…¨é€šé“ã€‚ç¬¬ä¸€éƒ¨åˆ†è¡¨ç¤ºå…¨å±€é…ç½®ï¼šÚĞThe Certificate Authority, server certificate and server private key files must be specified here.  It is recommended to let the clients choose the security cipher and omit option `olcTLSCipherSuite` (incompatible with TLS clients other than [.filename]#openssl#). Option `olcTLSProtocolMin` lets the server require a minimum security level: it is recommended.  While verification is mandatory for the server, it is not for the client: `olcTLSVerifyClient: never`.Úåœ¨è¿™é‡Œå¿…é¡»æŒ‡å®šè¯ä¹¦é¢å‘æœºæ„ã€æœåŠ¡å™¨è¯ä¹¦å’ŒæœåŠ¡å™¨ç§é’¥æ–‡ä»¶ã€‚å»ºè®®è®©å®¢æˆ·ç«¯é€‰æ‹©å®‰å…¨å¯†ç å¹¶çœç•¥é€‰é¡¹ `olcTLSCipherSuite` ï¼ˆä¸é™¤ [.filename]#openssl# ä¹‹å¤–çš„ TLS å®¢æˆ·ç«¯ä¸å…¼å®¹ï¼‰ã€‚é€‰é¡¹ `olcTLSProtocolMin` å…è®¸æœåŠ¡å™¨è¦æ±‚æœ€ä½å®‰å…¨çº§åˆ«ï¼šå»ºè®®ä½¿ç”¨ã€‚è™½ç„¶æœåŠ¡å™¨å¿…é¡»è¿›è¡ŒéªŒè¯ï¼Œä½†å®¢æˆ·ç«¯ä¸éœ€è¦ï¼š`olcTLSVerifyClient: never`ã€‚ÙQThe second section is about the backend modules and can be configured as follows:ÙNç¬¬äºŒéƒ¨åˆ†æ˜¯å…³äºåç«¯æ¨¡å—çš„ï¼Œå¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ–¹å¼è¿›è¡Œé…ç½®ï¼šÙoThe third section is devoted to load the needed `ldif` schemas to be used by the databases: they are essential.Ù\ç¬¬ä¸‰éƒ¨åˆ†ä¸“é—¨ç”¨äºåŠ è½½æ•°æ®åº“æ‰€éœ€çš„ `ldif` æ¨¡å¼ï¼šå®ƒä»¬æ˜¯å¿…ä¸å¯å°‘çš„ã€‚Ù)Next, the frontend configuration section:Ù!æ¥ä¸‹æ¥æ˜¯å‰ç«¯é…ç½®éƒ¨åˆ†ï¼šÙ”Another section is devoted to the _configuration backend_, the only way to later access the OpenLDAP server configuration is as a global super-user.Ù…å¦ä¸€ä¸ªéƒ¨åˆ†ä¸“é—¨ä»‹ç»äº† _é…ç½®åç«¯_ï¼Œè¿™æ˜¯ä»¥å…¨å±€è¶…çº§ç”¨æˆ·çš„èº«ä»½è®¿é—® OpenLDAP æœåŠ¡å™¨é…ç½®çš„å”¯ä¸€æ–¹å¼ã€‚Ú)The default administrator username is `cn=config`.  Type [.filename]#slappasswd# in a shell, choose a password and use its hash in `olcRootPW`.  If this option is not specified now, before [.filename]#slapd.ldif# is imported, no one will be later able to modify the _global configuration_ section.Úé»˜è®¤ç®¡ç†å‘˜ç”¨æˆ·åæ˜¯ `cn=config`ã€‚åœ¨ shell ä¸­è¾“å…¥ [.filename]#slappasswd# ï¼Œé€‰æ‹©ä¸€ä¸ªå¯†ç å¹¶ä½¿ç”¨å…¶å“ˆå¸Œå€¼å¡«å†™åˆ° `olcRootPW` ä¸­ã€‚å¦‚æœåœ¨å¯¼å…¥ [.filename]#slapd.ldif# ä¹‹å‰æ²¡æœ‰æŒ‡å®šæ­¤é€‰é¡¹ï¼Œå°†æ¥å°†æ— æ³•ä¿®æ”¹ _å…¨å±€é…ç½®_ éƒ¨åˆ†ã€‚Ù/The last section is about the database backend:Ù0æœ€åä¸€èŠ‚æ˜¯å…³äºæ•°æ®åº“åç«¯çš„å†…å®¹ï¼šÚ5This database hosts the _actual contents_ of the LDAP directory.  Types other than `mdb` are available.  Its super-user, not to be confused with the global one, is configured here: a (possibly custom) username in `olcRootDN` and the password hash in `olcRootPW`; [.filename]#slappasswd# can be used as before.ÚCè¯¥æ•°æ®åº“æ‰˜ç®¡äº† LDAP ç›®å½•çš„å®é™…å†…å®¹ã€‚é™¤äº† `mdb` ä¹‹å¤–ï¼Œè¿˜æœ‰å…¶ä»–ç±»å‹å¯ç”¨ã€‚å®ƒçš„è¶…çº§ç”¨æˆ·ï¼ˆä¸å…¨å±€ç”¨æˆ·ä¸åŒï¼‰åœ¨è¿™é‡Œè¿›è¡Œé…ç½®ï¼š `olcRootDN` ä¸­æ˜¯ä¸€ä¸ªï¼ˆå¯èƒ½æ˜¯è‡ªå®šä¹‰çš„ï¼‰ç”¨æˆ·åï¼Œ`olcRootPW` ä¸­æ˜¯å¯†ç å“ˆå¸Œå€¼ï¼›å¯ä»¥åƒä»¥å‰ä¸€æ ·ä½¿ç”¨ [.filename]#slappasswd#ã€‚Ú©This http://www.openldap.org/devel/gitweb.cgi?p=openldap.git;a=tree;f=tests/data/regressions/its8444;h=8a5e808e63b0de3d2bdaf2cf34fecca8577ca7fd;hb=HEAD[repository] contains four examples of [.filename]#slapd.ldif#.  To convert an existing [.filename]#slapd.conf# into [.filename]#slapd.ldif#, refer to http://www.openldap.org/doc/admin24/slapdconf2.html[this page] (please note that this may introduce some unuseful options).Ú¨è¿™ä¸ª http://www.openldap.org/devel/gitweb.cgi?p=openldap.git;a=tree;f=tests/data/regressions/its8444;h=8a5e808e63b0de3d2bdaf2cf34fecca8577ca7fd;hb=HEAD[ä»“åº“] åŒ…å«äº†å››ä¸ª [.filename]#slapd.ldif# çš„ç¤ºä¾‹ã€‚è¦å°†ç°æœ‰çš„ [.filename]#slapd.conf# è½¬æ¢ä¸º [.filename]#slapd.ldif# ï¼Œè¯·å‚è€ƒ http://www.openldap.org/doc/admin24/slapdconf2.html[æ­¤é¡µé¢] ï¼ˆè¯·æ³¨æ„ï¼Œè¿™å¯èƒ½ä¼šå¼•å…¥ä¸€äº›æ— ç”¨çš„é€‰é¡¹ï¼‰ã€‚Ù†When the configuration is completed, [.filename]#slapd.ldif# must be placed in an empty directory.  It is recommended to create it as:Ùjé…ç½®å®Œæˆåï¼Œå¿…é¡»å°† [.filename]#slapd.ldif# æ”¾ç½®åœ¨ä¸€ä¸ªç©ºç›®å½•ä¸­ã€‚å»ºè®®å°†å…¶åˆ›å»ºä¸ºï¼šÙ"Import the configuration database:¸å¯¼å…¥é…ç½®æ•°æ®åº“ï¼šÙ$Start the [.filename]#slapd# daemon:Ù)å¯åŠ¨ [.filename]#slapd# å®ˆæŠ¤è¿›ç¨‹ï¼šÙsOption `-d` can be used for debugging, as specified in slapd(8).  To verify that the server is running and working:Ùå¯ä»¥ä½¿ç”¨é€‰é¡¹ `-d` è¿›è¡Œè°ƒè¯•ï¼Œå¦‚åœ¨ slapd(8) ä¸­æ‰€æŒ‡å®šçš„é‚£æ ·ã€‚è¦éªŒè¯æœåŠ¡å™¨æ˜¯å¦æ­£åœ¨è¿è¡Œå’Œå·¥ä½œï¼šÙ‡The server must still be trusted.  If that has never been done before, follow these instructions.  Install the OpenSSL package or port:Ù’æœåŠ¡å™¨ä»ç„¶å¿…é¡»æ˜¯å¯ä¿¡çš„ã€‚å¦‚æœä¹‹å‰ä»æœªè¿›è¡Œè¿‡æ­¤æ“ä½œï¼Œè¯·æŒ‰ç…§ä»¥ä¸‹è¯´æ˜è¿›è¡Œæ“ä½œã€‚å®‰è£… OpenSSL è½¯ä»¶åŒ…æˆ– portï¼šÙtFrom the directory where [.filename]#ca.crt# is stored (in this example, [.filename]#/usr/local/etc/openldap#), run:Ùmä»å­˜å‚¨ [.filename]#ca.crt# çš„ç›®å½•ï¼ˆåœ¨æœ¬ä¾‹ä¸­ä¸º [.filename]#/usr/local/etc/openldap#ï¼‰ä¸­è¿è¡Œï¼šÙ¬Both the CA and the server certificate are now correctly recognized in their respective roles.  To verify this, run this command from the [.filename]#server.crt# directory:ÙšCA è¯ä¹¦å’ŒæœåŠ¡å™¨è¯ä¹¦ç°åœ¨åœ¨å„è‡ªçš„è§’è‰²ä¸­è¢«æ­£ç¡®è¯†åˆ«ã€‚è¦éªŒè¯è¿™ä¸€ç‚¹ï¼Œè¯·ä» [.filename]#server.crt# ç›®å½•ä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼šÙÏIf [.filename]#slapd# was running, restart it.  As stated in [.filename]#/usr/local/etc/rc.d/slapd#, to properly run [.filename]#slapd# at boot the following lines must be added to [.filename]#/etc/rc.conf#:Ùâå¦‚æœ [.filename]#slapd# æ­£åœ¨è¿è¡Œï¼Œè¯·é‡æ–°å¯åŠ¨å®ƒã€‚å¦‚ [.filename]#/usr/local/etc/rc.d/slapd# ä¸­æ‰€è¿°ï¼Œä¸ºäº†åœ¨å¯åŠ¨æ—¶æ­£ç¡®è¿è¡Œ [.filename]#slapd# ï¼Œå¿…é¡»å°†ä»¥ä¸‹è¡Œæ·»åŠ åˆ° [.filename]#/etc/rc.conf#ï¼šÙ©[.filename]#slapd# does not provide debugging at boot.  Check [.filename]#/var/log/debug.log#, [.filename]#dmesg -a# and [.filename]#/var/log/messages# for this purpose.Ù®[.filename]#slapd# åœ¨å¯åŠ¨æ—¶ä¸æä¾›è°ƒè¯•åŠŸèƒ½ã€‚è¯·æ£€æŸ¥ [.filename]#/var/log/debug.log#ã€[.filename]#dmesg -a# å’Œ [.filename]#/var/log/messages# ä»¥è¿›è¡Œè°ƒè¯•ã€‚Ù®The following example adds the group `team` and the user `john` to the `domain.example` LDAP database, which is still empty.  First, create the file [.filename]#domain.ldif#:Ù—ä»¥ä¸‹ç¤ºä¾‹å°†ç»„ `team` å’Œç”¨æˆ· `john` æ·»åŠ åˆ°ä»ä¸ºç©ºçš„ `domain.example` LDAP æ•°æ®åº“ä¸­ã€‚é¦–å…ˆï¼Œåˆ›å»ºæ–‡ä»¶ [.filename]#domain.ldif#ï¼šÚ:See the OpenLDAP documentation for more details.  Use [.filename]#slappasswd# to replace the plain text password `secret` with a hash in `userPassword`.  The path specified as `loginShell` must exist in all the systems where `john` is allowed to login.  Finally, use the `mdb` administrator to modify the database:Ú&è¯·å‚é˜… OpenLDAP æ–‡æ¡£ä»¥è·å–æ›´å¤šè¯¦ç»†ä¿¡æ¯ã€‚ä½¿ç”¨ [.filename]#slappasswd# å°†æ˜æ–‡å¯†ç  `secret` æ›¿æ¢ä¸º `userPassword` ä¸­çš„å“ˆå¸Œå€¼ã€‚åœ¨å…è®¸ `john` ç™»å½•çš„æ‰€æœ‰ç³»ç»Ÿä¸­ï¼ŒæŒ‡å®šçš„è·¯å¾„ `loginShell` å¿…é¡»å­˜åœ¨ã€‚æœ€åï¼Œä½¿ç”¨ `mdb` ç®¡ç†å‘˜æ¥ä¿®æ”¹æ•°æ®åº“ï¼šÚModifications to the _global configuration_ section can only be performed by the global super-user.  For example, assume that the option `olcTLSCipherSuite: HIGH:MEDIUM:SSLv3` was initially specified and must now be deleted.  First, create a file that contains the following:Ùíåªæœ‰å…¨å±€è¶…çº§ç”¨æˆ·æ‰èƒ½å¯¹ _global configuration_ éƒ¨åˆ†è¿›è¡Œä¿®æ”¹ã€‚ä¾‹å¦‚ï¼Œå‡è®¾æœ€åˆæŒ‡å®šäº†é€‰é¡¹ `olcTLSCipherSuite: HIGH:MEDIUM:SSLv3`ï¼Œç°åœ¨å¿…é¡»åˆ é™¤è¯¥é€‰é¡¹ã€‚é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªåŒ…å«ä»¥ä¸‹å†…å®¹çš„æ–‡ä»¶ï¼š¾Then, apply the modifications:¸ç„¶åï¼Œåº”ç”¨ä¿®æ”¹ï¼šÚ*When asked, provide the password chosen in the _configuration backend_ section.  The username is not required: here, `cn=config` represents the DN of the database section to be modified.  Alternatively, use `ldapmodify` to delete a single line of the database, `ldapdelete` to delete a whole entry.Úå½“è¢«è¯¢é—®æ—¶ï¼Œè¯·æä¾›åœ¨ _configuration backend_ éƒ¨åˆ†é€‰æ‹©çš„å¯†ç ã€‚ç”¨æˆ·åä¸æ˜¯å¿…éœ€çš„ï¼šåœ¨è¿™é‡Œï¼Œ`cn=config` è¡¨ç¤ºè¦ä¿®æ”¹çš„æ•°æ®åº“éƒ¨åˆ†çš„ DNã€‚æˆ–è€…ï¼Œä½¿ç”¨ `ldapmodify` åˆ é™¤æ•°æ®åº“çš„å•è¡Œï¼Œ`ldapdelete` åˆ é™¤æ•´ä¸ªæ¡ç›®ã€‚ÙœIf something goes wrong, or if the global super-user cannot access the configuration backend, it is possible to delete and re-write the whole configuration:Ùrå¦‚æœå‡ºç°é—®é¢˜ï¼Œæˆ–è€…å…¨å±€è¶…çº§ç”¨æˆ·æ— æ³•è®¿é—®é…ç½®åç«¯ï¼Œå¯ä»¥åˆ é™¤å¹¶é‡æ–°ç¼–å†™æ•´ä¸ªé…ç½®ï¼šÙ‡[.filename]#slapd.ldif# can then be edited and imported again.  Please, follow this procedure only when no other solution is available.Ùå¯ä»¥ç¼–è¾‘å¹¶é‡æ–°å¯¼å…¥ [.filename]#slapd.ldif# æ–‡ä»¶ã€‚è¯·åœ¨æ²¡æœ‰å…¶ä»–è§£å†³æ–¹æ¡ˆå¯ç”¨æ—¶æ‰æŒ‰ç…§æ­¤æ­¥éª¤æ“ä½œã€‚Ù‚This is the configuration of the server only.  The same machine can also host an LDAP client, with its own separate configuration.Ùlè¿™ä»…æ˜¯æœåŠ¡å™¨çš„é…ç½®ã€‚åŒä¸€å°æœºå™¨è¿˜å¯ä»¥æ‰˜ç®¡ä¸€ä¸ª LDAP å®¢æˆ·ç«¯ï¼Œå…·æœ‰ç‹¬ç«‹çš„é…ç½®ã€‚Ù*Dynamic Host Configuration Protocol (DHCP)Ù"åŠ¨æ€ä¸»æœºé…ç½®åè®®ï¼ˆDHCPï¼‰Ú^The Dynamic Host Configuration Protocol (DHCP) allows a system to connect to a network in order to be assigned the necessary addressing information for communication on that network.  FreeBSD includes the OpenBSD version of `dhclient` which is used by the client to obtain the addressing information.  FreeBSD does not install a DHCP server, but several servers are available in the FreeBSD Ports Collection.  The DHCP protocol is fully described in http://www.freesoft.org/CIE/RFC/2131/[RFC 2131].  Informational resources are also available at http://www.isc.org/downloads/dhcp/[isc.org/downloads/dhcp/].ÚåŠ¨æ€ä¸»æœºé…ç½®åè®®ï¼ˆDHCPï¼‰å…è®¸ç³»ç»Ÿè¿æ¥åˆ°ç½‘ç»œï¼Œä»¥ä¾¿ä¸ºåœ¨è¯¥ç½‘ç»œä¸Šè¿›è¡Œé€šä¿¡æ‰€éœ€çš„å¯»å€ä¿¡æ¯åˆ†é…åœ°å€ã€‚FreeBSD åŒ…å«äº† OpenBSD ç‰ˆæœ¬çš„ `dhclient`ï¼Œå®¢æˆ·ç«¯ä½¿ç”¨å®ƒæ¥è·å–å¯»å€ä¿¡æ¯ã€‚FreeBSD æ²¡æœ‰å®‰è£… DHCP æœåŠ¡å™¨ï¼Œä½†åœ¨ FreeBSD Ports Collection ä¸­æä¾›äº†å‡ ä¸ªæœåŠ¡å™¨å¯ä¾›é€‰æ‹©ã€‚ DHCP åè®®çš„å®Œæ•´æè¿°å¯åœ¨ http://www.freesoft.org/CIE/RFC/2131/[RFC 2131] ä¸­æ‰¾åˆ°ã€‚è¿˜å¯ä»¥åœ¨ http://www.isc.org/downloads/dhcp/[isc.org/downloads/dhcp/] ä¸Šæ‰¾åˆ°ç›¸å…³çš„ä¿¡æ¯èµ„æºã€‚ÙzThis section describes how to use the built-in DHCP client.  It then describes how to install and configure a DHCP server.Ùlæœ¬èŠ‚ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨å†…ç½®çš„ DHCP å®¢æˆ·ç«¯ã€‚ç„¶åä»‹ç»äº†å¦‚ä½•å®‰è£…å’Œé…ç½® DHCP æœåŠ¡å™¨ã€‚ÚIn FreeBSD, the man:bpf[4] device is needed by both the DHCP server and DHCP client.  This device is included in the [.filename]#GENERIC# kernel that is installed with FreeBSD.  Users who prefer to create a custom kernel need to keep this device if DHCP is used.Ùşåœ¨ FreeBSD ä¸­ï¼Œman:bpf[4] è®¾å¤‡åŒæ—¶è¢« DHCP æœåŠ¡å™¨å’Œ DHCP å®¢æˆ·ç«¯æ‰€éœ€ã€‚è¿™ä¸ªè®¾å¤‡å·²ç»åŒ…å«åœ¨ FreeBSD å®‰è£…çš„ [.filename]#GENERIC# å†…æ ¸ä¸­ã€‚å¦‚æœç”¨æˆ·é€‰æ‹©åˆ›å»ºè‡ªå®šä¹‰å†…æ ¸ï¼Œå¹¶ä¸”ä½¿ç”¨ DHCPï¼Œéœ€è¦ä¿ç•™è¿™ä¸ªè®¾å¤‡ã€‚ÙtIt should be noted that [.filename]#bpf# also allows privileged users to run network packet sniffers on that system.Ùkéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ[.filename]#bpf# è¿˜å…è®¸ç‰¹æƒç”¨æˆ·åœ¨è¯¥ç³»ç»Ÿä¸Šè¿è¡Œç½‘ç»œæ•°æ®åŒ…å—…æ¢å™¨ã€‚¹Configuring a DHCP Clientµé…ç½® DHCP å®¢æˆ·ç«¯ÚODHCP client support is included in the FreeBSD installer, making it easy to configure a newly installed system to automatically receive its networking addressing information from an existing DHCP server.  Refer to crossref:bsdinstall[bsdinstall-post,"Accounts, Time Zone, Services and Hardening"] for examples of network configuration.ÚFreeBSD å®‰è£…ç¨‹åºä¸­åŒ…å«äº† DHCP å®¢æˆ·ç«¯æ”¯æŒï¼Œè¿™ä½¿å¾—é…ç½®æ–°å®‰è£…çš„ç³»ç»Ÿä»ç°æœ‰çš„ DHCP æœåŠ¡å™¨è‡ªåŠ¨è·å–ç½‘ç»œåœ°å€ä¿¡æ¯å˜å¾—éå¸¸å®¹æ˜“ã€‚æœ‰å…³ç½‘ç»œé…ç½®çš„ç¤ºä¾‹ï¼Œè¯·å‚è€ƒ crossref:bsdinstall[bsdinstall-post,"å¸æˆ·ã€æ—¶åŒºã€æœåŠ¡å’ŒåŠ å›º"]ã€‚ÚWhen `dhclient` is executed on the client machine, it begins broadcasting requests for configuration information.  By default, these requests use UDP port 68.  The server replies on UDP port 67, giving the client an IP address and other relevant network information such as a subnet mask, default gateway, and DNS server addresses.  This information is in the form of a DHCP "lease" and is valid for a configurable time.  This allows stale IP addresses for clients no longer connected to the network to automatically be reused.  DHCP clients can obtain a great deal of information from the server.  An exhaustive list may be found in man:dhcp-options[5].Ú?å½“åœ¨å®¢æˆ·ç«¯æœºå™¨ä¸Šæ‰§è¡Œ `dhclient` å‘½ä»¤æ—¶ï¼Œå®ƒå¼€å§‹å¹¿æ’­è¯·æ±‚é…ç½®ä¿¡æ¯ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™äº›è¯·æ±‚ä½¿ç”¨ UDP ç«¯å£ 68 ã€‚æœåŠ¡å™¨åœ¨ UDP ç«¯å£ 67 ä¸Šå›å¤ï¼Œç»™å®¢æˆ·ç«¯åˆ†é…ä¸€ä¸ª IP åœ°å€å’Œå…¶ä»–ç›¸å…³çš„ç½‘ç»œä¿¡æ¯ï¼Œå¦‚å­ç½‘æ©ç ã€é»˜è®¤ç½‘å…³å’Œ DNS æœåŠ¡å™¨åœ°å€ã€‚è¿™äº›ä¿¡æ¯ä»¥ DHCP "ç§Ÿçº¦"çš„å½¢å¼å­˜åœ¨ï¼Œå¹¶ä¸”åœ¨å¯é…ç½®çš„æ—¶é—´å†…æœ‰æ•ˆã€‚è¿™æ ·å¯ä»¥è‡ªåŠ¨é‡ç”¨ä¸å†è¿æ¥åˆ°ç½‘ç»œçš„å®¢æˆ·ç«¯çš„è¿‡æ—¶ IP åœ°å€ã€‚DHCP å®¢æˆ·ç«¯å¯ä»¥ä»æœåŠ¡å™¨è·å–å¤§é‡ä¿¡æ¯ã€‚è¯¦ç»†åˆ—è¡¨å¯åœ¨ man:dhcp-options[5] ä¸­æ‰¾åˆ°ã€‚ÙÎBy default, when a FreeBSD system boots, its DHCP client runs in the background, or _asynchronously_.  Other startup scripts continue to run while the DHCP process completes, which speeds up system startup.ÙÃé»˜è®¤æƒ…å†µä¸‹ï¼Œå½“ FreeBSD ç³»ç»Ÿå¯åŠ¨æ—¶ï¼Œå®ƒçš„ DHCP å®¢æˆ·ç«¯åœ¨åå°æˆ–å¼‚æ­¥è¿è¡Œã€‚åœ¨ DHCP è¿‡ç¨‹å®Œæˆæ—¶ï¼Œå…¶ä»–å¯åŠ¨è„šæœ¬ç»§ç»­è¿è¡Œï¼Œä»è€ŒåŠ å¿«äº†ç³»ç»Ÿçš„å¯åŠ¨é€Ÿåº¦ã€‚Ú…Background DHCP works well when the DHCP server responds quickly to the client's requests.  However, DHCP may take a long time to complete on some systems.  If network services attempt to run before DHCP has assigned the network addressing information, they will fail.  Using DHCP in _synchronous_ mode prevents this problem as it pauses startup until the DHCP configuration has completed.Úaåå° DHCP åœ¨ DHCP æœåŠ¡å™¨å¿«é€Ÿå“åº”å®¢æˆ·ç«¯è¯·æ±‚æ—¶è¿è¡Œè‰¯å¥½ã€‚ç„¶è€Œï¼Œåœ¨æŸäº›ç³»ç»Ÿä¸Šï¼ŒDHCP å¯èƒ½éœ€è¦å¾ˆé•¿æ—¶é—´æ‰èƒ½å®Œæˆã€‚å¦‚æœç½‘ç»œæœåŠ¡åœ¨ DHCP åˆ†é…ç½‘ç»œåœ°å€ä¿¡æ¯ä¹‹å‰å°è¯•è¿è¡Œï¼Œå®ƒä»¬å°†å¤±è´¥ã€‚ä½¿ç”¨åŒæ­¥æ¨¡å¼çš„ DHCP å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå› ä¸ºå®ƒä¼šæš‚åœå¯åŠ¨è¿‡ç¨‹ï¼Œç›´åˆ° DHCP é…ç½®å®Œæˆã€‚Ù\This line in [.filename]#/etc/rc.conf# is used to configure background or asynchronous mode:ÙWè¿™è¡Œä»£ç åœ¨ [.filename]#/etc/rc.conf# æ–‡ä»¶ä¸­ç”¨äºé…ç½®åå°æˆ–å¼‚æ­¥æ¨¡å¼ï¼šÚ"This line may already exist if the system was configured to use DHCP during installation.  Replace the _fxp0_ shown in these examples with the name of the interface to be dynamically configured, as described in crossref:config[config-network-setup,â€œSetting Up Network Interface Cardsâ€].Ùòå¦‚æœç³»ç»Ÿåœ¨å®‰è£…è¿‡ç¨‹ä¸­é…ç½®ä¸ºä½¿ç”¨ DHCPï¼Œåˆ™æ­¤è¡Œå¯èƒ½å·²ç»å­˜åœ¨ã€‚åœ¨è¿™äº›ç¤ºä¾‹ä¸­ï¼Œå°† _fxp0_ æ›¿æ¢ä¸ºè¦åŠ¨æ€é…ç½®çš„æ¥å£çš„åç§°ï¼Œå¦‚ crossref:config[config-network-setup,â€œè®¾ç½®ç½‘ç»œæ¥å£å¡â€] ä¸­æ‰€è¿°ã€‚Ù|To instead configure the system to use synchronous mode, and to pause during startup while DHCP completes, use "`SYNCDHCP`":Ùoè¦é…ç½®ç³»ç»Ÿä½¿ç”¨åŒæ­¥æ¨¡å¼ï¼Œå¹¶åœ¨å¯åŠ¨è¿‡ç¨‹ä¸­æš‚åœï¼Œç›´åˆ° DHCP å®Œæˆï¼Œè¯·ä½¿ç”¨"`SYNCDHCP`"ã€‚Ù^Additional client options are available.  Search for `dhclient` in man:rc.conf[5] for details.Ùgè¿˜æœ‰å…¶ä»–çš„å®¢æˆ·ç«¯é€‰é¡¹å¯ç”¨ã€‚åœ¨ man:rc.conf[5] ä¸­æœç´¢ `dhclient` ä»¥è·å–è¯¦ç»†ä¿¡æ¯ã€‚Ù)The DHCP client uses the following files:Ù#DHCP å®¢æˆ·ç«¯ä½¿ç”¨ä»¥ä¸‹æ–‡ä»¶ï¼šÙÅThe configuration file used by `dhclient`.  Typically, this file contains only comments as the defaults are suitable for most clients.  This configuration file is described in man:dhclient.conf[5].Ù´`dhclient` ä½¿ç”¨çš„é…ç½®æ–‡ä»¶ã€‚é€šå¸¸ï¼Œè¯¥æ–‡ä»¶åªåŒ…å«æ³¨é‡Šï¼Œå› ä¸ºé»˜è®¤è®¾ç½®é€‚ç”¨äºå¤§å¤šæ•°å®¢æˆ·ç«¯ã€‚è¯¥é…ç½®æ–‡ä»¶åœ¨ man:dhclient.conf[5] ä¸­æœ‰è¯¦ç»†æè¿°ã€‚ÙJMore information about the command itself can be found in man:dhclient[8].ÙJæœ‰å…³è¯¥å‘½ä»¤æœ¬èº«çš„æ›´å¤šä¿¡æ¯å¯ä»¥åœ¨ man:dhclient[8] ä¸­æ‰¾åˆ°ã€‚Ù¢The FreeBSD-specific DHCP client configuration script.  It is described in man:dhclient-script[8], but should not need any user modification to function properly.Ù±è¿™æ˜¯ä¸€ä¸ªç‰¹å®šäº FreeBSD çš„ DHCP å®¢æˆ·ç«¯é…ç½®è„šæœ¬ã€‚å®ƒåœ¨ man:dhclient-script[8] ä¸­æœ‰è¯¦ç»†æè¿°ï¼Œä½†æ˜¯é€šå¸¸ä¸éœ€è¦ç”¨æˆ·è¿›è¡Œä»»ä½•ä¿®æ”¹ä»¥æ­£å¸¸è¿è¡Œã€‚Ù„The DHCP client keeps a database of valid leases in this file, which is written as a log and is described in man:dhclient.leases[5].Ù˜DHCP å®¢æˆ·ç«¯åœ¨æ­¤æ–‡ä»¶ä¸­ä¿ç•™äº†ä¸€ä¸ªæœ‰æ•ˆç§Ÿçº¦çš„æ•°æ®åº“ï¼Œè¯¥æ–‡ä»¶è¢«å†™å…¥ä¸ºæ—¥å¿—ï¼Œå¹¶åœ¨ man:dhclient.leases[5] ä¸­è¿›è¡Œäº†æè¿°ã€‚Ù(Installing and Configuring a DHCP Server¾å®‰è£…å’Œé…ç½® DHCP æœåŠ¡å™¨ÚThis section demonstrates how to configure a FreeBSD system to act as a DHCP server using the Internet Systems Consortium (ISC) implementation of the DHCP server.  This implementation and its documentation can be installed using the package:net/isc-dhcp44-server[] package or port.Ùàæœ¬èŠ‚æ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨ Internet Systems Consortium (ISC) å®ç°çš„ DHCP æœåŠ¡å™¨å°† FreeBSD ç³»ç»Ÿé…ç½®ä¸º DHCP æœåŠ¡å™¨ã€‚å¯ä»¥ä½¿ç”¨ package:net/isc-dhcp44-server[] è½¯ä»¶åŒ…æˆ– port å®‰è£…æ­¤å®ç°åŠå…¶æ–‡æ¡£ã€‚ÙİThe installation of package:net/isc-dhcp44-server[] installs a sample configuration file.  Copy [.filename]#/usr/local/etc/dhcpd.conf.example# to [.filename]#/usr/local/etc/dhcpd.conf# and make any edits to this new file.ÙÔpackage:net/isc-dhcp44-server[] å°†å®‰è£…ä¸€ä¸ªç¤ºä¾‹é…ç½®æ–‡ä»¶ã€‚å°† [.filename]#/usr/local/etc/dhcpd.conf.example# å¤åˆ¶åˆ° [.filename]#/usr/local/etc/dhcpd.conf#ï¼Œå¹¶å¯¹è¿™ä¸ªæ–°æ–‡ä»¶è¿›è¡Œä»»ä½•ç¼–è¾‘ã€‚Ù»The configuration file is comprised of declarations for subnets and hosts which define the information that is provided to DHCP clients.  For example, these lines configure the following:Ù“é…ç½®æ–‡ä»¶ç”±å­ç½‘å’Œä¸»æœºçš„å£°æ˜ç»„æˆï¼Œè¿™äº›å£°æ˜å®šä¹‰äº†æä¾›ç»™ DHCP å®¢æˆ·ç«¯çš„ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹è¡Œé…ç½®äº†ä»¥ä¸‹å†…å®¹ï¼šÚ‘<.> This option specifies the default search domain that will be provided to clients. Refer to man:resolv.conf[5] for more information.  <.> This option specifies a comma separated list of DNS servers that the client should use. They can be listed by their Fully Qualified Domain Names (FQDN), as seen in the example, or by their IP addresses.  <.> The subnet mask that will be provided to clients.  <.> The default lease expiry time in seconds. A client can be configured to override this value.  <.> The maximum allowed length of time, in seconds, for a lease. Should a client request a longer lease, a lease will still be issued, but it will only be valid for `max-lease-time`.  <.> The default of `none` disables dynamic DNS updates. Changing this to `interim` configures the DHCP server to update a DNS server whenever it hands out a lease so that the DNS server knows which IP addresses are associated with which computers in the network. Do not change the default setting unless the DNS server has been configured to support dynamic DNS.  <.> This line creates a pool of available IP addresses which are reserved for allocation to DHCP clients. The range of addresses must be valid for the network or subnet specified in the previous line.  <.> Declares the default gateway that is valid for the network or subnet specified before the opening `{` bracket.  <.> Specifies the hardware MAC address of a client so that the DHCP server can recognize the client when it makes a request.  <.> Specifies that this host should always be given the same IP address. Using the hostname is correct, since the DHCP server will resolve the hostname before returning the lease information.Ú†<.> æ­¤é€‰é¡¹æŒ‡å®šå°†æä¾›ç»™å®¢æˆ·ç«¯çš„é»˜è®¤æœç´¢åŸŸã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜… man:resolv.conf[5]ã€‚ <.> æ­¤é€‰é¡¹æŒ‡å®šå®¢æˆ·ç«¯åº”ä½¿ç”¨çš„é€—å·åˆ†éš”çš„ DNS æœåŠ¡å™¨åˆ—è¡¨ã€‚å®ƒä»¬å¯ä»¥æŒ‰ç…§å®Œå…¨é™å®šåŸŸåï¼ˆFQDNï¼‰åˆ—å‡ºï¼Œå¦‚ç¤ºä¾‹ä¸­æ‰€ç¤ºï¼Œä¹Ÿå¯ä»¥æŒ‰ç…§å®ƒä»¬çš„ IP åœ°å€åˆ—å‡ºã€‚ <.> æä¾›ç»™å®¢æˆ·ç«¯çš„å­ç½‘æ©ç ã€‚ <.> é»˜è®¤ç§Ÿçº¦åˆ°æœŸæ—¶é—´ï¼ˆä»¥ç§’ä¸ºå•ä½ï¼‰ã€‚å®¢æˆ·ç«¯å¯ä»¥é…ç½®ä¸ºè¦†ç›–æ­¤å€¼ã€‚ <.> ç§Ÿçº¦çš„æœ€å¤§å…è®¸æ—¶é—´é•¿åº¦ï¼ˆä»¥ç§’ä¸ºå•ä½ï¼‰ã€‚å¦‚æœå®¢æˆ·ç«¯è¯·æ±‚æ›´é•¿çš„ç§Ÿçº¦ï¼Œç§Ÿçº¦ä»å°†å‘æ”¾ï¼Œä½†ä»…åœ¨ `max-lease-time` å†…æœ‰æ•ˆã€‚ <.> `none` çš„é»˜è®¤å€¼ç¦ç”¨åŠ¨æ€ DNS æ›´æ–°ã€‚å°†å…¶æ›´æ”¹ä¸º `interim` ä¼šé…ç½® DHCP æœåŠ¡å™¨åœ¨å‘æ”¾ç§Ÿçº¦æ—¶æ›´æ–° DNS æœåŠ¡å™¨ï¼Œä»¥ä¾¿ DNS æœåŠ¡å™¨çŸ¥é“å“ªäº› IP åœ°å€ä¸ç½‘ç»œä¸­çš„å“ªäº›è®¡ç®—æœºç›¸å…³è”ã€‚é™¤éå·²é…ç½® DNS æœåŠ¡å™¨æ”¯æŒåŠ¨æ€ DNSï¼Œå¦åˆ™ä¸è¦æ›´æ”¹é»˜è®¤è®¾ç½®ã€‚ <.> æ­¤è¡Œåˆ›å»ºä¸€ä¸ªå¯ç”¨ IP åœ°å€æ± ï¼Œç”¨äºåˆ†é…ç»™ DHCP å®¢æˆ·ç«¯ã€‚åœ°å€èŒƒå›´å¿…é¡»å¯¹å…ˆå‰è¡Œä¸­æŒ‡å®šçš„ç½‘ç»œæˆ–å­ç½‘æœ‰æ•ˆã€‚ <.> å£°æ˜å¯¹äºåœ¨å¼€æ”¾çš„ `{` æ‹¬å·ä¹‹å‰æŒ‡å®šçš„ç½‘ç»œæˆ–å­ç½‘æœ‰æ•ˆçš„é»˜è®¤ç½‘å…³ã€‚ <.> æŒ‡å®šå®¢æˆ·ç«¯çš„ç¡¬ä»¶ MAC åœ°å€ï¼Œä»¥ä¾¿ DHCP æœåŠ¡å™¨åœ¨å…¶å‘å‡ºè¯·æ±‚æ—¶èƒ½å¤Ÿè¯†åˆ«å®¢æˆ·ç«¯ã€‚ <.> æŒ‡å®šæ­¤ä¸»æœºå§‹ç»ˆåº”è·å¾—ç›¸åŒçš„ IP åœ°å€ã€‚ä½¿ç”¨ä¸»æœºåæ˜¯æ­£ç¡®çš„ï¼Œå› ä¸º DHCP æœåŠ¡å™¨å°†åœ¨è¿”å›ç§Ÿçº¦ä¿¡æ¯ä¹‹å‰è§£æä¸»æœºåã€‚ÙThis configuration file supports many more options.  Refer to dhcpd.conf(5), installed with the server, for details and examples.Ùwæ­¤é…ç½®æ–‡ä»¶æ”¯æŒæ›´å¤šé€‰é¡¹ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯å’Œç¤ºä¾‹ï¼Œè¯·å‚é˜…ä¸æœåŠ¡å™¨ä¸€èµ·å®‰è£…çš„ dhcpd.conf(5)ã€‚ÙsOnce the configuration of [.filename]#dhcpd.conf# is complete, enable the DHCP server in [.filename]#/etc/rc.conf#:Ùgå®Œæˆ [.filename]#dhcpd.conf# çš„é…ç½®åï¼Œåœ¨ [.filename]#/etc/rc.conf# ä¸­å¯ç”¨ DHCP æœåŠ¡å™¨ï¼šÙReplace the `dc0` with the interface (or interfaces, separated by whitespace) that the DHCP server should listen on for DHCP client requests.Ùpå°† `dc0` æ›¿æ¢ä¸º DHCP æœåŠ¡å™¨åº”è¯¥ç›‘å¬ DHCP å®¢æˆ·ç«¯è¯·æ±‚çš„æ¥å£ï¼ˆæˆ–æ¥å£ï¼Œç”¨ç©ºæ ¼åˆ†éš”ï¼‰ã€‚Ù2Start the server by issuing the following command:Ù*é€šè¿‡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å¯åŠ¨æœåŠ¡å™¨ï¼šÙ‰Any future changes to the configuration of the server will require the dhcpd service to be stopped and then started using man:service[8].Ùkå¯¹æœåŠ¡å™¨é…ç½®çš„ä»»ä½•æœªæ¥æ›´æ”¹éƒ½éœ€è¦åœæ­¢ dhcpd æœåŠ¡ï¼Œç„¶åä½¿ç”¨ man:service[8] å¯åŠ¨ã€‚ÙmThe DHCP server uses the following files.  Note that the manual pages are installed with the server software.Ù_DHCP æœåŠ¡å™¨ä½¿ç”¨ä»¥ä¸‹æ–‡ä»¶ã€‚è¯·æ³¨æ„ï¼Œæ‰‹å†Œé¡µé¢å·²ä¸æœåŠ¡å™¨è½¯ä»¶ä¸€èµ·å®‰è£…ã€‚ÙAMore information about the dhcpd server can be found in dhcpd(8).ÙDæœ‰å…³ dhcpd æœåŠ¡å™¨çš„æ›´å¤šä¿¡æ¯å¯ä»¥åœ¨ dhcpd(8) ä¸­æ‰¾åˆ°ã€‚ÙÜThe server configuration file needs to contain all the information that should be provided to clients, along with information regarding the operation of the server.  This configuration file is described in dhcpd.conf(5).Ù¥æœåŠ¡å™¨é…ç½®æ–‡ä»¶éœ€è¦åŒ…å«æ‰€æœ‰åº”æä¾›ç»™å®¢æˆ·ç«¯çš„ä¿¡æ¯ï¼Œä»¥åŠæœ‰å…³æœåŠ¡å™¨æ“ä½œçš„ä¿¡æ¯ã€‚æ­¤é…ç½®æ–‡ä»¶åœ¨ dhcpd.conf(5) ä¸­æœ‰è¯¦ç»†æè¿°ã€‚Ù§The DHCP server keeps a database of leases it has issued in this file, which is written as a log.  Refer to dhcpd.leases(5), which gives a slightly longer description.ÙœDHCP æœåŠ¡å™¨å°†å…¶å‘æ”¾çš„ç§Ÿçº¦è®°å½•åœ¨æ­¤æ–‡ä»¶ä¸­ï¼Œè¯¥æ–‡ä»¶è¢«å†™å…¥ä¸ºæ—¥å¿—ã€‚è¯·å‚è€ƒ dhcpd.leases(5)ï¼Œå…¶ä¸­æä¾›äº†ç¨é•¿ä¸€äº›çš„æè¿°ã€‚Ú4This daemon is used in advanced environments where one DHCP server forwards a request from a client to another DHCP server on a separate network.  If this functionality is required, install the package:net/isc-dhcp44-relay[] package or port.  The installation includes dhcrelay(8) which provides more detail.Ú!è¿™ä¸ªå®ˆæŠ¤è¿›ç¨‹ç”¨äºé«˜çº§ç¯å¢ƒä¸­ï¼Œå…¶ä¸­ä¸€ä¸ª DHCP æœåŠ¡å™¨å°†å®¢æˆ·ç«¯çš„è¯·æ±‚è½¬å‘åˆ°å¦ä¸€ä¸ªä½äºä¸åŒç½‘ç»œä¸Šçš„ DHCP æœåŠ¡å™¨ã€‚å¦‚æœéœ€è¦è¿™ä¸ªåŠŸèƒ½ï¼Œè¯·å®‰è£… package:net/isc-dhcp44-relay[] åŒ…æˆ– portã€‚å®‰è£…åŒ…æ‹¬äº†æä¾›æ›´å¤šè¯¦ç»†ä¿¡æ¯çš„ dhcrelay(8)ã€‚¸Domain Name System (DNS)µåŸŸåç³»ç»Ÿï¼ˆDNSï¼‰ÚDomain Name System (DNS) is the protocol through which domain names are mapped to IP addresses, and vice versa.  DNS is coordinated across the Internet through a somewhat complex system of authoritative root, Top Level Domain (TLD), and other smaller-scale name servers, which host and cache individual domain information.  It is not necessary to run a name server to perform DNS lookups on a system.ÚuåŸŸåç³»ç»Ÿï¼ˆDNSï¼‰æ˜¯ä¸€ç§å°†åŸŸåæ˜ å°„åˆ° IP åœ°å€ï¼Œåä¹‹äº¦ç„¶çš„åè®®ã€‚DNS é€šè¿‡ä¸€ä¸ªç›¸å¯¹å¤æ‚çš„ç³»ç»Ÿæ¥åè°ƒäº’è”ç½‘ä¸Šçš„åŸŸåï¼ŒåŒ…æ‹¬æƒå¨æ ¹åŸŸåæœåŠ¡å™¨ã€é¡¶çº§åŸŸåï¼ˆTLDï¼‰å’Œå…¶ä»–è§„æ¨¡è¾ƒå°çš„åç§°æœåŠ¡å™¨ï¼Œè¿™äº›æœåŠ¡å™¨æ‰˜ç®¡å’Œç¼“å­˜å„ä¸ªåŸŸåçš„ä¿¡æ¯ã€‚åœ¨ç³»ç»Ÿä¸Šæ‰§è¡Œ DNS æŸ¥æ‰¾æ—¶ï¼Œä¸éœ€è¦è¿è¡Œåç§°æœåŠ¡å™¨ã€‚ÙDThe following table describes some of the terms associated with DNS:Ù/ä¸‹è¡¨æè¿°äº†ä¸ DNS ç›¸å…³çš„ä¸€äº›æœ¯è¯­ï¼š¯DNS TerminologyªDNS æœ¯è¯­ªDefinition¦å®šä¹‰«Forward DNS·æ­£å‘ï¼ˆForwardï¼‰ DNSÙ%Mapping of hostnames to IP addresses.Ù"ä¸»æœºååˆ° IP åœ°å€çš„æ˜ å°„ã€‚¦Origin²èµ·æºï¼ˆOriginï¼‰Ù7Refers to the domain covered in a particular zone file.Ù0æŒ‡çš„æ˜¯ç‰¹å®šåŒºåŸŸæ–‡ä»¶ä¸­æ¶µç›–çš„åŸŸåã€‚¨Resolver·è§£æå™¨ï¼ˆResolverï¼‰ÙTA system process through which a machine queries a name server for zone information.ÙHç³»ç»Ÿè¿›ç¨‹é€šè¿‡å‘åç§°æœåŠ¡å™¨æŸ¥è¯¢åŒºåŸŸä¿¡æ¯çš„æ–¹å¼è¿›è¡Œã€‚«Reverse DNS·åå‘ï¼ˆReverseï¼‰ DNSÙ%Mapping of IP addresses to hostnames.Ù!IP åœ°å€åˆ°ä¸»æœºåçš„æ˜ å°„ã€‚©Root zoneµæ ¹åŒºï¼ˆRoot zoneï¼‰ÙšThe beginning of the Internet zone hierarchy. All zones fall under the root zone, similar to how all files in a file system fall under the root directory.Ù„äº’è”ç½‘åŒºåŸŸå±‚æ¬¡ç»“æ„çš„èµ·å§‹ç‚¹ã€‚æ‰€æœ‰åŒºåŸŸéƒ½å±äºæ ¹åŒºåŸŸï¼Œç±»ä¼¼äºæ–‡ä»¶ç³»ç»Ÿä¸­æ‰€æœ‰æ–‡ä»¶éƒ½å±äºæ ¹ç›®å½•ã€‚¤Zone°åŒºåŸŸï¼ˆZoneï¼‰ÙZAn individual domain, subdomain, or portion of the DNS administered by the same authority.ÙGç”±åŒä¸€ç®¡ç†æœºæ„ç®¡ç†çš„ä¸ªäººåŸŸã€å­åŸŸæˆ– DNS çš„ä¸€éƒ¨åˆ†ã€‚²Examples of zones:²åŒºåŸŸçš„ç¤ºä¾‹ï¼šÙA`.` is how the root zone is usually referred to in documentation.Ù.`.` é€šå¸¸åœ¨æ–‡æ¡£ä¸­ç”¨æ¥æŒ‡ä»£æ ¹åŒºåŸŸã€‚Ù7`org.` is a Top Level Domain (TLD) under the root zone.Ù.`org.` æ˜¯æ ¹åŸŸä¸‹çš„é¡¶çº§åŸŸåï¼ˆTLDï¼‰ã€‚Ù-`example.org.` is a zone under the `org.`TLD.Ù;`example.org.` æ˜¯ `org.` é¡¶çº§åŸŸåä¸‹çš„ä¸€ä¸ªåŒºåŸŸã€‚Ùs`1.168.192.in-addr.arpa` is a zone referencing all IP addresses which fall under the `192.168.1.*`IP address space.Ùm`1.168.192.in-addr.arpa` æ˜¯ä¸€ä¸ªåŒºåŸŸï¼Œå¼•ç”¨äº†æ‰€æœ‰å±äº `192.168.1.*`IP åœ°å€ç©ºé—´çš„ IP åœ°å€ã€‚Ú8As one can see, the more specific part of a hostname appears to its left.  For example, `example.org.` is more specific than `org.`, as `org.` is more specific than the root zone.  The layout of each part of a hostname is much like a file system: the [.filename]#/dev# directory falls within the root, and so on.Úæ­£å¦‚æˆ‘ä»¬æ‰€çœ‹åˆ°çš„ï¼Œä¸»æœºåçš„æ›´å…·ä½“éƒ¨åˆ†å‡ºç°åœ¨å…¶å·¦ä¾§ã€‚ä¾‹å¦‚ï¼Œ`example.org.` æ¯” `org.` æ›´å…·ä½“ï¼Œè€Œ `org.` æ¯”æ ¹åŸŸæ›´å…·ä½“ã€‚ä¸»æœºåçš„æ¯ä¸ªéƒ¨åˆ†çš„å¸ƒå±€å¾ˆåƒæ–‡ä»¶ç³»ç»Ÿï¼š [.filename]#/dev# ç›®å½•ä½äºæ ¹ç›®å½•ä¸‹ï¼Œä¾æ­¤ç±»æ¨ã€‚¼Reasons to Run a Name Server¾è¿è¡Œåç§°æœåŠ¡å™¨çš„åŸå› ÙyName servers generally come in two forms: authoritative name servers, and caching (also known as resolving) name servers.Ùlåç§°æœåŠ¡å™¨é€šå¸¸æœ‰ä¸¤ç§å½¢å¼ï¼šæƒå¨åç§°æœåŠ¡å™¨å’Œç¼“å­˜ï¼ˆä¹Ÿç§°ä¸ºè§£æï¼‰åç§°æœåŠ¡å™¨ã€‚Ù,An authoritative name server is needed when:Ù*å½“éœ€è¦ä¸€ä¸ªæƒå¨åç§°æœåŠ¡å™¨æ—¶ï¼šÙUOne wants to serve DNS information to the world, replying authoritatively to queries.ÙSä¸€ä¸ªæƒ³è¦å‘ä¸–ç•Œæä¾› DNS ä¿¡æ¯ï¼Œå¹¶å¯¹æŸ¥è¯¢è¿›è¡Œæƒå¨å›å¤çš„æœåŠ¡ã€‚ÙjA domain, such as `example.org`, is registered and IP addresses need to be assigned to hostnames under it.Ùcä¸€ä¸ªåŸŸåï¼Œæ¯”å¦‚ `example.org`ï¼Œå·²ç»æ³¨å†Œï¼Œéœ€è¦ä¸ºå…¶ä¸‹çš„ä¸»æœºååˆ†é… IP åœ°å€ã€‚ÙBAn IP address block requires reverse DNS entries (IP to hostname).ÙCä¸€ä¸ª IP åœ°å€å—éœ€è¦åå‘ DNS æ¡ç›®ï¼ˆ IP åˆ°ä¸»æœºåï¼‰ã€‚ÙFA backup or second name server, called a slave, will reply to queries.ÙHå¤‡ä»½æˆ–ç¬¬äºŒåç§°æœåŠ¡å™¨ï¼Œç§°ä¸ºä»æœåŠ¡å™¨ï¼Œå°†å›å¤æŸ¥è¯¢ã€‚Ù%A caching name server is needed when:Ù$å½“éœ€è¦ç¼“å­˜åç§°æœåŠ¡å™¨æ—¶ï¼šÙ[A local DNS server may cache and respond more quickly than querying an outside name server.ÙSæœ¬åœ° DNS æœåŠ¡å™¨å¯èƒ½æ¯”æŸ¥è¯¢å¤–éƒ¨åç§°æœåŠ¡å™¨æ›´å¿«åœ°ç¼“å­˜å’Œå“åº”ã€‚Ú]When one queries for `www.FreeBSD.org`, the resolver usually queries the uplink ISP's name server, and retrieves the reply.  With a local, caching DNS server, the query only has to be made once to the outside world by the caching DNS server.  Additional queries will not have to go outside the local network, since the information is cached locally.Ú$å½“æŸ¥è¯¢ `www.FreeBSD.org` æ—¶ï¼Œè§£æå™¨é€šå¸¸ä¼šæŸ¥è¯¢ä¸Šè¡Œ ISP çš„åç§°æœåŠ¡å™¨ï¼Œå¹¶æ£€ç´¢å›å¤ã€‚ä½¿ç”¨æœ¬åœ°ç¼“å­˜çš„ DNS æœåŠ¡å™¨ï¼ŒæŸ¥è¯¢åªéœ€ç”±ç¼“å­˜çš„ DNS æœåŠ¡å™¨å‘å¤–éƒ¨ä¸–ç•Œå‘èµ·ä¸€æ¬¡ã€‚ç”±äºä¿¡æ¯è¢«æœ¬åœ°ç¼“å­˜ï¼Œé¢å¤–çš„æŸ¥è¯¢å°†ä¸éœ€è¦ç¦»å¼€æœ¬åœ°ç½‘ç»œã€‚¸DNS Server Configuration³DNS æœåŠ¡å™¨é…ç½®ÚOUnbound is provided in the FreeBSD base system.  By default, it will provide DNS resolution to the local machine only.  While the base system package can be configured to provide resolution services beyond the local machine, it is recommended that such requirements be addressed by installing Unbound from the FreeBSD Ports Collection.ÚUnbound åœ¨ FreeBSD åŸºæœ¬ç³»ç»Ÿä¸­æä¾›ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒåªä¸ºæœ¬åœ°æœºå™¨æä¾› DNS è§£æã€‚è™½ç„¶åŸºæœ¬ç³»ç»ŸåŒ…å¯ä»¥é…ç½®ä¸ºæä¾›è¶…å‡ºæœ¬åœ°æœºå™¨çš„è§£ææœåŠ¡ï¼Œä½†å»ºè®®é€šè¿‡ä» FreeBSD Ports Collection å®‰è£… Unbound æ¥æ»¡è¶³æ­¤ç±»éœ€æ±‚ã€‚ÙBTo enable Unbound, add the following to [.filename]#/etc/rc.conf#:ÙWè¦å¯ç”¨ Unbound ï¼Œè¯·å°†ä»¥ä¸‹å†…å®¹æ·»åŠ åˆ° [.filename]#/etc/rc.conf# æ–‡ä»¶ä¸­ï¼šÙ|Any existing nameservers in [.filename]#/etc/resolv.conf# will be configured as forwarders in the new Unbound configuration.Ù…åœ¨æ–°çš„ Unbound é…ç½®ä¸­ï¼Œä»»ä½•å·²å­˜åœ¨çš„åå­—æœåŠ¡å™¨åœ¨ [.filename]#/etc/resolv.conf# æ–‡ä»¶ä¸­å°†è¢«é…ç½®ä¸ºè½¬å‘å™¨ã€‚ÚIf any of the listed nameservers do not support DNSSEC, local DNS resolution will fail.  Be sure to test each nameserver and remove any that fail the test.  The following command will show the trust tree or a failure for a nameserver running on `192.168.1.1`:Úå¦‚æœåˆ—å‡ºçš„ä»»ä½•ä¸€ä¸ªåç§°æœåŠ¡å™¨ä¸æ”¯æŒ DNSSECï¼Œæœ¬åœ° DNS è§£æå°†å¤±è´¥ã€‚è¯·ç¡®ä¿æµ‹è¯•æ¯ä¸ªåç§°æœåŠ¡å™¨å¹¶åˆ é™¤æµ‹è¯•å¤±è´¥çš„åç§°æœåŠ¡å™¨ã€‚ä»¥ä¸‹å‘½ä»¤å°†æ˜¾ç¤ºè¿è¡Œåœ¨ `192.168.1.1` ä¸Šçš„åç§°æœåŠ¡å™¨çš„ä¿¡ä»»æ ‘æˆ–å¤±è´¥æƒ…å†µï¼šÙCOnce each nameserver is confirmed to support DNSSEC, start Unbound:ÙFä¸€æ—¦ç¡®è®¤æ¯ä¸ªåŸŸåæœåŠ¡å™¨éƒ½æ”¯æŒ DNSSECï¼Œå¯åŠ¨ Unbound ï¼šÙÆThis will take care of updating [.filename]#/etc/resolv.conf# so that queries for DNSSEC secured domains will now work.  For example, run the following to validate the FreeBSD.org DNSSEC trust tree:Ù®è¿™å°†è´Ÿè´£æ›´æ–° [.filename]#/etc/resolv.conf# ä»¥ä¾¿æŸ¥è¯¢ DNSSEC å®‰å…¨åŸŸåèƒ½å¤Ÿæ­£å¸¸å·¥ä½œã€‚ä¾‹å¦‚ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥éªŒè¯ FreeBSD.org çš„ DNSSEC ä¿¡ä»»æ ‘ï¼šÙ'Authoritative Name Server Configuration»æƒå¨åç§°æœåŠ¡å™¨é…ç½®ÙËFreeBSD does not provide authoritative name server software in the base system.  Users are encouraged to install third party applications, like package:dns/nsd[] or package:dns/bind918[] package or port.Ù©FreeBSD åœ¨åŸºæœ¬ç³»ç»Ÿä¸­ä¸æä¾›æƒå¨åç§°æœåŠ¡å™¨è½¯ä»¶ã€‚é¼“åŠ±ç”¨æˆ·å®‰è£…ç¬¬ä¸‰æ–¹åº”ç”¨ç¨‹åºï¼Œå¦‚ package:dns/nsd[] æˆ– package:dns/bind918[] åŒ…æˆ– portã€‚²Apache HTTP ServerÚaApache HTTP Server æ˜¯ä¸€ä¸ªå¼€æºçš„ Web æœåŠ¡å™¨è½¯ä»¶ï¼Œå®ƒæ˜¯ç›®å‰æœ€æµè¡Œçš„ Web æœåŠ¡å™¨ä¹‹ä¸€ã€‚å®ƒç”± Apache è½¯ä»¶åŸºé‡‘ä¼šå¼€å‘å’Œç»´æŠ¤ï¼Œå¯è¿è¡Œåœ¨å¤šç§æ“ä½œç³»ç»Ÿä¸Šï¼ŒåŒ…æ‹¬ Windowsã€Linux å’Œ Unix ç­‰ã€‚ Apache HTTP Server å…·æœ‰é«˜åº¦å¯æ‰©å±•æ€§å’Œçµæ´»æ€§ï¼Œæ”¯æŒå¤šç§æ¨¡å—å’Œæ’ä»¶ï¼Œå¯ä»¥å®ç°å„ç§åŠŸèƒ½ï¼Œå¦‚åŠ¨æ€å†…å®¹ç”Ÿæˆã€è™šæ‹Ÿä¸»æœºé…ç½®å’Œå®‰å…¨æ€§æ§åˆ¶ç­‰ã€‚å®ƒè¿˜æä¾›äº†ä¸°å¯Œçš„æ–‡æ¡£å’Œç¤¾åŒºæ”¯æŒï¼Œä½¿å¾—ç”¨æˆ·èƒ½å¤Ÿè½»æ¾åœ°å­¦ä¹ å’Œä½¿ç”¨ã€‚æ— è®ºæ˜¯ä¸ªäººç½‘ç«™è¿˜æ˜¯å¤§å‹ä¼ä¸šåº”ç”¨ï¼ŒApache HTTP Server éƒ½æ˜¯ä¸€ä¸ªå¯é å’Œå¼ºå¤§çš„é€‰æ‹©ã€‚ÙÅThe open source Apache HTTP Server is the most widely used web server.  FreeBSD does not install this web server by default, but it can be installed from the package:www/apache24[] package or port.Ù±å¼€æºçš„ Apache HTTP æœåŠ¡å™¨æ˜¯æœ€å¹¿æ³›ä½¿ç”¨çš„ Web æœåŠ¡å™¨ã€‚FreeBSD é»˜è®¤ä¸å®‰è£…è¿™ä¸ª Web æœåŠ¡å™¨ï¼Œä½†å¯ä»¥é€šè¿‡åŒ… :www/apache24[] åŒ…æˆ– port è¿›è¡Œå®‰è£…ã€‚ÙíThis section summarizes how to configure and start version 2._x_ of the Apache HTTP Server on FreeBSD.  For more detailed information about Apache 2.X and its configuration directives, refer to http://httpd.apache.org/[httpd.apache.org].ÙÈæœ¬èŠ‚æ¦‚è¿°äº†å¦‚ä½•åœ¨ FreeBSD ä¸Šé…ç½®å’Œå¯åŠ¨ Apache HTTP Server çš„ 2.x ç‰ˆæœ¬ã€‚æœ‰å…³ Apache 2.X åŠå…¶é…ç½®æŒ‡ä»¤çš„æ›´è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… http://httpd.apache.org/[httpd.apache.org]ã€‚¿Configuring and Starting Apache¶é…ç½®å’Œå¯åŠ¨ ApacheÚIn FreeBSD, the main Apache HTTP Server configuration file is installed as [.filename]#/usr/local/etc/apache2x/httpd.conf#, where _x_ represents the version number.  This ASCII text file begins comment lines with a `+#+`.  The most frequently modified directives are:Ùõåœ¨ FreeBSD ä¸­ï¼Œä¸»è¦çš„ Apache HTTP æœåŠ¡å™¨é…ç½®æ–‡ä»¶è¢«å®‰è£…åœ¨ [.filename]#/usr/local/etc/apache2x/httpd.conf#ï¼Œå…¶ä¸­ _x_ ä»£è¡¨ç‰ˆæœ¬å·ã€‚è¿™ä¸ª ASCII æ–‡æœ¬æ–‡ä»¶ä»¥ `+#+` å¼€å¤´çš„è¡Œä½œä¸ºæ³¨é‡Šã€‚æœ€ç»å¸¸ä¿®æ”¹çš„æŒ‡ä»¤æœ‰ï¼šÙıSpecifies the default directory hierarchy for the Apache installation.  Binaries are stored in the [.filename]#bin# and [.filename]#sbin# subdirectories of the server root and configuration files are stored in the [.filename]#etc/apache2x# subdirectory.ÙÕæŒ‡å®š Apache å®‰è£…çš„é»˜è®¤ç›®å½•å±‚æ¬¡ç»“æ„ã€‚äºŒè¿›åˆ¶æ–‡ä»¶å­˜å‚¨åœ¨æœåŠ¡å™¨æ ¹ç›®å½•çš„ [.filename]#bin# å’Œ [.filename]#sbin# å­ç›®å½•ä¸­ï¼Œé…ç½®æ–‡ä»¶å­˜å‚¨åœ¨ [.filename]#etc/apache2x# å­ç›®å½•ä¸­ã€‚Ù™Change this to the email address to receive problems with the server.  This address also appears on some server-generated pages, such as error documents.Ùå°†æ­¤æ›´æ”¹ä¸ºæ¥æ”¶æœåŠ¡å™¨é—®é¢˜çš„ç”µå­é‚®ä»¶åœ°å€ã€‚æ­¤åœ°å€è¿˜ä¼šå‡ºç°åœ¨ä¸€äº›ç”±æœåŠ¡å™¨ç”Ÿæˆçš„é¡µé¢ä¸Šï¼Œä¾‹å¦‚é”™è¯¯æ–‡æ¡£ã€‚ÚFAllows an administrator to set a hostname which is sent back to clients for the server.  For example, `www` can be used instead of the actual hostname.  If the system does not have a registered DNS name, enter its IP address instead.  If the server will listen on an alternate report, change `80` to the alternate port number.Ú$å…è®¸ç®¡ç†å‘˜è®¾ç½®ä¸€ä¸ªä¸»æœºåï¼Œè¯¥ä¸»æœºåå°†å‘é€ç»™æœåŠ¡å™¨çš„å®¢æˆ·ç«¯ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ `www` ä»£æ›¿å®é™…çš„ä¸»æœºåã€‚å¦‚æœç³»ç»Ÿæ²¡æœ‰æ³¨å†Œçš„ DNS åç§°ï¼Œè¯·è¾“å…¥å…¶ IP åœ°å€ã€‚å¦‚æœæœåŠ¡å™¨å°†ç›‘å¬ä¸€ä¸ªæ›¿ä»£ç«¯å£ï¼Œè¯·å°† `80` æ›´æ”¹ä¸ºæ›¿ä»£ç«¯å£å·ã€‚Ù³The directory where documents will be served from.  By default, all requests are taken from this directory, but symbolic links and aliases may be used to point to other locations.Ùæ–‡æ¡£å°†è¢«æä¾›çš„ç›®å½•ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰è¯·æ±‚éƒ½ä»æ­¤ç›®å½•è·å–ï¼Œä½†å¯ä»¥ä½¿ç”¨ç¬¦å·é“¾æ¥å’Œåˆ«åæŒ‡å‘å…¶ä»–ä½ç½®ã€‚ÚIt is always a good idea to make a backup copy of the default Apache configuration file before making changes.  When the configuration of Apache is complete, save the file and verify the configuration using `apachectl`.  Running `apachectl configtest` should return `Syntax OK`.Ùãåœ¨è¿›è¡Œæ›´æ”¹ä¹‹å‰ï¼Œå§‹ç»ˆå°†é»˜è®¤çš„ Apache é…ç½®æ–‡ä»¶å¤‡ä»½æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ã€‚å½“ Apache çš„é…ç½®å®Œæˆåï¼Œä¿å­˜æ–‡ä»¶å¹¶ä½¿ç”¨ `apachectl` éªŒè¯é…ç½®ã€‚è¿è¡Œ `apachectl configtest` åº”è¯¥è¿”å› `Syntax OK`ã€‚ÙXTo launch Apache at system startup, add the following line to [.filename]#/etc/rc.conf#:Ùdè¦åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶å¯åŠ¨ Apacheï¼Œè¯·å°†ä»¥ä¸‹è¡Œæ·»åŠ åˆ° [.filename]#/etc/rc.conf# æ–‡ä»¶ä¸­ï¼šÙIf Apache should be started with non-default options, the following line may be added to [.filename]#/etc/rc.conf# to specify the needed flags:Ù‚å¦‚æœè¦ä½¿ç”¨éé»˜è®¤é€‰é¡¹å¯åŠ¨ Apacheï¼Œåˆ™å¯ä»¥å°†ä»¥ä¸‹è¡Œæ·»åŠ åˆ° [.filename]#/etc/rc.conf# ä»¥æŒ‡å®šæ‰€éœ€çš„æ ‡å¿—ï¼šÙEIf apachectl does not report configuration errors, start `httpd` now:ÙGå¦‚æœ apachectl æ²¡æœ‰æŠ¥å‘Šé…ç½®é”™è¯¯ï¼Œè¯·ç«‹å³å¯åŠ¨ `httpd` ï¼šÚThe `httpd` service can be tested by entering `http://_localhost_` in a web browser, replacing _localhost_ with the fully-qualified domain name of the machine running `httpd`.  The default web page that is displayed is [.filename]#/usr/local/www/apache24/data/index.html#.Ùğå¯ä»¥é€šè¿‡åœ¨ Web æµè§ˆå™¨ä¸­è¾“å…¥ `http://_localhost_` æ¥æµ‹è¯• `httpd` æœåŠ¡ï¼Œå°† _localhost_ æ›¿æ¢ä¸ºè¿è¡Œ `httpd` çš„æœºå™¨çš„å®Œå…¨é™å®šåŸŸåã€‚æ˜¾ç¤ºçš„é»˜è®¤ç½‘é¡µæ˜¯ [.filename]#/usr/local/www/apache24/data/index.html#ã€‚Ù•The Apache configuration can be tested for errors after making subsequent configuration changes while `httpd` is running using the following command:ÙYåœ¨ `httpd` è¿è¡Œæ—¶ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æµ‹è¯• Apache é…ç½®æ˜¯å¦å­˜åœ¨é”™è¯¯ï¼šÙƒIt is important to note that `configtest` is not an man:rc[8] standard, and should not be expected to work for all startup scripts.Ù…éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ`configtest` ä¸æ˜¯ä¸€ä¸ªæ ‡å‡†çš„ `man:rc[8]`ï¼Œå¹¶ä¸”ä¸åº”è¯¥æœŸæœ›å®ƒèƒ½å¤Ÿé€‚ç”¨äºæ‰€æœ‰çš„å¯åŠ¨è„šæœ¬ã€‚¯Virtual Hosting¬è™šæ‹Ÿä¸»æœºÚUVirtual hosting allows multiple websites to run on one Apache server.  The virtual hosts can be _IP-based_ or _name-based_.  IP-based virtual hosting uses a different IP address for each website.  Name-based virtual hosting uses the clients HTTP/1.1 headers to figure out the hostname, which allows the websites to share the same IP address.ÚHè™šæ‹Ÿä¸»æœºå…è®¸å¤šä¸ªç½‘ç«™åœ¨ä¸€ä¸ª Apache æœåŠ¡å™¨ä¸Šè¿è¡Œã€‚è™šæ‹Ÿä¸»æœºå¯ä»¥æ˜¯åŸºäº IP çš„æˆ–åŸºäºåç§°çš„ã€‚åŸºäº IP çš„è™šæ‹Ÿä¸»æœºä¸ºæ¯ä¸ªç½‘ç«™ä½¿ç”¨ä¸åŒçš„ IP åœ°å€ã€‚åŸºäºåç§°çš„è™šæ‹Ÿä¸»æœºä½¿ç”¨å®¢æˆ·ç«¯çš„ HTTP/1.1 å¤´éƒ¨æ¥ç¡®å®šä¸»æœºåï¼Œè¿™æ ·å¯ä»¥è®©å¤šä¸ªç½‘ç«™å…±äº«åŒä¸€ä¸ª IP åœ°å€ã€‚ÙÿTo setup Apache to use name-based virtual hosting, add a `VirtualHost` block for each website.  For example, for the webserver named `www.domain.tld` with a virtual domain of `www.someotherdomain.tld`, add the following entries to [.filename]#httpd.conf#:Úè¦è®¾ç½® Apache ä½¿ç”¨åŸºäºåç§°çš„è™šæ‹Ÿä¸»æœºï¼Œä¸ºæ¯ä¸ªç½‘ç«™æ·»åŠ ä¸€ä¸ª `VirtualHost` å—ã€‚ä¾‹å¦‚ï¼Œå¯¹äºåä¸º `www.domain.tld` çš„ Web æœåŠ¡å™¨ï¼Œå…¶è™šæ‹ŸåŸŸä¸º `www.someotherdomain.tld`ï¼Œè¯·å°†ä»¥ä¸‹æ¡ç›®æ·»åŠ åˆ° [.filename]#httpd.conf# æ–‡ä»¶ä¸­ï¼šÙiFor each virtual host, replace the values for `ServerName` and `DocumentRoot` with the values to be used.Ùcå¯¹äºæ¯ä¸ªè™šæ‹Ÿä¸»æœºï¼Œè¯·å°† `ServerName` å’Œ `DocumentRoot` çš„å€¼æ›¿æ¢ä¸ºè¦ä½¿ç”¨çš„å€¼ã€‚Ù®For more information about setting up virtual hosts, consult the official Apache documentation at: http://httpd.apache.org/docs/vhosts/[http://httpd.apache.org/docs/vhosts/].Ù—æœ‰å…³è®¾ç½®è™šæ‹Ÿä¸»æœºçš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…å®˜æ–¹ Apache æ–‡æ¡£ï¼šhttp://httpd.apache.org/docs/vhosts/[http://httpd.apache.org/docs/vhosts/]ã€‚®Apache Modules­Apache æ¨¡å—Ú Apache uses modules to augment the functionality provided by the basic server.  Refer to http://httpd.apache.org/docs/current/mod/[http://httpd.apache.org/docs/current/mod/] for a complete listing of and the configuration details for the available modules.ÙÑApache ä½¿ç”¨æ¨¡å—æ¥å¢å¼ºåŸºæœ¬æœåŠ¡å™¨æä¾›çš„åŠŸèƒ½ã€‚è¯·å‚è€ƒ http://httpd.apache.org/docs/current/mod/[http://httpd.apache.org/docs/current/mod/]ï¼Œäº†è§£å¯ç”¨æ¨¡å—çš„å®Œæ•´åˆ—è¡¨å’Œé…ç½®ç»†èŠ‚ã€‚ÚIn FreeBSD, some modules can be compiled with the package:www/apache24[] port.  Type `make config` within [.filename]#/usr/ports/www/apache24# to see which modules are available and which are enabled by default.  If the module is not compiled with the port, the FreeBSD Ports Collection provides an easy way to install many modules.  This section describes three of the most commonly used modules.Úåœ¨ FreeBSD ä¸­ï¼Œä¸€äº›æ¨¡å—å¯ä»¥ä½¿ç”¨ package:www/apache24[] port è¿›è¡Œç¼–è¯‘ã€‚åœ¨ [.filename]#/usr/ports/www/apache24# ç›®å½•ä¸‹è¾“å…¥ `make config` å‘½ä»¤å¯ä»¥æŸ¥çœ‹å¯ç”¨çš„æ¨¡å—ä»¥åŠé»˜è®¤å¯ç”¨çš„æ¨¡å—ã€‚å¦‚æœæ¨¡å—æ²¡æœ‰ä¸ç«¯å£ä¸€èµ·ç¼–è¯‘ï¼ŒFreeBSD Ports Collection æä¾›äº†ä¸€ç§ç®€å•çš„æ–¹æ³•æ¥å®‰è£…è®¸å¤šæ¨¡å—ã€‚æœ¬èŠ‚ä»‹ç»äº†ä¸‰ä¸ªæœ€å¸¸ç”¨çš„æ¨¡å—ã€‚«SSL supportªSSL æ”¯æŒÚWAt one in point in time, support for SSL inside of Apache required a secondary module called [.filename]#mod_ssl#.  This is no longer the case and the default install of Apache comes with SSL built into the web server.  An example of how to enable support for SSL websites is available in the installed file, [.filename]#httpd-ssl.conf# inside of the [.filename]#/usr/local/etc/apache24/extra# directory Inside this directory is also a sample file called named [.filename]#ssl.conf-sample#.  It is recommended that both files be evaluated to properly set up secure websites in the Apache web server.Ú/åœ¨æŸä¸ªæ—¶é—´ç‚¹ä¸Šï¼ŒApache ä¸­æ”¯æŒ SSL éœ€è¦ä¸€ä¸ªåä¸º [.filename]#mod_ssl# çš„è¾…åŠ©æ¨¡å—ã€‚ä½†ç°åœ¨æƒ…å†µå·²ç»æ”¹å˜ï¼ŒApache çš„é»˜è®¤å®‰è£…ä¸­å·²ç»å†…ç½®äº† SSL åŠŸèƒ½ã€‚åœ¨å®‰è£…çš„æ–‡ä»¶ä¸­æœ‰ä¸€ä¸ªç¤ºä¾‹ï¼Œå¯ä»¥äº†è§£å¦‚ä½•å¯ç”¨ SSL ç½‘ç«™æ”¯æŒï¼Œè¯¥æ–‡ä»¶ä½äº [.filename]#/usr/local/etc/apache24/extra# ç›®å½•ä¸‹çš„ [.filename]#httpd-ssl.conf# æ–‡ä»¶ä¸­ã€‚åœ¨è¿™ä¸ªç›®å½•ä¸­è¿˜æœ‰ä¸€ä¸ªåä¸º [.filename]#ssl.conf-sample# çš„ç¤ºä¾‹æ–‡ä»¶ã€‚å»ºè®®åŒæ—¶è¯„ä¼°è¿™ä¸¤ä¸ªæ–‡ä»¶ï¼Œä»¥æ­£ç¡®è®¾ç½® Apache Web æœåŠ¡å™¨ä¸­çš„å®‰å…¨ç½‘ç«™ã€‚Ù¶After the configuration of SSL is complete, the following line must be uncommented in the main [.filename]#http.conf# to activate the changes on the next restart or reload of Apache:Ù©åœ¨ SSL é…ç½®å®Œæˆåï¼Œå¿…é¡»å–æ¶ˆæ³¨é‡Šä¸»è¦çš„ [.filename]#http.conf# æ–‡ä»¶ä¸­çš„ä»¥ä¸‹è¡Œï¼Œä»¥ä¾¿åœ¨ä¸‹æ¬¡é‡æ–°å¯åŠ¨æˆ–é‡æ–°åŠ è½½ Apache æ—¶æ¿€æ´»æ›´æ”¹ï¼šÙûSSL version two and version three have known vulnerability issues.  It is highly recommended TLS version 1.2 and 1.3 be enabled in place of the older SSL options.  This can be accomplished by setting the following options in the [.filename]#ssl.conf#:ÙÄSSL ç‰ˆæœ¬ 2 å’Œç‰ˆæœ¬ 3 å­˜åœ¨å·²çŸ¥çš„æ¼æ´é—®é¢˜ã€‚å¼ºçƒˆå»ºè®®åœ¨æ—§çš„ SSL é€‰é¡¹ä¹‹å¤–å¯ç”¨ TLS ç‰ˆæœ¬ 1.2 å’Œ 1.3ã€‚å¯ä»¥é€šè¿‡åœ¨ [.filename]#ssl.conf# ä¸­è®¾ç½®ä»¥ä¸‹é€‰é¡¹æ¥å®ç°ï¼šÙªTo complete the configuration of SSL in the web server, uncomment the following line to ensure that the configuration will be pulled into Apache during restart or reload:Ù–ä¸ºäº†å®Œæˆ Web æœåŠ¡å™¨ä¸­ SSL çš„é…ç½®ï¼Œè¯·å–æ¶ˆä»¥ä¸‹è¡Œçš„æ³¨é‡Šï¼Œä»¥ç¡®ä¿åœ¨é‡æ–°å¯åŠ¨æˆ–é‡æ–°åŠ è½½æœŸé—´å°†é…ç½®æ‹‰å…¥ Apache ä¸­ï¼šÙkThe following lines must also be uncommented in the [.filename]#httpd.conf# to fully support SSL in Apache:Ùpåœ¨ [.filename]#httpd.conf# æ–‡ä»¶ä¸­ï¼Œè¿˜å¿…é¡»å–æ¶ˆä»¥ä¸‹è¡Œçš„æ³¨é‡Šï¼Œä»¥å®Œå…¨æ”¯æŒ Apache ä¸­çš„ SSLï¼šÙÙThe next step is to work with a certificate authority to have the appropriate certificates installed on the system.  This will set up a chain of trust for the site and prevent any warnings of self-signed certificates.Ùœä¸‹ä¸€æ­¥æ˜¯ä¸è¯ä¹¦é¢å‘æœºæ„åˆä½œï¼Œåœ¨ç³»ç»Ÿä¸Šå®‰è£…é€‚å½“çš„è¯ä¹¦ã€‚è¿™å°†ä¸ºç½‘ç«™å»ºç«‹ä¸€ä¸ªä¿¡ä»»é“¾ï¼Œé˜²æ­¢å‡ºç°è‡ªç­¾åè¯ä¹¦çš„è­¦å‘Šã€‚ÙòThe [.filename]#mod_perl# module makes it possible to write Apache modules in Perl.  In addition, the persistent interpreter embedded in the server avoids the overhead of starting an external interpreter and the penalty of Perl start-up time.ÙÀ[.filename]#mod_perl# æ¨¡å—ä½¿å¾—å¯ä»¥ç”¨ Perl ç¼–å†™ Apache æ¨¡å—ã€‚æ­¤å¤–ï¼ŒåµŒå…¥åœ¨æœåŠ¡å™¨ä¸­çš„æŒä¹…è§£é‡Šå™¨é¿å…äº†å¯åŠ¨å¤–éƒ¨è§£é‡Šå™¨çš„å¼€é”€å’Œ Perl å¯åŠ¨æ—¶é—´çš„æƒ©ç½šã€‚ÙêThe [.filename]#mod_perl# can be installed using the package:www/mod_perl2[] package or port.  Documentation for using this module can be found at http://perl.apache.org/docs/2.0/index.html[http://perl.apache.org/docs/2.0/index.html].ÙØå¯ä»¥ä½¿ç”¨ package:www/mod_perl2[] åŒ…æˆ– port å®‰è£… [.filename]#mod_perl#ã€‚æœ‰å…³ä½¿ç”¨æ­¤æ¨¡å—çš„æ–‡æ¡£å¯ä»¥åœ¨ http://perl.apache.org/docs/2.0/index.html[http://perl.apache.org/docs/2.0/index.html] æ‰¾åˆ°ã€‚Ú+_PHP: Hypertext Preprocessor_ (PHP) is a general-purpose scripting language that is especially suited for web development.  Capable of being embedded into HTML, its syntax draws upon C, Java(TM), and Perl with the intention of allowing web developers to write dynamically generated webpages quickly.Ùó_PHP: Hypertext Preprocessor_ï¼ˆPHPï¼‰æ˜¯ä¸€ç§é€šç”¨çš„è„šæœ¬è¯­è¨€ï¼Œç‰¹åˆ«é€‚ç”¨äºç½‘é¡µå¼€å‘ã€‚å®ƒå¯ä»¥åµŒå…¥åˆ° HTML ä¸­ï¼Œå…¶è¯­æ³•å€Ÿé‰´äº† Cã€Java(TM) å’Œ Perlï¼Œæ—¨åœ¨è®©ç½‘é¡µå¼€å‘äººå‘˜èƒ½å¤Ÿå¿«é€Ÿç¼–å†™åŠ¨æ€ç”Ÿæˆçš„ç½‘é¡µã€‚ÙzSupport for PHP for Apache and any other feature written in the language, can be added by installing the appropriate port.Ùdé€šè¿‡å®‰è£…é€‚å½“çš„ç«¯å£ï¼Œå¯ä»¥ä¸º Apache å’Œä»»ä½•å…¶ä»–ç”¨ PHP ç¼–å†™çš„åŠŸèƒ½æ·»åŠ æ”¯æŒã€‚ÙDFor all supported versions, search the package database using `pkg`:ÙIå¯¹äºæ‰€æœ‰æ”¯æŒçš„ç‰ˆæœ¬ï¼Œè¯·ä½¿ç”¨ `pkg` æœç´¢è½¯ä»¶åŒ…æ•°æ®åº“ï¼šÚA list will be displayed including the versions and additional features they provide.  The components are completely modular, meaning features are enabled by installing the appropriate port.  To install PHP version 7.4 for Apache, issue the following command:Ùæå°†æ˜¾ç¤ºä¸€ä¸ªåˆ—è¡¨ï¼Œå…¶ä¸­åŒ…æ‹¬ç‰ˆæœ¬å’Œå®ƒä»¬æä¾›çš„é™„åŠ åŠŸèƒ½ã€‚è¿™äº›ç»„ä»¶æ˜¯å®Œå…¨æ¨¡å—åŒ–çš„ï¼Œè¿™æ„å‘³ç€é€šè¿‡å®‰è£…é€‚å½“çš„ç«¯å£æ¥å¯ç”¨åŠŸèƒ½ã€‚è¦ä¸º Apache å®‰è£… PHP 7.4 ç‰ˆæœ¬ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼šÙPIf any dependency packages need to be installed, they will be installed as well.Ù<å¦‚æœéœ€è¦å®‰è£…ä»»ä½•ä¾èµ–åŒ…ï¼Œå®ƒä»¬ä¹Ÿå°†è¢«å®‰è£…ã€‚Ù³By default, PHP will not be enabled.  The following lines will need to be added to the Apache configuration file located in [.filename]#/usr/local/etc/apache24# to make it active:Ùªé»˜è®¤æƒ…å†µä¸‹ï¼ŒPHP å°†ä¸ä¼šè¢«å¯ç”¨ã€‚è¦ä½¿å…¶ç”Ÿæ•ˆï¼Œéœ€è¦å°†ä»¥ä¸‹è¡Œæ·»åŠ åˆ°ä½äº [.filename]#/usr/local/etc/apache24# ç›®å½•ä¸­çš„ Apache é…ç½®æ–‡ä»¶ä¸­ï¼šÙ°In addition, the `DirectoryIndex` in the configuration file will also need to be updated and Apache will either need to be restarted or reloaded for the changes to take effect.Ù†æ­¤å¤–ï¼Œé…ç½®æ–‡ä»¶ä¸­çš„ `DirectoryIndex` ä¹Ÿéœ€è¦æ›´æ–°ï¼Œå¹¶ä¸”éœ€è¦é‡æ–°å¯åŠ¨æˆ–é‡æ–°åŠ è½½ Apache æ‰èƒ½ä½¿æ›´æ”¹ç”Ÿæ•ˆã€‚Ù›Support for many of the PHP features may also be installed by using `pkg`.  For example, to install support for XML or SSL, install their respective ports:Ù„ä½¿ç”¨ `pkg` ä¹Ÿå¯ä»¥å®‰è£…è®¸å¤š PHP åŠŸèƒ½çš„æ”¯æŒã€‚ä¾‹å¦‚ï¼Œè¦å®‰è£… XML æˆ– SSL çš„æ”¯æŒï¼Œè¯·å®‰è£…å®ƒä»¬å„è‡ªçš„ portï¼šÙAs before, the Apache configuration will need to be reloaded for the changes to take effect, even in cases where it was just a module install.Ùwä¸ä¹‹å‰ä¸€æ ·ï¼Œå³ä½¿åªæ˜¯å®‰è£…äº†ä¸€ä¸ªæ¨¡å—ï¼Œä¹Ÿéœ€è¦é‡æ–°åŠ è½½ Apache é…ç½®æ–‡ä»¶æ‰èƒ½ä½¿æ›´æ”¹ç”Ÿæ•ˆã€‚ÙWTo perform a graceful restart to reload the configuration, issue the following command:ÙEè¦æ‰§è¡Œä¼˜é›…é‡å¯ä»¥é‡æ–°åŠ è½½é…ç½®ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼šÙğOnce the install is complete, there are two methods of obtaining the installed PHP support modules and the environmental information of the build.  The first is to install the full PHP binary and running the command to gain the information:Ù¾å®‰è£…å®Œæˆåï¼Œæœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥è·å–å·²å®‰è£…çš„ PHP æ”¯æŒæ¨¡å—å’Œæ„å»ºçš„ç¯å¢ƒä¿¡æ¯ã€‚ç¬¬ä¸€ç§æ–¹æ³•æ˜¯å®‰è£…å®Œæ•´çš„ PHP äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¹¶è¿è¡Œå‘½ä»¤æ¥è·å–ä¿¡æ¯ï¼šÙrIt is necessary to pass the output to a pager, such as the `more` or `less` to easier digest the amount of output.Ùoéœ€è¦å°†è¾“å‡ºä¼ é€’ç»™ä¸€ä¸ªåˆ†é¡µå™¨ï¼Œæ¯”å¦‚ `more` æˆ– `less`ï¼Œä»¥ä¾¿æ›´å®¹æ˜“åœ°å¤„ç†å¤§é‡çš„è¾“å‡ºã€‚Ú—Finally, to make any changes to the global configuration of PHP there is a well documented file installed into [.filename]#/usr/local/etc/php.ini#.  At the time of install, this file will not exist because there are two versions to choose from, one is [.filename]#php.ini-development# and the other is [.filename]#php.ini-production#.  These are starting points to assist administrators in their deployment.Úfæœ€åï¼Œè¦å¯¹ PHP çš„å…¨å±€é…ç½®è¿›è¡Œä»»ä½•æ›´æ”¹ï¼Œéœ€è¦ä½¿ç”¨ä¸€ä¸ªæ–‡æ¡£å®Œå–„çš„æ–‡ä»¶ï¼Œå®‰è£…åœ¨ [.filename]#/usr/local/etc/php.ini#ã€‚åœ¨å®‰è£…æ—¶ï¼Œè¯¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œå› ä¸ºæœ‰ä¸¤ä¸ªç‰ˆæœ¬å¯ä¾›é€‰æ‹©ï¼Œä¸€ä¸ªæ˜¯ [.filename]#php.ini-development#ï¼Œå¦ä¸€ä¸ªæ˜¯ [.filename]#php.ini-production#ã€‚è¿™äº›æ˜¯ç®¡ç†å‘˜åœ¨éƒ¨ç½²è¿‡ç¨‹ä¸­çš„èµ·ç‚¹ã€‚­HTTP2 Support¬HTTP2 æ”¯æŒÚhApache support for the HTTP2 protocol is included by default when installing the port with `pkg`.  The new version of HTTP includes many improvements over the previous version, including utilizing a single connection to a website, reducing overall roundtrips of TCP connections.  Also, packet header data is compressed and HTTP2 requires encryption by default.Úåœ¨ä½¿ç”¨ `pkg` å®‰è£… port æ—¶ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒApache æ”¯æŒ HTTP2 åè®®ã€‚æ–°ç‰ˆæœ¬çš„ HTTP ç›¸æ¯”ä¹‹å‰çš„ç‰ˆæœ¬æœ‰å¾ˆå¤šæ”¹è¿›ï¼ŒåŒ…æ‹¬åˆ©ç”¨å•ä¸ªè¿æ¥è®¿é—®ç½‘ç«™ï¼Œå‡å°‘ TCP è¿æ¥çš„æ€»å¾€è¿”æ¬¡æ•°ã€‚æ­¤å¤–ï¼Œæ•°æ®åŒ…å¤´éƒ¨æ•°æ®è¢«å‹ç¼©ï¼ŒHTTP2 é»˜è®¤è¦æ±‚åŠ å¯†ã€‚ÙõWhen Apache is configured to only use HTTP2, web browsers will require secure, encrypted HTTPS connections.  When Apache is configured to use both versions, HTTP1.1 will be considered a fall back option if any issues arise during the connection.Ùçå½“ Apache é…ç½®ä¸ºä»…ä½¿ç”¨ HTTP2 æ—¶ï¼ŒWeb æµè§ˆå™¨å°†éœ€è¦å®‰å…¨çš„ã€åŠ å¯†çš„ HTTPS è¿æ¥ã€‚å½“ Apache é…ç½®ä¸ºåŒæ—¶ä½¿ç”¨ä¸¤ä¸ªç‰ˆæœ¬æ—¶ï¼Œå¦‚æœåœ¨è¿æ¥è¿‡ç¨‹ä¸­å‡ºç°ä»»ä½•é—®é¢˜ï¼ŒHTTP1.1 å°†è¢«è§†ä¸ºå¤‡é€‰é€‰é¡¹ã€‚ÙÔWhile this change does require administrators to make changes, they are positive and equate to a more secure Internet for everyone.  The changes are only required for sites not currently implementing SSL and TLS.Ùèè™½ç„¶è¿™ä¸ªå˜åŒ–ç¡®å®éœ€è¦ç®¡ç†å‘˜è¿›è¡Œä¸€äº›æ”¹åŠ¨ï¼Œä½†è¿™äº›æ”¹åŠ¨æ˜¯ç§¯æçš„ï¼Œå¹¶ä¸”å¯¹äºæ¯ä¸ªäººæ¥è¯´éƒ½æ„å‘³ç€ä¸€ä¸ªæ›´å®‰å…¨çš„äº’è”ç½‘ã€‚è¿™äº›æ”¹åŠ¨åªéœ€è¦å¯¹ç›®å‰æ²¡æœ‰å®æ–½ SSL å’Œ TLS çš„ç½‘ç«™è¿›è¡Œã€‚Ù¨This configuration depends on the previous sections, including TLS support.  It is recommended those instructions be followed before continuing with this configuration.Ù}æ­¤é…ç½®ä¾èµ–äºå‰é¢çš„éƒ¨åˆ†ï¼ŒåŒ…æ‹¬ TLS æ”¯æŒã€‚å»ºè®®åœ¨ç»§ç»­è¿›è¡Œæ­¤é…ç½®ä¹‹å‰æŒ‰ç…§é‚£äº›è¯´æ˜è¿›è¡Œæ“ä½œã€‚ÙÒStart the process by enabling the http2 module by uncommenting the line in [.filename]#/usr/local/etc/apache24/httpd.conf# and replace the mpm_prefork module with mpm_event as the former does not support HTTP2.Ù¼é€šè¿‡å–æ¶ˆæ³¨é‡Š [.filename]#/usr/local/etc/apache24/httpd.conf# ä¸­çš„ä¸€è¡Œæ¥å¯ç”¨ http2 æ¨¡å—ï¼Œå¹¶å°† mpm_prefork æ¨¡å—æ›¿æ¢ä¸º mpm_event æ¨¡å—ï¼Œå› ä¸ºå‰è€…ä¸æ”¯æŒ HTTP2ã€‚ÚtThere is a separate [.filename]#mod_http2# port that is available.  It exists to deliver security and bug fixes quicker than the module installed with the bundled [.filename]#apache24# port.  It is not required for HTTP2 support but is available.  When installed, the [.filename]#mod_h2.so# should be used in place of [.filename]#mod_http2.so# in the Apache configuration.ÚUæœ‰ä¸€ä¸ªå•ç‹¬çš„ [.filename]#mod_http2# port å¯ç”¨ã€‚å®ƒçš„å­˜åœ¨æ˜¯ä¸ºäº†æ›´å¿«åœ°æä¾›å®‰å…¨æ€§å’Œé”™è¯¯ä¿®å¤ï¼Œè€Œä¸æ˜¯ä½¿ç”¨æ†ç»‘çš„ [.filename]#apache24# port å®‰è£…çš„æ¨¡å—ã€‚å®ƒä¸æ˜¯å¿…éœ€çš„ HTTP2 æ”¯æŒï¼Œä½†å¯ä¾›é€‰æ‹©ã€‚å®‰è£…åï¼Œåº”åœ¨ Apache é…ç½®ä¸­ä½¿ç”¨ [.filename]#mod_h2.so# æ›¿ä»£ [.filename]#mod_http2.so#ã€‚ÙÓThere are two methods to implement HTTP2 in Apache; one way is globally for all sites and each VirtualHost running on the system.  To enable HTTP2 globally, add the following line under the ServerName directive:ÙÃåœ¨ Apache ä¸­å®ç° HTTP2 æœ‰ä¸¤ç§æ–¹æ³•ï¼›ä¸€ç§æ˜¯å…¨å±€åº”ç”¨äºæ‰€æœ‰ç«™ç‚¹å’Œç³»ç»Ÿä¸Šè¿è¡Œçš„æ¯ä¸ª VirtualHostã€‚è¦åœ¨å…¨å±€å¯ç”¨ HTTP2ï¼Œè¯·åœ¨ ServerName æŒ‡ä»¤ä¸‹æ·»åŠ ä»¥ä¸‹è¡Œï¼šÙQTo enable HTTP2 over plaintext, use h2h2chttp/1.1 in the [.filename]#httpd.conf#.ÙWè¦åœ¨æ˜æ–‡ä¸Šå¯ç”¨ HTTP2ï¼Œè¯·åœ¨ [.filename]#httpd.conf# ä¸­ä½¿ç”¨ h2h2chttp/1.1ã€‚ÙåHaving the h2c here will allow plaintext HTTP2 data to pass on the system but is not recommended.  In addition, using the http/1.1 here will allow fallback to the HTTP1.1 version of the protocol should it be needed by the system.ÙÁåœ¨è¿™é‡Œä½¿ç”¨ h2c å°†å…è®¸æ˜æ–‡çš„ HTTP2 æ•°æ®åœ¨ç³»ç»Ÿä¸­ä¼ é€’ï¼Œä½†ä¸æ¨èè¿™æ ·åšã€‚æ­¤å¤–ï¼Œåœ¨è¿™é‡Œä½¿ç”¨ http/1.1 å°†å…è®¸ç³»ç»Ÿåœ¨éœ€è¦æ—¶å›é€€åˆ° HTTP1.1 ç‰ˆæœ¬çš„åè®®ã€‚Ù¡To enable HTTP2 for individual VirtualHosts, add the same line within the VirtualHost directive in either [.filename]#httpd.conf# or [.filename]#httpd-ssl.conf#.Ù—è¦ä¸ºå•ä¸ªè™šæ‹Ÿä¸»æœºå¯ç”¨ HTTP2ï¼Œè¯·åœ¨ [.filename]#httpd.conf# æˆ– [.filename]#httpd-ssl.conf# ä¸­çš„ VirtualHost æŒ‡ä»¤ä¸­æ·»åŠ ç›¸åŒçš„è¡Œã€‚Ù¼Reload the configuration using the `apachectl`[parameter]#reload# command and test the configuration either by using either of the following methods after visiting one of the hosted pages:Ù†ä½¿ç”¨ `apachectl`[parameter]#reload# å‘½ä»¤é‡æ–°åŠ è½½é…ç½®ï¼Œå¹¶åœ¨è®¿é—®æ‰˜ç®¡é¡µé¢ä¹‹åä½¿ç”¨ä»¥ä¸‹ä»»ä¸€æ–¹æ³•æµ‹è¯•é…ç½®ï¼šÙ6This should return something similar to the following:Ù'è¿™åº”è¯¥è¿”å›ç±»ä¼¼ä»¥ä¸‹çš„å†…å®¹ï¼šÙ“The other method is using the web browser's built in site debugger or `tcpdump`; however, using either method is beyond the scope of this document.Ù‘å¦ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨ç½‘é¡µæµè§ˆå™¨å†…ç½®çš„ç«™ç‚¹è°ƒè¯•å™¨æˆ– `tcpdump`ï¼›ç„¶è€Œï¼Œä½¿ç”¨ä»»ä½•ä¸€ç§æ–¹æ³•éƒ½è¶…å‡ºäº†æœ¬æ–‡æ¡£çš„èŒƒå›´ã€‚ÙÊSupport for HTTP2 reverse proxy connections by using the [.filename]#mod_proxy_http2.so# module.  When configuring the ProxyPass or RewriteRules [P] statements, they should use h2:// for the connection.Ù©é€šè¿‡ä½¿ç”¨ [.filename]#mod_proxy_http2.so# æ¨¡å—æ”¯æŒ HTTP2 åå‘ä»£ç†è¿æ¥ã€‚åœ¨é…ç½® ProxyPass æˆ– RewriteRules [P] è¯­å¥æ—¶ï¼Œåº”ä½¿ç”¨ h2:// ä½œä¸ºè¿æ¥ã€‚°Dynamic Websites¬åŠ¨æ€ç½‘ç«™ÙIn addition to mod_perl and mod_php, other languages are available for creating dynamic web content.  These include Django and Ruby on Rails.Ùƒé™¤äº† mod_perl å’Œ mod_php ä¹‹å¤–ï¼Œè¿˜æœ‰å…¶ä»–è¯­è¨€å¯ç”¨äºåˆ›å»ºåŠ¨æ€ç½‘é¡µå†…å®¹ã€‚è¿™äº›åŒ…æ‹¬ Django å’Œ Ruby on Railsã€‚ÚÉDjango is a BSD-licensed framework designed to allow developers to write high performance, elegant web applications quickly.  It provides an object-relational mapper so that data types are developed as Python objects.  A rich dynamic database-access API is provided for those objects without the developer ever having to write SQL.  It also provides an extensible template system so that the logic of the application is separated from the HTML presentation.ÚÆDjango æ˜¯ä¸€ä¸ª BSD è®¸å¯çš„æ¡†æ¶ï¼Œæ—¨åœ¨è®©å¼€å‘äººå‘˜å¿«é€Ÿç¼–å†™é«˜æ€§èƒ½ã€ä¼˜é›…çš„ Web åº”ç”¨ç¨‹åºã€‚å®ƒæä¾›äº†ä¸€ä¸ªå¯¹è±¡å…³ç³»æ˜ å°„å™¨ï¼Œä½¿å¾—æ•°æ®ç±»å‹å¯ä»¥ä½œä¸º Python å¯¹è±¡è¿›è¡Œå¼€å‘ã€‚å®ƒè¿˜æä¾›äº†ä¸€ä¸ªä¸°å¯Œçš„åŠ¨æ€æ•°æ®åº“è®¿é—® APIï¼Œå¼€å‘äººå‘˜æ— éœ€ç¼–å†™ SQL è¯­å¥å³å¯å¯¹è¿™äº›å¯¹è±¡è¿›è¡Œæ“ä½œã€‚æ­¤å¤–ï¼Œå®ƒè¿˜æä¾›äº†ä¸€ä¸ªå¯æ‰©å±•çš„æ¨¡æ¿ç³»ç»Ÿï¼Œä½¿å¾—åº”ç”¨ç¨‹åºçš„é€»è¾‘ä¸ HTML çš„å‘ˆç°åˆ†ç¦»ã€‚ÚsDjango depends on [.filename]#mod_python#, and an SQL database engine.  In FreeBSD, the package:www/py-django[] port automatically installs [.filename]#mod_python# and supports the PostgreSQL, MySQL, or SQLite databases, with the default being SQLite.  To change the database engine, type `make config` within [.filename]#/usr/ports/www/py-django#, then install the port.Ú<Django ä¾èµ–äº mod_python å’Œä¸€ä¸ª SQL æ•°æ®åº“å¼•æ“ã€‚åœ¨ FreeBSD ä¸­ï¼ŒåŒ… www/py-django çš„ç«¯å£ä¼šè‡ªåŠ¨å®‰è£… mod_pythonï¼Œå¹¶æ”¯æŒ PostgreSQLã€MySQL æˆ– SQLite æ•°æ®åº“ï¼Œé»˜è®¤ä¸º SQLiteã€‚è¦æ›´æ”¹æ•°æ®åº“å¼•æ“ï¼Œè¯·åœ¨ /usr/ports/www/py-django ç›®å½•ä¸‹è¾“å…¥ `make config`ï¼Œç„¶åå®‰è£… portã€‚ÙíOnce Django is installed, the application will need a project directory along with the Apache configuration in order to use the embedded Python interpreter.  This interpreter is used to call the application for specific URLs on the site.Ù¾ä¸€æ—¦å®‰è£…äº† Djangoï¼Œåº”ç”¨ç¨‹åºå°†éœ€è¦ä¸€ä¸ªé¡¹ç›®ç›®å½•ä»¥åŠ Apache é…ç½®ï¼Œä»¥ä¾¿ä½¿ç”¨åµŒå…¥å¼ Python è§£é‡Šå™¨ã€‚è¯¥è§£é‡Šå™¨ç”¨äºè°ƒç”¨ç«™ç‚¹ä¸Šç‰¹å®š URL çš„åº”ç”¨ç¨‹åºã€‚Ù®To configure Apache to pass requests for certain URLs to the web application, add the following to [.filename]#httpd.conf#, specifying the full path to the project directory:Ù¢è¦é…ç½® Apache å°†æŸäº› URL çš„è¯·æ±‚ä¼ é€’ç»™ Web åº”ç”¨ç¨‹åºï¼Œè¯·å°†ä»¥ä¸‹å†…å®¹æ·»åŠ åˆ° [.filename]#httpd.conf#ï¼Œå¹¶æŒ‡å®šé¡¹ç›®ç›®å½•çš„å®Œæ•´è·¯å¾„ï¼šÙrRefer to https://docs.djangoproject.com[https://docs.djangoproject.com] for more information on how to use Django.Ù{è¯·å‚è€ƒ https://docs.djangoproject.com[https://docs.djangoproject.com] è·å–æœ‰å…³å¦‚ä½•ä½¿ç”¨ Django çš„æ›´å¤šä¿¡æ¯ã€‚Ú Ruby on Rails is another open source web framework that provides a full development stack.  It is optimized to make web developers more productive and capable of writing powerful applications quickly.  On FreeBSD, it can be installed using the package:www/rubygem-rails[] package or port.ÚRuby on Rails æ˜¯å¦ä¸€ä¸ªå¼€æºçš„ Web æ¡†æ¶ï¼Œæä¾›äº†å®Œæ•´çš„å¼€å‘å †æ ˆã€‚å®ƒç»è¿‡ä¼˜åŒ–ï¼Œå¯ä»¥ä½¿ Web å¼€å‘äººå‘˜æ›´åŠ é«˜æ•ˆå’Œèƒ½å¤Ÿå¿«é€Ÿç¼–å†™å¼ºå¤§çš„åº”ç”¨ç¨‹åºã€‚åœ¨ FreeBSD ä¸Šï¼Œå¯ä»¥ä½¿ç”¨ package:www/rubygem-rails[] åŒ…æˆ– port è¿›è¡Œå®‰è£…ã€‚ÙwRefer to http://guides.rubyonrails.org[http://guides.rubyonrails.org] for more information on how to use Ruby on Rails.Ù|è¯·å‚è€ƒ http://guides.rubyonrails.org[http://guides.rubyonrails.org]ï¼Œäº†è§£å¦‚ä½•ä½¿ç”¨ Ruby on Rails çš„æ›´å¤šä¿¡æ¯ã€‚¼File Transfer Protocol (FTP)»æ–‡ä»¶ä¼ è¾“åè®®ï¼ˆFTPï¼‰Ù¯The File Transfer Protocol (FTP) provides users with a simple way to transfer files to and from an FTP server.  FreeBSD includes FTP server software, ftpd, in the base system.Ùªæ–‡ä»¶ä¼ è¾“åè®®ï¼ˆFTPï¼‰ä¸ºç”¨æˆ·æä¾›äº†ä¸€ç§ç®€å•çš„æ–¹å¼æ¥åœ¨ FTP æœåŠ¡å™¨ä¹‹é—´ä¼ è¾“æ–‡ä»¶ã€‚FreeBSD åœ¨åŸºæœ¬ç³»ç»Ÿä¸­åŒ…å«äº† FTP æœåŠ¡å™¨è½¯ä»¶ ftpdã€‚ÙÂFreeBSD provides several configuration files for controlling access to the FTP server.  This section summarizes these files.  Refer to man:ftpd[8] for more details about the built-in FTP server.Ù±FreeBSD æä¾›äº†å‡ ä¸ªé…ç½®æ–‡ä»¶æ¥æ§åˆ¶å¯¹ FTP æœåŠ¡å™¨çš„è®¿é—®ã€‚æœ¬èŠ‚æ¦‚è¿°äº†è¿™äº›æ–‡ä»¶ã€‚æœ‰å…³å†…ç½® FTP æœåŠ¡å™¨çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… man:ftpd[8]ã€‚­Configuration¦é…ç½®ÚThe most important configuration step is deciding which accounts will be allowed access to the FTP server.  A FreeBSD system has a number of system accounts which should not be allowed FTP access.  The list of users disallowed any FTP access can be found in [.filename]#/etc/ftpusers#. By default, it includes system accounts.  Additional users that should not be allowed access to FTP can be added.ÚIæœ€é‡è¦çš„é…ç½®æ­¥éª¤æ˜¯å†³å®šå“ªäº›è´¦æˆ·å°†è¢«å…è®¸è®¿é—® FTP æœåŠ¡å™¨ã€‚FreeBSD ç³»ç»Ÿæœ‰è®¸å¤šç³»ç»Ÿè´¦æˆ·ï¼Œä¸åº”è¯¥å…è®¸ FTP è®¿é—®ã€‚ä¸å…è®¸ä»»ä½• FTP è®¿é—®çš„ç”¨æˆ·åˆ—è¡¨å¯ä»¥åœ¨ [.filename]#/etc/ftpusers# ä¸­æ‰¾åˆ°ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒåŒ…æ‹¬ç³»ç»Ÿè´¦æˆ·ã€‚å¯ä»¥æ·»åŠ å…¶ä»–ä¸å…è®¸è®¿é—® FTP çš„ç”¨æˆ·ã€‚Ú#In some cases it may be desirable to restrict the access of some users without preventing them completely from using FTP.  This can be accomplished be creating [.filename]#/etc/ftpchroot# as described in man:ftpchroot[5].  This file lists users and groups subject to FTP access restrictions.Úåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¯èƒ½å¸Œæœ›é™åˆ¶æŸäº›ç”¨æˆ·çš„è®¿é—®æƒé™ï¼Œè€Œä¸å®Œå…¨é˜»æ­¢ä»–ä»¬ä½¿ç”¨ FTPã€‚å¯ä»¥é€šè¿‡åˆ›å»º [.filename]#/etc/ftpchroot# æ–‡ä»¶æ¥å®ç°ï¼Œå¦‚ man:ftpchroot[5] ä¸­æ‰€è¿°ã€‚è¯¥æ–‡ä»¶åˆ—å‡ºäº†å— FTP è®¿é—®é™åˆ¶çš„ç”¨æˆ·å’Œç»„ã€‚ÚÆTo enable anonymous FTP access to the server, create a user named `ftp` on the FreeBSD system.  Users will then be able to log on to the FTP server with a username of `ftp` or `anonymous`.  When prompted for the password, any input will be accepted, but by convention, an email address should be used as the password.  The FTP server will call man:chroot[2] when an anonymous user logs in, to restrict access to only the home directory of the `ftp` user.Ú¡è¦å¯ç”¨æœåŠ¡å™¨çš„åŒ¿å FTP è®¿é—®ï¼Œè¯·åœ¨ FreeBSD ç³»ç»Ÿä¸Šåˆ›å»ºä¸€ä¸ªåä¸º `ftp` çš„ç”¨æˆ·ã€‚ç„¶åç”¨æˆ·å°†èƒ½å¤Ÿä½¿ç”¨ç”¨æˆ·å `ftp` æˆ– `anonymous` ç™»å½•åˆ° FTP æœåŠ¡å™¨ã€‚å½“æç¤ºè¾“å…¥å¯†ç æ—¶ï¼Œä»»ä½•è¾“å…¥éƒ½å°†è¢«æ¥å—ï¼Œä½†æŒ‰ç…§æƒ¯ä¾‹ï¼Œåº”å°†ç”µå­é‚®ä»¶åœ°å€ç”¨ä½œå¯†ç ã€‚å½“åŒ¿åç”¨æˆ·ç™»å½•æ—¶ï¼ŒFTP æœåŠ¡å™¨å°†è°ƒç”¨ man:chroot[2] æ¥é™åˆ¶è®¿é—®ä»…é™äº `ftp` ç”¨æˆ·çš„ä¸»ç›®å½•ã€‚ÚÍThere are two text files that can be created to specify welcome messages to be displayed to FTP clients.  The contents of [.filename]#/etc/ftpwelcome# will be displayed to users before they reach the login prompt.  After a successful login, the contents of [.filename]#/etc/ftpmotd# will be displayed.  Note that the path to this file is relative to the login environment, so the contents of [.filename]#~ftp/etc/ftpmotd# would be displayed for anonymous users.Ú…æœ‰ä¸¤ä¸ªæ–‡æœ¬æ–‡ä»¶å¯ä»¥åˆ›å»ºï¼Œç”¨äºæŒ‡å®šè¦æ˜¾ç¤ºç»™ FTP å®¢æˆ·ç«¯çš„æ¬¢è¿æ¶ˆæ¯ã€‚[.filename]#/etc/ftpwelcome# çš„å†…å®¹å°†åœ¨ç”¨æˆ·åˆ°è¾¾ç™»å½•æç¤ºä¹‹å‰æ˜¾ç¤ºç»™ä»–ä»¬ã€‚æˆåŠŸç™»å½•åï¼Œå°†æ˜¾ç¤º [.filename]#/etc/ftpmotd# çš„å†…å®¹ã€‚è¯·æ³¨æ„ï¼Œè¯¥æ–‡ä»¶çš„è·¯å¾„æ˜¯ç›¸å¯¹äºç™»å½•ç¯å¢ƒçš„ï¼Œå› æ­¤å¯¹äºåŒ¿åç”¨æˆ·ï¼Œå°†æ˜¾ç¤º [.filename]#~ftp/etc/ftpmotd# çš„å†…å®¹ã€‚Ù„Once the FTP server has been configured, set the appropriate variable in [.filename]#/etc/rc.conf# to start the service during boot:Ù€ä¸€æ—¦é…ç½®äº† FTP æœåŠ¡å™¨ï¼Œå°†é€‚å½“çš„å˜é‡è®¾ç½®åœ¨ [.filename]#/etc/rc.conf# ä¸­ï¼Œä»¥ä¾¿åœ¨å¯åŠ¨æ—¶å¯åŠ¨è¯¥æœåŠ¡ï¼š¹To start the service now:µç«‹å³å¯åŠ¨æœåŠ¡ï¼šÙ0Test the connection to the FTP server by typing:Ù>é€šè¿‡è¾“å…¥ä»¥ä¸‹å‘½ä»¤æ¥æµ‹è¯•ä¸ FTP æœåŠ¡å™¨çš„è¿æ¥ï¼šÚ	The ftpd daemon uses man:syslog[3] to log messages.  By default, the system log daemon will write messages related to FTP in [.filename]#/var/log/xferlog#.  The location of the FTP log can be modified by changing the following line in [.filename]#/etc/syslog.conf#:Ú'ftpd å®ˆæŠ¤è¿›ç¨‹ä½¿ç”¨ man:syslog[3] æ¥è®°å½•æ—¥å¿—æ¶ˆæ¯ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œç³»ç»Ÿæ—¥å¿—å®ˆæŠ¤è¿›ç¨‹å°†ä¼šå°†ä¸ FTP ç›¸å…³çš„æ¶ˆæ¯å†™å…¥åˆ° [.filename]#/var/log/xferlog# æ–‡ä»¶ä¸­ã€‚FTP æ—¥å¿—çš„ä½ç½®å¯ä»¥é€šè¿‡ä¿®æ”¹ [.filename]#/etc/syslog.conf# æ–‡ä»¶ä¸­çš„ä»¥ä¸‹è¡Œæ¥è¿›è¡Œæ›´æ”¹ï¼šÚ½Be aware of the potential problems involved with running an anonymous FTP server.  In particular, think twice about allowing anonymous users to upload files.  It may turn out that the FTP site becomes a forum for the trade of unlicensed commercial software or worse.  If anonymous FTP uploads are required, then verify the permissions so that these files cannot be read by other anonymous users until they have been reviewed by an administrator.Ú_æ³¨æ„è¿è¡ŒåŒ¿å FTP æœåŠ¡å™¨å¯èƒ½æ¶‰åŠçš„æ½œåœ¨é—®é¢˜ã€‚ç‰¹åˆ«æ˜¯ï¼Œè¦ä¸‰æ€è€Œåè¡Œï¼Œæ˜¯å¦å…è®¸åŒ¿åç”¨æˆ·ä¸Šä¼ æ–‡ä»¶ã€‚å¯èƒ½ä¼šå‘ç° FTP ç«™ç‚¹æˆä¸ºéæˆæƒå•†ä¸šè½¯ä»¶äº¤æ˜“æˆ–æ›´ç³Ÿç³•çš„åœºæ‰€ã€‚å¦‚æœéœ€è¦åŒ¿å FTP ä¸Šä¼ ï¼Œåˆ™è¦éªŒè¯æƒé™ï¼Œä»¥ä¾¿è¿™äº›æ–‡ä»¶åœ¨è¢«ç®¡ç†å‘˜å®¡æ ¸ä¹‹å‰ä¸èƒ½è¢«å…¶ä»–åŒ¿åç”¨æˆ·è¯»å–ã€‚ÙCFile and Print Services for Microsoft(R) Windows(R) Clients (Samba)ÙNé€‚ç”¨äº Microsoft(R) Windows(R) å®¢æˆ·ç«¯çš„æ–‡ä»¶å’Œæ‰“å°æœåŠ¡ï¼ˆSambaï¼‰ÚÅSamba is a popular open source software package that provides file and print services using the SMB/CIFS protocol.  This protocol is built into Microsoft(R) Windows(R) systems.  It can be added to non-Microsoft(R) Windows(R) systems by installing the Samba client libraries.  The protocol allows clients to access shared data and printers.  These shares can be mapped as a local disk drive and shared printers can be used as if they were local printers.Ú™Samba æ˜¯ä¸€ä¸ªæµè¡Œçš„å¼€æºè½¯ä»¶åŒ…ï¼Œä½¿ç”¨ SMB/CIFS åè®®æä¾›æ–‡ä»¶å’Œæ‰“å°æœåŠ¡ã€‚è¯¥åè®®å†…ç½®äº Microsoft(R) Windows(R) ç³»ç»Ÿä¸­ã€‚é€šè¿‡å®‰è£… Samba å®¢æˆ·ç«¯åº“ï¼Œå®ƒå¯ä»¥æ·»åŠ åˆ°é Microsoft(R) Windows(R) ç³»ç»Ÿä¸­ã€‚è¯¥åè®®å…è®¸å®¢æˆ·ç«¯è®¿é—®å…±äº«çš„æ•°æ®å’Œæ‰“å°æœºã€‚è¿™äº›å…±äº«å¯ä»¥æ˜ å°„ä¸ºæœ¬åœ°ç£ç›˜é©±åŠ¨å™¨ï¼Œå…±äº«çš„æ‰“å°æœºå¯ä»¥åƒæœ¬åœ°æ‰“å°æœºä¸€æ ·ä½¿ç”¨ã€‚ÙßOn FreeBSD, the Samba client libraries can be installed using the package:net/samba413[] port or package.  The client provides the ability for a FreeBSD system to access SMB/CIFS shares in a Microsoft(R) Windows(R) network.ÙÏåœ¨ FreeBSD ä¸Šï¼Œå¯ä»¥ä½¿ç”¨ package:net/samba413[] ç«¯å£æˆ– port æ¥å®‰è£… Samba å®¢æˆ·ç«¯åº“ã€‚è¯¥å®¢æˆ·ç«¯æä¾›äº† FreeBSD ç³»ç»Ÿè®¿é—® Microsoft(R) Windows(R) ç½‘ç»œä¸­çš„ SMB/CIFS å…±äº«çš„èƒ½åŠ›ã€‚Ú.A FreeBSD system can also be configured to act as a Samba server by installing the same package:net/samba413[] port or package.  This allows the administrator to create SMB/CIFS shares on the FreeBSD system which can be accessed by clients running Microsoft(R) Windows(R) or the Samba client libraries.Úé€šè¿‡å®‰è£…ç›¸åŒçš„ package:net/samba413[] åŒ…æˆ– portï¼Œ FreeBSD ç³»ç»Ÿä¹Ÿå¯ä»¥é…ç½®ä¸º Samba æœåŠ¡å™¨ã€‚è¿™ä½¿å¾—ç®¡ç†å‘˜å¯ä»¥åœ¨ FreeBSD ç³»ç»Ÿä¸Šåˆ›å»º SMB/CIFS å…±äº«ï¼Œè¿™äº›å…±äº«å¯ä»¥è¢«è¿è¡Œ Microsoft(R) Windows(R) æˆ– Samba å®¢æˆ·ç«¯åº“çš„å®¢æˆ·ç«¯è®¿é—®ã€‚´Server Configuration¯æœåŠ¡å™¨é…ç½®ÙrSamba is configured in [.filename]#/usr/local/etc/smb4.conf#.  This file must be created before Samba can be used.ÙxSamba çš„é…ç½®æ–‡ä»¶ä½äº [.filename]#/usr/local/etc/smb4.conf#ã€‚åœ¨ä½¿ç”¨ Samba ä¹‹å‰ï¼Œå¿…é¡»å…ˆåˆ›å»ºè¯¥æ–‡ä»¶ã€‚ÚA simple [.filename]#smb4.conf# to share directories and printers with Windows(R) clients in a workgroup is shown here.  For more complex setups involving LDAP or Active Directory, it is easier to use man:samba-tool[8] to create the initial [.filename]#smb4.conf#.Úè¿™é‡Œå±•ç¤ºäº†ä¸€ä¸ªç®€å•çš„ [.filename]#smb4.conf# æ–‡ä»¶ï¼Œç”¨äºåœ¨å·¥ä½œç»„ä¸­ä¸ Windows(R) å®¢æˆ·ç«¯å…±äº«ç›®å½•å’Œæ‰“å°æœºã€‚å¯¹äºæ¶‰åŠ LDAP æˆ– Active Directory çš„æ›´å¤æ‚è®¾ç½®ï¼Œä½¿ç”¨ man:samba-tool[8] åˆ›å»ºåˆå§‹çš„ [.filename]#smb4.conf# æ›´ä¸ºç®€ä¾¿ã€‚¯Global Settings¬å…¨å±€è®¾ç½®ÙVSettings that describe the network are added in [.filename]#/usr/local/etc/smb4.conf#:ÙKåœ¨ [.filename]#/usr/local/etc/smb4.conf# ä¸­æ·»åŠ æè¿°ç½‘ç»œçš„è®¾ç½®ï¼šÙ'The name of the workgroup to be served.Ù!è¦æœåŠ¡çš„å·¥ä½œç»„çš„åç§°ã€‚Ù}The NetBIOS name by which a Samba server is known.  By default, it is the same as the first component of the host's DNS name.ÙqSamba æœåŠ¡å™¨æ‰€çŸ¥çš„ NetBIOS åç§°ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒä¸ä¸»æœºçš„ DNS åç§°çš„ç¬¬ä¸€ä¸ªç»„ä»¶ç›¸åŒã€‚Ù•The string that will be displayed in the output of `net view` and some other networking tools that seek to display descriptive text about the server.Ù‡åœ¨ `net view` å’Œå…¶ä»–ä¸€äº›ç½‘ç»œå·¥å…·çš„è¾“å‡ºä¸­æ˜¾ç¤ºçš„å­—ç¬¦ä¸²ï¼Œè¿™äº›å·¥å…·æ—¨åœ¨æ˜¾ç¤ºæœ‰å…³æœåŠ¡å™¨çš„æè¿°æ€§æ–‡æœ¬ã€‚ÙpWhether Samba will act as a WINS server.  Do not enable support for WINS on more than one server on the network.ÙiSamba æ˜¯å¦å°†ä½œä¸º WINS æœåŠ¡å™¨ã€‚è¯·å‹¿åœ¨ç½‘ç»œä¸Šçš„å¤šä¸ªæœåŠ¡å™¨ä¸Šå¯ç”¨å¯¹ WINS çš„æ”¯æŒã€‚±Security Settings¬å®‰å…¨è®¾ç½®Ù£The most important settings in [.filename]#/usr/local/etc/smb4.conf# are the security model and the backend password format.  These directives control the options:Ùƒ[.filename]#/usr/local/etc/smb4.conf# ä¸­æœ€é‡è¦çš„è®¾ç½®æ˜¯å®‰å…¨æ¨¡å‹å’Œåç«¯å¯†ç æ ¼å¼ã€‚è¿™äº›æŒ‡ä»¤æ§åˆ¶ä»¥ä¸‹é€‰é¡¹ï¼šÚ;The most common settings are `security = share` and `security = user`.  If the clients use usernames that are the same as their usernames on the FreeBSD machine, user level security should be used.  This is the default security policy and it requires clients to first log on before they can access shared resources.Ú
æœ€å¸¸è§çš„è®¾ç½®æ˜¯ `security = share` å’Œ `security = user`ã€‚å¦‚æœå®¢æˆ·ç«¯ä½¿ç”¨çš„ç”¨æˆ·åä¸å…¶åœ¨ FreeBSD æœºå™¨ä¸Šçš„ç”¨æˆ·åç›¸åŒï¼Œåˆ™åº”ä½¿ç”¨ç”¨æˆ·çº§å®‰å…¨æ€§ã€‚è¿™æ˜¯é»˜è®¤çš„å®‰å…¨ç­–ç•¥ï¼Œå®ƒè¦æ±‚å®¢æˆ·ç«¯åœ¨è®¿é—®å…±äº«èµ„æºä¹‹å‰å…ˆç™»å½•ã€‚ÙÛIn share level security, clients do not need to log onto the server with a valid username and password before attempting to connect to a shared resource.  This was the default security model for older versions of Samba.Ù²åœ¨å…±äº«çº§åˆ«å®‰å…¨ä¸­ï¼Œå®¢æˆ·ç«¯åœ¨å°è¯•è¿æ¥åˆ°å…±äº«èµ„æºä¹‹å‰ä¸éœ€è¦ä½¿ç”¨æœ‰æ•ˆçš„ç”¨æˆ·åå’Œå¯†ç ç™»å½•æœåŠ¡å™¨ã€‚è¿™æ˜¯æ—§ç‰ˆæœ¬ Samba çš„é»˜è®¤å®‰å…¨æ¨¡å‹ã€‚ÚtSamba has several different backend authentication models.  Clients may be authenticated with LDAP, NIS+, an SQL database, or a modified password file.  The recommended authentication method, `tdbsam`, is ideal for simple networks and is covered here.  For larger or more complex networks, `ldapsam` is recommended.  `smbpasswd` was the former default and is now obsolete.ÚsSamba æœ‰å‡ ç§ä¸åŒçš„åç«¯èº«ä»½éªŒè¯æ¨¡å‹ã€‚å®¢æˆ·ç«¯å¯ä»¥ä½¿ç”¨ LDAPã€NIS+ã€SQL æ•°æ®åº“æˆ–ä¿®æ”¹åçš„å¯†ç æ–‡ä»¶è¿›è¡Œèº«ä»½éªŒè¯ã€‚æ¨èçš„èº«ä»½éªŒè¯æ–¹æ³•æ˜¯ `tdbsam`ï¼Œé€‚ç”¨äºç®€å•çš„ç½‘ç»œç¯å¢ƒï¼Œæœ¬æ–‡å°†ä»‹ç»è¯¥æ–¹æ³•ã€‚å¯¹äºæ›´å¤§æˆ–æ›´å¤æ‚çš„ç½‘ç»œï¼Œæ¨èä½¿ç”¨ `ldapsam`ã€‚`smbpasswd` æ›¾ç»æ˜¯é»˜è®¤é€‰é¡¹ï¼Œä½†ç°åœ¨å·²ç»è¿‡æ—¶ã€‚«Samba Users¬Samba ç”¨æˆ·Ù¬FreeBSD user accounts must be mapped to the `SambaSAMAccount` database for Windows(R) clients to access the share.  Map existing FreeBSD user accounts using man:pdbedit[8]:ÙÊä¸ºäº†è®© Windows(R) å®¢æˆ·ç«¯èƒ½å¤Ÿè®¿é—®å…±äº«æ–‡ä»¶å¤¹ï¼ŒFreeBSD ç”¨æˆ·è´¦æˆ·å¿…é¡»æ˜ å°„åˆ° `SambaSAMAccount` æ•°æ®åº“ä¸­ã€‚ä½¿ç”¨ man:pdbedit[8] å‘½ä»¤æ¥æ˜ å°„å·²å­˜åœ¨çš„ FreeBSD ç”¨æˆ·è´¦æˆ·ã€‚ÙÀThis section has only mentioned the most commonly used settings.  Refer to the https://wiki.samba.org[Official Samba Wiki] for additional information about the available configuration options.Ùˆæœ¬èŠ‚ä»…æåŠäº†æœ€å¸¸ç”¨çš„è®¾ç½®ã€‚æœ‰å…³å¯ç”¨é…ç½®é€‰é¡¹çš„å…¶ä»–ä¿¡æ¯ï¼Œè¯·å‚é˜… https://wiki.samba.org[å®˜æ–¹ Samba Wiki] ã€‚®Starting Samba¬å¯åŠ¨ SambaÙRTo enable Samba at boot time, add the following line to [.filename]#/etc/rc.conf#:Ù^è¦åœ¨å¯åŠ¨æ—¶å¯ç”¨ Samba ï¼Œè¯·å°†ä»¥ä¸‹è¡Œæ·»åŠ åˆ° [.filename]#/etc/rc.conf# æ–‡ä»¶ä¸­ï¼š³To start Samba now:µç«‹å³å¯åŠ¨ Sambaï¼šÙ›Samba consists of three separate daemons.  Both the nmbd and smbd daemons are started by `samba_enable`.  If winbind name resolution is also required, set:Ù™Samba ç”±ä¸‰ä¸ªç‹¬ç«‹çš„å®ˆæŠ¤è¿›ç¨‹ç»„æˆã€‚nmbd å’Œ smbd å®ˆæŠ¤è¿›ç¨‹éƒ½ç”± `samba_enable` å¯åŠ¨ã€‚å¦‚æœè¿˜éœ€è¦ winbind åç§°è§£æï¼Œè¯·è®¾ç½®ï¼šÙ+Samba can be stopped at any time by typing:Ù3å¯ä»¥éšæ—¶é€šè¿‡é”®å…¥ä»¥ä¸‹å‘½ä»¤åœæ­¢ Sambaï¼šÚ	Samba is a complex software suite with functionality that allows broad integration with Microsoft(R) Windows(R) networks.  For more information about functionality beyond the basic configuration described here, refer to https://www.samba.org[https://www.samba.org].ÙæSamba æ˜¯ä¸€ä¸ªå¤æ‚çš„è½¯ä»¶å¥—ä»¶ï¼Œå…·æœ‰ä¸ Microsoft(R) Windows(R) ç½‘ç»œå¹¿æ³›é›†æˆçš„åŠŸèƒ½ã€‚æœ‰å…³è¶…å‡ºæ­¤å¤„æ‰€æè¿°çš„åŸºæœ¬é…ç½®çš„åŠŸèƒ½çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜… https://www.samba.org[https://www.samba.org] ã€‚¾Clock Synchronization with NTP½ä½¿ç”¨ NTP è¿›è¡Œæ—¶é’ŸåŒæ­¥ÚDOver time, a computer's clock is prone to drift.  This is problematic as many network services require the computers on a network to share the same accurate time.  Accurate time is also needed to ensure that file timestamps stay consistent.  The Network Time Protocol (NTP) is one way to provide clock accuracy in a network.Ú,éšç€æ—¶é—´çš„æ¨ç§»ï¼Œè®¡ç®—æœºçš„æ—¶é’Ÿå®¹æ˜“åç¦»ã€‚è¿™æ˜¯ä¸€ä¸ªé—®é¢˜ï¼Œå› ä¸ºè®¸å¤šç½‘ç»œæœåŠ¡è¦æ±‚ç½‘ç»œä¸Šçš„è®¡ç®—æœºå…±äº«ç›¸åŒå‡†ç¡®çš„æ—¶é—´ã€‚å‡†ç¡®çš„æ—¶é—´ä¹Ÿéœ€è¦ç¡®ä¿æ–‡ä»¶æ—¶é—´æˆ³ä¿æŒä¸€è‡´ã€‚ç½‘ç»œæ—¶é—´åè®®ï¼ˆNTPï¼‰æ˜¯åœ¨ç½‘ç»œä¸­æä¾›æ—¶é’Ÿå‡†ç¡®æ€§çš„ä¸€ç§æ–¹å¼ã€‚Ù·FreeBSD includes man:ntpd[8] which can be configured to query other NTP servers to synchronize the clock on that machine or to provide time services to other computers in the network.ÙFreeBSD åŒ…å« man:ntpd[8]ï¼Œå¯ä»¥é…ç½®ä¸ºæŸ¥è¯¢å…¶ä»– NTP æœåŠ¡å™¨ä»¥åŒæ­¥è¯¥æœºå™¨ä¸Šçš„æ—¶é’Ÿï¼Œæˆ–ä¸ºç½‘ç»œä¸­çš„å…¶ä»–è®¡ç®—æœºæä¾›æ—¶é—´æœåŠ¡ã€‚ÙThis section describes how to configure ntpd on FreeBSD.  Further documentation can be found in [.filename]#/usr/share/doc/ntp/# in HTML format.Ù‡æœ¬èŠ‚ä»‹ç»äº†å¦‚ä½•åœ¨ FreeBSD ä¸Šé…ç½® ntpdã€‚æ›´å¤šçš„æ–‡æ¡£å¯ä»¥åœ¨ HTML æ ¼å¼çš„ [.filename]#/usr/share/doc/ntp/# ä¸­æ‰¾åˆ°ã€‚±NTP ConfigurationªNTP é…ç½®ÙÄOn FreeBSD, the built-in ntpd can be used to synchronize a system's clock.  ntpd is configured using man:rc.conf[5] variables and [.filename]#/etc/ntp.conf#, as detailed in the following sections.ÙÁåœ¨ FreeBSD ä¸Šï¼Œå¯ä»¥ä½¿ç”¨å†…ç½®çš„ ntpd æ¥åŒæ­¥ç³»ç»Ÿçš„æ—¶é’Ÿã€‚ntpd æ˜¯ä½¿ç”¨ man:rc.conf[5] å˜é‡å’Œ [.filename]#/etc/ntp.conf# è¿›è¡Œé…ç½®çš„ï¼Œè¯¦ç»†ä¿¡æ¯è¯·å‚è§ä»¥ä¸‹ç« èŠ‚ã€‚Ù±ntpd communicates with its network peers using UDP packets.  Any firewalls between your machine and its NTP peers must be configured to allow UDP packets in and out on port 123.Ù¸ntpd é€šè¿‡ UDP æ•°æ®åŒ…ä¸å…¶ç½‘ç»œå¯¹ç­‰æ–¹è¿›è¡Œé€šä¿¡ã€‚æ‚¨çš„æœºå™¨ä¸å…¶ NTP å¯¹ç­‰æ–¹ä¹‹é—´çš„ä»»ä½•é˜²ç«å¢™éƒ½å¿…é¡»é…ç½®ä¸ºå…è®¸ç«¯å£ 123 ä¸Šçš„ UDP æ•°æ®åŒ…çš„è¿›å‡ºã€‚Ù#The [.filename]#/etc/ntp.conf# fileÙ![.filename]#/etc/ntp.conf# æ–‡ä»¶Úntpd reads [.filename]#/etc/ntp.conf# to determine which NTP servers to query.  Choosing several NTP servers is recommended in case one of the servers becomes unreachable or its clock proves unreliable.  As ntpd receives responses, it favors reliable servers over the less reliable ones.  The servers which are queried can be local to the network, provided by an ISP, or selected from an http://support.ntp.org/bin/view/Servers/WebHome[ online list of publicly accessible NTP servers].  When choosing a public NTP server, select one that is geographically close and review its usage policy.  The `pool` configuration keyword selects one or more servers from a pool of servers.  An http://support.ntp.org/bin/view/Servers/NTPPoolServers[ online list of publicly accessible NTP pools] is available, organized by geographic area.  In addition, FreeBSD provides a project-sponsored pool, `0.freebsd.pool.ntp.org`.Úpntpd è¯»å– [.filename]#/etc/ntp.conf# æ–‡ä»¶æ¥ç¡®å®šè¦æŸ¥è¯¢çš„ NTP æœåŠ¡å™¨ã€‚å»ºè®®é€‰æ‹©å¤šä¸ª NTP æœåŠ¡å™¨ï¼Œä»¥é˜²å…¶ä¸­ä¸€ä¸ªæœåŠ¡å™¨æ— æ³•è®¿é—®æˆ–å…¶æ—¶é’Ÿä¸å¯é ã€‚å½“ ntpd æ¥æ”¶åˆ°å“åº”æ—¶ï¼Œå®ƒä¼šä¼˜å…ˆé€‰æ‹©å¯é çš„æœåŠ¡å™¨è€Œä¸æ˜¯ä¸å¯é çš„æœåŠ¡å™¨ã€‚è¢«æŸ¥è¯¢çš„æœåŠ¡å™¨å¯ä»¥æ˜¯æœ¬åœ°ç½‘ç»œçš„æœåŠ¡å™¨ã€ç”± ISP æä¾›çš„æœåŠ¡å™¨ï¼Œæˆ–è€…ä»ä¸€ä¸ª http://support.ntp.org/bin/view/Servers/WebHome[åœ¨çº¿çš„å…¬å…±å¯è®¿é—®çš„ NTP æœåŠ¡å™¨åˆ—è¡¨] ä¸­é€‰æ‹©ã€‚é€‰æ‹©å…¬å…± NTP æœåŠ¡å™¨æ—¶ï¼Œé€‰æ‹©åœ°ç†ä½ç½®æ¥è¿‘çš„æœåŠ¡å™¨å¹¶æŸ¥çœ‹å…¶ä½¿ç”¨æ”¿ç­–ã€‚`pool` é…ç½®å…³é”®å­—ä»æœåŠ¡å™¨æ± ä¸­é€‰æ‹©ä¸€ä¸ªæˆ–å¤šä¸ªæœåŠ¡å™¨ã€‚æœ‰ä¸€ä¸ª http://support.ntp.org/bin/view/Servers/NTPPoolServers[åœ¨çº¿çš„å…¬å…±å¯è®¿é—®çš„ NTP æ± åˆ—è¡¨]ï¼ŒæŒ‰åœ°ç†åŒºåŸŸç»„ç»‡ã€‚æ­¤å¤–ï¼ŒFreeBSD æä¾›äº†ä¸€ä¸ªç”±é¡¹ç›®èµåŠ©çš„æ± ï¼Œå³ `0.freebsd.pool.ntp.org`ã€‚Ù!Sample [.filename]#/etc/ntp.conf#Ù!ç¤ºä¾‹ [.filename]#/etc/ntp.conf#ÙÂThis is a simple example of an [.filename]#ntp.conf# file.  It can safely be used as-is; it contains the recommended `restrict` options for operation on a publicly-accessible network connection.Ù¤è¿™æ˜¯ä¸€ä¸ª [.filename]#ntp.conf# æ–‡ä»¶çš„ç®€å•ç¤ºä¾‹ã€‚å®ƒå¯ä»¥ç›´æ¥ä½¿ç”¨ï¼›å®ƒåŒ…å«äº†åœ¨å…¬å…±å¯è®¿é—®ç½‘ç»œè¿æ¥ä¸Šæ“ä½œçš„æ¨è `restrict` é€‰é¡¹ã€‚ÙThe format of this file is described in man:ntp.conf[5].  The descriptions below provide a quick overview of just the keywords used in the sample file above.Ù‰è¯¥æ–‡ä»¶çš„æ ¼å¼åœ¨ man:ntp.conf[5] ä¸­æœ‰æè¿°ã€‚ä¸‹é¢çš„æè¿°ä»…æä¾›äº†ä¸Šé¢ç¤ºä¾‹æ–‡ä»¶ä¸­ä½¿ç”¨çš„å…³é”®å­—çš„å¿«é€Ÿæ¦‚è¿°ã€‚ÚàBy default, an NTP server is accessible to any network host.  The `restrict` keyword controls which systems can access the server.  Multiple `restrict` entries are supported, each one refining the restrictions given in previous statements.  The values shown in the example grant the local system full query and control access, while allowing remote systems only the ability to query the time.  For more details, refer to the `Access Control Support` subsection of man:ntp.conf[5].ÚÏé»˜è®¤æƒ…å†µä¸‹ï¼ŒNTP æœåŠ¡å™¨å¯¹ä»»ä½•ç½‘ç»œä¸»æœºéƒ½æ˜¯å¯è®¿é—®çš„ã€‚`restrict` å…³é”®å­—ç”¨äºæ§åˆ¶å“ªäº›ç³»ç»Ÿå¯ä»¥è®¿é—®è¯¥æœåŠ¡å™¨ã€‚æ”¯æŒå¤šä¸ª `restrict` æ¡ç›®ï¼Œæ¯ä¸ªæ¡ç›®éƒ½å¯ä»¥ç»†åŒ–ä¹‹å‰è¯­å¥ä¸­ç»™å‡ºçš„é™åˆ¶ã€‚ç¤ºä¾‹ä¸­æ˜¾ç¤ºçš„å€¼å…è®¸æœ¬åœ°ç³»ç»Ÿå®Œå…¨æŸ¥è¯¢å’Œæ§åˆ¶è®¿é—®ï¼Œè€Œåªå…è®¸è¿œç¨‹ç³»ç»ŸæŸ¥è¯¢æ—¶é—´ã€‚æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… man:ntp.conf[5] ä¸­çš„ `è®¿é—®æ§åˆ¶æ”¯æŒï¼ˆAccess Control Supportï¼‰` å­èŠ‚ã€‚ÚñThe `server` keyword specifies a single server to query.  The file can contain multiple server keywords, with one server listed on each line.  The `pool` keyword specifies a pool of servers.  ntpd will add one or more servers from this pool as needed to reach the number of peers specified using the `tos minclock` value.  The `iburst` keyword directs ntpd to perform a burst of eight quick packet exchanges with a server when contact is first established, to help quickly synchronize system time.Ú°`server` å…³é”®å­—æŒ‡å®šè¦æŸ¥è¯¢çš„å•ä¸ªæœåŠ¡å™¨ã€‚æ–‡ä»¶å¯ä»¥åŒ…å«å¤šä¸ª `server` å…³é”®å­—ï¼Œæ¯è¡Œåˆ—å‡ºä¸€ä¸ªæœåŠ¡å™¨ã€‚`pool` å…³é”®å­—æŒ‡å®šæœåŠ¡å™¨æ± ã€‚ ntpd å°†æ ¹æ®éœ€è¦ä»è¯¥æ± ä¸­æ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªæœåŠ¡å™¨ï¼Œä»¥è¾¾åˆ°ä½¿ç”¨ `tos minclock` å€¼æŒ‡å®šçš„å¯¹ç­‰ä½“æ•°é‡ã€‚`iburst` å…³é”®å­—æŒ‡ç¤º ntpd åœ¨é¦–æ¬¡å»ºç«‹è”ç³»æ—¶ä¸æœåŠ¡å™¨æ‰§è¡Œå…«æ¬¡å¿«é€Ÿæ•°æ®åŒ…äº¤æ¢ï¼Œä»¥å¸®åŠ©å¿«é€ŸåŒæ­¥ç³»ç»Ÿæ—¶é—´ã€‚Ú"The `leapfile` keyword specifies the location of a file containing information about leap seconds.  The file is updated automatically by man:periodic[8].  The file location specified by this keyword must match the location set in the `ntp_db_leapfile` variable in [.filename]#/etc/rc.conf#.Ùò`leapfile` å…³é”®å­—æŒ‡å®šäº†ä¸€ä¸ªåŒ…å«é—°ç§’ä¿¡æ¯çš„æ–‡ä»¶çš„ä½ç½®ã€‚è¯¥æ–‡ä»¶ç”± man:periodic[8] è‡ªåŠ¨æ›´æ–°ã€‚æ­¤å…³é”®å­—æŒ‡å®šçš„æ–‡ä»¶ä½ç½®å¿…é¡»ä¸ [.filename]#/etc/rc.conf# ä¸­çš„ `ntp_db_leapfile` å˜é‡è®¾ç½®çš„ä½ç½®åŒ¹é…ã€‚Ù(NTP entries in [.filename]#/etc/rc.conf#Ù5åœ¨ [.filename]#/etc/rc.conf# æ–‡ä»¶ä¸­çš„ NTP æ¡ç›®Ù¾Set `ntpd_enable=YES` to start ntpd at boot time.  Once `ntpd_enable=YES` has been added to [.filename]#/etc/rc.conf#, ntpd can be started immediately without rebooting the system by typing:ÙÓå°† `ntpd_enable=YES` è®¾ç½®ä¸ºåœ¨å¯åŠ¨æ—¶å¯åŠ¨ ntpdã€‚ä¸€æ—¦å°† `ntpd_enable=YES` æ·»åŠ åˆ° [.filename]#/etc/rc.conf# æ–‡ä»¶ä¸­ï¼Œå¯ä»¥é€šè¿‡è¾“å…¥ä»¥ä¸‹å‘½ä»¤ç«‹å³å¯åŠ¨ ntpd è€Œæ— éœ€é‡æ–°å¯åŠ¨ç³»ç»Ÿï¼šÙwOnly `ntpd_enable` must be set to use ntpd.  The [.filename]#rc.conf# variables listed below may also be set as needed.Ùåªéœ€è®¾ç½® `ntpd_enable` å°±å¯ä»¥ä½¿ç”¨ ntpdã€‚ä¸‹é¢åˆ—å‡ºçš„ [.filename]#rc.conf# å˜é‡ä¹Ÿå¯ä»¥æ ¹æ®éœ€è¦è¿›è¡Œè®¾ç½®ã€‚ÚSet `ntpd_sync_on_start=YES` to allow ntpd to step the clock any amount, one time at startup.  Normally ntpd will log an error message and exit if the clock is off by more than 1000 seconds.  This option is especially useful on systems without a battery-backed realtime clock.Úå°† `ntpd_sync_on_start=YES` è®¾ç½®ä¸ºå…è®¸ ntpd åœ¨å¯åŠ¨æ—¶ä¸€æ¬¡æ€§è°ƒæ•´æ—¶é’Ÿçš„ä»»æ„é‡ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œå¦‚æœæ—¶é’Ÿåå·®è¶…è¿‡ 1000 ç§’ï¼Œntpd ä¼šè®°å½•é”™è¯¯æ¶ˆæ¯å¹¶é€€å‡ºã€‚æ­¤é€‰é¡¹åœ¨æ²¡æœ‰ç”µæ± å¤‡ä»½çš„å®æ—¶æ—¶é’Ÿçš„ç³»ç»Ÿä¸Šç‰¹åˆ«æœ‰ç”¨ã€‚Ù‘Set `ntpd_oomprotect=YES` to protect the ntpd daemon from being killed by the system attempting to recover from an Out Of Memory (OOM) condition.Ùƒå°† `ntpd_oomprotect=YES` è®¾ç½®ä¸ºä¿æŠ¤ ntpd å®ˆæŠ¤è¿›ç¨‹å…å—ç³»ç»Ÿå°è¯•ä»å†…å­˜ä¸è¶³ï¼ˆOOMï¼‰æ¡ä»¶ä¸­æ¢å¤æ—¶è¢«ç»ˆæ­¢ã€‚ÙNSet `ntpd_config=` to the location of an alternate [.filename]#ntp.conf# file.ÙNå°† `ntpd_config=` è®¾ç½®ä¸ºå¤‡ç”¨çš„ [.filename]#ntp.conf# æ–‡ä»¶çš„ä½ç½®ã€‚Ù•Set `ntpd_flags=` to contain any other ntpd flags as needed, but avoid using these flags which are managed internally by [.filename]#/etc/rc.d/ntpd#:Ù’å°† `ntpd_flags=` è®¾ç½®ä¸ºåŒ…å«æ‰€éœ€çš„ä»»ä½•å…¶ä»– ntpd æ ‡å¿—ï¼Œä½†é¿å…ä½¿ç”¨è¿™äº›ç”± [.filename]#/etc/rc.d/ntpd# å†…éƒ¨ç®¡ç†çš„æ ‡å¿—ã€‚¸`-p` (pid file location)º`-p`ï¼ˆpid æ–‡ä»¶ä½ç½®ï¼‰Ù!`-c` (set `ntpd_config=` instead)Ù&`-c`ï¼ˆè®¾ç½® `ntpd_config=` ä»£æ›¿ï¼‰Ù%ntpd and the unpriveleged `ntpd` userÙ"ntpd å’Œéç‰¹æƒçš„ `ntpd` ç”¨æˆ·ÚÜntpd on FreeBSD can start and run as an unpriveleged user.  Doing so requires the man:mac_ntpd[4] policy module.  The [.filename]#/etc/rc.d/ntpd# startup script first examines the NTP configuration.  If possible, it loads the `mac_ntpd` module, then starts ntpd as unpriveleged user `ntpd` (user id 123).  To avoid problems with file and directory access, the startup script will not automatically start ntpd as `ntpd` when the configuration contains any file-related options.ÚÄåœ¨ FreeBSD ä¸Šï¼Œntpd å¯ä»¥ä½œä¸ºéç‰¹æƒç”¨æˆ·å¯åŠ¨å’Œè¿è¡Œã€‚è¿™éœ€è¦ä½¿ç”¨ man:mac_ntpd[4] ç­–ç•¥æ¨¡å—ã€‚[.filename]#/etc/rc.d/ntpd# å¯åŠ¨è„šæœ¬é¦–å…ˆæ£€æŸ¥ NTP é…ç½®ã€‚å¦‚æœå¯èƒ½ï¼Œå®ƒä¼šåŠ è½½ `mac_ntpd` æ¨¡å—ï¼Œç„¶åä»¥éç‰¹æƒç”¨æˆ· `ntpd`ï¼ˆç”¨æˆ· ID ä¸º 123 ï¼‰å¯åŠ¨ ntpdã€‚ä¸ºäº†é¿å…æ–‡ä»¶å’Œç›®å½•è®¿é—®çš„é—®é¢˜ï¼Œå½“é…ç½®ä¸­åŒ…å«ä»»ä½•ä¸æ–‡ä»¶ç›¸å…³çš„é€‰é¡¹æ—¶ï¼Œå¯åŠ¨è„šæœ¬ä¸ä¼šè‡ªåŠ¨ä»¥ `ntpd` èº«ä»½å¯åŠ¨ ntpdã€‚Ù€The presence of any of the following in `ntpd_flags` requires manual configuration as described below to run as the `ntpd` user:Ùå¦‚æœ `ntpd_flags` ä¸­å­˜åœ¨ä»¥ä¸‹ä»»ä½•ä¸€é¡¹ï¼Œåˆ™éœ€è¦æŒ‰ç…§ä¸‹é¢æè¿°çš„æ‰‹åŠ¨é…ç½®æ¥ä»¥ `ntpd` ç”¨æˆ·èº«ä»½è¿è¡Œï¼šÙ’The presence of any of the following keywords in [.filename]#ntp.conf# requires manual configuration as described below to run as the `ntpd` user:Ù”åœ¨ [.filename]#ntp.conf# æ–‡ä»¶ä¸­å‡ºç°ä»¥ä¸‹å…³é”®å­—ä¹‹ä¸€ï¼Œéœ€è¦æŒ‰ç…§ä¸‹é¢æè¿°çš„æ–¹å¼æ‰‹åŠ¨é…ç½®æ‰èƒ½ä»¥ `ntpd` ç”¨æˆ·èº«ä»½è¿è¡Œï¼šÙ:To manually configure ntpd to run as user `ntpd` you must:Ù;è¦æ‰‹åŠ¨é…ç½® ntpd ä»¥ç”¨æˆ· `ntpd` è¿è¡Œï¼Œæ‚¨å¿…é¡»ï¼šÙgEnsure that the `ntpd` user has access to all the files and directories specified in the configuration.ÙJç¡®ä¿ `ntpd` ç”¨æˆ·å¯ä»¥è®¿é—®é…ç½®ä¸­æŒ‡å®šçš„æ‰€æœ‰æ–‡ä»¶å’Œç›®å½•ã€‚ÙlArrange for the `mac_ntpd` module to be loaded or compiled into the kernel. See man:mac_ntpd[4] for details.Ù^å®‰æ’åŠ è½½æˆ–ç¼–è¯‘ `mac_ntpd` æ¨¡å—åˆ°å†…æ ¸ä¸­ã€‚è¯¦ç»†ä¿¡æ¯è¯·å‚é˜… man:mac_ntpd[4]ã€‚Ù3Set `ntpd_user="ntpd"` in [.filename]#/etc/rc.conf#Ù>åœ¨ [.filename]#/etc/rc.conf# ä¸­è®¾ç½® `ntpd_user ="ntpd"`ã€‚¿Using NTP with a PPP Connection¸ä½¿ç”¨ PPP è¿æ¥çš„ NTPÚOntpd does not need a permanent connection to the Internet to function properly.  However, if a PPP connection is configured to dial out on demand, NTP traffic should be prevented from triggering a dial out or keeping the connection alive.  This can be configured with `filter` directives in [.filename]#/etc/ppp/ppp.conf#. For example:Úntpd åœ¨æ­£å¸¸è¿è¡Œæ—¶ä¸éœ€è¦ä¸äº’è”ç½‘ä¿æŒæ°¸ä¹…è¿æ¥ã€‚ç„¶è€Œï¼Œå¦‚æœé…ç½®äº† PPP è¿æ¥ä»¥æŒ‰éœ€æ‹¨å·ï¼Œåº”è¯¥é˜»æ­¢ NTP æµé‡è§¦å‘æ‹¨å·æˆ–ä¿æŒè¿æ¥æ´»åŠ¨ã€‚è¿™å¯ä»¥é€šè¿‡åœ¨ [.filename]#/etc/ppp/ppp.conf# æ–‡ä»¶ä¸­ä½¿ç”¨ `filter` æŒ‡ä»¤è¿›è¡Œé…ç½®ã€‚ä¾‹å¦‚ï¼šÙ‚For more details, refer to the `PACKET FILTERING` section in man:ppp[8] and the examples in [.filename]#/usr/share/examples/ppp/#.ÙŒæœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… man:ppp[8] ä¸­çš„ `PACKET FILTERING` éƒ¨åˆ†ä»¥åŠ [.filename]#/usr/share/examples/ppp/# ä¸­çš„ç¤ºä¾‹ã€‚ÙSome Internet access providers block low-numbered ports, preventing NTP from functioning since replies never reach the machine.Ùä¸€äº›äº’è”ç½‘æ¥å…¥æä¾›å•†ä¼šé˜»æ­¢ä½ç¼–å·ç«¯å£çš„è®¿é—®ï¼Œè¿™ä¼šå¯¼è‡´ NTP æ— æ³•æ­£å¸¸å·¥ä½œï¼Œå› ä¸ºå›å¤æ— æ³•åˆ°è¾¾ç›®æ ‡æœºå™¨ã€‚Ù(iSCSI Initiator and Target ConfigurationÙ!iSCSI å¯åŠ¨ç¨‹åºå’Œç›®æ ‡é…ç½®Ù‰iSCSI is a way to share storage over a network.  Unlike NFS, which works at the file system level, iSCSI works at the block device level.ÙƒiSCSI æ˜¯ä¸€ç§é€šè¿‡ç½‘ç»œå…±äº«å­˜å‚¨çš„æ–¹å¼ã€‚ä¸åœ¨æ–‡ä»¶ç³»ç»Ÿçº§åˆ«å·¥ä½œçš„ NFS ä¸åŒï¼ŒiSCSI åœ¨å—è®¾å¤‡çº§åˆ«å·¥ä½œã€‚Ú'In iSCSI terminology, the system that shares the storage is known as the _target_.  The storage can be a physical disk, or an area representing multiple disks or a portion of a physical disk.  For example, if the disk(s) are formatted with ZFS, a zvol can be created to use as the iSCSI storage.Ú	åœ¨ iSCSI æœ¯è¯­ä¸­ï¼Œå…±äº«å­˜å‚¨çš„ç³»ç»Ÿè¢«ç§°ä¸º _ç›®æ ‡ï¼ˆtargetï¼‰_ã€‚å­˜å‚¨å¯ä»¥æ˜¯ç‰©ç†ç£ç›˜ï¼Œä¹Ÿå¯ä»¥æ˜¯è¡¨ç¤ºå¤šä¸ªç£ç›˜æˆ–ç‰©ç†ç£ç›˜éƒ¨åˆ†çš„åŒºåŸŸã€‚ä¾‹å¦‚ï¼Œå¦‚æœç£ç›˜ä½¿ç”¨ ZFS æ ¼å¼åŒ–ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ª zvol ä½œä¸º iSCSI å­˜å‚¨ä½¿ç”¨ã€‚ÚThe clients which access the iSCSI storage are called _initiators_.  To initiators, the storage available through iSCSI appears as a raw, unformatted disk known as a LUN.  Device nodes for the disk appear in [.filename]#/dev/# and the device must be separately formatted and mounted.Ú,è®¿é—® iSCSI å­˜å‚¨çš„å®¢æˆ·ç«¯è¢«ç§°ä¸º _å‘èµ·è€…ï¼ˆinitiatorsï¼‰_ã€‚å¯¹äºå‘èµ·è€…æ¥è¯´ï¼Œé€šè¿‡ iSCSI å¯ç”¨çš„å­˜å‚¨çœ‹èµ·æ¥åƒä¸€ä¸ªæœªæ ¼å¼åŒ–çš„åŸå§‹ç£ç›˜ï¼Œç§°ä¸ºé€»è¾‘å•å…ƒ (LUN) ã€‚ç£ç›˜çš„è®¾å¤‡èŠ‚ç‚¹å‡ºç°åœ¨ [.filename]#/dev/# ä¸­ï¼Œè®¾å¤‡å¿…é¡»å•ç‹¬è¿›è¡Œæ ¼å¼åŒ–å’ŒæŒ‚è½½ã€‚ÙšFreeBSD provides a native, kernel-based iSCSI target and initiator.  This section describes how to configure a FreeBSD system as a target or an initiator.ÙŠFreeBSD æä¾›äº†æœ¬åœ°çš„åŸºäºå†…æ ¸çš„ iSCSI ç›®æ ‡å’Œå‘èµ·è€…ã€‚æœ¬èŠ‚æè¿°äº†å¦‚ä½•å°† FreeBSD ç³»ç»Ÿé…ç½®ä¸ºç›®æ ‡æˆ–å‘èµ·è€…ã€‚»Configuring an iSCSI Target³é…ç½® iSCSI ç›®æ ‡ÙàTo configure an iSCSI target, create the [.filename]#/etc/ctl.conf# configuration file, add a line to [.filename]#/etc/rc.conf# to make sure the man:ctld[8] daemon is automatically started at boot, and then start the daemon.Ùóè¦é…ç½®ä¸€ä¸ª iSCSI ç›®æ ‡ï¼Œéœ€è¦åˆ›å»ºä¸€ä¸ªåä¸º [.filename]#/etc/ctl.conf# çš„é…ç½®æ–‡ä»¶ï¼Œç„¶ååœ¨ [.filename]#/etc/rc.conf# ä¸­æ·»åŠ ä¸€è¡Œï¼Œä»¥ç¡®ä¿ man:ctld[8] å®ˆæŠ¤è¿›ç¨‹åœ¨å¯åŠ¨æ—¶è‡ªåŠ¨å¯åŠ¨ï¼Œæœ€åå¯åŠ¨å®ˆæŠ¤è¿›ç¨‹ã€‚Ù²The following is an example of a simple [.filename]#/etc/ctl.conf# configuration file.  Refer to man:ctl.conf[5] for a more complete description of this file's available options.Ù™ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ [.filename]#/etc/ctl.conf# é…ç½®æ–‡ä»¶çš„ç¤ºä¾‹ã€‚æœ‰å…³æ­¤æ–‡ä»¶å¯ç”¨é€‰é¡¹çš„æ›´å®Œæ•´æè¿°ï¼Œè¯·å‚é˜… man:ctl.conf[5] ã€‚Ú¯The first entry defines the `pg0` portal group.  Portal groups define which network addresses the man:ctld[8] daemon will listen on.  The `discovery-auth-group no-authentication` entry indicates that any initiator is allowed to perform iSCSI target discovery without authentication.  Lines three and four configure man:ctld[8] to listen on all IPv4 (`listen 0.0.0.0`) and IPv6 (`listen [::]`) addresses on the default port of 3260.Ú†ç¬¬ä¸€ä¸ªæ¡ç›®å®šä¹‰äº† `pg0` é—¨æˆ·ç»„ã€‚é—¨æˆ·ç»„å®šä¹‰äº† man:ctld[8] å®ˆæŠ¤è¿›ç¨‹å°†ç›‘å¬å“ªäº›ç½‘ç»œåœ°å€ã€‚`discovery-auth-group no-authentication` æ¡ç›®è¡¨ç¤ºä»»ä½•å‘èµ·è€…éƒ½å¯ä»¥åœ¨æ²¡æœ‰èº«ä»½éªŒè¯çš„æƒ…å†µä¸‹æ‰§è¡Œ iSCSI ç›®æ ‡å‘ç°ã€‚ç¬¬ä¸‰å’Œç¬¬å››è¡Œé…ç½® man:ctld[8] åœ¨é»˜è®¤ç«¯å£ 3260 ä¸Šç›‘å¬æ‰€æœ‰ IPv4ï¼ˆ`listen 0.0.0.0`ï¼‰å’Œ IPv6ï¼ˆ`listen [::]`ï¼‰åœ°å€ã€‚ÙÿIt is not necessary to define a portal group as there is a built-in portal group called `default`.  In this case, the difference between `default` and `pg0` is that with `default`, target discovery is always denied, while with `pg0`, it is always allowed.Ùùä¸éœ€è¦å®šä¹‰ä¸€ä¸ªé—¨æˆ·ç»„ï¼Œå› ä¸ºæœ‰ä¸€ä¸ªå†…ç½®çš„é—¨æˆ·ç»„å«åš `default`ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ`default` å’Œ `pg0` çš„åŒºåˆ«åœ¨äºï¼Œä½¿ç”¨ `default` æ—¶ï¼Œç›®æ ‡å‘ç°å§‹ç»ˆè¢«æ‹’ç»ï¼Œè€Œä½¿ç”¨ `pg0` æ—¶ï¼Œç›®æ ‡å‘ç°å§‹ç»ˆè¢«å…è®¸ã€‚ÚThe second entry defines a single target.  Target has two possible meanings: a machine serving iSCSI or a named group of LUNs.  This example uses the latter meaning, where `iqn.2012-06.com.example:target0` is the target name.  This target name is suitable for testing purposes.  For actual use, change `com.example` to the real domain name, reversed.  The `2012-06` represents the year and month of acquiring control of that domain name, and `target0` can be any value.  Any number of targets can be defined in this configuration file.Úç¬¬äºŒä¸ªæ¡ç›®å®šä¹‰äº†ä¸€ä¸ªå•ä¸€çš„ç›®æ ‡ã€‚ç›®æ ‡æœ‰ä¸¤ä¸ªå¯èƒ½çš„å«ä¹‰ï¼šä¸€ä¸ªç”¨äºæä¾› iSCSI æœåŠ¡çš„æœºå™¨ï¼Œæˆ–è€…æ˜¯ä¸€ä¸ªå‘½åçš„ LUN ç»„ã€‚è¿™ä¸ªç¤ºä¾‹ä½¿ç”¨äº†åè€…çš„å«ä¹‰ï¼Œå…¶ä¸­ `iqn.2012-06.com.example:target0` æ˜¯ç›®æ ‡åç§°ã€‚è¿™ä¸ªç›®æ ‡åç§°é€‚ç”¨äºæµ‹è¯•ç›®çš„ã€‚å®é™…ä½¿ç”¨æ—¶ï¼Œå°† `com.example` æ›´æ”¹ä¸ºçœŸå®çš„åŸŸåï¼Œåè½¬è¿‡æ¥ã€‚`2012-06` ä»£è¡¨è·å–è¯¥åŸŸåæ§åˆ¶æƒçš„å¹´ä»½å’Œæœˆä»½ï¼Œè€Œ `target0` å¯ä»¥æ˜¯ä»»ä½•å€¼ã€‚åœ¨è¿™ä¸ªé…ç½®æ–‡ä»¶ä¸­å¯ä»¥å®šä¹‰ä»»æ„æ•°é‡çš„ç›®æ ‡ã€‚Ù²The `auth-group no-authentication` line allows all initiators to connect to the specified target and `portal-group pg0` makes the target reachable through the `pg0` portal group.Ù—`auth-group no-authentication` è¡Œå…è®¸æ‰€æœ‰å‘èµ·è€…è¿æ¥åˆ°æŒ‡å®šçš„ç›®æ ‡ï¼Œè€Œ `portal-group pg0` åˆ™é€šè¿‡ `pg0` é—¨æˆ·ç»„ä½¿ç›®æ ‡å¯è®¿é—®ã€‚Ú£The next section defines the LUN.  To the initiator, each LUN will be visible as a separate disk device.  Multiple LUNs can be defined for each target.  Each LUN is identified by a number, where LUN 0 is mandatory.  The `path /data/target0-0` line defines the full path to a file or zvol backing the LUN.  That path must exist before starting man:ctld[8].  The second line is optional and specifies the size of the LUN.Úˆä¸‹ä¸€èŠ‚å®šä¹‰äº† LUNã€‚å¯¹äºå‘èµ·è€…æ¥è¯´ï¼Œæ¯ä¸ª LUN å°†è¢«è§†ä¸ºä¸€ä¸ªç‹¬ç«‹çš„ç£ç›˜è®¾å¤‡ã€‚æ¯ä¸ªç›®æ ‡å¯ä»¥å®šä¹‰å¤šä¸ª LUNã€‚æ¯ä¸ª LUN ç”±ä¸€ä¸ªæ•°å­—æ ‡è¯†ï¼Œå…¶ä¸­ LUN 0 æ˜¯å¿…éœ€çš„ã€‚`path /data/target0-0` è¡Œå®šä¹‰äº†æ”¯æŒ LUN çš„æ–‡ä»¶æˆ– zvol çš„å®Œæ•´è·¯å¾„ã€‚åœ¨å¯åŠ¨ man:ctld[8] ä¹‹å‰ï¼Œè¯¥è·¯å¾„å¿…é¡»å­˜åœ¨ã€‚ç¬¬äºŒè¡Œæ˜¯å¯é€‰çš„ï¼Œç”¨äºæŒ‡å®š LUN çš„å¤§å°ã€‚ÙiNext, to make sure the man:ctld[8] daemon is started at boot, add this line to [.filename]#/etc/rc.conf#:Ù‹æ¥ä¸‹æ¥ï¼Œä¸ºäº†ç¡®ä¿ man:ctld[8] å®ˆæŠ¤è¿›ç¨‹åœ¨å¯åŠ¨æ—¶è‡ªåŠ¨å¯åŠ¨ï¼Œè¯·å°†ä»¥ä¸‹è¡Œæ·»åŠ åˆ° [.filename]#/etc/rc.conf# æ–‡ä»¶ä¸­ï¼šÙ+To start man:ctld[8] now, run this command:Ù1è¦å¯åŠ¨ man:ctld[8] ï¼Œè¯·è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼šÙ¹As the man:ctld[8] daemon is started, it reads [.filename]#/etc/ctl.conf#.  If this file is edited after the daemon starts, use this command so that the changes take effect immediately:Ù¶å½“å¯åŠ¨ man:ctld[8] å®ˆæŠ¤è¿›ç¨‹æ—¶ï¼Œå®ƒä¼šè¯»å– [.filename]#/etc/ctl.conf# æ–‡ä»¶ã€‚å¦‚æœåœ¨å®ˆæŠ¤è¿›ç¨‹å¯åŠ¨åç¼–è¾‘äº†æ­¤æ–‡ä»¶ï¼Œè¯·ä½¿ç”¨æ­¤å‘½ä»¤ä½¿æ›´æ”¹ç«‹å³ç”Ÿæ•ˆï¼š®Authentication¬èº«ä»½éªŒè¯ÙÑThe previous example is inherently insecure as it uses no authentication, granting anyone full access to all targets.  To require a username and password to access targets, modify the configuration as follows:ÙÕå‰é¢çš„ç¤ºä¾‹åœ¨æœ¬è´¨ä¸Šæ˜¯ä¸å®‰å…¨çš„ï¼Œå› ä¸ºå®ƒæ²¡æœ‰ä½¿ç”¨èº«ä»½éªŒè¯ï¼Œä»»ä½•äººéƒ½å¯ä»¥å®Œå…¨è®¿é—®æ‰€æœ‰ç›®æ ‡ã€‚ä¸ºäº†è¦æ±‚ä½¿ç”¨ç”¨æˆ·åå’Œå¯†ç æ¥è®¿é—®ç›®æ ‡ï¼Œè¯·æŒ‰ä»¥ä¸‹æ–¹å¼ä¿®æ”¹é…ç½®ï¼šÚThe `auth-group` section defines username and password pairs.  An initiator trying to connect to `iqn.2012-06.com.example:target0` must first specify a defined username and secret.  However, target discovery is still permitted without authentication.  To require target discovery authentication, set `discovery-auth-group` to a defined `auth-group` name instead of `no-authentication`.Ú‡`auth-group` éƒ¨åˆ†å®šä¹‰äº†ç”¨æˆ·åå’Œå¯†ç å¯¹ã€‚è¯•å›¾è¿æ¥åˆ° `iqn.2012-06.com.example:target0` çš„å‘èµ·è€…å¿…é¡»é¦–å…ˆæŒ‡å®šä¸€ä¸ªå·²å®šä¹‰çš„ç”¨æˆ·åå’Œå¯†ç ã€‚ç„¶è€Œï¼Œç›®æ ‡å‘ç°ä»ç„¶å…è®¸åœ¨æ²¡æœ‰èº«ä»½éªŒè¯çš„æƒ…å†µä¸‹è¿›è¡Œã€‚è¦æ±‚ç›®æ ‡å‘ç°è¿›è¡Œèº«ä»½éªŒè¯ï¼Œè¯·å°† `discovery-auth-group` è®¾ç½®ä¸ºå·²å®šä¹‰çš„ `auth-group` åç§°ï¼Œè€Œä¸æ˜¯ `no-authentication`ã€‚Ù³It is common to define a single exported target for every initiator.  As a shorthand for the syntax above, the username and password can be specified directly in the target entry:Ù¢é€šå¸¸ä¸ºæ¯ä¸ªå‘èµ·è€…å®šä¹‰ä¸€ä¸ªå•ç‹¬çš„å¯¼å‡ºç›®æ ‡æ˜¯å¾ˆå¸¸è§çš„ã€‚ä½œä¸ºä¸Šè¿°è¯­æ³•çš„ç®€å†™ï¼Œç”¨æˆ·åå’Œå¯†ç å¯ä»¥ç›´æ¥åœ¨ç›®æ ‡æ¡ç›®ä¸­æŒ‡å®šï¼š¾Configuring an iSCSI Initiator¶é…ç½® iSCSI å‘èµ·è€…Ù²The iSCSI initiator described in this section is supported starting with FreeBSD 10.0-RELEASE.  To use the iSCSI initiator available in older versions, refer to man:iscontrol[8].ÙŸæœ¬èŠ‚ä¸­æè¿°çš„ iSCSI å‘èµ·è€…ä» FreeBSD 10.0-RELEASE å¼€å§‹å¾—åˆ°æ”¯æŒã€‚è¦ä½¿ç”¨æ—§ç‰ˆæœ¬ä¸­æä¾›çš„ iSCSI initiatorï¼Œè¯·å‚è€ƒ man:iscontrol[8] ã€‚ÙÆThe iSCSI initiator requires that the man:iscsid[8] daemon is running.  This daemon does not use a configuration file.  To start it automatically at boot, add this line to [.filename]#/etc/rc.conf#:ÙÆiSCSI å‘èµ·è€…è¦æ±‚ man:iscsid[8] å®ˆæŠ¤è¿›ç¨‹æ­£åœ¨è¿è¡Œã€‚è¯¥å®ˆæŠ¤è¿›ç¨‹ä¸ä½¿ç”¨é…ç½®æ–‡ä»¶ã€‚è¦åœ¨å¯åŠ¨æ—¶è‡ªåŠ¨å¯åŠ¨å®ƒï¼Œè¯·å°†ä»¥ä¸‹è¡Œæ·»åŠ åˆ° [.filename]#/etc/rc.conf# æ–‡ä»¶ä¸­ï¼šÙ-To start man:iscsid[8] now, run this command:Ù2è¦å¯åŠ¨ man:iscsid[8]ï¼Œè¯·è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼šÙœConnecting to a target can be done with or without an [.filename]#/etc/iscsi.conf# configuration file.  This section demonstrates both types of connections.Ùè¿æ¥åˆ°ç›®æ ‡å¯ä»¥ä½¿ç”¨æˆ–ä¸ä½¿ç”¨ [.filename]#/etc/iscsi.conf# é…ç½®æ–‡ä»¶ã€‚æœ¬èŠ‚æ¼”ç¤ºäº†ä¸¤ç§ç±»å‹çš„è¿æ¥æ–¹å¼ã€‚Ù3Connecting to a Target Without a Configuration FileÙ!æ— éœ€é…ç½®æ–‡ä»¶è¿æ¥åˆ°ç›®æ ‡ÙlTo connect an initiator to a single target, specify the IP address of the portal and the name of the target:ÙXè¦å°†å‘èµ·è€…è¿æ¥åˆ°å•ä¸ªç›®æ ‡ï¼Œè¯·æŒ‡å®šé—¨æˆ·çš„ IP åœ°å€å’Œç›®æ ‡çš„åç§°ï¼šÙuTo verify if the connection succeeded, run `iscsictl` without any arguments.  The output should look similar to this:Ùuè¦éªŒè¯è¿æ¥æ˜¯å¦æˆåŠŸï¼Œè¯·è¿è¡Œ `iscsictl` å‘½ä»¤ï¼Œä¸å¸¦ä»»ä½•å‚æ•°ã€‚è¾“å‡ºåº”è¯¥ç±»ä¼¼äºä»¥ä¸‹å†…å®¹ï¼šÚ	In this example, the iSCSI session was successfully established, with [.filename]#/dev/da0# representing the attached LUN.  If the `iqn.2012-06.com.example:target0` target exports more than one LUN, multiple device nodes will be shown in that section of the output:Ùïåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ iSCSI ä¼šè¯æˆåŠŸå»ºç«‹ï¼Œå…¶ä¸­ [.filename]#/dev/da0# ä»£è¡¨å·²è¿æ¥çš„é€»è¾‘å•å…ƒï¼ˆ LUN ï¼‰ã€‚å¦‚æœ `iqn.2012-06.com.example:target0` ç›®æ ‡å¯¼å‡ºå¤šä¸ª LUNï¼Œåˆ™è¾“å‡ºçš„è¯¥éƒ¨åˆ†å°†æ˜¾ç¤ºå¤šä¸ªè®¾å¤‡èŠ‚ç‚¹ã€‚ÙAny errors will be reported in the output, as well as the system logs.  For example, this message usually means that the man:iscsid[8] daemon is not running:ÙŠä»»ä½•é”™è¯¯éƒ½å°†åœ¨è¾“å‡ºä¸­æŠ¥å‘Šï¼Œä»¥åŠç³»ç»Ÿæ—¥å¿—ä¸­ã€‚ä¾‹å¦‚ï¼Œè¿™ä¸ªæ¶ˆæ¯é€šå¸¸æ„å‘³ç€ man:iscsid[8] å®ˆæŠ¤è¿›ç¨‹æœªè¿è¡Œï¼šÙXThe following message suggests a networking problem, such as a wrong IP address or port:ÙLä»¥ä¸‹æ¶ˆæ¯æç¤ºå­˜åœ¨ç½‘ç»œé—®é¢˜ï¼Œä¾‹å¦‚é”™è¯¯çš„ IP åœ°å€æˆ–ç«¯å£ï¼šÙ;This message means that the specified target name is wrong:Ù9è¿™æ¡æ¶ˆæ¯æ„å‘³ç€æŒ‡å®šçš„ç›®æ ‡åç§°æ˜¯é”™è¯¯çš„ï¼šÙ;This message means that the target requires authentication:Ù3è¿™æ¡æ¶ˆæ¯è¡¨ç¤ºç›®æ ‡éœ€è¦è¿›è¡Œèº«ä»½éªŒè¯ï¼šÙ7To specify a CHAP username and secret, use this syntax:Ù9è¦æŒ‡å®š CHAP ç”¨æˆ·åå’Œå¯†ç ï¼Œä½¿ç”¨ä»¥ä¸‹è¯­æ³•ï¼šÙ0Connecting to a Target with a Configuration FileÙ!ä½¿ç”¨é…ç½®æ–‡ä»¶è¿æ¥åˆ°ç›®æ ‡ÙcTo connect using a configuration file, create [.filename]#/etc/iscsi.conf# with contents like this:ÙŠè¦ä½¿ç”¨é…ç½®æ–‡ä»¶è¿›è¡Œè¿æ¥ï¼Œè¯·åˆ›å»ºä¸€ä¸ªåä¸º [.filename]#/etc/iscsi.conf# çš„æ–‡ä»¶ï¼Œå¹¶å°†å…¶å†…å®¹è®¾ç½®ä¸ºä»¥ä¸‹å†…å®¹ï¼šÚcThe `t0` specifies a nickname for the configuration file section.  It will be used by the initiator to specify which configuration to use.  The other lines specify the parameters to use during connection.  The `TargetAddress` and `TargetName` are mandatory, whereas the other options are optional.  In this example, the CHAP username and secret are shown.Ú`t0` æŒ‡å®šäº†é…ç½®æ–‡ä»¶éƒ¨åˆ†çš„åˆ«åã€‚å®ƒå°†è¢«å‘èµ·è€…ç”¨æ¥æŒ‡å®šè¦ä½¿ç”¨çš„é…ç½®ã€‚å…¶ä»–è¡ŒæŒ‡å®šäº†è¿æ¥è¿‡ç¨‹ä¸­è¦ä½¿ç”¨çš„å‚æ•°ã€‚`TargetAddress` å’Œ `TargetName` æ˜¯å¿…éœ€çš„ï¼Œè€Œå…¶ä»–é€‰é¡¹æ˜¯å¯é€‰çš„ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæ˜¾ç¤ºäº† CHAP ç”¨æˆ·åå’Œå¯†ç ã€‚Ù7To connect to the defined target, specify the nickname:Ù0è¦è¿æ¥åˆ°å®šä¹‰çš„ç›®æ ‡ï¼Œè¯·æŒ‡å®šæ˜µç§°ï¼šÙNAlternately, to connect to all targets defined in the configuration file, use:ÙHæˆ–è€…ï¼Œè¦è¿æ¥åˆ°é…ç½®æ–‡ä»¶ä¸­å®šä¹‰çš„æ‰€æœ‰ç›®æ ‡ï¼Œè¯·ä½¿ç”¨ï¼šÙ‹To make the initiator automatically connect to all targets in [.filename]#/etc/iscsi.conf#, add the following to [.filename]#/etc/rc.conf#:Ùè¦ä½¿å‘èµ·è€…è‡ªåŠ¨è¿æ¥åˆ° [.filename]#/etc/iscsi.conf# ä¸­çš„æ‰€æœ‰ç›®æ ‡ï¼Œè¯·å°†ä»¥ä¸‹å†…å®¹æ·»åŠ åˆ° [.filename]#/etc/rc.conf# ä¸­ï¼š